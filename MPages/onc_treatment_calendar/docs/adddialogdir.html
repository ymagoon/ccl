<!DOCTYPE html>

<html>
<head>
  <title>adddialogdir.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="Gruntfile.html">
                Gruntfile.js
              </a>
            
              
              <a class="source" href="server.html">
                server.js
              </a>
            
              
              <a class="source" href="accordionctrl.html">
                accordionctrl.js
              </a>
            
              
              <a class="source" href="appctrl.html">
                appctrl.js
              </a>
            
              
              <a class="source" href="calendarctrl.html">
                calendarctrl.js
              </a>
            
              
              <a class="source" href="calendarnotesctrl.html">
                calendarnotesctrl.js
              </a>
            
              
              <a class="source" href="listctrl.html">
                listctrl.js
              </a>
            
              
              <a class="source" href="accordionapptdir.html">
                accordionapptdir.js
              </a>
            
              
              <a class="source" href="accordiondir.html">
                accordiondir.js
              </a>
            
              
              <a class="source" href="accordionmeddir.html">
                accordionmeddir.js
              </a>
            
              
              <a class="source" href="accordionorderdir.html">
                accordionorderdir.js
              </a>
            
              
              <a class="source" href="accordionphasedir.html">
                accordionphasedir.js
              </a>
            
              
              <a class="source" href="accordionplandir.html">
                accordionplandir.js
              </a>
            
              
              <a class="source" href="accordionregimendir.html">
                accordionregimendir.js
              </a>
            
              
              <a class="source" href="adddialogdir.html">
                adddialogdir.js
              </a>
            
              
              <a class="source" href="calendarcontrolsdir.html">
                calendarcontrolsdir.js
              </a>
            
              
              <a class="source" href="calendardatedir.html">
                calendardatedir.js
              </a>
            
              
              <a class="source" href="calendardaydir.html">
                calendardaydir.js
              </a>
            
              
              <a class="source" href="calendardir.html">
                calendardir.js
              </a>
            
              
              <a class="source" href="calendarlistdir.html">
                calendarlistdir.js
              </a>
            
              
              <a class="source" href="hoverhighlightdir.html">
                hoverhighlightdir.js
              </a>
            
              
              <a class="source" href="jquerydatepicker.html">
                jquerydatepicker.js
              </a>
            
              
              <a class="source" href="listdatedir.html">
                listdatedir.js
              </a>
            
              
              <a class="source" href="modalcalendardir.html">
                modalcalendardir.js
              </a>
            
              
              <a class="source" href="noteinputdir.html">
                noteinputdir.js
              </a>
            
              
              <a class="source" href="printcalendardatedir.html">
                printcalendardatedir.js
              </a>
            
              
              <a class="source" href="printcalendardaydir.html">
                printcalendardaydir.js
              </a>
            
              
              <a class="source" href="printcalendarviewdir.html">
                printcalendarviewdir.js
              </a>
            
              
              <a class="source" href="printdialogdir.html">
                printdialogdir.js
              </a>
            
              
              <a class="source" href="printlistviewdir.html">
                printlistviewdir.js
              </a>
            
              
              <a class="source" href="printtemplate.html">
                printtemplate.js
              </a>
            
              
              <a class="source" href="qtipdir.html">
                qtipdir.js
              </a>
            
              
              <a class="source" href="schedulableicondir.html">
                schedulableicondir.js
              </a>
            
              
              <a class="source" href="statusdialogdir.html">
                statusdialogdir.js
              </a>
            
              
              <a class="source" href="windowresizedir.html">
                windowresizedir.js
              </a>
            
              
              <a class="source" href="cal-view_i18n.html">
                cal-view_i18n.js
              </a>
            
              
              <a class="source" href="cal-view_i18n.html">
                cal-view_i18n.js
              </a>
            
              
              <a class="source" href="cal-view_i18n.html">
                cal-view_i18n.js
              </a>
            
              
              <a class="source" href="cal-view_i18n.html">
                cal-view_i18n.js
              </a>
            
              
              <a class="source" href="cal-view_i18n.html">
                cal-view_i18n.js
              </a>
            
              
              <a class="source" href="cal-view_i18n.html">
                cal-view_i18n.js
              </a>
            
              
              <a class="source" href="cal-view_i18n.html">
                cal-view_i18n.js
              </a>
            
              
              <a class="source" href="blackbird.html">
                blackbird.js
              </a>
            
              
              <a class="source" href="dc_mp_js_util_mpage.html">
                dc_mp_js_util_mpage.js
              </a>
            
              
              <a class="source" href="oncmp_core.html">
                oncmp_core.js
              </a>
            
              
              <a class="source" href="printerConfig_template.html">
                printerConfig_template.js
              </a>
            
              
              <a class="source" href="xml2json.html">
                xml2json.js
              </a>
            
              
              <a class="source" href="animationsmod.html">
                animationsmod.js
              </a>
            
              
              <a class="source" href="appmod.html">
                appmod.js
              </a>
            
              
              <a class="source" href="controllersmod.html">
                controllersmod.js
              </a>
            
              
              <a class="source" href="directivesmod.html">
                directivesmod.js
              </a>
            
              
              <a class="source" href="daodevsvc.html">
                daodevsvc.js
              </a>
            
              
              <a class="source" href="daoprodsvc.html">
                daoprodsvc.js
              </a>
            
              
              <a class="source" href="notesmedssvc.html">
                notesmedssvc.js
              </a>
            
              
              <a class="source" href="notesmedssvcdev.html">
                notesmedssvcdev.js
              </a>
            
              
              <a class="source" href="pubsubsvc.html">
                pubsubsvc.js
              </a>
            
              
              <a class="source" href="services.html">
                services.js
              </a>
            
              
              <a class="source" href="signdevsvc.html">
                signdevsvc.js
              </a>
            
              
              <a class="source" href="signprodsvc.html">
                signprodsvc.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>adddialogdir.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>This Module is to show popupdialog while adding notes and while signing prescriptions/appointments </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>angular.module(<span class="hljs-string">'calview.directives'</span>).directive(<span class="hljs-string">'addDialog'</span>, [
  <span class="hljs-string">'$rootScope'</span>, <span class="hljs-string">'$timeout'</span>,<span class="hljs-string">'$compile'</span>, <span class="hljs-string">'sign'</span>, <span class="hljs-string">'notesMedsSvc'</span>, <span class="hljs-string">'pubsub'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($rootScope, $timeout, $compile, sign, notesMedsSvc, pubsub)</span> {</span>
    <span class="hljs-keyword">return</span> {
     templateUrl: <span class="hljs-string">"adddialogdir.html"</span>,
      replace: <span class="hljs-literal">true</span>,
      restrict: <span class="hljs-string">'E'</span>,
      link: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(scope, iElement, iAttrs, controller)</span> {</span>
        <span class="hljs-keyword">var</span> $cal1, $cal2, $cal3, backOne, backThree, cals, date, dates, deregisterFn, firstDate, forwardOne, forwardThree, i, init, key, last, lastDate, meridiems, mom, move, uidWatcher, watchers, _i, _len;
        cals = $(<span class="hljs-string">'#modal-calendars'</span>).children();
        $cal1 = $(cals[<span class="hljs-number">0</span>]);
        $cal2 = $(cals[<span class="hljs-number">1</span>]);
        $cal3 = $(cals[<span class="hljs-number">2</span>]);
        
        firstDate = vars.todayMidnight;
        lastDate = moment(firstDate).add(<span class="hljs-string">'days'</span>, vars.daysRange).valueOf();
        backThree = i18n.oncology.calview.BACK_THREE;
        backOne = i18n.oncology.calview.BACK_ONE_M;
        forwardOne = i18n.oncology.calview.FORWARD_ONE_M;
        forwardThree = i18n.oncology.calview.FORWARD_THREE;
        meridiems = [moment().startOf(<span class="hljs-string">'day'</span>).format(<span class="hljs-string">'A'</span>), moment().endOf(<span class="hljs-string">'day'</span>).format(<span class="hljs-string">'A'</span>)];
        scope.requestforCycleTitle =i18n.oncology.calview.SEND_REQUEST_FOR_CYCLE;
        scope.adjustAllTitle =i18n.oncology.calview.ADJUST_ALL_FUTURE_CYCLE;
        scope.requestAllTitle =i18n.oncology.calview.SEND_REQUESTS_FOR_ALL;
        
        scope.adjustAll = <span class="hljs-literal">false</span>;
        scope.requestforCycle = <span class="hljs-literal">false</span>;
        scope.requestAll = <span class="hljs-literal">false</span>;
        scope.showRequestAll = vars.showRequestAll;          
        scope.selections = [];
        scope.leftMonth = <span class="hljs-literal">null</span>;
        scope.backThree = <span class="hljs-string">''</span>;
        scope.backOne = <span class="hljs-string">''</span>;
        scope.forwardOne = <span class="hljs-string">''</span>;
        scope.forwardThree = <span class="hljs-string">''</span>;
        scope.titleLabel = i18n.oncology.calview.MODAL_TITLE;
        scope.selectDatesLabel = _.str.capitalize(i18n.oncology.calview.SELECT_DATES);
        scope.updateCycleDate = i18n.oncology.calview.UPDATE_CYCLE_DATE;
        scope.timeLabel = i18n.oncology.calview.TIME;
        scope.timesLabel = i18n.oncology.calview.TIMES;
        scope.cancelLabel = i18n.CANCEL;
        scope.startDTTM = i18n.START_DT_TM;
        
        scope.text = <span class="hljs-string">""</span>;
        dates = $rootScope.$$childHead.dates;
        scope.keys = [];
        <span class="hljs-keyword">for</span> (i = _i = <span class="hljs-number">0</span>, _len = dates.length; _i &lt; _len; i = ++_i) {
          date = dates[i];
          mom = moment(date.unixStamp);
          key = <span class="hljs-string">""</span> + (mom.month()) + (mom.year());
          <span class="hljs-keyword">if</span> (_.last(scope.keys)) {
            last = _.last(scope.keys);
            <span class="hljs-keyword">if</span> (last.key !== key) {
              scope.keys.push({
                key: key,
                idx: i
              });
            }
          } <span class="hljs-keyword">else</span> {
            scope.keys.push({
              key: key,
              idx: i
            });
          }
        }
        scope.keysLength = scope.keys.length;
        move = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(num, signum)</span> {</span>
          <span class="hljs-keyword">var</span> int;
          _.each([$cal1, $cal2, $cal3], <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($div)</span> {</span>
            <span class="hljs-keyword">return</span> $div.empty();
          });
          int = <span class="hljs-built_in">parseInt</span>(num, <span class="hljs-number">10</span>);
          scope.leftMonth = signum ? scope.leftMonth + int : scope.leftMonth - int;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>code to validate the last 3 months</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          
          <span class="hljs-keyword">var</span> diffMonth =  scope.keysLength - scope.leftMonth;
          <span class="hljs-keyword">if</span>(diffMonth == <span class="hljs-number">1</span>)
          {
          	scope.leftMonth = scope.leftMonth - <span class="hljs-number">2</span> ;
          }
          <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(diffMonth == <span class="hljs-number">2</span>)
          {
          	scope.leftMonth = scope.leftMonth - <span class="hljs-number">1</span> ;
          }
                    
          $cal1.append(<span class="hljs-string">"&lt;modal-calendar data-date=\""</span> + scope.keys[scope.leftMonth].idx + <span class="hljs-string">"\"&gt;&lt;/modal-calendar&gt;"</span>);
          $cal2.append(<span class="hljs-string">"&lt;modal-calendar data-date=\""</span> + scope.keys[scope.leftMonth + <span class="hljs-number">1</span>].idx + <span class="hljs-string">"\"&gt;&lt;/modal-calendar&gt;"</span>);
          $cal3.append(<span class="hljs-string">"&lt;modal-calendar data-date=\""</span> + scope.keys[scope.leftMonth + <span class="hljs-number">2</span>].idx + <span class="hljs-string">"\"&gt;&lt;/modal-calendar&gt;"</span>);
         
          $compile(cals)(scope);
          $(<span class="hljs-string">'.modal-calendar-dates'</span>).height($(<span class="hljs-string">'.modal-calendar'</span>).height() - $(<span class="hljs-string">'.modal-calendar-month'</span>).height() - $(<span class="hljs-string">'.modal-calendar-days'</span>).height());
          scope.backOne = scope.leftMonth === <span class="hljs-number">0</span> ? <span class="hljs-string">''</span> : backOne;
          scope.backThree = scope.leftMonth &lt; <span class="hljs-number">3</span> ? <span class="hljs-string">''</span> : backThree;
          scope.forwardOne = scope.leftMonth === (scope.keysLength - <span class="hljs-number">3</span>) ? <span class="hljs-string">''</span> : forwardOne;
          scope.forwardThree = scope.leftMonth &gt; (scope.keysLength - <span class="hljs-number">6</span>) ? <span class="hljs-string">''</span> : forwardThree;
        };
        init = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
          vars.todayMidnight = moment().startOf(<span class="hljs-string">'day'</span>);	
          <span class="hljs-keyword">var</span> idx, key, mom;
          scope.updateCycleFlag = <span class="hljs-literal">false</span>;
	        <span class="hljs-keyword">if</span>(scope.isNote === <span class="hljs-literal">false</span> &amp;&amp; scope.schedulable.schedType === <span class="hljs-string">'Order'</span> )  
	        {
	         <span class="hljs-keyword">if</span>( scope.schedulable.relatedPhaseId() &lt;= <span class="hljs-number">1</span>)
	         {
	            scope.updateCycleFlag = <span class="hljs-literal">true</span>;
	         }         
	        }

          <span class="hljs-keyword">try</span>{
          <span class="hljs-keyword">if</span> (scope.unixStamp) {
            mom = moment(scope.unixStamp);
            scope.time = mom.format(<span class="hljs-string">'h:mm'</span>);
            scope.meridiem = mom.format(<span class="hljs-string">'A'</span>);
            <span class="hljs-keyword">if</span>(!scope.isNote &amp;&amp; scope.schedulable.json.ORDER_ID == <span class="hljs-number">0.0</span>){
                scope.time = <span class="hljs-string">"8:00"</span>;
                scope.meridiem = moment(vars.todayMidnight).format(<span class="hljs-string">'A'</span>);
               }
                
           
            scope.originalTime = <span class="hljs-string">""</span> + scope.time + scope.meridiem;
            <span class="hljs-keyword">if</span> (!scope.uid) {
              scope.selections.push(scope.unixStamp);
            }
            key = <span class="hljs-string">""</span> + (mom.month()) + (mom.year());
            idx = _.indexOf(_.map(scope.keys, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(k)</span> {</span>
              <span class="hljs-keyword">return</span> k.key;
            }), key);
       
            
            
            <span class="hljs-keyword">if</span>(idx === -<span class="hljs-number">1</span>) <span class="hljs-comment">// if idx is -1 then we should set the calendar for the current month </span>
            {
	            mom = moment(vars.todayMidnight);
	            scope.time = <span class="hljs-string">"8:00"</span>;
                scope.meridiem = mom.format(<span class="hljs-string">'A'</span>);
	           
	            key = <span class="hljs-string">""</span> + (mom.month()) + (mom.year());
	            
	             <span class="hljs-keyword">var</span> icurrentmonth = _.indexOf(_.map(scope.keys, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(k)</span> {</span>
	              <span class="hljs-keyword">return</span> k.key;
	            }), key);
	            
	            <span class="hljs-keyword">if</span>(icurrentmonth &gt; idx)
	            {
	            	idx = icurrentmonth;
	                
	            }
            }
            scope.setTime();
            scope.leftMonth = idx - <span class="hljs-number">3</span>;
            
          } <span class="hljs-keyword">else</span> {
            scope.meridiem = meridiems[<span class="hljs-number">0</span>];
            
             mom = moment(vars.todayMidnight);
             scope.time = <span class="hljs-string">"8:00"</span>;
             scope.meridiem = mom.format(<span class="hljs-string">'A'</span>);
	           
	            key = <span class="hljs-string">""</span> + (mom.month()) + (mom.year());
	            
	             <span class="hljs-keyword">var</span> idx = _.indexOf(_.map(scope.keys, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(k)</span> {</span>
	              <span class="hljs-keyword">return</span> k.key;
	            }), key);
	            
	            scope.setTime();
	                       
            scope.leftMonth = idx - <span class="hljs-number">3</span>;
          }
          <span class="hljs-keyword">if</span> (scope.isMulti &amp;&amp; scope.isNote) {          	
          	  scope.completeLabel = i18n.RCM_SAVE;
              scope.clearSelectedDates = i18n.oncology.calview.CLEAR_SELECTED_DATES;
              scope.headerLabel = i18n.oncology.calview.ADD_NOTE;
              scope.nameLabel = i18n.NOTE;
              scope.deleteLabel = i18n.oncology.calview.DELETE_NOTE;
            }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(scope.schedulable.schedType === <span class="hljs-string">'MedInstance'</span> || scope.schedType === <span class="hljs-string">'Medication'</span>){          
              scope.headerLabel = i18n.oncology.calview.SCHED_MEDICATION;
              scope.nameLabel = i18n.MED_NAME;
              scope.titleLabel = i18n.oncology.calview.MODAL_TITLE;
              scope.isMed = <span class="hljs-literal">true</span>;
              scope.selectDatesLabel = i18n.oncology.calview.SELECT_STOP_DATE;
              scope.completeLabel = i18n.SIGN;
              vars.todayMidnight = moment(scope.schedulable.json.START_DATE);
	        }<span class="hljs-keyword">else</span>{
            scope.headerLabel = i18n.oncology.calview.SIGN_ORDER;
            scope.nameLabel = i18n.NAME;
            scope.completeLabel = i18n.SIGN;
            scope.requestforCycleTitle =i18n.oncology.calview.SEND_REQUEST_FOR_CYCLE;
            scope.adjustAllTitle =i18n.oncology.calview.ADJUST_ALL_FUTURE_CYCLE;
            scope.requestAllTitle =i18n.oncology.calview.SEND_REQUESTS_FOR_ALL;
                        
            scope.adjustAll = <span class="hljs-literal">false</span>;
            scope.requestforCycle = <span class="hljs-literal">false</span>;
            scope.requestAll = <span class="hljs-literal">false</span>;
       
          
          }
          scope.moveForward(<span class="hljs-number">3</span>);
          scope.showDialog = <span class="hljs-literal">true</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>date selection for the potentialdates</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
				
			<span class="hljs-keyword">if</span> (!scope.isNote &amp;&amp; !scope.isMed) {
						
				scope.selections.length = <span class="hljs-number">0</span>;
				<span class="hljs-keyword">if</span>(moment(scope.unixStamp) &gt;=  vars.todayMidnight ){
				   scope.selections.push(moment(scope.unixStamp).startOf(<span class="hljs-string">'day'</span>).valueOf());
				   scope.$broadcast(<span class="hljs-string">'setDates'</span>, scope.selections, <span class="hljs-literal">false</span>);
				  }
				
				}
				
		
		  }
		  <span class="hljs-keyword">catch</span>(err)
		  {
			  alert(err.description);
		  }
        };
   
        scope.sendRequestforCycle = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
          scope.adjustAll = <span class="hljs-literal">false</span>;
          scope.requestforCycle = <span class="hljs-literal">true</span>;
          scope.requestAll = <span class="hljs-literal">false</span>;
        };
        scope.adjustAllFutureCycle = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
          scope.adjustAll = <span class="hljs-literal">true</span>;
          scope.requestforCycle = <span class="hljs-literal">false</span>;
          scope.requestAll = <span class="hljs-literal">false</span>;
        };
        scope.requestAllFutureCycle = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
          scope.adjustAll = <span class="hljs-literal">false</span>;
          scope.requestforCycle = <span class="hljs-literal">false</span>;
          scope.requestAll = <span class="hljs-literal">true</span>;
        };
        scope.toggleMeridiem = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
          <span class="hljs-keyword">var</span> idx;
          idx = _.indexOf(meridiems, scope.meridiem);
          scope.meridiem = meridiems[<span class="hljs-built_in">Math</span>.abs(idx - <span class="hljs-number">1</span>)];
        };        
       
        scope.moveForward = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(num)</span> {</span>
          move(num, <span class="hljs-literal">true</span>);
        };
        scope.moveBackward = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(num)</span> {</span>
          move(num, <span class="hljs-literal">false</span>);
        };
        scope.enableSaveButton = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
       	 <span class="hljs-keyword">if</span> (scope.selections.length === <span class="hljs-number">0</span> || scope.text.length === <span class="hljs-number">0</span>) {
            $(<span class="hljs-string">'#submitButton'</span>).attr(<span class="hljs-string">'disabled'</span>, <span class="hljs-literal">true</span>);
          }
          <span class="hljs-keyword">else</span>{
            $(<span class="hljs-string">'#submitButton'</span>).attr(<span class="hljs-string">'disabled'</span>, <span class="hljs-literal">false</span>);
          }
       	
        };
        
        scope.$watch(<span class="hljs-string">'selections'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(selections)</span> {</span>
          <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> console !== <span class="hljs-string">"undefined"</span> &amp;&amp; console !== <span class="hljs-literal">null</span> ? console.dir : <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>) {
            console.dir(selections);
          }
        scope.enableSaveButton();
         
        }, <span class="hljs-literal">true</span>);
        
        scope.$watch(<span class="hljs-string">'text'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(text)</span> {</span>          
         scope.enableSaveButton();
        }, <span class="hljs-literal">true</span>);  
        
        scope.setTime = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
        	  $(<span class="hljs-string">'#timepicker'</span>).timepicker(<span class="hljs-string">'setTime'</span>, scope.time + <span class="hljs-string">' '</span> + scope.meridiem).on(<span class="hljs-string">'changeTime.timepicker'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> {</span>
              <span class="hljs-keyword">if</span> (e.time.hours &lt; <span class="hljs-number">10</span>) {
                scope.time = <span class="hljs-string">'0'</span> + e.time.value.slice(<span class="hljs-number">0</span>, -<span class="hljs-number">3</span>);
              } <span class="hljs-keyword">else</span> {
                scope.time = e.time.value.slice(<span class="hljs-number">0</span>, -<span class="hljs-number">3</span>);
              }
              scope.meridiem = e.time.meridian;
              });
        };
        
        scope.submit = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
         <span class="hljs-keyword">var</span> dateString, instanceClone, makeDate, sameDate, sameTime, submitDate, time, timerMPage;
       	  <span class="hljs-keyword">try</span>{
		   timerMPage = MP_Util.CreateTimer(<span class="hljs-string">"USR:MPG TC SigningOrders-Notes"</span>);
			  <span class="hljs-keyword">if</span>(timerMPage){
				  timerMPage.Start();				 
			  }
		   	}
		   <span class="hljs-keyword">catch</span>(err)
		   {
			  log.info(<span class="hljs-string">'err.description'</span>);
			   <span class="hljs-keyword">if</span>(timerMPage){
				 timerMPage.Stop();
			  }
		   } 
        	
          <span class="hljs-keyword">var</span> dateString, instanceClone, makeDate, sameDate, sameTime, submitDate, time;
          makeDate = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(unixStamp, time)</span> {</span>
            <span class="hljs-keyword">var</span> asUnix, clock, hour, meridiem, minute, parts;
            meridiem = time.slice(-<span class="hljs-number">2</span>);
            clock = time.replace(meridiem, <span class="hljs-string">''</span>);
            parts = clock.split(<span class="hljs-string">':'</span>);
            minute = <span class="hljs-number">1000</span> * <span class="hljs-number">60</span>;
            hour = <span class="hljs-number">60</span> * minute;
            <span class="hljs-keyword">if</span> ((_.indexOf(meridiems, meridiem)) === <span class="hljs-number">0</span>) {
              asUnix = ((<span class="hljs-built_in">parseInt</span>(parts[<span class="hljs-number">0</span>], <span class="hljs-number">10</span>) * hour) === <span class="hljs-number">43200000</span> ? <span class="hljs-number">0</span> : <span class="hljs-built_in">parseInt</span>(parts[<span class="hljs-number">0</span>], <span class="hljs-number">10</span>) * hour) + <span class="hljs-built_in">parseInt</span>(parts[<span class="hljs-number">1</span>], <span class="hljs-number">10</span>) * minute;
            } <span class="hljs-keyword">else</span> {
              asUnix = ((<span class="hljs-built_in">parseInt</span>(parts[<span class="hljs-number">0</span>], <span class="hljs-number">10</span>) * hour) === <span class="hljs-number">43200000</span> ? <span class="hljs-number">43200000</span> : <span class="hljs-built_in">parseInt</span>(parts[<span class="hljs-number">0</span>], <span class="hljs-number">10</span>) * hour + <span class="hljs-number">12</span> * hour) + <span class="hljs-built_in">parseInt</span>(parts[<span class="hljs-number">1</span>], <span class="hljs-number">10</span>) * minute;
            }
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">parseInt</span>(unixStamp) + asUnix;
          };</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Call the sign functionality for Notes and Prescriptions below.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">if</span> (scope.isMulti || scope.schedulable.schedType === <span class="hljs-string">'MedInstance'</span> || scope.schedType === <span class="hljs-string">'Medication'</span>)  {
            scope.selections = scope.selections.sort();
            scope.selections = _.uniq(scope.selections, <span class="hljs-literal">true</span>);
            dateString = <span class="hljs-string">''</span>;
            _i = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">while</span> (_i &lt; scope.selections.length) {
            	    	   	
            	<span class="hljs-keyword">var</span> time = <span class="hljs-string">""</span> + scope.time + scope.meridiem;
	            <span class="hljs-keyword">var</span> submitDate = makeDate(scope.selections[_i], time);
				dateString = dateString.concat(moment(submitDate).format(<span class="hljs-string">'YYYY-MM-DD'</span> + <span class="hljs-string">'T'</span> + <span class="hljs-string">'HH:mm:ss'</span>), <span class="hljs-string">','</span>);
                _i++;
            }
            dateString = dateString.slice(<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Modifying a pre-existing prescription or note</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (scope.schedulable != <span class="hljs-literal">null</span>) {
              <span class="hljs-keyword">if</span> (scope.isNote === <span class="hljs-literal">false</span>) {
                notesMedsSvc.addNotesMeds(scope.schedulable.id(), scope.schedulable.calItemsId(), <span class="hljs-string">""</span> + (scope.schedulable.name()) + <span class="hljs-string">" "</span> + (scope.schedulable.sdl()), <span class="hljs-number">1</span>, dateString, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(value)</span> {</span>
                  scope.calItemsId = value;
                  <span class="hljs-keyword">if</span> (scope.calItemsId != <span class="hljs-literal">null</span>) {
                    <span class="hljs-keyword">if</span> (scope.instances != <span class="hljs-literal">null</span>) {
                      _i = <span class="hljs-number">0</span>;
                      <span class="hljs-keyword">while</span> (_i &lt; scope.instances.length) {
                        pubsub.publish(<span class="hljs-string">"DELETE_SCHEDULABLE_"</span> + (scope.instances[_i].midnight()), [scope.instances[_i].uid]);
                        _i++;
                      }

                    }
                    scope.schedulable.changeDates(dateString, scope.calItemsId);
                  }
                });
              } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (scope.text !== <span class="hljs-string">''</span>) {
                notesMedsSvc.addNotesMeds(<span class="hljs-number">0</span>, scope.schedulable.calItemsId(), scope.text, <span class="hljs-number">0</span>, dateString, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(value)</span> {</span>
                  scope.calItemsId = value;
                  <span class="hljs-keyword">if</span> (scope.calItemsId != <span class="hljs-literal">null</span>) {
                    _i = <span class="hljs-number">0</span>;
                    <span class="hljs-keyword">while</span> (_i &lt; scope.instances.length) {
                      pubsub.publish(<span class="hljs-string">"DELETE_SCHEDULABLE_"</span> + (scope.instances[_i].midnight()), [scope.instances[_i].uid]);
                      _i++;
                    }
                    scope.schedulable.changeDates(dateString, scope.calItemsId, scope.text);
                  }
                });
              } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (scope.text === <span class="hljs-string">''</span>) {
                notesMedsSvc.deleteItem(scope.schedulable.calItemsId(), <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(bool)</span> {</span>
                  <span class="hljs-keyword">if</span> (bool) {
                    _i = <span class="hljs-number">0</span>;
                    <span class="hljs-keyword">while</span> (_i &lt; scope.instances.length) {
                      pubsub.publish(<span class="hljs-string">"DELETE_SCHEDULABLE_"</span> + (scope.instances[_i].midnight()), [scope.instances[_i].uid]);
                      _i++;
                    }
                  }
                });
              }</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Creating a new note</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (scope.text !== <span class="hljs-string">''</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Retrieve dummy NoteInstance that was created in AppCtrl.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              pubsub.publish(<span class="hljs-string">"GET_SCHEDULABLE_"</span> + scope.$$childHead.dates[vars.daysRange].unixStamp, [
                scope.$$childHead.dates[vars.daysRange].notes[<span class="hljs-number">0</span>].parentUid(), <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
                  <span class="hljs-keyword">return</span> scope.schedulable = <span class="hljs-built_in">arguments</span>[<span class="hljs-number">0</span>];
                }
              ]);
              instanceClone = scope.schedulable;
              notesMedsSvc.addNotesMeds(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, scope.text, <span class="hljs-number">0</span>, dateString, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(value)</span> {</span>
                scope.calItemsId = value;
                <span class="hljs-keyword">if</span> (scope.calItemsId != <span class="hljs-literal">null</span>) {
                  instanceClone.changeDates(dateString, scope.calItemsId, scope.text);
                }
              });
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Call the sign functionality for Appointments and Orders below.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          } <span class="hljs-keyword">else</span> {
            sameDate = moment(scope.selections[<span class="hljs-number">0</span>]).isSame(scope.unixStamp, <span class="hljs-string">'day'</span>);
          
            time = <span class="hljs-string">""</span> + scope.time + scope.meridiem;
            sameTime = time === scope.originalTime;
             
            <span class="hljs-keyword">if</span> (!sameDate || !sameTime || !(scope.schedulable.json.ORDER_ID &gt; <span class="hljs-number">0.0</span>)) {
              time = <span class="hljs-string">""</span> + scope.time + scope.meridiem;
              submitDate = makeDate(scope.selections[<span class="hljs-number">0</span>], time);
              scope.$broadcast(<span class="hljs-string">'showModalStatus'</span>, scope.schedulable,submitDate);
              sign.sign(scope.schedulable, submitDate, scope.schedulable.regimenData,scope.schedulable.planData,scope.updateCycleFlag, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(value)</span> {</span>
                <span class="hljs-keyword">if</span> (value === <span class="hljs-number">1</span>) {
                  pubsub.publish(<span class="hljs-string">"DELETE_SCHEDULABLE_"</span> + (scope.schedulable.midnight()), [scope.schedulable.uid]);</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>scope.schedulable.json.EST = 1;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                  scope.schedulable.setOrderDate(submitDate);
                  <span class="hljs-keyword">if</span> (scope.schedulable.schedType === <span class="hljs-string">'Appointment'</span>) {
                    pubsub.publish(<span class="hljs-string">"ADD_APPT_"</span> + (scope.schedulable.midnight()), [scope.schedulable]);
                  } <span class="hljs-keyword">else</span> {
                    pubsub.publish(<span class="hljs-string">"ADD_ORDER_"</span> + (scope.schedulable.midnight()), [scope.schedulable]);
                  }
                                    
                  <span class="hljs-keyword">if</span>(scope.requestforCycle === <span class="hljs-literal">true</span> || scope.adjustAll === <span class="hljs-literal">true</span> || scope.requestAll === <span class="hljs-literal">true</span> )
                  {
                  	   scope.showDialog = <span class="hljs-literal">false</span>;
                  	   
                  	   <span class="hljs-keyword">var</span> requestType = <span class="hljs-number">0</span>;
                  	   <span class="hljs-keyword">if</span>(scope.requestforCycle == <span class="hljs-literal">true</span>)
                  	      requestType = <span class="hljs-number">1</span>;
                  	   <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(scope.adjustAll == <span class="hljs-literal">true</span>)
                  	      requestType = <span class="hljs-number">2</span>;
                  	   <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(scope.requestAll == <span class="hljs-literal">true</span>)
                  	      requestType = <span class="hljs-number">3</span>;
                  	   <span class="hljs-keyword">else</span>
                  	      requestType = <span class="hljs-number">0</span>;
                  	   
                  	   
                  	   scope.$broadcast(<span class="hljs-string">'signNextOrder'</span>, scope.schedulable, requestType, scope.updateCycleFlag);
                  }
                  <span class="hljs-keyword">else</span>{
                  	  scope.$broadcast(<span class="hljs-string">'hideModalStatus'</span>);
                  }
                }
              }, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>scope.$broadcast(<span class="hljs-string">'hideModalStatus'</span>);});
            }
          }
           <span class="hljs-keyword">if</span>(timerMPage){
				 timerMPage.Stop();
			  }
			  
		   
          scope.showDialog = <span class="hljs-literal">false</span>;
        };
        scope.deleteNotes = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
          <span class="hljs-keyword">if</span> (scope.schedulable != <span class="hljs-literal">null</span>) {
            notesMedsSvc.deleteItem(scope.schedulable.calItemsId(), <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(bool)</span> {</span>
              <span class="hljs-keyword">if</span> (bool) {
                _i = <span class="hljs-number">0</span>;
                <span class="hljs-keyword">while</span> (_i &lt; scope.instances.length) {
                  pubsub.publish(<span class="hljs-string">"DELETE_SCHEDULABLE_"</span> + (scope.instances[_i].midnight()), [scope.instances[_i].uid]);
                  _i++;
                }
              }
            });
            scope.showDialog = <span class="hljs-literal">false</span>;
          }
        };
       scope.ClearDateSelection = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
          scope.$broadcast(<span class="hljs-string">'setDates'</span>, scope.selections,<span class="hljs-literal">true</span>);
           scope.selections.length = <span class="hljs-number">0</span>;
        };
        deregisterFn = <span class="hljs-literal">null</span>;
        uidWatcher = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(uid, oldUid)</span> {</span>
          <span class="hljs-keyword">if</span> (uid !== oldUid) {
            <span class="hljs-keyword">if</span> (deregisterFn) {
              deregisterFn();
            }
            <span class="hljs-keyword">if</span> (uid) {
              deregisterFn = scope.$on(<span class="hljs-string">'addInstance'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ev, unixStamp)</span> {</span>
                scope.selections.push(unixStamp);
                scope.$broadcast(<span class="hljs-string">'setDates'</span>, scope.selections,<span class="hljs-literal">false</span>);
              });
            }
          }
          <span class="hljs-keyword">if</span> (uid) {
            scope.$broadcast(<span class="hljs-string">'findInstances'</span>, uid);
          }
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>scope.$watch(‘uid’, uidWatcher, true);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        scope.$on(<span class="hljs-string">'showModal'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ev, isMulti, isNote, text, unixStamp, uid, schedulable)</span> {</span>
          <span class="hljs-keyword">if</span>(vars.encntr_id  === <span class="hljs-number">0.0</span> || vars.encntr_id  === <span class="hljs-number">0</span>)
          {
          	  $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>				  
				  <span class="hljs-keyword">var</span> encError = i18n.oncology.calview.ENCOUNTER_ERROR;
          	      log.info(encError);
                  alert(encError);
                  }, <span class="hljs-number">1</span>);
          	
          	<span class="hljs-keyword">return</span>;
          }
        	
          scope.originalTime = <span class="hljs-string">''</span>;
          scope.isMulti = isMulti;
          <span class="hljs-keyword">if</span>(isNote)
          {
             scope.isDelete= (text === <span class="hljs-string">''</span>) ? <span class="hljs-literal">false</span> : <span class="hljs-literal">true</span>;
          }
          <span class="hljs-keyword">else</span>
          {
             scope.isDelete= <span class="hljs-literal">false</span>;
          }
          scope.isNote = isNote;
          scope.text = text;
          scope.unixStamp = unixStamp;
          scope.schedulable = schedulable;
          <span class="hljs-keyword">if</span> (scope.schedulable != <span class="hljs-literal">null</span>) {
          <span class="hljs-keyword">if</span> (scope.schedulable.schedType === <span class="hljs-string">'Appointment'</span> || scope.schedulable.schedType === <span class="hljs-string">'Order'</span>) {          	
          
	          <span class="hljs-keyword">if</span>( scope.schedulable.json.PROTOCAL_ORDER_ID  !== <span class="hljs-literal">undefined</span> &amp;&amp; scope.schedulable.json.PROTOCAL_ORDER_ID !=  <span class="hljs-number">0.0</span> )
	          {
	          	  $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>				  
					  <span class="hljs-keyword">var</span> encError = i18n.oncology.calview.PROTOCAL_ORDERS_ERROR;
	          	      log.info(encError);
	                  alert(encError);
	                  }, <span class="hljs-number">1</span>);
	          	
	          	  <span class="hljs-keyword">return</span>;   
	          	}       	
          }
          }
          scope.toSchedule = i18n.oncology.calview.TO_SCHEDULE;
          <span class="hljs-keyword">if</span> (scope.isMulti != <span class="hljs-literal">true</span> &amp;&amp; scope.isNote != <span class="hljs-literal">true</span>)
	      {
	        	 scope.selectDatesLabel = i18n.oncology.calview.SELECT_DATES;
	        	 scope.selectDatesLabel = scope.toSchedule + scope.selectDatesLabel;
	        	 scope.titleLabel = i18n.oncology.calview.MODAL_TITLE;
	      }
	      <span class="hljs-keyword">else</span>
	      {
	      	  scope.selectDatesLabel = _.str.capitalize(i18n.oncology.calview.SELECT_DATES);;
	      	  scope.titleLabel = i18n.oncology.calview.MODAL_NOTE_TITLE;
	      }
	      scope.isMed = <span class="hljs-literal">false</span>;
	      scope.selections = [];
          <span class="hljs-comment">/* In order for the calendar to be pre-populated with the existing values correctly
          we have to gather all the instances (for Notes and Prescriptions only)  */</span>
          <span class="hljs-keyword">if</span> (scope.schedulable != <span class="hljs-literal">null</span>) {
            scope.schedType = scope.schedulable.schedType;
            <span class="hljs-keyword">if</span> (scope.schedType === <span class="hljs-string">'MedInstance'</span> || scope.schedType === <span class="hljs-string">'NoteInstance'</span> || scope.schedType === <span class="hljs-string">'Medication'</span> &amp;&amp; scope.schedulable.allDates() !== <span class="hljs-string">''</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Check to see if there is more than one date or instance, otherwise split() throws an exception and execution halts.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              <span class="hljs-keyword">if</span> (scope.schedulable.allDates().indexOf(<span class="hljs-string">','</span>) === -<span class="hljs-number">1</span>) {
                scope.selections[<span class="hljs-number">0</span>] = scope.schedulable.allDates();
              } <span class="hljs-keyword">else</span> {
                scope.selections = scope.schedulable.allDates().split(<span class="hljs-string">','</span>);
              }
              _i = <span class="hljs-number">0</span>;
              <span class="hljs-keyword">while</span> (_i &lt; scope.selections.length) {
                scope.selections[_i] = moment(scope.selections[_i]).startOf(<span class="hljs-string">'day'</span>).valueOf();
                _i++;
              }
              scope.instances = [];
              <span class="hljs-comment">/* instanceHolder variable is needed because if the schedulable is inserted directly into the scope.instances array
              then the array positions skip numbers, causing exceptions later.  */</span>
              scope.instanceHolder = <span class="hljs-string">''</span>;
              scope.selections = _.uniq(scope.selections);
              _i = <span class="hljs-number">0</span>;
              <span class="hljs-keyword">while</span> (_i &lt; scope.selections.length) {
                pubsub.publish(<span class="hljs-string">"GET_SCHEDULABLE_"</span> + scope.selections[_i], [
                  (scope.schedType === <span class="hljs-string">'Medication'</span> ? scope.schedulable.uid : scope.schedulable.parentUid()), <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
                    <span class="hljs-keyword">return</span> scope.instanceHolder = <span class="hljs-built_in">arguments</span>[<span class="hljs-number">0</span>];
                  }
                ]);
                scope.instances[_i] = scope.instanceHolder;
                _i++;
              }
            }
          }
          <span class="hljs-keyword">if</span> (scope.uid === uid) {
            uidWatcher(uid, scope.uid);
          }
          scope.uid = uid;
          init();
          <span class="hljs-keyword">return</span> deregisterFn = <span class="hljs-literal">null</span>;
        });
        scope.$on(<span class="hljs-string">'getDates'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ev, cb)</span> {</span>
          cb(scope.selections);
        });
        scope.$on(<span class="hljs-string">'dateChange'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ev, newUnixStamp, isSelected, cb, cb2)</span> {</span>
          <span class="hljs-keyword">if</span> (!isSelected) {
            <span class="hljs-keyword">if</span> (!scope.isNote) {
              cb2(scope.selections, <span class="hljs-literal">true</span>);
              scope.selections.length = <span class="hljs-number">0</span>;
              scope.selections.push(newUnixStamp);
              cb2(scope.selections, <span class="hljs-literal">false</span>);
            }
            <span class="hljs-keyword">if</span> (scope.selections.length === <span class="hljs-number">0</span> || scope.isMulti) {
              scope.selections.push(newUnixStamp);
              scope.selections = _.sortBy(scope.selections, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(s)</span> {</span>
                <span class="hljs-keyword">return</span> s;
              });
              cb(<span class="hljs-literal">true</span>);
            } <span class="hljs-keyword">else</span> {
              cb(<span class="hljs-literal">false</span>);
            }
          } <span class="hljs-keyword">else</span> {
            scope.selections = _.without(scope.selections, newUnixStamp);
            cb(<span class="hljs-literal">true</span>);
          }
        });
        watchers = <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;
        scope.$on(<span class="hljs-string">'suspendWatchers'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
          watchers = scope.$$watchers;
          scope.$$watchers = [];
        });
        scope.$on(<span class="hljs-string">"resumeWatchers"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
          <span class="hljs-keyword">if</span> (watchers) {
            scope.$$watchers = watchers;
          }
          watchers = <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;
        });
      }
    };
  }
]);</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
