<!DOCTYPE html>

<html>
<head>
  <title>appmod.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="Gruntfile.html">
                Gruntfile.js
              </a>
            
              
              <a class="source" href="server.html">
                server.js
              </a>
            
              
              <a class="source" href="accordionctrl.html">
                accordionctrl.js
              </a>
            
              
              <a class="source" href="appctrl.html">
                appctrl.js
              </a>
            
              
              <a class="source" href="calendarctrl.html">
                calendarctrl.js
              </a>
            
              
              <a class="source" href="calendarnotesctrl.html">
                calendarnotesctrl.js
              </a>
            
              
              <a class="source" href="listctrl.html">
                listctrl.js
              </a>
            
              
              <a class="source" href="accordionapptdir.html">
                accordionapptdir.js
              </a>
            
              
              <a class="source" href="accordiondir.html">
                accordiondir.js
              </a>
            
              
              <a class="source" href="accordionmeddir.html">
                accordionmeddir.js
              </a>
            
              
              <a class="source" href="accordionorderdir.html">
                accordionorderdir.js
              </a>
            
              
              <a class="source" href="accordionphasedir.html">
                accordionphasedir.js
              </a>
            
              
              <a class="source" href="accordionplandir.html">
                accordionplandir.js
              </a>
            
              
              <a class="source" href="accordionregimendir.html">
                accordionregimendir.js
              </a>
            
              
              <a class="source" href="adddialogdir.html">
                adddialogdir.js
              </a>
            
              
              <a class="source" href="calendarcontrolsdir.html">
                calendarcontrolsdir.js
              </a>
            
              
              <a class="source" href="calendardatedir.html">
                calendardatedir.js
              </a>
            
              
              <a class="source" href="calendardaydir.html">
                calendardaydir.js
              </a>
            
              
              <a class="source" href="calendardir.html">
                calendardir.js
              </a>
            
              
              <a class="source" href="calendarlistdir.html">
                calendarlistdir.js
              </a>
            
              
              <a class="source" href="hoverhighlightdir.html">
                hoverhighlightdir.js
              </a>
            
              
              <a class="source" href="jquerydatepicker.html">
                jquerydatepicker.js
              </a>
            
              
              <a class="source" href="listdatedir.html">
                listdatedir.js
              </a>
            
              
              <a class="source" href="modalcalendardir.html">
                modalcalendardir.js
              </a>
            
              
              <a class="source" href="noteinputdir.html">
                noteinputdir.js
              </a>
            
              
              <a class="source" href="printcalendardatedir.html">
                printcalendardatedir.js
              </a>
            
              
              <a class="source" href="printcalendardaydir.html">
                printcalendardaydir.js
              </a>
            
              
              <a class="source" href="printcalendarviewdir.html">
                printcalendarviewdir.js
              </a>
            
              
              <a class="source" href="printdialogdir.html">
                printdialogdir.js
              </a>
            
              
              <a class="source" href="printlistviewdir.html">
                printlistviewdir.js
              </a>
            
              
              <a class="source" href="printtemplate.html">
                printtemplate.js
              </a>
            
              
              <a class="source" href="qtipdir.html">
                qtipdir.js
              </a>
            
              
              <a class="source" href="schedulableicondir.html">
                schedulableicondir.js
              </a>
            
              
              <a class="source" href="statusdialogdir.html">
                statusdialogdir.js
              </a>
            
              
              <a class="source" href="windowresizedir.html">
                windowresizedir.js
              </a>
            
              
              <a class="source" href="cal-view_i18n.html">
                cal-view_i18n.js
              </a>
            
              
              <a class="source" href="cal-view_i18n.html">
                cal-view_i18n.js
              </a>
            
              
              <a class="source" href="cal-view_i18n.html">
                cal-view_i18n.js
              </a>
            
              
              <a class="source" href="cal-view_i18n.html">
                cal-view_i18n.js
              </a>
            
              
              <a class="source" href="cal-view_i18n.html">
                cal-view_i18n.js
              </a>
            
              
              <a class="source" href="cal-view_i18n.html">
                cal-view_i18n.js
              </a>
            
              
              <a class="source" href="cal-view_i18n.html">
                cal-view_i18n.js
              </a>
            
              
              <a class="source" href="blackbird.html">
                blackbird.js
              </a>
            
              
              <a class="source" href="dc_mp_js_util_mpage.html">
                dc_mp_js_util_mpage.js
              </a>
            
              
              <a class="source" href="oncmp_core.html">
                oncmp_core.js
              </a>
            
              
              <a class="source" href="printerConfig_template.html">
                printerConfig_template.js
              </a>
            
              
              <a class="source" href="xml2json.html">
                xml2json.js
              </a>
            
              
              <a class="source" href="animationsmod.html">
                animationsmod.js
              </a>
            
              
              <a class="source" href="appmod.html">
                appmod.js
              </a>
            
              
              <a class="source" href="controllersmod.html">
                controllersmod.js
              </a>
            
              
              <a class="source" href="directivesmod.html">
                directivesmod.js
              </a>
            
              
              <a class="source" href="daodevsvc.html">
                daodevsvc.js
              </a>
            
              
              <a class="source" href="daoprodsvc.html">
                daoprodsvc.js
              </a>
            
              
              <a class="source" href="notesmedssvc.html">
                notesmedssvc.js
              </a>
            
              
              <a class="source" href="notesmedssvcdev.html">
                notesmedssvcdev.js
              </a>
            
              
              <a class="source" href="pubsubsvc.html">
                pubsubsvc.js
              </a>
            
              
              <a class="source" href="services.html">
                services.js
              </a>
            
              
              <a class="source" href="signdevsvc.html">
                signdevsvc.js
              </a>
            
              
              <a class="source" href="signprodsvc.html">
                signprodsvc.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>appmod.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/*&lt;a name="vars"&gt;&lt;/a&gt;
this is an unfortunate hack. this data must be loaded prior to the application's
running in angular because localization must be set before load. traditionally,
that would be handled by the webserver/browser meta handshake but this app
does not run on a web server in the wild. so it can't be an angular service
(which would be the best compromise). when the app wires, it must already
know its language. the other variables are because orders signing APIs do
not interpolate traditional mpage variables (e.g. $USR_Personid$) so we retrieve
them via ajax call on load.  */</span>
window.vars = {
  encntr_id: <span class="hljs-number">0.0</span>,
  person_id: <span class="hljs-number">0.0</span>,
  position_cd: <span class="hljs-number">0.0</span>,
  ppr_cd: <span class="hljs-number">0.0</span>,
  prsnl_id: <span class="hljs-number">0.0</span>,
  location_cd: <span class="hljs-number">0.0</span>,
  locale: <span class="hljs-string">''</span>,
  todayMidnight: <span class="hljs-number">0</span>,
  sundayMidnight: <span class="hljs-number">0</span>,
  staticContentLocation: <span class="hljs-string">''</span>,
  facilityName:<span class="hljs-string">''</span>,
  patientName:<span class="hljs-string">''</span>,
  patientDOB:<span class="hljs-string">''</span>,
  XMLLocation:<span class="hljs-string">''</span>,
  showRequestAll:<span class="hljs-literal">true</span>,
  showAccord: <span class="hljs-literal">true</span>,
  showList: <span class="hljs-literal">true</span>,
  showEst: <span class="hljs-literal">true</span>,
  showSched: <span class="hljs-literal">true</span>,
  showAppts: <span class="hljs-literal">true</span>,
  showChemo: <span class="hljs-literal">true</span>,
  showMeds: <span class="hljs-literal">true</span>,
  showNotes: <span class="hljs-literal">true</span>,
  showNothing: <span class="hljs-number">0</span>,
  daysRange: <span class="hljs-number">399</span>,
  prefContext:<span class="hljs-string">''</span>,
  prefSeq:<span class="hljs-number">0</span>
};

angular.module(<span class="hljs-string">'calview'</span>, [<span class="hljs-string">'calview.controllers'</span>]);

<span class="hljs-comment">/*using angular $injector service, we make the call to onc_mp_vars to get and only
on successfully setting i18n do we bootstrap the app.  */</span>
angular.injector([<span class="hljs-string">'calview'</span>]).get(<span class="hljs-string">'dao'</span>).call({
  error: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data, status, headers, config)</span> {</span>
    log.error(<span class="hljs-string">"status: "</span> + status + <span class="hljs-string">"\n"</span>);
    log.error(<span class="hljs-string">"data: "</span> + data + <span class="hljs-string">"\n\n"</span>);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>load up all context variables</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  params: <span class="hljs-string">"'MINE',$PAT_PersonId$,$VIS_EncntrId$,'$APP_AppName$','cer_install:',$PAT_PPRCode$,0,''"</span>,
  success: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data, status, headers, config)</span> {</span>
    <span class="hljs-keyword">var</span> json, mp_i18n, onc_i18n;
    log.debug(<span class="hljs-string">"status: "</span> + status + <span class="hljs-string">"\n"</span>);
    log.debug(<span class="hljs-string">"data: "</span> + (<span class="hljs-built_in">JSON</span>.stringify(data[<span class="hljs-number">0</span>])) + <span class="hljs-string">"\n\n"</span>);
    json = data[<span class="hljs-number">0</span>].RECORD_DATA;
    
	<span class="hljs-keyword">var</span> js_criterion = <span class="hljs-built_in">JSON</span>.stringify(data[<span class="hljs-number">0</span>]);
	js_criterion = js_criterion.replace(<span class="hljs-string">"RECORD_DATA"</span>, <span class="hljs-string">"CRITERION"</span>);
	js_criterion = <span class="hljs-built_in">JSON</span>.parse(js_criterion);
	<span class="hljs-keyword">var</span> timerMPage;
   	<span class="hljs-keyword">try</span>{
		   <span class="hljs-keyword">var</span> criterion = MP_Util.GetCriterion(js_criterion, json.STATIC_CONTENT);
		     timerMPage = MP_Util.CreateTimer(<span class="hljs-string">"CAP:MPG Launch Oncology Treatment Calendar"</span>);
		  
		    <span class="hljs-keyword">if</span> (timerMPage){
		       	timerMPage.Start();
		       
			}
	   }
	   <span class="hljs-keyword">catch</span>(err)
		{
		  log.info(<span class="hljs-string">'err.description'</span>);
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>and now they are real numbers which we set on the vars object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    vars.encntr_id = json.ENCNTRS[<span class="hljs-number">0</span>].ENCNTR_ID;
    vars.person_id = json.PERSON_ID;
    vars.position_cd = json.POSITION_CD;
    vars.ppr_cd = json.PPR_CD;
    vars.prsnl_id = json.PRSNL_ID;
    
    <span class="hljs-keyword">if</span>(json.STATIC_CONTENT != <span class="hljs-string">""</span>){
    vars.staticContentLocation = json.STATIC_CONTENT + <span class="hljs-string">"onc_treatment_calendar\\"</span>;
    }
    vars.XMLLocation = json.STATIC_CONTENT + <span class="hljs-string">"TC_CustomPrintTemplates\\"</span>;
    vars.prsnlName = json.PRSNL_NAME;
    vars.facilityName = json.FACILITY_LOC_NAME;
    vars.patientName = _.str.capitalize(json.PATIENT_INFO.NAME);
    vars.patientDOB = json.PATIENT_INFO.DOB;
    <span class="hljs-keyword">if</span> (vars.staticContentLocation === <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>) {
      vars.staticContentLocation = document.URL.slice(<span class="hljs-number">0</span>, -<span class="hljs-number">16</span>);
      log.info(<span class="hljs-string">'document.URL: '</span> + vars.staticContentLocation);
    } <span class="hljs-keyword">else</span> {
      log.info(<span class="hljs-string">'STATIC_CONTENT_LOCATION: '</span> + vars.staticContentLocation);
    }
    vars.locale = json.LOCALE_ID;
    vars.location_cd = json.LOCATION_CD;
    	
	
	<span class="hljs-keyword">if</span>(json.REGIMENSCHREQUEST == <span class="hljs-number">0</span>)
	   vars.showRequestAll = <span class="hljs-literal">false</span>;	
	<span class="hljs-keyword">if</span>(json.SHOWCALITEMS == <span class="hljs-number">0</span>)
	    vars.showAccord = <span class="hljs-literal">false</span>;
	<span class="hljs-keyword">if</span>(json.SHOWLISTITEMS == <span class="hljs-number">0</span>)
        vars.showList =  <span class="hljs-literal">false</span>;
	<span class="hljs-keyword">if</span>(json.SHOWEST == <span class="hljs-number">0</span>)
		vars.showEst =  <span class="hljs-literal">false</span>;
	<span class="hljs-keyword">if</span>(json.SHOWSCHED == <span class="hljs-number">0</span>)
		vars.showSched =  <span class="hljs-literal">false</span>;
	<span class="hljs-keyword">if</span>(json.SHOWAPPTS == <span class="hljs-number">0</span>)
		vars.showAppts =  <span class="hljs-literal">false</span>;
	<span class="hljs-keyword">if</span>(json.SHOWREGAPPTS == <span class="hljs-number">0</span>)
		vars.showChemo = <span class="hljs-literal">false</span>;
	<span class="hljs-keyword">if</span>(json.SHOWMEDS == <span class="hljs-number">0</span>)
		vars.showMeds =  <span class="hljs-literal">false</span>;
	<span class="hljs-keyword">if</span>(json.SHOWNOTES == <span class="hljs-number">0</span>)
		vars.showNotes =  <span class="hljs-literal">false</span>;
	<span class="hljs-keyword">if</span>(json.CALENDARYEARS &gt;= <span class="hljs-number">1</span> &amp;&amp; json.CALENDARYEARS &lt; <span class="hljs-number">6</span> )
       vars.daysRange =  (json.CALENDARYEARS * <span class="hljs-number">365</span> ) + <span class="hljs-number">60</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>vars.locale = “pt_BR”;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-comment">/* and locale files are looked up and loaded, in most simplest terms, with
    jquery's _getScript_ + window.eval (yuck).  */</span>
    onc_i18n = <span class="hljs-string">"../i18n/"</span> + (vars.locale === <span class="hljs-string">'en_US'</span> ? <span class="hljs-string">''</span> : vars.locale.toLowerCase()) + <span class="hljs-string">"/cal-view_i18n.js"</span>;
    mp_i18n = <span class="hljs-string">"../i18n/"</span> + (vars.locale === <span class="hljs-string">'en_US'</span> ? <span class="hljs-string">''</span> : vars.locale.toLowerCase()) + <span class="hljs-string">"/mp-core_i18n.js"</span>;
    log.info(<span class="hljs-string">'I18n files:'</span> + onc_i18n);
    log.info(<span class="hljs-string">'I18n files:'</span> + mp_i18n);</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Convert local to lowercase and then set language</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> criterionLocale = vars.locale.toLowerCase();
		criterionLocale = {
			<span class="hljs-string">"en_us"</span>: <span class="hljs-string">"en"</span>,
			<span class="hljs-string">"es"</span>: <span class="hljs-string">"es"</span>,
			<span class="hljs-string">"de"</span>: <span class="hljs-string">"de"</span>,
			<span class="hljs-string">"fr"</span>: <span class="hljs-string">"fr"</span>,
			<span class="hljs-string">"en_gb"</span>: <span class="hljs-string">"en-gb"</span>,
			<span class="hljs-string">"pt_br"</span>: <span class="hljs-string">"pt-br"</span>,
			<span class="hljs-string">"en_au"</span>: <span class="hljs-string">"en-au"</span>
		}[criterionLocale] || <span class="hljs-string">"en"</span>;
		
    moment.lang(criterionLocale); <span class="hljs-comment">// setting locale name to moment.js for correct date format.</span>
        
	<span class="hljs-keyword">try</span> {
		getScript = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(src, cb)</span> {</span>
        <span class="hljs-keyword">var</span> main, script;
        script = document.createElement(<span class="hljs-string">'script'</span>);
        script.type = <span class="hljs-string">'text/javascript'</span>;
        <span class="hljs-keyword">if</span> (script.readyState) {
            script.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                <span class="hljs-keyword">if</span> (script.readyState === <span class="hljs-string">'loaded'</span> || script.readyState === <span class="hljs-string">'complete'</span>) {
                    script.onreadystatechange = <span class="hljs-literal">null</span>;
                    cb();
                }
            };
        } <span class="hljs-keyword">else</span> {
            script.onload = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                cb();
            };
        }
        script.src = src;
        main = document.getElementsByTagName(<span class="hljs-string">'script'</span>)[<span class="hljs-number">0</span>];
        main.parentNode.insertBefore(script, main);
    };

        
        getScript(onc_i18n, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            log.debug(onc_i18n);
            getScript(mp_i18n, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                log.debug(mp_i18n);
               angular.bootstrap(document, [<span class="hljs-string">'calview'</span>]);
            });
        });
         <span class="hljs-keyword">if</span> (timerMPage)
             timerMPage.Stop();
	}
	<span class="hljs-keyword">catch</span>(err)
	{
	  alert(err.description);
	  log.info(<span class="hljs-string">'Exception to load I18n files'</span>);
	  
	   <span class="hljs-keyword">if</span> (timerMPage)
	       timerMPage.Stop();
	}
   
  },
  url: <span class="hljs-string">'onc_mp_vars'</span>
});</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
