<!DOCTYPE html>

<html>
<head>
  <title>appctrl.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="Gruntfile.html">
                Gruntfile.js
              </a>
            
              
              <a class="source" href="server.html">
                server.js
              </a>
            
              
              <a class="source" href="accordionctrl.html">
                accordionctrl.js
              </a>
            
              
              <a class="source" href="appctrl.html">
                appctrl.js
              </a>
            
              
              <a class="source" href="calendarctrl.html">
                calendarctrl.js
              </a>
            
              
              <a class="source" href="calendarnotesctrl.html">
                calendarnotesctrl.js
              </a>
            
              
              <a class="source" href="listctrl.html">
                listctrl.js
              </a>
            
              
              <a class="source" href="accordionapptdir.html">
                accordionapptdir.js
              </a>
            
              
              <a class="source" href="accordiondir.html">
                accordiondir.js
              </a>
            
              
              <a class="source" href="accordionmeddir.html">
                accordionmeddir.js
              </a>
            
              
              <a class="source" href="accordionorderdir.html">
                accordionorderdir.js
              </a>
            
              
              <a class="source" href="accordionphasedir.html">
                accordionphasedir.js
              </a>
            
              
              <a class="source" href="accordionplandir.html">
                accordionplandir.js
              </a>
            
              
              <a class="source" href="accordionregimendir.html">
                accordionregimendir.js
              </a>
            
              
              <a class="source" href="adddialogdir.html">
                adddialogdir.js
              </a>
            
              
              <a class="source" href="calendarcontrolsdir.html">
                calendarcontrolsdir.js
              </a>
            
              
              <a class="source" href="calendardatedir.html">
                calendardatedir.js
              </a>
            
              
              <a class="source" href="calendardaydir.html">
                calendardaydir.js
              </a>
            
              
              <a class="source" href="calendardir.html">
                calendardir.js
              </a>
            
              
              <a class="source" href="calendarlistdir.html">
                calendarlistdir.js
              </a>
            
              
              <a class="source" href="hoverhighlightdir.html">
                hoverhighlightdir.js
              </a>
            
              
              <a class="source" href="jquerydatepicker.html">
                jquerydatepicker.js
              </a>
            
              
              <a class="source" href="listdatedir.html">
                listdatedir.js
              </a>
            
              
              <a class="source" href="modalcalendardir.html">
                modalcalendardir.js
              </a>
            
              
              <a class="source" href="noteinputdir.html">
                noteinputdir.js
              </a>
            
              
              <a class="source" href="printcalendardatedir.html">
                printcalendardatedir.js
              </a>
            
              
              <a class="source" href="printcalendardaydir.html">
                printcalendardaydir.js
              </a>
            
              
              <a class="source" href="printcalendarviewdir.html">
                printcalendarviewdir.js
              </a>
            
              
              <a class="source" href="printdialogdir.html">
                printdialogdir.js
              </a>
            
              
              <a class="source" href="printlistviewdir.html">
                printlistviewdir.js
              </a>
            
              
              <a class="source" href="printtemplate.html">
                printtemplate.js
              </a>
            
              
              <a class="source" href="qtipdir.html">
                qtipdir.js
              </a>
            
              
              <a class="source" href="schedulableicondir.html">
                schedulableicondir.js
              </a>
            
              
              <a class="source" href="statusdialogdir.html">
                statusdialogdir.js
              </a>
            
              
              <a class="source" href="windowresizedir.html">
                windowresizedir.js
              </a>
            
              
              <a class="source" href="cal-view_i18n.html">
                cal-view_i18n.js
              </a>
            
              
              <a class="source" href="cal-view_i18n.html">
                cal-view_i18n.js
              </a>
            
              
              <a class="source" href="cal-view_i18n.html">
                cal-view_i18n.js
              </a>
            
              
              <a class="source" href="cal-view_i18n.html">
                cal-view_i18n.js
              </a>
            
              
              <a class="source" href="cal-view_i18n.html">
                cal-view_i18n.js
              </a>
            
              
              <a class="source" href="cal-view_i18n.html">
                cal-view_i18n.js
              </a>
            
              
              <a class="source" href="cal-view_i18n.html">
                cal-view_i18n.js
              </a>
            
              
              <a class="source" href="blackbird.html">
                blackbird.js
              </a>
            
              
              <a class="source" href="dc_mp_js_util_mpage.html">
                dc_mp_js_util_mpage.js
              </a>
            
              
              <a class="source" href="oncmp_core.html">
                oncmp_core.js
              </a>
            
              
              <a class="source" href="printerConfig_template.html">
                printerConfig_template.js
              </a>
            
              
              <a class="source" href="xml2json.html">
                xml2json.js
              </a>
            
              
              <a class="source" href="animationsmod.html">
                animationsmod.js
              </a>
            
              
              <a class="source" href="appmod.html">
                appmod.js
              </a>
            
              
              <a class="source" href="controllersmod.html">
                controllersmod.js
              </a>
            
              
              <a class="source" href="directivesmod.html">
                directivesmod.js
              </a>
            
              
              <a class="source" href="daodevsvc.html">
                daodevsvc.js
              </a>
            
              
              <a class="source" href="daoprodsvc.html">
                daoprodsvc.js
              </a>
            
              
              <a class="source" href="notesmedssvc.html">
                notesmedssvc.js
              </a>
            
              
              <a class="source" href="notesmedssvcdev.html">
                notesmedssvcdev.js
              </a>
            
              
              <a class="source" href="pubsubsvc.html">
                pubsubsvc.js
              </a>
            
              
              <a class="source" href="services.html">
                services.js
              </a>
            
              
              <a class="source" href="signdevsvc.html">
                signdevsvc.js
              </a>
            
              
              <a class="source" href="signprodsvc.html">
                signprodsvc.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>appctrl.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>This module provides the controller for the Accordion sections. 
This will call appointments , notes and prescriptions ccl script and holds the data in different objects.
This controller will hold all the Treamtent Calendar Data in session.</p>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>log browser info and filepath url</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>log.info(<span class="hljs-string">""</span> + navigator.appName);

log.info(<span class="hljs-string">""</span> + navigator.userAgent);

log.info(<span class="hljs-string">""</span> + document.URL);

log.info(<span class="hljs-string">'IE Version: '</span> + (<span class="hljs-string">""</span> + document.documentMode));
<span class="hljs-comment">/* the base/parent/alpha controller for the app. contains the core objects:
appointment, order, phase, plan, dates and so on..., that child controllers
and all directives reference for their logic and presentation. this is the
most essential construct of the app. */</span>
angular.module(<span class="hljs-string">'calview.controllers'</span>).controller(<span class="hljs-string">'AppCtrl'</span>, [
  <span class="hljs-string">'$rootScope'</span>, <span class="hljs-string">'$scope'</span>, <span class="hljs-string">'pubsub'</span>, <span class="hljs-string">'dao'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($rootScope, $scope, pubsub, dao)</span> {</span>
    <span class="hljs-keyword">var</span> Appointment, Date_, MedInstance, Medication, Note, NoteInstance, Order, Phase, Plan, Regimen, dummyNote, e, earliestDate, getCalItemsData, getNotes, getPrescriptions, i, lastDate, saveCheckedStatus, startTime, sundayMidnight, todayMidnight, _i;
    <span class="hljs-comment">/* there are two "views" of the data in treatment calendar.
    1. _object-based_: this is how the data comes from the data source. hierarchical
    in a medical sense. the [accordion](./accordionctrl.html) views this way.
    1. _time-based_: functionally data is spread over a year. both the
    [list](./listctrl.html) and the [calendar](./calendarctrl.html) view this way.
    first declared are all the classes that make up the model of the app. after,
    the $scope-related logic.

    represents any medical appointment not associated with a plan or regimen.
    &lt;a name="appointment"&gt;&lt;/a&gt; */</span>
    Appointment = (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Appointment</span><span class="hljs-params">(json)</span> {</span>
        <span class="hljs-comment">/* &lt;a name="fields"&gt;&lt;/a&gt;
        besides the raw json from the data source, also creates these fields
       (common with most other classes herein):
        - **uid**: establish identity for [rescheduling](./adddialogdir.html)
        - **visible**: tracks when visibility state [changes](./displayfiltersdir.html)
        - **imgUrl**: icon used in the "time" view
        - **isMulti**: establish cardinality during [rescheduling](./adddialogdir.html) */</span>
        <span class="hljs-keyword">this</span>.json = json;
        <span class="hljs-keyword">this</span>.uid = _.uniqueId();
        <span class="hljs-keyword">this</span>.schedType = <span class="hljs-string">'Appointment'</span>;
        <span class="hljs-keyword">this</span>.visible = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.showEst = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">this</span>.showSched = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">this</span>.showAppts = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.imgUrl = vars.staticContentLocation + <span class="hljs-string">'/img/4974_16.png'</span>;
        <span class="hljs-keyword">this</span>.isMulti = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">this</span>.isNote = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">this</span>.img = <span class="hljs-string">"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAB2ElEQVQ4EXWSOUteURCG73FD45KI+wIGU4gbRFFiI4KFhSlstBL/iIVYxtbf4A9QUMuAiAgWIWkEcYU0GkFcEFHRL8/zee7HbRx4mPfMmTPnzNyb5HK5RLDFJIRD/G/4CnNwEJnFD8Afco7wC5lzSTWBCTY28LUwBSuwBj3QG7Wx71BL7jp+HKog2SNwD5vxJUPoG+LHMcGkE2JX+P58jpd5Jkl2SxDDCK3kzSUBXxbJ95ZZF8WcUvwHzo6kh4wPhxB+4L9AObTDEliwDbR5ck4zl7IZglP8yeYqeLADLuEfOANtH5qgGRziI8xwdpT6FOCmzFSddkucRx+6L2pf9C2Tt+zZtIUKnubXsJhf4pn1XdTkBQdZ5zpq26qAwuB83iC8QBe4/gjdoL3CZ6gHCzvEBigU+MvTtgxwwzPugvUZ+sEY+hf6HNmK3jHGekaftvCJgNPX7LWctZ9MbfI1zuE2ojsNgS8sFLDHVnAGPrMYbCf/TLx7jeCe2gKVUChwxtO2DXCDPdrCOdq/zxb20f4Lbeg9Y6yn9WkL1QScsuYAi1g7C7XJF7gWsIU0z1fnf6RbrvDX9WbNCTt1W1BrFrMteQKthsoP9jIGk5AmOwfNvfe0+xZd/w9tLJFutoCYoQAAAABJRU5ErkJggg=="</span>;
        
        <span class="hljs-comment">/* this and the other classes watch these $scope fields (defined lower down)
        [for change](./displayfiltersdir.html) and set their visibility state
        accordingly. each major section (accordion, list, calendar) then watches
        and honors the state change on an object-by-object basis.
        &lt;a name="watch"&gt;&lt;/a&gt;  */</span>
        $scope.$watch(<span class="hljs-string">'showEst'</span>, (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_this)</span> {</span>
          <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(showEst)</span> {</span>
            <span class="hljs-keyword">if</span> (_this.json.EST &amp;&amp; _this.showAppts) {
           _this.visible = showEst;
           }
           _this.showEst = showEst;

          };
        })(<span class="hljs-keyword">this</span>));
        $scope.$watch(<span class="hljs-string">'showSched'</span>, (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_this)</span> {</span>
          <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(showSched)</span> {</span>
           <span class="hljs-keyword">if</span> (!_this.json.EST &amp;&amp; _this.showAppts) {
             _this.visible = showSched;
             }
             _this.showSched = showSched;

          };
        })(<span class="hljs-keyword">this</span>));
        $scope.$watch(<span class="hljs-string">'showAppts'</span>, (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_this)</span> {</span>
          <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(showAppts)</span> {</span>
          	<span class="hljs-keyword">if</span> (_this.json.EST &amp;&amp;  _this.showEst ){
          	     _this.visible = showAppts;
         	   }
          	
          	<span class="hljs-keyword">if</span>( _this.showSched  &amp;&amp; !_this.json.EST  ){
            	_this.visible = showAppts;
          	   }
          	   _this.showAppts = showAppts;
          	
         };
        })(<span class="hljs-keyword">this</span>));
        <span class="hljs-comment">/* **important**: the bridge between the object- and time-views, using the
        [pub/sub service](./pubsubsvc.html) (now **DEPRECATED**). after object
        creation, the instance publishes itself (note the `@` as arg) by the
        midnight of its date, to which the appropriate `Date_` subscribes and
        picks up (see below). this is how all objects communicate with the
        "time world." TODO: refactor this eventing using traditional angular
        messaging, i.e. $broadcast.
        &lt;a name="publish"&gt;&lt;/a&gt; */</span>
        pubsub.publish(<span class="hljs-string">"ADD_APPT_"</span> + (<span class="hljs-keyword">this</span>.midnight()), [<span class="hljs-keyword">this</span>]);
      }
      <span class="hljs-comment">/* standard lookup methods, in all the classes. common because `Date_` (see
      below) abstracts the "object-world" into **orderables** for things like
      getting text displays, sorting by time, and so on.
      &lt;a name="methods"&gt;&lt;/a&gt; */</span>
      Appointment.prototype.id = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.ORDER_ID;
      };

      Appointment.prototype.uids = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> [<span class="hljs-keyword">this</span>.uid];
      };

      Appointment.prototype.name = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.ORDER_NAME;
      };

      Appointment.prototype.status = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.ORDER_STATUS;
      };

      Appointment.prototype.synonymId = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.SYNONYM_ID;
      };

      Appointment.prototype.updateCount = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.UPDT_CNT;
      };
      Appointment.prototype.setOrderDate = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(newOrderdate)</span> {</span>
        <span class="hljs-keyword">if</span> (moment(newOrderdate).isValid()) {
       	
          <span class="hljs-keyword">this</span>.json.ORDER_DATE = newOrderdate;
         
          
        } 
      };

      Appointment.prototype.date = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">if</span> (moment(<span class="hljs-keyword">this</span>.json.ORDER_DATE).isValid()) {
          <span class="hljs-keyword">return</span> moment(<span class="hljs-keyword">this</span>.json.ORDER_DATE).format(<span class="hljs-string">'L'</span>);
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">return</span> <span class="hljs-string">'**/**/****'</span>;
        }
      };</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>absolute midnight for set identity and bridging time and object views.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Appointment.prototype.midnight = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">if</span> (moment(<span class="hljs-keyword">this</span>.json.ORDER_DATE).isValid()) {
          <span class="hljs-keyword">return</span> moment(<span class="hljs-keyword">this</span>.json.ORDER_DATE).startOf(<span class="hljs-string">'day'</span>).valueOf();
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;
        }
      };

      Appointment.prototype.text = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.name();
      };

      Appointment.prototype.time = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">if</span> (moment(<span class="hljs-keyword">this</span>.json.ORDER_DATE).isValid()) {
          <span class="hljs-keyword">return</span> moment(<span class="hljs-keyword">this</span>.json.ORDER_DATE).format(<span class="hljs-string">'h:mmA'</span>);
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">return</span> <span class="hljs-string">'**:**'</span>;
        }
      };

      Appointment.prototype.isEst = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.EST === <span class="hljs-number">1</span>;
      };

	  Appointment.prototype.timeZone = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.TIME_ZONE;
      };
	  
	  
      Appointment.prototype.isFrozen = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.FROZEN === <span class="hljs-number">1</span>;
      };

      Appointment.prototype.isVisible = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.visible;
      };
      <span class="hljs-comment">/* standard popup data array used in the.. [popup](./qtipdir.html). each
      class does this service for the popup directive
      &lt;a name="popup"&gt;&lt;/a&gt; */</span>
      Appointment.prototype.popupData = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> [
          {
            key: i18n.oncology.calview.TIME,
            value: <span class="hljs-keyword">this</span>.time() + <span class="hljs-string">" "</span> + <span class="hljs-keyword">this</span>.timeZone()
          }, {
            key: i18n.oncology.calview.ORDER_NAME,
            value: <span class="hljs-keyword">this</span>.name()
          }, {
            key: i18n.oncology.calview.STATUS,
            value: <span class="hljs-keyword">this</span>.status()
          }
        ];
      };

      Appointment.prototype.popupTitle = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> i18n.oncology.calview.APPOINTMENT;
      };</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>for sorting within a date</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Appointment.prototype.toUnix = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> moment(<span class="hljs-keyword">this</span>.json.ORDER_DATE).valueOf();
      };

      <span class="hljs-keyword">return</span> Appointment;

    })();
    <span class="hljs-comment">/* an instance of a medication, as meds, along with notes, can have multiple
    instances of itself spanning several dates. */</span>
    MedInstance = (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">MedInstance</span><span class="hljs-params">(json)</span> {</span>
        <span class="hljs-comment">/* takes a subsection of its parent med's json and adds the relevant,
        individual fields, and publishes itself as seen (and documented) in
        [appts](#fields) */</span>
        <span class="hljs-keyword">this</span>.json = json;
        <span class="hljs-keyword">this</span>.uid = _.uniqueId();
        <span class="hljs-keyword">this</span>.schedType = <span class="hljs-string">'MedInstance'</span>;
        <span class="hljs-keyword">this</span>.imgUrl = vars.staticContentLocation + <span class="hljs-string">'/img/4924_16.png'</span>;
        <span class="hljs-keyword">this</span>.visible = <span class="hljs-keyword">this</span>.isChecked() === <span class="hljs-number">1</span> ? <span class="hljs-literal">false</span> : <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.isMulti = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.isNote = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">this</span>.img = <span class="hljs-string">"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAACg0lEQVQ4EWP4//8/AxQzxsbGKrq7uz+SlJb+b2RsfGP69OmGSPIwdSg0nOPk5CRvaGh439fXd2VgYOAHFja2/zq6uu/6u7td8BnCxAABrMLCwrXCIiLnnj9/rrBz1y7uv3/+MNy+fVtw14ED6UAljFB1GBTYgMTERO7v37/7KMjLM1+9dk3p27dvLIyMjAx///5leHDvHhdQFwuGTqgA2IAPHz4w/Gdg+M3GxibDwsLCBtJMLIB5Aab+H5ABNIt4gOI0YGAx/fv3j+n/v39wU0Am4gNwA4DOZgKC16IiIqK8PDxMDEBvAA1jZ2OBK2EHGvQLiFFcCJdlZWFhfffu3ebW1tao+/fvc7Gzs/9++/p1zoVLl/Rmz57tcvDgwdy///8f9PLwWA5ML49grgIb8AHIE4QE3K+oqKj3QC4IM3R3d19lZWVVuXTpUtTmzZs9gS70fPHiRTgwdrwSEhJegNSgBCIwDFCCH6iQhfH/f1ZObu5j/Pz8/0GxdfTwYcNNW7fGA/WCLUcxAGQiMgCGC9BIRtaujo61AQEBU+Xl5N7+/v2b4fmTJ1kVFRXcILVwA5gYGVl+/fqFEkAgeWBA/iwuLq49e+6cW2JS0kxZWdkzf/7+5br58iXYtWADpra2fmNjZ9/25MkTVSQXMD589MiBh4fnB1Cc++LFi2pz587NMTYxue1gbx9uoKDwBaQW7A8tLa1fHz98qGZlYztkbW39LTIm5tTJY8dMPn365Ghubt6+fMWKfGDyZgC6kO/9hw/y0dnZ54AG/AEZAPQk3NWMwJBVevHy5fEbt24JysrIvPR0d/fT0NB4u3r16r1fvn4VFhEWzjMxMdmWnZ39FqQZBACuvzdOWNLuDAAAAABJRU5ErkJggg=="</span>;
            
        pubsub.publish(<span class="hljs-string">"ADD_MEDINSTANCE_"</span> + (<span class="hljs-keyword">this</span>.midnight()), [<span class="hljs-keyword">this</span>]);
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>standard lookups, blah blah blah, as in <a href="#methods">appts</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      MedInstance.prototype.id = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.ID;
      };

      MedInstance.prototype.uids = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> [<span class="hljs-keyword">this</span>.uid];
      };

      MedInstance.prototype.name = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.NAME;
      };

      MedInstance.prototype.dose = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.DOSE;
      };
            
      MedInstance.prototype.sdl = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.SDL;
      };

      MedInstance.prototype.encounter = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.ENCNTR_ID;
      };

      MedInstance.prototype.calItemsId = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.ONC_TC_CAL_ITEMS_ID;
      };

      MedInstance.prototype.allDates = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.ALL_DATES;
      };

      MedInstance.prototype.parentUid = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.PARENT_UID;
      };

      MedInstance.prototype.midnight = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">if</span> (moment(<span class="hljs-keyword">this</span>.json.DATE).isValid()) {
          <span class="hljs-keyword">return</span> moment(<span class="hljs-keyword">this</span>.json.DATE).startOf(<span class="hljs-string">'day'</span>).valueOf();
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;
        }
      };

      MedInstance.prototype.text = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">""</span> + (<span class="hljs-keyword">this</span>.name()) + <span class="hljs-string">", "</span> + (<span class="hljs-keyword">this</span>.sdl());
      };

      MedInstance.prototype.date = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">if</span> (moment(<span class="hljs-keyword">this</span>.json.DATE).isValid()) {
          <span class="hljs-keyword">return</span> moment(<span class="hljs-keyword">this</span>.json.DATE).format(<span class="hljs-string">'L'</span>);
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;
        }
      };

      MedInstance.prototype.time = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">if</span> (moment(<span class="hljs-keyword">this</span>.json.DATE).isValid()) {
          <span class="hljs-keyword">return</span> moment(<span class="hljs-keyword">this</span>.json.DATE).format(<span class="hljs-string">'h:mmA'</span>);
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;
        }
      };

      MedInstance.prototype.isEst = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.EST === <span class="hljs-number">1</span>;
      };

      MedInstance.prototype.oneTimeInd = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.ONE_TIME_FREQ_IND;
      };

      MedInstance.prototype.isChecked = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.CHECKED_STATUS;
      };

      MedInstance.prototype.isVisible = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.visible;
      };
	  
	  MedInstance.prototype.timeZone = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.TIME_ZONE;
      };</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>popup data, as in <a href="#popup">appts</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      MedInstance.prototype.popupData = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> [
          {
            key: i18n.oncology.calview.TIME,
            value: <span class="hljs-keyword">this</span>.time() + <span class="hljs-string">" "</span> + <span class="hljs-keyword">this</span>.timeZone()
          }, {
            key: i18n.oncology.calview.NAME,
            value: <span class="hljs-keyword">this</span>.name()
          }, {
            key: i18n.oncology.calview.DOSE,
            value: <span class="hljs-keyword">this</span>.sdl()
          }
        ];
      };

      MedInstance.prototype.popupTitle = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> i18n.oncology.calview.PRESCRIPTION;
      };

      MedInstance.prototype.toUnix = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> moment(<span class="hljs-keyword">this</span>.json.DATE).valueOf();
      };

      <span class="hljs-keyword">return</span> MedInstance;

    })();
    <span class="hljs-comment">/* a medication. can have 0-to-many instances.
    &lt;a name="med-todo"&gt;&lt;/a&gt;
    TODO: this med-to-instance relationship is probably not sophisticated
    enough. consider 15 occurrences, say 5 are 9PM across X dates, 5 are 9AM, etc.
    identity is per instance (right now) but it is natural to think of each
    "time" instances as a set during [rescheduling](./adddialogdir.html) */</span>
    Medication = (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Medication</span><span class="hljs-params">(json)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>spawn medinstances based on json.DATES and other <a href="#fields">standard fields</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> date;
        <span class="hljs-keyword">this</span>.json = json;
        <span class="hljs-keyword">this</span>.uid = _.uniqueId();
        <span class="hljs-keyword">this</span>.schedType = <span class="hljs-string">'Medication'</span>;
        <span class="hljs-keyword">this</span>.json.DATES = (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
          <span class="hljs-keyword">var</span> _i, _len, _ref, _results;
          _ref = <span class="hljs-keyword">this</span>.json.DATES;
          _results = [];
          <span class="hljs-keyword">for</span> (_i = <span class="hljs-number">0</span>, _len = _ref.length; _i &lt; _len; _i++) {
            date = _ref[_i];
            _results.push(<span class="hljs-keyword">new</span> MedInstance({
              ID: <span class="hljs-keyword">this</span>.json.ID,
              NAME: <span class="hljs-keyword">this</span>.json.NAME,
              DOSE: <span class="hljs-keyword">this</span>.json.DOSE,
              SDL: <span class="hljs-keyword">this</span>.json.SDL,
              ENCNTR_ID: <span class="hljs-keyword">this</span>.json.ENCNTR_ID,
              ONC_TC_CAL_ITEMS_ID: <span class="hljs-keyword">this</span>.json.ONC_TC_CAL_ITEMS_ID,
              DATE: date.DATE,
			  TIME_ZONE: date.TIME_ZONE,
              EST: date.EST,
              CHECKED_STATUS: <span class="hljs-keyword">this</span>.json.CHECKED_STATUS,
              ONE_TIME_FREQ_IND: <span class="hljs-keyword">this</span>.json.ONE_TIME_FREQ_IND,
              PARENT_UID: <span class="hljs-keyword">this</span>.uid,
              ALL_DATES: <span class="hljs-keyword">this</span>.allDates()
            }));
          }
          <span class="hljs-keyword">return</span> _results;
        }).call(<span class="hljs-keyword">this</span>);
        <span class="hljs-comment">/* initializing variable as the opposite of what it should be since
        setVisible will reverse the values when first called */</span>
        <span class="hljs-keyword">this</span>.visible = <span class="hljs-keyword">this</span>.isChecked() === <span class="hljs-number">1</span> ? <span class="hljs-literal">false</span> : <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.isMulti = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.isNote = <span class="hljs-literal">false</span>;
        pubsub.publish(<span class="hljs-string">"ADD_MED"</span>, [<span class="hljs-keyword">this</span>]);
        $scope.$watch(<span class="hljs-string">'showMeds'</span>, (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_this)</span> {</span>
          <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(showMeds)</span> {</span>
            <span class="hljs-keyword">if</span>(showMeds === <span class="hljs-literal">true</span>)
            _this.visible = _this.isChecked() === <span class="hljs-number">1</span> ? <span class="hljs-literal">false</span> : <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">else</span>
             _this.visible = <span class="hljs-literal">true</span>;
             
            _this.setVisible();
          };
        })(<span class="hljs-keyword">this</span>));
      }

      Medication.prototype.id = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.ID;
      };

      Medication.prototype.uids = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> [<span class="hljs-keyword">this</span>.uid];
      };

      Medication.prototype.name = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.NAME;
      };

      Medication.prototype.dose = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.DOSE;
      };
      
      Medication.prototype.sdl = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.SDL;
      };

      Medication.prototype.allDates = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.datesString();
      };

      Medication.prototype.datesString = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">var</span> concatString, _i;
        concatString = <span class="hljs-string">""</span>;
        _i = <span class="hljs-number">0</span>;
        <span class="hljs-comment">/* When the calendar is first loaded, json.DATES is not loaded with MedInstances
        yet, only an array of DATE and EST from the reply structure of onc_tc_get_rx.  
        This if block accounts for that scenario. */</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.json.DATES.length === <span class="hljs-number">0</span>) {
          concatString = <span class="hljs-string">''</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.json.DATES[_i].DATE != <span class="hljs-literal">null</span>) {
          <span class="hljs-keyword">while</span> (_i &lt; <span class="hljs-keyword">this</span>.json.DATES.length) {
            concatString = concatString.concat(<span class="hljs-keyword">this</span>.json.DATES[_i].DATE, <span class="hljs-string">","</span>);
            _i++;
          }
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">while</span> (_i &lt; <span class="hljs-keyword">this</span>.json.DATES.length) {
            concatString = concatString.concat(<span class="hljs-keyword">this</span>.json.DATES[_i].json.DATE, <span class="hljs-string">","</span>);
            _i++;
          }
        }
        <span class="hljs-keyword">return</span> concatString ;
      };

      Medication.prototype.changeDates = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(dateString, calItemsId)</span> {</span>          
      	getPresOccurences = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(curPres)</span>{</span>
        <span class="hljs-keyword">return</span> {
        error: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data, status, headers, config)</span> {</span>			
          log.error(<span class="hljs-string">"status: "</span> + status + <span class="hljs-string">"\n"</span>);
          log.error(<span class="hljs-string">"data: "</span> + data + <span class="hljs-string">"\n\n"</span>);
          log.error(<span class="hljs-string">'Error occurred in onc_tc_get_rx.  Prescription occurences will not be displayed.'</span>);
          <span class="hljs-keyword">var</span> prescError = i18n.oncology.calview.PRESC_ERROR;
          $(<span class="hljs-string">'#loading-spinner'</span>).hide();
          alert(prescError);
         },
        params: <span class="hljs-string">"'MINE',"</span> + vars.person_id + <span class="hljs-string">".0,"</span> + curPres.json.ID + <span class="hljs-string">".0,0"</span>,
        success: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data, status, headers, config)</span> {</span>          	
          <span class="hljs-keyword">var</span> date_, json, med, _j, _len, _ref;
          log.debug(<span class="hljs-string">"status: "</span> + status + <span class="hljs-string">"\n"</span>);
          log.debug(<span class="hljs-string">"data: "</span> + (<span class="hljs-built_in">JSON</span>.stringify(data[<span class="hljs-number">0</span>])) + <span class="hljs-string">"\n\n"</span>);
          json = data[<span class="hljs-number">0</span>].RECORD_DATA;
          <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> console !== <span class="hljs-string">"undefined"</span> &amp;&amp; console !== <span class="hljs-literal">null</span> ? console.dir : <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>) {
            console.dir(json);
          }       
          
          <span class="hljs-keyword">var</span> date, dateArray, _i;
        <span class="hljs-keyword">while</span> (curPres.json.DATES.length &gt; <span class="hljs-number">0</span>) {
          curPres.json.DATES.pop();
        }
        <span class="hljs-keyword">if</span>(json.MEDS.length &gt; <span class="hljs-number">0</span> &amp;&amp; json.MEDS[<span class="hljs-number">0</span>].DATES.length &gt; <span class="hljs-number">0</span>){
	        dateArray = json.MEDS[<span class="hljs-number">0</span>].DATES;
	        curPres.json.DATES = json.MEDS[<span class="hljs-number">0</span>].DATES;
	        curPres.json.DATES = (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
	          <span class="hljs-keyword">var</span> _j, _len, _results;
	          _results = [];
	          <span class="hljs-keyword">for</span> (_i = _j = <span class="hljs-number">0</span>, _len = dateArray.length; _j &lt; _len; _i = ++_j) {
	            date = dateArray[_i];
	            _results.push(<span class="hljs-keyword">new</span> MedInstance({
	              ID: curPres.json.ID,
	              NAME: curPres.json.NAME,
	              DOSE: curPres.json.DOSE,
	              SDL: curPres.json.SDL,
	              ENCNTR_ID: curPres.json.ENCNTR_ID,
	              ONC_TC_CAL_ITEMS_ID: calItemsId,
	              DATE: date.DATE,
				  TIME_ZONE: date.TIME_ZONE,
	              EST: date.EST,
	              CHECKED_STATUS: curPres.json.CHECKED_STATUS,
	              ONE_TIME_FREQ_IND: curPres.json.ONE_TIME_FREQ_IND,
	              PARENT_UID: curPres.uid,
	              ALL_DATES: curPres.allDates()
	            }));
	          }
	          <span class="hljs-keyword">return</span> _results;
	        }).call(curPres);
	        
	        
	        curPres.visible = <span class="hljs-literal">false</span>;
	        curPres.setVisible();
	         $(<span class="hljs-string">'#loading-spinner'</span>).hide();
	        }
        },
        url: <span class="hljs-string">'onc_tc_get_rx'</span>
      };
    };
    $(<span class="hljs-string">'#loading-spinner'</span>).show();
    dao.call(getPresOccurences(<span class="hljs-keyword">this</span>));    
   };

      Medication.prototype.encounter = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.ENCNTR_ID;
      };             
      
      Medication.prototype.toUnix = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> moment(<span class="hljs-keyword">this</span>.json.START_DATE).valueOf();
      };  
      
      Medication.prototype.startDate = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>            
        <span class="hljs-keyword">if</span> (moment(<span class="hljs-keyword">this</span>.json.START_DATE).isValid()) {
          <span class="hljs-keyword">return</span> moment(<span class="hljs-keyword">this</span>.json.START_DATE).format(<span class="hljs-string">'L h:mmA'</span>);
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;
        }
      };    

      Medication.prototype.calItemsId = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.ONC_TC_CAL_ITEMS_ID;
      };

      Medication.prototype.oneTimeInd = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.ONE_TIME_FREQ_IND;
      };

      Medication.prototype.isChecked = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.CHECKED_STATUS;
      };

      Medication.prototype.isVisible = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.visible;
      };
      <span class="hljs-comment">/* when visibility changes, update all medinstances.  Also, each time the show/
      hide box is checked by a medication, the saveCheckStatus function calls the script
      to save the changes to the database. */</span>
      Medication.prototype.setVisible = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">var</span> date, _i, _len, _ref;
        <span class="hljs-keyword">this</span>.visible = <span class="hljs-keyword">this</span>.visible === <span class="hljs-literal">true</span> ? <span class="hljs-literal">false</span> : <span class="hljs-literal">true</span>;
        _ref = <span class="hljs-keyword">this</span>.json.DATES;
        <span class="hljs-keyword">for</span> (_i = <span class="hljs-number">0</span>, _len = _ref.length; _i &lt; _len; _i++) {
          date = _ref[_i];
          date.visible = <span class="hljs-keyword">this</span>.visible;
        }
       
        dao.call(saveCheckedStatus(<span class="hljs-keyword">this</span>.id(), <span class="hljs-keyword">this</span>.visible ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>));
        $scope.$broadcast(<span class="hljs-string">'displayCalViewItemsMed'</span>);

      };</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>popup data, as in <a href="#popup">appts</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Medication.prototype.popupData = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> [
          {
            key: i18n.oncology.calview.NAME,
            value: <span class="hljs-keyword">this</span>.name()
          }, {
            key: i18n.oncology.calview.DOSE,
            value: <span class="hljs-keyword">this</span>.sdl()
          }
        ];
      };

      Medication.prototype.popupTitle = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> i18n.oncology.calview.PRESCRIPTION;
      };

      <span class="hljs-keyword">return</span> Medication;

    })();
    <span class="hljs-comment">/* The regimen level is being added in as a very late change, and is only present
    in order to have the Regimen that an order belongs to labeled in the accordion
    view.  The Regimen will be shown now instead of the phase that order belongs to.
    This class and a new directive will be made in order to keep the accordion directives
    and array heirarchies from appctrl the same as the reply structure from onc_tc_get_sched_items.
    In the meantime, the regimen name will be added to the plan level. (Hasn't been converted from coffeescript)*/</span>
    Regimen = (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Regimen</span><span class="hljs-params">(json, fromChemo)</span> {</span>
        <span class="hljs-keyword">var</span> plan;
        <span class="hljs-keyword">this</span>.json = json;
        <span class="hljs-keyword">this</span>.imgUrl = vars.staticContentLocation + <span class="hljs-string">'/img/5893.png'</span>;
        <span class="hljs-keyword">this</span>.uid = _.uniqueId();
        <span class="hljs-keyword">this</span>.schedType = <span class="hljs-string">'Regimen'</span>;
        <span class="hljs-keyword">this</span>.plans = (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
          <span class="hljs-keyword">var</span> _i, _len, _ref, _results;
          _ref = <span class="hljs-keyword">this</span>.json.PLANS;
          _results = [];
          <span class="hljs-keyword">for</span> (_i = <span class="hljs-number">0</span>, _len = _ref.length; _i &lt; _len; _i++) {
            plan = _ref[_i];
            _results.push(<span class="hljs-keyword">new</span> Plan(plan,  _results, fromChemo, {
              regimenId: <span class="hljs-keyword">this</span>.regimenId(),
              regimenName: <span class="hljs-keyword">this</span>.regimenName(),
              cycleCount: <span class="hljs-keyword">this</span>.cycleCount()
            
            },_i));
          }
          <span class="hljs-keyword">return</span> _results;
        }).call(<span class="hljs-keyword">this</span>);
      }
      Regimen.prototype.cycleCount = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.CYCLECOUNT;
      };
      Regimen.prototype.regimenId = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-keyword">this</span>.json.REGIMEN_ID === <span class="hljs-string">'undefined'</span>) {
          <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.REGIMEN_ID;
        }
      };
      Regimen.prototype.regimenName = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-keyword">this</span>.json.REGIMEN_NAME === <span class="hljs-string">'undefined'</span>) {
          <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.REGIMEN_NAME;
        }
      };
      Regimen.prototype.ordersHidden = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.plans.length !== <span class="hljs-number">0</span> &amp;&amp; (_.filter(<span class="hljs-keyword">this</span>.plans, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(plans)</span> {</span>
          <span class="hljs-keyword">return</span> plans.ordersHidden();
        })).length === <span class="hljs-keyword">this</span>.plans.length;
      };
      <span class="hljs-keyword">return</span> Regimen;
    })();

    
    
    <span class="hljs-comment">/* plans are displayed as trees in the [accordion](./accordiondir.html) but
    otherwise are logically ignored in the "time" views -- only their orders
    matter, since the orders are time-specific.
   
    takes its json, peels off its child plans and passes them indication whether
    it's a regimen plan (chemo) or non-regimen plan (appt)
    &lt;a name="plan"&gt;&lt;/a&gt;  */</span>
    Plan = (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Plan</span><span class="hljs-params">(json, cycles, fromChemo ,regimenData, sequence )</span> {</span>
        <span class="hljs-keyword">var</span> phase;
        <span class="hljs-keyword">this</span>.json = json;
        <span class="hljs-keyword">this</span>.fromChemo = fromChemo;
        <span class="hljs-keyword">this</span>.sequence = sequence;
        <span class="hljs-keyword">this</span>.imgUrl = vars.staticContentLocation + <span class="hljs-string">'/img/6404_16.png'</span>;
        <span class="hljs-keyword">this</span>.uid = _.uniqueId();
        <span class="hljs-keyword">this</span>.schedType = <span class="hljs-string">'Plan'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>create orders, passing the chemo indicator (for icon)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.orders = (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
          <span class="hljs-keyword">var</span> _i, _len, _ref, _results;
          _ref = <span class="hljs-keyword">this</span>.json.ORDERS;
          _results = [];
          <span class="hljs-keyword">for</span> (_i = <span class="hljs-number">0</span>, _len = _ref.length; _i &lt; _len; _i++) {
            order = _ref[_i];
            _results.push(<span class="hljs-keyword">new</span> Order(order, cycles, fromChemo, regimenData, {
              versionPwCatId: <span class="hljs-keyword">this</span>.versionPwCatId(),
              cycleNbr: <span class="hljs-keyword">this</span>.cycle(),
              planId: <span class="hljs-keyword">this</span>.id(),
              planName: <span class="hljs-keyword">this</span>.name(),
              regdetId: <span class="hljs-keyword">this</span>.regdetId(),
              regoffsethours: <span class="hljs-keyword">this</span>.regOffsetHours(),
              planSequence: <span class="hljs-keyword">this</span>.planSequence()
            },_i,_results));
          }
          <span class="hljs-keyword">return</span> _results;
        }).call(<span class="hljs-keyword">this</span>);
      }
      
      Plan.prototype.planSequence = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.sequence;
      };
      
      Plan.prototype.regOffsetHours = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.REGIMEN_OFFSETHOURS;
      };
      
      Plan.prototype.regdetId = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.REGIMEN_DET_ID;
      };

      Plan.prototype.id = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.PLAN_ID;
      };

      Plan.prototype.uids = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> _.map(<span class="hljs-keyword">this</span>.phases, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(phase)</span> {</span>
          <span class="hljs-keyword">return</span> phase.uids();
        });
      };

      Plan.prototype.name = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.PLAN_NAME;
      };

      Plan.prototype.status = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.PLAN_STATUS;
      };

      Plan.prototype.cycle = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.CYCLE_NBR;
      };

      Plan.prototype.versionPwCatId = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.VERSION_PW_CAT_ID;
      };

      Plan.prototype.ordersHidden = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.phases.length !== <span class="hljs-number">0</span> &amp;&amp; (_.filter(<span class="hljs-keyword">this</span>.phases, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(phase)</span> {</span>
          <span class="hljs-keyword">return</span> phase.ordersHidden();
        })).length === <span class="hljs-keyword">this</span>.phases.length;
      };

      Plan.prototype.popupData = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> [
          {
            key: i18n.oncology.calview.NAME,
            value: <span class="hljs-keyword">this</span>.name()
          }, {
            key: i18n.oncology.calview.CYCLE,
            value: <span class="hljs-keyword">this</span>.cycle()
          }
        ];
      };

      Plan.prototype.popupTitle = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> i18n.oncology.calview.PLAN;
      };

      <span class="hljs-keyword">return</span> Plan;

    })();
    
    

    <span class="hljs-comment">/* orders are displayed in trees in the [accordion](./accordiondir.html) as leafs
   
    takes its json and icon indicator  */</span>
    Order = (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Order</span><span class="hljs-params">(json, cycles, fromChemo,regimenData, planData, sequence, previousOrders)</span> {</span>
        <span class="hljs-keyword">this</span>.json = json;
        <span class="hljs-keyword">this</span>.previousOrders = previousOrders;
        <span class="hljs-keyword">this</span>.cycles = cycles;
        <span class="hljs-keyword">this</span>.fromChemo = fromChemo;
        <span class="hljs-keyword">this</span>.regimenData = regimenData;
        <span class="hljs-keyword">this</span>.planData = planData;
        <span class="hljs-keyword">this</span>.sequence = sequence;
        <span class="hljs-keyword">this</span>.uid = _.uniqueId();
        <span class="hljs-keyword">this</span>.schedType = <span class="hljs-string">'Order'</span>;
        <span class="hljs-keyword">this</span>.visible = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.imgUrl = vars.staticContentLocation + <span class="hljs-string">'/img/4974_16.png'</span>;
        <span class="hljs-keyword">this</span>.isMulti = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">this</span>.isNote = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">this</span>.showEst = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">this</span>.showSched = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">this</span>.showAppts = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.img = <span class="hljs-string">"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAB2ElEQVQ4EXWSOUteURCG73FD45KI+wIGU4gbRFFiI4KFhSlstBL/iIVYxtbf4A9QUMuAiAgWIWkEcYU0GkFcEFHRL8/zee7HbRx4mPfMmTPnzNyb5HK5RLDFJIRD/G/4CnNwEJnFD8Afco7wC5lzSTWBCTY28LUwBSuwBj3QG7Wx71BL7jp+HKog2SNwD5vxJUPoG+LHMcGkE2JX+P58jpd5Jkl2SxDDCK3kzSUBXxbJ95ZZF8WcUvwHzo6kh4wPhxB+4L9AObTDEliwDbR5ck4zl7IZglP8yeYqeLADLuEfOANtH5qgGRziI8xwdpT6FOCmzFSddkucRx+6L2pf9C2Tt+zZtIUKnubXsJhf4pn1XdTkBQdZ5zpq26qAwuB83iC8QBe4/gjdoL3CZ6gHCzvEBigU+MvTtgxwwzPugvUZ+sEY+hf6HNmK3jHGekaftvCJgNPX7LWctZ9MbfI1zuE2ojsNgS8sFLDHVnAGPrMYbCf/TLx7jeCe2gKVUChwxtO2DXCDPdrCOdq/zxb20f4Lbeg9Y6yn9WkL1QScsuYAi1g7C7XJF7gWsIU0z1fnf6RbrvDX9WbNCTt1W1BrFrMteQKthsoP9jIGk5AmOwfNvfe0+xZd/w9tLJFutoCYoQAAAABJRU5ErkJggg=="</span>;
           
        <span class="hljs-comment">/* just as in [appts](./appctrl.html#watch), states change and those
        changes are watched, reflected and honored in ui (e.g. a [list date](./listdatedir.html)).  */</span>
        $scope.$watch(<span class="hljs-string">'showEst'</span>, (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_this)</span> {</span>
          <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(showEst)</span> {</span>
            <span class="hljs-keyword">if</span> (_this.json.EST &amp;&amp; _this.showAppts) {
                _this.visible = showEst;
              }
              _this.showEst = showEst;

         };
        })(<span class="hljs-keyword">this</span>));
        $scope.$watch(<span class="hljs-string">'showSched'</span>, (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_this)</span> {</span>
          <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(showSched)</span> {</span>
            <span class="hljs-keyword">if</span> (!_this.json.EST &amp;&amp; _this.showAppts) {
              _this.visible = showSched;           
            }
            _this.showSched = showSched;
            
          };
        })(<span class="hljs-keyword">this</span>));
        $scope.$watch(((!<span class="hljs-keyword">this</span>.fromChemo) ? <span class="hljs-string">'showAppts'</span> : <span class="hljs-string">'showChemo'</span>), (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_this)</span> {</span>
          <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(show)</span> {</span>
          		<span class="hljs-keyword">if</span> (_this.json.EST &amp;&amp; _this.showEst){
          	   _this.visible = show;
         	   
          	  }
          	
         	<span class="hljs-keyword">if</span>( _this.showSched &amp;&amp; !_this.json.EST){
        	    _this.visible = show;
         	   }
         	   _this.showAppts = show;             
          };
          
        })(<span class="hljs-keyword">this</span>));
        pubsub.publish(<span class="hljs-string">"ADD_ORDER_"</span> + (<span class="hljs-keyword">this</span>.midnight()), [<span class="hljs-keyword">this</span>]);
      }
      
            
      Order.prototype.phaseId = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.PHASE_ID;
      };

      Order.prototype.phaseName = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.PHASE_NAME;
      };

      Order.prototype.phaseStatus = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.PHASE_STATUS;
      };
      Order.prototype.phaseStartDate= <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.PHASE_START;
      };
	  Order.prototype.phaseStartDtTZ= <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.PHASE_START_TZ;
      };

      Order.prototype.id = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.ORDER_ID;
      };

      Order.prototype.uids = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> [<span class="hljs-keyword">this</span>.uid];
      };

      Order.prototype.name = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> _.str.capitalize( <span class="hljs-keyword">this</span>.json.ORDER_NAME);
      };

      Order.prototype.status = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.ORDER_STATUS;
      };

      Order.prototype.synonymId = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.SYNONYM_ID;
      };

      Order.prototype.sentenceId = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.SENTENCE_ID;
      };

      Order.prototype.updateCount = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.UPDT_CNT;
      };
      
      Order.prototype.offsethours = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.OFFSET_IN_HOURS;
      };

      Order.prototype.date = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">if</span> (moment(<span class="hljs-keyword">this</span>.json.ORDER_DATE).isValid()) {
          <span class="hljs-keyword">return</span> moment(<span class="hljs-keyword">this</span>.json.ORDER_DATE).format(<span class="hljs-string">'L'</span>);
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.potentialDate();
        }
      };
      
      
       Order.prototype.setOrderDate = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(newOrderdate)</span> {</span>
        <span class="hljs-keyword">if</span> (moment(newOrderdate).isValid()) {
       	
          <span class="hljs-keyword">this</span>.json.ORDER_DATE = newOrderdate;</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>this.showEst = false;
this.visible = false;
this.json.EST = 0;<br>update the remaining dates of subsequent orders.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">for</span>( <span class="hljs-keyword">var</span> i = <span class="hljs-keyword">this</span>.sequence + <span class="hljs-number">1</span>; i &lt; <span class="hljs-keyword">this</span>.previousOrders.length ; i++)
          {
 
	           <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.previousOrders[i].json.ORDER_ID == <span class="hljs-number">0.0</span>)
	           {
		           	<span class="hljs-keyword">var</span> date = <span class="hljs-keyword">this</span>.previousOrders[i-<span class="hljs-number">1</span>].json.ORDER_DATE;
		        	<span class="hljs-keyword">if</span> (moment(date).isValid())
		        	{
			            <span class="hljs-keyword">var</span> mom = moment(date).add(<span class="hljs-keyword">this</span>.previousOrders[i-<span class="hljs-number">1</span>].offsethours(),<span class="hljs-string">"hours"</span>);
			      	
				      	<span class="hljs-keyword">this</span>.previousOrders[i].json.ORDER_DATE = mom;
				      	<span class="hljs-keyword">this</span>.previousOrders[i].json.EST = <span class="hljs-number">1</span>;
						<span class="hljs-keyword">this</span>.previousOrders[i].json.TIME_ZONE = <span class="hljs-keyword">this</span>.previousOrders[i-<span class="hljs-number">1</span>].json.TIME_ZONE;</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>this.previousOrders[i].showEst = false;
this.previousOrders[i].visible = false;
this.previousOrders[i].showEst = true;
this.previousOrders[i].visible = true;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			      	
			      	}
	      	  }
	      	}
	      	 <span class="hljs-keyword">this</span>.showEst = <span class="hljs-literal">true</span>; 
	      	 <span class="hljs-keyword">this</span>.visible = <span class="hljs-literal">true</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>this.json.EST = 1;              </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        } 
      };
      
      
      
      Order.prototype.potentialDate = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span>{</span>
      	
     		  
        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.sequence == <span class="hljs-number">0</span>)
      	{

      		<span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.planData.planSequence &gt; <span class="hljs-number">0</span>) <span class="hljs-comment">// adjusting date based on previous cycle first order date + regimen offset hours</span>
			{
			 <span class="hljs-keyword">try</span>{
			 	  <span class="hljs-keyword">var</span> ordersCount ,firstOrder;
			 	  
				  	  ordersCount =  <span class="hljs-keyword">this</span>.cycles[<span class="hljs-keyword">this</span>.planData.planSequence-<span class="hljs-number">1</span>].orders.length;
				  
					  <span class="hljs-keyword">if</span>(ordersCount&gt;<span class="hljs-number">0</span>)
					  {
					   firstOrder =  <span class="hljs-keyword">this</span>.cycles[<span class="hljs-keyword">this</span>.planData.planSequence-<span class="hljs-number">1</span>].orders[<span class="hljs-number">0</span>] ;
					 
	            
					    <span class="hljs-keyword">var</span> date = firstOrder.json.ORDER_DATE ;
	                  	<span class="hljs-keyword">var</span> regoffsethours = firstOrder.planData.regoffsethours;
	                  	
			        	<span class="hljs-keyword">if</span> (moment(date).isValid())
			        	{
			            	<span class="hljs-keyword">var</span> mom = moment(date).add(regoffsethours,<span class="hljs-string">"hours"</span>);
	                    
	                    	<span class="hljs-keyword">this</span>.json.ORDER_DATE = mom;
					      	<span class="hljs-keyword">this</span>.json.EST = <span class="hljs-number">1</span>;
							<span class="hljs-keyword">this</span>.json.TIME_ZONE = firstOrder.json.TIME_ZONE;
					      
					      	<span class="hljs-keyword">return</span> moment(<span class="hljs-keyword">this</span>.json.ORDER_DATE).format(<span class="hljs-string">'L'</span>);
				           } <span class="hljs-keyword">else</span> {
				           <span class="hljs-keyword">return</span> <span class="hljs-string">'**/**/****'</span>;
				         }
				          }
					  
				  }	
					
				  <span class="hljs-keyword">catch</span>(err)
				  {
					  alert(err.description);
				  }			  
			
			}
			
	        <span class="hljs-keyword">if</span> (moment(<span class="hljs-keyword">this</span>.phaseStartDate()).isValid()) 
      		{
              	<span class="hljs-keyword">this</span>.json.ORDER_DATE = <span class="hljs-keyword">this</span>.phaseStartDate();
				<span class="hljs-keyword">this</span>.json.TIME_ZONE = <span class="hljs-keyword">this</span>.phaseStartDtTZ();
		      	<span class="hljs-keyword">this</span>.json.EST = <span class="hljs-number">1</span>;
		     	<span class="hljs-keyword">return</span> moment(<span class="hljs-keyword">this</span>.json.ORDER_DATE).format(<span class="hljs-string">'L'</span>);
	         } <span class="hljs-keyword">else</span> {
	           <span class="hljs-keyword">return</span> <span class="hljs-string">'**/**/****'</span>;
	         }
			
      		
      	}
      	<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.sequence &gt; <span class="hljs-number">0</span>)
      	{
			<span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.json.RELATED_PHASE_ID != <span class="hljs-number">0.0</span> &amp;&amp; <span class="hljs-keyword">this</span>.json.RELATED_PHASE_ID &gt;  <span class="hljs-keyword">this</span>.previousOrders[<span class="hljs-keyword">this</span>.sequence-<span class="hljs-number">1</span>].json.RELATED_PHASE_ID)
			{
				<span class="hljs-keyword">var</span> date = <span class="hljs-keyword">this</span>.previousOrders[<span class="hljs-keyword">this</span>.sequence-<span class="hljs-number">1</span>].json.ORDER_DATE;
				<span class="hljs-keyword">if</span> (moment(date).isValid()) {
				<span class="hljs-keyword">var</span> mom = moment(date).add(<span class="hljs-keyword">this</span>.previousOrders[<span class="hljs-keyword">this</span>.sequence-<span class="hljs-number">1</span>].offsethours(),<span class="hljs-string">"hours"</span>);
			
				<span class="hljs-keyword">this</span>.json.ORDER_DATE = mom;
				<span class="hljs-keyword">this</span>.json.EST = <span class="hljs-number">1</span>;
				<span class="hljs-keyword">this</span>.json.TIME_ZONE = <span class="hljs-keyword">this</span>.previousOrders[<span class="hljs-keyword">this</span>.sequence-<span class="hljs-number">1</span>].json.TIME_ZONE;
				<span class="hljs-keyword">return</span> mom.format(<span class="hljs-string">'L'</span>);
				 } <span class="hljs-keyword">else</span> {
				 <span class="hljs-keyword">return</span> <span class="hljs-string">'**/**/****'</span>;
				 }
			}
			<span class="hljs-keyword">else</span>
			{
				
      		<span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.planData.planSequence &gt; <span class="hljs-number">0</span>) <span class="hljs-comment">// adjusting date based on previous cycle first order date + regimen offset hours</span>
			{
			 <span class="hljs-keyword">try</span>{
			 	  <span class="hljs-keyword">var</span> ordersCount ,firstOrder;
			 	  
				  	  ordersCount =  <span class="hljs-keyword">this</span>.cycles[<span class="hljs-keyword">this</span>.planData.planSequence-<span class="hljs-number">1</span>].orders.length;
				  
					  <span class="hljs-keyword">if</span>(ordersCount&gt;<span class="hljs-number">0</span>)
					  {
					   firstOrder =  <span class="hljs-keyword">this</span>.cycles[<span class="hljs-keyword">this</span>.planData.planSequence-<span class="hljs-number">1</span>].orders[<span class="hljs-number">0</span>] ;
					 
	            
					    <span class="hljs-keyword">var</span> date = firstOrder.json.ORDER_DATE ;
	                  	<span class="hljs-keyword">var</span> regoffsethours = firstOrder.planData.regoffsethours;
	                  	
			        	<span class="hljs-keyword">if</span> (moment(date).isValid())
			        	{
			            	<span class="hljs-keyword">var</span> mom = moment(date).add(regoffsethours,<span class="hljs-string">"hours"</span>);
	                    
	                    	<span class="hljs-keyword">this</span>.json.ORDER_DATE = mom;
					      	<span class="hljs-keyword">this</span>.json.EST = <span class="hljs-number">1</span>;
							<span class="hljs-keyword">this</span>.json.TIME_ZONE = firstOrder.json.TIME_ZONE;
					      
					      	<span class="hljs-keyword">return</span> moment(<span class="hljs-keyword">this</span>.json.ORDER_DATE).format(<span class="hljs-string">'L'</span>);
				           } <span class="hljs-keyword">else</span> {
				           <span class="hljs-keyword">return</span> <span class="hljs-string">'**/**/****'</span>;
				         }
				          }
					  
				  }	
					
				  <span class="hljs-keyword">catch</span>(err)
				  {
					  alert(err.description);
				  }			  
			
			}
			
	        <span class="hljs-keyword">if</span> (moment(<span class="hljs-keyword">this</span>.phaseStartDate()).isValid()) 
      		{
              	<span class="hljs-keyword">this</span>.json.ORDER_DATE = <span class="hljs-keyword">this</span>.phaseStartDate();
		      	<span class="hljs-keyword">this</span>.json.EST = <span class="hljs-number">1</span>;
				<span class="hljs-keyword">this</span>.json.TIME_ZONE = <span class="hljs-keyword">this</span>.phaseStartDtTZ();
		     	<span class="hljs-keyword">return</span> moment(<span class="hljs-keyword">this</span>.json.ORDER_DATE).format(<span class="hljs-string">'L'</span>);
	         } <span class="hljs-keyword">else</span> {
	           <span class="hljs-keyword">return</span> <span class="hljs-string">'**/**/****'</span>;
	         }
			}
      	}
		<span class="hljs-comment">/*else if(this.json.RELATED_PHASE_ID &lt; 2 &amp;&amp; this.sequence &gt; 0)
      	{
        	var date = this.previousOrders[this.sequence-1].json.ORDER_DATE;
        	if (moment(date).isValid()) {
            var mom = moment(date).add(this.previousOrders[this.sequence-1].offsethours(),"hours");
      	
	      	this.json.ORDER_DATE = mom;
	      	this.json.EST = 1;
	      	return mom.format('L');
	         } else {
	         return '';
       		 }
      	}*/</span>
      	
      	
      
      	<span class="hljs-keyword">if</span> (moment(<span class="hljs-keyword">this</span>.phaseStartDate()).isValid()) {
                 	
	      	<span class="hljs-keyword">this</span>.json.ORDER_DATE = <span class="hljs-keyword">this</span>.phaseStartDate();
			<span class="hljs-keyword">this</span>.json.TIME_ZONE = <span class="hljs-keyword">this</span>.phaseStartDtTZ();
	      	<span class="hljs-keyword">this</span>.json.EST = <span class="hljs-number">1</span>;
	      	<span class="hljs-keyword">return</span> moment(<span class="hljs-keyword">this</span>.json.ORDER_DATE).format(<span class="hljs-string">'L'</span>);
         } <span class="hljs-keyword">else</span> {
         <span class="hljs-keyword">return</span> <span class="hljs-string">'**/**/****'</span>;
        }
      	
      	
      	
        
<span class="hljs-comment">/* Part 1:
If the order is in a plan without a regimen (2 plans[*]) and it has no order_id, then we can assume that we are looking at a phase in a planned status.
The good news is these still have phase starts so I will pass the phase start and the offsets (see below for more details around logic). 

Part 2: 
If the order is in a plan with a regimen then 
If the order has a value for “related_phase” and does not have an offset then that will designate this as the first DOT order 
and be equal to the start of its phase.

If the order does not have a value for “related_phase and does not have an offset then this is can be equal to the start of the phase.
 (This would mean it’s not related to the DOT phase)
If the order has an offset then the reply from get_sched_items has already sorted properly 
and you can take the previous order object in JavaScript to offset from.
*/</span>
      	
      		
      	
      	
      };
      Order.prototype.midnight = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">if</span> (moment(<span class="hljs-keyword">this</span>.json.ORDER_DATE).isValid()) {
          <span class="hljs-keyword">return</span> moment(<span class="hljs-keyword">this</span>.json.ORDER_DATE).startOf(<span class="hljs-string">'day'</span>).valueOf();
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;
        }
      };

      Order.prototype.text = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.name();
      };

      Order.prototype.time = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">if</span> (moment(<span class="hljs-keyword">this</span>.json.ORDER_DATE).isValid()) {
          <span class="hljs-keyword">return</span> moment(<span class="hljs-keyword">this</span>.json.ORDER_DATE).format(<span class="hljs-string">'h:mmA'</span>);
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">return</span> <span class="hljs-string">'**:**'</span>;
        }
      };

      Order.prototype.isEst = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.EST === <span class="hljs-number">1</span>;
      };

      Order.prototype.isFrozen = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.FROZEN === <span class="hljs-number">1</span>;
      };

      Order.prototype.pathwayUUID = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.PATHWAY_UUID;
      };

      Order.prototype.relatedPhaseName = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.RELATED_PHASE;
      };

      Order.prototype.relatedPhaseId = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.RELATED_PHASE_ID;
      };

      Order.prototype.isVisible = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.visible;
      };
	  
	  Order.prototype.timeZone = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.TIME_ZONE;
      };

      Order.prototype.popupData = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> [
          {
            key: i18n.oncology.calview.TIME,
            value: <span class="hljs-keyword">this</span>.time() + <span class="hljs-string">" "</span> + <span class="hljs-keyword">this</span>.timeZone()
          }, {
            key: i18n.oncology.calview.ORDER_NAME,
            value: <span class="hljs-keyword">this</span>.name()
          }, {
            key: i18n.oncology.calview.STATUS,
            value: <span class="hljs-keyword">this</span>.status()
          }
        ];
      };

      Order.prototype.popupTitle = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> i18n.oncology.calview.ORDER;
      };

      Order.prototype.toUnix = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> moment(<span class="hljs-keyword">this</span>.json.ORDER_DATE).valueOf();
      };

      <span class="hljs-keyword">return</span> Order;

    })();
    <span class="hljs-comment">/* note class, like medication, is a one-to-many and behaves, in terms of
    re/scheduling basically the same way.  */</span>
    Note = (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Note</span><span class="hljs-params">(json)</span> {</span>
        <span class="hljs-keyword">var</span> date;
        <span class="hljs-keyword">this</span>.json = json;
        <span class="hljs-keyword">this</span>.uid = _.uniqueId();
        <span class="hljs-keyword">this</span>.schedType = <span class="hljs-string">'Note'</span>;
        <span class="hljs-keyword">this</span>.dates = (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
          <span class="hljs-keyword">var</span> _i, _len, _ref, _results;
          _ref = <span class="hljs-keyword">this</span>.splitDates();
          _results = [];
          <span class="hljs-keyword">for</span> (_i = <span class="hljs-number">0</span>, _len = _ref.length; _i &lt; _len; _i++) {
            date = _ref[_i];
            _results.push(<span class="hljs-keyword">new</span> NoteInstance({
              ONC_TC_CAL_ITEMS_ID: <span class="hljs-keyword">this</span>.json.ONC_TC_CAL_ITEMS_ID,
              NOTE_TXT: <span class="hljs-keyword">this</span>.json.NOTE_TXT,
              PRSNL_NAME: <span class="hljs-keyword">this</span>.json.PRSNL_NAME,
              DATE: date,
              ALL_DATES: <span class="hljs-keyword">this</span>.json.NOTE_DT_TM_TXT,
              PARENT_UID: <span class="hljs-keyword">this</span>.uid
            }));
          }
          <span class="hljs-keyword">return</span> _results;
        }).call(<span class="hljs-keyword">this</span>);
        <span class="hljs-keyword">this</span>.visible = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.isMulti = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.isNote = <span class="hljs-literal">true</span>;
      }

      Note.prototype.uids = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> [<span class="hljs-keyword">this</span>.uid];
      };

      Note.prototype.text = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.NOTE_TXT;
      };

      Note.prototype.name = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.text();
      };

      Note.prototype.calItemsId = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.ONC_TC_CAL_ITEMS_ID;
      };

      Note.prototype.splitDates = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.json.NOTE_DT_TM_TXT.indexOf(<span class="hljs-string">','</span>) === -<span class="hljs-number">1</span>) {
          <span class="hljs-keyword">return</span> [<span class="hljs-keyword">this</span>.json.NOTE_DT_TM_TXT];
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.NOTE_DT_TM_TXT.split(<span class="hljs-string">','</span>);
        }
      };

      Note.prototype.isVisible = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.visible;
      };

      <span class="hljs-keyword">return</span> Note;

    })();
    NoteInstance = (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">NoteInstance</span><span class="hljs-params">(json)</span> {</span>
        <span class="hljs-keyword">this</span>.json = json;
        <span class="hljs-keyword">this</span>.uid = _.uniqueId();
        <span class="hljs-keyword">this</span>.schedType = <span class="hljs-string">'NoteInstance'</span>;
        <span class="hljs-keyword">this</span>.imgUrl = vars.staticContentLocation + <span class="hljs-string">'/img/6222_16.png'</span>;
        <span class="hljs-keyword">this</span>.visible = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.isMulti = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.isNote = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.img = <span class="hljs-string">"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAA0ElEQVQ4Ee2RPQoCMRCFE/8VO8FCz6NgpYUgeAnvo8VW4gkstrDxDJYW1h5ARIT4Pcmg4LrF2jrw8ZjJ5CWTeOdcgMJRKrwzbvwbOPfzG1TiY57RG5RjLtH3ar0D73XSV5jBgdICLmC3kkEfNtCDr6FGsYZqCMEZ5DI4gfV8qJ22o2kAife+hVroht6SLDWDlMUpTGCFSTOrOatmBnWuvadhBmNYYlJD75AbZqDZNPsWkcEIEmhDron9wpATGzTru65whDl0IXccPdDzdLRQPAAx8TAdDYAY+gAAAABJRU5ErkJggg=="</span>;
        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.json.NOTE_TXT == <span class="hljs-string">"dummyNote"</span> &amp;&amp; <span class="hljs-keyword">this</span>.json.ONC_TC_CAL_ITEMS_ID  == <span class="hljs-number">0</span>) 
            {
             <span class="hljs-keyword">this</span>.visible = <span class="hljs-literal">false</span>;
           
            }    
        $scope.$watch(<span class="hljs-string">'showNotes'</span>, (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_this)</span> {</span>
          <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(showNotes)</span> {</span>
          	
            _this.visible = showNotes;
            <span class="hljs-keyword">if</span>(_this.json.NOTE_TXT == <span class="hljs-string">"dummyNote"</span> &amp;&amp; _this.json.ONC_TC_CAL_ITEMS_ID  == <span class="hljs-number">0</span>) 
            {
             _this.visible = <span class="hljs-literal">false</span>;
            }
          };
        })(<span class="hljs-keyword">this</span>));
        pubsub.publish(<span class="hljs-string">"ADD_NOTE_"</span> + (<span class="hljs-keyword">this</span>.midnight()), [<span class="hljs-keyword">this</span>]);
      }

      NoteInstance.prototype.uids = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> [<span class="hljs-keyword">this</span>.uid];
      };

      NoteInstance.prototype.parentUid = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.PARENT_UID;
      };

      NoteInstance.prototype.text = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.NOTE_TXT;
      };

      NoteInstance.prototype.name = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.text();
      };
            
       NoteInstance.prototype.prsnlName = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.PRSNL_NAME;
      };


      NoteInstance.prototype.changeDates = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(dateString, calItemsId, newText)</span> {</span>
        <span class="hljs-keyword">var</span> date, dateArray;
        dateArray = dateString.split(<span class="hljs-string">','</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.dates = (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
          <span class="hljs-keyword">var</span> _i, _len, _results;
          _results = [];
          <span class="hljs-keyword">for</span> (_i = <span class="hljs-number">0</span>, _len = dateArray.length; _i &lt; _len; _i++) {
            date = dateArray[_i];
            _results.push(<span class="hljs-keyword">new</span> NoteInstance({
              ONC_TC_CAL_ITEMS_ID: calItemsId,
              NOTE_TXT: newText,
              PRSNL_NAME: vars.prsnlName,
              DATE: date,
              ALL_DATES: dateString,
              PARENT_UID: <span class="hljs-keyword">this</span>.uid
            }));
          }
          <span class="hljs-keyword">return</span> _results;
        }).call(<span class="hljs-keyword">this</span>);
      };

      NoteInstance.prototype.calItemsId = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.ONC_TC_CAL_ITEMS_ID;
      };

      NoteInstance.prototype.allDates = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json.ALL_DATES;
      };

      NoteInstance.prototype.date = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">if</span> (moment(<span class="hljs-keyword">this</span>.json.DATE).isValid()) {
          <span class="hljs-keyword">return</span> moment(<span class="hljs-keyword">this</span>.json.DATE).format(<span class="hljs-string">'L'</span>);
        }
      };

      NoteInstance.prototype.time = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;
      };

      NoteInstance.prototype.midnight = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">if</span> (moment(<span class="hljs-keyword">this</span>.json.DATE).isValid()) {
          <span class="hljs-keyword">return</span> moment(<span class="hljs-keyword">this</span>.json.DATE).startOf(<span class="hljs-string">'day'</span>).valueOf();
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;
        }
      };

      NoteInstance.prototype.isVisible = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.visible;
      };

      NoteInstance.prototype.popupData = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span>[ 
          {
            key: i18n.oncology.calview.NOTE,
            value: <span class="hljs-keyword">this</span>.text()   
          }, {
            key: i18n.DOCUMENTED_BY,
            value: <span class="hljs-keyword">this</span>.prsnlName()
          }
		];
      };

      NoteInstance.prototype.popupTitle = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> i18n.oncology.calview.NOTE;
      };

      NoteInstance.prototype.toUnix = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> moment(<span class="hljs-keyword">this</span>.json.DATE).valueOf();
      };

      <span class="hljs-keyword">return</span> NoteInstance;

    })();
    <span class="hljs-comment">/* encapsulates the above objects by a date. instances of this class are used
    to populate the "time" views (i.e. the [calendar list](./calendarlistdir.html)
    and [calendar](./calendardir.html)).  */</span>
    Date_ = (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Date_</span><span class="hljs-params">(unixStamp)</span> {</span>
        <span class="hljs-comment">/* the unixstamp is midnight of a date (these dates are created [below](#date_creation)). the
        arrays are kept of each object type above and added the [pub/sub](./pubsubsvc.html).
        each instance of the above types publishes itself (an [example](#publish))
        by its midnight, to which the appropriate date picks up and adds to one
        of these arrays  */</span>
        <span class="hljs-keyword">this</span>.unixStamp = unixStamp;
        <span class="hljs-keyword">this</span>.appts = [];
        <span class="hljs-keyword">this</span>.meds = [];
        <span class="hljs-keyword">this</span>.medinstances = [];
        <span class="hljs-keyword">this</span>.notes = [];
        <span class="hljs-keyword">this</span>.orders = [];
        <span class="hljs-comment">/* &lt;a name="schedulables"&gt;&lt;/a&gt;
        scheduables are an abstraction of the above arrays so that the time-based
        views can easily iterate, sort and display over these instances without
        care for their types.  */</span>
        <span class="hljs-keyword">this</span>.schedulables = [];
        pubsub.subscribe(<span class="hljs-string">"ADD_APPT_"</span> + <span class="hljs-keyword">this</span>.unixStamp, (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_this)</span> {</span>
          <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(appt)</span> {</span>
            _this.appts.push(appt);
            _this.sortSchedulables();
          };
        })(<span class="hljs-keyword">this</span>));
        pubsub.subscribe(<span class="hljs-string">"ADD_MED"</span>, (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_this)</span> {</span>
          <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(med)</span> {</span>
            _this.meds.push(med);
          };
        })(<span class="hljs-keyword">this</span>));
        pubsub.subscribe(<span class="hljs-string">"ADD_MEDINSTANCE_"</span> + <span class="hljs-keyword">this</span>.unixStamp, (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_this)</span> {</span>
          <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(medInstance)</span> {</span>
            _this.medinstances.push(medInstance);
            _this.sortSchedulables();
          };
        })(<span class="hljs-keyword">this</span>));
        pubsub.subscribe(<span class="hljs-string">"ADD_NOTE_"</span> + <span class="hljs-keyword">this</span>.unixStamp, (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_this)</span> {</span>
          <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(note)</span> {</span>
            _this.notes.push(note);
            _this.sortSchedulables();
          };
        })(<span class="hljs-keyword">this</span>));
        pubsub.subscribe(<span class="hljs-string">"ADD_ORDER_"</span> + <span class="hljs-keyword">this</span>.unixStamp, (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_this)</span> {</span>
          <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(order)</span> {</span>
            _this.orders.push(order);
            _this.sortSchedulables();
          };
        })(<span class="hljs-keyword">this</span>));
        pubsub.subscribe(<span class="hljs-string">"GET_SCHEDULABLE_"</span> + <span class="hljs-keyword">this</span>.unixStamp, (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_this)</span> {</span>
          <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(uid, cb)</span> {</span>
            <span class="hljs-keyword">var</span> sched;
            sched = _.find(_this.schedulables, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(s)</span> {</span>
              <span class="hljs-keyword">return</span> s.json.PARENT_UID === uid;
            });
            <span class="hljs-keyword">if</span> (sched) {
              cb(sched);
            }
          };
        })(<span class="hljs-keyword">this</span>));
        pubsub.subscribe(<span class="hljs-string">"GET_MED"</span>, (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_this)</span> {</span>
          <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(uid, cb)</span> {</span>
            <span class="hljs-keyword">var</span> sched;
            sched = _.find(_this.meds, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(s)</span> {</span>
              <span class="hljs-keyword">return</span> s.uid === uid;
            });
            <span class="hljs-keyword">if</span> (sched) {
              cb(sched);
            }
          };
        })(<span class="hljs-keyword">this</span>));
        pubsub.subscribe(<span class="hljs-string">"DELETE_SCHEDULABLE_"</span> + <span class="hljs-keyword">this</span>.unixStamp, (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_this)</span> {</span>
          <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(uid)</span> {</span>
            _this.appts = _.reject(_this.appts, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span> {</span>
              <span class="hljs-keyword">return</span> a.uid === uid;
            });
            _this.medinstances = _.reject(_this.medinstances, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(m)</span> {</span>
              <span class="hljs-keyword">return</span> m.uid === uid;
            });
            _this.notes = _.reject(_this.notes, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(n)</span> {</span>
              <span class="hljs-keyword">return</span> n.uid === uid;
            });
            _this.orders = _.reject(_this.orders, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(o)</span> {</span>
              <span class="hljs-keyword">return</span> o.uid === uid;
            });
            _this.sortSchedulables();
          };
        })(<span class="hljs-keyword">this</span>));
        <span class="hljs-comment">/* during [re/scheduling](./modalcalendardir.html), the rescheduler asks
        all dates for instances of a schedulable. if found, the date is added
        to the schedule  */</span>
        $scope.$on(<span class="hljs-string">'findInstances'</span>, (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_this)</span> {</span>
          <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ev, uid)</span> {</span>
            <span class="hljs-keyword">var</span> found;
            found = _.find(_this.schedulables, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(s)</span> {</span>
              <span class="hljs-keyword">return</span> s.uid === uid;
            });
            <span class="hljs-keyword">if</span> (found) {
              $scope.$emit(<span class="hljs-string">'addInstance'</span>, _this.unixStamp);
            }
          };
        })(<span class="hljs-keyword">this</span>));
      }
      <span class="hljs-comment">/* will concat all object arrays and sort by time, ascending, on-the-fly, its
      schedulable array */</span>
      Date_.prototype.sortSchedulables = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">this</span>.schedulables = <span class="hljs-keyword">this</span>.appts.concat(<span class="hljs-keyword">this</span>.orders).concat(<span class="hljs-keyword">this</span>.medinstances).concat(<span class="hljs-keyword">this</span>.notes);
        <span class="hljs-keyword">this</span>.schedulables = _.sortBy(<span class="hljs-keyword">this</span>.schedulables, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(s)</span> {</span>
          <span class="hljs-keyword">return</span> s.toUnix();
        });
      };</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>retrieves all the uids of the schedulables</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Date_.prototype.uids = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> _.foldl(<span class="hljs-keyword">this</span>.schedulables, (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(memo, s)</span> {</span>
          <span class="hljs-keyword">return</span> memo.concat(s.uids());
        }), []);
      };</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>of its orders, returns only those that are part of a regimen</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Date_.prototype.getChemoOrders = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> _.filter(<span class="hljs-keyword">this</span>.orders, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(order)</span> {</span>
          <span class="hljs-keyword">return</span> order.fromChemo;
        });
      };</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>of its orders, returns only those that are <strong>not</strong> part of a regimen</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Date_.prototype.getPlanOrders = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> _.filter(<span class="hljs-keyword">this</span>.orders, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(order)</span> {</span>
          <span class="hljs-keyword">return</span> !order.fromChemo;
        });
      };</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>indicates that this date has no appts nor any non-regimen plans</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Date_.prototype.noAppts = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.appts.length === <span class="hljs-number">0</span> &amp;&amp; <span class="hljs-keyword">this</span>.getPlanOrders().length === <span class="hljs-number">0</span>;
      };</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>indicates that this date has no regimen plans</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Date_.prototype.noChemo = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.getChemoOrders().length === <span class="hljs-number">0</span>;
      };</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>indicates that this date has no medications scheduled</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Date_.prototype.noMeds = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.medinstances.length === <span class="hljs-number">0</span>;
      };</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>indicates that this date has no notes added</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Date_.prototype.noNotes = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.notes.length === <span class="hljs-number">0</span>;
      };</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>used to determine if it’s the first day of the month</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Date_.prototype.isFirstOfMonth = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> moment(<span class="hljs-keyword">this</span>.unixStamp).format(<span class="hljs-string">'D'</span>) === <span class="hljs-string">'1'</span>;
      };
      
      <span class="hljs-keyword">return</span> Date_;

    })();
   <span class="hljs-comment">/* now that all classes are defined, we begin the $scope logic

    calculate today and sunday's midnight, set them on the **vars**
    [global object](./appmod.html#vars) (yuck).  */</span>
    todayMidnight = moment().startOf(<span class="hljs-string">'day'</span>);
    sundayMidnight = todayMidnight.clone().subtract(<span class="hljs-string">'days'</span>, todayMidnight.day());
    vars.todayMidnight = todayMidnight;
    vars.sundayMidnight = sundayMidnight;
    <span class="hljs-comment">/* these "show" fields are toggled by the [display filter](./displayfiltersdir.html)
    and are $watch-ed and $broadcast-ed to all the views, when changed */</span>
    $scope.showDialog = <span class="hljs-literal">false</span>;
    $scope.showAccord = vars.showAccord;
    $scope.showList = vars.showList;
    $scope.showEst = vars.showEst;
    $scope.showSched = vars.showSched;
    $scope.showAppts = vars.showAppts;
    $scope.showChemo = vars.showChemo;
    $scope.showMeds = vars.showMeds;
    $scope.showNotes = vars.showNotes;
    $scope.appts = [];
    $scope.chemos = [];
    $scope.dates = [];
    $scope.meds = [];
    $scope.plans = [];
    <span class="hljs-comment">/* Data can come back from as far as 35 days in the past.  Adding extra Date_ objects
    to support this functionality.  */</span>
    earliestDate = sundayMidnight.subtract(<span class="hljs-string">'days'</span>, <span class="hljs-number">35</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Blake’s change</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> (i = _i = <span class="hljs-number">0</span>; _i &lt;= vars.daysRange; i = ++_i) {
      <span class="hljs-comment">/* create one year of `Date_`s, starting from this sunday's midnight
      &lt;a name="date_creation"&gt;&lt;/a&gt;  */</span>
      $scope.dates.push(<span class="hljs-keyword">new</span> Date_(earliestDate.clone().add(<span class="hljs-string">'days'</span>, i).valueOf()));
    }
    $scope.slice = [];
    $scope.startingIndex = <span class="hljs-number">0</span>;
    $scope.userClick = <span class="hljs-literal">false</span>;
    lastDate = moment($scope.dates[vars.daysRange].unixStamp).format(<span class="hljs-string">'YYYY-MM-DD'</span> + <span class="hljs-string">'T'</span> + <span class="hljs-string">'HH:mm:ss'</span>);
    <span class="hljs-comment">/* This dummy note is made because if the user tries to submit a new note from
    (./adddialogdir.html) then there has to be a schedulable item to pass to the pub/sub
    service.  Since the NoteInstance class belongs to appctrl, this dummy note has
    to be initialized here instead of in adddialogdir only when needed.   */</span>
    dummyNote = <span class="hljs-keyword">new</span> NoteInstance({
      <span class="hljs-string">'ONC_TC_CAL_ITEMS_ID'</span>: <span class="hljs-number">0</span>,
      <span class="hljs-string">'NOTE_TXT'</span>: <span class="hljs-string">'dummyNote'</span>,
      <span class="hljs-string">'DATE'</span>: <span class="hljs-string">""</span> + lastDate,
      <span class="hljs-string">'ALL_DATES'</span>: <span class="hljs-string">""</span> + lastDate,
      <span class="hljs-string">'PARENT_UID'</span>: <span class="hljs-string">""</span> + (_.uniqueId())
    });
    $scope.moveBackward = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(num)</span> {</span>
      <span class="hljs-keyword">if</span> ($scope.startingIndex - num &gt;= <span class="hljs-number">0</span>) {
        $scope.startingIndex -= num;
      }
      $scope.userClick = <span class="hljs-literal">true</span>;
    };
    $scope.moveForward = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(num)</span> {</span>
      <span class="hljs-keyword">if</span> ($scope.startingIndex + num &lt; vars.daysRange) {
        $scope.startingIndex += num;
      }
      $scope.userClick = <span class="hljs-literal">true</span>;
    };
    $scope.$watch(<span class="hljs-string">'startingIndex'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(startingIndex)</span> {</span>
      <span class="hljs-keyword">if</span> (startingIndex &gt;= <span class="hljs-number">0</span>) {
        $scope.slice = $scope.dates.slice(startingIndex, startingIndex + <span class="hljs-number">35</span>);
      }
    });
    <span class="hljs-comment">/* various "show" state $watch-es. as state is changed, events are broadcasted
    to inform all the various views to update their presentation logic.  */</span>
    $scope.$watch(<span class="hljs-string">'showAccord'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(showAccord)</span> {</span>
      vars.showAccord = showAccord;
      $scope.$broadcast(<span class="hljs-string">'showAccord'</span>, showAccord);
      
      <span class="hljs-keyword">if</span>(vars.prefContext !== <span class="hljs-string">''</span> )
      {
      	 vars.prefSeq = <span class="hljs-number">1</span>;
	     validatePrefChanges();	     
	  }
    });
    $scope.$watch(<span class="hljs-string">'showList'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(showList)</span> {</span>
       vars.showList = showList;	
      $scope.$broadcast(<span class="hljs-string">'showList'</span>, showList);
      <span class="hljs-keyword">if</span>(vars.prefContext !== <span class="hljs-string">''</span> ){
      	 vars.prefSeq = <span class="hljs-number">2</span>;
	     validatePrefChanges();	      
	     }
    });
    $scope.$watch(<span class="hljs-string">'showSched'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(showSched)</span> {</span>
    	vars.showSched = showSched;	
    	$scope.$broadcast(<span class="hljs-string">'showSched'</span>, showSched);
       <span class="hljs-keyword">if</span>(vars.showNothing !== <span class="hljs-number">1</span>)
       {
         $scope.$broadcast(<span class="hljs-string">'displayCalViewItems'</span>);
         <span class="hljs-keyword">if</span>(vars.prefContext !== <span class="hljs-string">''</span> )
         {
         	vars.prefSeq = <span class="hljs-number">3</span>;
		    validatePrefChanges();		    
		 }
       }
    });
     $scope.$watch(<span class="hljs-string">'showEst'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(showEst)</span> {</span>
    	vars.showEst = showEst;	
    	$scope.$broadcast(<span class="hljs-string">'showEst'</span>, showEst); 
       <span class="hljs-keyword">if</span>(vars.showNothing !== <span class="hljs-number">1</span>)
       {
         $scope.$broadcast(<span class="hljs-string">'displayCalViewItems'</span>);
         <span class="hljs-keyword">if</span>(vars.prefContext !== <span class="hljs-string">''</span> )
         {
         	vars.prefSeq = <span class="hljs-number">4</span>;
		    validatePrefChanges();
		 }
       }
    });
    $scope.$watch(<span class="hljs-string">'showAppts'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(showAppts)</span> {</span>
    	vars.showAppts = showAppts;	
      $scope.$broadcast(<span class="hljs-string">'showAppts'</span>, showAppts);
       <span class="hljs-keyword">if</span>(vars.showNothing !== <span class="hljs-number">1</span>)
	   {
         $scope.$broadcast(<span class="hljs-string">'displayCalViewItems'</span>);
         <span class="hljs-keyword">if</span>(vars.prefContext !== <span class="hljs-string">''</span> ){
         	vars.prefSeq = <span class="hljs-number">5</span>;
	        validatePrefChanges();	        
	        }
	   }
    });
    $scope.$watch(<span class="hljs-string">'showChemo'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(showChemo)</span> {</span>
    	
     vars.showChemo = showChemo;	
      $scope.$broadcast(<span class="hljs-string">'showChemo'</span>, showChemo);
       <span class="hljs-keyword">if</span>(vars.showNothing !== <span class="hljs-number">1</span>)
	   {
        $scope.$broadcast(<span class="hljs-string">'displayCalViewItems'</span>);
        <span class="hljs-keyword">if</span>(vars.prefContext !== <span class="hljs-string">''</span> ){
           vars.prefSeq = <span class="hljs-number">6</span>;
	       validatePrefChanges();
	       }
	   }
    });
    $scope.$watch(<span class="hljs-string">'showMeds'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(showMeds)</span> {</span>
       vars.showMeds = showMeds;		
      $scope.$broadcast(<span class="hljs-string">'showMeds'</span>, showMeds);
       <span class="hljs-keyword">if</span>(vars.showNothing !== <span class="hljs-number">1</span>)
	   {
        $scope.$broadcast(<span class="hljs-string">'displayCalViewItems'</span>);
        <span class="hljs-keyword">if</span>(vars.prefContext !== <span class="hljs-string">''</span> ){
           vars.prefSeq = <span class="hljs-number">7</span>;
	       validatePrefChanges();
	       }
	   }
    });
    $scope.$watch(<span class="hljs-string">'showNotes'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(showNotes)</span> {</span>
      vars.showNotes = showNotes;		
      $scope.$broadcast(<span class="hljs-string">'showNotes'</span>, showNotes);
      $scope.$broadcast(<span class="hljs-string">'displayCalViewItems'</span>);
	  <span class="hljs-keyword">if</span>(vars.showNothing !== <span class="hljs-number">1</span>)
	  {
	  	 vars.prefSeq = <span class="hljs-number">8</span>;
	     validatePrefChanges();	     
	  }
    });
    $scope.$watch(<span class="hljs-string">'slice'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(slice)</span> {</span>
      $scope.$broadcast(<span class="hljs-string">'sliceChanged'</span>, slice);
      $scope.$broadcast(<span class="hljs-string">'setListMonth'</span>, _.str.capitalize(moment($scope.dates[$scope.startingIndex].unixStamp).format(<span class="hljs-string">'MMMM YYYY'</span>)) );     
    });
    <span class="hljs-comment">/* a convenient encapsulation of the data object that will be used for the ajax
    call (e.g. error, ajax params, success, url, etc).  */</span>
      getCalItemsData = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    	   <span class="hljs-keyword">var</span> timerMPage;
		   <span class="hljs-keyword">try</span>{
			 timerMPage  = MP_Util.CreateTimer(<span class="hljs-string">"ENG:MPG TC Load Appointments"</span>);
			  <span class="hljs-keyword">if</span>(timerMPage)
				  timerMPage.Start();
			  }
		   <span class="hljs-keyword">catch</span>(err)
		   {
			  log.info(<span class="hljs-string">'err.description'</span>);
		   }
		  
      <span class="hljs-keyword">return</span> {
        error: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data, status, headers, config)</span> {</span>
		  <span class="hljs-keyword">try</span>{
			   <span class="hljs-keyword">if</span> (timerMPage){
	          	timerMPage.Stop();
			  }
			}
		   <span class="hljs-keyword">catch</span>(err)
		   {
			  log.info(<span class="hljs-string">'err.description'</span>);
		   }
			
          log.error(<span class="hljs-string">"status: "</span> + status + <span class="hljs-string">"\n"</span>);
          log.error(<span class="hljs-string">"data: "</span> + data + <span class="hljs-string">"\n\n"</span>);
          log.error(<span class="hljs-string">'Error occurred in onc_tc_get_sched_items.  No appointments or orders will be displayed.'</span>);
          <span class="hljs-keyword">var</span> appError = i18n.oncology.calview.APP_ERROR;
          alert(appError);
          $scope.$broadcast(<span class="hljs-string">'resumeWatchers'</span>);
          $(<span class="hljs-string">'#loading-spinner'</span>).hide();
          <span class="hljs-keyword">if</span>($scope.plans.length == <span class="hljs-number">0</span>)
          {
          	 $(<span class="hljs-string">'#loading-spinner-plans'</span>).hide();
          }
          <span class="hljs-keyword">if</span>($scope.appts.length == <span class="hljs-number">0</span>)
          {
          	 $(<span class="hljs-string">'#loading-spinner-appts'</span>).hide();
          }
          <span class="hljs-keyword">if</span>($scope.chemos.length == <span class="hljs-number">0</span>)
          {
          	 $(<span class="hljs-string">'#loading-spinner-chemos'</span>).hide();
          }  
          $scope.moveForward(<span class="hljs-number">35</span>);  
          $scope.$apply();
                  
        },
        params: <span class="hljs-string">"'MINE',"</span> + vars.person_id + <span class="hljs-string">".0,"</span> + vars.prsnl_id + <span class="hljs-string">".0,"</span> + vars.encntr_id + <span class="hljs-string">".0,0"</span>,
        success: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data, status, headers, config)</span> {</span>
        	
          <span class="hljs-keyword">try</span>{
			<span class="hljs-keyword">if</span> (timerMPage)
		        timerMPage.Stop();
			  }
		   <span class="hljs-keyword">catch</span>(err)
		   {
			  log.info(<span class="hljs-string">'err.description'</span>);
		   }
		
          <span class="hljs-keyword">var</span> appt, date_, json, plan, _j, _len, _ref;
          log.debug(<span class="hljs-string">"status: "</span> + status + <span class="hljs-string">"\n"</span>);
          log.debug(<span class="hljs-string">"data: "</span> + (<span class="hljs-built_in">JSON</span>.stringify(data[<span class="hljs-number">0</span>])) + <span class="hljs-string">"\n\n"</span>);
          json = data[<span class="hljs-number">0</span>].RECORD_DATA;
          <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> console !== <span class="hljs-string">"undefined"</span> &amp;&amp; console !== <span class="hljs-literal">null</span> ? console.dir : <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>) {
            console.dir(json);
          }

          $scope.appts = (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> _j, _len, _ref, _results;
            _ref = json.APPTS.SCHED_ORDERS;
            _results = [];
            <span class="hljs-keyword">for</span> (_j = <span class="hljs-number">0</span>, _len = _ref.length; _j &lt; _len; _j++) {
              appt = _ref[_j];
              _results.push(<span class="hljs-keyword">new</span> Appointment(appt));
            }
            <span class="hljs-keyword">return</span> _results;
          })();
          
          <span class="hljs-keyword">if</span>($scope.appts.length == <span class="hljs-number">0</span>)
          {
          	 $(<span class="hljs-string">'#loading-spinner-appts'</span>).hide();
          }
          
          
          $scope.chemos = (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> _j, _len, _ref, _results;
            _ref = json.REGIMEN_APPTS;
            _results = [];
            <span class="hljs-keyword">for</span> (_j = <span class="hljs-number">0</span>, _len = _ref.length; _j &lt; _len; _j++) {
              regimen = _ref[_j];
              _results.push(<span class="hljs-keyword">new</span> Regimen(regimen, <span class="hljs-literal">true</span>));
            }
            <span class="hljs-keyword">return</span> _results;
          })();
          
          <span class="hljs-keyword">if</span>($scope.chemos.length == <span class="hljs-number">0</span>)
          {
          	 $(<span class="hljs-string">'#loading-spinner-chemos'</span>).hide();
          }
          
          $scope.plans = (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> _j, _len, _ref, _results;
            _ref = json.APPTS.PLANS;
            _results = [];
            <span class="hljs-keyword">for</span> (_j = <span class="hljs-number">0</span>, _len = _ref.length; _j &lt; _len; _j++) {
              plan = _ref[_j];
 			 _results.push(<span class="hljs-keyword">new</span> Plan(plan,_results, <span class="hljs-literal">false</span>,_j));
            }
            <span class="hljs-keyword">return</span> _results;
          })();
          <span class="hljs-keyword">if</span>($scope.plans.length == <span class="hljs-number">0</span>)
          {
          	 $(<span class="hljs-string">'#loading-spinner-plans'</span>).hide();
          }
          
          
          
          _ref = $scope.dates;
          <span class="hljs-keyword">for</span> (_j = <span class="hljs-number">0</span>, _len = _ref.length; _j &lt; _len; _j++) {
            date_ = _ref[_j];
            date_.sortSchedulables();
          }
          
          $scope.$broadcast(<span class="hljs-string">'resumeWatchers'</span>);
          $(<span class="hljs-string">'#loading-spinner'</span>).hide();  
          $scope.moveForward(<span class="hljs-number">35</span>);  
          $scope.$apply();           
        },
        url: <span class="hljs-string">'onc_tc_get_sched_items'</span>
      };
    };
    getPrescriptions = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
     <span class="hljs-keyword">var</span> timerMPage;
		<span class="hljs-keyword">try</span>{
		   timerMPage = MP_Util.CreateTimer(<span class="hljs-string">"ENG:MPG TC Load Prescriptions"</span>);
			  <span class="hljs-keyword">if</span>(timerMPage)
			  {
				  timerMPage.Start();
				  
			  }
		  }
		   <span class="hljs-keyword">catch</span>(err)
		   {
			  log.info(<span class="hljs-string">'err.description'</span>);
		   }
		
      <span class="hljs-keyword">return</span> {
        error: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data, status, headers, config)</span> {</span>
			<span class="hljs-keyword">try</span>{
				<span class="hljs-keyword">if</span> (timerMPage){
					timerMPage.Stop();
				  }
			  }
		   <span class="hljs-keyword">catch</span>(err)
		   {
			  log.info(<span class="hljs-string">'err.description'</span>);
		   }
			
          log.error(<span class="hljs-string">"status: "</span> + status + <span class="hljs-string">"\n"</span>);
          log.error(<span class="hljs-string">"data: "</span> + data + <span class="hljs-string">"\n\n"</span>);
          log.error(<span class="hljs-string">'Error occurred in onc_tc_get_rx.  Prescriptions will not be displayed.'</span>);
          <span class="hljs-keyword">var</span> prescError = i18n.oncology.calview.PRESC_ERROR;
          alert(prescError);
          <span class="hljs-keyword">if</span>($scope.meds.length == <span class="hljs-number">0</span>)
          {
          	 $(<span class="hljs-string">'#loading-spinner-meds'</span>).hide();
          }
        },
        params: <span class="hljs-string">"'MINE',"</span> + vars.person_id + <span class="hljs-string">".0,"</span> +  <span class="hljs-string">"0.0,0"</span>,
        success: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data, status, headers, config)</span> {</span>
          <span class="hljs-keyword">try</span>{	
			<span class="hljs-keyword">if</span> (timerMPage){
	          	timerMPage.Stop();
			  }
			  }
		   <span class="hljs-keyword">catch</span>(err)
		   {
			  log.info(<span class="hljs-string">'err.description'</span>);
		   }
					       	
          <span class="hljs-keyword">var</span> date_, json, med, _j, _len, _ref;
          log.debug(<span class="hljs-string">"status: "</span> + status + <span class="hljs-string">"\n"</span>);
          log.debug(<span class="hljs-string">"data: "</span> + (<span class="hljs-built_in">JSON</span>.stringify(data[<span class="hljs-number">0</span>])) + <span class="hljs-string">"\n\n"</span>);
          json = data[<span class="hljs-number">0</span>].RECORD_DATA;
          <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> console !== <span class="hljs-string">"undefined"</span> &amp;&amp; console !== <span class="hljs-literal">null</span> ? console.dir : <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>) {
            console.dir(json);
          }
          $scope.meds = (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> _j, _len, _ref, _results;
            _ref = json.MEDS;
            _results = [];
            <span class="hljs-keyword">for</span> (_j = <span class="hljs-number">0</span>, _len = _ref.length; _j &lt; _len; _j++) {
              med = _ref[_j];
              _results.push(<span class="hljs-keyword">new</span> Medication(med));
            }
            <span class="hljs-keyword">return</span> _results;
          })();
          

          
          _ref = $scope.dates;
          <span class="hljs-keyword">for</span> (_j = <span class="hljs-number">0</span>, _len = _ref.length; _j &lt; _len; _j++) {
            date_ = _ref[_j];
            date_.sortSchedulables();
          }
          
          <span class="hljs-keyword">if</span>($scope.meds.length == <span class="hljs-number">0</span>)
          {
          	 $(<span class="hljs-string">'#loading-spinner-meds'</span>).hide();
          }
          
          $scope.$apply();
        },
        url: <span class="hljs-string">'onc_tc_get_rx'</span>
      };
    };
    getNotes = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
     	<span class="hljs-keyword">var</span> timerMPage;
		<span class="hljs-keyword">try</span>{
		  timerMPage = MP_Util.CreateTimer(<span class="hljs-string">"ENG:MPG TC Load Notes"</span>);
		  <span class="hljs-keyword">if</span>(timerMPage)
			  timerMPage.Start();
		  
	   }
	   <span class="hljs-keyword">catch</span>(err)
	   {
		  log.info(<span class="hljs-string">'err.description'</span>);
       }
		   
		
		
      <span class="hljs-keyword">return</span> {
        error: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data, status, headers, config)</span> {</span>
			<span class="hljs-keyword">try</span>{
			 <span class="hljs-keyword">if</span> (timerMPage){
	          	  timerMPage.Stop();
			  }
			}
		   <span class="hljs-keyword">catch</span>(err)
		   {
			  log.info(<span class="hljs-string">'err.description'</span>);
	       }
          log.error(<span class="hljs-string">"status: "</span> + status + <span class="hljs-string">"\n"</span>);
          log.error(<span class="hljs-string">"data: "</span> + data + <span class="hljs-string">"\n\n"</span>);
          log.error(<span class="hljs-string">'Error occurred in onc_tc_get_notes.  Notes will not be displayed.'</span>);
          <span class="hljs-keyword">var</span> notesError = i18n.oncology.calview.NOTES_ERROR;
          alert(notesError);
          
        },
        params: <span class="hljs-string">"'MINE',"</span> + vars.person_id + <span class="hljs-string">".0,0"</span>,
        success: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data, status, headers, config)</span> {</span>
        	
        <span class="hljs-keyword">try</span>{	
			<span class="hljs-keyword">if</span> (timerMPage){
	            timerMPage.Stop();
			  }
		   }
		   <span class="hljs-keyword">catch</span>(err)
		   {
			  log.info(<span class="hljs-string">'err.description'</span>);
		   }
          <span class="hljs-keyword">var</span> date_, json, note, _j, _len, _ref, _results;
          log.debug(<span class="hljs-string">"status: "</span> + status + <span class="hljs-string">"\n"</span>);
          log.debug(<span class="hljs-string">"data: "</span> + (<span class="hljs-built_in">JSON</span>.stringify(data[<span class="hljs-number">0</span>])) + <span class="hljs-string">"\n\n"</span>);
          json = data[<span class="hljs-number">0</span>].RECORD_DATA;
          <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> console !== <span class="hljs-string">"undefined"</span> &amp;&amp; console !== <span class="hljs-literal">null</span> ? console.dir : <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>) {
            console.dir(json);
          }
          $scope.notes = (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> _j, _len, _ref, _results;
            _ref = json.NOTES;
            _results = [];
            <span class="hljs-keyword">for</span> (_j = <span class="hljs-number">0</span>, _len = _ref.length; _j &lt; _len; _j++) {
              note = _ref[_j];
              _results.push(<span class="hljs-keyword">new</span> Note(note));
            }
            <span class="hljs-keyword">return</span> _results;
          })();
          _ref = $scope.dates;
          _results = [];
          <span class="hljs-keyword">for</span> (_j = <span class="hljs-number">0</span>, _len = _ref.length; _j &lt; _len; _j++) {
            date_ = _ref[_j];
            _results.push(date_.sortSchedulables());
          }
          <span class="hljs-keyword">return</span> _results;
        },
        url: <span class="hljs-string">'onc_tc_get_notes'</span>
      };
    };
    <span class="hljs-comment">/* saveCheckedStatus is for the script call that saves which Prescriptions are checked.
    It is called whenever a checkbox by a prescription is clicked.  */</span>
    saveCheckedStatus = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(orderId, checkedStatus)</span> {</span>
      <span class="hljs-keyword">return</span> {
        error: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data, status, headers, config)</span> {</span>
          log.error(<span class="hljs-string">"status: "</span> + status + <span class="hljs-string">"\n"</span>);
          log.error(<span class="hljs-string">"data: "</span> + data + <span class="hljs-string">"\n\n"</span>);
        },
        params: <span class="hljs-string">"'MINE',"</span> + vars.encntr_id + <span class="hljs-string">".0,"</span> + vars.person_id + <span class="hljs-string">".0,"</span> + orderId + <span class="hljs-string">".0,"</span> + checkedStatus,
        success: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data, status, headers, config)</span> {</span>
          log.debug(<span class="hljs-string">"status: "</span> + status + <span class="hljs-string">"\n"</span>);
          log.debug(<span class="hljs-string">"data: "</span> + (<span class="hljs-built_in">JSON</span>.stringify(data[<span class="hljs-number">0</span>])) + <span class="hljs-string">"\n\n"</span>);
        },
        url: <span class="hljs-string">'onc_tc_save_rx_checked_status'</span>
      };
    };
    validatePrefChanges = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    	        <span class="hljs-keyword">var</span> userPrefs = <span class="hljs-string">''</span>;			
			    <span class="hljs-keyword">if</span>(vars.showAccord == <span class="hljs-literal">true</span>)
			       userPrefs  = userPrefs +<span class="hljs-string">'1,'</span>;
			    <span class="hljs-keyword">else</span>
			       userPrefs  = userPrefs +<span class="hljs-string">'0,'</span>;
			    
			    <span class="hljs-keyword">if</span>(vars.showList == <span class="hljs-literal">true</span>)
			      userPrefs  = userPrefs +<span class="hljs-string">'1,'</span>;
			    <span class="hljs-keyword">else</span>
			      userPrefs  = userPrefs +<span class="hljs-string">'0,'</span>;
			    
			    <span class="hljs-keyword">if</span>(vars.showSched == <span class="hljs-literal">true</span>)
			      userPrefs  = userPrefs +<span class="hljs-string">'1,'</span>;
			    <span class="hljs-keyword">else</span>
			      userPrefs  = userPrefs +<span class="hljs-string">'0,'</span>;
			    
			    <span class="hljs-keyword">if</span>(vars.showEst == <span class="hljs-literal">true</span>)
			      userPrefs  = userPrefs +<span class="hljs-string">'1,'</span>;
			    <span class="hljs-keyword">else</span>
			      userPrefs  = userPrefs +<span class="hljs-string">'0,'</span>;
			    
			    <span class="hljs-keyword">if</span>(vars.showAppts == <span class="hljs-literal">true</span>)
			     userPrefs  = userPrefs +<span class="hljs-string">'1,'</span>;
			    <span class="hljs-keyword">else</span>
			     userPrefs  = userPrefs +<span class="hljs-string">'0,'</span>;
			    
			    <span class="hljs-keyword">if</span>(vars.showChemo == <span class="hljs-literal">true</span>)
			     userPrefs  = userPrefs +<span class="hljs-string">'1,'</span>;
			    <span class="hljs-keyword">else</span>
			     userPrefs  = userPrefs +<span class="hljs-string">'0,'</span>;
			    
			    <span class="hljs-keyword">if</span>(vars.showMeds == <span class="hljs-literal">true</span>)
			      userPrefs  = userPrefs +<span class="hljs-string">'1,'</span>;
			    <span class="hljs-keyword">else</span>
			      userPrefs  = userPrefs +<span class="hljs-string">'0,'</span>;
			    
			    <span class="hljs-keyword">if</span>(vars.showNotes == <span class="hljs-literal">true</span>)
			      userPrefs  = userPrefs +<span class="hljs-string">'1'</span>;
			    <span class="hljs-keyword">else</span>
			      userPrefs  = userPrefs +<span class="hljs-string">'0'</span>; 
			      
			      <span class="hljs-keyword">if</span>(vars.prefContext === <span class="hljs-string">''</span> )
			         vars.prefContext = userPrefs;
			         
			      <span class="hljs-keyword">if</span>(vars.prefContext !== userPrefs)
			       {
			       	vars.prefContext = userPrefs;
			       	dao.call(savePreferences());
			       } 
    };
	savePreferences = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>	
			
            <span class="hljs-keyword">return</span> {
              error: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data, status, headers, config)</span> {</span>
                log.error(<span class="hljs-string">"status: "</span> + status + <span class="hljs-string">"\n"</span>);
                log.error(<span class="hljs-string">"data: "</span> + data + <span class="hljs-string">"\n\n"</span>);
                 <span class="hljs-keyword">var</span> docError = i18n.oncology.calview.SAVE_PREF_ERROR;
                 alert(docError);
                 log.error(<span class="hljs-string">'Failed to save Preferences for user.'</span>);
              },
              params: <span class="hljs-string">"'MINE',"</span> + vars.prefContext + <span class="hljs-string">','</span> + vars.prefSeq,
              success: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data, status, headers, config)</span> {</span>
                log.debug(<span class="hljs-string">"status: "</span> + status + <span class="hljs-string">"\n"</span>);
                log.debug(<span class="hljs-string">"data: "</span> + (<span class="hljs-built_in">JSON</span>.stringify(data[<span class="hljs-number">0</span>])) + <span class="hljs-string">"\n\n"</span>);
              },
              url: <span class="hljs-string">'onc_tc_save_preferences'</span>
            };
          };
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">/* This is where the inital script calls occur.  Notice the broadcasts at the beginning.
      That change was made to accommodate the slowness IE8 has with Angular's $watch functions.  
      It removes the $watch functions from all the directives until the scripts return, causing a
      large performance boost in initial load in IE8.  */</span>
      $scope.$broadcast(<span class="hljs-string">'suspendWatchers'</span>);
      $(<span class="hljs-string">'#loading-spinner'</span>).show();

      dao.call(getCalItemsData());
      dao.call(getPrescriptions());
      dao.call(getNotes());  
     

    } <span class="hljs-keyword">catch</span> (_error) {
      e = _error;
      log.error(e);
    }
  }
]);</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
