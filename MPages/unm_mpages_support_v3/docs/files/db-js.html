<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">

<html><head><title>/www/mpages_googlecode/univnm/db.js</title><link rel="stylesheet" type="text/css" href="../styles/main.css"><script language=JavaScript src="../javascript/main.js"></script><script language=JavaScript src="../javascript/searchdata.js"></script><script type="text/javascript" src="../shjs/sh_main.js"></script><script type="text/javascript" src="../shjs/lang/sh_myna.js"></script><link type="text/css" rel="stylesheet" href="../shjs/css/sh_mild_white.css"><script type="text/javascript" src="../../../../js/shjs/sh_main.js"></script><script type="text/javascript" src="../../../../js/shjs/lang/sh_myna.js"></script><link type="text/css" rel="stylesheet" href="../../../../js/shjs/css/sh_mild_white.css"><script type="text/javascript" src="../../../../../js/shjs/sh_main.js"></script><script type="text/javascript" src="../../../../../js/shjs/lang/sh_myna.js"></script><link type="text/css" rel="stylesheet" href="../../../../../js/shjs/css/sh_mild_white.css"></head><body id=ContentPage onLoad="NDOnLoad();sh_highlightDocument();"><script language=JavaScript><!--
if (browserType) {document.write("<div id=" + browserType + ">");if (browserVer) {document.write("<div id=" + browserVer + ">"); }}// --></script>

<!--  Generated by Natural Docs, version Development Release 02-10-2007 (1.35 base) -->
<!--  http://www.naturaldocs.org  -->

<!-- saved from url=(0026)http://www.naturaldocs.org -->




<div id=Content><div class="CFile CTopic" id=MainTopic><h1 class=CTitle><a name="db.js"></a>db.js</h1><div class=CBody><!--START_ND_SUMMARY--><div class=Summary><div class=STitle>Summary</div><div class=SBody><table border=0 cellspacing=0 cellpadding=0 class=STable><tr class="SMain"><td class=SEntry><a href="#db.js" >db.js</a></td><td class=SDescription></td></tr><tr class="SGeneric SMarked"><td class=SEntry><a href="#Dependencies" >Dependencies</a></td><td class=SDescription>The univnm.db.query and univnm.db.saveRow functions have certain Oracle, CCL, and JS library dependencies</td></tr><tr class="SGeneric"><td class=SEntry><a href="#License" >License</a></td><td class=SDescription>The MIT License</td></tr><tr class="SClass"><td class=SEntry><a href="#univnm.db" >univnm.db</a></td><td class=SDescription></td></tr><tr class="SGroup SIndent1"><td class=SEntry><a href="#univnm.db.Functions_and_Properties" >Functions and Properties</a></td><td class=SDescription></td></tr><tr class="SFunction SIndent2 SMarked"><td class=SEntry><a href="#univnm.db.univnm.db.query" id=link1 onMouseOver="ShowTip(event, 'tt1', 'link1')" onMouseOut="HideTip('tt1')">univnm.<span class=HB> </span>db.<span class=HB> </span>query</a></td><td class=SDescription>Queries the server and returns a <a href="jslib-js.html#univnm.DataSet" class=LClass id=link2 onMouseOver="ShowTip(event, 'tt2', 'link2')" onMouseOut="HideTip('tt2')">univnm.DataSet</a> object of the results</td></tr><tr class="SProperty SIndent2"><td class=SEntry><a href="#univnm.db.univnm.db.codeCache" >univnm.<span class=HB> </span>db.<span class=HB> </span>codeCache</a></td><td class=SDescription>contains a chacke of code values by code set and display key</td></tr><tr class="SFunction SIndent2 SMarked"><td class=SEntry><a href="#univnm.db.univnm.db.codeLookup" id=link3 onMouseOver="ShowTip(event, 'tt3', 'link3')" onMouseOut="HideTip('tt3')">univnm.<span class=HB> </span>db.<span class=HB> </span>codeLookup</a></td><td class=SDescription>looks up a code from the code_value table.</td></tr><tr class="SFunction SIndent2"><td class=SEntry><a href="#univnm.db.univnm.db.cacheCodes" id=link4 onMouseOver="ShowTip(event, 'tt4', 'link4')" onMouseOut="HideTip('tt4')">univnm.<span class=HB> </span>db.<span class=HB> </span>cacheCodes</a></td><td class=SDescription>preCaches code values so that calls to &lt;codeLookup&gt; run faster</td></tr><tr class="SFunction SIndent2 SMarked"><td class=SEntry><a href="#univnm.db.univnm.db.toDate" id=link5 onMouseOver="ShowTip(event, 'tt5', 'link5')" onMouseOut="HideTip('tt5')">univnm.<span class=HB> </span>db.<span class=HB> </span>toDate</a></td><td class=SDescription>converts a JS date into a Oracle to_date function string</td></tr><tr class="SFunction SIndent2"><td class=SEntry><a href="#univnm.db.univnm.db.toSql" id=link6 onMouseOver="ShowTip(event, 'tt6', 'link6')" onMouseOut="HideTip('tt6')">univnm.<span class=HB> </span>db.<span class=HB> </span>toSql</a></td><td class=SDescription>converts a native JS value into an SQL string</td></tr><tr class="SFunction SIndent2 SMarked"><td class=SEntry><a href="#univnm.db.univnm.db.saveRow" id=link7 onMouseOver="ShowTip(event, 'tt7', 'link7')" onMouseOut="HideTip('tt7')">univnm.<span class=HB> </span>db.<span class=HB> </span>saveRow</a></td><td class=SDescription>Saves a row of data to a custom table</td></tr></table></div></div><!--END_ND_SUMMARY--></div></div>

<div class="CGeneric CTopic"><h3 class=CTitle><a name="Dependencies"></a>Dependencies</h3><div class=CBody><p class=CParagraph>The univnm.db.query and univnm.db.saveRow functions have certain Oracle, CCL, and JS library dependencies</p><h4 class=CHeading>Oracle Dependencies</h4><ul class=CBulletList><li>A custom schema, in your domain&rsquo;s Oracle DB called unmh</li><li>univnm/cust_tables.sql run in unmh schema</li><li>V500 must grant select to your custom schema for any tables you want to access with univnm.db.query()</li></ul><h4 class=CHeading>CCL Dependencies</h4><ul class=CBulletList><li>univnm_query_to_json.prg  (included in the univnm folder of this distribution)</li><li>univnm_row_manager.prg    (included in the univnm folder of this distribution)</li></ul><h4 class=CHeading>JS Dependencies</h4><ul class=CBulletList><li><a href="jslib-js.html#jslib.js" class=LFile >jslib.js</a></li></ul></div></div>

<div class="CGeneric CTopic"><h3 class=CTitle><a name="License"></a>License</h3><div class=CBody><p class=CParagraph>The MIT License</p><p class=CParagraph>Copyright &copy; 2012 University of New Mexico Hospitals</p><p class=CParagraph>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the &ldquo;Software&rdquo;), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p><p class=CParagraph>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p><p class=CParagraph>THE SOFTWARE IS PROVIDED &ldquo;AS IS&rdquo;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.&nbsp; IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p></div></div>

<div class="CClass CTopic"><h2 class=CTitle><a name="univnm.db"></a>univnm.db</h2><div class=CBody><!--START_ND_SUMMARY--><div class=Summary><div class=STitle>Summary</div><div class=SBody><table border=0 cellspacing=0 cellpadding=0 class=STable><tr class="SGroup"><td class=SEntry><a href="#univnm.db.Functions_and_Properties" >Functions and Properties</a></td><td class=SDescription></td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#univnm.db.univnm.db.query" id=link8 onMouseOver="ShowTip(event, 'tt1', 'link8')" onMouseOut="HideTip('tt1')">univnm.<span class=HB> </span>db.<span class=HB> </span>query</a></td><td class=SDescription>Queries the server and returns a <a href="jslib-js.html#univnm.DataSet" class=LClass id=link9 onMouseOver="ShowTip(event, 'tt2', 'link9')" onMouseOut="HideTip('tt2')">univnm.DataSet</a> object of the results</td></tr><tr class="SProperty SIndent1"><td class=SEntry><a href="#univnm.db.univnm.db.codeCache" >univnm.<span class=HB> </span>db.<span class=HB> </span>codeCache</a></td><td class=SDescription>contains a chacke of code values by code set and display key</td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#univnm.db.univnm.db.codeLookup" id=link10 onMouseOver="ShowTip(event, 'tt3', 'link10')" onMouseOut="HideTip('tt3')">univnm.<span class=HB> </span>db.<span class=HB> </span>codeLookup</a></td><td class=SDescription>looks up a code from the code_value table.</td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#univnm.db.univnm.db.cacheCodes" id=link11 onMouseOver="ShowTip(event, 'tt4', 'link11')" onMouseOut="HideTip('tt4')">univnm.<span class=HB> </span>db.<span class=HB> </span>cacheCodes</a></td><td class=SDescription>preCaches code values so that calls to &lt;codeLookup&gt; run faster</td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#univnm.db.univnm.db.toDate" id=link12 onMouseOver="ShowTip(event, 'tt5', 'link12')" onMouseOut="HideTip('tt5')">univnm.<span class=HB> </span>db.<span class=HB> </span>toDate</a></td><td class=SDescription>converts a JS date into a Oracle to_date function string</td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#univnm.db.univnm.db.toSql" id=link13 onMouseOver="ShowTip(event, 'tt6', 'link13')" onMouseOut="HideTip('tt6')">univnm.<span class=HB> </span>db.<span class=HB> </span>toSql</a></td><td class=SDescription>converts a native JS value into an SQL string</td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#univnm.db.univnm.db.saveRow" id=link14 onMouseOver="ShowTip(event, 'tt7', 'link14')" onMouseOut="HideTip('tt7')">univnm.<span class=HB> </span>db.<span class=HB> </span>saveRow</a></td><td class=SDescription>Saves a row of data to a custom table</td></tr></table></div></div><!--END_ND_SUMMARY--></div></div>

<div class="CGroup CTopic"><h3 class=CTitle><a name="univnm.db.Functions_and_Properties"></a>Functions and Properties</h3></div>

<div class="CFunction CTopic"><h3 class=CTitle><a name="univnm.db.univnm.db.query"></a>univnm.<span class=HB> </span>db.<span class=HB> </span>query</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>univnm.db.query = function query()</td></tr></table></blockquote><p class=CParagraph>Queries the server and returns a <a href="jslib-js.html#univnm.DataSet" class=LClass id=link15 onMouseOver="ShowTip(event, 'tt2', 'link15')" onMouseOut="HideTip('tt2')">univnm.DataSet</a> object of the results</p><h4 class=CHeading>Parameters</h4><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>sql</td><td class=CDLDescription>SQL to execute.&nbsp; Can be an SQL string, an array of strings, or a series of string arguments.&nbsp; See examples below</td></tr><tr><td class=CDLEntry>params</td><td class=CDLDescription><b>Optional, default null</b> if this is a function, it is assumed to be <u>callback</u>.&nbsp; If this an object, it is assumed to be the parameters to be merged into <u>sql</u></td></tr><tr><td class=CDLEntry>callback</td><td class=CDLDescription><b>Optional, default null</b> If defined, then this will be an asynchronous callback with the result returned as the first param to <u>callback</u>.&nbsp; If not defined, a synchronous callback is made and the result is returned from this function Note: any column that ends with &ldquo;dt_tm&rdquo; will added as a new column ending in &ldquo;date&rdquo; that has an actual JS date value.&nbsp; For example, a univnm.db.query that contains &ldquo;updt_dt_tm&rdquo; will have a resultset that contains a &ldquo;updt_dt_tm&rdquo; that is a string value and &ldquo;updt_date&rdquo; that is a Date() object</td></tr></table><h4 class=CHeading>SQL and Params</h4><p class=CParagraph>The SQL string passed into query is expected to be either a template to be used with <a href="jslib-js.html#String.format" class=LFunction id=link16 onMouseOver="ShowTip(event, 'tt8', 'link16')" onMouseOut="HideTip('tt8')">String.format</a> or, if ExtJS is available and Ext.XTemplate.</p><p class=CParagraph>if <u>params</u> is passed, then this object will be merged with <u>sql</u> before executing</p><h4 class=CHeading>Code Lookups</h4><p class=CParagraph>Code lookups for where clauses can be performed efficiently by using a special comment in your code: /* CODESET 72 WBC HGB HCT * / Note that there is no space between * and /.&nbsp; The result will be pasted in as a comma-separated list of code values.&nbsp; If a given display key has more than one code value in the selected code set, all values will be inserted.&nbsp; <a href="#univnm.db.univnm.db.cacheCodes" class=LFunction id=link17 onMouseOver="ShowTip(event, 'tt4', 'link17')" onMouseOut="HideTip('tt4')">univnm.db.cacheCodes</a> will be called internally to cache code values</p><h4 class=CHeading>See Also</h4><ul class=CBulletList><li><a href="#univnm.db.univnm.db.codeLookup" class=LFunction id=link18 onMouseOver="ShowTip(event, 'tt3', 'link18')" onMouseOut="HideTip('tt3')">univnm.db.codeLookup</a></li><li><a href="#univnm.db.univnm.db.cacheCodes" class=LFunction id=link19 onMouseOver="ShowTip(event, 'tt4', 'link19')" onMouseOut="HideTip('tt4')">univnm.db.cacheCodes</a></li><li><a href="jslib-js.html#String.format" class=LFunction id=link20 onMouseOver="ShowTip(event, 'tt8', 'link20')" onMouseOut="HideTip('tt8')">String.format</a></li><li><a href="http://docs.sencha.com/ext-js/4-1/#!/api/Ext.XTemplate" class=LURL>http://docs.sencha.com<span class=HB>- </span>/ext-js<span class=HB>- </span>/4-1<span class=HB>- </span>/#!<span class=HB>- </span>/api<span class=HB>- </span>/Ext.XTemplate</a></li></ul><h4 class=CHeading>Examples</h4><h4 class=CHeading>Single SQL string</h4><blockquote><pre class="CCode sh_myna">//callback can be passed as the second argument<br>univnm.db.query(<br>&quot;SELECT univnm_code.display(o.CATALOG_CD) display, O.ORIG_ORDER_DT_TM, o.CATALOG_CD FROM ORDERS O where o.active_ind = 1 AND o.encntr_id = 41416065 ORDER BY O.ORIG_ORDER_DT_TM DESC&quot;,<br>function(result){<br>    univnm.jslib.debug_window(result.toHtmlTable())<br>})</pre></blockquote><h4 class=CHeading>SQL string array param</h4><blockquote><pre class="CCode sh_myna">univnm.db.query(<br>    [<br>        'SELECT',<br>            'univnm_code.display(o.CATALOG_CD) display,',<br>            'O.ORIG_ORDER_DT_TM,',<br>            'o.CATALOG_CD',<br>        'FROM',<br>        'ORDERS O',<br>        'where',<br>            'o.active_ind = 1',<br>            'AND o.encntr_id = 41416065 ',<br>        'ORDER BY',<br>            'O.ORIG_ORDER_DT_TM   DESC '<br>    ],<br>    function(result){ //if last param is a function, it assumed to be the callback function<br>        univnm.jslib.debug_window(result.toHtmlTable())<br>    }<br>)</pre></blockquote><h4 class=CHeading>Using a template</h4><blockquote><pre class="CCode sh_myna">&lt;script&gt;<br>univnm.db.query(<br>    [<br>        'SELECT  ',<br>            'univnm_code.display(c.EVENT_CD) AS code_display ',<br>            ',univnm_code.display_key(c.EVENT_CD) AS code_display_key ',<br>            ', c.result_val as value ',<br>            ', c.event_end_dt_tm',<br><br>        'FROM clinical_event   c ',<br>        'WHERE c.person_id = {person_id} ',<br>        'AND c.event_end_dt_tm BETWEEN {start_date} AND {end_date} ',<br>        'AND c.encntr_id = {encounter_id} ',<br>        'AND c.event_cd IN ( /* CODESET 72 ',<br>            ' SPO2 ',<br>            ' TEMPERATUREORAL ',<br>            ' TEMPERATURETYMPANIC ',<br>            ' TEMPERATURERECTAL ',<br>            ' TEMPERATURETEMPORAL ',<br>            ' TEMPERATUREAXILLARY ',<br>            ' HEARTRATEMONITORED ',<br>            ' RESPIRATORYRATE ',<br>            ' SYSTOLICBLOODPRESSURE ',<br>            ' DIASTOLICBLOODPRESSURE ',<br>            ' SYSTOLICBLOODPRESSURE ',<br>            ' MEANARTERIALPRESSURE ',<br>            ' MEANARTERIALPRESSURECUFF * /',<br>        '0)'<br>    ],<br>    {<br>        person_id:1111111111,<br>        encounter_id:22222222222,<br>        start_date:univnm.db.toDate(new Date().add(Date.DAY,-1)),<br>        end_date:univnm.db.toDate(new Date())<br>    },<br>    function(result){ //if last param is a function, it assumed to be the callback function<br>        debug_window(result.toHtmlTable())<br>    }<br>)<br>&lt;/script&gt;</pre></blockquote></div></div>

<div class="CProperty CTopic"><h3 class=CTitle><a name="univnm.db.univnm.db.codeCache"></a>univnm.<span class=HB> </span>db.<span class=HB> </span>codeCache</h3><div class=CBody><p class=CParagraph>contains a chacke of code values by code set and display key</p><h4 class=CHeading>See</h4><ul class=CBulletList><li><a href="#univnm.db.univnm.db.codeLookup" class=LFunction id=link21 onMouseOver="ShowTip(event, 'tt3', 'link21')" onMouseOut="HideTip('tt3')">univnm.db.codeLookup</a></li><li><a href="#univnm.db.univnm.db.cacheCodes" class=LFunction id=link22 onMouseOver="ShowTip(event, 'tt4', 'link22')" onMouseOut="HideTip('tt4')">univnm.db.cacheCodes</a></li></ul></div></div>

<div class="CFunction CTopic"><h3 class=CTitle><a name="univnm.db.univnm.db.codeLookup"></a>univnm.<span class=HB> </span>db.<span class=HB> </span>codeLookup</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>univnm.db.codeLookup = function(</td><td class=PParameter nowrap>code_set,</td></tr><tr><td></td><td class=PParameter nowrap>display_key</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p class=CParagraph>looks up a code from the code_value table.</p><h4 class=CHeading>Parameters</h4><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>code_set</td><td class=CDLDescription>code set to search</td></tr><tr><td class=CDLEntry>display_key</td><td class=CDLDescription>display key to search</td></tr></table><p class=CParagraph>Throws and exception if the code is not found</p><h4 class=CHeading>Example</h4><blockquote><pre class="CCode sh_myna">var ADMIN = uninvnm.db.codeLookup(88,'ADMIN');</pre></blockquote><h4 class=CHeading>See</h4><ul class=CBulletList><li><a href="#univnm.db.univnm.db.codeCache" class=LProperty id=link23 onMouseOver="ShowTip(event, 'tt9', 'link23')" onMouseOut="HideTip('tt9')">univnm.db.codeCache</a></li><li><a href="#univnm.db.univnm.db.cacheCodes" class=LFunction id=link24 onMouseOver="ShowTip(event, 'tt4', 'link24')" onMouseOut="HideTip('tt4')">univnm.db.cacheCodes</a></li><li><a href="#univnm.db.univnm.db.query" class=LFunction id=link25 onMouseOver="ShowTip(event, 'tt1', 'link25')" onMouseOut="HideTip('tt1')">univnm.db.query</a></li></ul></div></div>

<div class="CFunction CTopic"><h3 class=CTitle><a name="univnm.db.univnm.db.cacheCodes"></a>univnm.<span class=HB> </span>db.<span class=HB> </span>cacheCodes</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>univnm.db.cacheCodes = function(</td><td class=PParameter nowrap>codes,</td></tr><tr><td></td><td class=PParameter nowrap>cb</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p class=CParagraph>preCaches code values so that calls to &lt;codeLookup&gt; run faster</p><h4 class=CHeading>Parameters</h4><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>codes</td><td class=CDLDescription>JS object Keyed by codeset, each value containing an array of display keys</td></tr><tr><td class=CDLEntry>cb</td><td class=CDLDescription><b>Optional, default null</b> Function If defined, cacheCodes will be run async and <u>cb</u> will be called when codes are ready</td></tr></table><h4 class=CHeading>Example</h4><blockquote><pre class="CCode sh_myna">//background load code values<br>univnm.db.cacheCodes(<br>    {<br>        88:['ADMIN','BEDROCK'],<br>        72:['WBC','HBC','DIFFIS']<br>    },<br>    function(){}<br>)</pre></blockquote></div></div>

<div class="CFunction CTopic"><h3 class=CTitle><a name="univnm.db.univnm.db.toDate"></a>univnm.<span class=HB> </span>db.<span class=HB> </span>toDate</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>univnm.db.toDate = function(</td><td class=PParameter nowrap>date</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p class=CParagraph>converts a JS date into a Oracle to_date function string</p><h4 class=CHeading>Parameters</h4><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>date</td><td class=CDLDescription>JS Date object</td></tr></table><h4 class=CHeading>Example</h4><blockquote><pre class="CCode sh_myna">var result =univnm.db.query([<br>    'SELECT  ',<br>    '       code_display(72, c.EVENT_CD) AS code_display ',<br>    '       ,code_display_key(72, c.EVENT_CD) AS code_display_key ',<br>    '       , c.result_val as value ',<br>    ' FROM clinical_event   c ',<br>    ' WHERE c.person_id = {person_id} ',<br>    ' AND c.updt_dt_tm BETWEEN {start_date} AND {end_date} ',<br>    ' AND c.encntr_id = {encounter_id} ',<br>    ' AND c.event_cd IN ( ',<br>    '     code_lookup(72, \'DIRECTCOOMBSIGG\'), ',<br>    '     code_lookup(72, \'TBILIRUBIN\') ',<br>    ' ) '<br>],<br>{<br>    person_id:patient_id,<br>    encounter_id:encounter_id,<br>    start_date:univnm.db.toDate(C.range_start),<br>    end_date:univnm.db.toDate(C.range_end)<br>});</pre></blockquote></div></div>

<div class="CFunction CTopic"><h3 class=CTitle><a name="univnm.db.univnm.db.toSql"></a>univnm.<span class=HB> </span>db.<span class=HB> </span>toSql</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>univnm.db.toSql = function toSql(</td><td class=PParameter nowrap>value,</td></tr><tr><td></td><td class=PParameter nowrap>encodeObjects</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p class=CParagraph>converts a native JS value into an SQL string</p><h4 class=CHeading>Parameters</h4><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>value</td><td class=CDLDescription>JS Number,string,null,date, JS Object or array.&nbsp; See <b>Conversions&rdquo;</b> below</td></tr><tr><td class=CDLEntry>encodeObjects</td><td class=CDLDescription>Boolean, default false. if true, Arrays and JS Objects are encoded as JSON with the &ldquo;#JSON&rdquo; header for storage in custom tables</td></tr></table><h4 class=CHeading>Conversions</h4><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>Number</td><td class=CDLDescription>converted to raw string</td></tr><tr><td class=CDLEntry>String</td><td class=CDLDescription>If the value starts with &lsquo;#&rsquo; then the # is removed and the value is returned.&nbsp; If the value is a date string in the form of &ldquo;d-m-Y H:i:s&rdquo; it is treated like a date (see below).&nbsp; Otherwise the value is wrapped in single ticks(&lsquo;), with any internal ticks doubled.&nbsp; Hard returns are replaced with &lsquo; || chr(10) || &lsquo;</td></tr><tr><td class=CDLEntry>Date</td><td class=CDLDescription>converted to a to_date() string via &lt;univnnm.db.toDate&gt;</td></tr><tr><td class=CDLEntry>Null</td><td class=CDLDescription>converted to &ldquo;NULL&rdquo;</td></tr><tr><td class=CDLEntry>Array</td><td class=CDLDescription>(if !encodeObjects) returns an &ldquo;in&rdquo; list &ldquo;(items1,item2,...itemN)&rdquo; where each item is formatted via the above rules</td></tr><tr><td class=CDLEntry>JS Object</td><td class=CDLDescription>(if !encodeObjects) returns a new object where each of the values are converted via toSql(value)</td></tr></table><h4 class=CHeading>Example</h4><blockquote><pre class="CCode sh_myna">var result =univnm.db.query([<br>    'SELECT  c.result_val as value ',<br>    ' FROM clinical_event   c ',<br>    ' WHERE c.person_id = {person_id} ',<br>    ' AND c.updt_dt_tm BETWEEN {start_date} AND {end_date} ',<br>    ' AND c.encntr_id = {encounter_id} ',<br>    ' AND c.event_cd IN {codes}'<br>],<br>univnm.db.toSql({<br>    person_id:patient_id,<br>    encounter_id:encounter_id,<br>    start_date:new Date().clearTime().add(Date.DAY,-1),<br>    end_date:new Date().clearTime(),<br>    codes:[<br>        &quot;#code_lookup(72, 'DIRECTCOOMBSIGG')&quot;,<br>        &quot;#code_lookup(72, 'TBILIRUBIN')&quot;<br>    ]<br>})<br>);</pre></blockquote></div></div>

<div class="CFunction CTopic"><h3 class=CTitle><a name="univnm.db.univnm.db.saveRow"></a>univnm.<span class=HB> </span>db.<span class=HB> </span>saveRow</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>univnm.db.saveRow = function saveRow(</td><td class=PParameter nowrap>table,</td></tr><tr><td></td><td class=PParameter nowrap>type,</td></tr><tr><td></td><td class=PParameter nowrap>data,</td></tr><tr><td></td><td class=PParameter nowrap>cb</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p class=CParagraph>Saves a row of data to a custom table</p><h4 class=CHeading>Parameters</h4><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>table</td><td class=CDLDescription>name of tablet to modify.&nbsp; Only tables in unmh beginning with &ldquo;cust_&rdquo; can be modified.&nbsp; The &ldquo;cust_&rdquo; is implied, so &ldquo;cust_values&rdquo; and &ldquo;values&rdquo; would both refer to the same table</td></tr><tr><td class=CDLEntry>type</td><td class=CDLDescription>One of &ldquo;insert,update,remove,set&rdquo;.&nbsp; See <b>Insert Type, Update Type, etc</b> below</td></tr><tr><td class=CDLEntry>data</td><td class=CDLDescription>Either a row or an array of rows to save.&nbsp; If this is an array, then each row will be handled separately on th eback-endA row is a JS object where the properties are column names and the values are the values for those columns.&nbsp; Some save types support a space and an operator in the property(column) name to indicate that the column should be used in the where clause, using that operator. values are interpreted by type.&nbsp; See <b>Value parsing</b> below</td></tr><tr><td class=CDLEntry>cb</td><td class=CDLDescription><b>Optional, default null</b> Function.&nbsp; If defined, this call will be made asynchronously and <u>cb</u> will be called when finished.&nbsp; Other wise this call will be made synchronously and will return when finished.</td></tr></table><h4 class=CHeading>Value Parsing</h4><p class=CParagraph>Values in rows are translated via the following rules:</p><ul class=CBulletList><li>Null values are converted to &ldquo;#NULL&rdquo;</li><li>String values that start with a # are passed through as raw SQL values</li><li>Other String values are wrapped in single quotes and any internal single quotes are escaped</li><li>Dates are converted to to_date strings (See univnm.db.toDate)</li><li>booleans are converted to either 1 or 0</li><li>Final string value will have all hard-returns converted to &lsquo; || chr(10) || &lsquo;</li></ul><h4 class=CHeading>Insert Type</h4><p class=CParagraph>The &ldquo;insert&rdquo; type is used for inserting rows in to the table.&nbsp; Operators in the column names are ignored, and all values in the row are inserted</p><blockquote><pre class="CCode sh_myna">var data =[{<br>    id:&quot;#Null&quot;,//pull from sequence trigger<br>    application:C.options.appname,<br>    key:&quot;refreshDate&quot;,<br>    value:new Date()<br>}]<br>univnm.db.saveRow(&quot;values&quot;,&quot;insert&quot;,data,function(){})</pre></blockquote><h4 class=CHeading>Update Type</h4><p class=CParagraph>The &ldquo;update&rdquo; type is used for updating rows in the table.&nbsp; Operators in the column names indicate the where expression.&nbsp; All values in the row are updated.</p><blockquote><pre class="CCode sh_myna">var data =[{<br>    &quot;application = &quot;:C.options.appname,<br>    &quot;key =&quot;:&quot;refreshDate&quot;,<br>    value:new Date()<br>}]<br>univnm.db.saveRow(&quot;values&quot;,&quot;update&quot;,data,function(){})</pre></blockquote><h4 class=CHeading>Remove Type</h4><p class=CParagraph>The &ldquo;remove&rdquo; type is used for removing rows from the table.&nbsp; All columns are used in the where expression.&nbsp; The assumed operator is &ldquo;=&rdquo;</p><blockquote><pre class="CCode sh_myna">//remove values like 'refresh%' older than 7 days<br>var data =[{<br>    application:C.options.appname,<br>    &quot;key like&quot;:&quot;refresh%&quot;,<br>    &quot;value &lt;&quot;:&quot;#sysdate -7&quot;<br><br>}]<br>univnm.db.saveRow(&quot;values&quot;,&quot;remove&quot;,data,function(){})</pre></blockquote><h4 class=CHeading>Set Type</h4><p class=CParagraph>The &ldquo;set&rdquo; type is used for updating or inserting rows based on a natural key.&nbsp; Operators in the column names indicate the where expression, however the only valid operator is &ldquo;=&rdquo;. if a row exists matching the where expression it is updated, otherwise inserted.</p><blockquote><pre class="CCode sh_myna">var data =[{<br>    &quot;application =&quot;:C.options.appname,<br>    &quot;key =&quot;:&quot;refreshDate&quot;,<br>    value:&quot;#sysdate&quot;<br>}]<br>univnm.db.saveRow(&quot;values&quot;,&quot;set&quot;,data,function(){})</pre></blockquote></div></div>

</div><!--Content-->


<div id=Footer><a href="http://www.naturaldocs.org">Generated by Natural Docs</a></div><!--Footer-->


<div id=Menu><div class="MFile MEntry"><a href="README-txt.html">README.txt</a></div><div class="MGroup MEntry"><a href="javascript:ToggleMenu('MGroupContent3')">UnivNM</a><div class=MGroupContent id=MGroupContent3><div class="MFile MEntry"><a href="env-js.html">env.js</a></div><div class="MFile MEntry"><a href="jslib-js.html">jslib.js</a></div><div class="MFile MEntry"><a href="mpages_core-js.html">mpages_core.js</a></div><div class="MFile MEntry"><a href="controller-js.html">controller.js</a></div><div class="MFile MEntry"><a href="controller_shared-js.html">controller_shared.js</a></div><div class="MFile MEntry"><a href="controller_touch-js.html">controller_touch.js</a></div><div class="MFile MEntry" id=MSelected>db.js</div><div class="MFile MEntry"><a href="univnm-pck.html">univnm.pck</a></div><div class="MFile MEntry"><a href="univnm_code-pck.html">univnm_code.pck</a></div><div class="MFile MEntry"><a href="univnm_mpage_component-js.html">univnm_mpage_component.js</a></div><div class="MGroup MEntry"><a href="javascript:ToggleMenu('MGroupContent1')">Ext</a><div class=MGroupContent id=MGroupContent1><div class="MFile MEntry"><a href="ext/BetterActionColumn-js.html">BetterActionColumn.js</a></div><div class="MFile MEntry"><a href="ext/CclDirect-js.html">CclDirect.js</a></div><div class="MFile MEntry"><a href="ext/MpageStandardComponent-js.html">MpageStandardComponent.js</a></div><div class="MFile MEntry"><a href="ext/QueryStore-js.html">QueryStore.js</a></div><div class="MFile MEntry"><a href="ext/QuickDrop-js.html">QuickDrop.js</a></div><div class="MFile MEntry"><a href="ext/RowProxy-js.html">RowProxy.js</a></div><div class="MFile MEntry"><a href="ext/SequenceGenerator-js.html">SequenceGenerator.js</a></div><div class="MFile MEntry"><a href="ext/Statusbar-js.html">Statusbar.js</a></div><div class="MFile MEntry"><a href="ext/SupaGrid-js.html">SupaGrid.js</a></div></div></div><div class="MFile MEntry"><a href="cust_tables-sql.html">cust_tables.sql</a></div><div class="MGroup MEntry"><a href="javascript:ToggleMenu('MGroupContent2')">Sql</a><div class=MGroupContent id=MGroupContent2><div class="MFile MEntry"><a href="sql/cust_tables-sql.html">cust_tables.sql</a></div><div class="MFile MEntry"><a href="sql/univnm-pck.html">univnm.pck</a></div><div class="MFile MEntry"><a href="sql/univnm_code-pck.html">univnm_code.pck</a></div></div></div></div></div><div class="MGroup MEntry"><a href="javascript:ToggleMenu('MGroupContent4')">Index</a><div class=MGroupContent id=MGroupContent4><div class="MIndex MEntry"><a href="../index/General.html">Everything</a></div><div class="MIndex MEntry"><a href="../index/Classes.html">Classes</a></div><div class="MIndex MEntry"><a href="../index/Events.html">Events</a></div><div class="MIndex MEntry"><a href="../index/Files.html">Files</a></div><div class="MIndex MEntry"><a href="../index/Functions.html">Functions</a></div><div class="MIndex MEntry"><a href="../index/Properties.html">Properties</a></div></div></div><script type="text/javascript"><!--
var searchPanel = new SearchPanel("searchPanel", "HTML", "../search");
--></script><div id=MSearchPanel class=MSearchPanelInactive><input type=text id=MSearchField value=Search onFocus="searchPanel.OnSearchFieldFocus(true)" onBlur="searchPanel.OnSearchFieldFocus(false)" onKeyUp="searchPanel.OnSearchFieldChange()"><select id=MSearchType onFocus="searchPanel.OnSearchTypeFocus(true)" onBlur="searchPanel.OnSearchTypeFocus(false)" onChange="searchPanel.OnSearchTypeChange()"><option  id=MSearchEverything selected value="General">Everything</option><option value="Classes">Classes</option><option value="Events">Events</option><option value="Files">Files</option><option value="Functions">Functions</option><option value="Properties">Properties</option></select></div><div id=MSearchResultsWindow><iframe src="" frameborder=0 name=MSearchResults id=MSearchResults></iframe><a href="javascript:searchPanel.CloseResultsWindow()" id=MSearchResultsWindowClose>Close</a></div><script language=JavaScript><!--
if (document.getElementById){for (var menu = 1; menu < 5; menu++){if (menu != 3 && menu != 1 && menu != 2){document.getElementById("MGroupContent" + menu).style.display = "none";};};}// --></script></div><!--Menu-->



<!--START_ND_TOOLTIPS-->
<div class=CToolTip id="tt1"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>univnm.db.query = function query()</td></tr></table></blockquote>Queries the server and returns a univnm.DataSet object of the results</div></div><div class=CToolTip id="tt2"><div class=CClass>A normalized data structure for working with tabular data</div></div><div class=CToolTip id="tt3"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>univnm.db.codeLookup = function(</td><td class=PParameter nowrap>code_set,</td></tr><tr><td></td><td class=PParameter nowrap>display_key</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>looks up a code from the code_value table.</div></div><div class=CToolTip id="tt4"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>univnm.db.cacheCodes = function(</td><td class=PParameter nowrap>codes,</td></tr><tr><td></td><td class=PParameter nowrap>cb</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>preCaches code values so that calls to codeLookup run faster</div></div><div class=CToolTip id="tt5"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>univnm.db.toDate = function(</td><td class=PParameter nowrap>date</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>converts a JS date into a Oracle to_date function string</div></div><div class=CToolTip id="tt6"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>univnm.db.toSql = function toSql(</td><td class=PParameter nowrap>value,</td></tr><tr><td></td><td class=PParameter nowrap>encodeObjects</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>converts a native JS value into an SQL string</div></div><div class=CToolTip id="tt7"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>univnm.db.saveRow = function saveRow(</td><td class=PParameter nowrap>table,</td></tr><tr><td></td><td class=PParameter nowrap>type,</td></tr><tr><td></td><td class=PParameter nowrap>data,</td></tr><tr><td></td><td class=PParameter nowrap>cb</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Saves a row of data to a custom table</div></div><div class=CToolTip id="tt8"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>String.prototype.format=function(</td><td class=PParameter nowrap>values</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>returns a string with parameters replaced</div></div><div class=CToolTip id="tt9"><div class=CProperty>contains a chacke of code values by code set and display key</div></div><!--END_ND_TOOLTIPS-->




<script language=JavaScript><!--
if (browserType) {if (browserVer) {document.write("</div>"); }document.write("</div>");}// --></script></body></html>