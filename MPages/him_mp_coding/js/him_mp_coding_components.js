function DocumentBaseComponent(){this.m_resultStatusCodes=null;
this.m_resultStatusMeanings=null;
this.m_includeHover=true;
this.m_pcnFavorites=true;
this.setIncludeLineNumber(true);
DocumentBaseComponent.method("InsertData",function(){CERN_DOCUMENT_BASE_O1.GetDocumentsTable(this);
});
DocumentBaseComponent.method("setResultStatusCodes",function(value){this.m_resultStatusCodes=value;
});
DocumentBaseComponent.method("addResultStatusCode",function(value){if(!this.m_resultStatusCodes){this.m_resultStatusCodes=[];
}this.m_resultStatusCodes.push(value);
});
DocumentBaseComponent.method("getResultStatusCodes",function(){if(this.m_resultStatusCodes){return this.m_resultStatusCodes;
}else{if(this.m_resultStatusMeanings){var resStatusCodeSet=MP_Util.GetCodeSet(8,false);
if(this.m_resultStatusMeanings&&this.m_resultStatusMeanings.length>0){for(var x=this.m_resultStatusMeanings.length;
x--;
){var code=MP_Util.GetCodeByMeaning(resStatusCodeSet,this.m_resultStatusMeanings[x]);
if(code){this.addResultStatusCode(code.codeValue);
}}}}}return this.m_resultStatusCodes;
});
DocumentBaseComponent.method("addResultStatusMeaning",function(value){if(!this.m_resultStatusMeanings){this.m_resultStatusMeanings=[];
}this.m_resultStatusMeanings.push(value);
});
DocumentBaseComponent.method("setResultStatusMeanings",function(value){this.m_resultStatusMeanings=value;
});
DocumentBaseComponent.method("isHoverEnabled",function(){return this.m_includeHover;
});
DocumentBaseComponent.method("setHoverEnabled",function(value){this.m_includeHover=value;
});
DocumentBaseComponent.method("isPcnFavEnabled",function(){return this.m_pcnFavorites;
});
DocumentBaseComponent.method("setPcnFavEnabled",function(value){this.m_pcnFavorites=value;
});
DocumentBaseComponent.method("HandleSuccess",function(recordData){CERN_DOCUMENT_BASE_O1.RenderComponent(this,recordData);
});
}DocumentBaseComponent.inherits(MPageComponent);
var CERN_DOCUMENT_BASE_O1=function(){return{GetDocumentsTable:function(component){var mgr=new MP_Core.XMLCCLRequestThreadManager(CERN_DOCUMENT_BASE_O1.RenderReply,component,false);
var sendAr=[];
var request=null;
var thread=null;
var criterion=component.getCriterion();
var groups=component.getGroups();
var codes=component.getResultStatusCodes();
var events=(groups!=null&&groups.length>0)?groups[0].getEventSets():null;
var results=(codes!=null&&codes.length>0)?codes:null;
var encntrOption=(component.getScope()==2)?(criterion.encntr_id+".0"):"0.0";
sendAr.push("^MINE^",criterion.person_id+".0",encntrOption,criterion.provider_id+".0",component.getLookbackUnits());
if(events){sendAr.push("value("+events.join(",")+")");
}else{sendAr.push("0.0");
}if(results){sendAr.push("value("+results.join(",")+")");
}else{sendAr.push("0.0");
}var unitType=component.getLookbackUnitTypeFlag();
sendAr.push(criterion.ppr_cd+".0",unitType);
request=new MP_Core.ScriptRequest(component,"ENG:MPG.DOC.O1 - load documents");
request.setProgramName("MP_RETRIEVE_DOCUMENTS_JSON");
request.setParameters(sendAr);
request.setAsync(true);
thread=new MP_Core.XMLCCLRequestThread("GetDocumentData",component,request);
mgr.addThread(thread);
if(component.isPlusAddEnabled()){sendAr=[];
sendAr.push("^MINE^",criterion.provider_id);
request=new MP_Core.ScriptRequest(component,"ENG:MPG.DOC.O1 - load PCN Favs");
request.setProgramName("MP_GET_DOCUMENT_FAVORITES");
request.setParameters(sendAr);
request.setAsync(true);
thread=new MP_Core.XMLCCLRequestThread("GetPcnFavorites",component,request);
mgr.addThread(thread);
}mgr.begin();
},RenderReply:function(replyAr,component){var timerRenderComponent=MP_Util.CreateTimer(component.getComponentRenderTimerName());
var countText="";
var compNS=component.getStyles().getNameSpace();
var errMsg=[];
try{for(var repCnt=replyAr.length;
repCnt--;
){var reply=replyAr[repCnt];
var repStatus=reply.getStatus();
switch(reply.getName()){case"GetPcnFavorites":var favData=reply.getResponse();
if(repStatus=="S"){appendDropDown(compNS,component,favData,component.getCriterion().static_content);
}break;
case"GetDocumentData":if(repStatus=="F"){errMsg.push(reply.getError());
MP_Util.Doc.FinalizeComponent(MP_Util.HandleErrorResponse(component.getStyles().getNameSpace(),errMsg.join("<br />")),component,"");
}else{if(repStatus=="S"){var recordData=reply.getResponse();
var sHTML="";
sHTML=CERN_DOCUMENT_BASE_O1.RenderComponent(component,recordData);
countText=MP_Util.CreateTitleText(component,recordData.DOCS.length);
MP_Util.Doc.FinalizeComponent(sHTML,component,countText);
if(component.isScrollingEnabled()&&(recordData.DOCS.length>=component.getScrollNumber())){var xNode=Util.Style.g(compNS+"-info-hdr",document.body,"DL");
if(xNode[0]){Util.Style.acss(xNode[0],"hdr-scroll");
}}}else{countText=(component.isLineNumberIncluded()?"(0)":"");
MP_Util.Doc.FinalizeComponent(MP_Util.HandleNoDataResponse(component.getStyles().getNameSpace()),component,countText);
}}break;
}}}catch(err){if(timerRenderComponent){timerRenderComponent.Abort();
timerRenderComponent=null;
}throw (err);
}finally{if(timerRenderComponent){timerRenderComponent.Stop();
}}},RenderComponent:function(component,recordData){var compNS=component.getStyles().getNameSpace();
var DocI18n=i18n.discernabu.documents_base_o1;
var codeArray=MP_Util.LoadCodeListJSON(recordData.CODES);
var personnelArray=MP_Util.LoadPersonelListJSON(recordData.PRSNL);
var df=new mp_formatter.DateTimeFormatter(MPAGE_LOCALE);
var sHTML="";
var countText="";
var jsHTML=[];
jsHTML.push("<div class='content-hdr'><dl class='",compNS,"-info-hdr hdr'><dd class='",compNS+"-cat-hd'><span></span></dd>");
jsHTML.push("<dd class='",compNS,"-auth-hd'><span>",DocI18n.AUTHOR,"</span></dd>");
if(PathologyComponent&&(component instanceof PathologyComponent)){jsHTML.push("<dd class='",compNS,"-dt-hd'><span>",DocI18n.DATE,"</span></dd>");
}else{jsHTML.push("<dd class='",compNS,"-dt-hd'><span>",DocI18n.DATE_TIME,"</span></dd>");
}if(component.getDateFormat()==3){jsHTML.push("<dd class='",compNS+"-cat-hd'><span></span></dd><dd class='",compNS,"-auth-hd'><span></span></dd><dd class='",compNS,"-dt-hd'><span>",DocI18n.WITHIN,"</span></dd>");
}jsHTML.push("</dl></div>");
recordData.DOCS.sort(DocumentSorter);
jsHTML.push("<div class='",MP_Util.GetContentClass(component,recordData.DOCS.length),"'>");
for(var x=0,xl=recordData.DOCS.length;
x<xl;
x++){var dtHvr="",lastPrsnl="";
var author=DocI18n.UNKNOWN;
var docObj=recordData.DOCS[x];
var patId=docObj.PERSON_ID+".0";
var enctrId=docObj.ENCNTR_ID+".0";
var evntId=docObj.EVENT_ID+".0";
var docStatus=MP_Util.GetValueFromArray(docObj.RESULT_STATUS_CD,codeArray);
var doc=MP_Util.GetValueFromArray(docObj.EVENT_CD,codeArray);
var parentEventId=docObj.PARENT_EVENT_ID+".0";
var viewerType=docObj.VIEWER_TYPE;
var dateOfService=null;
var withinDateDos=null;
var dateTime=new Date();
if(docObj.EFFECTIVE_DT_TM!=""){dateTime.setISO8601(docObj.EFFECTIVE_DT_TM);
dateOfService=MP_Util.DisplayDateByOption(component,dateTime);
withinDateDos=MP_Util.CalcWithinTime(dateTime);
}else{dateOfService=DocI18n.UNKNOWN;
withinDateDos=DocI18n.UNKNOWN;
}var recentPart=GetLatestParticipation(docObj);
var authorPart=GetAuthorParticipant(docObj,codeArray);
if(authorPart){author=MP_Util.GetValueFromArray(authorPart.PRSNL_ID,personnelArray).fullName;
}if(recentPart&&recentPart.PRSNL_ID>0){lastPrsnl=MP_Util.GetValueFromArray(recentPart.PRSNL_ID,personnelArray).fullName;
var dtTm=new Date();
if(recentPart.DATE!==""){dtTm.setISO8601(recentPart.DATE);
dtHvr=df.format(dtTm,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_4YEAR);
}else{dtHvr=DocI18n.UNKNOWN;
}}else{lastPrsnl=DocI18n.UNKNOWN;
dtHvr=DocI18n.UNKNOWN;
}jsHTML.push("<dl class='",compNS,"-info'><dd class='",compNS+"-cat'><span>",MP_Util.CreateClinNoteLink(patId,enctrId,evntId,doc.display,viewerType,parentEventId),"</span>");
if(docStatus.meaning=="MODIFIED"||docStatus.meaning=="ALTERED"){jsHTML.push("<span class='res-modified'>&nbsp;</span>");
}jsHTML.push("</dd>");
jsHTML.push("<dd class='",compNS,"-auth'><span>",author,"</span></dd>");
if(component.getDateFormat()==3){jsHTML.push("<dd class='",compNS,"-dt'><span class='date-time'>",withinDateDos,"</span></dd>");
}else{jsHTML.push("<dd class='",compNS,"-dt'><span class='date-time'>",dateOfService,"</span></dd>");
}jsHTML.push("<dd class='",compNS,"-image'>");
if(docObj.IMAGE_URL!==""){var urlParam='javascript:MPAGES_SVC_EVENT("'+docObj.IMAGE_URL+'",^MINE,$PAT_PersonId$^)';
jsHTML.push("<a class='",compNS,"-image-found' href='",urlParam,"'>&nbsp;</a>");
}else{jsHTML.push("&nbsp;");
}jsHTML.push("</dd></dl>");
if(component.isHoverEnabled()){jsHTML.push("<h4 class='det-hd'><span>",DocI18n.DOCUMENTATION_DETAILS,"</span></h4><div class='hvr'><dl class='",compNS,"-det'><dt><span>",DocI18n.NAME,":</span></dt><dd class='",compNS,"-det-name'><span>",doc.display,"</span></dd><dt><span>",DocI18n.SUBJECT,":</span></dt><dd class='",compNS,"-det-subj'><span>",docObj.SUBJECT,"</span></dd><dt><span>",DocI18n.STATUS,":</span></dt><dd class='",compNS,"-det-status'><span>",MP_Util.GetValueFromArray(docObj.RESULT_STATUS_CD,codeArray).display,"</span></dd><dt><span>",DocI18n.LAST_UPDATED,":</span></dt><dd class='",compNS,"-det-dt'><span>",dtHvr,"</span></dd><dt><span>",DocI18n.LAST_UPDATED_BY,":</span></dt><dd class='",compNS,"-det-dt'><span>",lastPrsnl,"</span></dd></dl></div>");
}}jsHTML.push("</div>");
sHTML=jsHTML.join("");
return sHTML;
}};
function GetLatestParticipation(doc){var returnPart=null;
for(var x=doc.ACTION_PROVIDERS.length;
x--;
){var part=doc.ACTION_PROVIDERS[x];
if(!returnPart||part.DATE>returnPart.DATE){returnPart=part;
}}return(returnPart);
}function DocumentSorter(a,b){var aPart=GetLatestParticipation(a);
var bPart=GetLatestParticipation(b);
var aDate="";
var bDate="";
if(aPart){aDate=aPart.EFFECTIVE_DT_TM;
}if(bPart){bDate=bPart.EFFECTIVE_DT_TM;
}if(aDate>bDate){return -1;
}else{if(aDate<bDate){return 1;
}else{return 0;
}}}function GetAuthorParticipant(doc,codeArray){var returnPart=null,type_cd=null,status_cd=null,part=null,strPerform="PERFORM",strCompleted="COMPLETED";
for(var y=doc.ACTION_PROVIDERS.length;
y--;
){part=doc.ACTION_PROVIDERS[y];
type_cd=MP_Util.GetValueFromArray(part.TYPE_CD,codeArray);
status_cd=MP_Util.GetValueFromArray(part.STATUS_CD,codeArray);
if((type_cd&&type_cd.meaning===strPerform)&&(status_cd&&status_cd.meaning===strCompleted)){returnPart=part;
break;
}}return(returnPart);
}function appendDropDown(preSec,component,pcnFav,contentPath){if(preSec!="doc"){return;
}pre=component.getStyles().getId();
if((_g(pre+"Drop")!=null)&&_g(pre+"Menu")!=null){return;
}var img=Util.cep("img",{src:contentPath+"\\images\\3943_16.gif"});
var link=Util.cep("a",{className:"drop-Down",id:pre+"Drop"});
var menu=Util.cep("div",{id:pre+"Menu",className:"form-menu menu-hide"});
Util.ac(img,link);
var sec=_g(component.getStyles().getId());
var secCL=Util.Style.g("sec-hd",sec,"h2");
var secSpan=secCL[0];
Util.ac(link,secSpan);
Util.ac(menu,secSpan);
pcnFavLoad(pcnFav,component);
}function pcnFavLoad(pcnFav,component){var jsonPcnFav=pcnFav;
var docDropId=component.getStyles().getId()+"Drop";
var docDrop=_g(docDropId);
var htmlPcnFav=[];
var numId=0;
var pcn=jsonPcnFav.PRE_COMPLETED;
pcn.sort(function(obj1,obj2){function checkStrings(s1,s2){return(s1===s2)?0:((s1>s2)?1:-1);
}return checkStrings(obj1.DISPLAY.toUpperCase(),obj2.DISPLAY.toUpperCase());
});
if(!pcn[0]){htmlPcnFav.push("<div>",i18n.discernabu.documents_base_o1.DOCUMENT_FAVS,'<span class="favHidden" id="docCKI',numId,'">',i18n.DOCUMENT_FAVS,"</span></div>");
}else{var crit=component.getCriterion();
for(var j=0,l=pcn.length;
j<l;
j++){var pcNote=pcn[j];
numId=numId+1;
htmlPcnFav.push('<div><a id="doc',numId,'" href="#">',pcNote.DISPLAY,"</a>",'<span class="favHidden" id="docCKI',numId,'">',pcNote.SOURCE_IDENTIFIER,"</span>",'<span class="favHidden" id="docStyleID',numId,'">',component.getStyles().getId(),"</span>","</div>");
}}var pcnArray=htmlPcnFav.join("");
var newSpan=Util.cep("span");
newSpan.innerHTML=pcnArray;
var docMenuId=component.getStyles().getId()+"Menu";
var docMenu=_g(docMenuId);
Util.ac(newSpan,docMenu);
var docMenuList=_gbt("a",docMenu);
var dmLen=docMenuList.length;
for(var i=dmLen;
i--;
){Util.addEvent(docMenuList[i],"click",addDocDet);
}closeMenuInit(docMenu,component.getStyles().getId());
Util.addEvent(docDrop,"click",function(){if(Util.Style.ccss(Util.gns(this),"menu-hide")){_g(component.getStyles().getId()).style.zIndex=2;
Util.preventDefault();
Util.Style.rcss(Util.gns(this),"menu-hide");
}else{_g(component.getStyles().getId()).style.zIndex=1;
Util.Style.acss(Util.gns(this),"menu-hide");
}});
}function addDocDet(){try{var PowerNoteMPageUtils=window.external.DiscernObjectFactory("POWERNOTE");
var comp={};
if(PowerNoteMPageUtils){var menuVal=Util.gns(this);
var cki=menuVal.firstChild.data;
var spanDocStyleID=Util.gns(menuVal);
for(var x=0,xl=CERN_MPageComponents.length;
x<xl;
x++){comp=CERN_MPageComponents[x];
var styles=comp.getStyles();
if(styles.getId()==spanDocStyleID.firstChild.data){break;
}}var crit=comp.getCriterion();
PowerNoteMPageUtils.BeginNoteFromPrecompletedNote(crit.person_id+".0",crit.encntr_id+".0",cki+".0");
CERN_DOCUMENT_BASE_O1.GetDocumentsTable(comp);
}}catch(err){alert('An error has occured calling DiscernObjectFactory("POWERNOTE"): '+err.name+" "+err.message);
return;
}}function closeMenuInit(inMenu,compId){var menuId;
var docMenuId=compId+"Menu";
if(inMenu.id==docMenuId){menuId=compId;
}if(!e){var e=window.event;
}if(window.attachEvent){Util.addEvent(inMenu,"mouseleave",function(){Util.Style.acss(inMenu,"menu-hide");
_g(menuId).style.zIndex=1;
});
}else{Util.addEvent(inMenu,"mouseout",menuLeave);
}function menuLeave(e){if(!e){var e=window.event;
}var relTarg=e.relatedTarget||e.toElement;
if(e.relatedTarget.id==inMenu.id){Util.Style.acss(inMenu,"menu-hide");
_g(menuId).style.zIndex=1;
}e.stopPropagation();
Util.cancelBubble(e);
}}}();
function MeasurementBaseComponent(criterion){this.m_resultCount=0;
this.m_isEventSetInfo=false;
MeasurementBaseComponent.method("setResultCount",function(value){this.m_resultCount=value;
});
MeasurementBaseComponent.method("getResultCount",function(){return(this.m_resultCount);
});
MeasurementBaseComponent.method("setIncludeEventSetInfo",function(value){this.m_isEventSetInfo=value;
});
MeasurementBaseComponent.method("includeEventSetInfo",function(){return(this.m_isEventSetInfo);
});
MeasurementBaseComponent.method("InsertData",function(){getMeasurementData(this);
});
function getMeasurementData(component){var groups=component.getGroups();
if(groups&&groups.length>0){var mgr=new MP_Core.XMLCCLRequestThreadManager(component.HandleSuccess,component,true);
var criterion=component.getCriterion();
var programName="MP_RETRIEVE_N_RESULTS_JSON";
for(var x=0,xl=groups.length;
x<xl;
x++){var group=groups[x];
var sEventSets="0.0",sEventCodes="0.0";
var esInfo=(component.includeEventSetInfo())?1:0;
var sendAr=[];
var request=null;
var thread=null;
var sEncntr=(component.getScope()===2)?criterion.encntr_id+".0":"0.0";
if(group instanceof MPageEventSetGroup){sEventSets=MP_Util.CreateParamArray(group.getEventSets(),1);
}else{if(group instanceof MPageEventCodeGroup){sEventCodes=MP_Util.CreateParamArray(group.getEventCodes(),1);
}else{if(group instanceof MPageSequenceGroup){var mapItems=group.getMapItems();
sEventSets=MP_Util.CreateParamArray(MP_Util.GetValueFromArray("CODE_VALUE",mapItems),1);
}else{if(group instanceof MPageGrouper){var g=group.getGroups();
var ec=[];
for(var y=0,yl=g.length;
y<yl;
y++){if(g[y] instanceof MPageEventCodeGroup){ec=ec.concat(g[y].getEventCodes());
}}sEventCodes=MP_Util.CreateParamArray(ec,1);
}else{continue;
}}}}sendAr.push("^MINE^",criterion.person_id+".0",sEncntr,criterion.provider_id+".0",criterion.ppr_cd+".0",component.getResultCount(),"^^",sEventSets,sEventCodes,component.getLookbackUnits(),component.getLookbackUnitTypeFlag(),esInfo);
request=new MP_Core.ScriptRequest(component,"ENG:MPG.MEASBASE.O1 - load "+group.getGroupName());
request.setProgramName(programName);
request.setParameters(sendAr);
request.setAsync(true);
thread=new MP_Core.XMLCCLRequestThread(group.getGroupName(),component,request);
mgr.addThread(thread);
}mgr.begin();
}else{MP_Core.CreateSimpleError(component,i18n.discernabu.measurement_base_o1.ERROR_MISSING_ES_EC);
}}}MeasurementBaseComponent.inherits(MPageComponent);
var CERN_MEASUREMENT_BASE_O1=function(){return{LoadMeasurementDataMap:function(recordData,personnelArray,codeArray,sortOption){var mapObjects=[];
var results=recordData.RESULTS;
if(!codeArray){codeArray=MP_Util.LoadCodeListJSON(recordData.CODES);
}if(!personnelArray){personnelArray=MP_Util.LoadPersonelListJSON(recordData.PRSNL);
}for(var i=0,il=results.length;
i<il;
i++){var result=results[i];
if(result.CLINICAL_EVENTS.length>0){for(var j=0,jl=result.CLINICAL_EVENTS.length;
j<jl;
j++){var measureArray=[];
var mapObject=null;
if(result.EVENT_CD>0){mapObject=new MP_Core.MapObject(result.EVENT_CD,measureArray);
}else{mapObject=new MP_Core.MapObject(result.EVENT_SET_NAME,measureArray);
}var meas=result.CLINICAL_EVENTS[j];
for(var k=0,kl=meas.MEASUREMENTS.length;
k<kl;
k++){var measurement=new MP_Core.Measurement();
measurement.initFromRec(meas.MEASUREMENTS[k],codeArray);
measureArray.push(measurement);
}if(measureArray.length>0){if(sortOption){measureArray.sort(sortOption);
}else{measureArray.sort(CERN_MEASUREMENT_BASE_O1.SortByEffectiveDateDesc);
}mapObjects.push(mapObject);
}}}}return mapObjects;
},LoadMeasurementDataArray:function(recordData,personnelArray,codeArray,sortOption){var measureArray=[];
if(!codeArray){codeArray=MP_Util.LoadCodeListJSON(recordData.CODES);
}if(!personnelArray){personnelArray=MP_Util.LoadPersonelListJSON(recordData.PRSNL);
}var results=recordData.RESULTS;
for(var i=0,il=results.length;
i<il;
i++){var result=results[i];
if(result.CLINICAL_EVENTS.length>0){for(var j=0,jl=result.CLINICAL_EVENTS.length;
j<jl;
j++){var meas=result.CLINICAL_EVENTS[j];
for(var k=0,kl=meas.MEASUREMENTS.length;
k<kl;
k++){var measurement=new MP_Core.Measurement();
measurement.initFromRec(meas.MEASUREMENTS[k],codeArray);
measureArray.push(measurement);
}}}}if(measureArray.length>0){if(sortOption){measureArray.sort(sortOption);
}else{measureArray.sort(CERN_MEASUREMENT_BASE_O1.SortByEffectiveDateDesc);
}}return measureArray;
},SortByEffectiveDateDesc:function(a,b){if(a.getDateTime()>b.getDateTime()){return -1;
}else{if(a.getDateTime()<b.getDateTime()){return 1;
}}return 0;
}};
}();
function ProceduresComponentStyle(){this.initByNamespace("him_procedure");
}ProceduresComponentStyle.inherits(ComponentStyle);
function ProceduresComponent(criterion){var i18nProcedures=i18n.accesshim.him.procedures;
this.setCriterion(criterion);
this.setStyles(new ProceduresComponentStyle());
this.setScope(2);
this.setComponentLoadTimerName("USR:MPG.HIM_PROCEDURES - load component");
this.setComponentRenderTimerName("ENG:MPG.HIM_PROCEDURES - render component");
function SectionColumn(active,sequence){this.active=active;
this.sequence=sequence;
}function ProcedureSection(active,name,eventSets){this.active=active;
this.name=name;
this.eventSets=eventSets;
}this.procedureName=new SectionColumn(true,0);
this.procedureDate=new SectionColumn(true,1);
this.startDate=new SectionColumn(true,2);
this.endDate=new SectionColumn(true,3);
this.totalTime=new SectionColumn(true,4);
this.procedureLocation=new SectionColumn(true,5);
this.performingPhysician=new SectionColumn(true,6);
this.procedureSections=new Array(10);
for(var index=0;
index<10;
index++){this.procedureSections[index]=new ProcedureSection(true,"Section "+(index+1),[]);
}ProceduresComponent.method("InsertData",function(){HIM_PROCEDURES.GetProceduresData(this);
});
ProceduresComponent.method("HandleSuccess",function(recordData){HIM_PROCEDURES.RenderComponent(this,recordData);
});
ProceduresComponent.method("getColumnOrder",function(){var order=[];
if(this.isProcedureNameActive()){order[this.getProcedureNameSequence()]=i18nProcedures.PROCEDURE_NAME;
}if(this.isProcedureDateActive()){order[this.getProcedureDateSequence()]=i18nProcedures.PROCEDURE_DATE;
}if(this.isStartDateActive()){order[this.getStartDateSequence()]=i18nProcedures.START_DATE;
}if(this.isEndDateActive()){order[this.getEndDateSequence()]=i18nProcedures.END_DATE;
}if(this.isTotalTimeActive()){order[this.getTotalTimeSequence()]=i18nProcedures.TOTAL_TIME;
}if(this.isProcedureLocationActive()){order[this.getProcedureLocationSequence()]=i18nProcedures.PROCEDURE_LOCATION;
}if(this.isPerformingPhysicianActive()){order[this.getPerformingPhysicianSequence()]=i18nProcedures.PERFORMING_PHYSICIAN;
}return order;
});
ProceduresComponent.method("isProcedureNameActive",function(){return(this.procedureName.active);
});
ProceduresComponent.method("setProcedureNameActive",function(value){this.procedureName.active=value;
});
ProceduresComponent.method("isProcedureDateActive",function(){return(this.procedureDate.active);
});
ProceduresComponent.method("setProcedureDateActive",function(value){this.procedureDate.active=value;
});
ProceduresComponent.method("isStartDateActive",function(){return(this.startDate.active);
});
ProceduresComponent.method("setStartDateActive",function(value){this.startDate.active=value;
});
ProceduresComponent.method("isEndDateActive",function(){return(this.endDate.active);
});
ProceduresComponent.method("setEndDateActive",function(value){this.endDate.active=value;
});
ProceduresComponent.method("isTotalTimeActive",function(){return(this.totalTime.active);
});
ProceduresComponent.method("setTotalTimeActive",function(value){this.totalTime.active=value;
});
ProceduresComponent.method("isProcedureLocationActive",function(){return(this.procedureLocation.active);
});
ProceduresComponent.method("setProcedureLocationActive",function(value){this.procedureLocation.active=value;
});
ProceduresComponent.method("isPerformingPhysicianActive",function(){return(this.performingPhysician.active);
});
ProceduresComponent.method("setPerformingPhysicianActive",function(value){this.performingPhysician.active=value;
});
ProceduresComponent.method("getProcedureNameSequence",function(){return(this.procedureName.sequence);
});
ProceduresComponent.method("setProcedureNameSequence",function(value){this.procedureName.sequence=value;
});
ProceduresComponent.method("getProcedureDateSequence",function(){return(this.procedureDate.sequence);
});
ProceduresComponent.method("setProcedureDateSequence",function(value){this.procedureDate.sequence=value;
});
ProceduresComponent.method("getStartDateSequence",function(){return(this.startDate.sequence);
});
ProceduresComponent.method("setStartDateSequence",function(value){this.startDate.sequence=value;
});
ProceduresComponent.method("getEndDateSequence",function(){return(this.endDate.sequence);
});
ProceduresComponent.method("setEndDateSequence",function(value){this.endDate.sequence=value;
});
ProceduresComponent.method("getTotalTimeSequence",function(){return(this.totalTime.sequence);
});
ProceduresComponent.method("setTotalTimeSequence",function(value){this.totalTime.sequence=value;
});
ProceduresComponent.method("getProcedureLocationSequence",function(){return(this.procedureLocation.sequence);
});
ProceduresComponent.method("setProcedureLocationSequence",function(value){this.procedureLocation.sequence=value;
});
ProceduresComponent.method("getPerformingPhysicianSequence",function(){return(this.performingPhysician.sequence);
});
ProceduresComponent.method("setPerformingPhysicianSequence",function(value){this.performingPhysician.sequence=value;
});
ProceduresComponent.method("isSection1Active",function(){return(this.procedureSections[0].active);
});
ProceduresComponent.method("setSection1Active",function(value){this.procedureSections[0].active=value;
});
ProceduresComponent.method("isSection2Active",function(){return(this.procedureSections[1].active);
});
ProceduresComponent.method("setSection2Active",function(value){this.procedureSections[1].active=value;
});
ProceduresComponent.method("isSection3Active",function(){return(this.procedureSections[2].active);
});
ProceduresComponent.method("setSection3Active",function(value){this.procedureSections[2].active=value;
});
ProceduresComponent.method("isSection4Active",function(){return(this.procedureSections[3].active);
});
ProceduresComponent.method("setSection4Active",function(value){this.procedureSections[3].active=value;
});
ProceduresComponent.method("isSection5Active",function(){return(this.procedureSections[4].active);
});
ProceduresComponent.method("setSection5Active",function(value){this.procedureSections[4].active=value;
});
ProceduresComponent.method("isSection6Active",function(){return(this.procedureSections[5].active);
});
ProceduresComponent.method("setSection6Active",function(value){this.procedureSections[5].active=value;
});
ProceduresComponent.method("isSection7Active",function(){return(this.procedureSections[6].active);
});
ProceduresComponent.method("setSection7Active",function(value){this.procedureSections[6].active=value;
});
ProceduresComponent.method("isSection8Active",function(){return(this.procedureSections[7].active);
});
ProceduresComponent.method("setSection8Active",function(value){this.procedureSections[7].active=value;
});
ProceduresComponent.method("isSection9Active",function(){return(this.procedureSections[8].active);
});
ProceduresComponent.method("setSection9Active",function(value){this.procedureSections[8].active=value;
});
ProceduresComponent.method("isSection10Active",function(){return(this.procedureSections[9].active);
});
ProceduresComponent.method("setSection10Active",function(value){this.procedureSections[9].active=value;
});
ProceduresComponent.method("getSection1Name",function(){return(this.procedureSections[0].name);
});
ProceduresComponent.method("setSection1Name",function(value){this.procedureSections[0].name=value;
});
ProceduresComponent.method("getSection2Name",function(){return(this.procedureSections[1].name);
});
ProceduresComponent.method("setSection2Name",function(value){this.procedureSections[1].name=value;
});
ProceduresComponent.method("getSection3Name",function(){return(this.procedureSections[2].name);
});
ProceduresComponent.method("setSection3Name",function(value){this.procedureSections[2].name=value;
});
ProceduresComponent.method("getSection4Name",function(){return(this.procedureSections[3].name);
});
ProceduresComponent.method("setSection4Name",function(value){this.procedureSections[3].name=value;
});
ProceduresComponent.method("getSection5Name",function(){return(this.procedureSections[4].name);
});
ProceduresComponent.method("setSection5Name",function(value){this.procedureSections[4].name=value;
});
ProceduresComponent.method("getSection6Name",function(){return(this.procedureSections[5].name);
});
ProceduresComponent.method("setSection6Name",function(value){this.procedureSections[5].name=value;
});
ProceduresComponent.method("getSection7Name",function(){return(this.procedureSections[6].name);
});
ProceduresComponent.method("setSection7Name",function(value){this.procedureSections[6].name=value;
});
ProceduresComponent.method("getSection8Name",function(){return(this.procedureSections[7].name);
});
ProceduresComponent.method("setSection8Name",function(value){this.procedureSections[7].name=value;
});
ProceduresComponent.method("getSection9Name",function(){return(this.procedureSections[8].name);
});
ProceduresComponent.method("setSection9Name",function(value){this.procedureSections[8].name=value;
});
ProceduresComponent.method("getSection10Name",function(){return(this.procedureSections[9].name);
});
ProceduresComponent.method("setSection10Name",function(value){this.procedureSections[9].name=value;
});
ProceduresComponent.method("getSection1EventSets",function(){return(this.procedureSections[0].eventSets);
});
ProceduresComponent.method("setSection1EventSets",function(value){this.procedureSections[0].eventSets=value;
});
ProceduresComponent.method("getSection2EventSets",function(){return(this.procedureSections[1].eventSets);
});
ProceduresComponent.method("setSection2EventSets",function(value){this.procedureSections[1].eventSets=value;
});
ProceduresComponent.method("getSection3EventSets",function(){return(this.procedureSections[2].eventSets);
});
ProceduresComponent.method("setSection3EventSets",function(value){this.procedureSections[2].eventSets=value;
});
ProceduresComponent.method("getSection4EventSets",function(){return(this.procedureSections[3].eventSets);
});
ProceduresComponent.method("setSection4EventSets",function(value){this.procedureSections[3].eventSets=value;
});
ProceduresComponent.method("getSection5EventSets",function(){return(this.procedureSections[4].eventSets);
});
ProceduresComponent.method("setSection5EventSets",function(value){this.procedureSections[4].eventSets=value;
});
ProceduresComponent.method("getSection6EventSets",function(){return(this.procedureSections[5].eventSets);
});
ProceduresComponent.method("setSection6EventSets",function(value){this.procedureSections[5].eventSets=value;
});
ProceduresComponent.method("getSection7EventSets",function(){return(this.procedureSections[6].eventSets);
});
ProceduresComponent.method("setSection7EventSets",function(value){this.procedureSections[6].eventSets=value;
});
ProceduresComponent.method("getSection8EventSets",function(){return(this.procedureSections[7].eventSets);
});
ProceduresComponent.method("setSection8EventSets",function(value){this.procedureSections[7].eventSets=value;
});
ProceduresComponent.method("getSection9EventSets",function(){return(this.procedureSections[8].eventSets);
});
ProceduresComponent.method("setSection9EventSets",function(value){this.procedureSections[8].eventSets=value;
});
ProceduresComponent.method("getSection10EventSets",function(){return(this.procedureSections[9].eventSets);
});
ProceduresComponent.method("setSection10EventSets",function(value){this.procedureSections[9].eventSets=value;
});
}ProceduresComponent.inherits(MPageComponent);
var HIM_PROCEDURES=function(){var i18nProcedures=i18n.accesshim.him.procedures;
return{GetProceduresData:function(component){var sendArray=[];
var criterion=component.getCriterion();
sendArray.push("^MINE^",criterion.person_id+".0",criterion.encntr_id+".0");
for(var section=1;
section<=10;
section++){var sLines=MP_Util.CreateParamArray(component["getSection"+section+"EventSets"](),1);
sendArray.push(sLines);
}MP_Core.XMLCclRequestWrapper(component,"him_mp_get_procedures",sendArray,true);
},RenderComponent:function(component,recordData){var timerMPage=MP_Util.CreateTimer("CAP:ACCESSHIM.Load Procedures Component");
if(timerMPage){timerMPage.Stop();
}var timerRenderComponent=MP_Util.CreateTimer(component.getComponentRenderTimerName());
try{var columnOrder=component.getColumnOrder();
var jsHTML=[];
for(var index=0;
index<recordData.QUAL.length;
index++){if(!component["isSection"+(index+1)+"Active"]()){continue;
}var jsSectionContent=[];
var jsSection=[];
if(recordData.QUAL[index].EVENT_SET_QUAL.length>0){jsSectionContent=fillSubSections(recordData.QUAL[index],columnOrder);
}jsSection.push("<div class='sub-sec'><h5 class='sub-sec-hd'><span class='sub-sec-hd-tgl' title='",i18n.HIDE_SECTION,"'>-</span><span class='sub-sec-title'>",component["getSection"+(index+1)+"Name"]()," (",recordData.QUAL[index].EVENT_SET_QUAL.length,") </span></h5>","<div class='sub-sec-content'>");
if(jsSectionContent.length>0){jsSection.push(jsSectionContent.join(""));
}else{jsSection.push("<span class='res-none'>",i18nProcedures.NO_RESULTS_FOUND,"</span>");
}jsSection.push("</div></div>");
jsHTML.push(jsSection.join(""));
}var content=[];
content.push("<div class ='",MP_Util.GetContentClass(component)," proc-outer'>",jsHTML.join(""),"</div>");
var sHTML=content.join("");
countText="";
MP_Util.Doc.FinalizeComponent(sHTML,component,countText);
}catch(err){if(timerRenderComponent){timerRenderComponent.Abort();
timerRenderComponent=null;
}throw (err);
}finally{if(timerRenderComponent){timerRenderComponent.Stop();
}}}};
function fillSubSections(sectionData,columns){var DataCount=sectionData.EVENT_SET_QUAL.length;
var jsSection=[];
var df=new mp_formatter.DateTimeFormatter(MPAGE_LOCALE);
var dateTime=new Date();
for(var subSection=0;
subSection<DataCount;
subSection++){var DataObj=sectionData.EVENT_SET_QUAL[subSection];
jsSection.push("<div class='closed'><h6 class='proc-sec-hd'><span class='sub-sec-hd-tgl proc-section' title='",i18n.SHOW_SECTION,"'>-</span><span class='sub-sec-title'>",DataObj.PROCEDURE_NAME,"</span></h6>","<div class='sub-sec-content'>");
jsSection.push("<table class='proc'>");
var isLeft=true;
for(var column=0;
column<columns.length;
column++){var label="";
var value="";
var jsColumn=[];
switch(columns[column]){case i18nProcedures.PROCEDURE_NAME:label=i18nProcedures.PROCEDURE_NAME;
value=DataObj.PROCEDURE_NAME;
break;
case i18nProcedures.PROCEDURE_DATE:label=i18nProcedures.PROCEDURE_DATE;
if(DataObj.PROCEDURE_DATE!=""){dateTime.setISO8601(DataObj.PROCEDURE_DATE);
value=df.format(dateTime,mp_formatter.DateTimeFormatter.FULL_DATE_4YEAR);
}break;
case i18nProcedures.START_DATE:label=i18nProcedures.START_DATE;
if(DataObj.START_DATE!=""){dateTime.setISO8601(DataObj.START_DATE);
value=df.format(dateTime,mp_formatter.DateTimeFormatter.FULL_DATE_4YEAR);
}break;
case i18nProcedures.END_DATE:label=i18nProcedures.END_DATE;
if(DataObj.END_DATE!=""){dateTime.setISO8601(DataObj.END_DATE);
value=df.format(dateTime,mp_formatter.DateTimeFormatter.FULL_DATE_4YEAR);
}break;
case i18nProcedures.TOTAL_TIME:label=i18nProcedures.TOTAL_TIME;
if(DataObj.START_DATE!=""&&DataObj.END_DATE!=""){value=getDateDiffString(DataObj.START_DATE,DataObj.END_DATE);
}break;
case i18nProcedures.PROCEDURE_LOCATION:label=i18nProcedures.PROCEDURE_LOCATION;
value=DataObj.PROCEDURE_LOCATION;
break;
case i18nProcedures.PERFORMING_PHYSICIAN:label=i18nProcedures.PERFORMING_PHYSICIAN;
value=DataObj.PERFORMING_PHYSICIAN;
break;
}jsColumn.push("<td class='proc-label'>",label,"</td><td class='proc-text'>",value,"</td>");
if(isLeft){jsSection.push("<tr>",jsColumn.join(""));
}else{jsSection.push(jsColumn.join(""),"</tr>");
}isLeft=!isLeft;
}if(columns.length%2==1){jsSection.push("<td class='proc-label'>&nbsp;</td><td class='proc-text'>&nbsp;</td></tr>");
}jsSection.push("</table></div></div>");
}return jsSection;
}function getDateDiffString(startDateString,endDateString){var startDate=new Date();
var endDate=new Date();
var diff=new Date();
var HOUR=1000*60*60;
var MINUTE=1000*60;
startDate.setISO8601(startDateString);
endDate.setISO8601(endDateString);
diff.setTime(Math.abs(startDate.getTime()-endDate.getTime()));
var timeDiff=diff.getTime();
hours=Math.floor(timeDiff/HOUR);
timeDiff-=hours*HOUR;
minutes=Math.floor(timeDiff/MINUTE);
timeDiff-=minutes*MINUTE;
if(hours==0&&minutes==0){return"";
}return(hours+"<span class='proc-small-text'>"+i18nProcedures.HOURS+"</span> "+minutes+"<span class='proc-small-text'>"+i18nProcedures.MINUTES+"</span>");
}}();
function RegistrationDischargeInfoComponentStyle(){this.initByNamespace("him_rdi");
}RegistrationDischargeInfoComponentStyle.inherits(ComponentStyle);
function RegistrationDischargeInfoComponent(criterion){this.setCriterion(criterion);
this.setStyles(new RegistrationDischargeInfoComponentStyle());
this.setComponentLoadTimerName("USR:MPG.HIM_REGISTRATION_DISCHARGE_INFO - load component");
this.setComponentRenderTimerName("ENG:MPG.HIM_REGISTRATION_DISCHARGE_INFO - render component");
this.registrationDischargeI18N=i18n.accesshim.him.registrationDischarge;
RegistrationDischargeInfoComponent.method("InsertData",function(){HIM_REGISTRATION_DISCHARGE_INFO.GetRegistrationDischargeTable(this);
});
RegistrationDischargeInfoComponent.method("HandleSuccess",function(recordData){HIM_REGISTRATION_DISCHARGE_INFO.RenderComponent(this,recordData);
});
function DataRow(rowIdentifier){this.rowIdentifier=rowIdentifier;
this.enabled=true;
this.display="";
this.sequence=0;
}DataRow.method("isEnabled",function(){return(this.enabled);
});
DataRow.method("setEnabled",function(value){this.enabled=value;
});
DataRow.method("getDisplay",function(){return(this.display);
});
DataRow.method("setDisplay",function(value){this.display=value;
});
DataRow.method("getSequence",function(){return(this.sequence);
});
DataRow.method("setSequence",function(value){this.sequence=parseInt(value);
});
this.ENCOUNTER_TYPE_ROW=0;
this.ATTENDING_PHYSICIAN_ROW=1;
this.FACILITY_ROW=2;
this.PAYER_ROW=3;
this.SECONDARY_PAYER_ROW=4;
this.REGISTRATION_DATE_ROW=5;
this.ADMIT_DATE_ROW=6;
this.ADMIT_SOURCE_ROW=7;
this.DISCHARGE_DATE_ROW=8;
this.DISCHARGE_DISPOSITION_ROW=9;
this.DISCHARGE_LOCATION_ROW=10;
this.DECEASED_DATE_ROW=11;
this.CAUSE_OF_DEATH_ROW=12;
this.LENGTH_OF_STAY_ROW=13;
this.rdiComponentRows=[];
for(var index=0;
index<=13;
index++){this.rdiComponentRows[index]=new DataRow(index);
}RegistrationDischargeInfoComponent.method("GetDefaultRowName",function(rowIdentifier){switch(rowIdentifier){case this.ENCOUNTER_TYPE_ROW:return this.registrationDischargeI18N.ENCOUNTER_TYPE;
case this.ATTENDING_PHYSICIAN_ROW:return this.registrationDischargeI18N.ATTENDING_PHYSICIAN;
case this.FACILITY_ROW:return this.registrationDischargeI18N.FACILITY;
case this.PAYER_ROW:return this.registrationDischargeI18N.PAYER;
case this.SECONDARY_PAYER_ROW:return this.registrationDischargeI18N.SECONDARY_PAYER;
case this.REGISTRATION_DATE_ROW:return this.registrationDischargeI18N.REGISTRATION_DATE;
case this.ADMIT_DATE_ROW:return this.registrationDischargeI18N.ADMIT_DATE;
case this.ADMIT_SOURCE_ROW:return this.registrationDischargeI18N.ADMIT_SOURCE;
case this.DISCHARGE_DATE_ROW:return this.registrationDischargeI18N.DISCHARGE_DATE;
case this.DISCHARGE_DISPOSITION_ROW:return this.registrationDischargeI18N.DISCHARGE_DISPOSITION;
case this.DISCHARGE_LOCATION_ROW:return this.registrationDischargeI18N.DISCHARGE_LOCATION;
case this.DECEASED_DATE_ROW:return this.registrationDischargeI18N.DECEASED_DATE;
case this.CAUSE_OF_DEATH_ROW:return this.registrationDischargeI18N.CAUSE_OF_DEATH;
case this.LENGTH_OF_STAY_ROW:return this.registrationDischargeI18N.LOS;
}});
}RegistrationDischargeInfoComponent.inherits(MPageComponent);
var HIM_REGISTRATION_DISCHARGE_INFO=function(){return{GetRegistrationDischargeTable:function(component){var requestArray=[];
var criterion=component.getCriterion();
requestArray.push("^MINE^",criterion.person_id+".0",criterion.encntr_id+".0");
MP_Core.XMLCclRequestWrapper(component,"him_mp_get_reg_dsch_info",requestArray,true);
},RenderComponent:function(component,recordData){var timerMPage=MP_Util.CreateTimer("CAP:ACCESSHIM.Load Registration Discharge Component");
if(timerMPage){timerMPage.Stop();
}var timerRenderComponent=MP_Util.CreateTimer(component.getComponentRenderTimerName());
try{var mainArray=[];
this.registrationDischargeI18N=i18n.accesshim.him.registrationDischarge;
this.dateFormatter=new mp_formatter.DateTimeFormatter(MPAGE_LOCALE);
iconPath="";
iconPath=component.criterion.static_content.replace(/%5C/g,"\\");
iconPath=iconPath.replace(/%20/g," ");
var columnArray=component.rdiComponentRows.sort(HIM_REGISTRATION_DISCHARGE_INFO.SortBySequence);
mainArray.push(HIM_REGISTRATION_DISCHARGE_INFO.GetReadmissionBanner(component,recordData.ENCNTR.READMISSION_IND));
mainArray.push("<table id='him-admt-dchg-table' class='him-table'>");
for(var index=0;
index<columnArray.length;
index++){if(columnArray[index].isEnabled()){mainArray.push(HIM_REGISTRATION_DISCHARGE_INFO.GetComponentRow(component,columnArray[index],recordData));
}}mainArray.push("</table>");
sHTML=mainArray.join("");
countText="";
MP_Util.Doc.FinalizeComponent(sHTML,component,countText);
}catch(err){if(timerRenderComponent){timerRenderComponent.Abort();
timerRenderComponent=null;
}throw (err);
}finally{if(timerRenderComponent){timerRenderComponent.Stop();
}}},GetComponentRow:function(component,dataRow,recordData){var rowArray=[];
if(dataRow.getDisplay()==""){dataRow.setDisplay(component.GetDefaultRowName(dataRow.rowIdentifier));
}rowArray.push("<tr><td class='him-row-title'>"+dataRow.getDisplay()+"</td>");
switch(dataRow.rowIdentifier){case component.ENCOUNTER_TYPE_ROW:rowArray.push("<td>"+recordData.ENCNTR.ENCNTR_TYPE+"</td></tr>");
break;
case component.ATTENDING_PHYSICIAN_ROW:rowArray.push("<td>"+recordData.ENCNTR.ATTENDING_PHYSICIAN+"</td></tr>");
break;
case component.FACILITY_ROW:rowArray.push("<td>"+recordData.ENCNTR.FACILITY+"</td></tr>");
break;
case component.PAYER_ROW:rowArray.push("<td>"+recordData.ENCNTR.PAYER+"</td></tr>");
break;
case component.SECONDARY_PAYER_ROW:rowArray.push("<td>"+recordData.ENCNTR.SECONDARY_PAYER+"</td></tr>");
break;
case component.REGISTRATION_DATE_ROW:var registrationDateDisplay;
if(recordData.ENCNTR.REGISTRATION_DATE!=""){var registrationDateTime=new Date();
registrationDateTime.setISO8601(recordData.ENCNTR.REGISTRATION_DATE);
registrationDateDisplay=this.dateFormatter.format(registrationDateTime,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_4YEAR);
}else{registrationDateDisplay="";
}rowArray.push("<td>"+registrationDateDisplay);
rowArray.push("</td></tr>");
break;
case component.ADMIT_DATE_ROW:var admitDateDisplay;
if(recordData.ENCNTR.ADMIT_DATE!=""){var admitDateTime=new Date();
admitDateTime.setISO8601(recordData.ENCNTR.ADMIT_DATE);
admitDateDisplay=this.dateFormatter.format(admitDateTime,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_4YEAR);
}else{admitDateDisplay="";
}rowArray.push("<td>"+admitDateDisplay+"</td></tr>");
break;
case component.ADMIT_SOURCE_ROW:rowArray.push("<td>"+recordData.ENCNTR.ADMIT_SOURCE+"</td></tr>");
break;
case component.DISCHARGE_DATE_ROW:var dischargeDateDisplay;
if(recordData.ENCNTR.DISCHARGE_DATE!=""){var dischargeDateTime=new Date();
dischargeDateTime.setISO8601(recordData.ENCNTR.DISCHARGE_DATE);
dischargeDateDisplay=this.dateFormatter.format(dischargeDateTime,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_4YEAR);
}else{dischargeDateDisplay="";
}rowArray.push("<td>"+dischargeDateDisplay+"</td></tr>");
break;
case component.DISCHARGE_DISPOSITION_ROW:rowArray.push("<td>"+recordData.ENCNTR.DISCHARGE_DISPOSITION+"</td></tr>");
break;
case component.DISCHARGE_LOCATION_ROW:rowArray.push("<td>"+recordData.ENCNTR.DISCHARGE_LOCATION+"</td></tr>");
break;
case component.DECEASED_DATE_ROW:var deceasedDateDisplay;
if(recordData.PERSON.DECEASED_DATE!=""){var deceasedDateTime=new Date();
deceasedDateTime.setISO8601(recordData.PERSON.DECEASED_DATE);
deceasedDateDisplay=this.dateFormatter.format(deceasedDateTime,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_4YEAR);
}else{deceasedDateDisplay="";
}rowArray.push("<td>"+deceasedDateDisplay+"</td></tr>");
break;
case component.CAUSE_OF_DEATH_ROW:rowArray.push("<td>"+recordData.PERSON.CAUSE_OF_DEATH+"</td></tr>");
break;
case component.LENGTH_OF_STAY_ROW:if(recordData.ENCNTR.LENGTH_OF_STAY>1){rowArray.push("<td>"+recordData.ENCNTR.LENGTH_OF_STAY+" <span class='him-units'>"+component.registrationDischargeI18N.DAYS+"</span></td></tr>");
}else{if(recordData.ENCNTR.LENGTH_OF_STAY==1){rowArray.push("<td>"+recordData.ENCNTR.LENGTH_OF_STAY+" <span class='him-units'>"+component.registrationDischargeI18N.DAY+"</span></td></tr>");
}}break;
}return rowArray.join("");
},SortBySequence:function(a,b){if(a.getSequence()>b.getSequence()){return 1;
}else{if(a.getSequence()<b.getSequence()){return -1;
}}return 0;
},GetReadmissionBanner:function(component,readmissionIndicator){var bannerArray=[];
if(readmissionIndicator&&readmissionIndicator!="0"){bannerArray.push("<table id='him-banner-message-table' class='him-banner'>");
bannerArray.push("<tr><td class='him-banner-image'>");
bannerArray.push('<img src="'+iconPath+'\\images\\4015_16.gif"/></td>');
var readmissionHours="";
switch(readmissionIndicator){case"1":readmissionHours=component.registrationDischargeI18N.READMISSION_24;
break;
case"2":readmissionHours=component.registrationDischargeI18N.READMISSION_72;
break;
}if(readmissionHours){bannerArray.push("<td class='him-banner-text'><b>"+readmissionHours+component.registrationDischargeI18N.READMISSION_HR_ADMISSION+"</b>"+component.registrationDischargeI18N.READMISSION_MSG_1+readmissionHours+component.registrationDischargeI18N.READMISSION_MSG_2+"</td>");
bannerArray.push("</table></br>");
}}return(bannerArray.join(""));
}};
}();
function ActivitiesComponentStyle(){this.initByNamespace("act");
}ActivitiesComponentStyle.inherits(ComponentStyle);
function ActivitiesComponent(criterion){this.setCriterion(criterion);
this.setStyles(new ActivitiesComponentStyle());
this.setComponentLoadTimerName("USR:MPG.ACTIVITIES.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.ACTIVITIES.O1 - render component");
this.setIncludeLineNumber(true);
this.setScope(2);
this.setResultCount(1);
ActivitiesComponent.method("HandleSuccess",function(replyAr,component){CERN_ACTIVITIES_O1.RenderComponent(component,replyAr[0].getResponse());
});
ActivitiesComponent.method("openTab",function(){var criterion=this.getCriterion();
var paramString=criterion.person_id+"|"+criterion.encntr_id+"|"+0+"|0|0";
MP_Util.LogMpagesEventInfo(null,"POWERFORM",paramString,"activities.js","openTab");
MPAGES_EVENT("POWERFORM",paramString);
this.InsertData();
});
ActivitiesComponent.method("openDropDown",function(formID){var criterion=this.getCriterion();
var paramString=criterion.person_id+"|"+criterion.encntr_id+"|"+formID+"|0|0";
MP_Util.LogMpagesEventInfo(null,"POWERFORM",paramString,"activities.js","openDropDown");
MPAGES_EVENT("POWERFORM",paramString);
this.InsertData();
});
}ActivitiesComponent.inherits(MeasurementBaseComponent);
var CERN_ACTIVITIES_O1=function(){return{RenderComponent:function(component,recordData){var timerRenderComponent=MP_Util.CreateTimer(component.getComponentRenderTimerName());
try{var sHTML="",countText="";
var ar=[];
var codeArray=MP_Util.LoadCodeListJSON(recordData.CODES);
var personnelArray=MP_Util.LoadPersonelListJSON(recordData.PRSNL);
var measureArray=CERN_MEASUREMENT_BASE_O1.LoadMeasurementDataArray(recordData,personnelArray,codeArray);
var df=new mp_formatter.DateTimeFormatter(MPAGE_LOCALE);
var measLen=measureArray.length;
ar.push("<div class='",MP_Util.GetContentClass(component,measLen),"'>");
for(var i=0,l=measureArray.length;
i<l;
i++){var measObject=measureArray[i];
var display=measObject.getEventCode().display;
var oDate=measObject.getDateTime();
var sDate=(oDate)?df.format(oDate,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_2YEAR):"";
ar.push("<dl class='act-info'><dt class='act-disp-lbl'>",display,"</dt><dd class='act-name'>",display,"</dd><dt class='act-res-lbl'>",i18n.discernabu.activities_o1.RESULT," </dt><dd class='act-res'>");
ar.push(MP_Util.Measurement.GetNormalcyResultDisplay(measObject));
ar.push("</dd><dt class='actdate'>",sDate,"</dt><dd class='act-dt'><span class='date-time'>",sDate,"</span></dd></dl>");
}ar.push("</div>");
sHTML=ar.join("");
countText=MP_Util.CreateTitleText(component,measLen);
var compNS=component.getStyles().getNameSpace();
MP_Util.Doc.FinalizeComponent(sHTML,component,countText);
}catch(err){if(timerRenderComponent){timerRenderComponent.Abort();
timerRenderComponent=null;
}throw (err);
}finally{if(timerRenderComponent){timerRenderComponent.Stop();
}}}};
}();
function CvComponentStyle(){this.initByNamespace("cv");
}CvComponentStyle.inherits(ComponentStyle);
function CvComponent(criterion){this.m_diagnosisTargetVocabCd=0;
this.m_problemTargetVocabCd=0;
this.m_canAddConditionFlag=0;
this.m_historicalLabelDisplay="";
this.m_activeLabelDisplay="";
this.m_visitLabelDisplay="";
this.m_nNewConditionType=-1;
this.m_dNewConditionNomenclatureId=0;
this.m_nNewConditionIndx=0;
this.m_loadedConditions=null;
this.m_sList=[];
this.m_sPlaceHolder="";
this.m_cvDragging=false;
this.m_cvDropLocation="";
this.m_cvDragParentDiv="";
this.m_cvDragNomenId=0;
this.m_cvSourceSection="";
this.m_nProcessing=0;
this.m_nWaitCursor=0;
this.m_bActiveExpanded=true;
this.m_bHistoricalExpanded=false;
this.m_nRefreshCount=0;
this.m_cvAddAsType=-1;
try{this.m_cvProbDxObj=window.external.DiscernObjectFactory("PROBDXUTILS");
}catch(err){}if(false){try{var modMethodTest=this.m_cvProbDxObj.LoadProblemAndInvokeModify(0,criterion.person_id,false);
this.hasModMethod=true;
modMethodTest=null;
}catch(err){this.hasModMethod=false;
}}else{this.hasModMethod=false;
}this.setCriterion(criterion);
this.setStyles(new CvComponentStyle());
this.setComponentLoadTimerName("USR:MPG.CONSOL_PROB.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.CONSOL_PROB.O1 - render component");
this.setIncludeLineNumber(false);
this.m_editMode=false;
this.m_defaultSearchVocab=0;
this.m_visitVocab=0;
this.m_activeVocab=0;
this.m_visitLabel="";
this.m_activeLabel="";
this.m_historicalLabel="";
this.m_visitAddClass=0;
this.m_visitAddType=0;
this.m_activeAddClass=0;
this.m_activeAddType=0;
this.m_compObject={cvObject:[],cvModRootId:null,cvCompId:null,cvCompSec:null,iSearchTypeFlag:0,sec:"",criterion:null,curSearchCounter:0,replySearchCounter:0};
this.setScope(1);
CvComponent.method("InsertData",function(){CERN_CV_O1.GetCvTable(this);
});
CvComponent.method("HandleSuccess",function(conditionData){CERN_CV_O1.RenderComponent(this,conditionData);
});
CvComponent.method("setDefaultSearchVocab",function(value){this.m_defaultSearchVocab=value;
});
CvComponent.method("getDefaultSearchVocab",function(){return this.m_defaultSearchVocab;
});
CvComponent.method("setVisitVocab",function(value){this.m_visitVocab=value;
});
CvComponent.method("getVisitVocab",function(){return this.m_visitVocab;
});
CvComponent.method("setActiveVocab",function(value){this.m_activeVocab=value;
});
CvComponent.method("getActiveVocab",function(){return this.m_activeVocab;
});
CvComponent.method("setVisitLabel",function(value){this.m_visitLabel=value;
});
CvComponent.method("getVisitLabel",function(){return this.m_visitLabel;
});
CvComponent.method("setActiveLabel",function(value){this.m_activeLabel=value;
});
CvComponent.method("getActiveLabel",function(){return this.m_activeLabel;
});
CvComponent.method("setHistoricalLabel",function(value){this.m_historicalLabel=value;
});
CvComponent.method("getHistoricalLabel",function(){return this.m_historicalLabel;
});
CvComponent.method("getVisitAddType",function(){return this.m_visitAddType;
});
CvComponent.method("setVisitAddType",function(value){this.m_visitAddType=value;
});
CvComponent.method("getVisitAddClass",function(){return this.m_visitAddClass;
});
CvComponent.method("setVisitAddClass",function(value){this.m_visitAddClass=value;
});
CvComponent.method("getActiveAddType",function(){return this.m_activeAddType;
});
CvComponent.method("setActiveAddType",function(value){this.m_activeAddType=value;
});
CvComponent.method("getActiveAddClass",function(){return this.m_activeAddClass;
});
CvComponent.method("setActiveAddClass",function(value){this.m_activeAddClass=value;
});
CvComponent.method("openTab",function(){var criterion=this.getCriterion();
var sParms="/PERSONID="+criterion.person_id+" /ENCNTRID="+criterion.encntr_id+" /FIRSTTAB=^"+this.getLink()+"+^";
APPLINK(0,criterion.executable,sParms);
this.InsertData();
});
}CvComponent.inherits(MPageComponent);
var CERN_CV_O1=function(){return{GetCvTable:function(component){component.m_compObject.cvCompId=component.getComponentId();
component.m_compObject.cvModRootId="cv"+component.m_compObject.cvCompId;
component.m_compObject.cvCompSec=_g(component.m_compObject.cvModRootId);
var titleFrag=Util.ce("span");
var innerHTMLArr=[];
innerHTMLArr.push('<span id="cvProcessing',+component.m_compObject.cvCompId,'" class="processing hide">',i18n.discernabu.consolproblem_o1.PROCESSING,"</span>");
titleFrag.innerHTML=innerHTMLArr.join("");
var secTitle=Util.Style.g("sec-title",component.m_compObject.cvCompSec,"span")[0];
Util.ia(titleFrag,secTitle);
CERN_CV_O1.processingUI(component,"cvProcessing"+component.m_compObject.cvCompId,0,true,CERN_CV_O1.updateCVActions,component.m_compObject.cvCompId);
var sendAr=[];
component.m_compObject.criterion=component.getCriterion();
sendAr.push("^MINE^",component.m_compObject.criterion.person_id+".0",component.m_compObject.criterion.provider_id+".0",component.m_compObject.criterion.encntr_id+".0",component.m_compObject.criterion.ppr_cd+".0",component.m_compObject.criterion.position_cd+".0","^"+component.m_compObject.criterion.category_mean+"^",component.getDefaultSearchVocab()+".0");
MP_Core.XMLCclRequestWrapper(component,"MP_GET_CONDITIONS",sendAr,true);
component.m_compObject.sec=component.getStyles().getNameSpace();
component.m_diagnosisTargetVocabCd=component.getVisitVocab();
component.m_diagnosisTargetVocabCd=parseFloat(component.m_diagnosisTargetVocabCd.toFixed(1));
component.m_problemTargetVocabCd=component.getActiveVocab();
component.m_problemTargetVocabCd=parseFloat(component.m_problemTargetVocabCd.toFixed(1));
component.m_historicalLabelDisplay=component.getHistoricalLabel();
component.m_activeLabelDisplay=component.getActiveLabel();
component.m_visitLabelDisplay=component.getVisitLabel();
},RenderComponent:function(component,conditionData){var timerRenderComponent=MP_Util.CreateTimer(component.getComponentRenderTimerName());
try{MP_Util.Doc.HideHovers();
component.setEditMode(true);
CERN_CV_O1.processingUI(component,"cvProcessing"+component.m_compObject.cvCompId,-1,true,CERN_CV_O1.updateCVActions,component.m_compObject.cvCompId);
var iconPath="";
iconPath=component.m_compObject.criterion.static_content.replace(/%5C/g,"\\");
iconPath=iconPath.replace(/%20/g," ");
var secHTMLArray=[];
var secHTML="";
var countText="";
var cvSetObject=conditionData.SETTINGS;
var cvDataObject=conditionData.DATA;
var i=0;
var oCondition="";
var optMenuCV="";
var sIndicator=0;
component.m_loadedConditions=conditionData;
if(cvSetObject){var listLength=0;
component.m_canAddConditionFlag=cvSetObject.CAN_ADD_CONDITION_FLAG;
secHTMLArray.push("<div class='cv-ControlDiv' id='cvClassificationDiv",component.m_compObject.cvCompId,"'>","<span class='cv-ClassFilterLabel'>",i18n.discernabu.consolproblem_o1.CLASSIFICATION,":</span>","<span class='cvClassFilterSpan' id='cvClassFilterSpan",component.m_compObject.cvCompId,"'></span></div>","<div class ='cv-ControlDiv' id ='cvControlsDiv",component.m_compObject.cvCompId,"'>","<span class='cv-AddLabel'>",i18n.discernabu.consolproblem_o1.ADD_NEW_AS,"</span>","<span class='cvAddTypeSpan' id='cvAddTypeSpan",component.m_compObject.cvCompId,"'></span>","<span class='cv-SelectList' id='cvSelectListId",component.m_compObject.cvCompId,"'></span>",MP_Util.CreateAutoSuggestBoxHtml(component),"</div>");
listLength=cvDataObject.THIS_VISIT.length;
secHTMLArray.push('<div><div id="TVHD',component.m_compObject.cvCompId,'" class="sub-sec-hd"><span class="sub-sec-title">',component.m_visitLabelDisplay," (",listLength,")</span></div>",'<div id = "cvTV',component.m_compObject.cvCompId,'" class="sub-sec-content"><ul id = "cv-TVList',component.m_compObject.cvCompId,'">');
if(listLength>0){for(i=0;
i<listLength;
i++){oCondition=cvDataObject.THIS_VISIT[i];
var conditionRowID="TV"+oCondition.NOMENCLATURE_ID+"IDX"+oCondition.CONDITION_INDEX+"UNIQ"+component.m_compObject.cvCompId;
var sConditionDisplay=oCondition.DISPLAY;
if(oCondition.ICD9DISPLAY){sConditionDisplay=sConditionDisplay+" ("+oCondition.ICD9DISPLAY+")";
}sIndicator=((component.m_nNewConditionType===0||component.m_nNewConditionType===1)&&((component.m_dNewConditionNomenclatureId>0&&component.m_dNewConditionNomenclatureId==oCondition.NOMENCLATURE_ID)||(component.m_dNewConditionNomenclatureId==0&&component.m_nNewConditionIndx==oCondition.CONDITION_INDEX)))?"*":"";
secHTMLArray.push('<dl class="cv-info" id=',conditionRowID,'><span class = "tv-info">');
var tvCommentCnt=cvDataObject.THIS_VISIT[i].COMMENTS.length;
if(tvCommentCnt>0){secHTMLArray.push('<dt class="icon4972" id=',conditionRowID,"COM",'><img src="',iconPath,'\\images\\4972.gif"/></dt>');
}if(component.hasModMethod){secHTMLArray.push('<dt class="cv-edit-img cv-hidden" id=',conditionRowID,"MOD",'><img src="',iconPath,'\\images\\6250_16.png"/></dt>');
}secHTMLArray.push('<dt class="cv-name">',sIndicator,sConditionDisplay,"</dt></span></dl>",CERN_CV_O1.renderConditionDetails(oCondition));
}}else{secHTMLArray.push('<span class="no-doc">--</span>');
}listLength=cvDataObject.ACTIVE.length;
secHTMLArray.push('</ul></div></div><div><div id="ACHD',component.m_compObject.cvCompId,'" class="sub-sec-hd"><span id="cvActiveToggle',component.m_compObject.cvCompId,'" class="sub-sec-hd-tgl" title="',i18n.HIDE_SECTION,'">-</span><span class="sub-sec-title">',component.m_activeLabelDisplay," (",listLength,')</span></div><div id = "cvAC',component.m_compObject.cvCompId,'" class="sub-sec-content"><ul id = "cv-ACList',component.m_compObject.cvCompId,'">');
if(listLength>0){for(i=0;
i<listLength;
i++){oCondition=cvDataObject.ACTIVE[i];
var conditionRowID="AC"+oCondition.NOMENCLATURE_ID+"IDX"+oCondition.CONDITION_INDEX+"UNIQ"+component.m_compObject.cvCompId;
sIndicator=((component.m_nNewConditionType===1||component.m_nNewConditionType===2)&&((component.m_dNewConditionNomenclatureId>0&&component.m_dNewConditionNomenclatureId==oCondition.NOMENCLATURE_ID)||(component.m_dNewConditionNomenclatureId==0&&component.m_nNewConditionIndx==oCondition.CONDITION_INDEX)))?"*":"";
secHTMLArray.push('<dl class="cv-info" id=',conditionRowID,'><span class = "ac-info">');
var acCommentCnt=cvDataObject.ACTIVE[i].COMMENTS.length;
if(acCommentCnt>0){secHTMLArray.push('<dt class="icon4972" id=',conditionRowID,"COM",'><img src="',iconPath,'\\images\\4972.gif"/></dt>');
}if(component.hasModMethod){secHTMLArray.push('<dt class="cv-edit-img cv-hidden" id=',conditionRowID,"MOD",'><img src="',iconPath,'\\images\\6250_16.png"/></dt>');
}secHTMLArray.push('<dt class="cv-name">',sIndicator,oCondition.DISPLAY,"</dt></span></dl>",CERN_CV_O1.renderConditionDetails(oCondition));
}}else{secHTMLArray.push('<span class="no-doc">--</span>');
}listLength=cvDataObject.HISTORICAL.length;
secHTMLArray.push('</ul></div></div><div><div id="HXHD',component.m_compObject.cvCompId,'" class="sub-sec-hd"><span id="cvHistoricalToggle',component.m_compObject.cvCompId,'" class="sub-sec-hd-tgl" title=',i18n.HIDE_SECTION,'>-</span><span class="sub-sec-title">',component.m_historicalLabelDisplay," (",listLength,")</span></div>",'<div id="cvHX',component.m_compObject.cvCompId,'" class="sub-sec-content"><ul id = "cv-HXList',component.m_compObject.cvCompId,'">');
if(listLength>0){for(i=0;
i<listLength;
i++){oCondition=cvDataObject.HISTORICAL[i];
var conditionRowID="HX"+oCondition.NOMENCLATURE_ID+"IDX"+oCondition.CONDITION_INDEX+"UNIQ"+component.m_compObject.cvCompId;
sIndicator=(component.m_nNewConditionType===3&&((component.m_dNewConditionNomenclatureId>0&&component.m_dNewConditionNomenclatureId==oCondition.NOMENCLATURE_ID)||(component.m_dNewConditionNomenclatureId==0&&component.m_nNewConditionIndx==oCondition.CONDITION_INDEX)))?"*":"";
secHTMLArray.push('<dl class="cv-info cvHistoricalItem" id=',conditionRowID,'><span class = "hs-info">');
var hsCommentCnt=cvDataObject.HISTORICAL[i].COMMENTS.length;
if(hsCommentCnt>0){secHTMLArray.push('<dt class="icon4972" id=',conditionRowID,"COM",'><img src="',iconPath,'\\images\\4972.gif"/></dt>');
}if(component.hasModMethod){secHTMLArray.push('<dt class="cv-edit-img cv-hidden" id=',conditionRowID,"MOD",'><img src="',iconPath,'\\images\\6250_16.png"/></dt>');
}secHTMLArray.push('<dt class="cv-name">',sIndicator,oCondition.DISPLAY,"</dt></span></dl>",CERN_CV_O1.renderConditionDetails(oCondition));
}}else{secHTMLArray.push('<span class="no-doc">--</span>');
}secHTMLArray.push("</ul></div></div></div>");
secHTML=secHTMLArray.join("");
MP_Util.Doc.FinalizeComponent(secHTML,component,countText);
component.m_compObject.iSearchTypeFlag=cvSetObject.CONDITION_SEARCH_TYPE_FLAG;
MP_Util.AddAutoSuggestControl(component,CERN_CV_O1.searchNomenclature,CERN_CV_O1.addCondition,CERN_CV_O1.CreateSuggestionLine);
CERN_CV_O1.cvBuildClassificationMenu(component.m_compObject.cvCompId,cvSetObject.CLASS_VIEW_FILTER_FLAG);
var classificationDiv=_g("cvClassificationDiv"+component.m_compObject.cvCompId);
if(Util.Style.ccss(classificationDiv,"cv-ControlDiv")){Util.Style.rcss(classificationDiv,"cv-ControlDiv");
Util.Style.acss(classificationDiv,"cv-ClassificationDiv");
}var controlsDiv=_g("cvControlsDiv"+component.m_compObject.cvCompId);
if(component.m_canAddConditionFlag>0){controlsDiv.className="sec-content";
controlsDiv.style.overflow="hidden";
}if(component.m_cvAddAsType==-1){switch(component.m_canAddConditionFlag){case 1:case 3:component.m_cvAddAsType=0;
break;
case 2:component.m_cvAddAsType=2;
break;
}if(component.m_canAddConditionFlag>0){CERN_CV_O1.cvBuildConditionAddOptions(-1,component.m_compObject.cvCompId);
}}else{if(component.m_canAddConditionFlag>0){CERN_CV_O1.cvBuildConditionAddOptions(component.m_cvAddAsType,component.m_compObject.cvCompId);
}}component.m_nNewConditionType=-1;
component.m_dNewConditionNomenclatureId=0;
component.m_nNewConditionIndx=0;
}var AC=_g("cvAC"+component.m_compObject.cvCompId);
Util.addEvent(AC,"mouseover",function(){CERN_CV_O1.m_cvDropLocationAC(component.m_compObject.cvCompId);
});
Util.addEvent(AC,"mouseout",function(){CERN_CV_O1.m_cvResetDropLocation(component.m_compObject.cvCompId);
});
var TV=_g("cvTV"+component.m_compObject.cvCompId);
Util.addEvent(TV,"mouseover",function(){CERN_CV_O1.m_cvDropLocationTV(component.m_compObject.cvCompId);
});
Util.addEvent(TV,"mouseout",function(){CERN_CV_O1.m_cvResetDropLocation(component.m_compObject.cvCompId);
});
var mnuConsolidatedViewMenu=_g("moreOptCV"+component.m_compObject.cvCompId);
if(mnuConsolidatedViewMenu){optMenuCV=_g("moreOptMenuCV"+component.m_compObject.cvCompId);
Util.Style.acss(optMenuCV,"menu-hide");
Util.de(mnuConsolidatedViewMenu);
}var menuFrag=Util.ce("span");
var innerHTMLArr=[];
innerHTMLArr.push('<span class="opts-menu" id="moreOptCV',component.m_compObject.cvCompId,'">&nbsp;</span>','<div class="opts-menu-content menu-hide" id="moreOptMenuCV',component.m_compObject.cvCompId,'">','<div class="opts-menu-item opts-menu-item-dthr" id="mnuCVRemoveDiagnoses',component.m_compObject.cvCompId,'">',i18n.discernabu.consolproblem_o1.REMOVE_FROM.replace("{0}",component.m_visitLabelDisplay),"</div>",'<div class="opts-menu-item opts-menu-item-dthr" id="mnuCVResolve',component.m_compObject.cvCompId,'">',i18n.discernabu.consolproblem_o1.RESOLVE,"</div>",'<div class="opts-menu-item opts-menu-item-dthr" id="mnuCVInactive',component.m_compObject.cvCompId,'">',i18n.discernabu.consolproblem_o1.INACTIVATE,"</div>",'<div class="opts-menu-item opts-menu-item-dthr" id="mnuCVCancel',component.m_compObject.cvCompId,'">',i18n.discernabu.consolproblem_o1.CANCEL,"</div>",'<div class="opts-menu-item opts-menu-item-dthr" id="mnuCVMoveToActive',component.m_compObject.cvCompId,'">',i18n.discernabu.consolproblem_o1.MOVE_TO.replace("{0}",component.m_activeLabelDisplay)," </div>",'<div class="opts-menu-item opts-menu-item-dthr" id="mnuCVMoveToThisVisit',component.m_compObject.cvCompId,'">',i18n.discernabu.consolproblem_o1.MOVE_TO.replace("{0}",component.m_visitLabelDisplay)," </div></div>");
menuFrag.innerHTML=innerHTMLArr.join("");
var secHdTgl=Util.Style.g("sec-hd-tgl",component.m_compObject.cvCompSec,"span")[0];
Util.ia(menuFrag,secHdTgl);
optMenuCV=_g("moreOptMenuCV"+component.m_compObject.cvCompId);
Util.addEvent(_g("moreOptCV"+component.m_compObject.cvCompId),"click",function(){var element=_g("cvControlsDiv"+component.m_compObject.cvCompId);
var checkClosed=(Util.gp(Util.gp(element)));
if(!Util.Style.ccss(checkClosed,"closed")&&component.m_nProcessing===0){if(Util.Style.ccss(optMenuCV,"menu-hide")){Util.Style.rcss(optMenuCV,"menu-hide");
}else{Util.Style.acss(optMenuCV,"menu-hide");
}}else{Util.Style.acss(optMenuCV,"menu-hide");
}});
CERN_CV_O1.closeMenuInit(component.m_compObject.cvCompId,optMenuCV);
var cvRows=Util.Style.g("cv-info",_g("cvContent"+component.m_compObject.cvCompId),"dl");
var cvrLen=cvRows.length;
for(i=cvrLen;
i--;
){Util.addEvent(cvRows[i],"click",function(){CERN_CV_O1.cvRowSel(this,component.m_compObject.cvCompId);
});
if(component.hasModMethod){Util.addEvent(cvRows[i],"mouseover",function(){CERN_CV_O1.cvDisplayModifyIcon(this,component.m_compObject.cvCompId);
});
Util.addEvent(cvRows[i],"mouseout",function(){CERN_CV_O1.cvHideModifyIcon(this,component.m_compObject.cvCompId);
});
}}if(component.hasModMethod){var cvModIcons=Util.Style.g("cv-edit-img",_g("cvContent"+component.m_compObject.cvCompId),"dt");
var cvModLen=cvModIcons.length;
for(var i=cvModLen;
i--;
){Util.addEvent(cvModIcons[i],"click",function(){CERN_CV_O1.cvLaunchModifyDlg(this,component.m_compObject.cvCompId);
});
}}CERN_CV_O1.initializeIconHovers(cvRows,"cv-comment","icon4972",component.m_compObject.cvCompId);
CERN_CV_O1.initDragDrop(component.m_compObject.cvCompId);
CERN_CV_O1.initializeToggle("cvHistoricalToggle"+component.m_compObject.cvCompId,component.m_bHistoricalExpanded,component.m_compObject.cvCompId);
CERN_CV_O1.initializeToggle("cvActiveToggle"+component.m_compObject.cvCompId,component.m_bActiveExpanded,component.m_compObject.cvCompId);
}catch(err){alert(i18n.ERROR_OCCURED+": "+err.description);
if(timerRenderComponent){timerRenderComponent.Abort();
timerRenderComponent=null;
}throw (err);
}finally{if(timerRenderComponent){timerRenderComponent.Stop();
}component.setEditMode(false);
}},loadWithCBParameters:function(url,callback,sec,parameters,compID){function checkReady(){if(xhr.readyState===4){if(xhr.status===200){if(url=="mp_modify_problems"){callback(xhr.responseText,sec,compID,2);
}else{callback(xhr.responseText,sec,compID,1);
}}else{alert(i18n.discernabu.consolproblem_o1.PROBLEM_RETRIEVING_DATA.replace("{0}",sec));
}}}var component=MP_Util.GetCompObjById(compID);
var xhr=new XMLCclRequest();
xhr.onreadystatechange=checkReady;
xhr.open("GET",url,true);
if(parameters){xhr.send(parameters);
}else{parameters="^MINE^, "+component.m_compObject.criterion.person_id.toFixed(1)+","+component.m_compObject.criterion.provider_id.toFixed(1)+","+component.m_compObject.criterion.encntr_id.toFixed(1)+",^"+component.m_compObject.criterion.app_name+"^,"+component.m_compObject.criterion.position_cd.toFixed(1)+","+component.m_compObject.criterion.ppr_cd.toFixed(1);
xhr.send(parameters);
}},updateCVActions:function(compID){var component=MP_Util.GetCompObjById(compID);
if(component.m_nProcessing==1){CERN_CV_O1.updateCVMenu(component.m_compObject.cvCompId);
}},processingUI:function(oNamespace,sElementId,nIncrement,bChangeCursor,updateCallback,compID){var processingElement=_g(sElementId);
if(processingElement){if(nIncrement===0){oNamespace.m_nProcessing=0;
oNamespace.m_nWaitCursor=0;
}else{oNamespace.m_nProcessing+=nIncrement;
if(bChangeCursor){oNamespace.m_nWaitCursor+=nIncrement;
}if(oNamespace.m_nProcessing<0){oNamespace.m_nProcessing=0;
}if(oNamespace.m_nWaitCursor<0){oNamespace.m_nWaitCursor=0;
}}var bodyElement=document.getElementsByTagName("body")[0];
if(oNamespace.m_nProcessing===0){Util.Style.acss(processingElement,"hide");
}else{Util.Style.rcss(processingElement,"hide");
}if(oNamespace.m_nWaitCursor===0){Util.Style.rcss(bodyElement,"busy");
}else{Util.Style.acss(bodyElement,"busy");
}if(updateCallback){updateCallback(compID);
}}},cvDisplayModifyIcon:function(row,compID){var component=MP_Util.GetCompObjById(compID);
if(Util.Style.ccss(row,"cv-info")){var nIndex=(row.id).indexOf("IDX")+3;
var nIndex2=(row.id).indexOf("UNIQ");
var dConditionIndx=parseFloat(row.id.substring(nIndex,nIndex2));
var section=row.id.substring(0,2);
var canModify=0;
if(section=="TV"){var mostRecentDiagnosis=CERN_CV_O1.getMostRecentEncntrDiagnosis(0,dConditionIndx,component.m_compObject.cvCompId);
if(mostRecentDiagnosis&&mostRecentDiagnosis.CAN_MODIFY==1){canModify=1;
}}else{if(section=="AC"||section=="HX"){var mostRecentProblem=CERN_CV_O1.getMostRecentProblem(0,dConditionIndx,component.m_compObject.cvCompId);
if(mostRecentProblem&&mostRecentProblem.CAN_MODIFY==1&&mostRecentProblem.PROBLEM_TYPE_FLAG!=2){canModify=1;
}}}if(canModify===1){var cvModIcon=_g(row.id+"MOD");
if(cvModIcon&&Util.Style.ccss(cvModIcon,"cv-hidden")){Util.Style.rcss(cvModIcon,"cv-hidden");
}}}},cvHideModifyIcon:function(row,compID){var cvModIcon=_g(row.id+"MOD");
if(cvModIcon&&!Util.Style.ccss(cvModIcon,"cv-hidden")){Util.Style.acss(cvModIcon,"cv-hidden");
}},cvLaunchModifyDlg:function(row,compID){var component=MP_Util.GetCompObjById(compID);
var rowID=row.id;
var bFound=false;
var mostRecentProblem=null;
var mostRecentEncntrDiagnosis=null;
var retVal=false;
var iType=-1;
var dOriginatingNomenclatureId=parseFloat(rowID.substring(2));
var nIndex=rowID.indexOf("IDX")+3;
var nIndex2=(rowID).indexOf("UNIQ");
var dConditionIndx=parseFloat(rowID.substring(nIndex,nIndex2));
if(rowID.substring(0,2)=="TV"){iType=0;
mostRecentEncntrDiagnosis=CERN_CV_O1.getMostRecentEncntrDiagnosis(0,dConditionIndx,component.m_compObject.cvCompId);
if(mostRecentEncntrDiagnosis&&component.m_cvProbDxObj){try{retVal=component.m_cvProbDxObj.LoadDiagnosisAndInvokeModify(mostRecentEncntrDiagnosis.DIAGNOSIS_ID,component.m_compObject.criterion.person_id,component.m_compObject.criterion.encntr_id,true);
}catch(err){}}}else{if(rowID.substring(0,2)=="AC"||rowID.substring(0,2)=="HX"){if(rowID.substring(0,2)=="AC"){iType=2;
}else{iType=3;
}mostRecentProblem=CERN_CV_O1.getMostRecentProblem(0,dConditionIndx,component.m_compObject.cvCompId);
if(mostRecentProblem&&component.m_cvProbDxObj){try{retVal=component.m_cvProbDxObj.LoadProblemAndInvokeModify(mostRecentProblem.PROBLEM_ID,component.m_compObject.criterion.person_id,true);
}catch(err){}}}}if(retVal){component.m_nNewConditionType=iType;
component.m_dNewConditionNomenclatureId=dOriginatingNomenclatureId;
component.m_nNewConditionIndx=dConditionIndx;
var paramString=[];
var compCriterion=component.m_compObject.criterion;
paramString.push("^MINE^",compCriterion.person_id+".0",compCriterion.provider_id+".0",compCriterion.encntr_id+".0",compCriterion.ppr_cd+".0",compCriterion.position_cd+".0","^"+compCriterion.category_mean+"^",component.getDefaultSearchVocab()+".0");
MP_Core.XMLCclRequestWrapper(component,"MP_GET_CONDITIONS",paramString,true);
}var commentHoverDet=Util.Style.g("cv-comment");
CERN_CV_O1.hoverRefresh(commentHoverDet,commentHoverDet.length);
Util.cancelBubble(window.event);
},initializeIconHovers:function(pRows,detClass,iconClass,compID){var commentClass=detClass;
var l=pRows.length;
for(var i=l;
i--;
){var row=pRows[i];
if(row){var nm=Util.gns(Util.gns(Util.gns(row)));
if(nm){if(Util.Style.ccss(nm,commentClass)){var iconId=row.id+"COM";
var icon=_g(iconId);
if(icon){CERN_CV_O1.iconHS(icon,nm,compID);
}}}}}},iconHS:function(e,n,compID){var component=MP_Util.GetCompObjById(compID);
if(n&&n.tagName=="DL"){e.onmouseenter=function(evt){e.onmouseover=null;
e.onmouseout=null;
component.setEditMode(true);
var cvDets=Util.Style.g("hvr");
CERN_CV_O1.hoverRefresh(cvDets,cvDets.length);
CERN_CV_O1.iconHmo(evt,n,component);
};
e.onmouseover=function(evt){component.setEditMode(true);
var cvDets=Util.Style.g("hvr");
CERN_CV_O1.hoverRefresh(cvDets,cvDets.length);
CERN_CV_O1.iconHmo(evt,n,component);
};
e.onmousemove=function(evt){component.setEditMode(true);
CERN_CV_O1.iconHmm(evt,n);
};
e.onmouseout=function(evt){component.setEditMode(false);
var cvComment=Util.Style.g("cv-comment");
CERN_CV_O1.hoverRefresh(cvComment,cvComment.length);
CERN_CV_O1.iconHmt(evt,n);
};
e.onmouseleave=function(evt){e.onmouseover=null;
e.onmouseout=null;
component.setEditMode(false);
var cvComment=Util.Style.g("cv-comment");
CERN_CV_O1.hoverRefresh(cvComment,cvComment.length);
CERN_CV_O1.iconHmt(evt,n);
};
Util.Style.acss(n,"hover");
}},iconHmo:function(evt,n,comp){evt=evt||window.event;
var s=n.style,p=getPosition(evt),top=p.y+30,left=p.x+20;
n._ps=n.previousSibling;
n.hmo=true;
function hover(){if(n.hmo==true){if(comp){document.body.appendChild(n);
s.display="block";
s.left=left+"px";
s.top=top+"px";
n.show=true;
}}}n.timer=setTimeout(hover,500);
},iconHmm:function(evt,n){if(!n.show){return;
}var s=n.style,p=getPosition(evt),vp=gvs(),so=gso(),left=p.x+20,top=p.y+20;
if(left+n.offsetWidth>vp[1]+so[1]){left=left-40-n.offsetWidth;
if(left<0){left=0;
}}if(top+n.offsetHeight>vp[0]+so[0]){if(top-40-n.offsetHeight<so[0]){if(left>0){top=10+so[0];
}}else{top=top-40-n.offsetHeight;
}}evt=evt||window.event;
s.top=top+"px";
s.left=left+"px";
},iconHmt:function(evt,n){n.hmo=false;
if(!n._ps){n._ps=n.previousSibling;
}clearTimeout(n.timer);
evt=evt||window.event;
n.style.display="";
Util.ia(n,n._ps);
n.show=false;
},cvRowSel:function(row,compID){var component=MP_Util.GetCompObjById(compID);
row.style.background="#0000FF";
var cvDets=Util.Style.g("hvr");
var detLen=cvDets.length;
if(Util.Style.ccss(row,"condition-selected")){Util.Style.rcss(row,"condition-selected");
Util.Style.rcss(row,"row-selected");
row.style.background="";
cvDets=Util.Style.g("hvr");
detLen=cvDets.length;
for(var i=detLen;
i--;
){cvDets[i].style.display="";
}}else{Util.Style.acss(row,"condition-selected");
if(!Util.Style.ccss(row,"row-selected")){Util.Style.acss(row,"row-selected");
}}var selectLen=Util.Style.g("condition-selected",_g("cvContent"+component.m_compObject.cvCompId),"dl").length;
if(selectLen>0){if(selectLen==1&&!component.m_editMode){CERN_CV_O1.hoverRefresh(cvDets,detLen);
}}CERN_CV_O1.updateCVMenu(component.m_compObject.cvCompId);
},updateCVMenu:function(compID){var component=MP_Util.GetCompObjById(compID);
var bEnableMenuResolve=false;
var bEnableMenuInactive=false;
var bEnableMenuCancel=false;
var bEnableMenuMedical=false;
var bEnableMenuConfirmProblem=false;
var selectedSectionTV=1;
var selectedSectionActive=2;
var selectedSectionHx=4;
var selectedSection=0;
var dNomenclatureId=0;
var rowType="";
var bPregnancyFound=false;
var dConditionIndx=0;
var nIndex=0;
var bFoundFreeText=false;
if(component.m_nProcessing===0&&component.m_loadedConditions!==null){var cvSelRows=Util.Style.g("condition-selected",_g("cvContent"+component.m_compObject.cvCompId),"dl");
var cvSelLen=cvSelRows.length;
if(cvSelLen>0){bEnableMenuResolve=true;
bEnableMenuInactive=true;
bEnableMenuCancel=true;
bEnableMenuMedical=true;
bEnableMenuConfirmProblem=true;
for(var i=0;
i<cvSelLen;
i++){nIndex=(cvSelRows[i].id).indexOf("IDX")+3;
dConditionIndx=parseFloat((cvSelRows[i].id).substring(nIndex));
dNomenclatureId=parseFloat((cvSelRows[i].id).substring(2));
if(dNomenclatureId==0){bFoundFreeText=true;
}var condition=CERN_CV_O1.getCondition(0,dConditionIndx,component.m_compObject.cvCompId);
if(condition){if(condition.PROBLEMS.length===0){bEnableMenuResolve=false;
bEnableMenuInactive=false;
bEnableMenuCancel=false;
bEnableMenuMedical=false;
bEnableMenuConfirmProblem=false;
}else{if(condition.PROBLEMS[0].PROBLEM_TYPE_FLAG===2){bPregnancyFound=true;
}else{if(condition.PROBLEMS[0].LIFECYCLE_STATUS_MEAN=="RESOLVED"){bEnableMenuResolve=false;
}else{if(condition.PROBLEMS[0].LIFECYCLE_STATUS_MEAN=="INACTIVE"){bEnableMenuInactive=false;
}}}}if(condition.PROBLEMS.length>0&&condition.PROBLEMS[0].CLASSIFICATION_MEAN=="MEDICAL"){bEnableMenuMedical=false;
}if(condition.PROBLEMS.length>0&&condition.PROBLEMS[0].CONFIRMATION_STATUS_MEAN!="POSSIBLE"){bEnableMenuConfirmProblem=false;
}}rowType=(cvSelRows[i].id).substring(0,2);
if(rowType=="TV"){selectedSection|=selectedSectionTV;
}else{if(rowType=="AC"){selectedSection|=selectedSectionActive;
}else{if(rowType=="HX"){selectedSection|=selectedSectionHx;
}}}}}}if(selectedSection==selectedSectionTV&&(component.m_canAddConditionFlag===1||component.m_canAddConditionFlag===3)){Util.Style.rcss(_g("mnuCVRemoveDiagnoses"+component.m_compObject.cvCompId),"opts-menu-item-dthr");
Util.addEvent(_g("mnuCVRemoveDiagnoses"+component.m_compObject.cvCompId),"click",function(){CERN_CV_O1.removeDiagnoses(component.m_compObject.cvCompId);
});
}else{Util.Style.acss(_g("mnuCVRemoveDiagnoses"+component.m_compObject.cvCompId),"opts-menu-item-dthr");
}if(bEnableMenuResolve&&(component.m_canAddConditionFlag===2||component.m_canAddConditionFlag===3)&&bPregnancyFound===false){Util.Style.rcss(_g("mnuCVResolve"+component.m_compObject.cvCompId),"opts-menu-item-dthr");
Util.addEvent(_g("mnuCVResolve"+component.m_compObject.cvCompId),"click",function(){CERN_CV_O1.modifyProblem(component.m_compObject.cvCompId,this.id);
});
}else{Util.Style.acss(_g("mnuCVResolve"+component.m_compObject.cvCompId),"opts-menu-item-dthr");
}if(bEnableMenuInactive&&(component.m_canAddConditionFlag===2||component.m_canAddConditionFlag===3)&&bPregnancyFound===false){Util.Style.rcss(_g("mnuCVInactive"+component.m_compObject.cvCompId),"opts-menu-item-dthr");
Util.addEvent(_g("mnuCVInactive"+component.m_compObject.cvCompId),"click",function(){CERN_CV_O1.modifyProblem(component.m_compObject.cvCompId,this.id);
});
}else{Util.Style.acss(_g("mnuCVInactive"+component.m_compObject.cvCompId),"opts-menu-item-dthr");
}if(bEnableMenuCancel&&(component.m_canAddConditionFlag===2||component.m_canAddConditionFlag===3)&&bPregnancyFound===false){Util.Style.rcss(_g("mnuCVCancel"+component.m_compObject.cvCompId),"opts-menu-item-dthr");
Util.addEvent(_g("mnuCVCancel"+component.m_compObject.cvCompId),"click",function(){CERN_CV_O1.modifyProblem(component.m_compObject.cvCompId,this.id);
});
}else{Util.Style.acss(_g("mnuCVCancel"+component.m_compObject.cvCompId),"opts-menu-item-dthr");
}if(selectedSection&&!(selectedSection&selectedSectionActive)&&(component.m_canAddConditionFlag===2||component.m_canAddConditionFlag===3)&&bPregnancyFound===false&&!bFoundFreeText){Util.Style.rcss(_g("mnuCVMoveToActive"+component.m_compObject.cvCompId),"opts-menu-item-dthr");
Util.addEvent(_g("mnuCVMoveToActive"+component.m_compObject.cvCompId),"click",function(){CERN_CV_O1.moveCondition(component.m_compObject.cvCompId,this.id);
});
}else{Util.Style.acss(_g("mnuCVMoveToActive"+component.m_compObject.cvCompId),"opts-menu-item-dthr");
}if(selectedSection&&!(selectedSection&selectedSectionTV)&&(component.m_canAddConditionFlag===1||component.m_canAddConditionFlag===3)&&!bFoundFreeText){Util.Style.rcss(_g("mnuCVMoveToThisVisit"+component.m_compObject.cvCompId),"opts-menu-item-dthr");
Util.addEvent(_g("mnuCVMoveToThisVisit"+component.m_compObject.cvCompId),"click",function(){CERN_CV_O1.moveCondition(component.m_compObject.cvCompId,this.id);
});
}else{Util.Style.acss(_g("mnuCVMoveToThisVisit"+component.m_compObject.cvCompId),"opts-menu-item-dthr");
}},searchNomenclature:function(callback,textBox,component){if(textBox.value.length>1){if(component.m_compObject.iSearchTypeFlag<1){return;
}var xhr=new XMLCclRequest();
var returnData;
var searchPhrase=textBox.value;
var limit=10;
component.m_compObject.curSearchCounter=component.m_compObject.curSearchCounter+1;
CERN_CV_O1.processingUI(component,"cvProcessing"+component.m_compObject.cvCompId,1,false,CERN_CV_O1.updateCVActions,component.m_compObject.cvCompId);
xhr.onreadystatechange=function(){if(xhr.readyState==4&&xhr.status==200){var msg=xhr.responseText;
var jsonMsg="";
if(msg){jsonMsg=JSON.parse(msg);
}if(jsonMsg){component.m_compObject.replySearchCounter=jsonMsg.RECORD_DATA.SEARCHINDEX;
if(component.m_compObject.replySearchCounter===component.m_compObject.curSearchCounter&&textBox.value!==""){returnData=jsonMsg.RECORD_DATA.NOMENCLATURE;
callback.autosuggest(returnData);
}}CERN_CV_O1.processingUI(component,"cvProcessing"+component.m_compObject.cvCompId,-1,false,CERN_CV_O1.updateCVActions,component.m_compObject.cvCompId);
}};
xhr.open("GET","mp_search_nomenclatures",true);
xhr.send("^MINE^, ^"+searchPhrase+"^,"+limit+","+component.m_compObject.curSearchCounter+","+component.m_compObject.iSearchTypeFlag);
}},CreateSuggestionLine:function(suggestionObj,searchVal){return CERN_CV_O1.HighlightValue(suggestionObj.NAME,searchVal);
},HighlightValue:function(inString,term){return"<strong>"+inString.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+term.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1").split(" ").join("|")+")(?![^<>]*>)(?![^&;]+;)","gi"),"</strong>$1<strong>")+"</strong>";
},addCondition:function(nomenclature_id,textbox,component){if(nomenclature_id){var addConditionType=component.m_cvAddAsType;
var cvSearch=_g("cvcontentCtrl"+component.m_compObject.cvCompId);
cvSearch.value="";
CERN_CV_O1.addConditionWithType(nomenclature_id.VALUE+".0",addConditionType,0,component.m_compObject.cvCompId);
}},addConditionWithType:function(dOriginatingNomenclatureId,iType,dConditionIndx,compID){var component=MP_Util.GetCompObjById(compID);
CERN_CV_O1.processingUI(component,"cvProcessing"+component.m_compObject.cvCompId,1,true,CERN_CV_O1.updateCVActions,component.m_compObject.cvCompId);
var dDiagnosisNomenclatureId=0;
var dProblemNomenclatureId=0;
var nLifeStatusCodeFlag=1;
var mostRecentProblem=null;
var paramString="";
var compCriterion=component.m_compObject.criterion;
if(iType==1||iType==2||iType==3){mostRecentProblem=CERN_CV_O1.getMostRecentProblem(dOriginatingNomenclatureId,0,component.m_compObject.cvCompId);
}try{var cvObj2=window.external.DiscernObjectFactory("KIACROSSMAPPING");
switch(iType){case 0:dDiagnosisNomenclatureId=cvObj2.GetDxProbMapping(compCriterion.person_id,compCriterion.encntr_id,4,dOriginatingNomenclatureId,component.m_diagnosisTargetVocabCd,compCriterion.ppr_cd,compCriterion.position_cd,component.m_visitLabelDisplay,component.m_activeLabelDisplay,component.m_historicalLabelDisplay);
break;
case 1:dDiagnosisNomenclatureId=cvObj2.GetDxProbMapping(compCriterion.person_id,compCriterion.encntr_id,4,dOriginatingNomenclatureId,component.m_diagnosisTargetVocabCd,compCriterion.ppr_cd,compCriterion.position_cd,component.m_visitLabelDisplay,component.m_activeLabelDisplay,component.m_historicalLabelDisplay);
if(mostRecentProblem===null||mostRecentProblem.LIFECYCLE_STATUS_MEAN==="ACTIVE"){dProblemNomenclatureId=cvObj2.GetDxProbMapping(compCriterion.person_id,compCriterion.encntr_id,5,dOriginatingNomenclatureId,component.m_problemTargetVocabCd,compCriterion.ppr_cd,compCriterion.position_cd,component.m_visitLabelDisplay,component.m_activeLabelDisplay,component.m_historicalLabelDisplay);
mostRecentProblem=null;
}nLifeStatusCodeFlag=1;
break;
case 2:if(mostRecentProblem===null||mostRecentProblem.LIFECYCLE_STATUS_MEAN==="ACTIVE"){dProblemNomenclatureId=cvObj2.GetDxProbMapping(compCriterion.person_id,compCriterion.encntr_id,5,dOriginatingNomenclatureId,component.m_problemTargetVocabCd,compCriterion.ppr_cd,compCriterion.position_cd,component.m_visitLabelDisplay,component.m_activeLabelDisplay,component.m_historicalLabelDisplay);
mostRecentProblem=null;
}nLifeStatusCodeFlag=1;
break;
case 3:if(mostRecentProblem===null||mostRecentProblem.LIFECYCLE_STATUS_MEAN==="RESOLVED"){dProblemNomenclatureId=cvObj2.GetDxProbMapping(compCriterion.person_id,compCriterion.encntr_id,6,dOriginatingNomenclatureId,component.m_problemTargetVocabCd,compCriterion.ppr_cd,compCriterion.position_cd,component.m_visitLabelDisplay,component.m_activeLabelDisplay,component.m_historicalLabelDisplay);
if(component.m_bHistoricalExpanded===false){CERN_CV_O1.initializeToggle("cvHistoricalToggle"+component.m_compObject.cvCompId,true,component.m_compObject.cvCompId);
}mostRecentProblem=null;
}nLifeStatusCodeFlag=4;
break;
default:}}catch(err){}if(dDiagnosisNomenclatureId>0||dProblemNomenclatureId>0){component.m_nNewConditionType=iType;
component.m_dNewConditionNomenclatureId=dOriginatingNomenclatureId;
component.m_nNewConditionIndx=dConditionIndx;
CERN_CV_O1.processingUI(component,"cvProcessing"+component.m_compObject.cvCompId,1,true,CERN_CV_O1.updateCVActions,component.m_compObject.cvCompId);
var dDiagNomenID=parseFloat(dDiagnosisNomenclatureId);
var dProbNomenID=parseFloat(dProblemNomenclatureId);
var dOrigNomenID=parseFloat(dOriginatingNomenclatureId);
var dDxAddType=parseFloat(component.getVisitAddType());
var dDxAddClass=parseFloat(component.getVisitAddClass());
var dPlAddType=parseFloat(component.getActiveAddType());
var dPlAddClass=parseFloat(component.getActiveAddClass());
paramString="^MINE^,"+compCriterion.person_id.toFixed(1)+","+compCriterion.encntr_id.toFixed(1)+","+compCriterion.provider_id.toFixed(1)+","+compCriterion.position_cd.toFixed(1)+","+compCriterion.ppr_cd.toFixed(1)+","+iType+","+dDiagNomenID.toFixed(1)+","+dProbNomenID.toFixed(1)+","+dOrigNomenID.toFixed(1)+","+nLifeStatusCodeFlag+","+dDxAddType.toFixed(1)+","+dDxAddClass.toFixed(1)+","+dPlAddType.toFixed(1)+","+dPlAddClass.toFixed(1);
CERN_CV_O1.loadWithCBParameters("mp_add_condition",CERN_CV_O1.cvAddLoad,"cv",paramString,component.m_compObject.cvCompId);
}if(mostRecentProblem){var dProblemId=mostRecentProblem.PROBLEM_ID;
if(dProblemId>0){if(mostRecentProblem.PROBLEM_TYPE_FLAG==2){alertMsg=i18n.discernabu.consolproblem_o1.PROBLEM_TYPE_FLAG_2_MSG;
alert(alertMsg);
CERN_CV_O1.processingUI(component,"cvProcessing"+component.m_compObject.cvCompId,-1,true,CERN_CV_O1.updateCVActions,component.m_compObject.cvCompId);
return;
}component.m_nNewConditionType=iType;
component.m_dNewConditionNomenclatureId=dOriginatingNomenclatureId;
component.m_nNewConditionIndx=dConditionIndx;
CERN_CV_O1.processingUI(component,"cvProcessing"+component.m_compObject.cvCompId,1,true,CERN_CV_O1.updateCVActions,component.m_compObject.cvCompId);
component.m_nRefreshCount++;
paramString="^MINE^,"+dProblemId.toFixed(1)+","+compCriterion.provider_id.toFixed(1)+","+compCriterion.ppr_cd.toFixed(1)+","+nLifeStatusCodeFlag+","+0+","+0;
CERN_CV_O1.loadWithCBParameters("mp_modify_problem",CERN_CV_O1.cvRefresh,"cv",paramString,component.m_compObject.cvCompId);
}}CERN_CV_O1.processingUI(component,"cvProcessing"+component.m_compObject.cvCompId,-1,true,CERN_CV_O1.updateCVActions,component.m_compObject.cvCompId);
},removeDiagnoses:function(compID){var component=MP_Util.GetCompObjById(compID);
if(Util.Style.ccss(_g("mnuCVRemoveDiagnoses"+component.m_compObject.cvCompId),"opts-menu-item-dthr")){return;
}else{CERN_CV_O1.processingUI(component,"cvProcessing"+component.m_compObject.cvCompId,1,true,CERN_CV_O1.updateCVActions,component.m_compObject.cvCompId);
var cvSelRows=Util.Style.g("condition-selected",_g("cvContent"+component.m_compObject.cvCompId),"dl");
var cvSelLen=cvSelRows.length;
var nIndex=0;
for(var i=0;
i<cvSelLen;
i++){nIndex=(cvSelRows[i].id).indexOf("IDX")+3;
var sNomenID=(cvSelRows[i].id).substring(2);
sNomenID=sNomenID.replace(compID,"");
var condition=CERN_CV_O1.getCondition(0,parseFloat((cvSelRows[i].id).substring(nIndex)),component.m_compObject.cvCompId);
nIndex=(cvSelRows[i].id).indexOf("IDX")+3;
var nIndex2=(cvSelRows[i].id).indexOf("UNIQ");
var dNomenclatureId=parseFloat((cvSelRows[i].id).substring(2));
var dConditionIndx=parseFloat((cvSelRows[i].id).substring(nIndex,nIndex2));
var mostRecentProblem=CERN_CV_O1.getMostRecentProblem(0,dConditionIndx,component.m_compObject.cvCompId);
var iNumberOfDiagnoses=condition.DIAGNOSES.length;
for(var iDiagnosisIndex=0;
iDiagnosisIndex<iNumberOfDiagnoses;
iDiagnosisIndex++){var diagnosis=condition.DIAGNOSES[iDiagnosisIndex];
if(diagnosis.ENCOUNTER_ID==component.m_compObject.criterion.encntr_id){CERN_CV_O1.processingUI(component,"cvProcessing"+component.m_compObject.cvCompId,1,true,CERN_CV_O1.updateCVActions,component.m_compObject.cvCompId);
component.m_nRefreshCount++;
var diagID=parseFloat(diagnosis.DIAGNOSIS_ID);
var paramString="^MINE^,"+component.m_compObject.criterion.provider_id.toFixed(1)+","+component.m_compObject.criterion.ppr_cd.toFixed(1)+","+diagID.toFixed(1)+","+0+","+-1;
CERN_CV_O1.loadWithCBParameters("mp_modify_diagnosis",CERN_CV_O1.cvRefresh,"cv",paramString,component.m_compObject.cvCompId);
component.m_nNewConditionType=0;
component.m_dNewConditionNomenclatureId=dNomenclatureId;
component.m_nNewConditionIndx=dConditionIndx;
if(mostRecentProblem===null||mostRecentProblem.LIFECYCLE_STATUS_MEAN==="RESOLVED"||mostRecentProblem.LIFECYCLE_STATUS_MEAN==="INACTIVE"){if(component.m_bHistoricalExpanded===false){CERN_CV_O1.initializeToggle("cvHistoricalToggle"+component.m_compObject.cvCompId,true,component.m_compObject.cvCompId);
}}}}}CERN_CV_O1.processingUI(component,"cvProcessing"+component.m_compObject.cvCompId,-1,true,CERN_CV_O1.updateCVActions,component.m_compObject.cvCompId);
}},modifyProblem:function(compID,mnuItemID){var component=MP_Util.GetCompObjById(compID);
if(Util.Style.ccss(_g(mnuItemID),"opts-menu-item-dthr")){return;
}else{CERN_CV_O1.processingUI(component,"cvProcessing"+component.m_compObject.cvCompId,1,true,CERN_CV_O1.updateCVActions,component.m_compObject.cvCompId);
var cvSelRows=Util.Style.g("condition-selected",_g("cvContent"+component.m_compObject.cvCompId),"dl");
var cvSelLen=cvSelRows.length;
var dNomenclatureId=0;
var dConditionIndx=0;
var nIndex=0;
if(cvSelLen>0){var statusFlag=0;
var classification2MedInd=0;
var confirmProblemInd=0;
switch(mnuItemID){case"mnuCVCancel"+compID:statusFlag=2;
break;
case"mnuCVInactive"+compID:statusFlag=3;
break;
case"mnuCVResolve"+compID:statusFlag=4;
break;
case"mnuCVMedical"+compID:classification2MedInd=1;
break;
case"mnuCVConfirmProblem"+compID:confirmProblemInd=1;
break;
default:statusFlag=0;
}var nomenArray=[];
var nomenArrayCnt=0;
var nomenProcessed=false;
for(var i=0;
i<cvSelLen;
i++){dNomenclatureId=((cvSelRows[i].id).substring(2));
dNomenclatureId=parseFloat(dNomenclatureId.replace(compID,""));
nIndex=(cvSelRows[i].id).indexOf("IDX")+3;
dConditionIndx=parseFloat((cvSelRows[i].id).substring(nIndex));
nomenProcessed=false;
nomenArrayCnt=nomenArray.length;
for(var j=0;
j<nomenArrayCnt;
j++){if(nomenArray[j]==dConditionIndx){nomenProcessed=true;
break;
}}if(nomenProcessed){continue;
}nomenArray[nomenArrayCnt]=dConditionIndx;
var mostRecentProblem=CERN_CV_O1.getMostRecentProblem(0,dConditionIndx,component.m_compObject.cvCompId);
if(mostRecentProblem===null||mostRecentProblem.PROBLEM_ID===0){continue;
}CERN_CV_O1.processingUI(component,"cvProcessing"+component.m_compObject.cvCompId,1,true,CERN_CV_O1.updateCVActions,component.m_compObject.cvCompId);
component.m_nRefreshCount++;
var dMrpProbID=parseFloat(mostRecentProblem.PROBLEM_ID);
var paramString="^MINE^,"+dMrpProbID.toFixed(1)+","+component.m_compObject.criterion.provider_id.toFixed(1)+","+component.m_compObject.criterion.ppr_cd.toFixed(1)+","+statusFlag+","+classification2MedInd+","+confirmProblemInd;
CERN_CV_O1.loadWithCBParameters("mp_modify_problem",CERN_CV_O1.cvRefresh,"cv",paramString,component.m_compObject.cvCompId);
if(statusFlag==3||statusFlag==4){var mostRecentDiagnosis=CERN_CV_O1.getMostRecentDiagnosis(0,parseFloat(dConditionIndx),component.m_compObject.cvCompId);
if(mostRecentDiagnosis===null||mostRecentDiagnosis.ENCOUNTER_ID!==component.m_compObject.criterion.encntr_id){if(component.m_bHistoricalExpanded===false){CERN_CV_O1.initializeToggle("cvHistoricalToggle"+component.m_compObject.cvCompId,true,component.m_compObject.cvCompId);
}}}component.m_nNewConditionType=3;
component.m_dNewConditionNomenclatureId=dNomenclatureId;
component.m_nNewConditionIndx=dConditionIndx;
}}CERN_CV_O1.processingUI(component,"cvProcessing"+component.m_compObject.cvCompId,-1,true,CERN_CV_O1.updateCVActions,component.m_compObject.cvCompId);
}},getMostRecentProblem:function(dNomenclatureId,dConditionIndx,compID){var condition=CERN_CV_O1.getCondition(dNomenclatureId,dConditionIndx,compID);
if(condition){if(condition.PROBLEMS.length>0){var mostRecentProblem=condition.PROBLEMS[0];
return mostRecentProblem;
}}return null;
},getMostRecentDiagnosis:function(dNomenclatureId,dConditionIndx,compID){var condition=CERN_CV_O1.getCondition(dNomenclatureId,dConditionIndx,compID);
if(condition){if(condition.DIAGNOSES.length>0){var mostRecentDiagnosis=condition.DIAGNOSES[0];
return mostRecentDiagnosis;
}}return null;
},getMostRecentEncntrDiagnosis:function(dNomenclatureId,dConditionIndx,compID){var component=MP_Util.GetCompObjById(compID);
var condition=CERN_CV_O1.getCondition(dNomenclatureId,dConditionIndx,compID);
if(condition){var diagnosesLen=condition.DIAGNOSES.length;
if(diagnosesLen>0){var mostRecentDiagnosis=0;
for(var i=0;
i<diagnosesLen;
i++){mostRecentDiagnosis=condition.DIAGNOSES[i];
if(mostRecentDiagnosis.ENCOUNTER_ID==component.m_compObject.criterion.encntr_id){return mostRecentDiagnosis;
}}}}return null;
},moveCondition:function(compID,mnuItemID){var component=MP_Util.GetCompObjById(compID);
if(Util.Style.ccss(_g(mnuItemID),"opts-menu-item-dthr")){return;
}else{var cvSelRows=Util.Style.g("condition-selected",_g("cvContent"+component.m_compObject.cvCompId),"dl");
var cvSelLen=cvSelRows.length;
var dNomenclatureId=0;
var moveToActiveID="mnuCVMoveToActive"+compID;
var moveToThisVisitID="mnuCVMoveToThisVisit"+compID;
CERN_CV_O1.processingUI(component,"cvProcessing"+component.m_compObject.cvCompId,1,true,CERN_CV_O1.updateCVActions,component.m_compObject.cvCompId);
if(cvSelLen>0){for(var i=0;
i<cvSelLen;
i++){dNomenclatureId=((cvSelRows[i].id).substring(2));
dNomenclatureId=parseFloat(dNomenclatureId.replace(compID,""));
switch(mnuItemID){case moveToActiveID:CERN_CV_O1.addConditionWithType(dNomenclatureId,2,0,compID);
break;
case moveToThisVisitID:CERN_CV_O1.addConditionWithType(dNomenclatureId,0,0,compID);
break;
default:}}}CERN_CV_O1.processingUI(component,"cvProcessing"+component.m_compObject.cvCompId,-1,true,CERN_CV_O1.updateCVActions,component.m_compObject.cvCompId);
}},getCondition:function(dNomenclatureId,dConditionIndx,compID){var component=MP_Util.GetCompObjById(compID);
var condition=null;
if(component.m_loadedConditions){condition=CERN_CV_O1.findCondition(dNomenclatureId,dConditionIndx,component.m_loadedConditions.DATA.THIS_VISIT,compID);
if(condition===null){condition=CERN_CV_O1.findCondition(dNomenclatureId,dConditionIndx,component.m_loadedConditions.DATA.ACTIVE,compID);
}if(condition===null){condition=CERN_CV_O1.findCondition(dNomenclatureId,dConditionIndx,component.m_loadedConditions.DATA.HISTORICAL,compID);
}}return condition;
},findCondition:function(dNomenclatureId,dConditionIndx,arrConditions,compID){var iLength=arrConditions.length;
for(var iIndex=0;
iIndex<iLength;
iIndex++){if(dNomenclatureId>0){if(arrConditions[iIndex].NOMENCLATURE_ID==dNomenclatureId){return arrConditions[iIndex];
}}else{if(dConditionIndx>0){if(arrConditions[iIndex].CONDITION_INDEX==dConditionIndx){return arrConditions[iIndex];
}}}}return null;
},cvBuildConditionAddOptions:function(nAddTypeDisp,compID){var component=MP_Util.GetCompObjById(compID);
var addTypeSpan=_g("cvAddTypeSpan"+component.m_compObject.cvCompId);
if(addTypeSpan){Util.de(addTypeSpan);
}addTypeSpan=Util.ce("span");
var addTypeInnerHTMLArr=[];
var sDisplay="";
switch(nAddTypeDisp){case 0:sDisplay=component.m_visitLabelDisplay;
break;
case 1:sDisplay=component.m_visitLabelDisplay+" "+i18n.discernabu.consolproblem_o1.AND+" "+component.m_activeLabelDisplay;
break;
case 2:sDisplay=component.m_activeLabelDisplay;
break;
case 3:sDisplay=component.m_historicalLabelDisplay;
break;
default:if(component.m_canAddConditionFlag===1||component.m_canAddConditionFlag===3){sDisplay=component.m_visitLabelDisplay;
}else{sDisplay=component.m_activeLabelDisplay;
}break;
}switch(component.m_canAddConditionFlag){case 1:addTypeInnerHTMLArr.push('<span class="cvAddTypeSpan" id="cvAddTypeSpan',component.m_compObject.cvCompId,'">',sDisplay,"&nbsp;",'<div class="mnu-selectWindow cv-menu2 menu-hide" id="cvAddTypeMenu',component.m_compObject.cvCompId,'">','<div class="mnu-labelbox">',sDisplay,"</div>",'<div class="mnu-contentbox">','<div class="cv-AddTypeOpt" id="mnuCVAddTypeTV',component.m_compObject.cvCompId,'">',component.m_visitLabelDisplay,"</div></div></div></span>");
break;
case 2:addTypeInnerHTMLArr.push('<span class="cvAddTypeSpan" id="cvAddTypeSpan',component.m_compObject.cvCompId,'">',sDisplay,"&nbsp;",'<div class="mnu-selectWindow cv-menu2 menu-hide" id="cvAddTypeMenu',component.m_compObject.cvCompId,'">','<div class="mnu-labelbox">',sDisplay,"</div>",'<div class="mnu-contentbox">','<div class="cv-AddTypeOpt" id="mnuCVAddTypeAC',component.m_compObject.cvCompId,'">',component.m_activeLabelDisplay,"</div>",'<div class="cv-AddTypeOpt" id="mnuCVAddTypeHS',component.m_compObject.cvCompId,'">',component.m_historicalLabelDisplay,"</div></div></div></span>");
break;
case 3:addTypeInnerHTMLArr.push('<span class="cvAddTypeSpan" id="cvAddTypeSpan',component.m_compObject.cvCompId,'">',sDisplay,"&nbsp;",'<div class="mnu-selectWindow cv-menu2 menu-hide" id="cvAddTypeMenu',component.m_compObject.cvCompId,'">','<div class="mnu-labelbox">',sDisplay,"</div>",'<div class="mnu-contentbox">','<div class="cv-AddTypeOpt" id="mnuCVAddTypeTV',component.m_compObject.cvCompId,'">',component.m_visitLabelDisplay,"</div>",'<div class="cv-AddTypeOpt" id="mnuCVAddTypeTvAc',component.m_compObject.cvCompId,'">',component.m_visitLabelDisplay+" "+i18n.discernabu.consolproblem_o1.AND+" "+component.m_activeLabelDisplay,"</div>",'<div class="cv-AddTypeOpt" id="mnuCVAddTypeAC',component.m_compObject.cvCompId,'">',component.m_activeLabelDisplay,"</div>",'<div class="cv-AddTypeOpt" id="mnuCVAddTypeHS',component.m_compObject.cvCompId,'">',component.m_historicalLabelDisplay,"</div></div></div></span>");
break;
}addTypeSpan.innerHTML=addTypeInnerHTMLArr.join("");
var secAddTypeList=Util.Style.g("cv-AddLabel",_g(component.m_compObject.cvCompId),"span")[0];
Util.ia(addTypeSpan,secAddTypeList);
var addTypeMenu=_g("cvAddTypeMenu"+component.m_compObject.cvCompId);
Util.addEvent(_g("cvAddTypeSpan"+component.m_compObject.cvCompId),"click",function(){if(component.m_nProcessing===0){if(Util.Style.ccss(addTypeMenu,"menu-hide")){Util.Style.rcss(addTypeMenu,"menu-hide");
}else{Util.Style.acss(addTypeMenu,"menu-hide");
}var optMenuCVAddDiv=_g("cvControlsDiv"+component.m_compObject.cvCompId);
var spanElement=_g("cvAddTypeSpan"+component.m_compObject.cvCompId);
addTypeMenu.style.left=spanElement.offsetLeft+"px";
addTypeMenu.style.top=(optMenuCVAddDiv.offsetTop+(optMenuCVAddDiv.offsetHeight/2))+"px";
}});
Util.addEvent(_g("cvAddTypeSpan"+component.m_compObject.cvCompId),"mouseover",CERN_CV_O1.addBorder);
Util.addEvent(_g("cvAddTypeSpan"+component.m_compObject.cvCompId),"mouseout",CERN_CV_O1.removeBorder);
var menuRows=Util.Style.g("cv-AddTypeOpt",addTypeMenu,"div");
var mnLen=menuRows.length;
for(var i=mnLen;
i--;
){Util.addEvent(menuRows[i],"mousedown",function(){CERN_CV_O1.cvHandleAddTypeEvents(component.m_compObject.cvCompId);
});
}CERN_CV_O1.closeMenuInit(component.m_compObject.cvCompId,addTypeMenu);
},cvHandleAddTypeEvents:function(compID){var component=MP_Util.GetCompObjById(compID);
var oEvent=window.event;
var oTarget=oEvent.target||oEvent.srcElement;
if(oEvent.type=="mousedown"){var cvAddTypeSp=_g("cvAddTypeSpan"+compID);
if(oTarget.id=="mnuCVAddTypeTV"+compID){component.m_cvAddAsType=0;
}else{if(oTarget.id=="mnuCVAddTypeTvAc"+compID){component.m_cvAddAsType=1;
}else{if(oTarget.id=="mnuCVAddTypeAC"+compID){component.m_cvAddAsType=2;
}else{if(oTarget.id=="mnuCVAddTypeHS"+compID){component.m_cvAddAsType=3;
}}}}CERN_CV_O1.cvBuildConditionAddOptions(component.m_cvAddAsType,compID);
}},setSelectedIndex:function(listBox,value){for(var i=0;
i<listBox.options.length;
i++){if(listBox.options[i].value==value){listBox.options[i].selected=true;
}}},cvAddLoad:function(xhr,sec,compID,functionID){var component=MP_Util.GetCompObjById(compID);
var msgCondition=xhr;
var alertMsg="";
var jsonCondition=null;
var noProblemPriv=false;
var noDiagnosisPriv=false;
var newFunctionID=functionID;
if(msgCondition){jsonCondition=JSON.parse(msgCondition);
}if(jsonCondition){var m_nNewConditionType=jsonCondition.CONDITION_REPORT.NEWCONDITIONTYPE;
if(jsonCondition.CONDITION_REPORT.PROBLEM.length>0&&jsonCondition.CONDITION_REPORT.PROBLEM[0].RECORD_DATA.PRIVILEGE_IND===0){noProblemPriv=true;
}if(jsonCondition.CONDITION_REPORT.DIAGNOSIS.length>0&&jsonCondition.CONDITION_REPORT.DIAGNOSIS[0].RECORD_DATA.PRIVILEGE_IND===0){noDiagnosisPriv=true;
}if(noProblemPriv&&noDiagnosisPriv){alertMsg=i18n.discernabu.consolproblem_o1.NO_PRIVS_MSG;
alert(alertMsg);
}else{if(noProblemPriv){if(m_nNewConditionType===3){alertMsg=i18n.discernabu.consolproblem_o1.NO_ADD_CONDITION_MSG.replace("{0}",component.m_historicalLabelDisplay);
}else{alertMsg=i18n.discernabu.consolproblem_o1.NO_ADD_CONDITION_MSG.replace("{0}",component.m_activeLabelDisplay);
}alert(alertMsg);
}else{if(noDiagnosisPriv){alertMsg=i18n.discernabu.consolproblem_o1.NO_ADD_CONDITION_MSG.replace("{0}",component.m_visitLabelDisplay);
alert(alertMsg);
}}}var sTargetSection=null;
var bHasDiagnosisDuplicate=(jsonCondition.CONDITION_REPORT.DIAGNOSIS.length>0&&jsonCondition.CONDITION_REPORT.DIAGNOSIS[0].RECORD_DATA.DUPLICATES.length>0);
var bHasProblemDuplicate=(jsonCondition.CONDITION_REPORT.PROBLEM.length>0&&jsonCondition.CONDITION_REPORT.PROBLEM[0].RECORD_DATA.DUPLICATE_IND==1);
if(m_nNewConditionType==1&&bHasDiagnosisDuplicate&&bHasProblemDuplicate){sTargetSection=component.m_visitLabelDisplay+" "+i18n.discernabu.consolproblem_o1.AND+" "+component.m_activeLabelDisplay;
}else{if(m_nNewConditionType==3&&bHasProblemDuplicate){sTargetSection=component.m_historicalLabelDisplay;
}else{if(bHasDiagnosisDuplicate){sTargetSection=component.m_visitLabelDisplay;
}else{if(bHasProblemDuplicate){sTargetSection=component.m_activeLabelDisplay;
}}}}if(sTargetSection){var sDuplicateMessage=i18n.discernabu.consolproblem_o1.DUPLICATE_MSG.replace(/\{0\}/g,sTargetSection);
alert(sDuplicateMessage);
component.m_dNewConditionNomenclatureId=0;
component.m_nNewConditionIndx=0;
}if(jsonCondition.CONDITION_REPORT.DIAGNOSIS.length>0){newFunctionID=0;
}else{newFunctionID=2;
}component.m_bHistoricalExpanded=CERN_CV_O1.isExpanded("cvHistoricalToggle"+compID);
component.m_bActiveExpanded=CERN_CV_O1.isExpanded("cvActiveToggle"+compID);
component.m_nRefreshCount++;
CERN_CV_O1.cvRefresh(xhr,component.m_compObject.sec,compID,newFunctionID);
}},cvRefresh:function(xhr,sec,compID,functionID){var component=MP_Util.GetCompObjById(compID);
var msgCondition=xhr;
var alertMsg="";
var jsonCondition="";
var refreshAr=[];
var cRpt="";
var cRptLen=0;
component.m_nRefreshCount--;
if(component.m_cvProbDxObj){if(component.m_nNewConditionType==0&&(component.m_dNewConditionNomenclatureId>0||component.m_nNewConditionIndx>0)){try{component.m_cvProbDxObj.RefreshDiagnosisCollection(component.m_compObject.criterion.person_id,component.m_compObject.criterion.encntr_id);
}catch(err){}}else{if((component.m_nNewConditionType==2||component.m_nNewConditionType==3)&&(component.m_dNewConditionNomenclatureId>0||component.m_nNewConditionIndx>0)){try{component.m_cvProbDxObj.RefreshProblemCollection(component.m_compObject.criterion.person_id);
}catch(err){}}else{if(component.m_nNewConditionType==1&&(component.m_dNewConditionNomenclatureId>0||component.m_nNewConditionIndx>0)){try{component.m_cvProbDxObj.RefreshDiagnosisCollection(component.m_compObject.criterion.person_id,component.m_compObject.criterion.encntr_id);
component.m_cvProbDxObj.RefreshProblemCollection(component.m_compObject.criterion.person_id);
}catch(err){}}}}}if(msgCondition){jsonCondition=JSON.parse(msgCondition);
}if(functionID===0){cRpt=jsonCondition.CONDITION_REPORT.DIAGNOSIS[0].RECORD_DATA;
}else{if(functionID===1){cRpt=jsonCondition.CONDITION_DATA;
}else{if(functionID===2){cRpt=jsonCondition.CONDITION_REPORT.PROBLEM[0].RECORD_DATA;
}}}if(jsonCondition&&cRpt.PRIVILEGE_IND===0){alertMsg=i18n.discernabu.consolproblem_o1.NO_PRIVS_MSG;
alert(alertMsg);
CERN_CV_O1.processingUI(component,"cvProcessing"+component.m_compObject.cvCompId,-1,true,CERN_CV_O1.updateCVActions,component.m_compObject.cvCompId);
CERN_CV_O1.updateCVMenu(component.m_compObject.cvCompId);
return;
}else{if(component.m_nRefreshCount===0){CERN_CV_O1.processingUI(component,"cvProcessing"+component.m_compObject.cvCompId,1,true,CERN_CV_O1.updateCVActions,component.m_compObject.cvCompId);
component.m_bHistoricalExpanded=CERN_CV_O1.isExpanded("cvHistoricalToggle"+component.m_compObject.cvCompId);
component.m_bActiveExpanded=CERN_CV_O1.isExpanded("cvActiveToggle"+component.m_compObject.cvCompId);
refreshAr.push("^MINE^",component.m_compObject.criterion.person_id+".0",component.m_compObject.criterion.provider_id+".0",component.m_compObject.criterion.encntr_id+".0",component.m_compObject.criterion.ppr_cd+".0",component.m_compObject.criterion.position_cd+".0","^"+component.m_compObject.criterion.category_mean+"^",component.getDefaultSearchVocab()+".0");
MP_Core.XMLCclRequestWrapper(component,"MP_GET_CONDITIONS",refreshAr,true);
}}CERN_CV_O1.processingUI(component,"cvProcessing"+component.m_compObject.cvCompId,-1,true,CERN_CV_O1.updateCVActions,component.m_compObject.cvCompId);
},isExpanded:function(sElementId){var toggleElement=_g(sElementId);
var grandparent=Util.gp(Util.gp(toggleElement));
return !Util.Style.ccss(grandparent,"closed");
},hoverRefresh:function(o,l){for(var i=0;
i<l;
i++){var curDet=o[i];
curDet.style.display="none";
}},cvBuildClassificationMenu:function(compID,filterFlag){var component=MP_Util.GetCompObjById(compID);
var classificationSpan=_g("cvClassFilterSpan"+component.m_compObject.cvCompId);
if(classificationSpan){Util.de(classificationSpan);
}var classType="";
switch(filterFlag){case 0:classType=i18n.discernabu.consolproblem_o1.ALL;
break;
case 1:classType=i18n.discernabu.consolproblem_o1.MEDICAL_AND_PATIENT_STATED;
break;
}var classMenuSpan=Util.ce("span");
var classInnerHTMLArr=[];
classInnerHTMLArr.push('<span class="cvClassFilterSpan" id="cvClassFilterSpan',component.m_compObject.cvCompId,'">',classType,"&nbsp;",'<div class="mnu-selectWindow cv-menu2 menu-hide" id="cvClassFilterMenu',component.m_compObject.cvCompId,'">','<div class="mnu-labelbox">',classType,"</div>",'<div class="mnu-contentbox">','<div class="cv-ClassOpt" id="mnuCVClassificationAll',component.m_compObject.cvCompId,'">',i18n.discernabu.consolproblem_o1.ALL,"</div>",'<div class="cv-ClassOpt" id="mnuCVClassificationPSMed',component.m_compObject.cvCompId,'">',i18n.discernabu.consolproblem_o1.MEDICAL_AND_PATIENT_STATED,"</div></div></div></span>");
classMenuSpan.innerHTML=classInnerHTMLArr.join("");
var secClassificationTgl=Util.Style.g("cv-ClassFilterLabel",component.m_compObject.cvCompSec,"span")[0];
Util.ia(classMenuSpan,secClassificationTgl);
var classFilterMenu=_g("cvClassFilterMenu"+component.m_compObject.cvCompId);
Util.addEvent(_g("cvClassFilterSpan"+component.m_compObject.cvCompId),"click",function(){if(component.m_nProcessing===0){if(Util.Style.ccss(classFilterMenu,"menu-hide")){Util.Style.rcss(classFilterMenu,"menu-hide");
}else{Util.Style.acss(classFilterMenu,"menu-hide");
}var optMenuCVClassDiv=_g("cvClassificationDiv"+component.m_compObject.cvCompId);
var spanElement=_g("cvClassFilterSpan"+component.m_compObject.cvCompId);
classFilterMenu.style.left=spanElement.offsetLeft+"px";
classFilterMenu.style.top=optMenuCVClassDiv.offsetTop+"px";
}});
var classFilterSpan=_g("cvClassFilterSpan"+component.m_compObject.cvCompId);
Util.addEvent(classFilterSpan,"mouseover",CERN_CV_O1.addBorder);
Util.addEvent(classFilterSpan,"mouseout",CERN_CV_O1.removeBorder);
var menuRows=Util.Style.g("cv-ClassOpt",classFilterMenu,"div");
var mnLen=menuRows.length;
for(var i=mnLen;
i--;
){Util.addEvent(menuRows[i],"mousedown",function(){CERN_CV_O1.cvHandleClassificationEvents(component.m_compObject.cvCompId);
});
}CERN_CV_O1.closeMenuInit(component.m_compObject.cvCompId,classFilterMenu);
},cvHandleClassificationEvents:function(compID){function checkReady(){var checkReadyAr=[];
if(xhr.readyState===4){if(xhr.status===200){checkReadyAr.push("^MINE^",component.m_compObject.criterion.person_id+".0",component.m_compObject.criterion.provider_id+".0",component.m_compObject.criterion.encntr_id+".0",component.m_compObject.criterion.ppr_cd+".0",component.m_compObject.criterion.position_cd+".0","^"+component.m_compObject.criterion.category_mean+"^",component.getDefaultSearchVocab()+".0");
MP_Core.XMLCclRequestWrapper(component,"MP_GET_CONDITIONS",checkReadyAr,true);
}else{alert(i18n.discernabu.consolproblem_o1.FILTER_MSG);
}}}var component=MP_Util.GetCompObjById(compID);
var oEvent=window.event;
var oTarget=oEvent.target||oEvent.srcElement;
var paramString="";
if(oEvent.type=="mousedown"){var selValue="0";
if(oTarget.id=="mnuCVClassificationAll"+compID){selValue="0";
}else{if(oTarget.id=="mnuCVClassificationPSMed"+compID){selValue="1";
}}CERN_CV_O1.processingUI(component,"cvProcessing"+component.m_compObject.cvCompId,1,true,CERN_CV_O1.updateCVActions,component.m_compObject.cvCompId);
switch(selValue){case"0":paramString="^MINE^, "+component.m_compObject.criterion.provider_id+",^NPM_CLASS_VIEW_FILTER^,^0^";
break;
case"1":paramString="^MINE^, "+component.m_compObject.criterion.provider_id+",^NPM_CLASS_VIEW_FILTER^,^1^";
break;
}var xhr=new XMLCclRequest();
xhr.onreadystatechange=checkReady;
xhr.open("GET","mp_maintain_user_prefs",true);
xhr.send(paramString);
}},renderConditionDetails:function(oCondition){var detListLength=0;
var detLeftOverCnt=0;
var sConditionDetailArr=[];
var j=0;
sConditionDetailArr.push('<h4 class="cv-det-hd"><span>',i18n.discernabu.consolproblem_o1.DIAGNOSIS_DETAILS,'</span></h4><div class="hvr">','<dl class="cv-det">','<dt class="cv-det-name"><span>',i18n.discernabu.consolproblem_o1.CONDITION,":</span></dt>",'<dd class="cv-det-name">',oCondition.DISPLAY);
if(oCondition.NOMENCLATURE_ID==0){sConditionDetailArr.push("<span> (free text)</span>");
}sConditionDetailArr.push("</dd>");
detListLength=oCondition.PROBLEMS.length;
for(j=0;
j<detListLength;
j++){sConditionDetailArr.push('<dt class="cv-det-name"><span>',i18n.discernabu.consolproblem_o1.PROBLEM_STATUS,":</span></dt>",'<dd class="cv-det-name">',oCondition.PROBLEMS[j].LIFECYCLE_STATUS_DISP,"</dd>");
if(oCondition.PROBLEMS[j].CLASSIFICATION_DISPLAY!==""){sConditionDetailArr.push('<dd class="cv-det-name"><span>',i18n.discernabu.consolproblem_o1.CLASSIFICATION,":</span></dd>",'<dd class="cv-det-name">',oCondition.PROBLEMS[j].CLASSIFICATION_DISPLAY,"</dd>");
}}sConditionDetailArr.push('<dt class="cv-det-name"><span>',i18n.discernabu.consolproblem_o1.RECENT_VISITS,":</span></dt>",'<dd class="cv-det-name"></dd>');
detListLength=oCondition.DIAGNOSES.length;
if(detListLength===0){sConditionDetailArr.push('<dt class="cv-det-name"></dt>','<dd class="cv-det-name">--</dd>');
}else{if(detListLength>5){detLeftOverCnt=detListLength-5;
detListLength=5;
}for(j=0;
j<detListLength;
j++){sConditionDetailArr.push('<dt class="cv-det-name"></dt>','<dd class="cv-det-name"><span class="cv-dx-text">',oCondition.DIAGNOSES[j].DIAGNOSIS_DT_TM,"</span></dd>");
if(oCondition.DIAGNOSES[j].CLASSIFICATION_DISPLAY!==""){sConditionDetailArr.push('<dd class="cv-det-name"><span>',i18n.discernabu.consolproblem_o1.CLASSIFICATION,":</span></dd>",'<dd class="cv-det-name">',oCondition.DIAGNOSES[j].CLASSIFICATION_DISPLAY,"</dd>");
}}if(detLeftOverCnt>0){sConditionDetailArr.push("</br>",'<dt class="cv-det-name"></dt>','<dd class="cv-det-name"><span class="cv-dx-text">',detLeftOverCnt," more</span></dd>");
}detLeftOverCnt=0;
}sConditionDetailArr.push("</dl></div>");
var commentCnt=oCondition.COMMENTS.length;
var indx=(commentCnt>3)?3:commentCnt;
var commentLength=0;
var charLimit=600;
var breakComment=false;
if(indx>0){sConditionDetailArr.push('<dl class="cv-comment hover"><dt class="cv-det-name"><span>Comment:</span></dt>');
for(var j=0;
j<indx;
j++){var oComments=oCondition.COMMENTS[j];
var sComment=oComments.TEXT.replace(/\r\n|\r|\n/g,"<br />");
if((commentLength+sComment.length)>charLimit){sComment=sComment.substring(0,(charLimit-commentLength));
breakComment=true;
}if(oComments.COMMENT_DT_TM.substring(0,7)==sComment.substring(0,7)||oComments.COMMENT_DT_TM.substring(1,8)==sComment.substring(0,7)){sConditionDetailArr.push('<dt class="cv-det-name"></dt><dd class="cv-det-name">',sComment,"</dd>");
}else{sConditionDetailArr.push('<dt class="cv-det-name"></dt><dd class="cv-det-name">',oComments.COMMENT_DT_TM," - ",oComments.AUTHOR_NAME,": ",sComment,"</dd>");
}commentLength=commentLength+sComment.length;
if(breakComment){break;
}}if(breakComment||commentCnt>3){sConditionDetailArr.push('<dt class="cv-det-name"></dt><dd class="cv-det-name">more...</dd>');
}sConditionDetailArr.push("</dl>");
}return sConditionDetailArr.join("");
},expCol:function(compID,togElement){var gpp=Util.gp(togElement);
if(Util.Style.ccss(gpp,"closed")){Util.Style.rcss(gpp,"closed");
togElement.innerHTML="-";
togElement.title=i18n.HIDE_SECTION;
}else{Util.Style.acss(gpp,"closed");
togElement.innerHTML="+";
togElement.title=i18n.SHOW_SECTION;
var optMenuCV=_g("moreOptMenuCV"+compID);
if(optMenuCV){Util.Style.acss(optMenuCV,"menu-hide");
}}},expColSecHdr:function(compID,togElement){var rowType="";
var gpp=Util.gp(togElement);
if(Util.Style.ccss(gpp,"closed")){var cvSelRows=Util.Style.g("condition-selected",_g("cvContent"+compID),"dl");
var cvSelLen=cvSelRows.length;
if(cvSelLen>0){for(var i=0;
i<cvSelLen;
i++){rowType=(cvSelRows[i].id).substring(0,2);
if((togElement.id=="cvActiveToggle"+compID)&&(rowType=="AC")){Util.Style.rcss(cvSelRows[i],"condition-selected");
Util.Style.rcss(cvSelRows[i],"row-selected");
}else{if((togElement.id=="cvHistoricalToggle"+compID)&&(rowType=="HX")){Util.Style.rcss(cvSelRows[i],"condition-selected");
Util.Style.rcss(cvSelRows[i],"row-selected");
}}}}}},initializeToggle:function(sElementId,bExpanded,compID){var toggleElement=_g(sElementId);
Util.addEvent(toggleElement,"click",function(){CERN_CV_O1.expCol(compID,toggleElement);
});
Util.addEvent(toggleElement,"click",function(){CERN_CV_O1.expColSecHdr(compID,toggleElement);
});
var grandparent=Util.gp(Util.gp(toggleElement));
if(!bExpanded){Util.Style.acss(grandparent,"closed");
toggleElement.innerHTML="+";
toggleElement.title=i18n.SHOW_SECTION;
}else{if(Util.Style.ccss(grandparent,"closed")){Util.Style.rcss(grandparent,"closed");
this.innerHTML="-";
this.title=i18n.HIDE_SECTION;
}}},closeMenuInit:function(compID,inMenu){var menuId="cv"+compID;
if(!e){var e=window.event;
}if(window.attachEvent){Util.addEvent(inMenu,"mouseleave",function(){Util.Style.acss(inMenu,"menu-hide");
_g(menuId).style.zIndex=1;
});
}else{Util.addEvent(inMenu,"mouseout",menuLeave);
}function menuLeave(e){if(!e){var e=window.event;
}var relTarg=e.relatedTarget||e.toElement;
if(e.relatedTarget.id==inMenu.id){Util.Style.acss(inMenu,"menu-hide");
_g(menuId).style.zIndex=1;
}e.stopPropagation();
Util.cancelBubble(e);
}},addBorder:function(){if(!Util.Style.ccss(this,"mnu-border")){Util.Style.acss(this,"mnu-border ");
}},removeBorder:function(){if(Util.Style.ccss(this,"mnu-border")){Util.Style.rcss(this,"mnu-border");
}},initDragDrop:function(compID){var component=MP_Util.GetCompObjById(compID);
dndArray=Util.Style.g("tv-info",_g("cvContent"+component.m_compObject.cvCompId),"span");
dndLen=dndArray.length;
for(var x=0,a=dndLen;
x<a;
x++){new CERN_CV_O1.dragObject(dndArray[x],null,null,null,CERN_CV_O1.onCVStartDrag,CERN_CV_O1.onm_cvDragging,CERN_CV_O1.onCVEndDrag,false,component.m_compObject.cvCompId);
}dndArray=Util.Style.g("ac-info",_g("cvContent"+component.m_compObject.cvCompId),"span");
dndLen=dndArray.length;
for(var x=0,a=dndLen;
x<a;
x++){new CERN_CV_O1.dragObject(dndArray[x],null,null,null,CERN_CV_O1.onCVStartDrag,CERN_CV_O1.onm_cvDragging,CERN_CV_O1.onCVEndDrag,false,component.m_compObject.cvCompId);
}dndArray=Util.Style.g("hs-info",_g("cvContent"+component.m_compObject.cvCompId),"span");
dndLen=dndArray.length;
for(var x=0,a=dndLen;
x<a;
x++){new CERN_CV_O1.dragObject(dndArray[x],null,null,null,CERN_CV_O1.onCVStartDrag,CERN_CV_O1.onm_cvDragging,CERN_CV_O1.onCVEndDrag,false,component.m_compObject.cvCompId);
}},m_cvDropLocationTV:function(compID){var component=MP_Util.GetCompObjById(compID);
var TV=_g("cvTV"+compID);
component.m_cvDropLocation="cvTV"+compID;
},m_cvDropLocationAC:function(compID){var component=MP_Util.GetCompObjById(compID);
var AC=_g("cvAC"+compID);
component.m_cvDropLocation="cvAC"+compID;
},m_cvResetDropLocation:function(compID){var component=MP_Util.GetCompObjById(compID);
component.m_cvDropLocation="";
},onCVStartDrag:function(eventObj,element,compID){var component=MP_Util.GetCompObjById(compID);
if(component.m_nProcessing===0){var x=element.parentNode;
var elTopPos=15;
component.m_sPlaceHolder=Util.ce("DIV");
component.m_cvSourceSection=element.className;
while(x.nodeName!="DL"&&x.nodeName!="BODY"){x=x.parentNode;
}component.m_cvDragNomenId=parseFloat((x.id).substring(2));
var cvCursorOffsetPos=getPosition(eventObj);
var cvDivOffsetPos=Util.goff(_g(component.m_compObject.cvModRootId));
var cvDragOffsetTop=cvCursorOffsetPos.y-cvDivOffsetPos[1];
element.style.top=cvDragOffsetTop+"px";
element.style.left="0px";
while(x.nodeName!="DIV"&&x.nodeName!="BODY"){x=x.parentNode;
}component.m_cvDragParentDiv=x.id;
if("cvTV"+compID==x.id){component.m_sList=_g("cv-TVList"+compID);
}else{if("cvAC"+compID==x.id){component.m_sList=_g("cv-ACList"+compID);
}else{if("cvHX"+compID==x.id){component.m_sList=_g("cv-HXList"+compID);
}}}}},onm_cvDragging:function(newPos,element,eventObj,compID){var component=MP_Util.GetCompObjById(compID);
if(component.m_cvDragging==false&&component.m_nProcessing==0&&component.m_sPlaceHolder!=null){if(component.m_cvDragNomenId>0){if(component.m_cvDragParentDiv=="cvHX"+compID){Util.Style.acss(_g("cvTV"+compID),"drop-sections");
Util.Style.acss(_g("cvAC"+compID),"drop-sections");
}else{if(component.m_cvDragParentDiv=="cvTV"+compID){Util.Style.acss(_g("cvAC"+compID),"drop-sections");
}else{if(component.m_cvDragParentDiv=="cvAC"+compID){Util.Style.acss(_g("cvTV"+compID),"drop-sections");
}}}component.m_sPlaceHolder.id="dragPlaceHolder";
component.m_sPlaceHolder.className="cv-info";
var x=element.parentNode;
while(x.nodeName!="DL"&&x.nodeName!="BODY"){x=x.parentNode;
}element.className="drag";
component.m_sList.insertBefore(component.m_sPlaceHolder,x);
component.setEditMode(true);
var cvDets=Util.Style.g("hvr");
var detLen=cvDets.length;
CERN_CV_O1.hoverRefresh(cvDets,detLen);
component.m_sPlaceHolder.innerHTML=element.innerHTML;
component.m_cvDragging=true;
}else{element.style.top="0px";
element.style.left="0px";
component.m_cvSourceSection="";
component.m_cvDragging=false;
component.m_cvDropLocation=="";
component.m_sPlaceHolder=null;
var alertMsg=i18n.discernabu.consolproblem_o1.NO_ACTION_FREETEXT;
alert(alertMsg);
}}},onCVEndDrag:function(element,compID){var component=MP_Util.GetCompObjById(compID);
var sNomenclatureId="";
var dNomenclatureId=0;
if(component.m_nProcessing==0&&component.m_sPlaceHolder!=null){if(component.m_sPlaceHolder.className!=""){component.m_sList.removeChild(component.m_sPlaceHolder);
component.m_sPlaceHolder.className="";
}element.className=component.m_cvSourceSection;
element.style.top="0px";
element.style.left="0px";
component.m_cvSourceSection="";
var selectLen=Util.Style.g("condition-selected",_g("cvContent"+component.m_compObject.cvCompId),"dl").length;
if(selectLen<=0){component.setEditMode(true);
cvDets=Util.Style.g("hvr");
detLen=cvDets.length;
for(var i=detLen;
i--;
){cvDets[i].style.display="";
}}if(component.m_cvDragging){Util.Style.rcss(_g("cvTV"+compID),"drop-sections");
Util.Style.rcss(_g("cvAC"+compID),"drop-sections");
if(component.m_cvDragParentDiv!="cvTV"+compID&&component.m_cvDropLocation==="cvTV"+compID){if(parseFloat(component.m_compObject.criterion.encntr_id)===0){alert(i18n.discernabu.consolproblem_o1.ENCNTR_MSG);
return;
}if(component.m_canAddConditionFlag===1||component.m_canAddConditionFlag===3){sNomenclatureId=String(component.m_cvDragNomenId);
dNomenclatureId=parseFloat(sNomenclatureId.replace(compID,""));
CERN_CV_O1.addConditionWithType(dNomenclatureId,0,0,compID);
}else{alertMsg=i18n.discernabu.consolproblem_o1.NO_ADD_CONDITION_MSG.replace("{0}",component.m_visitLabelDisplay);
alert(alertMsg);
}}else{if(component.m_cvDragParentDiv!="cvAC"+compID&&component.m_cvDropLocation==="cvAC"+compID){if(component.m_canAddConditionFlag===2||component.m_canAddConditionFlag===3){sNomenclatureId=String(component.m_cvDragNomenId);
dNomenclatureId=parseFloat(sNomenclatureId.replace(compID,""));
CERN_CV_O1.addConditionWithType(dNomenclatureId,2,0,compID);
}else{alertMsg=i18n.discernabu.consolproblem_o1.NO_ADD_CONDITION_MSG.replace("{0}",component.m_activeLabelDisplay);
alert(alertMsg);
}}}}component.m_cvDragging=false;
component.m_cvDropLocation="";
component.m_sPlaceHolder=null;
if(selectLen<=0){component.setEditMode(false);
}}},cancelEvent:function(e){e=e?e:window.event;
if(e.stopPropagation){e.stopPropagation();
}if(e.preventDefault){e.preventDefault();
}e.cancelBubble=true;
e.cancel=true;
e.returnValue=false;
return false;
},Position:function(x,y){this.X=x;
this.Y=y;
this.Add=function(val){var newPos=new CERN_CV_O1.Position(this.X,this.Y);
if(val){if(!isNaN(val.X)){newPos.X+=val.X;
}if(!isNaN(val.Y)){newPos.Y+=val.Y;
}}return newPos;
};
this.Subtract=function(val){var newPos=new CERN_CV_O1.Position(this.X,this.Y);
if(val){if(!isNaN(val.X)){newPos.X-=val.X;
}if(!isNaN(val.Y)){newPos.Y-=val.Y;
}}return newPos;
};
this.Min=function(val){var newPos=new CERN_CV_O1.Position(this.X,this.Y);
if(val==null){return newPos;
}if(!isNaN(val.X)&&this.X>val.X){newPos.X=val.X;
}if(!isNaN(val.Y)&&this.Y>val.Y){newPos.Y=val.Y;
}return newPos;
};
this.Max=function(val){var newPos=new CERN_CV_O1.Position(this.X,this.Y);
if(val==null){return newPos;
}if(!isNaN(val.X)&&this.X<val.X){newPos.X=val.X;
}if(!isNaN(val.Y)&&this.Y<val.Y){newPos.Y=val.Y;
}return newPos;
};
this.Bound=function(lower,upper){var newPos=this.Max(lower);
return newPos.Min(upper);
};
this.Check=function(){var newPos=new CERN_CV_O1.Position(this.X,this.Y);
if(isNaN(newPos.X)){newPos.X=0;
}if(isNaN(newPos.Y)){newPos.Y=0;
}return newPos;
};
this.Apply=function(element){if(typeof element=="string"){return;
}if(!isNaN(this.X)){element.style.left=this.X+"px";
}if(!isNaN(this.Y)){element.style.top=this.Y+"px";
}};
},absoluteCursorPostion:function(eventObj){eventObj=eventObj?eventObj:window.event;
if(isNaN(window.scrollX)){return new CERN_CV_O1.Position(eventObj.clientX+document.documentElement.scrollLeft+document.body.scrollLeft,eventObj.clientY+document.documentElement.scrollTop+document.body.scrollTop);
}else{return new CERN_CV_O1.Position(eventObj.clientX+window.scrollX,eventObj.clientY+window.scrollY);
}},dragObject:function(element,attachElement,lowerBound,upperBound,startCallback,moveCallback,endCallback,attachLater,compID){if(typeof element=="string"){element=_g(element);
}if(element==null){return;
}if(lowerBound!=null&&upperBound!=null){var temp=lowerBound.Min(upperBound);
upperBound=lowerBound.Max(upperBound);
lowerBound=temp;
}var cursorStartPos=null;
var elementStartPos=null;
var dragging=false;
var listening=false;
var disposed=false;
var componentID=compID;
function dragStart(eventObj,componentID){eventObj=eventObj?eventObj:window.event;
if(dragging||!listening||disposed){return;
}dragging=true;
if(startCallback!=null){startCallback(eventObj,element,componentID);
}cursorStartPos=CERN_CV_O1.absoluteCursorPostion(eventObj);
elementStartPos=new CERN_CV_O1.Position(parseInt(element.style.left),parseInt(element.style.top));
elementStartPos=elementStartPos.Check();
Util.addEvent(document,"mousemove",function(){dragGo(null,componentID);
});
Util.addEvent(document,"mouseup",function(){dragStopHook(null,componentID);
});
return CERN_CV_O1.cancelEvent(eventObj);
}function dragGo(eventObj,componentID){eventObj=eventObj?eventObj:window.event;
if(!dragging||disposed){return;
}var newPos=CERN_CV_O1.absoluteCursorPostion(eventObj);
newPos=newPos.Add(elementStartPos).Subtract(cursorStartPos);
newPos=newPos.Bound(lowerBound,upperBound);
newPos.Apply(element);
if(moveCallback){moveCallback(newPos,element,eventObj,componentID);
}return CERN_CV_O1.cancelEvent(eventObj);
}function dragStopHook(eventObj,componentID){eventObj=eventObj?eventObj:window.event;
dragStop(componentID);
return CERN_CV_O1.cancelEvent(eventObj);
}function dragStop(componentID){if(!dragging||disposed){return;
}Util.removeEvent(document,"mousemove",function(){dragGo(componentID);
});
Util.removeEvent(document,"mouseup",function(){dragStopHook(null,componentID);
});
cursorStartPos=null;
elementStartPos=null;
if(endCallback!=null){endCallback(element,componentID);
}dragging=false;
}this.Dispose=function(componentID){if(disposed){return;
}this.StopListening(true,componentID);
element=null;
attachElement=null;
lowerBound=null;
upperBound=null;
startCallback=null;
moveCallback=null;
endCallback=null;
disposed=true;
};
this.StartListening=function(componentID){if(listening||disposed){return;
}listening=true;
Util.addEvent(attachElement,"mousedown",function(){dragStart(null,componentID);
});
};
this.StopListening=function(stopCurrentDragging,componentID){if(!listening||disposed){return;
}Util.removeEvent(attachElement,"mousedown",function(){dragStart(null,componentID);
});
listening=false;
if(stopCurrentDragging&&dragging){dragStop(componentID);
}};
this.IsDragging=function(){return dragging;
};
this.IsListening=function(){return listening;
};
this.IsDisposed=function(){return disposed;
};
if(typeof attachElement=="string"){attachElement=_g(attachElement);
}if(attachElement==null){attachElement=element;
}if(!attachLater){this.StartListening(componentID);
}}};
}();
function CustomComponentStyle(){this.initByNamespace("cust");
}CustomComponentStyle.inherits(ComponentStyle);
function CustomComponent(criterion){var m_prgName="";
this.setCriterion(criterion);
this.setStyles(new CustomComponentStyle());
this.setComponentLoadTimerName("USR:MPG.CUSTOM_COMP.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.CUSTOM_COMP.O1 - render component");
CustomComponent.method("setPRGName",function(value){this.m_prgName=value;
});
CustomComponent.method("getPRGName",function(){return(this.m_prgName);
});
CustomComponent.method("InsertData",function(){CERN_CUSTOM_COMP_O1.GetCustomCompTable(this);
});
CustomComponent.method("HandleSuccess",function(recordData){CERN_CUSTOM_COMP_O1.RenderComponent(this,recordData);
});
CustomComponent.method("openTab",function(){var criterion=this.getCriterion();
var sParms="/PERSONID="+criterion.person_id+" /ENCNTRID="+criterion.encntr_id+" /FIRSTTAB=^"+this.getLink()+"+^";
APPLINK(0,criterion.executable,sParms);
this.InsertData();
});
}CustomComponent.inherits(MPageComponent);
var CERN_CUSTOM_COMP_O1=function(){return{GetCustomCompTable:function(component){var sendAr=[];
var criterion=component.getCriterion();
sendAr.push("^MINE^",criterion.person_id+".0",criterion.provider_id+".0",criterion.encntr_id+".0",criterion.ppr_cd+".0",criterion.position_cd+".0");
var timerLoadComponent=MP_Util.CreateTimer(component.getComponentLoadTimerName(),component.getCriterion().category_mean);
var info=new XMLCclRequest();
info.onreadystatechange=function(){if(this.readyState==4&&this.status==200){try{var recordData=this.responseText;
var timerRenderComponent=MP_Util.CreateTimer(component.getComponentRenderTimerName(),component.getCriterion().category_mean);
try{var rootComponentNode=component.getRootComponentNode();
var secTitle=Util.Style.g("sec-total",rootComponentNode,"span");
secTitle[0].innerHTML=i18n.RENDERING_DATA+"...";
component.HandleSuccess(recordData);
}catch(err){if(timerRenderComponent){timerRenderComponent.Abort();
timerRenderComponent=null;
}throw (err);
}finally{if(timerRenderComponent){timerRenderComponent.Stop();
}}}catch(err){if(timerLoadComponent){timerLoadComponent.Abort();
timerLoadComponent=null;
}}finally{if(timerLoadComponent){timerLoadComponent.Stop();
}}}else{if(this.readyState==4&&this.status!=200){var errMsg=[];
errMsg.push("<b>",i18n.DISCERN_ERROR,"</b><br><ul><li>",i18n.STATUS,": ",this.status,"</li><li>",i18n.REQUEST,": ",this.requestText,"</li></ul>");
MP_Util.Doc.FinalizeComponent(MP_Util.HandleErrorResponse(component.getStyles().getNameSpace(),errMsg.join("")),component,"");
if(timerLoadComponent){timerLoadComponent.Abort();
}}}if(this.readyState==4){MP_Util.ReleaseRequestReference(this);
}};
info.open("GET",component.getPRGName(),true);
info.send(sendAr.join(","));
},RenderComponent:function(component,recordData){var timerRenderComponent=MP_Util.CreateTimer(component.getComponentRenderTimerName());
try{var cpHTML="";
var cpLen=0;
var countText="";
cpHTML=recordData;
countText=MP_Util.CreateTitleText(component,cpLen);
MP_Util.Doc.FinalizeComponent(cpHTML,component,countText);
}catch(err){if(timerRenderComponent){timerRenderComponent.Abort();
timerRenderComponent=null;
}throw (err);
}finally{if(timerRenderComponent){timerRenderComponent.Stop();
}}}};
}();
var CERN_DEMO_BANNER_O1=function(){return{GetPatientDemographics:function(demoBanner,criterion){timerPatDemLoad=MP_Util.CreateTimer("USR:MPG.DEMO_BANNER.O1 - load component");
if(timerPatDemLoad){timerPatDemLoad.Start();
}var info=new XMLCclRequest();
info.onreadystatechange=function(){if(this.readyState==4&&this.status==200){var timer=MP_Util.CreateTimer("ENG:MPG.DEMO_BANNER.O1  render component");
try{var jsHTML=[];
var sHTML="",birthDate="",visitReason="",mrnNbr,finNbr="",age="",isolation="";
var jsonText=JSON.parse(this.responseText);
var codeArray=MP_Util.LoadCodeListJSON(jsonText.RECORD_DATA.CODES);
var patInfo=jsonText.RECORD_DATA.DEMOGRAPHICS.PATIENT_INFO;
var nameFull=patInfo.PATIENT_NAME.NAME_FULL;
var enCodeArray=[];
var ptCodeArray=[];
var formattedAliasArray=[];
var dateTime=new Date();
if(patInfo.BIRTH_DT_TM!==""){dateTime.setISO8601(patInfo.BIRTH_DT_TM);
birthDate=dateTime.format("shortDate2");
age=MP_Util.CalcAge(dateTime);
}var oSex=MP_Util.GetValueFromArray(patInfo.SEX_CD,codeArray);
var encntrInfo=jsonText.RECORD_DATA.DEMOGRAPHICS.ENCOUNTER_INFO;
for(var j=0,e=encntrInfo.length;
j<e;
j++){visitReason=encntrInfo[j].REASON_VISIT;
for(var i=0,l=encntrInfo[j].ALIAS.length;
i<l;
i++){enCodeArray[i]=MP_Util.GetValueFromArray(encntrInfo[j].ALIAS[i].ALIAS_TYPE_CD,codeArray);
if(enCodeArray[i].meaning=="FIN NBR"){finNbr=encntrInfo[j].ALIAS[i].FORMATTED_ALIAS;
}if(enCodeArray[i].meaning=="MRN"){mrnNbr=encntrInfo[j].ALIAS[i].FORMATTED_ALIAS;
}}if(encntrInfo[j].ISOLATION_CD>0){var isoObj=MP_Util.GetValueFromArray(encntrInfo[j].ISOLATION_CD,codeArray);
isolation=isoObj.display;
}}aliasArry=jsonText.RECORD_DATA.DEMOGRAPHICS.PATIENT_INFO.ALIAS;
if(mrnNbr==""){for(var i=0,l=aliasArry.length;
i<l;
i++){ptCodeArray[i]=MP_Util.GetValueFromArray(aliasArry[i].ALIAS_TYPE_CD,codeArray);
if(ptCodeArray[i].meaning=="MRN"){mrnNbr=aliasArry[i].FORMATTED_ALIAS;
}}}var sexAbb=(oSex&&oSex!==null)?oSex.display:i18n.UNKNOWN;
jsHTML.push("<dl class='dmg-info'><dt class='dmg-pt-name-lbl'><span>",i18n.NAME,"</span></dt><dd class='dmg-pt-name'><span>",nameFull,"</span></dd><dt class='dmg-sex-age-lbl'><span>",i18n.SEX," ",i18n.AGE,"</span></dt><dd class='dmg-sex-age'><span>",sexAbb," ",age,"</span></dd><dt><span>",i18n.DOB,":</span></dt><dd class='dmg-dob'><span>",birthDate,"</span></dd><dt><span>",i18n.MRN,":</span></dt><dd class='dmg-mrn'><span>",mrnNbr,"</span></dd><dt><span>",i18n.FIN,":</span></dt><dd class='dmg-fin'><span>",finNbr,"</span></dd><dt><span>",i18n.ISOLATION,":</span></dt><dd class='dmg-isolation'><span>",isolation,"</span></dd><dt><span>",i18n.VISIT_REASON,":</span></dt><dd class='dmg-rfv'><span>",visitReason,"</span></dd></dl>");
demoBanner.innerHTML=jsHTML.join("");
}finally{if(timer){timer.Stop();
}if(timerPatDemLoad){timerPatDemLoad.Stop();
}}}if(this.readyState==4){MP_Util.ReleaseRequestReference(this);
}};
info.open("GET","MP_GET_PATIENT_DEMO",0);
var sendAr=[];
sendAr.push("^MINE^",criterion.person_id+".0",criterion.encntr_id+".0");
info.send(sendAr.join(","));
}};
}();
function DiagnosesComponentStyle(){this.initByNamespace("dx");
}DiagnosesComponentStyle.inherits(ComponentStyle);
function DiagnosesComponent(criterion){this.m_searchTypeFlag=null;
this.m_suggestionLimit=null;
this.m_diagnosisVocab=null;
this.m_diagnosisAddTypeCd=null;
this.m_diagnosisClass=null;
this.m_diagnosisVocabInd=0;
this.curSearchCounter=0;
this.nextSearchCounter=0;
this.replySearchCounter=0;
this.setCriterion(criterion);
this.setStyles(new DiagnosesComponentStyle());
this.setComponentLoadTimerName("USR:MPG.DIAGNOSES.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.DIAGNOSES.O1 - render component");
this.setIncludeLineNumber(true);
this.setScope(2);
DiagnosesComponent.method("InsertData",function(){this.setEditMode(true);
CERN_DIAGNOSES_O1.GetDiagnosisTable(this);
});
DiagnosesComponent.method("HandleSuccess",function(recordData){CERN_DIAGNOSES_O1.RenderComponent(this,recordData);
});
DiagnosesComponent.method("setDiagnosisType",function(value){this.m_diagnosisType=value;
});
DiagnosesComponent.method("getDiagnosisType",function(){if(this.m_diagnosisType!==null){return this.m_diagnosisType;
}});
DiagnosesComponent.method("setDiagnosisVocab",function(value){this.m_diagnosisVocab=value;
});
DiagnosesComponent.method("getDiagnosisVocab",function(){return this.m_diagnosisVocab;
});
DiagnosesComponent.method("setDiagnosisAddTypeCd",function(value){this.m_diagnosisAddTypeCd=value;
});
DiagnosesComponent.method("getDiagnosisAddTypeCd",function(){return this.m_diagnosisAddTypeCd;
});
DiagnosesComponent.method("setDiagnosisClassification",function(value){this.m_diagnosisClass=value;
});
DiagnosesComponent.method("getDiagnosisClassification",function(){return this.m_diagnosisClass;
});
DiagnosesComponent.method("setDiagnosisVocabInd",function(value){this.m_diagnosisVocabInd=value;
});
DiagnosesComponent.method("getDiagnosisVocabInd",function(){return this.m_diagnosisVocabInd;
});
DiagnosesComponent.method("getSearchTypeFlag",function(){return this.m_searchTypeFlag;
});
DiagnosesComponent.method("setSearchTypeFlag",function(value){this.m_searchTypeFlag=value;
});
DiagnosesComponent.method("getSuggestionLimit",function(){return this.m_suggestionLimit;
});
DiagnosesComponent.method("setSuggestionLimit",function(value){this.m_suggestionLimit=value;
});
DiagnosesComponent.method("getCurSearchCounter",function(){return this.curSearchCounter;
});
DiagnosesComponent.method("setCurSearchCounter",function(value){this.curSearchCounter=value;
});
DiagnosesComponent.method("incCurSearchCounter",function(){this.curSearchCounter++;
});
DiagnosesComponent.method("getNextSearchCounter",function(){return this.nextSearchCounter;
});
DiagnosesComponent.method("setNextSearchCounter",function(value){this.nextSearchCounter=value;
});
DiagnosesComponent.method("incNextSearchCounter",function(){this.nextSearchCounter++;
});
DiagnosesComponent.method("getReplySearchCounter",function(){return this.replySearchCounter;
});
DiagnosesComponent.method("setReplySearchCounter",function(value){this.replySearchCounter=value;
});
DiagnosesComponent.method("incReplySearchCounter",function(){this.replySearchCounter++;
});
}DiagnosesComponent.inherits(MPageComponent);
var CERN_DIAGNOSES_O1=function(){return{GetDiagnosisTable:function(component){var sendAr=[];
var criterion=component.getCriterion();
var encntrOption=(component.getScope()==2)?(criterion.encntr_id+".0"):"0.0";
sendAr.push("^MINE^",criterion.person_id+".0",encntrOption,0);
var types=component.getDiagnosisType();
var diagnosisType=(types&&types!==null&&types.length>0)?"value("+types.join(",")+")":"0.0";
sendAr.push(diagnosisType);
sendAr.push(criterion.provider_id+".0",criterion.ppr_cd+".0",criterion.position_cd+".0","0.0","1",component.getDiagnosisVocab()+".0",component.getDiagnosisVocabInd());
var request=new MP_Core.ScriptRequest(component,component.getComponentLoadTimerName());
request.setProgramName("MP_GET_DIAGNOSES");
request.setParameters(sendAr);
request.setAsync(true);
MP_Core.XMLCCLRequestCallBack(component,request,CERN_DIAGNOSES_O1.RenderComponent);
},RenderComponent:function(reply){var recordData=reply.getResponse();
var component=reply.getComponent();
var timerRenderComponent=MP_Util.CreateTimer(component.getComponentRenderTimerName());
try{var dxI18n=i18n.discernabu.diagnoses_o1;
var jsDxHTML=[];
var dxHTML="",countText="";
if(reply.getStatus()!=="F"){if(recordData.DX_CAN_ADD===1){jsDxHTML.push(MP_Util.CreateAutoSuggestBoxHtml(component));
component.setAutoSuggestAddScript("mp_add_diagnosis");
component.setAutoSuggestAddTimerName("USR:MPG.DIAGNOSES.O1 - add diagnosis from auto suggest");
component.setSuggestionLimit(10);
}if(reply.getStatus()==="S"){var diagDate=dxCode=dxTypeCode=dxAnnot=dxName=dxFaceUp=comm=responProvider="";
var dateTime=new Date();
var personnelArray=[];
var df=new mp_formatter.DateTimeFormatter(MPAGE_LOCALE);
personnelArray=MP_Util.LoadPersonelListJSON(recordData.PRSNL);
codeArray=MP_Util.LoadCodeListJSON(recordData.CODES);
var diagnosisArray=recordData.DIAGNOSIS;
diagnosisArray.sort(SortByDiagnosesName);
jsDxHTML.push("<div class ='",MP_Util.GetContentClass(component,diagnosisArray.length),"'>");
for(var i=0,l=diagnosisArray.length;
i<l;
i++){var diagnose=diagnosisArray[i];
dxName=dxFaceUp=diagnose.NAME;
if(diagnose.DISPLAY_AS!=""){dxAnnot=dxFaceUp=diagnose.DISPLAY_AS;
}else{dxAnnot="";
}if(diagnose.CODE!=""&&diagnose.CODE!="()"){dxCode=diagnose.CODE;
}else{dxCode="()";
}if(diagnose.DIAG_DT_TM!=""){diagDate=df.formatISO8601(diagnose.DIAG_DT_TM,mp_formatter.DateTimeFormatter.FULL_DATE_4YEAR);
}else{diagDate="";
}if(diagnose.COMMENTS!=""){var comm=diagnose.COMMENTS;
}else{comm="";
}if(diagnose.PRSNL_ID>0){responProvider=MP_Util.GetValueFromArray(diagnose.PRSNL_ID,personnelArray).fullName;
}else{responProvider="";
}if(diagnose.DIAG_TYPE_CD>0){dxTypeCode=MP_Util.GetValueFromArray(diagnose.DIAG_TYPE_CD,codeArray).display;
}else{dxTypeCode="";
}jsDxHTML.push("<h3 class='info-hd'><span>",dxName,"</span></h3><dl class='dx-info'><dt><span>",dxI18n.DIAGNOSES,":</span></dt><dd class='dx-name'><span>",dxFaceUp,"</span></dd><dt><span>",dxI18n.CODE,":</span></dt><dd class='dx-code'><span class='code'>",dxCode,"</span></dd></dl><h4 class='det-hd'><span>",dxI18n.DETAILS,":</span></h4><div class='hvr'><dl class='dx-det'><dt><span>",dxI18n.DIAGNOSES_NAME,":</span></dt><dd><span>",dxName,"</span></dd><dt><span>",dxI18n.ANNOTATED_DISPLAY,":</span></dt><dd><span>",dxAnnot,"</span></dd><dt><span>",dxI18n.DIAG_TYPE,":</span></dt><dd><span>",dxTypeCode,"</span></dd><dt><span>",dxI18n.DIAGNOSES_DATE,":</span></dt><dd><span>",diagDate,"</span></dd><dt><span>",dxI18n.RESPONSIBLE_PROVIDER_NAME,":</span></dt><dd><span>",responProvider,"</span></dd><dt><span>",dxI18n.COMMENTS,":</span></dt><dd><span>",comm,"</span></dd></dl></div>");
}jsDxHTML.push("</div>");
dxHTML=jsDxHTML.join("");
countText=MP_Util.CreateTitleText(component,l);
}else{if((reply.getStatus()==="Z")){dxHTML=jsDxHTML.join("");
dxHTML+=MP_Util.HandleNoDataResponse(component.getStyles().getNameSpace());
}}MP_Util.Doc.FinalizeComponent(dxHTML,component,countText);
if(recordData.DX_CAN_ADD===1){MP_Util.AddAutoSuggestControl(component,CERN_DIAGNOSES_O1.SearchNomenclature,CERN_DIAGNOSES_O1.HandleSelection,CERN_DIAGNOSES_O1.CreateSuggestionLine);
component.setSearchTypeFlag(recordData.DX_SEARCH_TYPE);
}}else{countText=MP_Util.CreateTitleText(component,0);
MP_Util.Doc.FinalizeComponent(MP_Util.HandleErrorResponse(component.getStyles().getNameSpace(),reply.getError()),component,countText);
}}catch(err){if(timerRenderComponent){timerRenderComponent.Abort();
timerRenderComponent=null;
}throw (err);
}finally{if(timerRenderComponent){timerRenderComponent.Stop();
}component.setEditMode(false);
}},SearchNomenclature:function(callback,textBox,component){var xhr=new XMLCclRequest();
var returnData;
component.incCurSearchCounter();
xhr.onreadystatechange=function(){if(xhr.readyState==4&&xhr.status==200){var msg=xhr.responseText;
var jsonMsg="";
if(msg){jsonMsg=JSON.parse(msg);
}if(jsonMsg){var nextSearchCounter=component.getNextSearchCounter();
var replySearchCounter=jsonMsg.RECORD_DATA.SEARCHINDEX;
component.setReplySearchCounter(replySearchCounter);
if(replySearchCounter>nextSearchCounter&&textBox.value!=""){component.setNextSearchCounter(replySearchCounter);
returnData=jsonMsg.RECORD_DATA.NOMENCLATURE;
callback.autosuggest(returnData);
}}}};
xhr.open("GET","mp_search_nomenclatures");
xhr.send("^MINE^, ^"+textBox.value+"^,"+component.getSuggestionLimit()+","+component.getCurSearchCounter()+","+component.getSearchTypeFlag());
},HandleSelection:function(suggestionObj,textBox,component){if(suggestionObj!=null){var criterion=component.getCriterion();
var sendAr=[];
sendAr.push("^MINE^",criterion.person_id+".0",criterion.provider_id+".0",criterion.encntr_id+".0",criterion.ppr_cd+".0",suggestionObj.VALUE+".0",criterion.position_cd+".0","0.0","1",component.getDiagnosisAddTypeCd()+".0",component.getDiagnosisClassification()+".0");
var request=new MP_Core.ScriptRequest(component,component.getAutoSuggestAddTimerName());
request.setProgramName(component.getAutoSuggestAddScript());
request.setParameters(sendAr);
request.setAsync(true);
MP_Core.XMLCCLRequestCallBack(component,request,CERN_DIAGNOSES_O1.AddDiagnosisToList);
}else{alert("No selection was made.  Please make a selection to continue.");
}},AddDiagnosisToList:function(reply){var alertMsg="";
var jsonReply=reply.getResponse();
var component=reply.getComponent();
var componentName="";
var textBox=MP_Util.RetrieveAutoSuggestSearchBox(component);
componentName=i18n.discernabu.DIAGNOSIS;
if(jsonReply&&jsonReply.PRIVILEGE_IND==0){alertMsg=i18n.discernabu.NO_PRIVS;
alertMsg=alertMsg.replace("{name}",componentName);
alert(alertMsg);
textBox.value="";
}else{if(jsonReply&&jsonReply.DUPLICATE_IND==1){alertMsg=i18n.discernabu.DUPLICATE;
alertMsg=alertMsg.replace(/{name}/gi,componentName);
alert(alertMsg);
textBox.value="";
}else{MP_Util.Doc.HideHovers();
component.InsertData();
}}},CreateSuggestionLine:function(suggestionObj,searchVal){return CERN_DIAGNOSES_O1.HighlightValue(suggestionObj.NAME,searchVal);
},HighlightValue:function(inString,term){return"<strong class='highlight'>"+inString.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+term.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1").split(" ").join("|")+")(?![^<>]*>)(?![^&;]+;)","gi"),"</strong>$1<strong class='highlight'>")+"</strong>";
}};
function SortByDiagnosesName(a,b){var aName=(a.DISPLAY_AS!=""&&a.DISPLAY_AS!=null&&a.DISPLAY_AS!=a.NAME)?a.DISPLAY_AS.toUpperCase():a.NAME.toUpperCase();
var bName=(b.DISPLAY_AS!=""&&b.DISPLAY_AS!=null&&b.DISPLAY_AS!=a.NAME)?b.DISPLAY_AS.toUpperCase():b.NAME.toUpperCase();
if(aName<bName){return -1;
}else{if(aName>bName){return 1;
}else{return 0;
}}}}();
function DiagnosticsComponentStyle(){this.initByNamespace("dg");
}DiagnosticsComponentStyle.inherits(ComponentStyle);
function DiagnosticsComponent(criterion){this.setCriterion(criterion);
this.setStyles(new DiagnosticsComponentStyle());
this.setComponentLoadTimerName("USR:MPG.DIAGNOSTICS.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.DIAGNOSTICS.O1 - render component");
this.setIncludeLineNumber(true);
DiagnosticsComponent.method("InsertData",function(){var nameSpace=new CERN_DIAGNOSTICS_O1();
nameSpace.GetDiagnostics(this);
});
DiagnosticsComponent.method("setResultStatusCodes",function(value){this.m_resultStatusCodes=value;
});
DiagnosticsComponent.method("addResultStatusCode",function(value){if(this.m_resultStatusCodes==null){this.m_resultStatusCodes=[];
}this.m_resultStatusCodes.push(value);
});
DiagnosticsComponent.method("getResultStatusCodes",function(){if(this.m_resultStatusCodes!=null){return this.m_resultStatusCodes;
}else{if(this.m_resultStatusMeanings!=null){var resStatusCodeSet=MP_Util.GetCodeSet(8,false);
if(this.m_resultStatusMeanings&&this.m_resultStatusMeanings.length>0){for(var x=this.m_resultStatusMeanings.length;
x--;
){var code=MP_Util.GetCodeByMeaning(resStatusCodeSet,this.m_resultStatusMeanings[x]);
if(code!=null){this.addResultStatusCode(code.codeValue);
}}}}}return this.m_resultStatusCodes;
});
DiagnosticsComponent.method("addResultStatusMeaning",function(value){if(this.m_resultStatusMeanings==null){this.m_resultStatusMeanings=[];
}this.m_resultStatusMeanings.push(value);
});
DiagnosticsComponent.method("setResultStatusMeanings",function(value){this.m_resultStatusMeanings=value;
});
}DiagnosticsComponent.inherits(MPageComponent);
var CERN_DIAGNOSTICS_O1=function(){var isErrorLoadingData=false;
var isDataFound=false;
var totalResultCount=0;
var m_comp=null;
var m_contentNode=null;
var m_rootComponentNode=null;
var m_threadCount=0;
return{GetDiagnostics:function(component){m_comp=component;
var styles=component.getStyles();
m_rootComponentNode=component.getRootComponentNode();
m_contentNode=component.getSectionContentNode();
var groups=component.getGroups();
var xl=(groups!=null)?groups.length:0;
m_threadCount=xl;
CreateInfoHeader(m_contentNode);
if(component.getDateFormat()==3){CreateWithinHeader(m_contentNode);
}for(var x=0;
x<xl;
x++){var group=groups[x];
var subSection=CreateSubHeader(group.getGroupName());
GetVariousAssessment(group,subSection);
}if(m_threadCount===0){FinalizeComponent();
}}};
function CreateWithinHeader(contentNode){var dl=Util.cep("dl",{className:"dg-info-hdr hdr"});
var dd=Util.cep("dd",{className:"dg-name-hd"});
Util.ac(dd,dl);
var span=Util.cep("span");
Util.ac(span,dd);
var txtNbsp=document.createTextNode(String.fromCharCode(160));
Util.ac(txtNbsp,span);
var ddWithin=Util.cep("dd",{className:"dg-within-hd"});
Util.ac(ddWithin,dl);
var spanWithin=Util.cep("span");
Util.ac(spanWithin,ddWithin);
var txtWithin=document.createTextNode(i18n.WITHIN);
Util.ac(txtWithin,spanWithin);
Util.ac(dl,contentNode);
}function CreateInfoHeader(contentNode){var dl=Util.cep("dl",{className:"dg-info-hdr hdr"});
var dd=Util.cep("dd",{className:"dg-name-hd"});
Util.ac(dd,dl);
var span=Util.cep("span");
Util.ac(span,dd);
var txtNbsp=document.createTextNode(String.fromCharCode(160));
Util.ac(txtNbsp,span);
var ddWithin=Util.cep("dd",{className:"dg-within-hd"});
Util.ac(ddWithin,dl);
var spanWithin=Util.cep("span");
Util.ac(spanWithin,ddWithin);
var txtWithin=document.createTextNode(i18n.DATE_TIME);
Util.ac(txtWithin,spanWithin);
var ddStat=Util.cep("dd",{className:"dg-stat-hd"});
Util.ac(ddStat,dl);
var spanStat=Util.cep("span");
Util.ac(spanStat,ddStat);
var txtStat=document.createTextNode(i18n.STATUS);
Util.ac(txtStat,spanStat);
Util.ac(dl,contentNode);
}function CreateSubHeader(label){var subSec=Util.cep("div",{className:"sub-sec"});
var h3=Util.cep("h3",{className:"sub-sec-hd"});
subSec.appendChild(h3);
var spanTgl=Util.cep("span",{className:"sub-sec-hd-tgl",title:i18n.HIDE_SECTION});
h3.appendChild(spanTgl);
var TgltxtNode=document.createTextNode("-");
spanTgl.appendChild(TgltxtNode);
var spanTitle=Util.cep("span",{className:"sub-sec-title"});
h3.appendChild(spanTitle);
var labelTextNode=document.createTextNode(label);
spanTitle.appendChild(labelTextNode);
m_contentNode.appendChild(subSec);
return(subSec);
}function GetDocResults(group,subSection,subSecTitle,events){var ar=[];
var info=new XMLCclRequest();
info.onreadystatechange=function(){if(this.readyState==4&&this.status==200){m_threadCount--;
var strHTML="",sDate="",sDateHvr="",sDisplay="",sResult="",sStatus="";
var jsonEval=JSON.parse(this.responseText);
var subCnt=0;
if(jsonEval.RECORD_DATA.STATUS_DATA.STATUS=="S"){isDataFound=true;
var codeArray=MP_Util.LoadCodeListJSON(jsonEval.RECORD_DATA.CODES);
ar.push("<div class='content-body'>");
var docs=jsonEval.RECORD_DATA.DOCS;
docs.sort(SortByEffectiveDate);
for(var i=0,l=docs.length;
i<l;
i++){var ce=docs[i];
var link="";
if(ce.EVENT_CD!==""){var eventObj=MP_Util.GetValueFromArray(ce.EVENT_CD,codeArray);
sDisplay=eventObj.display;
link=MP_Util.CreateClinNoteLink(ce.PERSON_ID+".0",ce.ENCNTR_ID+".0",ce.EVENT_ID+".0",sDisplay,ce.VIEWER_TYPE,ce.PARENT_EVENT_ID+".0");
}if(ce.EFFECTIVE_DATE!==""){var dateTime=new Date();
dateTime.setISO8601(ce.EFFECTIVE_DATE);
sDate=MP_Util.DisplayDateByOption(m_comp,dateTime);
sDateHvr=dateTime.format("longDateTime3");
}if(ce.RESULT_STATUS_CD>0){var statusObj=MP_Util.GetValueFromArray(ce.RESULT_STATUS_CD,codeArray);
sStatus=statusObj.display;
}ar.push("<h3 class='info-hd'>",sDisplay,"</h3><dl class ='dg-info'><dt><span>"+i18n.DIAGNOSTIC+":</span></dt><dd class ='dg-name'><span>",link,"</span>");
if(statusObj.meaning=="MODIFIED"||statusObj.meaning=="ALTERED"){ar.push("<span class='res-modified'>&nbsp;</span>");
}ar.push("</dd><dt><span>",i18n.DATE_TIME,"</span></dt><dd class ='dg-within'>",sDate,"</dd><dt><span>",i18n.STATUS,":</span></dt><dd class='dg-stat'><span>",sStatus,"</span></dd><dd class='dg-image'>");
if(ce.IMAGE_URL!==""){var urlParam='javascript:MPAGES_SVC_EVENT("'+ce.IMAGE_URL+'",^MINE,$PAT_PersonId$^)';
ar.push("<a class='dg-image-found' href='",urlParam,"'>&nbsp;</a>");
}else{ar.push("&nbsp;");
}ar.push("</dd></dl>");
ar.push("<h4 class='det-hd'><span>",i18n.DIAGNOSTIC_DETAILS,"</span></h4><div class='hvr'><dl class='dg-det'><dt><span>",i18n.STUDY,":</span></dt><dd><span>",sDisplay,"</span></dd><dt><span>",i18n.DATE_TIME,":</span></dt><dd><span>",sDateHvr,"</span></dd></dl></div>");
subCnt++;
}ar.push("</div>");
strHTML=ar.join("");
subSecTitle[0].innerHTML=group.getGroupName()+" ("+subCnt+")";
totalResultCount+=subCnt;
var subContent=Util.cep("div",{className:"sub-sec-content"});
subSection.appendChild(subContent);
var contentBody=Util.cep("div",{className:"content-body"});
subContent.appendChild(contentBody);
contentBody.innerHTML=strHTML;
}else{if(jsonEval.RECORD_DATA.STATUS_DATA.STATUS=="Z"){subSecTitle[0].innerHTML=group.getGroupName()+" (0)";
var subContent1=Util.cep("div",{className:"sub-sec-content"});
subSection.appendChild(subContent1);
var contentBody1=Util.cep("div",{className:"content-body"});
subContent1.appendChild(contentBody1);
contentBody1.innerHTML="<div ><span class='res-none'>"+i18n.NO_RESULTS_FOUND+"</span> </div>";
}else{if(jsonEval.RECORD_DATA.STATUS_DATA.STATUS!="Z"){isErrorLoadingData=true;
}}}if(m_threadCount===0){FinalizeComponent();
}}if(this.readyState==4){MP_Util.ReleaseRequestReference(this);
}};
var criterion=m_comp.getCriterion();
info.open("GET","MP_RETRIEVE_DOCUMENTS_JSON");
var encntrOption=(m_comp.getScope()==2)?(criterion.encntr_id+".0"):"0.0";
var codes=m_comp.getResultStatusCodes();
var statusCodes=(codes!=null&&codes.length>0)?"value("+codes.join(",")+")":"0.0";
var eventCodes=(events!=null&&events.length>0)?"value("+events.join(",")+")":"0.0";
var sendAr=[];
sendAr.push("^MINE^",criterion.person_id+".0",encntrOption,criterion.provider_id+".0",m_comp.getLookbackUnits(),eventCodes,statusCodes,criterion.ppr_cd+".0",m_comp.getLookbackUnitTypeFlag());
info.send(sendAr.join(","));
return;
}function GetVariousAssessment(group,subSection){var events=(group.getEventSets()!=null&&group.getEventSets().length>0)?group.getEventSets():null;
var subSecTitle=Util.Style.g("sub-sec-title",subSection,"SPAN");
if(events==null){subSecTitle[0].innerHTML=group.getGroupName()+" (0)";
m_threadCount--;
return;
}GetDocResults(group,subSection,subSecTitle,events);
}function SortByEffectiveDate(a,b){if(a.EFFECTIVE_DATE>b.EFFECTIVE_DATE){return -1;
}else{if(a.EFFECTIVE_DATE<b.EFFECTIVE_DATE){return 1;
}else{return 0;
}}}function FinalizeComponent(){var styles=m_comp.getStyles();
var totalCount=Util.Style.g("sec-total",m_rootComponentNode,"span");
var sResultText="";
if(isErrorLoadingData){m_contentNode.innerHTML=MP_Util.HandleErrorResponse(styles.getNameSpace());
}else{if(totalResultCount===0){sResultText=MP_Util.CreateTitleText(m_comp,totalResultCount);
m_contentNode.innerHTML=MP_Util.HandleNoDataResponse(styles.getNameSpace());
}else{sResultText=MP_Util.CreateTitleText(m_comp,totalResultCount);
var contentHtml=[];
contentHtml.push("<div class ='",MP_Util.GetContentClass(m_comp,totalResultCount),"'>");
contentHtml.push(m_contentNode.innerHTML);
contentHtml.push("</div>");
m_contentNode.innerHTML=contentHtml.join("");
MP_Util.Doc.InitHovers(styles.getInfo(),m_contentNode);
MP_Util.Doc.InitSubToggles(m_contentNode,"sub-sec-hd-tgl");
MP_Util.Doc.InitScrolling(Util.Style.g("scrollable",m_contentNode,"div"),m_comp.getScrollNumber(),1.6);
}}totalCount[0].innerHTML=sResultText;
}};
function DocumentComponentStyle(){this.initByNamespace("doc");
}DocumentComponentStyle.inherits(ComponentStyle);
function DocumentComponent(criterion){this.setCriterion(criterion);
this.setStyles(new DocumentComponentStyle());
this.setComponentLoadTimerName("USR:MPG.DOCUMENTS.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.DOCUMENTS.O1 - render component");
DocumentComponent.method("openTab",function(){var criterion=this.getCriterion();
var sParms="/PERSONID="+criterion.person_id+" /ENCNTRID="+criterion.encntr_id+" /FIRSTTAB=^"+this.getLink()+"+^";
APPLINK(0,criterion.executable,sParms);
this.InsertData();
});
}DocumentComponent.inherits(DocumentBaseComponent);
function ImmunizationComponentStyle(){this.initByNamespace("im");
}ImmunizationComponentStyle.inherits(ComponentStyle);
function ImmunizationComponent(criterion){this.setCriterion(criterion);
this.setStyles(new ImmunizationComponentStyle());
this.setIncludeLineNumber(true);
this.setScope(1);
this.setComponentLoadTimerName("USR:MPG.IMMUNIZATION.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.IMMUNIZATION.O1 - render component");
ImmunizationComponent.method("InsertData",function(){CERN_IMMUNIZATION_O1.GetImmunizationTable(this);
});
ImmunizationComponent.method("HandleSuccess",function(recordData){CERN_IMMUNIZATION_O1.RenderComponent(this,recordData);
});
}ImmunizationComponent.inherits(MPageComponent);
var CERN_IMMUNIZATION_O1=function(){return{GetImmunizationTable:function(component){var sendAr=[];
var criterion=component.getCriterion();
sendAr.push("^MINE^",criterion.person_id+".0",criterion.provider_id+".0",criterion.encntr_id+".0",criterion.ppr_cd+".0");
MP_Core.XMLCclRequestWrapper(component,"mp_get_immunizations",sendAr,true);
},RenderComponent:function(component,recordData){var timerRenderComponent=MP_Util.CreateTimer(component.getComponentRenderTimerName());
try{var jsHTML=[];
var currImmun=null;
var criterion=component.getCriterion();
jsHTML.push("<div class='",MP_Util.GetContentClass(component,recordData.IMMUN_CNT),"'>");
var df=new mp_formatter.DateTimeFormatter(MPAGE_LOCALE);
var nf=new mp_formatter.NumericFormatter(MPAGE_LOCALE);
var dateTime=new Date();
var adminDate="";
var expiryDate="";
var imModClass="";
for(var i=0,j=recordData.IMMUN_CNT;
i<j;
i++){var immunizationi18n=i18n.discernabu.immunization;
var commentString="";
var precision=0;
currImmun=recordData.IMMUN[i];
var resStatus=currImmun.RESULT_STATUS_CD;
if(currImmun.ADMIN_DATE!=""){var adminDt=currImmun.ADMIN_DATE;
dateTime.setISO8601(adminDt);
adminDate=df.format(dateTime,mp_formatter.DateTimeFormatter.FULL_DATE_2YEAR);
}if(currImmun.EXP_DATE!=""){var expDt=currImmun.EXP_DATE;
dateTime.setISO8601(expDt);
expiryDate=df.format(dateTime,mp_formatter.DateTimeFormatter.FULL_DATE_4YEAR);
}var valRes=currImmun.DOSE+"";
var decLoc=valRes.search(/\.(\d)/);
if(decLoc!==-1){var strSize=valRes.length;
precision=strSize-decLoc-1;
}var imTitleLink=GetEventViewerLink(criterion.person_id+".0",criterion.encntr_id+".0",currImmun);
var resModClass="";
if(currImmun.RESULT_STATUS_CD===1){resModClass="<span class='res-modified'>&nbsp;</span>";
}jsHTML.push("<h3 class='info-hd'><SPAN>",currImmun.NAME,"</SPAN></h3><dl class='im-info'><dd class='im-name'><span>",imTitleLink,resModClass,"</span></dd><dd class='im-date'><span class='date-time'>",adminDate,"</span></dd></dl><h4 class='det-hd'><span>",immunizationi18n.IMMUNIZATIONS_DETAILS,"</span></h4><div class='hvr'><dl class='im-det'><dt><span>",immunizationi18n.IMMUNIZATIONS,":</span></dt><dd><span>",currImmun.NAME,"</span></dd><dt><span>",immunizationi18n.TYPE,":</span></dt><dd><span>",currImmun.TYPE,"</span></dd><dt><span>",immunizationi18n.STATUS,":</span></dt><dd><span>",currImmun.RESULT_STATUS_DISP,"</span></dd><dt><span>",immunizationi18n.PRODUCT,":</span></dt><dd><span>",currImmun.PRODUCT,"</span></dd><dt><span>",immunizationi18n.ADMIN_DATE,":</span></dt><dd><span>",adminDate,"</span></dd><dt><span>",immunizationi18n.DOCUMENTED_BY,":</span></dt><dd><span>",currImmun.ADMIN_NAME,"</span></dd><dt><span>",immunizationi18n.DETAILS,":</span></dt><dd><span>",formatVal=nf.format(valRes,"."+precision),"&nbsp;",currImmun.UNIT,", ",currImmun.ROUTE,", ",currImmun.SITE,"</span></dd><dt><span>",immunizationi18n.MANUFACTURER,":</span></dt><dd><span>",currImmun.MANUFACTURER,"</span></dd><dt><span>",immunizationi18n.LOT,":</span></dt><dd><span>",currImmun.LOT,"</span></dd><dt><span>",immunizationi18n.EXP_DATE,":</span></dt><dd><span>",expiryDate,"</span></dd><dt><span>",immunizationi18n.ADMIN_NOTES,":</span></dt>");
if(currImmun.NOTE!==""){commentString+=currImmun.NOTE+"<br />";
}else{for(var k=0,l=currImmun.ADMIN_NOTE.length;
k<l;
k++){commentString+=currImmun.ADMIN_NOTE[k].TEXT+"<br />";
}}jsHTML.push("<dd><span>",commentString,"</span></dd></dl></div>");
}jsHTML.push("</div>");
var countText=MP_Util.CreateTitleText(component,recordData.IMMUN_CNT);
MP_Util.Doc.FinalizeComponent(jsHTML.join(""),component,countText);
}catch(err){if(timerRenderComponent){timerRenderComponent.Abort();
timerRenderComponent=null;
}throw (err);
}finally{if(timerRenderComponent){timerRenderComponent.Stop();
}}return;
}};
function GetEventViewerLink(patientID,encntrID,immObj){var ar=[];
var params=[patientID,encntrID,immObj.EVENT_ID,'"EVENT"'];
ar.push("<a onclick='MP_Util.LaunchClinNoteViewer(",params.join(","),"); return false;' href='#'>",immObj.NAME,"</a>");
return ar.join("");
}}();
function LaboratoryComponentStyle(){this.initByNamespace("lab");
}LaboratoryComponentStyle.inherits(ComponentStyle);
function LaboratoryComponent(criterion){this.setCriterion(criterion);
this.setStyles(new LaboratoryComponentStyle());
this.setIncludeLineNumber(false);
this.m_graphLink=1;
this.m_primaryLabel=i18n.discernabu.laboratory_o1.PRIMARY_RESULTS;
LaboratoryComponent.method("InsertData",function(){var nameSpace=new CERN_LABORATORY_O1();
nameSpace.GetLaboratoryTable(this);
});
LaboratoryComponent.method("setGraphFlag",function(value){this.m_graphLink=value;
});
LaboratoryComponent.method("getGraphFlag",function(){return(this.m_graphLink);
});
LaboratoryComponent.method("setPrimaryLabel",function(value){this.m_primaryLabel=value;
});
LaboratoryComponent.method("getPrimaryLabel",function(){return(this.m_primaryLabel);
});
LaboratoryComponent.method("refresh",function(event,args){if(args!="GrowthChart"){var contentNode=this.getSectionContentNode();
contentNode.innerHTML="";
this.InsertData();
}});
CERN_EventListener.addListener(this,EventListener.EVENT_CLINICAL_EVENT,this.refresh,this);
}LaboratoryComponent.inherits(MPageComponent);
var CERN_LABORATORY_O1=function(){var isErrorLoadingData=false;
var isDataFound=false;
var totalResultCount=0;
var m_comp=null;
var m_contentNode=null;
var m_contentSecNode=null;
var m_rootComponentNode=null;
var m_threadCount=0;
return{GetLaboratoryTable:function(component){m_comp=component;
var styles=component.getStyles();
m_rootComponentNode=component.getRootComponentNode();
m_contentNode=component.getSectionContentNode();
var groups=component.getGroups();
var xl=(groups!=null)?groups.length:0;
m_threadCount=xl;
CreateInfoHeader(m_contentNode);
for(var x=0;
x<xl;
x++){var group=groups[x];
var subSection=CreateSubHeader(group.getGroupName(),false);
GetResultsByGroup(group,subSection,component);
}if(m_threadCount===0){FinalizeComponent();
}}};
function CreateInfoHeader(secContentNode){var labI18n=i18n.discernabu.laboratory_o1;
var contentHdr=Util.cep("div",{className:"content-hdr"});
Util.ac(contentHdr,secContentNode);
var ar=[];
var withinTH="";
if(m_comp.getDateFormat()==3){withinTH="<br /><span>"+labI18n.WITHIN+"</span>";
}ar.push("<table class='lab-table'><tr class='hdr'><th class='lab-lbl'><span>&nbsp;</span></th><th class='lab-res0'><span>",labI18n.LATEST,"</span>",withinTH,"</th><th class='lab-res1'><span>",labI18n.PREVIOUS,"</span>",withinTH,"</th></tr></table>");
contentHdr.innerHTML=ar.join("");
m_contentSecNode=Util.cep("div",{className:"content-body"});
Util.ac(m_contentSecNode,secContentNode);
}function FinalizeComponent(){var styles=m_comp.getStyles();
var totalCount=Util.Style.g("sec-total",m_rootComponentNode,"span");
var sResultText="";
if(isErrorLoadingData){m_contentNode.innerHTML=MP_Util.HandleErrorResponse(styles.getNameSpace());
}else{if(totalResultCount===0){sResultText=MP_Util.CreateTitleText(m_comp,totalResultCount);
m_contentNode.innerHTML=MP_Util.HandleNoDataResponse();
}else{sResultText=MP_Util.CreateTitleText(m_comp,totalResultCount);
if(totalResultCount>m_comp.getScrollNumber()&&m_comp.isScrollingEnabled()){Util.Style.acss(m_contentSecNode,"scrollable ");
var contentHdr=Util.Style.g("content-hdr",m_rootComponentNode,"div");
Util.Style.acss(contentHdr[0],"lab-scrl-tbl-hd");
}MP_Util.Doc.InitHovers(styles.getInfo(),m_contentSecNode);
MP_Util.Doc.InitSubToggles(m_contentSecNode,"sub-sec-hd-tgl");
if(m_comp.isScrollingEnabled()){MP_Util.Doc.InitScrolling(Util.Style.g("scrollable",m_rootComponentNode,"div"),m_comp.getScrollNumber(),"2.8");
}}}totalCount[0].innerHTML=sResultText;
}function CreateSubHeader(label,includeContentBody){var subSec=Util.cep("div",{className:"sub-sec"});
var h3=Util.cep("h3",{className:"sub-sec-hd lab-sub-scrl-hd"});
subSec.appendChild(h3);
var spanTgl=Util.cep("span",{className:"sub-sec-hd-tgl",title:i18n.discernabu.laboratory_o1.COLLAPSE});
h3.appendChild(spanTgl);
var TgltxtNode=document.createTextNode("-");
spanTgl.appendChild(TgltxtNode);
var spanTitle=Util.cep("span",{className:"sub-sec-title"});
h3.appendChild(spanTitle);
var labelTextNode=document.createTextNode(label);
spanTitle.appendChild(labelTextNode);
if(includeContentBody){var subContent=Util.cep("div",{className:"sub-sec-content"});
subSec.appendChild(subContent);
var contentBody=Util.cep("div",{className:"content-body"});
subContent.appendChild(contentBody);
}m_contentSecNode.appendChild(subSec);
return(subSec);
}function GetResultsByGroup(group,subSection,component){var sEC="0.0",sES="0.0";
var es=group.getEventSets();
if(es!=null&&es.length>0){sES="value("+es.join(",")+")";
}var info=new XMLCclRequest();
info.onreadystatechange=function(){if(this.readyState==4&&this.status==200){m_threadCount--;
var sHTML="",countText="";
var subCnt=0;
var jsonEval=JSON.parse(this.responseText);
var recordData=jsonEval.RECORD_DATA;
var subSecTitle=Util.Style.g("sub-sec-title",subSection,"SPAN");
if(recordData.STATUS_DATA.STATUS=="S"){var ar=[];
var codeArray=MP_Util.LoadCodeListJSON(jsonEval.RECORD_DATA.CODES);
var personnelArray=MP_Util.LoadPersonelListJSON(jsonEval.RECORD_DATA.PRSNL);
var mapObjects=CERN_LABORATORY_O1_UTIL.LoadMeasurementData(jsonEval,personnelArray,codeArray);
if(group.getGroupName()==i18n.discernabu.laboratory_o1.PRIMARY_RESULTS){var subContent=Util.cep("div",{className:"sub-sec-content"});
subSection.appendChild(subContent);
var secContentBody=Util.cep("div",{className:"content-body"});
subContent.appendChild(secContentBody);
subCnt=mapObjects.length;
var measAr=[];
for(var x=0,xl=mapObjects.length;
x<xl;
x++){measAr.push(mapObjects[x].value);
}AssociateResultsToGroup(subSection,m_comp.getPrimaryLabel(),measAr,subSecTitle[0],secContentBody,component);
}else{var sGroupName="";
var sub=null;
measAr=[];
if(mapObjects.length===0){subSecTitle[0].innerHTML=group.getGroupName()+" (0)";
}else{m_contentSecNode.removeChild(subSection);
var secContentBody=null;
for(var x=0,xl=mapObjects.length;
x<xl;
x++){if(sGroupName!=mapObjects[x].name){sGroupName=mapObjects[x].name;
sub=CreateSubHeader(sGroupName);
measAr=[];
var subContent=Util.cep("div",{className:"sub-sec-content"});
sub.appendChild(subContent);
secContentBody=Util.cep("div",{className:"content-body"});
subContent.appendChild(secContentBody);
subSecTitle=Util.Style.g("sub-sec-title",sub,"SPAN");
}measAr.push(mapObjects[x].value);
subCnt=measAr.length;
if((x==(xl-1))||(x!=(xl-1)&&mapObjects[x+1].name!=sGroupName)){AssociateResultsToGroup(sub,sGroupName,measAr,subSecTitle[0],secContentBody,component);
}}}}}else{if(recordData.STATUS_DATA.STATUS=="Z"){subSecTitle[0].innerHTML=group.getGroupName()+" (0)";
}else{isErrorLoadingData=true;
}}if(m_threadCount==0){FinalizeComponent();
}}if(this.readyState==4){MP_Util.ReleaseRequestReference(this);
}};
var criterion=m_comp.getCriterion();
info.open("GET","MP_RETRIEVE_N_RESULTS_JSON");
var sEncntr=(m_comp.getScope()==2)?criterion.encntr_id+".0":"0.0";
var sendAr=[];
sendAr.push("^MINE^",criterion.person_id+".0",sEncntr,criterion.provider_id+".0",criterion.ppr_cd+".0",3,"^^",sES,sEC,m_comp.getLookbackUnits(),m_comp.getLookbackUnitTypeFlag());
info.send(sendAr.join(","));
}function AssociateResultsToGroup(subSection,subGroupName,measurements,subSecTitle,secContentBody,component){var compId=component.getComponentId();
var subCnt=measurements.length;
var ar=[];
ar.push("<table class='lab-table'>");
for(var x=0,xl=measurements.length;
x<xl;
x++){var meas=measurements[x];
var rowClass=(x%2)?"even":"odd";
var m1=meas[0];
ar.push("<tr class='",rowClass,"'>");
if(component.getGraphFlag()==1){ar.push("<td class='lab-lbl'><span class='row-label'><a onClick='MP_Util.GraphResults(",m1.getEventCode().codeValue,",",compId,",0.0);'>",m1.getEventCode().display,"</a></span></td>");
}else{ar.push("<td class='lab-lbl'><span class='row-label'>",m1.getEventCode().display,"</span></td>");
}ar.push(CERN_LABORATORY_O1_UTIL.CreateResultCell(meas[0],0,m_comp));
ar.push(CERN_LABORATORY_O1_UTIL.CreateResultCell(meas[1],1,m_comp));
ar.push(CERN_LABORATORY_O1_UTIL.CreateResultCell(meas[2],2,m_comp));
ar.push("</tr>");
}ar.push("</table>");
secContentBody.innerHTML=ar.join("");
subSecTitle.innerHTML=subGroupName+" ("+subCnt+")";
totalResultCount+=subCnt;
}};
var CERN_LABORATORY_O1_UTIL=function(){var m_df=null;
return{LoadMeasurementData:function(jsonEval,personnelArray,codeArray){var mapObjects=[];
var results=jsonEval.RECORD_DATA.RESULTS;
for(var i=0,il=results.length;
i<il;
i++){if(results[i].CLINICAL_EVENTS.length>0){for(var j=0,jl=results[i].CLINICAL_EVENTS.length;
j<jl;
j++){var measureArray=[];
var mapObject=null;
if(results[i].EVENT_CD>0){mapObject=new MP_Core.MapObject(results[i].EVENT_CD,measureArray);
}else{mapObject=new MP_Core.MapObject(results[i].EVENT_SET_NAME,measureArray);
}var meas=results[i].CLINICAL_EVENTS[j];
for(var k=0,kl=meas.MEASUREMENTS.length;
k<kl;
k++){var measurement=new MP_Core.Measurement();
measurement.initFromRec(meas.MEASUREMENTS[k],codeArray);
measureArray.push(measurement);
}measureArray.sort(SortByEffectiveDate);
if(measureArray.length>0){mapObjects.push(mapObject);
}}}}return mapObjects;
},CreateResultCell:function(result,idx,component){var ar=[];
var labI18n=i18n.discernabu.laboratory_o1;
if(result==null){ar.push("<td class='lab-res",idx,"'><dl class='lab-info'><dt><span>",labI18n.VALUE,"</span></dt><dd class='lab-res'><span>--</span></dd></dl></td>");
}else{var obj=result.getResult();
var resStr=GetStringResult(obj,false);
var resHvrStr=GetStringResult(obj,true);
var display=result.getEventCode().display;
var dateTime=result.getDateTime();
var labNormalcy=CalculateNormalcy(result);
var within=MP_Util.CalcWithinTime(dateTime);
var resStatus=result.getStatus().display;
var sCritHigh="",sCritLow="",sNormHigh="",sNormLow="";
if(obj instanceof MP_Core.QuantityValue){var refRange=obj.getRefRange();
if(refRange!=null){if(refRange.getCriticalHigh()!=0||refRange.getCriticalLow()!=0){sCritHigh=refRange.getCriticalHigh();
sCritLow=refRange.getCriticalLow();
}if(refRange.getNormalHigh()!=0||refRange.getNormalLow()!=0){sNormHigh=refRange.getNormalHigh();
sNormLow=refRange.getNormalLow();
}}}var df=GetDateFormatter();
ar.push("<td class='lab-res",idx,"'><dl class='lab-info'><dt><span>",labI18n.VALUE,"</span></dt><dd class='lab-res'><span class='",labNormalcy,"'><span class='res-ind'>&nbsp;</span><span class='res-value'>",GetEventViewerLink(result,resStr),"</span>",MP_Util.Measurement.GetModifiedIcon(result),"</span>");
if(component.getDateFormat()!=4){ar.push("<br /><span class='within'>",MP_Util.DisplayDateByOption(component,dateTime),"</span>");
}ar.push("</dd></dl><h4 class='det-hd'><span>",labI18n.LABORATORY_DETAILS,"</span></h4><div class='hvr'><dl class='lab-det'><dt class='lab-det-type'><span>",display,":</span></dt><dd class='result'><span class='",labNormalcy,"'>",resHvrStr,"</span></dd><dt class='lab-det-type'><span>",labI18n.DATE_TIME,":</span></dt><dd class='result'><span>",df.format(dateTime,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_4YEAR),"</span></dd><dt class='lab-det-type'><span>",labI18n.NORMAL_LOW,":</span></dt><dd class='result'><span>",sNormLow,"</span></dd><dt class='lab-det-type'><span>",labI18n.NORMAL_HIGH,":</span></dt><dd class='result'><span>",sNormHigh,"</span></dd><dt class='lab-det-type'><span>",labI18n.CRITICAL_LOW,":</span></dt><dd class='result'><span>",sCritLow,"</span></dd><dt class='lab-det-type'><span>",labI18n.CRITICAL_HIGH,":</span></dt><dd class='result'><span>",sCritHigh,"</span></dd><dt class='lab-det-type'><span>",labI18n.STATUS,":</span></dt><dd class='result'><span>",resStatus,"</span></dd></dl></div></td>");
}return ar.join("");
}};
function GetDateFormatter(){if(m_df==null){m_df=new mp_formatter.DateTimeFormatter(MPAGE_LOCALE);
}return m_df;
}function SortByEffectiveDate(a,b){if(a.getDateTime()>b.getDateTime()){return -1;
}else{if(a.getDateTime()<b.getDateTime()){return 1;
}else{return 0;
}}}function CreateHoverForMeasurement(measurement){var ar=[];
var labI18n=i18n.discernabu.laboratory_o1;
var obj=measurement.getResult();
var resStr=GetStringResult(obj,false);
var resHvrStr=GetStringResult(obj,true);
var display=measurement.getEventCode().display;
var dateTime=measurement.getDateTime();
var labNormalcy=CalculateNormalcy(measurement);
var sCritHigh="",sCritLow="",sNormHigh="",sNormLow="";
if(obj instanceof MP_Core.QuantityValue){var refRange=obj.getRefRange();
if(refRange!=null){if(refRange.getCriticalHigh()!=0||refRange.getCriticalLow()!=0){sCritHigh=refRange.getCriticalHigh();
sCritLow=refRange.getCriticalLow();
}if(refRange.getNormalHigh()!=0||refRange.getNormalLow()!=0){sNormHigh=refRange.getNormalHigh();
sNormLow=refRange.getNormalLow();
}}}var df=GetDateFormatter();
ar.push("<dt class='lab-res'><span>",display,":</span></dt><dd class='lab-det-type'><span class='",labNormalcy,"'>",resHvrStr,"</span></dd><dt class='lab-res'><span>",labI18n.DATE_TIME,":</span></dt><dd class='lab-det-type'><span>",df.format(dateTime,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_4YEAR),"</span></dd><dt class='lab-res'><span>",labI18n.NORMAL_LOW,":</span></dt><dd class='lab-det-type'><span>",sNormLow,"</span></dd><dt class='lab-res'><span>",labI18n.NORMAL_HIGH,":</span></dt><dd class='lab-det-type'><span>",sNormHigh,"</span></dd><dt class='lab-res'><span>",labI18n.CRITICAL_LOW,":</span></dt><dd class='lab-det-type'><span>",sCritLow,"</span></dd><dt class='lab-res'><span>",labI18n.CRITICAL_HIGH,":</span></dt><dd class='lab-det-type'><span>",sCritHigh,"</span></dd>");
return(ar.join(""));
}function GetStringResult(result,includeUOM){var value="";
var df=GetDateFormatter();
if(result instanceof MP_Core.QuantityValue){if(includeUOM){value=result.toString();
}else{value=result.getValue();
}}else{if(result instanceof Date){value=df.format(result,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_4YEAR);
}else{value=result;
}}return value;
}function CalculateCriticalRange(result){var rv="";
if(result instanceof MP_Core.QuantityValue){var rr=result.getRefRange();
if(rr!=null){rv=rr.toCriticalInlineString();
}}return rv;
}function CalculateNormalRange(result){var rv="";
if(result instanceof MP_Core.QuantityValue){var rr=result.getRefRange();
if(rr!=null){rv=rr.toNormalInlineString();
}}return rv;
}function CalculateNormalcy(result){var normalcy="res-normal";
var nc=result.getNormalcy();
if(nc!=null){var normalcyMeaning=nc.meaning;
if(normalcyMeaning!=null){if(normalcyMeaning==="LOW"){normalcy="res-low";
}else{if(normalcyMeaning==="HIGH"){normalcy="res-high";
}else{if(normalcyMeaning==="CRITICAL"||normalcyMeaning==="EXTREMEHIGH"||normalcyMeaning==="PANICHIGH"||normalcyMeaning==="EXTREMELOW"||normalcyMeaning==="PANICLOW"||normalcyMeaning==="VABNORMAL"||normalcyMeaning==="POSITIVE"){normalcy="res-severe";
}else{if(normalcyMeaning==="ABNORMAL"){normalcy="res-abnormal";
}}}}}}return normalcy;
}function GetEventViewerLink(measObject,res){var ar=[];
var params=[measObject.getPersonId(),measObject.getEncntrId(),measObject.getEventId(),'"EVENT"'];
ar.push("<a onclick='MP_Util.LaunchClinNoteViewer(",params.join(","),"); return false;' href='#'>",res,"</a>");
return ar.join("");
}}();
function LinesTubesDrainsComponentStyle(){this.initByNamespace("ld");
}LinesTubesDrainsComponentStyle.inherits(ComponentStyle);
function LinesTubesDrainsComponent(criterion){this.setCriterion(criterion);
this.setStyles(new LinesTubesDrainsComponentStyle());
this.setComponentLoadTimerName("USR:MPG.LINES_TUBES.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.LINES_TUBES.O1 - render component");
this.setIncludeLineNumber(true);
this.setScope(2);
this.m_lines=null;
this.m_tubes=null;
LinesTubesDrainsComponent.method("InsertData",function(){CERN_LINESTUBESDRAINS_O1.GetLinesTubesDrainsTable(this);
});
LinesTubesDrainsComponent.method("HandleSuccess",function(recordData){CERN_LINESTUBESDRAINS_O1.RenderComponent(this,recordData);
});
LinesTubesDrainsComponent.method("getLineCodes",function(){return(this.m_lines);
});
LinesTubesDrainsComponent.method("setLineCodes",function(value){this.m_lines=value;
});
LinesTubesDrainsComponent.method("addLineCode",function(value){if(this.m_lines==null){this.m_lines=[];
}this.m_lines.push(value);
});
LinesTubesDrainsComponent.method("getTubeCodes",function(){return(this.m_tubes);
});
LinesTubesDrainsComponent.method("setTubeCodes",function(value){this.m_tubes=value;
});
LinesTubesDrainsComponent.method("addTubeCode",function(value){if(this.m_tubes==null){this.m_tubes=[];
}this.m_tubes.push(value);
});
}LinesTubesDrainsComponent.inherits(MPageComponent);
var CERN_LINESTUBESDRAINS_O1=function(){var m_df=null;
return{GetLinesTubesDrainsTable:function(component){var sendAr=[];
var criterion=component.getCriterion();
var lineCodes=component.getLineCodes();
var tubeCodes=component.getTubeCodes();
var sLines=MP_Util.CreateParamArray(component.getLineCodes(),1);
var sTubes=MP_Util.CreateParamArray(component.getTubeCodes(),1);
sendAr.push("^MINE^",criterion.person_id+".0",criterion.encntr_id+".0",sLines,sTubes,criterion.provider_id+".0",criterion.ppr_cd+".0");
MP_Core.XMLCclRequestWrapper(component,"mp_lines_tubes_drains",sendAr,true);
},RenderComponent:function(component,recordData){var timerRenderComponent=MP_Util.CreateTimer(component.getComponentRenderTimerName());
try{var i=0;
var jsLTDHTML=[];
var ltdHTML="",countText="";
var headDtTm=component.getDateFormat()==3?i18n.LAST_DOC_WITHIN:i18n.LAST_DOC;
var eventList=[];
var criterion=component.getCriterion();
jsLTDHTML.push("<dl class='ld-info-hdr hdr'><dd class='ld-name'></dd><dd class='ld-dt'>",headDtTm,"</dd></dl><div class='sub-sec'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl' title='",i18n.HIDE_SECTION,"'>-</span><span class='sub-sec-title'>",i18n.LINES," (",recordData.LINES.length,")</span></h3><div class='sub-sec-content'>");
if(recordData.LINES.length>0){recordData.LINES.sort(SortLinesTubesDrainsByDate);
jsLTDHTML.push("<div class='",MP_Util.GetContentClass(component,recordData.LINES.length),"'>");
for(i=0;
i<recordData.LINES.length;
i++){jsLTDHTML.push(CreateLTDRow(recordData.LINES[i],component));
var detailObj=recordData.LINES[i].DETAILS;
for(var x=0;
x<detailObj.length;
x++){eventList.push(detailObj[x].EVENT_ID+".0");
}}jsLTDHTML.push("</div>");
}jsLTDHTML.push("</div></div><div class='sub-sec'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl' title='",i18n.HIDE_SECTION,"'>-</span><span class='sub-sec-title'>",i18n.TUBES_DRAINS," (",recordData.TUBES_DRAINS.length,")</span></h3><div class='sub-sec-content'>");
if(recordData.TUBES_DRAINS.length>0){recordData.TUBES_DRAINS.sort(SortLinesTubesDrainsByDate);
jsLTDHTML.push("<div class='",MP_Util.GetContentClass(component,recordData.TUBES_DRAINS.length),"'>");
for(i=0;
i<recordData.TUBES_DRAINS.length;
i++){jsLTDHTML.push(CreateLTDRow(recordData.TUBES_DRAINS[i],component));
var detailObj=recordData.LINES[i].DETAILS;
for(var x=0;
x<detailObj.length;
x++){eventList.push(detailObj[x].EVENT_ID+".0");
}}jsLTDHTML.push("</div>");
}jsLTDHTML.push("</div></div>");
ltdHTML=jsLTDHTML.join("");
countText=MP_Util.CreateTitleText(component,recordData.LINES.length+recordData.TUBES_DRAINS.length);
MP_Util.Doc.FinalizeComponent(ltdHTML,component,countText);
var classArray=Util.Style.g("ld-name");
for(var k=0;
k<classArray.length;
k++){Util.addEvent(classArray[k],"click",function(){GetEventViewer(criterion.person_id+".0",criterion.encntr_id+".0",eventList,'"EVENT"');
});
Util.addEvent(classArray[k],"mouseover",function(){rowSel(this);
});
Util.addEvent(classArray[k],"mouseout",function(){rowSel(this);
});
}}catch(err){if(timerRenderComponent){timerRenderComponent.Abort();
timerRenderComponent=null;
}throw (err);
}finally{if(timerRenderComponent){timerRenderComponent.Stop();
}}}};
function CreateLTDRow(ltd,component){var ar=[];
var sDetStart="<dl class='ld-info'><dd class='ld-name'><span>";
var sDetMid="</span></dd><dd class='ld-dt'><span class='date-time'>";
var sDetEnd="</span></dd></dl>";
var sModClass="";
var nModInd=0;
var objDet=ltd.DETAILS;
var sLTDTitle=(ltd.DYN_LBL_NAME!="")?ltd.TYPE+"  ("+ltd.DYN_LBL_NAME+")":ltd.TYPE;
var nf=new mp_formatter.NumericFormatter(MPAGE_LOCALE);
var sEvntDtTm="";
if(ltd.LAST_DT_TM!=""){sEvntDtTm=GetHeadsUpDateDisplay(component,ltd.LAST_DT_TM);
}for(var x=0;
x<objDet.length;
x++){if(objDet[x].RESULT_STATUS_FLAG===1){if(nModInd===0){nModInd=1;
sModClass="<span class='res-modified'>&nbsp;</span>";
}}}ar.push(sDetStart,sLTDTitle,sModClass,sDetMid,sEvntDtTm,sDetEnd);
if(objDet!=null&&objDet.length>0){ar.push(CreateHover(objDet,ltd));
}ar.push("</dl>");
return ar.join("");
}function CreateHover(objDet,ltd){var ar=[];
var sHvrDetStart="<dt><span>";
var sHvrDetMid="</span></dt><dd><span>";
var sHvrDetEnd="</span></dd>";
var sColon=":";
var nf=new mp_formatter.NumericFormatter(MPAGE_LOCALE);
ar.push("<h4 class='det-hd'><span>"+i18n.DETAILS+"</span></h4><div class='hvr'><dl>");
for(var j=0;
j<objDet.length;
j++){var resultDisplay="";
var status="";
if(objDet[j].RESULT_TYPE_FLAG==1){var resultDtTm=GetHoverDateDisplay(objDet[j].RESULT);
}else{var prec=calculatePrecision(objDet[j].RESULT);
if(!isNaN(objDet[j].RESULT)){resultDisplay=nf.format(objDet[j].RESULT,"."+prec);
}else{resultDisplay=objDet[j].RESULT;
}}status="</span></dd><dd><span>"+i18n.STATUS+": "+objDet[j].RESULT_STATUS;
var sChar=objDet[j].NAME.substring(objDet[j].NAME.length-1);
if(sChar==":"){ar.push(sHvrDetStart,objDet[j].NAME,sHvrDetMid,resultDisplay,sHvrDetEnd);
}else{ar.push(sHvrDetStart,objDet[j].NAME,sColon,sHvrDetMid,resultDisplay,sHvrDetEnd);
}}if(ltd.FIRST_DT_TM!=""){var sEvntDtTm=GetHoverDateDisplay(ltd.FIRST_DT_TM);
ar.push("<dt><span>",i18n.INIT_DOC_DT_TM,":</span></dt><dd><span>",sEvntDtTm,"</span></dd>");
}ar.push("</div>");
return ar.join("");
}function SortLinesTubesDrainsByDate(a,b){var x=a.LAST_DT_TM;
var y=b.LAST_DT_TM;
return((x<y)?1:((x>y)?-1:0));
}function GetDateFormatter(){if(m_df==null){m_df=new mp_formatter.DateTimeFormatter(MPAGE_LOCALE);
}return m_df;
}function calculatePrecision(valRes){var precision=0;
var decLoc=valRes.search(/\.(\d)/);
if(decLoc!==-1){var strSize=valRes.length;
precision=strSize-decLoc-1;
}return precision;
}function GetHeadsUpDateDisplay(component,resultDate){var dateTime=new Date();
dateTime.setISO8601(resultDate);
var sEvntDtTm=MP_Util.DisplayDateByOption(component,dateTime);
return sEvntDtTm;
}function GetHoverDateDisplay(resultDate){var df=GetDateFormatter();
return df.formatISO8601(resultDate,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_4YEAR);
}function GetEventViewer(patient_id,encntr_id,eventAr,docViewerType){var m_dPersonId=parseFloat(patient_id);
var m_dEncntrId=parseFloat(encntr_id);
var m_dEventId=0;
var viewerObj=window.external.DiscernObjectFactory("PVVIEWERMPAGE");
viewerObj.CreateEventViewer(m_dPersonId);
for(var t=0;
t<eventAr.length;
t++){m_dEventId=parseFloat(eventAr[t]);
viewerObj.AppendEvent(m_dEventId);
}viewerObj.LaunchEventViewer();
}function rowSel(row){if(Util.Style.ccss(row,"ld-row-selected")){Util.Style.rcss(row,"ld-row-selected");
}else{Util.Style.acss(row,"ld-row-selected");
}}}();
function MedicationsComponentStyle(){this.initByNamespace("med");
}MedicationsComponentStyle.inherits(ComponentStyle);
function MedicationsComponent(criterion){this.setCriterion(criterion);
this.setStyles(new MedicationsComponentStyle());
this.setComponentLoadTimerName("USR:MPG.MEDS.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.MEDS.O1 - render component");
this.m_prnLookback=0;
this.setIncludeLineNumber(false);
this.setScope(2);
this.m_scheduled=false;
this.m_continuous=false;
this.m_prn=false;
this.m_admin=false;
this.m_susp=false;
this.m_discont=false;
this.m_scheduledSort=0;
this.m_prnAdminSort=0;
this.m_prnUnschedAvailSort=0;
this.m_continuousSort=0;
this.m_faceUpDtSched=false;
this.m_faceUpDtPRN=false;
this.m_lookBkHrsForAdm=24;
this.m_lookBkHrsForDisCont=24;
this.m_schedLookAhead=0;
MedicationsComponent.method("InsertData",function(){CERN_MEDS_O1.GetMedicationData(this);
});
MedicationsComponent.method("setPRNLookbackDays",function(value){this.m_prnLookback=value;
});
MedicationsComponent.method("getPRNLookbackDays",function(){return(this.m_prnLookback);
});
MedicationsComponent.method("setScheduled",function(value){this.m_scheduled=value;
});
MedicationsComponent.method("isScheduled",function(){return this.m_scheduled;
});
MedicationsComponent.method("setContinuous",function(value){this.m_continuous=value;
});
MedicationsComponent.method("isContinuous",function(){return(this.m_continuous);
});
MedicationsComponent.method("setPRN",function(value){this.m_prn=value;
});
MedicationsComponent.method("isPRN",function(){return(this.m_prn);
});
MedicationsComponent.method("setAdministered",function(value){this.m_admin=value;
});
MedicationsComponent.method("isAdministered",function(){return this.m_admin;
});
MedicationsComponent.method("setSuspended",function(value){this.m_susp=value;
});
MedicationsComponent.method("isSuspended",function(){return this.m_susp;
});
MedicationsComponent.method("setDiscontinued",function(value){this.m_discont=value;
});
MedicationsComponent.method("isDiscontinued",function(){return this.m_discont;
});
MedicationsComponent.method("setAdministeredLookBkHrs",function(value){this.m_lookBkHrsForAdm=value;
});
MedicationsComponent.method("getAdministeredLookBkHrs",function(){return this.m_lookBkHrsForAdm;
});
MedicationsComponent.method("setDiscontinuedLookBkHr",function(value){this.m_lookBkHrsForDisCont=value;
});
MedicationsComponent.method("getDiscontinuedLookBkHr",function(){return this.m_lookBkHrsForDisCont;
});
MedicationsComponent.method("setSchedLookaheadHrs",function(value){this.m_schedLookAhead=value;
});
MedicationsComponent.method("getSchedLookaheadHrs",function(){return(this.m_schedLookAhead);
});
MedicationsComponent.method("setScheduledSort",function(value){this.m_scheduledSort=value;
});
MedicationsComponent.method("getScheduledSort",function(){return(this.m_scheduledSort);
});
MedicationsComponent.method("setPRNAdminSort",function(value){this.m_prnAdminSort=value;
});
MedicationsComponent.method("getPRNAdminSort",function(){return(this.m_prnAdminSort);
});
MedicationsComponent.method("setPRNUnschedAvailSort",function(value){this.m_prnUnschedAvailSort=value;
});
MedicationsComponent.method("getPRNUnschedAvailSort",function(){return(this.m_prnUnschedAvailSort);
});
MedicationsComponent.method("setContinuousSort",function(value){this.m_continuousSort=value;
});
MedicationsComponent.method("getContinuousSort",function(){return(this.m_continuousSort);
});
MedicationsComponent.method("setDisplayScheduleFaceUpDt",function(value){this.m_faceUpDtSched=value;
});
MedicationsComponent.method("getDisplayScheduleFaceUpDt",function(){return(this.m_faceUpDtSched);
});
MedicationsComponent.method("setDisplayPRNFaceUpDt",function(value){this.m_faceUpDtPRN=value;
});
MedicationsComponent.method("getDisplayPRNFaceUpDt",function(){return(this.m_faceUpDtPRN);
});
MedicationsComponent.method("openTab",function(){var criterion=this.getCriterion();
var sParms="/PERSONID="+criterion.person_id+" /ENCNTRID="+criterion.encntr_id+" /FIRSTTAB=^"+this.getLink()+"+^";
APPLINK(0,criterion.executable,sParms);
this.InsertData();
});
CERN_EventListener.addListener(this,EventListener.EVENT_ORDER_ACTION,this.InsertData,this);
}MedicationsComponent.inherits(MPageComponent);
var CERN_MEDS_O1=function(){return{GetMedicationData:function(component){var mgr=new MP_Core.XMLCCLRequestThreadManager(CERN_MEDS_O1.RenderReply,component,true);
var criterion=component.getCriterion();
var medsProgramName="MP_GET_ORDERS";
var sendAr=null;
var request=null;
var thread=null;
if(component.isScheduled()||component.isContinuous()||component.isPRN()){sendAr=[];
sendAr.push("^MINE^",criterion.person_id+".0",criterion.encntr_id+".0",criterion.provider_id+".0",0,47,57,0,1,0,0,0,0,2);
sendAr.push("0,0",criterion.ppr_cd+".0");
request=new MP_Core.ScriptRequest(component,"ENG:MPG.MEDS.O1 - load sch, cont, prn data");
request.setProgramName(medsProgramName);
request.setParameters(sendAr);
request.setAsync(true);
thread=new MP_Core.XMLCCLRequestThread("GetMostMedData",component,request);
mgr.addThread(thread);
}if(component.isAdministered()){sendAr=[];
sendAr.push("^MINE^",criterion.person_id+".0",criterion.encntr_id+".0",criterion.provider_id+".0",component.getAdministeredLookBkHrs(),8191,57,0,1,0,0,0,0,2);
sendAr.push("0,0",criterion.ppr_cd+".0");
request=new MP_Core.ScriptRequest(component,"ENG:MPG.MEDS.O1 - load administered data");
request.setProgramName(medsProgramName);
request.setParameters(sendAr);
request.setAsync(true);
thread=new MP_Core.XMLCCLRequestThread("GetAdministeredData",component,request);
mgr.addThread(thread);
}if(component.isSuspended()){sendAr=[];
sendAr.push("^MINE^",criterion.person_id+".0",criterion.encntr_id+".0",criterion.provider_id+".0",0,16,57,0,1,4,0,0,0,2);
sendAr.push("0,0",criterion.ppr_cd+".0");
request=new MP_Core.ScriptRequest(component,"ENG:MPG.MEDS.O1 - load suspended data");
request.setProgramName(medsProgramName);
request.setParameters(sendAr);
request.setAsync(true);
thread=new MP_Core.XMLCCLRequestThread("GetSuspendedData",component,request);
mgr.addThread(thread);
}if(component.isDiscontinued()){sendAr=[];
sendAr.push("^MINE^",criterion.person_id+".0",criterion.encntr_id+".0",criterion.provider_id+".0",component.getDiscontinuedLookBkHr(),192,57,0,1,4,0,0,0,1);
sendAr.push("0,0",criterion.ppr_cd+".0");
request=new MP_Core.ScriptRequest(component,"ENG:MPG.MEDS.O1 - load discontinued data");
request.setProgramName(medsProgramName);
request.setParameters(sendAr);
request.setAsync(true);
thread=new MP_Core.XMLCCLRequestThread("GetDiscontinuedData",component,request);
mgr.addThread(thread);
}mgr.begin();
},RenderReply:function(replyAr,component){var timerRenderComponent=MP_Util.CreateTimer(component.getComponentRenderTimerName());
try{var medsI18n=i18n.discernabu.medications_o1;
var df=new mp_formatter.DateTimeFormatter(MPAGE_LOCALE);
var dateTime=new Date();
var sHTML="",countText="",jsHTML=[];
var codeAr=[];
var prsnlAr=[];
var jsScheduled=[];
var jsContinous=[];
var jsPRNAdmin=[];
var jsPRNUnschedAvail=[];
var jsAdministered=[];
var jsSuspended=[];
var jsDiscontinued=[];
var prnLast48Orders=[];
var prnCount=0;
var prnUnschedAvailCount=0;
var continousCount=0;
var scheduledCount=0;
var AdministeredCount=0;
var SuspendedCount=0;
var DiscontinuedCount=0;
var prnRejCount=0;
var prnUnschedAvailRejCount=0;
var continousRejCount=0;
var scheduledRejCount=0;
var AdministeredRejCount=0;
var SuspendedRejCount=0;
var DiscontinuedRejCount=0;
var strRejMedClass="";
for(var x=replyAr.length;
x--;
){var reply=replyAr[x];
if(reply.getStatus()=="S"){switch(reply.getName()){case"GetMostMedData":var recordData=reply.getResponse();
var codeArray=MP_Util.LoadCodeListJSON(recordData.CODES);
var personnelArray=MP_Util.LoadPersonelListJSON(recordData.PRSNL);
recordData.ORDERS.sort(SortByMedicationName);
var prnLookbackDays=component.getPRNLookbackDays();
var prnLookbackDate=new Date();
var hrs=prnLookbackDate.getHours()-(24*prnLookbackDays);
prnLookbackDate.setHours(hrs);
var schedLookaheadHrs=component.getSchedLookaheadHrs();
var schedLookaheadDate=new Date();
var schedHrs=schedLookaheadDate.getHours()+schedLookaheadHrs;
schedLookaheadDate.setHours(schedHrs);
var orderPrnAdmin=[];
var orderScheduled=[];
var orderPRNUnschedAvail=[];
var orderContinuous=[];
for(var y=0,yl=recordData.ORDERS.length;
y<yl;
y++){dateTime=new Date();
var order=recordData.ORDERS[y];
var orderStatus=MP_Util.GetValueFromArray(order.CORE.STATUS_CD,codeArray);
if(orderStatus){var item=null;
switch(orderStatus.meaning){case"ORDERED":case"INPROCESS":case"FUTURE":case"INCOMPLETE":case"MEDSTUDENT":if(order.SCHEDULE.PRN_IND==1||order.SCHEDULE.FREQUENCY.UNSCHEDULED_IND==1){if(prnLookbackDays>0){var sDate=GetHeadsUpMedicationDate(order);
if(sDate!=""){dateTime.setISO8601(sDate);
if(dateTime>=prnLookbackDate){orderPrnAdmin.push(order);
if(order.CORE.REJECTED_IND==1){prnRejCount++;
}prnCount++;
}orderPRNUnschedAvail.push(order);
if(order.CORE.REJECTED_IND==1){prnUnschedAvailRejCount++;
}prnUnschedAvailCount++;
}else{orderPRNUnschedAvail.push(order);
if(order.CORE.REJECTED_IND==1){prnUnschedAvailRejCount++;
}prnUnschedAvailCount++;
}}else{orderPRNUnschedAvail.push(order);
if(order.CORE.REJECTED_IND==1){prnUnschedAvailRejCount++;
}prnUnschedAvailCount++;
}}else{if(order.SCHEDULE.CONSTANT_IND==1){orderContinuous.push(order);
if(order.CORE.REJECTED_IND==1){continousRejCount++;
}continousCount++;
}else{if(order.SCHEDULE.SUSPENDED_DT_TM==""){if(schedLookaheadHrs>0){var sDate=GetHeadsUpMedicationDate(order);
if(sDate!=""){dateTime.setISO8601(sDate);
if(dateTime<=schedLookaheadDate){orderScheduled.push(order);
if(order.CORE.REJECTED_IND==1){scheduledRejCount++;
}scheduledCount++;
}}}else{orderScheduled.push(order);
if(order.CORE.REJECTED_IND==1){scheduledRejCount++;
}scheduledCount++;
}}}}break;
}}}var prnSort=component.getPRNAdminSort();
SortMedications(orderPrnAdmin,prnSort);
jsPRNAdmin=CreateMedicationItemFromArray(orderPrnAdmin,codeArray,personnelArray,true);
var schedSort=component.getScheduledSort();
var critFlag=(schedSort===CERN_MEDS_O1.NextDoseDateTime)?true:false;
SortMedications(orderScheduled,schedSort);
jsScheduled=CreateMedicationItemFromArray(orderScheduled,codeArray,personnelArray,component.getDisplayScheduleFaceUpDt(),critFlag);
var prnUnschedAvailSort=component.getPRNUnschedAvailSort();
SortMedications(orderPRNUnschedAvail,prnUnschedAvailSort);
jsPRNUnschedAvail=CreateMedicationItemFromArray(orderPRNUnschedAvail,codeArray,personnelArray,component.getDisplayPRNFaceUpDt());
var continuousSort=component.getContinuousSort();
SortMedications(orderContinuous,continuousSort);
jsContinous=CreateMedicationItemFromArray(orderContinuous,codeArray,personnelArray);
break;
case"GetAdministeredData":var adminLookback=new Date();
adminLookback.setHours(adminLookback.getHours()-component.getAdministeredLookBkHrs());
var recordData=reply.getResponse();
var codeArray=MP_Util.LoadCodeListJSON(recordData.CODES);
var personnelArray=MP_Util.LoadPersonelListJSON(recordData.PRSNL);
recordData.ORDERS.sort(SortByMedicationName);
for(var z=0,zl=recordData.ORDERS.length;
z<zl;
z++){var order=recordData.ORDERS[z];
if(order.DETAILS.LAST_DOSE_DT_TM!=""){dateTime=new Date();
dateTime.setISO8601(order.DETAILS.LAST_DOSE_DT_TM);
if(dateTime>=adminLookback){jsAdministered.push(CreateMedicationItem(order,codeArray,personnelArray));
if(order.CORE.REJECTED_IND==1){AdministeredRejCount++;
}AdministeredCount++;
}}}break;
case"GetSuspendedData":var recordData=reply.getResponse();
var codeArray=MP_Util.LoadCodeListJSON(recordData.CODES);
var personnelArray=MP_Util.LoadPersonelListJSON(recordData.PRSNL);
recordData.ORDERS.sort(SortByMedicationName);
for(var z=0,zl=recordData.ORDERS.length;
z<zl;
z++){var order=recordData.ORDERS[z];
var item=CreateMedicationItem(order,codeArray,personnelArray);
jsSuspended.push(item);
if(order.CORE.REJECTED_IND==1){SuspendedRejCount++;
}SuspendedCount++;
}break;
case"GetDiscontinuedData":var recordData=reply.getResponse();
var codeArray=MP_Util.LoadCodeListJSON(recordData.CODES);
var personnelArray=MP_Util.LoadPersonelListJSON(recordData.PRSNL);
recordData.ORDERS.sort(SortByMedicationName);
for(var z=0,zl=recordData.ORDERS.length;
z<zl;
z++){var order=recordData.ORDERS[z];
var item=CreateMedicationItem(order,codeArray,personnelArray);
jsDiscontinued.push(item);
if(order.CORE.REJECTED_IND==1){DiscontinuedRejCount++;
}DiscontinuedCount++;
}break;
}}}if(component.isScheduled()){var lookFwdText="";
if(schedLookaheadHrs>0){lookFwdText=" "+medsI18n.NEXT_N_HOURS.replace("{0}",component.getSchedLookaheadHrs());
}jsHTML.push("<div class='sub-sec'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl' title='",medsI18n.HIDE_SECTION,"'>-</span><span class='sub-sec-title'>",medsI18n.SCHEDULED," (",scheduledCount,")",lookFwdText," </span></h3>");
if((schedLookaheadHrs>0)&&(scheduledCount>0)&&(component.getDisplayScheduleFaceUpDt())){strRejMedClass="";
if(scheduledRejCount>0){strRejMedClass="med-has-rej";
}jsHTML.push("<div class='sub-sec-content'><div class='content-hdr'><dl class='med-info-hdr hdr'><dd class='med-name'></dd><dd class='med-date'>",medsI18n.NEXT_DOSE,"</dd></dl></div><div class='content-body ",strRejMedClass," '>",jsScheduled.join(""),"</div></div>");
}else{if(scheduledCount>0){if(scheduledRejCount>0){strRejMedClass="med-has-rej";
}jsHTML.push("<div class='sub-sec-content'><div class='content-body ",strRejMedClass," '>",jsScheduled.join(""),"</div></div>");
}}jsHTML.push("</div>");
}if(component.isContinuous()){jsHTML.push("<div class='sub-sec'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl' title='",medsI18n.HIDE_SECTION,"'>-</span><span class='sub-sec-title'>",medsI18n.CONTINOUS," (",continousCount,")</span></h3>");
if(continousCount>0){strRejMedClass="";
if(continousRejCount>0){strRejMedClass="med-has-rej";
}jsHTML.push("<div class='sub-sec-content'><div class='content-body ",strRejMedClass," '>",jsContinous.join(""),"</div></div>");
}jsHTML.push("</div>");
}if(component.getPRNLookbackDays()>0){jsHTML.push("<div class='sub-sec'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl' title='",medsI18n.HIDE_SECTION,"'>-</span><span class='sub-sec-title'>",medsI18n.PRN,"/",medsI18n.UNSCHEDULED," (",prnCount,")");
jsHTML.push(" ",medsI18n.ADMIN_LAST_N_HOURS.replace("{0}",component.getPRNLookbackDays()*24));
jsHTML.push("</span></h3>");
if(prnCount>0){strRejMedClass="";
if(prnRejCount>0){strRejMedClass="med-has-rej";
}jsHTML.push("<div class='sub-sec-content'><div class='content-hdr'><dl class='med-info-hdr hdr'><dd class='med-name'></dd><dd class='med-date'>",medsI18n.LAST_GIVEN,"</dd></dl></div><div class='content-body ",strRejMedClass," '>",jsPRNAdmin.join(""),"</div></div>");
}jsHTML.push("</div>");
}if(component.isPRN()){jsHTML.push("<div class='sub-sec'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl' title='",medsI18n.HIDE_SECTION,"'>-</span><span class='sub-sec-title'>",medsI18n.PRN_UNSCHEDULED," (",prnUnschedAvailCount,")");
jsHTML.push("</span></h3>");
if(prnUnschedAvailCount>0){strRejMedClass="";
if(prnUnschedAvailRejCount>0){strRejMedClass="med-has-rej";
}if(component.getDisplayPRNFaceUpDt()){jsHTML.push("<div class='sub-sec-content'><div class='content-hdr'><dl class='med-info-hdr hdr'><dd class='med-name'></dd><dd class='med-date'>",medsI18n.LAST_GIVEN,"</dd></dl></div><div class='content-body ",strRejMedClass," '>",jsPRNUnschedAvail.join(""),"</div></div>");
}else{jsHTML.push("<div class='sub-sec-content'><div class='content-body ",strRejMedClass," '>",jsPRNUnschedAvail.join(""),"</div></div>");
}}jsHTML.push("</div>");
}if(component.isAdministered()){jsHTML.push("<div class='sub-sec closed'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl' title='",medsI18n.SHOW_SECTION,"'>-</span><span class='sub-sec-title'>",medsI18n.ADMINISTERED," (",AdministeredCount,")");
if(component.getAdministeredLookBkHrs()>0){jsHTML.push(" ",medsI18n.LAST_N_HOURS.replace("{0}",component.getAdministeredLookBkHrs()));
}jsHTML.push("</span></h3>");
if(AdministeredCount>0){strRejMedClass="";
if(AdministeredRejCount>0){strRejMedClass="med-has-rej";
}jsHTML.push("<div class='sub-sec-content'><div class='content-body ",strRejMedClass," '>",jsAdministered.join(""),"</div></div>");
}jsHTML.push("</div>");
}if(component.isSuspended()){jsHTML.push("<div class='sub-sec'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl' title='",medsI18n.HIDE_SECTION,"'>-</span><span class='sub-sec-title'>",medsI18n.SUSPENDED," (",SuspendedCount,")</span></h3>");
if(SuspendedCount>0){strRejMedClass="";
if(SuspendedRejCount>0){strRejMedClass="med-has-rej";
}jsHTML.push("<div class='sub-sec-content'><div class='content-body ",strRejMedClass," '>",jsSuspended.join(""),"</div></div>");
}jsHTML.push("</div>");
}if(component.isDiscontinued()){jsHTML.push("<div class='sub-sec closed'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl ' title='",medsI18n.SHOW_SECTION,"'>-</span><span class='sub-sec-title'>",medsI18n.DISCONTINUED," (",DiscontinuedCount,")");
if(component.getDiscontinuedLookBkHr()>0){jsHTML.push(" ",medsI18n.LAST_N_HOURS.replace("{0}",component.getDiscontinuedLookBkHr()));
}jsHTML.push("</span></h3>");
if(DiscontinuedCount>0){strRejMedClass="";
if(DiscontinuedRejCount>0){strRejMedClass="med-has-rej";
}jsHTML.push("<div class='sub-sec-content'><div class='content-body ",strRejMedClass," '>",jsDiscontinued.join(""),"</div></div>");
}jsHTML.push("</div>");
}var content=[];
var totalLength=DiscontinuedCount+SuspendedCount+AdministeredCount+prnCount+continousCount+scheduledCount+prnUnschedAvailCount;
content.push("<div class='",MP_Util.GetContentClass(component,totalLength),"'>",jsHTML.join(""),"</div>");
sHTML=content.join("");
countText=MP_Util.CreateTitleText(component,totalLength);
MP_Util.Doc.FinalizeComponent(sHTML,component,countText);
}catch(err){var errMsg=[];
errMsg.push("<b>",medsI18n.JS_ERROR,"</b><br><ul><li>",medsI18n.MESSAGE,": ",err.message,"</li><li>",medsI18n.NAME,": ",err.name,"</li><li>",medsI18n.NUMBER,": ",(err.number&65535),"</li><li>",medsI18n.DESCRIPTION,": ",err.description,"</li></ul>");
MP_Util.Doc.FinalizeComponent(MP_Util.HandleErrorResponse(component.getStyles().getNameSpace(),errMsg.join("")),component,countText);
if(timerRenderComponent){timerRenderComponent.Abort();
timerRenderComponent=null;
}throw (err);
}finally{if(timerRenderComponent){timerRenderComponent.Stop();
}}}};
function CreateMedicationItem(orders,codeAr,prsnlAr,faceUpDateFlag,severityFlag){var item=[];
var medOrigDate="",medHvrOrigDate="",startDate="",origOrderDate="",stopDate="",stopReason="",nextDoseDate="",lastDoesDate="",respProv="";
var currentDate=new Date();
var orderStatus=MP_Util.GetValueFromArray(orders.CORE.STATUS_CD,codeAr);
var medsI18n=i18n.discernabu.medications_o1;
var df=new mp_formatter.DateTimeFormatter(MPAGE_LOCALE);
var fullDateTime4Year=mp_formatter.DateTimeFormatter.FULL_DATE_TIME_4YEAR;
var medName=GetMedicationDisplayName(orders);
var dateTime=new Date();
var sDate=GetHeadsUpMedicationDate(orders);
var sRejIcn="";
var sHvrRej="";
var medIsRej="";
if(orders.CORE.REJECTED_IND==1){sRejIcn="<dd class='med-rejected'>&nbsp;</dd>";
sHvrRej="<dd class='med-det-name'><span class='res-severe'>"+medsI18n.REJECTED_BY_PHARMACY+"</span></dd>";
medIsRej="med-is-rej";
}if(sDate!=""){dateTime.setISO8601(sDate);
medOrigDate=df.formatISO8601(sDate,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_2YEAR);
medHvrOrigDate=df.formatISO8601(sDate,fullDateTime4Year);
}if(orders.SCHEDULE.CURRENT_START_DT_TM!=""){startDate=df.formatISO8601(orders.SCHEDULE.CURRENT_START_DT_TM,fullDateTime4Year);
}if(orders.SCHEDULE.ORIG_ORDER_DT_TM!=""){origOrderDate=df.formatISO8601(orders.SCHEDULE.ORIG_ORDER_DT_TM,fullDateTime4Year);
}if(orders.SCHEDULE.PROJECTED_STOP_DT_TM!=""){stopDate=df.formatISO8601(orders.SCHEDULE.PROJECTED_STOP_DT_TM,fullDateTime4Year);
var reason=MP_Util.GetValueFromArray(orders.SCHEDULE.STOP_TYPE_CD,codeAr);
if(reason!=null){stopReason=reason.display;
}}if(orders.DETAILS.NEXT_DOSE_DT_TM!=""){nextDoseDate=df.formatISO8601(orders.DETAILS.NEXT_DOSE_DT_TM,fullDateTime4Year);
}else{nextDoseDate=medsI18n.NOT_DEFINED;
}if(orders.DETAILS.LAST_DOSE_DT_TM!=""){lastDoesDate=df.formatISO8601(orders.DETAILS.LAST_DOSE_DT_TM,fullDateTime4Year);
}var jsSeverity="";
if(orders.SCHEDULE.PRN_IND==0&&orders.SCHEDULE.CONSTANT_IND==0&&orders.SCHEDULE.SUSPENDED_DT_TM==""){if(orders.DETAILS.NEXT_DOSE_DT_TM!=""){dateTime.setISO8601(orders.DETAILS.NEXT_DOSE_DT_TM);
if(!(dateTime<currentDate)){jsSeverity="res-normal";
}else{if(severityFlag){jsSeverity="res-severe";
}}}}if(orders.CORE.RESPONSIBLE_PROVIDER_ID!=0){var prov=MP_Util.GetValueFromArray(orders.CORE.RESPONSIBLE_PROVIDER_ID,prsnlAr);
respProv=prov.fullName;
}item.push("<h3 class='info-hd'><span>",medName,"</span></h3>");
if(faceUpDateFlag){item.push("<dl class='med-info ",medIsRej," '><dd class= 'med-name'><span class= 'med-rej-ind'>&nbsp;</span><span class='",jsSeverity,"'>",medName,"</span><span class='med-sig detail-line'>",orders.DISPLAYS.SIMPLIFIED_DISPLAY_LINE,"</span></dd><dd class= 'med-date'><span class='",jsSeverity,"'>",medOrigDate,"</span></dd></dl>");
}else{item.push("<dl class='med-info ",medIsRej," '><dd><span class= 'med-rej-ind'>&nbsp;</span><span class='",jsSeverity,"'>",medName,"</span><span class='med-sig detail-line'>",orders.DISPLAYS.SIMPLIFIED_DISPLAY_LINE,"</span></dd></dl>");
}item.push("<h4 class='det-hd'><span>",medsI18n.MED_DETAIL,"</span></h4>","<div class='hvr'><dl class='med-det'>",sRejIcn,sHvrRej,"<dt><span>",medsI18n.MED_NAME,":</span></dt><dd class='med-det-name'><span>",GetMedicationDisplayNameForHover(orders),"</span></dd>");
item.push("<dt><span>",medsI18n.ORDER_DETAILS,":</span></dt><dd class='med-det-dt'><span>",orders.DISPLAYS.CLINICAL_DISPLAY_LINE,"</span></dd>");
item.push("<dt><span>",medsI18n.ORDER_COMMENTS,":</span></dt><dd class='med-det-dt'><span>",orders.COMMENTS.ORDER_COMMENT.replace(/\n/g,"<br />"),"</span></dd>");
if(medName!=""){item.push("<dt><span>",medsI18n.REQUESTED_START,":</span></dt><dd class='med-det-dt'><span>",startDate,"</span></dd>");
}else{item.push("<dt><span>",medsI18n.REQUESTED_START,":</span></dt><dd class='med-det-dt'><span>&nbsp;</span></dd>");
}item.push("<dt><span>",medsI18n.ORIG_DT_TM,":</span></dt><dd class='med-det-dt'><span>",origOrderDate,"</span></dd>");
item.push("<dt><span>",medsI18n.LAST_DOSE_DT_TM,":</span></dt><dd class='med-det-dt'><span>",lastDoesDate,"</span></dd>");
if(!(orders.SCHEDULE.PRN_IND==1||orders.SCHEDULE.FREQUENCY.UNSCHEDULED_IND==1||orders.SCHEDULE.CONSTANT_IND==1||orderStatus.meaning=="DISCONTINUED"||orderStatus.meaning=="CANCELED"||orderStatus.meaning=="SUSPENDED")){item.push("<dt><span>",medsI18n.NEXT_DOSE_DT_TM,":</span></dt><dd class='med-det-dt'><span>",nextDoseDate,"</span></dd>");
}item.push("<dt><span>",medsI18n.STOP_DT_TM,":</span></dt><dd class='med-det-dt'><span>",stopDate,"</span></dd>","<dt><span>",medsI18n.STOP_REASON,":</span></dt><dd class='med-det-dt'><span>",stopReason,"</span></dd>");
item.push("<dt><span>",medsI18n.RESPONSIBLE_PROVIDER,":</span></dt><dd class='med-det-dt'><span>",respProv,"</span></dd>");
item.push("<dt><span>",medsI18n.STATUS,":</span></dt><dd class='med-det-dt'><span>",orderStatus.display,"</span></dd>","<dt><span>",medsI18n.DETAILS,":</span></dt><dd class='med-det-dt'><span>",orders.DISPLAYS.SIMPLIFIED_DISPLAY_LINE,"</span></dd>","</dl></div>");
return(item.join(""));
}function CreateMedicationItemFromArray(ordersArray,codeArray,personnelArray,faceUpDateFlag,severityFlag){var jsMedItem=[];
for(var z=0,zl=ordersArray.length;
z<zl;
z++){jsMedItem.push(CreateMedicationItem(ordersArray[z],codeArray,personnelArray,faceUpDateFlag,severityFlag));
}return jsMedItem;
}function GetHeadsUpMedicationDate(a){if(a.SCHEDULE.PRN_IND==1||a.SCHEDULE.FREQUENCY.UNSCHEDULED_IND==1){return a.DETAILS.LAST_DOSE_DT_TM;
}else{if(a.SCHEDULE.CONSTANT_IND==1){return"";
}else{if(a.SCHEDULE.SUSPENDED_DT_TM==""){return a.DETAILS.NEXT_DOSE_DT_TM;
}else{return"";
}}}}function SortByMedicationName(a,b){var aName=GetMedicationDisplayName(a);
var bName=GetMedicationDisplayName(b);
var aUpper=(aName!=null)?aName.toUpperCase():"";
var bUpper=(bName!=null)?bName.toUpperCase():"";
if(aUpper>bUpper){return 1;
}else{if(aUpper<bUpper){return -1;
}}return 0;
}function SortByLastDose(a,b){if(a.DETAILS.LAST_DOSE_DT_TM>b.DETAILS.LAST_DOSE_DT_TM){return -1;
}else{if(a.DETAILS.LAST_DOSE_DT_TM<b.DETAILS.LAST_DOSE_DT_TM){return 1;
}else{return 0;
}}}function SortByNextDose(a,b){if(a.DETAILS.NEXT_DOSE_DT_TM>b.DETAILS.NEXT_DOSE_DT_TM){return 1;
}else{if(a.DETAILS.NEXT_DOSE_DT_TM<b.DETAILS.NEXT_DOSE_DT_TM){return -1;
}else{return 0;
}}}function GetMedicationDisplayName(order){var medName="";
if(order.DISPLAYS!=null){medName=order.DISPLAYS.CLINICAL_NAME;
if(medName==""){medName=order.DISPLAYS.REFERENCE_NAME;
}if(medName==""){medName=order.DISPLAYS.DEPARTMENT_NAME;
}}return(medName);
}function GetMedicationDisplayNameForHover(order){var medName="";
if(order.DISPLAYS!=null){medName=order.DISPLAYS.REFERENCE_NAME;
if(medName==""){medName=order.DISPLAYS.CLINICAL_NAME;
}else{if(order.DISPLAYS.CLINICAL_NAME!=""&&order.DISPLAYS.CLINICAL_NAME!=medName){medName=medName.concat(" (",order.DISPLAYS.CLINICAL_NAME,")");
}}if(medName==""){medName=order.DISPLAYS.DEPARTMENT_NAME;
}}return(medName);
}function SortMedications(orders,sortType){switch(sortType){case CERN_MEDS_O1.LastDoseDateTime:orders.sort(SortByLastDose);
break;
case CERN_MEDS_O1.NextDoseDateTime:orders.sort(SortByNextDose);
break;
default:orders.sort(SortByMedicationName);
}}}();
CERN_MEDS_O1.LastDoseDateTime=1;
CERN_MEDS_O1.NextDoseDateTime=2;
function MicrobiologyComponentStyle(){this.initByNamespace("mic");
}MicrobiologyComponentStyle.inherits(ComponentStyle);
function MicrobiologyComponent(criterion){this.setCriterion(criterion);
this.setStyles(new MicrobiologyComponentStyle());
this.setComponentLoadTimerName("USR:MPG.MICRO.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.MICRO.O1 - render component");
this.setIncludeLineNumber(true);
MicrobiologyComponent.method("InsertData",function(){CERN_MICROBIOLOGY_O1.GetMicrobiologyTable(this);
});
MicrobiologyComponent.method("HandleSuccess",function(recordData){CERN_MICROBIOLOGY_O1.RenderComponent(this,recordData);
});
}MicrobiologyComponent.inherits(MPageComponent);
var CERN_MICROBIOLOGY_O1=function(){var encntrOption=0;
var lookBackUnits=0;
var lookBackType=0;
function SortByDate(a,b){var sortDateA=(a.SPECIMEN_COLLECTION.COLLECTED_DATE==="")?a.EFFECTIVE_DATE:a.SPECIMEN_COLLECTION.COLLECTED_DATE;
var sortDateB=(b.SPECIMEN_COLLECTION.COLLECTED_DATE==="")?b.EFFECTIVE_DATE:b.SPECIMEN_COLLECTION.COLLECTED_DATE;
if(sortDateA>sortDateB){return -1;
}else{if(sortDateA<sortDateB){return 1;
}}return 0;
}return{GetMicrobiologyTable:function(component){var groups=component.getGroups();
var events=(groups&&groups.length>0)?groups[0].getEventSets():null;
var sEvents=MP_Util.CreateParamArray(events,1);
var criterion=component.getCriterion();
encntrOption=(component.getScope()===1)?"0.0":(criterion.encntr_id+".0");
lookBackUnits=(component.getLookbackUnits()!==null)?component.getLookbackUnits():"0";
lookBackType=(component.getLookbackUnitTypeFlag()!==null)?component.getLookbackUnitTypeFlag():"0";
var sendAr=["^MINE^",criterion.person_id+".0",encntrOption,criterion.provider_id+".0",lookBackUnits,sEvents,criterion.position_cd+".0",criterion.ppr_cd+".0",lookBackType];
MP_Core.XMLCclRequestWrapper(component,"mp_get_micro_results_json",sendAr,true);
},RenderComponent:function(component,recordData){var micI18n=i18n.discernabu.microbiology_o1;
var jsHTML=[];
var codeArray=MP_Util.LoadCodeListJSON(recordData.CODES);
var jsMicHTML=[];
var micObj=recordData.MICRO_CULTURE;
micObj.sort(SortByDate);
var micNum=micObj.length;
var dtFormat=component.getDateFormat();
var compNS=component.getStyles().getNameSpace();
jsMicHTML.push("<div class='mic-info-hdr  hdr'><dl class='mic-info-hdr'><dd class='mic-rep-hd'><span>",micI18n.REPORT,"</span></dd><dd class='mic-status-hd'><span>",micI18n.STATUS,"</span></dd><dd class='mic-growth-hd'><span>",micI18n.GROWTH,"</span></dd><dd class='mic-no-sc'><span>",micI18n.SUSC_HEADER,"</span></dd><dd class='mic-within-hd'><span>",micI18n.COLLECTED);
if(component.getDateFormat()===3){jsMicHTML.push("<br/>",micI18n.WITHIN,"</span></dd></dl></div>");
}else{jsMicHTML.push("</span></dd></dl></div>");
}jsMicHTML.push("<div class='",MP_Util.GetContentClass(component,micNum),"'>");
for(var i=0;
i<micNum;
i++){var sRepStatus="",sSusceptibility="",sSusceptibilityClass="mic-no-sc",sRepDisp="",isGrowth="",growthIndClass="",orgList="",site="",source="",sourceSite="",resultDtTm=new Date();
if(micObj[i].SPECIMEN_COLLECTION.COLLECTED_DATE&&micObj[i].SPECIMEN_COLLECTION.COLLECTED_DATE!==""){resultDtTm.setISO8601(micObj[i].SPECIMEN_COLLECTION.COLLECTED_DATE);
}else{resultDtTm.setISO8601(micObj[i].EFFECTIVE_DATE);
}var resultDtTmDisp=MP_Util.DisplayDateByOption(component,resultDtTm);
sRepDisp=(micObj[i].EVENT_SET_CD>0)?MP_Util.GetValueFromArray(micObj[i].EVENT_SET_CD,codeArray).display:"--";
sRepStatus=(micObj[i].EVENT_STATUS_CD>0)?MP_Util.GetValueFromArray(micObj[i].EVENT_STATUS_CD,codeArray).display:"--";
if(micObj[i].MICRO_CLASS_IND===1){source=(micObj[i].SPECIMEN_COLLECTION.SOURCE_CD>0)?MP_Util.GetValueFromArray(micObj[i].SPECIMEN_COLLECTION.SOURCE_CD,codeArray).display:"";
site=(micObj[i].SPECIMEN_COLLECTION.BODY_SITE_CD>0)?MP_Util.GetValueFromArray(micObj[i].SPECIMEN_COLLECTION.BODY_SITE_CD,codeArray).display:"";
if((site&&site!=="")&&(source&&source!=="")){sourceSite=source+" / "+site;
}else{if(site&&site!==""){sourceSite=site;
}else{if(source&&source!==""){sourceSite=source;
}}}if(micObj[i].SUSCEPTIBILITY_IND===1){sSusceptibilityClass="mic-sc";
sSusceptibility=micI18n.DONE;
}else{sSusceptibilityClass="mic-no-sc";
sSusceptibility=micI18n.NOT_DONE;
}if(micObj[i].ORDERS[0]&&micObj[i].ORDERS[0].DEPT_STATUS_CD>0){sRepStatus=MP_Util.GetValueFromArray(micObj[i].ORDERS[0].DEPT_STATUS_CD,codeArray).display;
}if(micObj[i].SPECIMEN_COLLECTION.MICROBIOLOGY_INTERPRETATION_CD>0){var micInterp=MP_Util.GetValueFromArray(micObj[i].SPECIMEN_COLLECTION.MICROBIOLOGY_INTERPRETATION_CD,codeArray);
isGrowth=micInterp.display;
if(micInterp.meaning==="POSITIVE"){growthIndClass="res-severe";
}}var organism={};
var orgArr=[];
var isoObj=micObj[i].ISOLATE_WORKUPS;
for(var orgIdx=0;
orgIdx<isoObj.length;
orgIdx++){if(isoObj[orgIdx].ORGANISM_CD>0){organism=MP_Util.GetValueFromArray(isoObj[orgIdx].ORGANISM_CD,codeArray);
orgArr.push(organism.display);
}}orgList=orgArr.join(", ");
}jsMicHTML.push("<h3 class='info-hd'><span>",micI18n.MICRO,"</span></h3>","<dl class='mic-info'>","<dt><span>",micI18n.MICRO,":</span></dt>","<dd class='mic-report'><span>",MP_Util.CreateClinNoteLink(micObj[i].PERSON_ID+".0",micObj[i].ENCNTR_ID+".0",micObj[i].EVENT_ID+".0",sRepDisp,micObj[i].VIEWER_TYPE,micObj[i].PARENT_EVENT_ID+".0"),"</span>");
if(MP_Util.GetValueFromArray(micObj[i].EVENT_STATUS_CD,codeArray).meaning=="MODIFIED"||MP_Util.GetValueFromArray(micObj[i].EVENT_STATUS_CD,codeArray).meaning=="ALTERED"){jsMicHTML.push("<span class='res-modified'>&nbsp;</span>");
}jsMicHTML.push("</dd><dd class='mic-status'><span>",sRepStatus,"</span></dd><dd class='mic-growth'><span class='",growthIndClass,"'>",isGrowth,"</span></dd><dd class='",sSusceptibilityClass,"'><span>&nbsp;</span></dd><dd class='mic-within'><span class='date-time'>",resultDtTmDisp,"</span></dd></dl>","<h4 class='det-hd'><span>",micI18n.MICRO_DETAILS,"</span></h4>","<div class='hvr'><dl class = 'mic-det'>","<dt><span>",micI18n.SOURCE_SITE,":</span></dt><dd><span>",sourceSite,"</span></dd>","<dt><span>",micI18n.ORGANISMS,":</span></dt><dd><span>",orgList,"</span></dd>","<dt><span>",micI18n.SUSCEPTIBILITY,":</span></dt><dd><span>",sSusceptibility,"</span></dd>","<dt><span>",micI18n.COLLECTED_DATE_TIME,":</span></dt><dd><span>",resultDtTm.format("longDateTime3"),"</span></dd></dl></div>");
}jsMicHTML.push("</div>");
sHTML=jsMicHTML.join("");
countText=MP_Util.CreateTitleText(component,micNum);
MP_Util.Doc.FinalizeComponent(sHTML,component,countText);
if(component.isScrollingEnabled()&&(micNum>=component.getScrollNumber())){var xNode=Util.Style.g(compNS+"-info-hdr",document.body,"DL");
if(xNode[0]){Util.Style.acss(xNode[0],"hdr-scroll");
}}}};
}();
function OrdersComponentStyle(){this.initByNamespace("ord");
}OrdersComponentStyle.inherits(ComponentStyle);
function OrdersComponent(criterion){this.setCriterion(criterion);
this.setStyles(new OrdersComponentStyle());
this.setComponentLoadTimerName("USR:MPG.ORDERS.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.ORDERS.O1 - render component");
this.setIncludeLineNumber(true);
OrdersComponent.method("InsertData",function(){CERN_ORDERS_O1.GetOrdersTable(this);
});
OrdersComponent.method("HandleSuccess",function(recordData){CERN_ORDERS_O1.RenderComponent(this,recordData);
});
OrdersComponent.method("setCatalogCodes",function(value){this.m_catalogCodes=value;
});
OrdersComponent.method("addCatalogCode",function(value){if(this.m_catalogCodes==null){this.m_catalogCodes=[];
}this.m_catalogCodes.push(value);
});
OrdersComponent.method("getCatalogCodes",function(){return this.m_catalogCodes;
});
OrdersComponent.method("setOrderStatuses",function(value){this.m_orderStatuses=value;
});
OrdersComponent.method("addOrderStatus",function(value){if(this.m_orderStatuses==null){this.m_orderStatuses=[];
}this.m_orderStatuses.push(value);
});
OrdersComponent.method("getOrderStatuses",function(){return this.m_orderStatuses;
});
CERN_EventListener.addListener(this,EventListener.EVENT_ORDER_ACTION,this.InsertData,this);
}OrdersComponent.inherits(MPageComponent);
var CERN_ORDERS_O1=function(){return{GetOrdersTable:function(component){var sendAr=[];
var criterion=component.getCriterion();
var encntrOption=(component.getScope()==2)?(criterion.encntr_id+".0"):"0.0";
sendAr.push("^MINE^",criterion.person_id+".0",encntrOption,criterion.provider_id+".0",component.getLookbackUnits(),129,63,2,0,1,0,0);
var codes=component.getCatalogCodes();
var catType=(codes!=null&&codes.length>0)?"value("+codes.join(",")+")":"0.0";
sendAr.push(catType);
sendAr.push(component.getLookbackUnitTypeFlag());
var statuses=component.getOrderStatuses();
var ordStatuses=(statuses!=null&&statuses.length>0)?"value("+statuses.join(",")+")":"0.0";
sendAr.push(ordStatuses);
sendAr.push("0",criterion.ppr_cd+".0");
MP_Core.XMLCclRequestWrapper(component,"MP_GET_ORDERS",sendAr,true);
},RenderComponent:function(component,recordData){var timerRenderComponent=MP_Util.CreateTimer(component.getComponentRenderTimerName());
try{var ordHTML="",countText="",blank="";
var ordArray=[];
var codeArray=MP_Util.LoadCodeListJSON(recordData.CODES);
var personnelArray=[];
personnelArray=MP_Util.LoadPersonelListJSON(recordData.PRSNL);
var compNS=component.getStyles().getNameSpace();
var ord_i18n=i18n.discernabu.orders_o1;
ordArray.push("<div class='content-hdr'><dl class='",compNS,"-info-hdr hdr'>");
ordArray.push("<dt class='",compNS,"-nm-hd'><span>",blank,"</span></dt><dt class='",compNS,"-st-hd'><span>",ord_i18n.STATUS,"</span></dt><dt class='",compNS,"-dt-hd'><span>",ord_i18n.ORDERED,"</span></dt></dl></div>");
recordData.ORDERS.sort(OrderDateSort);
var orderLen=recordData.ORDERS.length;
ordArray.push("<div class ='",MP_Util.GetContentClass(component,orderLen),"'>");
for(var j=0;
j<orderLen;
j++){var orders=recordData.ORDERS[j];
var ordName="";
var ordDateTime="";
var strtDateTime="";
var statusTypeDisp="";
var orderDetails="";
var orderComments=orders.COMMENTS.ORDER_COMMENT;
orderComments=orderComments.replace(/\n/g,"<br />");
var ordLongDateTime="";
var strtLongDateTime="";
var responProvider="";
var dateTime=new Date();
if(orders.SCHEDULE!=""){dateTime.setISO8601(orders.SCHEDULE.ORIG_ORDER_DT_TM);
ordDateTime=dateTime.format("longDateTime2");
ordLongDateTime=dateTime.format("longDateTime3");
}if(orders.SCHEDULE!=""){dateTime.setISO8601(orders.SCHEDULE.CURRENT_START_DT_TM);
strtDateTime=dateTime.format("longDateTime2");
strtLongDateTime=dateTime.format("longDateTime3");
}if(orders.CORE!=""){if(orders.CORE.STATUS_CD>0){var statusTypeObj=MP_Util.GetValueFromArray(orders.CORE.STATUS_CD,codeArray);
statusTypeDisp=statusTypeObj.display;
}else{statusTypeDisp="";
}if(orders.CORE.RESPONSIBLE_PROVIDER_ID>0){var prsnlObj=MP_Util.GetValueFromArray(orders.CORE.RESPONSIBLE_PROVIDER_ID,personnelArray);
responProvider=prsnlObj.fullName;
}else{responProvider="";
}}if(orders.DISPLAYS!=""){ordName=orders.DISPLAYS.CLINICAL_NAME;
if(ordName==""){ordName=orders.DISPLAYS.REFERENCE_NAME;
}if(ordName==""){ordName=orders.DISPLAYS.DEPARTMENT_NAME;
}}var odetails=orders.DISPLAYS.CLINICAL_DISPLAY_LINE;
ordArray.push("<dl class='ord-info'><dd class= 'ord-name'><span>",ordName,"</span></dd><dd class= 'ord-status'><span>",statusTypeDisp,"</span></dd><dd class= 'ord-date'><span class='date-time'>",ordDateTime,"</span></dd></dl><h4 class='det-hd'><span>","</span></h4><div class='hvr'><dl class='ord-det'><dt><span>",ord_i18n.ORDER_NAME,":</span></dt><dd><span>",ordName,"</span></dd><dt><span>",ord_i18n.ORDER_DETAILS,":</span></dt><dd><span>",odetails,"</span></dd><dt><span>",ord_i18n.ORDER_COMMENTS,":</span></dt><dd><span>",orderComments,"</span></dd><dt><span>",ord_i18n.ORDER_DATE,":</span></dt><dd><span>",ordLongDateTime,"</span></dd><dt><span>",ord_i18n.START_DT_TM,":</span></dt><dd><span>",strtLongDateTime,"</span></dd>   <dt><span>",ord_i18n.ORDER_STATUS,":</span></dt><dd><span>",statusTypeDisp,"</span></dd><dt><span>",ord_i18n.ORDER_PHYS,":</span></dt><dd><span>",responProvider,"</span></dd></dl></div>");
}ordHTML=ordArray.join("");
countText=MP_Util.CreateTitleText(component,orderLen);
MP_Util.Doc.FinalizeComponent(ordHTML,component,countText);
}catch(err){if(timerRenderComponent){timerRenderComponent.Abort();
timerRenderComponent=null;
}throw (err);
}finally{if(timerRenderComponent){timerRenderComponent.Stop();
}}}};
function OrderDateSort(a,b){if(a.SCHEDULE.ORIG_ORDER_DT_TM>b.SCHEDULE.ORIG_ORDER_DT_TM){return -1;
}else{if(a.SCHEDULE.ORIG_ORDER_DT_TM<b.SCHEDULE.ORIG_ORDER_DT_TM){return 1;
}else{return 0;
}}}}();
function PastMedicalHistoryComponentStyle(){this.initByNamespace("pmh");
}PastMedicalHistoryComponentStyle.inherits(ComponentStyle);
function PastMedicalHistoryComponent(criterion){this.setCriterion(criterion);
this.setStyles(new PastMedicalHistoryComponentStyle());
this.setComponentLoadTimerName("USR:MPG.PASTMEDICALHISTORY.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.PASTMEDICALHISTORY.O1 - render component");
this.setScope(1);
this.setIncludeLineNumber(true);
PastMedicalHistoryComponent.method("HandleSuccess",function(recordData){CERN_PMH_O1.RenderComponent(this,recordData);
});
PastMedicalHistoryComponent.method("InsertData",function(){CERN_PMH_O1.GetPastMedicalHistory(this);
});
}PastMedicalHistoryComponent.inherits(MPageComponent);
var CERN_PMH_O1=function(){return{GetPastMedicalHistory:function(component){var sendAr=[];
var program="mp_get_past_med_data";
var criterion=component.getCriterion();
sendAr.push("^MINE^",criterion.person_id+".0",criterion.provider_id+".0",criterion.ppr_cd+".0");
MP_Core.XMLCclRequestWrapper(component,program,sendAr,true);
return;
},RenderComponent:function(component,recordData){var timerRenderComponent=MP_Util.CreateTimer(component.getComponentRenderTimerName());
try{var countText="";
var jsonEval=recordData;
var pmhhtml="";
var onsetDate;
var resDate;
var pmhArray=[];
var pmhProb=[];
var commentDt=null;
var commentStr="";
var author="";
var pmhLen=jsonEval.PASTMED_CNT;
var df=new mp_formatter.DateTimeFormatter(MPAGE_LOCALE);
var pmh_i18n=i18n.discernabu.past_medical_history_o1;
var dateTime=new Date();
for(var j=0;
j<pmhLen;
j++){pmhProb.push(jsonEval.PASTMED[j]);
}pmhProb.sort(SortByProblemName);
for(var i=0;
i<pmhLen;
i++){var problem=pmhProb[i];
onsetDate="";
if(problem.ONSET_DATE_UTC!=""){var onsetDt=problem.ONSET_DATE_UTC;
dateTime.setISO8601(onsetDt);
if(problem.ONSET_DATE_FLAG==0){onsetDate=df.format(dateTime,mp_formatter.DateTimeFormatter.FULL_DATE_4YEAR);
}else{if(problem.ONSET_DATE_FLAG==1){onsetDate=df.format(dateTime,mp_formatter.DateTimeFormatter.FULL_MONTH_4YEAR_NO_DATE);
}else{if(problem.ONSET_DATE_FLAG==2){onsetDate=df.format(dateTime,mp_formatter.DateTimeFormatter.FULL_4YEAR);
}}}}resDate="";
if(problem.RES_DATE_UTC!=""){var resDt=problem.RES_DATE_UTC;
dateTime.setISO8601(resDt);
if(problem.RES_DATE_FLAG==0){resDate=df.format(dateTime,mp_formatter.DateTimeFormatter.FULL_DATE_4YEAR);
}else{if(problem.RES_DATE_FLAG==1){resDate=df.format(dateTime,mp_formatter.DateTimeFormatter.FULL_MONTH_4YEAR_NO_DATE);
}else{if(problem.RES_DATE_FLAG==2){resDate=df.format(dateTime,mp_formatter.DateTimeFormatter.FULL_4YEAR);
}}}}var comObj=problem.COMMENT;
commentStr="";
author="";
for(var c=0;
c<comObj.length;
c++){commentDt="";
var comment=comObj[c];
if(comment.DATE!=""){var comDt=comment.DATE;
dateTime.setISO8601(comDt);
commentDt=df.format(dateTime,mp_formatter.DateTimeFormatter.FULL_DATE_4YEAR);
}author=comment.AUTHOR;
commentStr+=commentDt+" - "+author+"<br/>"+comment.COMMENT+"<br/>";
}pmhArray.push("<dl class='pmh-info'><dt class='det-hd'>",pmh_i18n.PAST_MEDICAL_HISTORY,"</dt><dd class='pmh-name'>");
if(problem.ANNOTATED_DISPLAY){pmhArray.push(problem.ANNOTATED_DISPLAY,"</dd>");
}else{pmhArray.push(problem.NAME,"</dd>");
}if(problem.CODE){pmhArray.push("<dt><span>",pmh_i18n.CODE,"</span></dt><dd class='pmh-code'><span class='code'>(",problem.CODE,")</span></dd>");
}pmhArray.push("</dl><h4 class='det-hd'><span>",pmh_i18n.PAST_MEDICAL_DETAILS,"</span></h4><div class='hvr'><dl class='pmh-det'><dt><span>",pmh_i18n.PAST_PROBLEM,":</span></dt><dd><span>",problem.NAME,"</span></dd><dt><span>",pmh_i18n.ANNOTATED_DISPLAY,":</span></dt><dd><span>",problem.ANNOTATED_DISPLAY,"</span></dd><dt><span>",pmh_i18n.ONSET_DATE,":</span></dt><dd><span>",onsetDate,"</span></dd><dt><span>",pmh_i18n.PAST_RESOLVED_DATE,":</span></dt><dd><span>",resDate,"</span></dd><dt><span>",pmh_i18n.STATUS,":</span></dt><dd><span>",problem.STATUS,"</span></dd><dt><span>",pmh_i18n.COMMENTS,":</span></dt><dd><span>",commentStr,"</span></dd></dl></div>");
}var content=[];
if(pmhLen==null||pmhLen==""){pmhLen=0;
}content.push("<div class ='",MP_Util.GetContentClass(component,pmhLen),"'>",pmhArray.join(""),"</div>");
pmhhtml=content.join("");
countText=MP_Util.CreateTitleText(component,pmhLen);
MP_Util.Doc.FinalizeComponent(pmhhtml,component,countText);
}catch(err){alert("An error has occurred in PMH : "+err.name+" - "+err.message);
if(timerRenderComponent){timerRenderComponent.Abort();
timerRenderComponent=null;
}}finally{if(timerRenderComponent){timerRenderComponent.Stop();
}}}};
function SortByProblemName(a,b){var aName=a.NAME;
var bName=b.NAME;
var aUpper=(aName!=null)?aName.toUpperCase():"";
var bUpper=(bName!=null)?bName.toUpperCase():"";
if(aUpper>bUpper){return 1;
}else{if(aUpper<bUpper){return -1;
}}return 0;
}}();
function PathologyComponentStyle(){this.initByNamespace("path");
}PathologyComponentStyle.inherits(ComponentStyle);
function PathologyComponent(criterion){this.setCriterion(criterion);
this.setStyles(new PathologyComponentStyle());
this.setHoverEnabled(false);
this.setComponentLoadTimerName("USR:MPG.PATHOLOGY.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.PATHOLOGY.O1 - render component");
}PathologyComponent.inherits(DocumentBaseComponent);
function PatientAssessmentComponentStyle(){this.initByNamespace("pta");
}PatientAssessmentComponentStyle.inherits(ComponentStyle);
function PatientAssessmentComponent(criterion){this.setCriterion(criterion);
this.setStyles(new PatientAssessmentComponentStyle());
this.setComponentLoadTimerName("USR:MPG.PATIENTASSESSMENT.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.PATIENTASSESSMENT.O1 - render component");
this.setIncludeLineNumber(true);
this.setScope(2);
this.setResultCount(1);
PatientAssessmentComponent.method("HandleSuccess",function(replyAr,component){CERN_PATIENT_ASSESSMENT_O1.RenderComponent(component,replyAr);
});
}PatientAssessmentComponent.inherits(MeasurementBaseComponent);
var CERN_PATIENT_ASSESSMENT_O1=function(){return{RenderComponent:function(component,replyAr){var timerRenderComponent=MP_Util.CreateTimer(component.getComponentRenderTimerName());
try{var ar=[];
var totalCnt=0;
var groups=component.getGroups();
for(var x=0,xl=groups.length;
x<xl;
x++){var group=groups[x];
for(var y=replyAr.length;
y--;
){var reply=replyAr[y];
if(group.getGroupName()===reply.getName()){totalCnt+=getSubsection(group,reply.getResponse(),ar);
break;
}}}ar.unshift("<div class='",MP_Util.GetContentClass(component,totalCnt),"'>");
ar.push("</div>");
var sHTML=ar.join("");
var countText=MP_Util.CreateTitleText(component,totalCnt);
var compNS=component.getStyles().getNameSpace();
MP_Util.Doc.FinalizeComponent(sHTML,component,countText);
}catch(err){if(timerRenderComponent){timerRenderComponent.Abort();
timerRenderComponent=null;
}throw (err);
}finally{if(timerRenderComponent){timerRenderComponent.Stop();
}}}};
function getSubsection(group,recordData,ar){var sHTML="",countText="";
var measAr=[];
var codeArray=MP_Util.LoadCodeListJSON(recordData.CODES);
var personnelArray=MP_Util.LoadPersonelListJSON(recordData.PRSNL);
var measureArray=CERN_MEASUREMENT_BASE_O1.LoadMeasurementDataArray(recordData,personnelArray,codeArray);
var df=MP_Util.GetDateFormatter();
var measLen=measureArray.length;
for(var x=0;
x<measLen;
x++){var measObject=measureArray[x];
var display=measObject.getEventCode().display;
var oDate=measObject.getDateTime();
var sDate=(oDate)?df.format(oDate,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_2YEAR):"";
measAr.push("<dl class='pta-info'><dt class='pta-disp-lbl'>",display,"</dt><dd class='pta-name'>",display,"</dd><dt class='pta-res-lbl'>",i18n.discernabu.patientassessment_o1.RESULT," </dt><dd class ='pta-res'>");
measAr.push(MP_Util.Measurement.GetNormalcyResultDisplay(measObject));
measAr.push("</dd><dt class='ptadate'>",sDate,"</dt><dd class='pta-dt'><span class='date-time'>",sDate,"</span></dd></dl>");
}ar.push("<div class='sub-sec'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl' title='",i18n.HIDE_SECTION,"'>-</span><span class='sub-sec-title'>",group.getGroupName()," (",measLen,")</span></h3>");
if(measLen>0){ar.push("<div class='sub-sec-content'><div class='content-body'",">",measAr.join(""),"</div></div>");
}ar.push("</div>");
return measLen;
}}();
function PatientBackgroundComponentStyle(){this.initByNamespace("pbg");
}PatientBackgroundComponentStyle.inherits(ComponentStyle);
function PatientBackgroundComponent(criterion){this.setCriterion(criterion);
this.setStyles(new PatientBackgroundComponentStyle());
this.setComponentLoadTimerName("USR:MPG.PATBACKGROUND.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.PATBACKGROUND.O1 - render component");
this.setIncludeLineNumber(false);
this.setScope(2);
this.m_pain=[];
this.m_devices=[];
this.m_diet=[];
this.m_patAct=[];
this.m_resuc=[];
this.m_seizure=[];
this.m_isolation=[];
this.m_advDirectives=[];
this.m_careLevel=[];
this.m_para=[];
this.m_gravida=[];
this.m_fallPrec=[];
PatientBackgroundComponent.method("InsertData",function(){CERN_PATBACKGROUND_O1.GetBackgroundTable(this);
});
PatientBackgroundComponent.method("HandleSuccess",function(recordData){CERN_PATBACKGROUND_O1.RenderComponent(this,recordData);
});
PatientBackgroundComponent.method("getPainScores",function(){return(this.m_pain);
});
PatientBackgroundComponent.method("setPainScores",function(value){this.m_pain=value;
});
PatientBackgroundComponent.method("addPainScore",function(value){if(this.m_pain==null){this.m_pain=[];
}this.m_pain.push(value);
});
PatientBackgroundComponent.method("getDevices",function(){return(this.m_devices);
});
PatientBackgroundComponent.method("setDevices",function(value){this.m_devices=value;
});
PatientBackgroundComponent.method("addDevice",function(value){if(this.m_devices==null){this.m_devices=[];
}this.m_devices.push(value);
});
PatientBackgroundComponent.method("getDietOrders",function(){return(this.m_diet);
});
PatientBackgroundComponent.method("setDietOrders",function(value){this.m_diet=value;
});
PatientBackgroundComponent.method("addDietOrder",function(value){if(this.m_diet==null){this.m_diet=[];
}this.m_diet.push(value);
});
PatientBackgroundComponent.method("getPatientActivityOrders",function(){return(this.m_patAct);
});
PatientBackgroundComponent.method("setPatientActivityOrders",function(value){this.m_patAct=value;
});
PatientBackgroundComponent.method("addPatientActivityOrder",function(value){if(this.m_patAct==null){this.m_patAct=[];
}this.m_patAct.push(value);
});
PatientBackgroundComponent.method("getResucitationOrders",function(){return(this.m_resuc);
});
PatientBackgroundComponent.method("setResucitationOrders",function(value){this.m_resuc=value;
});
PatientBackgroundComponent.method("addResucitationOrder",function(value){if(this.m_resuc==null){this.m_resuc=[];
}this.m_resuc.push(value);
});
PatientBackgroundComponent.method("getSeizureOrders",function(){return(this.m_seizure);
});
PatientBackgroundComponent.method("setSeizureOrders",function(value){this.m_seizure=value;
});
PatientBackgroundComponent.method("addSeizureOrder",function(value){if(this.m_seizure==null){this.m_seizure=[];
}this.m_seizure.push(value);
});
PatientBackgroundComponent.method("getIsolationOrders",function(){return(this.m_isolation);
});
PatientBackgroundComponent.method("setIsolationOrders",function(value){this.m_isolation=value;
});
PatientBackgroundComponent.method("addIsolationOrder",function(value){if(this.m_isolation==null){this.m_isolation=[];
}this.m_isolation.push(value);
});
PatientBackgroundComponent.method("getAdvancedDirectives",function(){return(this.m_advDirectives);
});
PatientBackgroundComponent.method("setAdvancedDirectives",function(value){this.m_advDirectives=value;
});
PatientBackgroundComponent.method("addAdvancedDirective",function(value){if(this.m_advDirectives==null){this.m_advDirectives=[];
}this.m_advDirectives.push(value);
});
PatientBackgroundComponent.method("getParas",function(){return(this.m_para);
});
PatientBackgroundComponent.method("setParas",function(value){this.m_para=value;
});
PatientBackgroundComponent.method("addPara",function(value){if(this.m_para==null){this.m_para=[];
}this.m_para.push(value);
});
PatientBackgroundComponent.method("getGravidas",function(){return(this.m_gravida);
});
PatientBackgroundComponent.method("setGravidas",function(value){this.m_gravida=value;
});
PatientBackgroundComponent.method("addGravida",function(value){if(this.m_gravida==null){this.m_gravida=[];
}this.m_gravida.push(value);
});
PatientBackgroundComponent.method("getFallPrecautions",function(){return(this.m_fallPrec);
});
PatientBackgroundComponent.method("setFallPrecautions",function(value){this.m_fallPrec=value;
});
PatientBackgroundComponent.method("addFallPrecaution",function(value){if(this.m_fallPrec==null){this.m_fallPrec=[];
}this.m_fallPrec.push(value);
});
}PatientBackgroundComponent.inherits(MPageComponent);
var CERN_PATBACKGROUND_O1=function(){var m_df=null;
return{GetBackgroundTable:function(component){var painCds=(component.getPainScores()!=null&&component.getPainScores().length>0)?"value("+component.getPainScores().join(",")+")":0;
var astDevCds=(component.getDevices()!=null&&component.getDevices().length>0)?"value("+component.getDevices().join(",")+")":0;
var dietCds=(component.getDietOrders()!=null&&component.getDietOrders().length>0)?"value("+component.getDietOrders().join(",")+")":0;
var patActCds=(component.getPatientActivityOrders()!=null&&component.getPatientActivityOrders().length>0)?"value("+component.getPatientActivityOrders().join(",")+")":0;
var resusCds=(component.getResucitationOrders()!=null&&component.getResucitationOrders().length>0)?"value("+component.getResucitationOrders().join(",")+")":0;
var seizCds=(component.getSeizureOrders()!=null&&component.getSeizureOrders().length>0)?"value("+component.getSeizureOrders().join(",")+")":0;
var isltnCds=(component.getIsolationOrders()!=null&&component.getIsolationOrders().length>0)?"value("+component.getIsolationOrders().join(",")+")":0;
var advDirCds=(component.getAdvancedDirectives()!=null&&component.getAdvancedDirectives().length>0)?"value("+component.getAdvancedDirectives().join(",")+")":0;
var paraCd=(component.getParas()!=null&&component.getParas().length>0)?"value("+component.getParas().join(",")+")":0;
var gravidaCd=(component.getGravidas()!=null&&component.getGravidas().length>0)?"value("+component.getGravidas().join(",")+")":0;
var flRskScoreCd=(component.getFallPrecautions()!=null&&component.getFallPrecautions().length>0)?"value("+component.getFallPrecautions().join(",")+")":0;
var otherEventCd=0;
var groups=component.getGroups();
var group=null;
for(var i=0,il=groups.length;
i<il;
i++){group=groups[i];
if(group.getGroupName().toUpperCase()=="NC_CLIN_EVENT"){otherEventCd=MP_Util.CreateParamArray(group.getEventCodes(),1);
}}var criterion=component.getCriterion();
var sendAr=["^MINE^",criterion.person_id+".0",criterion.encntr_id+".0",criterion.provider_id+".0",criterion.ppr_cd+".0",painCds,astDevCds,dietCds,patActCds,resusCds,seizCds,isltnCds,advDirCds,paraCd,gravidaCd,flRskScoreCd,otherEventCd];
MP_Core.XMLCclRequestWrapper(component,"mp_get_pat_bkgrnd",sendAr,true);
},RenderComponent:function(component,recordData){var timerRenderComponent=MP_Util.CreateTimer(component.getComponentRenderTimerName());
try{var jsBgHTML=[];
var bgHTML="";
var countText="";
var subCnt=0;
var asstDev=recordData.ASSITIVE_DEVICES;
var patBkgrndI18n=i18n.discernabu.patient_background_o1;
var codeArray=MP_Util.LoadCodeListJSON(recordData.CODES);
var criterion=component.getCriterion();
if(recordData.ATTENDING_PHYSICIAN!=""){jsBgHTML.push(buildBkgrndHtml(patBkgrndI18n.ATTENDING_PHYSICIAN,recordData.ATTENDING_PHYSICIAN,recordData.ATT_PHYS_DT_TM));
subCnt=subCnt+1;
}if(recordData.SERVICE!=""){jsBgHTML.push(buildBkgrndHtml(patBkgrndI18n.SERVICE,recordData.SERVICE,recordData.SERVICE_DT_TM));
subCnt=subCnt+1;
}if(recordData.RESUSITATION_STATUS!=""){jsBgHTML.push(buildBkgrndHtml(patBkgrndI18n.RESUSITATION_STATUS,recordData.RESUSITATION_STATUS,recordData.RESUS_STATUS_DT_TM));
subCnt=subCnt+1;
}else{if(component.getResucitationOrders().length>0){jsBgHTML.push(buildBkgrndHtml(patBkgrndI18n.RESUSITATION_STATUS,patBkgrndI18n.NO_RESULTS_FOUND,""));
subCnt=subCnt+1;
}}if(recordData.ADVANCE_DIRECTIVE!=""){var advDirStatus=MP_Util.GetValueFromArray(recordData.ADV_DIR_STATUS_CD,codeArray);
var advDirRes=GetEventViewerLink(criterion,advDirStatus,recordData.ADVANCE_DIRECTIVE,recordData.ADV_DIR_EVENT_ID);
jsBgHTML.push(buildBkgrndHtml(patBkgrndI18n.ADVANCE_DIRECTIVE,advDirRes,recordData.ADV_DIR_DT_TM));
subCnt=subCnt+1;
}else{if(component.getAdvancedDirectives().length>0){jsBgHTML.push(buildBkgrndHtml(patBkgrndI18n.ADVANCE_DIRECTIVE,patBkgrndI18n.NO_RESULTS_FOUND,""));
subCnt=subCnt+1;
}}if(recordData.ISOLATION!=""){jsBgHTML.push(buildBkgrndHtml(patBkgrndI18n.ISOLATION,recordData.ISOLATION,recordData.ISOL_DT_TM));
subCnt=subCnt+1;
}else{if(component.getIsolationOrders().length>0){jsBgHTML.push(buildBkgrndHtml(patBkgrndI18n.ISOLATION,patBkgrndI18n.NO_RESULTS_FOUND,""));
subCnt=subCnt+1;
}}if(recordData.TARGET_DISCH_DT_TM!=""){jsBgHTML.push(buildBkgrndHtml(patBkgrndI18n.TARGET_DISCH_DT_TM,"",recordData.TARGET_DISCH_DT_TM));
subCnt=subCnt+1;
}if(recordData.ACTIVITY_ORDER!=""){jsBgHTML.push(buildBkgrndHtml(recordData.ACTIVITY_ORDER,recordData.ACTIVITY_ORDER_DISP,recordData.ACT_ORD_DT_TM));
subCnt=subCnt+1;
}else{if(component.getPatientActivityOrders().length>0){jsBgHTML.push(buildBkgrndHtml(patBkgrndI18n.ACTIVITY_ORDER,patBkgrndI18n.NO_RESULTS_FOUND,""));
subCnt=subCnt+1;
}}if(recordData.PARENT_PART_TYPE!=""){jsBgHTML.push(buildBkgrndHtml(patBkgrndI18n.PARENT_PART_TYPE,recordData.PARENT_PART_TYPE));
subCnt=subCnt+1;
}if(recordData.GESTATIONAL_AGE!=""){jsBgHTML.push(buildBkgrndHtml(patBkgrndI18n.GESTATIONAL_AGE,recordData.GESTATIONAL_AGE,recordData.GEST_AGE_DT_TM));
subCnt=subCnt+1;
}if(recordData.PARA!=""&&recordData.GRAVIDA!=""){var paraStatus=MP_Util.GetValueFromArray(recordData.PARA_STATUS_CD,codeArray);
var gravidaStatus=MP_Util.GetValueFromArray(recordData.GRAVIDA_STATUS_CD,codeArray);
var paraRes=GetEventViewerLink(criterion,paraStatus,recordData.PARA,recordData.PARA_EVENT_ID);
var gravidaRes=GetEventViewerLink(criterion,paraStatus,recordData.GRAVIDA,recordData.GRAVIDA_EVENT_ID);
jsBgHTML.push(buildBkgrndHtml(patBkgrndI18n.PARA_GRAVIDA,paraRes+"/"+gravidaRes,recordData.PARA_GRAVIDA_DT_TM));
subCnt=subCnt+1;
}if(recordData.FALL_RISK_SCORE!=""){subCnt=subCnt+1;
var severity=0;
if(parseInt(recordData.FALL_RISK_SCORE,10)>44){severity=1;
}var fallRiskStatus=MP_Util.GetValueFromArray(recordData.FALL_RISK_STATUS_CD,codeArray);
var fallRiskRes=GetEventViewerLink(criterion,fallRiskStatus,recordData.FALL_RISK_SCORE,recordData.FALL_RISK_EVENT_ID);
jsBgHTML.push(buildBkgrndHtml(patBkgrndI18n.FALL_RISK_SCORE,fallRiskRes,recordData.FALL_SCORE_DT_TM,severity));
jsBgHTML.push("<h4 class='det-hd'><span>",patBkgrndI18n.STATUS,":</span></h4><div class='hvr'><dl><dt><span>",patBkgrndI18n.STATUS,":</span></dt><dd><span>",fallRiskStatus.display,"</span></dl></div>");
}if(recordData.SEIZURE_PRECAUTIONS!=""){jsBgHTML.push(buildBkgrndHtml(patBkgrndI18n.SEIZURE_PRECAUTIONS,recordData.SEIZURE_PRECAUTIONS,recordData.SEIZ_DT_TM));
var seizStatus=MP_Util.GetValueFromArray(recordData.SEIZ_STATUS_CD,codeArray);
jsBgHTML.push("<h4 class='det-hd'><span>",patBkgrndI18n.STATUS,":</span></h4><div class='hvr'><dl><dt><span>",patBkgrndI18n.STATUS,":</span></dt><dd><span>",seizStatus.display,"</span></dl></div>");
subCnt=subCnt+1;
}if(recordData.DIET!=""){jsBgHTML.push(buildBkgrndHtml(recordData.DIET,recordData.DIET_ORDER_DISP,recordData.DIET_DT_TM));
subCnt=subCnt+1;
}else{if(component.getDietOrders().length>0){jsBgHTML.push(buildBkgrndHtml(patBkgrndI18n.DIET,patBkgrndI18n.NO_RESULTS_FOUND,""));
subCnt=subCnt+1;
}}if(recordData.PAIN_SCORE!=""){var painScoreStatus=MP_Util.GetValueFromArray(recordData.PAIN_SCORE_STATUS_CD,codeArray);
var painScoreRes=GetEventViewerLink(criterion,painScoreStatus,recordData.PAIN_SCORE,recordData.PAIN_SCORE_EVENT_ID);
jsBgHTML.push(buildBkgrndHtml(patBkgrndI18n.PAIN_SCORE,painScoreRes,recordData.PAIN_SCORE_DT_TM));
subCnt=subCnt+1;
}else{if(component.getPainScores().length>0){jsBgHTML.push(buildBkgrndHtml(patBkgrndI18n.PAIN_SCORE,patBkgrndI18n.NO_RESULTS_FOUND,""));
subCnt=subCnt+1;
}}if(recordData.OTHER_EVENTS.length>0){var events=recordData.OTHER_EVENTS;
events.sort(SortByEventSeq);
var otherStatus=null;
var otherEventCd=null;
var curEvent=null;
var otherRes="";
for(var i=0,il=events.length;
i<il;
i++){otherStatus=otherEventCd=null;
otherRes="";
curEvent=events[i];
var otherStatus=MP_Util.GetValueFromArray(curEvent.RESULT_STATUS_CD,codeArray);
var otherEventCd=MP_Util.GetValueFromArray(curEvent.EVENT_CD,codeArray);
var otherRes=GetEventViewerLink(criterion,otherStatus,curEvent.RESULT_VAL,curEvent.EVENT_ID);
jsBgHTML.push(buildBkgrndHtml(otherEventCd.display,otherRes,curEvent.EVENT_END_DT_TM));
subCnt=subCnt+1;
}}if(component.getDevices().length>0){if(asstDev.length>0){jsBgHTML.push("<div class='sub-sec'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl'>-</span><span class='sub-sec-title'>",patBkgrndI18n.ASSISTIVE_DEVICES," (",asstDev.length,")</span></h3><div class='sub-sec-content'>");
jsBgHTML.push("<dl class='pbg-info hdr'><dt class='pbg-res'><span>&nbsp;</span></dt><dd class='pbg-dt'><span>",patBkgrndI18n.DATE_TIME,"</span></dd></dl>");
for(var i=0,il=asstDev.length;
i<il;
i++){var asstDevStatus=MP_Util.GetValueFromArray(asstDev[i].STATUS_CD,codeArray);
var asstDevRes=GetEventViewerLink(criterion,asstDevStatus,asstDev[i].NAME,asstDev[i].EVENT_ID);
if(asstDev[i].DT_TM==null||asstDev[i].DT_TM==""){sDevDtTm="";
}else{var df=GetDateFormatter();
sDevDtTm=df.formatISO8601(asstDev[i].DT_TM,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_2YEAR);
}jsBgHTML.push("<dl class='pbg-info'><dt class='pbg-res'><span class='res-normal'>",asstDevRes,"</span></dt><dd class='pbg-dt'><span class='date-time'>",sDevDtTm,"</span></dd></dl>");
}jsBgHTML.push("</div></div>");
}else{jsBgHTML.push("<div class='sub-sec'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl'>-</span><span class='sub-sec-title'>",patBkgrndI18n.ASSISTIVE_DEVICES," (",asstDev.length,")</span></h3><div class='sub-sec-content'>");
jsBgHTML.push("<dl class='pbg-info'><dt class='pbg-res'><span class='res-normal'>",patBkgrndI18n.NO_RESULTS_FOUND,"</span></dt><dd class='pbg-dt'><span class='date-time'> &nbsp; </span></dd></dl>");
}}jsBgHTML.unshift("<div class='",MP_Util.GetContentClass(component,subCnt),"'>");
jsBgHTML.push("</div>");
bgHTML=jsBgHTML.join("");
countText=MP_Util.CreateTitleText(component,0);
MP_Util.Doc.FinalizeComponent(bgHTML,component,countText);
}catch(err){if(timerRenderComponent){timerRenderComponent.Abort();
timerRenderComponent=null;
}throw (err);
}finally{if(timerRenderComponent){timerRenderComponent.Stop();
}}}};
function buildBkgrndHtml(label,sResult,resDtTm,alrtRed){var sDispDtTm="";
if(resDtTm){var df=GetDateFormatter();
sDispDtTm=df.formatISO8601(resDtTm,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_2YEAR);
}if(alrtRed==1){return"<dl class='pbg-info'><dt class='pbg-name'><span>"+label+":</span></dt><dd class='pbg-reac'><span class='res-severe'>"+sResult+"</span></dd><dd class='pbg-dt'><span class='date-time'>"+sDispDtTm+"</span></dd></dl>";
}else{return"<dl class='pbg-info'><dt class='pbg-name'><span>"+label+":</span></dt><dd class='pbg-reac'><span class='res-normal'>"+sResult+"</span></dd><dd class='pbg-dt'><span class='date-time'>"+sDispDtTm+"</span></dd></dl>";
}}function GetDateFormatter(){if(m_df==null){m_df=new mp_formatter.DateTimeFormatter(MPAGE_LOCALE);
}return m_df;
}function GetEventViewerLink(criterion,statusCd,res,eventId){var ar=[];
var params=[criterion.person_id+".0",criterion.encntr_id+".0",eventId+".0",'"EVENT"'];
ar.push("<a onclick='MP_Util.LaunchClinNoteViewer(",params.join(","),"); return false;' href='#'>",res,"</a>");
var mean=statusCd.meaning;
if(mean==="MODIFIED"||mean==="ALTERED"){ar.push("<span class='res-modified'>&nbsp;</span>");
}return ar.join("");
}function SortByEventSeq(a,b){var x=a.EVENT_SEQ;
var y=b.EVENT_SEQ;
return((x<y)?-1:((x>y)?1:0));
}}();
function PatientInfoComponentStyle(){this.initByNamespace("pt");
}PatientInfoComponentStyle.inherits(ComponentStyle);
function PatientInfoComponent(criterion){this.rowCount=0;
this.setCriterion(criterion);
this.setStyles(new PatientInfoComponentStyle());
this.m_visitTypeMeanings=null;
this.m_visitTypeCodes=null;
this.m_chiefComplaintCodes=null;
this.m_estimatedDischargeDateCodes=null;
this.m_displayMedicalService=false;
this.m_displayRFV=false;
this.m_primaryPhysDisplay=false;
this.m_attedingPhysDisplay=false;
this.m_admittingPhysDisplay=false;
this.m_roombedDisplay=false;
this.m_admitDateDisplay=false;
this.m_modeofArrval=null;
this.m_advancedDirectives=null;
this.m_resusOrderCodes=null;
this.m_emergencyContactsDisplay=false;
this.m_documentTypeCodes=null;
this.setComponentLoadTimerName("USR:MPG.PATINFO.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.PATINFO.O1 - render component");
PatientInfoComponent.method("HandleSuccess",function(recordData){CERN_PATINFO_O1.GetPatientInfo(this,recordData);
});
PatientInfoComponent.method("InsertData",function(){CERN_PATINFO_O1.SendPatientData(this);
});
PatientInfoComponent.method("setVisitTypeCodes",function(value){this.m_visitTypeCodes=value;
});
PatientInfoComponent.method("addVisitTypeCode",function(value){if(this.m_visitTypeCodes==null){this.m_visitTypeCodes=[];
}this.m_visitTypeCodes.push(value);
});
PatientInfoComponent.method("getVisitTypeCodes",function(){if(this.m_visitTypeCodes!=null){return this.m_visitTypeCodes;
}});
PatientInfoComponent.method("setChiefComplaint",function(value){this.rowCount++;
this.m_chiefComplaintCodes=value;
});
PatientInfoComponent.method("addChiefComplaint",function(value){if(this.m_chiefComplaintCodes==null){this.m_chiefComplaintCodes=[];
}this.m_chiefComplaintCodes.push(value);
});
PatientInfoComponent.method("getChiefComplaint",function(){return this.m_chiefComplaintCodes;
});
PatientInfoComponent.method("setAdvancedDirectives",function(value){this.rowCount++;
this.m_advancedDirectives=value;
});
PatientInfoComponent.method("addAdvancedDirectives",function(value){if(this.m_advancedDirectives==null){this.m_advancedDirectives=[];
}this.m_advancedDirectives.push(value);
});
PatientInfoComponent.method("getAdvancedDirectives",function(){return this.m_advancedDirectives;
});
PatientInfoComponent.method("setResusOrders",function(value){this.rowCount++;
this.m_resusOrderCodes=value;
});
PatientInfoComponent.method("addResusOrders",function(value){if(this.m_resusOrderCodes==null){this.m_resusOrderCodes=[];
}this.m_resusOrderCodes.push(value);
});
PatientInfoComponent.method("getResusOrders",function(){return this.m_resusOrderCodes;
});
PatientInfoComponent.method("setEstimatedDischargeDate",function(value){this.rowCount++;
this.m_estimatedDischargeDateCodes=value;
});
PatientInfoComponent.method("addEstimatedDischargeDate",function(value){if(this.m_estimatedDischargeDateCodes==null){this.m_estimatedDischargeDateCodes=[];
}this.m_estimatedDischargeDateCodes.push(value);
});
PatientInfoComponent.method("getEstimatedDischargeDate",function(){return this.m_estimatedDischargeDateCodes;
});
PatientInfoComponent.method("setModeofArrival",function(value){this.rowCount++;
this.m_modeofArrival=value;
});
PatientInfoComponent.method("addModeofArrival",function(value){if(this.m_modeofArrival==null){this.m_modeofArrival=[];
}this.m_modeofArrival.push(value);
});
PatientInfoComponent.method("getModeofArrival",function(){return this.m_modeofArrival;
});
PatientInfoComponent.method("setDocumentTypes",function(value){this.m_documentTypeCodes=value;
});
PatientInfoComponent.method("addDocumentTypes",function(value){if(this.m_documentTypeCodes==null){this.m_documentTypeCodes=[];
}this.m_documentTypeCodes.push(value);
});
PatientInfoComponent.method("getDocumentTypes",function(){return this.m_documentTypeCodes;
});
PatientInfoComponent.method("isMedicalServiceDisplay",function(){return this.m_displayMedicalService;
});
PatientInfoComponent.method("setMedicalServiceDisplay",function(value){if(value==1){this.rowCount++;
}this.m_displayMedicalService=(value==1?true:false);
});
PatientInfoComponent.method("isRFVDisplay",function(){return this.m_displayRFV;
});
PatientInfoComponent.method("setRFVDisplay",function(value){if(value==1){this.rowCount++;
}this.m_displayRFV=(value==1?true:false);
});
PatientInfoComponent.method("isPrimaryPhysDisplay",function(){return this.m_primaryPhysDisplay;
});
PatientInfoComponent.method("setPrimaryPhysDisplay",function(value){if(value==1){this.rowCount++;
}this.m_primaryPhysDisplay=(value==1?true:false);
});
PatientInfoComponent.method("isAttendingPhysDisplay",function(){return this.m_attedingPhysDisplay;
});
PatientInfoComponent.method("setAttendingPhysDisplay",function(value){if(value==1){this.rowCount++;
}this.m_attedingPhysDisplay=(value==1?true:false);
});
PatientInfoComponent.method("isAdmittingPhysDisplay",function(){return this.m_admittingPhysDisplay;
});
PatientInfoComponent.method("setAdmittingPhysDisplay",function(value){if(value==1){this.rowCount++;
}this.m_admittingPhysDisplay=(value==1?true:false);
});
PatientInfoComponent.method("isRoomBedDisplay",function(){return this.m_roombedDisplay;
});
PatientInfoComponent.method("setRoomBedDisplay",function(value){if(value==1){this.rowCount++;
}this.m_roombedDisplay=(value==1?true:false);
});
PatientInfoComponent.method("isAdmitDateDisplay",function(){return this.m_admitDateDisplay;
});
PatientInfoComponent.method("setAdmitDateDisplay",function(value){if(value==1){this.rowCount++;
}this.m_admitDateDisplay=(value==1?true:false);
});
PatientInfoComponent.method("isEmergencyContactsDisplay",function(){return this.m_emergencyContactsDisplay;
});
PatientInfoComponent.method("setEmergencyContactsDisplay",function(value){this.m_emergencyContactsDisplay=(value==1?true:false);
});
PatientInfoComponent.method("getRowCount",function(){return this.rowCount;
});
}PatientInfoComponent.inherits(MPageComponent);
var CERN_PATINFO_O1=function(){var timerPatInfoLoad=null;
return{SendPatientData:function(component){var criterion=component.getCriterion();
var sendVal=[];
sendVal.push("^MINE^",criterion.person_id+".0",criterion.encntr_id+".0");
var codes=component.getVisitTypeCodes();
sendVal.push((codes!=null&&codes.length>0)?"value("+codes.join(",")+")":"0");
sendVal.push((component.getEstimatedDischargeDate()!=null)?"value("+component.getEstimatedDischargeDate().join(",")+")":"0.0");
sendVal.push((component.getChiefComplaint()!=null)?"value("+component.getChiefComplaint().join(",")+")":"0.0");
sendVal.push((component.getModeofArrival()!=null)?"value("+component.getModeofArrival().join(",")+")":"0.0");
sendVal.push((component.getAdvancedDirectives()!=null)?"value("+component.getAdvancedDirectives().join(",")+")":"0.0");
sendVal.push((component.getResusOrders()!=null)?"value("+component.getResusOrders().join(",")+")":"0.0");
sendVal.push((component.getDocumentTypes()!=null)?"value("+component.getDocumentTypes().join(",")+")":"0.0");
var prsnlInfo=criterion.getPersonnelInfo();
var encntrs=prsnlInfo.getViewableEncounters();
var encntrVal=(encntrs)?"value("+encntrs+")":"0.0";
sendVal.push(0,encntrVal,criterion.provider_id+".0",criterion.ppr_cd+".0");
MP_Core.XMLCclRequestWrapper(component,"mp_get_patinfo",sendVal,true);
return;
},GetPatientInfo:function(component,reportData){var criterion=component.getCriterion();
var patInfoI18n=i18n.discernabu.patinfo_o1;
var jsPtHTML=[];
var tempAr=[];
var ptHTML="";
var countText="";
var rfv=patInfoI18n.NO_RESULTS_FOUND;
var roomBed=patInfoI18n.NO_RESULTS_FOUND;
var admitDiag=patInfoI18n.NO_RESULTS_FOUND;
var admitDate=patInfoI18n.NO_RESULTS_FOUND;
var primPhys=patInfoI18n.NO_RESULTS_FOUND;
var attPhys=patInfoI18n.NO_RESULTS_FOUND;
var admPhys=patInfoI18n.NO_RESULTS_FOUND;
var medService=patInfoI18n.NO_RESULTS_FOUND;
var dischargeDate=patInfoI18n.NO_RESULTS_FOUND;
var recCount=0;
var dateTime=new Date();
var contact=5;
var patLstVstdisp;
var df=new mp_formatter.DateTimeFormatter(MPAGE_LOCALE);
var lastVisitDtTm=new Date();
var visitListCnt=reportData.VISIT_LIST.length;
var multVisitTypeInd=reportData.MULT_VISIT_TYPE_IND;
if(reportData.RFV!=""){rfv=reportData.RFV;
}if(reportData.ROOM_BED!=""){roomBed=reportData.ROOM_BED;
}if(reportData.ADMIT_DT_TM!=""){admitDate=reportData.ADMIT_DT_TM;
dateTime.setISO8601(admitDate);
admitDate=df.format(dateTime,mp_formatter.DateTimeFormatter.FULL_DATE_4YEAR);
}if(reportData.PRIMARY_PHYS!=""){primPhys=reportData.PRIMARY_PHYS;
}if(reportData.ATTENDING_PHYS!=""){attPhys=reportData.ATTENDING_PHYS;
}if(reportData.ADMITTING_PHYS!=""){admPhys=reportData.ADMITTING_PHYS;
}if(reportData.MED_SERVICE!=""){medService=reportData.MED_SERVICE;
}if(reportData.ESTIMATED_DEPART_DT_TM!=""){if(reportData.ESTIMATED_DEPART_DATE>0){dischargeDate=df.formatISO8601(reportData.ESTIMATED_DEPART_DT_TM,mp_formatter.DateTimeFormatter.FULL_DATE_4YEAR);
}else{dischargeDate=reportData.ESTIMATED_DEPART_DT_TM;
}}jsPtHTML.push("<div class='",MP_Util.GetContentClass(component,component.getRowCount()),"'>");
if(component.getChiefComplaint()!=null){var chiefComplaint="<dd class='pt-detail'><span>"+patInfoI18n.NO_RESULTS_FOUND+"</span></dd>";
if(reportData.CHIEFCOMPLAINTS.length>0){var complaint=reportData.CHIEFCOMPLAINTS[0].CHIEFCOMPLAINT;
if(complaint>""){tempAr=[];
var resModified=(reportData.CHIEFCOMPLAINTS[0].MODIFIED_FLAG>0)?"<span class='res-modified'>&nbsp;</span>":"";
var eventid=reportData.CHIEFCOMPLAINTS[0].EVENTID;
var viewerLink=ptEventViewerLink(criterion.person_id+".0",eventid,complaint);
tempAr.push("<dd class='pt-detail'><span>",viewerLink,"</span>",resModified,"</dd>");
chiefComplaint=tempAr.join("");
}}jsPtHTML.push("<dl class='pt-info'><dt class='pt-label'><span>",patInfoI18n.CHIEF_COMPLAINT,":</span></dt>",chiefComplaint,"</dl>");
}if(component.isRFVDisplay()){jsPtHTML.push("<dl class='pt-info'><dt class='pt-label'><span>",patInfoI18n.RFV,":</span></dt><dd class='pt-detail'><span>",rfv,"</span></dd></dl>");
}if(component.isPrimaryPhysDisplay()){jsPtHTML.push("<dl class='pt-info'><dt  class='pt-label'><span>",patInfoI18n.PRIM_PHYS,":</span></dt><dd class='pt-detail'><span>",primPhys,"</span></dd></dl>");
}if(component.isAttendingPhysDisplay()){jsPtHTML.push("<dl class='pt-info'><dt  class='pt-label'><span>",patInfoI18n.ATTEND_PHYS,":</span></dt><dd class='pt-detail'><span>",attPhys,"</span></dd></dl>");
}if(component.isAdmittingPhysDisplay()){jsPtHTML.push("<dl class='pt-info'><dt  class='pt-label'><span>",patInfoI18n.ADMIT_PHYS,":</span></dt><dd class='pt-detail'><span>",admPhys,"</span></dd></dl>");
}if(component.isMedicalServiceDisplay()){jsPtHTML.push("<dl class='pt-info'><dt  class='pt-label'><span>",patInfoI18n.SERVICE,":</span></dt><dd class='pt-detail'><span>",medService,"</span></dd></dl>");
}if(component.isRoomBedDisplay()){jsPtHTML.push("<dl class='pt-info'><dt class='pt-label'><span>",patInfoI18n.ROOM_BED,":</span></dt><dd class='pt-detail'><span>",roomBed,"</span></dd></dl>");
}if(component.isAdmitDateDisplay()){jsPtHTML.push("<dl class='pt-info'><dt class='pt-label'><span>",patInfoI18n.ADMIT_DATE,":</span></dt><dd class='pt-detail'><span>",admitDate,"</span></dd></dl>");
}if(component.getEstimatedDischargeDate()!=null){var resModified=(reportData.ESTIMATED_DEPART_MODIFIED_FLAG>0)?"<span class='res-modified'>&nbsp;</span>":"";
var eventid=reportData.ESTIMATED_DEPART_EVENTID;
if(eventid>0){var viewerLink=ptEventViewerLink(criterion.person_id+".0",eventid,dischargeDate);
}else{var viewerLink=dischargeDate;
}jsPtHTML.push("<dl class='pt-info'><dt class='pt-label'><span>",patInfoI18n.TARGETED_DISCHARGE_DATE,":</span></dt><dd class='pt-detail'><span>",viewerLink,"</span>",resModified,"</dd></dl>");
}if(component.getModeofArrival()!=null){var modeofArrival="<dd class='pt-detail'><span>"+patInfoI18n.NO_RESULTS_FOUND+"</span></dd>";
if(reportData.MODESOFARRIVAL.length>0){var arrival=reportData.MODESOFARRIVAL[0].MODEOFARRIVAL;
if(arrival>""){tempAr=[];
var resModified=(reportData.MODESOFARRIVAL[0].MODIFIED_FLAG>0)?"<span class='res-modified'>&nbsp;</span>":"";
var eventid=reportData.MODESOFARRIVAL[0].EVENTID;
var viewerLink=ptEventViewerLink(criterion.person_id+".0",eventid,arrival);
tempAr.push("<dd class='pt-detail'><span>",viewerLink,"</span>",resModified,"</dd>");
modeofArrival=tempAr.join("");
}}jsPtHTML.push("<dl class='pt-info'><dt class='pt-label'><span>",patInfoI18n.MODE_OF_ARRVAL,":</span></dt>",modeofArrival,"</dl>");
}if(component.getAdvancedDirectives()!=null){var advancedirective="<dd class='pt-detail'><span>"+patInfoI18n.NO_RESULTS_FOUND+"</span></dd>";
if(reportData.ADVANCEDDIRECTIVES.length>0){var directive=reportData.ADVANCEDDIRECTIVES[0].ADVANCEDIRECTIVE;
if(directive>""){tempAr=[];
var resModified=(reportData.ADVANCEDDIRECTIVES[0].MODIFIED_FLAG>0)?"<span class='res-modified'>&nbsp;</span>":"";
var eventid=reportData.ADVANCEDDIRECTIVES[0].EVENTID;
var viewerLink=ptEventViewerLink(criterion.person_id+".0",eventid,directive);
tempAr.push("<dd class='pt-detail'><span>",viewerLink,"</span>",resModified,"</dd>");
advancedirective=tempAr.join("");
}}jsPtHTML.push("<dl class='pt-info'><dt class='pt-label'><span>",patInfoI18n.ADVANCE_DIRECTIVE,":</span></dt>",advancedirective,"</dl>");
}if(visitListCnt>0){patLstVstdisp="";
var resModified=(reportData.LASTVISITDOCMODFLAG>0)?"<span class='res-modified'>&nbsp;</span>":"";
if(reportData.VISIT_LIST[0].UTCDATE!=""){var lastVisit=reportData.VISIT_LIST[0].UTCDATE;
lastVisitDtTm.setISO8601(lastVisit);
patLstVstdisp=df.format(lastVisitDtTm,mp_formatter.DateTimeFormatter.FULL_DATE_4YEAR);
}if(reportData.DOCVIEWERTYPE==="AP"){if((reportData.LASTVISITEVENTID>0)&&(reportData.LASTVISITPEVENTID>0)){jsPtHTML.push("<dl class='pt-info'><dt class='pt-label'><span>",patInfoI18n.LAST_VISIT,":</span></dt><dd class='pt-detail'><span>",MP_Util.CreateClinNoteLink(component.getCriterion().person_id,component.getCriterion().encntr_id,reportData.LASTVISITEVENTID,patLstVstdisp+"&nbsp("+reportData.VISIT_LIST[0].TYPE+")",reportData.DOCVIEWERTYPE,reportData.LASTVISITPEVENTID),"</span></dd></dl>");
}else{jsPtHTML.push("<dl class='pt-info'><dt class='pt-label'><span>",patInfoI18n.LAST_VISIT,":</span></dt><dd class='pt-detail'><span>",patLstVstdisp,"&nbsp","(",reportData.VISIT_LIST[0].TYPE,")","</span>",resModified,"</dd></dl>");
}}else{if((reportData.DOCVIEWERTYPE!=="STANDARD")&&(reportData.LASTVISITEVENTID>0)){jsPtHTML.push("<dl class='pt-info'><dt class='pt-label'><span>",patInfoI18n.LAST_VISIT,":</span></dt><dd class='pt-detail'><span>",MP_Util.CreateClinNoteLink(component.getCriterion().person_id,component.getCriterion().encntr_id,reportData.LASTVISITEVENTID,patLstVstdisp+"&nbsp("+reportData.VISIT_LIST[0].TYPE+")",reportData.DOCVIEWERTYPE,reportData.LASTVISITPEVENTID),"</span></dd></dl>");
}else{jsPtHTML.push("<dl class='pt-info'><dt class='pt-label'><span>",patInfoI18n.LAST_VISIT,":</span></dt><dd class='pt-detail'><span>",patLstVstdisp,"&nbsp","(",reportData.VISIT_LIST[0].TYPE,")","</span>",resModified,"</dd></dl>");
}}if(visitListCnt>1){jsPtHTML.push("<h4 class='det-hd'><span>",patInfoI18n.DETAILS,"</span></h4><div class='hvr'><dl class='pt-det'>");
if(multVisitTypeInd==0){for(var j=0,m=reportData.VISIT_LIST.length;
j<m;
j++){if(reportData.VISIT_LIST[j].UTCDATE!=""){var lastVis=reportData.VISIT_LIST[j].UTCDATE;
lastVisitDtTm.setISO8601(lastVis);
jsPtHTML.push("<dd><span>",df.format(lastVisitDtTm,mp_formatter.DateTimeFormatter.FULL_DATE_4YEAR),"</span></dd><br/>");
}}}else{if(multVisitTypeInd==1){for(var j=0,m=reportData.VISIT_LIST.length;
j<m;
j++){if(reportData.VISIT_LIST[0].UTCDATE!=""){var lastVisit1=reportData.VISIT_LIST[j].UTCDATE;
lastVisitDtTm.setISO8601(lastVisit1);
jsPtHTML.push("<dd><span>",df.format(lastVisitDtTm,mp_formatter.DateTimeFormatter.FULL_DATE_4YEAR),"&nbsp","(",reportData.VISIT_LIST[j].TYPE,")","</span></dd><br/>");
}}}}jsPtHTML.push("</dl></div>");
}}else{jsPtHTML.push("<dl class='pt-info'><dt class='pt-label'><span>",patInfoI18n.LAST_VISIT,":</span></dt><dd class='pt-detail'><span>",patInfoI18n.NO_RESULTS_FOUND,"</span></dd></dl>");
}if(component.getResusOrders()!=null){var codeStatus="";
var codeStatusDetails="";
for(i=0,k=reportData.RESUSCITATION.length;
i<k;
i++){if(i>0){codeStatus+=", ";
}codeStatus+=reportData.RESUSCITATION[i].CODE_STATUS;
codeStatusDetails=reportData.RESUSCITATION[i].CODE_STATUS_DETAILS;
}if(codeStatus==""){codeStatus=patInfoI18n.NO_RESULTS_FOUND;
codeStatusDetails="";
}jsPtHTML.push("<dl class='pt-info'><dt  class='pt-label'><span>",patInfoI18n.CODE_STATUS,":</span></dt><dd class='pt-detail'><span class='res-severe'>",codeStatus,"</span></dd></dl>");
if(codeStatusDetails!=""){jsPtHTML.push("<h4 class='det-hd'><span>",patInfoI18n.DETAILS,"</span></h4><div class='hvr'><dl class='pt-det'><dd><span>",codeStatusDetails,"</span></dd></dl></div>");
}}if(component.isEmergencyContactsDisplay()){var contactList=reportData.CONTACT_LIST;
if(contactList.length>0){jsPtHTML.push("<div class='sub-sec'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl'>-</span><span class='sub-sec-title'>",patInfoI18n.EMER_CONTACT," (",contactList.length,")</span></h3><div class='sub-sec-content'>");
for(var j=0,m=contactList.length;
j<m;
j++){jsPtHTML.push("<dl class='pt-info'><dt class='pt-label'><span>",contactList[j].NAME,":</span></dt><dd class='pt-detail'><span>",contactList[j].NUMBER,"</span></dd></dl>");
jsPtHTML.push("<h4 class='det-hd'><span>",patInfoI18n.DETAILS,"</span></h4><div class='hvr'><dl class='pt-det'>");
for(var x=0,y=contactList[j].CONTACT_PHONE.length;
x<y;
x++){jsPtHTML.push("<dd><span>",contactList[j].CONTACT_PHONE[x].NUMBER,"</span></dd><br/>");
}jsPtHTML.push("</dl></div>");
}jsPtHTML.push("</div></div>");
}else{jsPtHTML.push("<div class='sub-sec closed'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl'>-</span><span class='sub-sec-title'>",patInfoI18n.EMER_CONTACT," (0)</span></h3><div class='sub-sec-content'><span class='res-none'>",patInfoI18n.NO_RESULTS_FOUND,"</span></div></div>");
}}jsPtHTML.push("</div>");
ptHTML=jsPtHTML.join("");
countText=MP_Util.CreateTitleText(component,component.getRowCount(),false,false,false);
MP_Util.Doc.FinalizeComponent(ptHTML,component,countText);
return;
}};
function ptEventViewerLink(personid,eventid,result){var ar=[];
var params=[personid,"0.0",eventid,'"EVENT"',"0.0"];
ar.push("<a onclick='MP_Util.LaunchClinNoteViewer(",params.join(","),"); return false;' href='#'>",result,"</a>");
return ar.join("");
}}();
function ProblemsComponentStyle(){this.initByNamespace("pl");
}ProblemsComponentStyle.inherits(ComponentStyle);
function ProblemsComponent(criterion){this.m_searchTypeFlag=null;
this.m_suggestionLimit=null;
this.m_problemVocab=null;
this.m_problemAddTypeCd=null;
this.m_problemClass=null;
this.m_problemVocabInd=0;
this.curSearchCounter=0;
this.nextSearchCounter=0;
this.replySearchCounter=0;
this.setCriterion(criterion);
this.setStyles(new ProblemsComponentStyle());
this.setComponentLoadTimerName("USR:MPG.PROBLEMS.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.PROBLEMS.O1 - render component");
this.setIncludeLineNumber(true);
this.setScope(1);
ProblemsComponent.method("InsertData",function(){this.setEditMode(true);
CERN_PROBLEMS_O1.GetProblemsTable(this);
});
ProblemsComponent.method("HandleSuccess",function(recordData){CERN_PROBLEMS_O1.RenderComponent(this,recordData);
});
ProblemsComponent.method("getSearchTypeFlag",function(){return this.m_searchTypeFlag;
});
ProblemsComponent.method("setSearchTypeFlag",function(value){this.m_searchTypeFlag=value;
});
ProblemsComponent.method("getSuggestionLimit",function(){return this.m_suggestionLimit;
});
ProblemsComponent.method("setSuggestionLimit",function(value){this.m_suggestionLimit=value;
});
ProblemsComponent.method("getCurSearchCounter",function(){return this.curSearchCounter;
});
ProblemsComponent.method("setCurSearchCounter",function(value){this.curSearchCounter=value;
});
ProblemsComponent.method("incCurSearchCounter",function(){this.curSearchCounter++;
});
ProblemsComponent.method("getNextSearchCounter",function(){return this.nextSearchCounter;
});
ProblemsComponent.method("setNextSearchCounter",function(value){this.nextSearchCounter=value;
});
ProblemsComponent.method("incNextSearchCounter",function(){this.nextSearchCounter++;
});
ProblemsComponent.method("getReplySearchCounter",function(){return this.replySearchCounter;
});
ProblemsComponent.method("setReplySearchCounter",function(value){this.replySearchCounter=value;
});
ProblemsComponent.method("incReplySearchCounter",function(){this.replySearchCounter++;
});
ProblemsComponent.method("setProblemsVocab",function(value){this.m_problemVocab=value;
});
ProblemsComponent.method("getProblemsVocab",function(){return this.m_problemVocab;
});
ProblemsComponent.method("setProblemsAddTypeCd",function(value){this.m_problemAddTypeCd=value;
});
ProblemsComponent.method("getProblemsAddTypeCd",function(){return this.m_problemAddTypeCd;
});
ProblemsComponent.method("setProblemsClassification",function(value){this.m_problemClass=value;
});
ProblemsComponent.method("getProblemsClassification",function(){return this.m_problemClass;
});
ProblemsComponent.method("setProblemsVocabInd",function(value){this.m_problemVocabInd=value;
});
ProblemsComponent.method("getProblemsVocabInd",function(){return this.m_problemVocabInd;
});
}ProblemsComponent.inherits(MPageComponent);
var CERN_PROBLEMS_O1=function(){return{GetProblemsTable:function(component){var sendAr=[];
var criterion=component.getCriterion();
sendAr.push("^MINE^",criterion.person_id+".0","0",criterion.provider_id+".0",criterion.ppr_cd+".0",criterion.position_cd+".0","1",component.getProblemsVocab()+".0",component.getProblemsVocabInd());
var request=new MP_Core.ScriptRequest(component,component.getComponentLoadTimerName());
request.setProgramName("MP_GET_PROBLEMS");
request.setParameters(sendAr);
request.setAsync(true);
MP_Core.XMLCCLRequestCallBack(component,request,CERN_PROBLEMS_O1.RenderComponent);
},RenderComponent:function(reply){var countText="";
var component=reply.getComponent();
try{var recordData=reply.getResponse();
var jsPlHTML=[];
var plHTML="";
if(reply.getStatus()!=="F"){if(recordData.PL_CAN_ADD===1){jsPlHTML.push(MP_Util.CreateAutoSuggestBoxHtml(component));
component.setAutoSuggestAddScript("mp_add_problem");
component.setAutoSuggestAddTimerName("USR:MPG.PROBLEMS.01 - add problem from auto suggest");
component.setSuggestionLimit(10);
}if(reply.getStatus()==="S"){var df=new mp_formatter.DateTimeFormatter(MPAGE_LOCALE);
var personnelArray=MP_Util.LoadPersonelListJSON(recordData.PRSNL);
var probLen=(recordData.PROBLEM&&recordData.PROBLEM!==null)?recordData.PROBLEM.length:0;
jsPlHTML.push("<div class='",MP_Util.GetContentClass(component,probLen),"'>");
var problemArray=recordData.PROBLEM;
var codeArray=MP_Util.LoadCodeListJSON(recordData.CODES);
for(var i=0,l=problemArray.length;
i<l;
i++){var responsibleProvider="";
var type="";
var onsetDate="";
var onsetCd="";
var onsetDateFormatted=[];
if(problemArray[i].ONSET_DT_TM&&problemArray[i].ONSET_DT_TM!==""){var onsetFlag=problemArray[i].ONSET_DT_FLAG;
onsetDate=problemArray[i].ONSET_DT_TM;
if(problemArray[i].ONSET_DT_CD>0){onsetCd=MP_Util.GetValueFromArray(problemArray[i].ONSET_DT_CD,codeArray);
onsetDateFormatted=onsetCd.display+" ";
}if(onsetFlag==2){onsetDateFormatted+=df.formatISO8601(onsetDate,mp_formatter.DateTimeFormatter.FULL_4YEAR);
}else{if(onsetFlag==1){onsetDateFormatted+=df.formatISO8601(onsetDate,mp_formatter.DateTimeFormatter.FULL_MONTH_4YEAR_NO_DATE);
}else{onsetDateFormatted+=df.formatISO8601(onsetDate,mp_formatter.DateTimeFormatter.FULL_DATE_4YEAR);
}}}else{onsetCd="";
if(problemArray[i].ONSET_DT_CD>0){onsetCd=MP_Util.GetValueFromArray(problemArray[i].ONSET_DT_CD,codeArray);
onsetDateFormatted=onsetCd.display;
}}if(problemArray[i].PROVIDER_ID&&problemArray[i].PROVIDER_ID!==0){var provCodeObj=MP_Util.GetValueFromArray(problemArray[i].PROVIDER_ID,personnelArray);
responsibleProvider=provCodeObj.fullName;
}var plCode="";
var plName=problemArray[i].NAME;
var plAnnot=(problemArray[i].DISPLAY_AS&&problemArray[i].DISPLAY_AS!==null)?problemArray[i].DISPLAY_AS:null;
var plFaceUp=plAnnot;
if(plAnnot===null||plAnnot===""){plAnnot="&nbsp;";
plFaceUp=plName;
}if(problemArray[i].CODE&&problemArray[i].CODE!==""){plCode="("+problemArray[i].CODE+")";
}if(problemArray[i].PARENT_PROBLEM_ID===0){type="pl-name";
}else{type="pl-assoc-name";
}jsPlHTML.push("<h3 class='info-hd'><span>",plName,"</span></h3><dl class='pl-info'><dt><span>",i18n.PROBLEMS,":</span></dt><dd class=",type,"><span>",plFaceUp,"</span></dd><dt><span>",i18n.CODE,":</span></dt><dd class='pl-code'><span class='code'>",plCode,"</span></dd></dl><h4 class='det-hd'><span>",i18n.PROBLEMS_DETAILS,":</span></h4><div class='hvr'><dl class='pl-det'><dt><span>",i18n.PROBLEM,":</span></dt><dd class='pl-det-name'><span>",plName,"</span></dd><dt><span>",i18n.ANNOTATED_DISPLAY,":</span></dt><dd class='pl-det-annot'><span>",plAnnot,"</span></dd><dt><span>",i18n.ONSET_DATE,":</span></dt><dd class='pl-det-dt'><span>",onsetDateFormatted,"</span></dd><dt><span>",i18n.RESPONSIBLE_PROVIDER_NAME,":</span></dt><dd class='pl-det-dt'><span>",responsibleProvider,"</span></dd><dt><span>",i18n.COMMENTS,":</span></dt><dd class='pl-det-comment'><span>",MP_Util.Doc.GetComments(problemArray[i],personnelArray),"</span></dd></dl></div>");
}plHTML=jsPlHTML.join("");
countText=MP_Util.CreateTitleText(component,probLen);
jsPlHTML.push("</div>");
}else{if((reply.getStatus()==="Z")){plHTML=jsPlHTML.join("");
plHTML+=MP_Util.HandleNoDataResponse(component.getStyles().getNameSpace());
}}MP_Util.Doc.FinalizeComponent(plHTML,component,countText);
if(recordData.PL_CAN_ADD===1){MP_Util.AddAutoSuggestControl(component,CERN_PROBLEMS_O1.SearchNomenclature,CERN_PROBLEMS_O1.HandleSelection,CERN_PROBLEMS_O1.CreateSuggestionLine);
component.setSearchTypeFlag(recordData.PL_SEARCH_TYPE);
}}else{countText=MP_Util.CreateTitleText(component,0);
MP_Util.Doc.FinalizeComponent(MP_Util.HandleErrorResponse(component.getStyles().getNameSpace(),reply.getError()),component,countText);
}}catch(err){countText=MP_Util.CreateTitleText(component,0);
var errMsg=[];
errMsg.push("<b>",i18n.JS_ERROR,"</b><br><ul><li>",i18n.MESSAGE,": ",err.message,"</li><li>",i18n.NAME,": ",err.name,"</li><li>",i18n.NUMBER,": ",(err.number&65535),"</li><li>",i18n.DESCRIPTION,": ",err.description,"</li></ul>");
MP_Util.Doc.FinalizeComponent(MP_Util.HandleErrorResponse(component.getStyles().getNameSpace(),errMsg.join("")),component,countText);
throw (err);
}finally{component.setEditMode(false);
}},SearchNomenclature:function(callback,textBox,component){var xhr=new XMLCclRequest();
var returnData;
component.incCurSearchCounter();
xhr.onreadystatechange=function(){if(xhr.readyState==4&&xhr.status==200){var msg=xhr.responseText;
var jsonMsg="";
if(msg){jsonMsg=JSON.parse(msg);
}if(jsonMsg){var nextSearchCounter=component.getNextSearchCounter();
var replySearchCounter=jsonMsg.RECORD_DATA.SEARCHINDEX;
component.setReplySearchCounter(replySearchCounter);
if(replySearchCounter>nextSearchCounter&&textBox.value!==""){component.setNextSearchCounter(replySearchCounter);
returnData=jsonMsg.RECORD_DATA.NOMENCLATURE;
callback.autosuggest(returnData);
}}}};
xhr.open("GET","mp_search_nomenclatures");
xhr.send("^MINE^, ^"+textBox.value+"^,"+component.getSuggestionLimit()+","+component.getCurSearchCounter()+","+component.getSearchTypeFlag());
},HandleSelection:function(suggestionObj,textBox,component){var criterion=component.getCriterion();
var sendAr=[];
sendAr.push("^MINE^",criterion.person_id+".0",criterion.encntr_id+".0",criterion.provider_id+".0",criterion.position_cd+".0",criterion.ppr_cd+".0",suggestionObj.VALUE+".0","0.0","1","1",component.getProblemsAddTypeCd()+".0",component.getProblemsClassification()+".0");
var request=new MP_Core.ScriptRequest(component,component.getAutoSuggestAddTimerName());
request.setProgramName(component.getAutoSuggestAddScript());
request.setParameters(sendAr);
request.setAsync(true);
MP_Core.XMLCCLRequestCallBack(component,request,CERN_PROBLEMS_O1.AddProblemToList);
},AddProblemToList:function(reply){var alertMsg="";
var jsonReply=reply.getResponse();
var component=reply.getComponent();
var componentName="";
var textBox=MP_Util.RetrieveAutoSuggestSearchBox(component);
componentName=i18n.discernabu.PROBLEM;
if(jsonReply&&jsonReply.PRIVILEGE_IND===0){alertMsg=i18n.discernabu.NO_PRIVS;
alertMsg=alertMsg.replace("{name}",componentName);
alert(alertMsg);
textBox.value="";
}else{if(jsonReply&&jsonReply.DUPLICATE_IND==1){alertMsg=i18n.discernabu.DUPLICATE;
alertMsg=alertMsg.replace(/{name}/gi,componentName);
alert(alertMsg);
textBox.value="";
}else{MP_Util.Doc.HideHovers();
component.InsertData();
}}},CreateSuggestionLine:function(suggestionObj,searchVal){return CERN_PROBLEMS_O1.HighlightValue(suggestionObj.NAME,searchVal);
},HighlightValue:function(inString,term){return"<strong class='highlight'>"+inString.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+term.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1").split(" ").join("|")+")(?![^<>]*>)(?![^&;]+;)","gi"),"</strong>$1<strong class='highlight'>")+"</strong>";
}};
}();
function ProcedureComponentStyle(){this.initByNamespace("proc");
}ProcedureComponentStyle.inherits(ComponentStyle);
function ProcedureComponent(criterion){this.setCriterion(criterion);
this.setStyles(new ProcedureComponentStyle());
this.setIncludeLineNumber(true);
this.setScope(1);
this.setComponentLoadTimerName("USR:MPG.PROCEDURE.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.PROCEDURE.O1 - render component");
ProcedureComponent.method("InsertData",function(){CERN_PROCEDURE_O1.GetProcedureTable(this);
});
ProcedureComponent.method("HandleSuccess",function(recordData){CERN_PROCEDURE_O1.RenderComponent(this,recordData);
});
}ProcedureComponent.inherits(MPageComponent);
var CERN_PROCEDURE_O1=function(){return{GetProcedureTable:function(component){var sendAr=[];
var criterion=component.getCriterion();
var prsnlInfo=criterion.getPersonnelInfo();
var encntrs=prsnlInfo.getViewableEncounters();
var encntrVal=(encntrs)?"value("+encntrs+")":"0.0";
sendAr.push("^MINE^",criterion.person_id+".0",encntrVal,criterion.provider_id+".0",criterion.ppr_cd+".0");
MP_Core.XMLCclRequestWrapper(component,"mp_get_procedures",sendAr,true);
},RenderComponent:function(component,recordData){var timerRenderComponent=MP_Util.CreateTimer(component.getComponentRenderTimerName());
try{var jsHTML=[];
var df=new mp_formatter.DateTimeFormatter(MPAGE_LOCALE);
jsHTML.push("<div class='",MP_Util.GetContentClass(component,recordData.PROC_CNT),"'>");
for(var i=0;
i<recordData.PROC_CNT;
i++){var commentString="";
var onsetDate="";
var dateTime=null;
if(recordData.PROC[i].ONSET!=""){dateTime=new Date();
var onsetDt=recordData.PROC[i].ONSET_UTC;
dateTime.setISO8601(onsetDt);
if(recordData.PROC[i].DATE_FLAG==0||recordData.PROC[i].DATE_FLAG==1){onsetDate=df.format(dateTime,mp_formatter.DateTimeFormatter.FULL_DATE_4YEAR);
}else{if(recordData.PROC[i].DATE_FLAG==2){onsetDate=df.format(dateTime,mp_formatter.DateTimeFormatter.FULL_MONTH_4YEAR_NO_DATE);
}else{if(recordData.PROC[i].DATE_FLAG==3){onsetDate=df.format(dateTime,mp_formatter.DateTimeFormatter.FULL_4YEAR);
}}}}jsHTML.push("  <h3 class='info-hd'><SPAN>",recordData.PROC[i].DISPLAY_AS,"</SPAN></h3><dl class='proc-info'><dt class='proc-name'><span>",i18n.PROCEDURE,"</span></dt><dd class='proc-name'><span>",recordData.PROC[i].DISPLAY_AS,"</span></dd><dt class='proc-date'><span>",i18n.SIG_LINE,"</span></dt><dd class='proc-date'><span class='date-time'>",onsetDate,"</span></dd></dl><h4 class='det-hd'><span>",i18n.PROCEDURE_DETAILS,"</span></h4><div class='proc-det hvr'><dt class='proc-det-name'><span>",i18n.PROCEDURE,":</span></dt><dd class='proc-det-name'>",recordData.PROC[i].NAME,"</dd><dt class='proc-det-name'><span>",i18n.DISPLAY_AS,":</span></dt><dd class='proc-det-name'>",recordData.PROC[i].DISPLAY_AS,"</dd><dt class='proc-det-name'><span>",i18n.PROCEDURE_DATE,":</span></dt><dd class='proc-det-name'>",onsetDate,"</dd><dt class='proc-det-name'><span>",i18n.STATUS,":</span></dt><dd class='proc-det-name'>",recordData.PROC[i].STATUS,"</dd><dt class='proc-det-name'><span>",i18n.PROVIDER,":</span></dt><dd class='proc-det-name'>",recordData.PROC[i].PROVIDER,"</dd><dt class='proc-det-name'><span>",i18n.LOCATION,":</span></dt><dd class='proc-det-name'>",recordData.PROC[i].LOCATION,"</dd><dt class='proc-det-name'><span>",i18n.COMMENTS,":</span></dt>");
for(var k=0;
k<recordData.PROC[i].COMMENTS.length;
k++){var begin_dttm="";
if(recordData.PROC[i].COMMENTS[k].BEG_EFFECTIVE_DT_TM!=""){dateTime=new Date();
var beginDt=recordData.PROC[i].COMMENTS[k].BEG_EFFECTIVE_DT_TM;
dateTime.setISO8601(beginDt);
begin_dttm=df.format(dateTime,mp_formatter.DateTimeFormatter.FULL_DATE_4YEAR);
}commentString+=begin_dttm+" - "+recordData.PROC[i].COMMENTS[k].NAME_FULL_FORMATTED+"<br/>"+recordData.PROC[i].COMMENTS[k].LONG_TEXT+"<br/>";
}jsHTML.push("<dd class='proc-det-name'>",commentString,"</dd>");
jsHTML.push("</div>");
}jsHTML.push("</div>");
var countText=MP_Util.CreateTitleText(component,recordData.PROC_CNT);
MP_Util.Doc.FinalizeComponent(jsHTML.join(""),component,countText);
}catch(err){if(timerRenderComponent){timerRenderComponent.Abort();
timerRenderComponent=null;
}throw (err);
}finally{if(timerRenderComponent){timerRenderComponent.Stop();
}}return;
}};
function formatDateTimeUTC(dttm,format){var dateTime=new Date();
dateTime.setISO8601(dttm);
return dateTime.format(format);
}}();
function RespiratoryComponentStyle(){this.initByNamespace("resp");
}RespiratoryComponentStyle.inherits(ComponentStyle);
function RespiratoryComponent(criterion){this.setCriterion(criterion);
this.setIncludeLineNumber(false);
this.setStyles(new RespiratoryComponentStyle());
this.m_abg=null;
this.m_model=null;
this.m_rate=null;
this.setComponentLoadTimerName("USR:MPG.RESPIRATORY.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.RESPIRATORY.O1 - render component");
RespiratoryComponent.method("InsertData",function(){CERN_RESPIRATORY_O1.CreateRespiratoryTable(this);
});
RespiratoryComponent.method("HandleSuccess",function(recordData){CERN_RESPIRATORY_O1.RenderComponent(this,recordData);
});
RespiratoryComponent.method("getVentilatorModeCodes",function(){return(this.m_mode);
});
RespiratoryComponent.method("setVentilatorModeCodes",function(value){this.m_mode=value;
});
RespiratoryComponent.method("addVentilatorModeCodes",function(value){if(this.m_mode==null){this.m_mode=[];
}this.m_mode.push(value);
});
RespiratoryComponent.method("getTidalVolCodes",function(){return(this.m_tid_vol);
});
RespiratoryComponent.method("setTidalVolCodes",function(value){this.m_tid_vol=value;
});
RespiratoryComponent.method("addTidalVolCodes",function(value){if(this.m_tid_vol==null){this.m_tid_vol=[];
}this.m_tid_vol.push(value);
});
RespiratoryComponent.method("getSetRateCodes",function(){return(this.m_set_rate);
});
RespiratoryComponent.method("setSetRateCodes",function(value){this.m_set_rate=value;
});
RespiratoryComponent.method("addSetRateCodes",function(value){if(this.m_set_rate==null){this.m_set_rate=[];
}this.m_set_rate.push(value);
});
RespiratoryComponent.method("getFIO2Codes",function(){return(this.m_fio2);
});
RespiratoryComponent.method("setFIO2Codes",function(value){this.m_fio2=value;
});
RespiratoryComponent.method("addFIO2Codes",function(value){if(this.m_fio2==null){this.m_fio2=[];
}this.m_fio2.push(value);
});
RespiratoryComponent.method("getPEEPCodes",function(){return(this.m_peep);
});
RespiratoryComponent.method("setPEEPCodes",function(value){this.m_peep=value;
});
RespiratoryComponent.method("addPEEPCodes",function(value){if(this.m_peep==null){this.m_peep=[];
}this.m_peep.push(value);
});
RespiratoryComponent.method("getO2FlowRateCodes",function(){return(this.m_o2_rate);
});
RespiratoryComponent.method("setO2FlowRateCodes",function(value){this.m_o2_rate=value;
});
RespiratoryComponent.method("addO2FlowRateCodes",function(value){if(this.m_o2_rate==null){this.m_o2_rate=[];
}this.m_o2_rate.push(value);
});
RespiratoryComponent.method("getRespiratoryRateCodes",function(){return(this.tot_resp_rate);
});
RespiratoryComponent.method("setRespiratoryRateCodes",function(value){this.tot_resp_rate=value;
});
RespiratoryComponent.method("addRespiratoryRateCodes",function(value){if(this.tot_resp_rate==null){this.tot_resp_rate=[];
}this.tot_resp_rate.push(value);
});
RespiratoryComponent.method("getMinVolCodes",function(){return(this.m_min_vol);
});
RespiratoryComponent.method("setMinVolCodes",function(value){this.m_min_vol=value;
});
RespiratoryComponent.method("addMinVolCodes",function(value){if(this.m_min_vol==null){this.m_min_vol=[];
}this.m_min_vol.push(value);
});
RespiratoryComponent.method("getInspTimeSetCodes",function(){return(this.m_insp_tm_set);
});
RespiratoryComponent.method("setInspTimeSetCodes",function(value){this.m_insp_tm_set=value;
});
RespiratoryComponent.method("addInspTimeSetCodes",function(value){if(this.m_insp_tm_set==null){this.m_insp_tm_set=[];
}this.m_insp_tm_set.push(value);
});
RespiratoryComponent.method("getInspTimeDelCodes",function(){return(this.m_insp_tm_del);
});
RespiratoryComponent.method("setInspTimeDelCodes",function(value){this.m_insp_tm_del=value;
});
RespiratoryComponent.method("addInspTimeDelCodes",function(value){if(this.m_insp_tm_del==null){this.m_insp_tm_del=[];
}this.m_insp_tm_del.push(value);
});
RespiratoryComponent.method("getABGCodes",function(){return(this.m_abg);
});
RespiratoryComponent.method("setABGCodes",function(value){this.m_abg=value;
});
RespiratoryComponent.method("addABGCode",function(value){if(this.m_abg==null){this.m_abg=[];
}this.m_pain.push(value);
});
}RespiratoryComponent.inherits(MPageComponent);
var CERN_RESPIRATORY_O1=function(){return{CreateRespiratoryTable:function(component){var sendAr=[];
var criterion=component.getCriterion();
var modeCodes=component.getVentilatorModeCodes();
var tidalVolCodes=component.getTidalVolCodes();
var setRateCds=component.getSetRateCodes();
var fio2Codes=component.getFIO2Codes();
var peepCodes=component.getPEEPCodes();
var o2RateCodes=component.getO2FlowRateCodes();
var totRespRateCodes=component.getRespiratoryRateCodes();
var minVolCodes=component.getMinVolCodes();
var inspTmSetCodes=component.getInspTimeSetCodes();
var inspTmDelCodes=component.getInspTimeDelCodes();
var abgCodes=component.getABGCodes();
var sModeCodes=(modeCodes!=null&&modeCodes.length>0)?"value("+modeCodes.join(",")+")":"0.0";
var sTidalVolCodes=(tidalVolCodes!=null&&tidalVolCodes.length>0)?"value("+tidalVolCodes.join(",")+")":"0.0";
var sSetRateCodes=(setRateCds!=null&&setRateCds.length>0)?"value("+setRateCds.join(",")+")":"0.0";
var sSetFIO2Codes=(fio2Codes!=null&&fio2Codes.length>0)?"value("+fio2Codes.join(",")+")":"0.0";
var sPEEPCodes=(peepCodes!=null&&peepCodes.length>0)?"value("+peepCodes.join(",")+")":"0.0";
var sO2RateCodes=(o2RateCodes!=null&&o2RateCodes.length>0)?"value("+o2RateCodes.join(",")+")":"0.0";
var sTotRespRateCodes=(totRespRateCodes!=null&&totRespRateCodes.length>0)?"value("+totRespRateCodes.join(",")+")":"0.0";
var sMinVolCodes=(minVolCodes!=null&&minVolCodes.length>0)?"value("+minVolCodes.join(",")+")":"0.0";
var sInspTmSetCodes=(inspTmSetCodes!=null&&inspTmSetCodes.length>0)?"value("+inspTmSetCodes.join(",")+")":"0.0";
var sInspTmDelCodes=(inspTmDelCodes!=null&&inspTmDelCodes.length>0)?"value("+inspTmDelCodes.join(",")+")":"0.0";
var sAbgCodes=(abgCodes!=null&&abgCodes.length>0)?"value("+abgCodes.join(",")+")":"0.0";
var CompID=component.getComponentId();
var encntrOption=(component.getScope()==1)?"0.0":(criterion.encntr_id+".0");
var lookBackUnits=(component.getLookbackUnits()!=null)?component.getLookbackUnits():"0";
sendAr.push("^MINE^",criterion.person_id+".0",encntrOption,lookBackUnits,sModeCodes,sTidalVolCodes,sSetRateCodes,sSetFIO2Codes,sPEEPCodes,sO2RateCodes,sTotRespRateCodes,sMinVolCodes,sInspTmSetCodes,sInspTmDelCodes,sAbgCodes,CompID,component.getLookbackUnitTypeFlag());
MP_Core.XMLCclRequestWrapper(component,"MP_GET_RESPIRATORY",sendAr,true);
},RenderComponent:function(component,recordData){var timerRenderComponent=MP_Util.CreateTimer(component.getComponentRenderTimerName());
try{if(recordData.ABGS.length>0){var orgnzdAGB_ar=OrganizeABGs(recordData.ABGS);
}var ar=[];
var dtTm=new Date();
if(recordData.MODE!=""&&recordData.MODE!=null){dtTm.setISO8601(recordData.INIT_DT_TM);
ar.push("<dl class='resp-info-hdr'><dd class='resp-dt-hd'><span>",i18n.VENTILATOR_INFO,"</span></dd><dd class='resp-lbl'><span class ='resp-hdr' ></span></dd></dl>");
ar.push("<dl class='resp-lbl-hdr'><dd class='resp-res'><span>",i18n.LAST_DOC,":</span></dd><dd class='resp-lbl'><span>",dtTm.format("longDateTime3"),"</span></dd></dl>");
ar.push(createRow(i18n.VENTILATOR_MODE,recordData.MODE));
ar.push(createRow(i18n.SET_TIDAL_VOLUME,recordData.SET_TIDAL_VOL));
ar.push(createRow(i18n.SET_RATE,recordData.SET_RATE));
ar.push(createRow(i18n.FIO2,recordData.FIO2));
ar.push(createRow(i18n.PEEP,recordData.PEEP));
ar.push(createRow(i18n.O2_FLOW_RATE,recordData.FLOW_RATE));
ar.push(createRow(i18n.TOTAL_RESPIRATORY_RATE,recordData.TOT_RESP_RATE));
ar.push(createRow(i18n.TOTAL_MINUTE_VOLUME,recordData.TOT_MINUTE_VOL));
ar.push(createRow(i18n.INSPIRATORY_TIME_SET,recordData.INSPIRATORY_TIME_SET));
ar.push(createRow(i18n.INSPIRATORY_TIME_DELIVERED,recordData.INSPIRATORY_TIME_DEL));
}ar.push("<dl class='resp-info-hdr'><dd class='resp-cat-hd'><span class= 'resp-hdr'>",i18n.LATEST_BLOOD_GAS_ARTERIAL_RESULTS,"</span></dd>");
if(orgnzdAGB_ar!=null){if(orgnzdAGB_ar.length<1){ar.push("<p class='resp-info'>",i18n.NO_RESULTS_FOUND,"</p>");
}else{var abg_array=orgnzdAGB_ar[0];
var abg_obj=abg_array[0];
ar.push(BuildABGSection(abg_array,abg_obj));
}}else{ar.push("<p class='resp-info'>",i18n.NO_RESULTS_FOUND,"</p>");
}ar.push("<dl class='resp-info-hdr'><dd class='resp-cat-hd'><span class= 'resp-hdr'>",i18n.PREVIOUS_BLOOD_GAS_ARTERIAL_RESULTS,"</span></dd>");
if(orgnzdAGB_ar!=null){if(orgnzdAGB_ar.length<2){ar.push("<p class='resp-info'>",i18n.NO_RESULTS_FOUND,"</p>");
}else{var abg_array=orgnzdAGB_ar[1];
var abg_obj=abg_array[0];
ar.push(BuildABGSection(abg_array,abg_obj));
}}else{ar.push("<p class='resp-info'>",i18n.NO_RESULTS_FOUND,"</p>");
}ar.push("<dl class='resp-info'>",i18n.RESPIRATORY_DISCLAIMER,"</dl>");
ar.push("</div>");
var sHTML=MP_Util.HandleErrorResponse(component.getStyles().getNameSpace());
sHTML=ar.join("");
countText=MP_Util.CreateTitleText(component,0,false,false,false);
MP_Util.Doc.FinalizeComponent(sHTML,component,countText);
}catch(err){if(timerRenderComponent){timerRenderComponent.Abort();
timerRenderComponent=null;
}throw (err);
}finally{if(timerRenderComponent){timerRenderComponent.Stop();
}}}};
function createRow(label,value){var returnAr=[];
returnAr.push("<dl class='resp-lbl-hdr'><dd class='resp-res'><span>",label,":</span></dd>","<dd class='resp-lbl'><span>");
if(value&&value!==""){returnAr.push(value);
}else{returnAr.push("--");
}returnAr.push("</span></dd></dl>");
return returnAr.join("");
}function BuildABGSection(abg_array,abg_obj){var ar=[];
var dtTm=new Date();
dtTm.setISO8601(abg_obj.perf_dt_tm);
ar.push("<dd class='resp-dt-hdr'><span class ='resp-hdr' >",dtTm.format("longDateTime3"),"</span></dd></dl></dl>");
var hdr_row="<dl class='resp-info'>";
var val_row="<dl class='resp-info'>";
var abg_len=(abg_array.length>5)?abg_len=6:abg_array.length;
for(var i=0;
i<abg_len;
i++){abg_obj=abg_array[i];
hdr_row+="<dd class='resp-abg-lbl'><span>"+abg_obj.nm+"</span></dd>";
val_row+="<dd class='resp-abg-cat'><span>"+abg_obj.value+"</span></dd>";
}hdr_row+="</dl>";
val_row+="</dl>";
ar.push(hdr_row,val_row);
return ar.join("");
}function OrganizeABGs(abgs_ar){var abg_cnt=0;
var ordr_id="";
var perf_dt_tm="";
var abg_ar=[];
var orgnzdABG_ar=[];
var isNwOrdrId=0;
if(abgs_ar.length>0){for(var i=0;
i<abgs_ar.length;
i++){ordr_id=abgs_ar[i].ORDER_ID;
perf_dt_tm=abgs_ar[i].EVNT_END_DT_TM;
isNwOrdrId=0;
if(abg_ar.length>0){isNwOrdrId=1;
var temp_obj=abg_ar[abg_ar.length-1];
if(ordr_id==temp_obj.ordr_id&&perf_dt_tm==temp_obj.perf_dt_tm){isNwOrdrId=0;
}}if(isNwOrdrId==1){orgnzdABG_ar.push(abg_ar);
abg_ar=[];
abg_cnt=0;
}abg_cnt=abg_cnt+1;
var orgnzdABG_obj={};
orgnzdABG_obj.ordr_id=ordr_id;
orgnzdABG_obj.perf_dt_tm=perf_dt_tm;
orgnzdABG_obj.nm=abgs_ar[i].NAME;
orgnzdABG_obj.value=abgs_ar[i].VALUE;
orgnzdABG_obj.val_seq=abgs_ar[i].VALUE_SEQ;
abg_ar.push(orgnzdABG_obj);
}}orgnzdABG_ar.push(abg_ar);
var abg_ar_org=abgNoDataHndlr(orgnzdABG_ar);
return abg_ar_org;
}function abgSorter(a,b){var aPart=a.val_seq;
var bPart=b.val_seq;
if(aPart>bPart){return 1;
}else{if(aPart<bPart){return -1;
}else{return 0;
}}}function abgNoDataHndlr(unHndldAbgs_ar){var hndldAbgs_ar=[];
if(unHndldAbgs_ar=="undefined"){return null;
}if(unHndldAbgs_ar.length<2){var fstSet_ar=unHndldAbgs_ar[0];
var abg_ar_std=fstSet_ar.sort(abgSorter);
hndldAbgs_ar.push(abg_ar_std);
return hndldAbgs_ar;
}var fstSet_ar=unHndldAbgs_ar[0];
var scndSet_ar=unHndldAbgs_ar[1];
var fndMtch=0;
if(fstSet_ar.length>0&&scndSet_ar.length>0){for(var i=0;
i<fstSet_ar.length;
i++){var fstSetObj=fstSet_ar[i];
fndMtch=0;
for(var j=0;
j<scndSet_ar.length;
j++){var scndSetObj=scndSet_ar[j];
if(fstSetObj.nm==scndSetObj.nm){fndMtch=1;
break;
}}if(fndMtch==0){var tmpObj={};
tmpObj.nm=fstSetObj.nm;
tmpObj.ordr_id=fstSetObj.ordr_id;
tmpObj.perf_dt_tm=scndSetObj.perf_dt_tm;
tmpObj.value="--";
tmpObj.val_seq=fstSetObj.val_seq;
scndSet_ar.push(tmpObj);
}}for(var i=0;
i<scndSet_ar.length;
i++){var scndSetObj=scndSet_ar[i];
fndMtch=0;
for(var j=0;
j<fstSet_ar.length;
j++){var fstSetObj=fstSet_ar[j];
if(scndSetObj.nm==fstSetObj.nm){fndMtch=1;
break;
}}if(fndMtch==0){var tmpObj={};
tmpObj.nm=scndSetObj.nm;
tmpObj.ordr_id=scndSetObj.ordr_id;
tmpObj.perf_dt_tm=fstSetObj.perf_dt_tm;
tmpObj.value="--";
tmpObj.val_seq=scndSetObj.val_seq;
fstSet_ar.push(tmpObj);
}}var abg_ar_std=fstSet_ar.sort(abgSorter);
hndldAbgs_ar.push(abg_ar_std);
var abg_ar_std=scndSet_ar.sort(abgSorter);
hndldAbgs_ar.push(abg_ar_std);
return hndldAbgs_ar;
}else{return unHndldAbgs_ar;
}}}();
function RespAssessmentsComponentStyle(){this.initByNamespace("resa");
}RespAssessmentsComponentStyle.inherits(ComponentStyle);
function RespAssessmentsComponent(criterion){this.setCriterion(criterion);
this.setStyles(new RespAssessmentsComponentStyle());
this.setComponentLoadTimerName("USR:MPG.RESP_ASSESSMENTS.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.RESP_ASSESSMENTS.O1 - render component");
this.setIncludeLineNumber(false);
RespAssessmentsComponent.method("InsertData",function(){CERN_RESP_ASSESSMENT_O1.GetRespAssessmentData(this);
});
RespAssessmentsComponent.method("HandleSuccess",function(recordData){CERN_RESP_ASSESSMENT_O1.RenderRespAssessment(this,recordData);
});
}RespAssessmentsComponent.inherits(MPageComponent);
var CERN_RESP_ASSESSMENT_O1=function(){return{RenderRespAssessment:function(component,recordData){var countText="",sHTML="",jsHTML=[],nameSpace=component.getStyles().getNameSpace();
var orgnzdAGB_ar=null;
var i=0;
var criterion=component.getCriterion();
var personid=criterion.person_id+".0";
var df=new mp_formatter.DateTimeFormatter(MPAGE_LOCALE);
var codeArray=MP_Util.LoadCodeListJSON(recordData.CODES);
var abgObj=recordData.ABGS;
var abgLen=abgObj.length;
var latestAbgHTML="";
var prevAbgHTML="";
var latestAbgDt="";
var prevAbgDt="";
sHTML+="<hr />";
var o2_therapy_cnt=recordData.O2_THERAPY_QUAL;
if(o2_therapy_cnt>0){jsHTML.push("<div class='sub-sec'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl' title='",i18n.HIDE_SECTION,"'>-</span><span class='sub-sec-title'>",i18n.O2_THERAPY_TITRATION,"</span></h3><div class='sub-sec-content'><div class='",MP_Util.GetContentClass(component,o2_therapy_cnt),"'><h3 class='info-hd'><span>",i18n.O2_THERAPY_TITRATION_DETAILS,"</span></h3>");
for(i=0;
i<o2_therapy_cnt;
i++){var dataElem=recordData.O2_THERAPY[i];
var statusObj=MP_Util.GetValueFromArray(dataElem.STATUS_CD,codeArray);
var statusMean=statusObj.meaning;
var statusDisp=statusObj.display;
var resultDtTm=new Date();
resultDtTm.setISO8601(dataElem.EVENT_END_DT_TM);
var dataDtTm=df.format(resultDtTm,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_2YEAR);
var hvrDataDtTm=df.format(resultDtTm,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_4YEAR);
jsHTML.push("<dl class='",nameSpace,"-info'><dt><span>",dataElem.NAME,":</span></dt><dd><span>",EventViewerLink(personid,dataElem.ENCOUNTER_ID,dataElem.EVENT_ID,dataElem.VALUE),"</span>",getStatusInd(statusMean),"</dd><dd><span class='date-time'>",dataDtTm,"</span></dd></dl>");
if(dataElem.VALUE!=="--"){jsHTML.push("<h4 class='det-hd'><span>",i18n.RESULT_DETAILS,"</span></h4><div class='hvr'><dl class='",nameSpace,"-det'><dt><span>",dataElem.NAME,":</span></dt><dd class='",nameSpace,"-det-name'><span>",dataElem.VALUE," ",dataElem.VALUE_UNITS,"</span></dd><dt><span>",i18n.RESULT_DT_TM,":</span></dt><dd><span>",hvrDataDtTm,"</span></dd><dt><span>",i18n.DOCUMENTED_BY,":</span></dt><dd class='",nameSpace,"-det-ord-by'><span>",dataElem.DOCUMENTED_BY,"</span></dd><dt><span>",i18n.STATUS,":</span></dt><dd class='",nameSpace,"-det-status'><span>",statusDisp,"</span></dd></dl></div>");
}}jsHTML.push("</div></div></div><hr />");
}if(abgLen>0){var curDf=new mp_formatter.DateTimeFormatter(MPAGE_LOCALE);
var curAbg=abgObj[0];
latestAbgHTML=createAbgContent(curAbg,personid);
latestAbgDt="<span class='resa-abg-dt'>"+curDf.formatISO8601(curAbg.EVENT_END_DT_TM,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_2YEAR)+"</span>";
}else{latestAbgHTML="<span class='res-none'>"+i18n.NO_RESULTS_FOUND+"</span>";
}jsHTML.push("<div class='sub-sec'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl' title='",i18n.HIDE_SECTION,"'>-</span><span class='sub-sec-title'>",i18n.LATEST_BLOOD_GAS_ARTERIAL_RESULTS,"</span>",latestAbgDt,"</h3><div class='sub-sec-content'>",latestAbgHTML,"</div></div>");
if(abgLen>1){var prevDf=new mp_formatter.DateTimeFormatter(MPAGE_LOCALE);
var prevAbg=abgObj[1];
prevAbgHTML=createAbgContent(prevAbg,personid);
prevAbgDt="<span class='resa-abg-dt'>"+prevDf.formatISO8601(prevAbg.EVENT_END_DT_TM,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_2YEAR)+"</span>";
}else{prevAbgHTML="<span class='res-none'>"+i18n.NO_RESULTS_FOUND+"</span>";
}jsHTML.push("<div class='sub-sec'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl' title='",i18n.HIDE_SECTION,"'>-</span><span class='sub-sec-title'>",i18n.PREVIOUS_BLOOD_GAS_ARTERIAL_RESULTS,"</span>",prevAbgDt,"</h3><div class='sub-sec-content'>",prevAbgHTML,"</div></div>");
jsHTML.push("<p class='resa-disclaim'>",i18n.RESPIRATORY_DISCLAIMER,"</p>");
var art_airway_cnt=recordData.ART_AIRWAY_QUAL;
if(art_airway_cnt>0){jsHTML.push("<div class='sub-sec'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl' title='",i18n.HIDE_SECTION,"'>-</span><span class='sub-sec-title'>",i18n.ARTIFICIAL_AIRWAY,"</span></h3><div class='sub-sec-content'><div class='",MP_Util.GetContentClass(component,art_airway_cnt),"'><h3 class='info-hd'><span>",i18n.ARTIFICIAL_AIRWAY_DETAILS,"</span></h3>");
for(i=0;
i<art_airway_cnt;
i++){var dataElem=recordData.ART_AIRWAY[i];
var statusObj=MP_Util.GetValueFromArray(dataElem.STATUS_CD,codeArray);
var statusMean=statusObj.meaning;
var statusDisp=statusObj.display;
var resultDtTm=new Date();
resultDtTm.setISO8601(dataElem.EVENT_END_DT_TM);
var dataDtTm=df.format(resultDtTm,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_2YEAR);
var hvrDataDtTm=df.format(resultDtTm,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_4YEAR);
jsHTML.push("<dl class='",nameSpace,"-info'><dt><span>",dataElem.NAME,":</span></dt><dd><span>",EventViewerLink(personid,dataElem.ENCOUNTER_ID,dataElem.EVENT_ID,dataElem.VALUE),"</span>",getStatusInd(statusMean),"</dd><dd><span class='date-time'>",dataDtTm,"</span></dd></dl>");
if(dataElem.VALUE!=="--"){jsHTML.push("<h4 class='det-hd'><span>",i18n.RESULT_DETAILS,"</span></h4><div class='hvr'><dl class='",nameSpace,"-det'><dt><span>",dataElem.NAME,":</span></dt><dd class='",nameSpace,"-det-name'><span>",dataElem.VALUE," ",dataElem.VALUE_UNITS,"</span></dd><dt><span>",i18n.RESULT_DT_TM,":</span></dt><dd><span>",hvrDataDtTm,"</span></dd><dt><span>",i18n.DOCUMENTED_BY,":</span></dt><dd class='",nameSpace,"-det-ord-by'><span>",dataElem.DOCUMENTED_BY,"</span></dd><dt><span>",i18n.STATUS,":</span></dt><dd class='",nameSpace,"-det-status'><span>",statusDisp,"</span></dd></dl></div>");
}}jsHTML.push("</div></div></div><hr />");
}var breath_sounds_cnt=recordData.BREATH_SOUNDS_QUAL;
jsHTML.push("<div class='sub-sec'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl' title='",i18n.HIDE_SECTION,"'>-</span><span class='sub-sec-title'>",i18n.BREATH_SOUNDS_ASSESSMENT,"</span></h3><div class='sub-sec-content'><div class='",MP_Util.GetContentClass(component,breath_sounds_cnt),"'><h3 class='info-hd'><span>",i18n.BREATH_SOUNDS_ASSESSMENT_DETAILS,"</span></h3>");
for(i=0;
i<breath_sounds_cnt;
i++){var dataElem=recordData.BREATH_SOUNDS[i];
var statusObj=MP_Util.GetValueFromArray(dataElem.STATUS_CD,codeArray);
var statusMean=statusObj.meaning;
var statusDisp=statusObj.display;
var resultDtTm=new Date();
resultDtTm.setISO8601(dataElem.EVENT_END_DT_TM);
var dataDtTm=df.format(resultDtTm,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_2YEAR);
var hvrDataDtTm=df.format(resultDtTm,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_4YEAR);
jsHTML.push("<dl class='",nameSpace,"-info'><dt><span>",dataElem.NAME,":</span></dt><dd><span>",EventViewerLink(personid,dataElem.ENCOUNTER_ID,dataElem.EVENT_ID,dataElem.VALUE),"</span>",getStatusInd(statusMean),"</dd><dd><span class='date-time'>",dataDtTm,"</span></dd></dl>");
if(dataElem.VALUE!="--"){jsHTML.push("<h4 class='det-hd'><span>",i18n.RESULT_DETAILS,"</span></h4><div class='hvr'><dl class='",nameSpace,"-det'><dt><span>",dataElem.NAME,":</span></dt><dd class='",nameSpace,"-det-name'><span>",dataElem.VALUE," ",dataElem.VALUE_UNITS,"</span></dd><dt><span>",i18n.RESULT_DT_TM,":</span></dt><dd><span>",hvrDataDtTm,"</span></dd><dt><span>",i18n.DOCUMENTED_BY,":</span></dt><dd class='",nameSpace,"-det-ord-by'><span>",dataElem.DOCUMENTED_BY,"</span></dd><dt><span>",i18n.STATUS,":</span></dt><dd class='",nameSpace,"-det-status'><span>",statusDisp,"</span></dd></dl></div>");
}}if(breath_sounds_cnt==0){jsHTML.push("<span class='res-none'>",i18n.NO_RESULTS_FOUND,"</span>");
}jsHTML.push("</div></div></div><hr />");
var resp_descr_cnt=recordData.RESP_DESCR_QUAL;
jsHTML.push("<div class='sub-sec'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl' title='",i18n.HIDE_SECTION,"'>-</span><span class='sub-sec-title'>",i18n.RESPIRATORY_DESCRIPTION,"</span></h3><div class='sub-sec-content'><div class='",MP_Util.GetContentClass(component,resp_descr_cnt),"'><h3 class='info-hd'><span>",i18n.RESPIRATORY_DESCRIPTION_DETAILS,"</span></h3>");
for(i=0;
i<resp_descr_cnt;
i++){var dataElem=recordData.RESP_DESCR[i];
var statusObj=MP_Util.GetValueFromArray(dataElem.STATUS_CD,codeArray);
var statusMean=statusObj.meaning;
var statusDisp=statusObj.display;
var resultDtTm=new Date();
resultDtTm.setISO8601(dataElem.EVENT_END_DT_TM);
var dataDtTm=df.format(resultDtTm,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_2YEAR);
var hvrDataDtTm=df.format(resultDtTm,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_4YEAR);
jsHTML.push("<dl class='",nameSpace,"-info'><dt><span>",dataElem.NAME,":</span></dt><dd><span>",EventViewerLink(personid,dataElem.ENCOUNTER_ID,dataElem.EVENT_ID,dataElem.VALUE),"</span>",getStatusInd(statusMean),"</dd><dd><span class='date-time'>",dataDtTm,"</span></dd></dl>");
if(dataElem.VALUE!="--"){jsHTML.push("<h4 class='det-hd'><span>",i18n.RESULT_DETAILS,"</span></h4><div class='hvr'><dl class='",nameSpace,"-det'><dt><span>",dataElem.NAME,":</span></dt><dd class='",nameSpace,"-det-name'><span>",dataElem.VALUE," ",dataElem.VALUE_UNITS,"</span></dd><dt><span>",i18n.RESULT_DT_TM,":</span></dt><dd><span>",hvrDataDtTm,"</span></dd><dt><span>",i18n.DOCUMENTED_BY,":</span></dt><dd class='",nameSpace,"-det-ord-by'><span>",dataElem.DOCUMENTED_BY,"</span></dd><dt><span>",i18n.STATUS,":</span></dt><dd class='",nameSpace,"-det-status'><span>",statusDisp,"</span></dd></dl></div>");
}}if(resp_descr_cnt==0){jsHTML.push("<span class='res-none'>",i18n.NO_RESULTS_FOUND,"</span>");
}jsHTML.push("</div></div></div><hr />");
countText="";
sHTML+=jsHTML.join("");
MP_Util.Doc.FinalizeComponent(sHTML,component,countText);
return;
},GetRespAssessmentData:function(component){var criterion=component.getCriterion();
var lookBackUnits=component.getLookbackUnits();
var lookBackUnitTypeFlag=component.getLookbackUnitTypeFlag();
var sABGCds="0.0";
var sArtificalAirwayCds="0.0";
var sOxygenTherapyCds="0.0";
var sBreathSoundsCds="0.0";
var sRespDescrCds="0.0";
var groups=component.getGroups();
var x1=(groups!=null)?groups.length:0;
for(var x=0;
x<x1;
x++){var group=groups[x];
if(group instanceof MPageEventSetGroup){grpName=group.getGroupName();
switch(grpName){case"MP_RESP_ABG":sABGCds=("value("+group.getEventSets()+")");
break;
case"MP_RESP_ART_AIR":sArtificalAirwayCds=("value("+group.getEventSets()+")");
break;
case"MP_RESP_O2_TIT":sOxygenTherapyCds=("value("+group.getEventSets()+")");
break;
case"MP_RESP_BRTH_SOUND":sBreathSoundsCds=("value("+group.getEventSets()+")");
break;
case"MP_RESP_DESC":sRespDescrCds=("value("+group.getEventSets()+")");
break;
}}}var sendArr=["^MINE^",criterion.person_id+".0",((component.getScope()==2)?criterion.encntr_id+".0":"0.0"),lookBackUnits,lookBackUnitTypeFlag,sABGCds,sArtificalAirwayCds,sOxygenTherapyCds,sBreathSoundsCds,sRespDescrCds,criterion.provider_id+".0",criterion.ppr_cd+".0",1];
MP_Core.XMLCclRequestWrapper(component,"MP_RETRIEVE_RESP_ASSESSMENTS",sendArr,true);
return;
}};
function EventViewerLink(personid,encntrid,eventid,result){var ar=[];
var params=[personid,encntrid,eventid,'"EVENT"'];
ar.push("<a onclick='MP_Util.LaunchClinNoteViewer(",params.join(","),"); return false;' href='#'>",result,"</a>");
return ar.join("");
}function createAbgContent(abgItem,persId){var abgHTML=[];
var curAbgHdr=[];
var curAbgCont=[];
var colMask="";
var curAbgData=abgItem.ABG_DATA;
var abgResCnt=curAbgData.length;
switch(abgResCnt){case 1:colMask="resa-1col";
break;
case 2:colMask="resa-2col";
break;
case 3:colMask="resa-3col";
break;
case 4:colMask="resa-4col";
break;
case 5:colMask="resa-5col";
break;
case 6:colMask="resa-6col";
break;
default:colMask="";
break;
}abgHTML.push("<table class='resa-abg-table ",colMask,"'><tr class='hdr'>");
for(var i=0;
i<abgResCnt;
i++){var curAbgItem=curAbgData[i];
var curAbgVal=curAbgItem.VALUE;
if(curAbgVal){curAbgVal=EventViewerLink(persId,curAbgItem.ENCOUNTER_ID,curAbgItem.EVENT_ID,curAbgItem.VALUE);
}else{curAbgVal="--";
}curAbgHdr.push("<th class='resa-abg-res'>",curAbgItem.NAME,"</th>");
curAbgCont.push("<td class='resa-abg-res'><span class='res-value'>",curAbgVal,"</span>",getStatusInd(curAbgItem.STATUS),"</td>");
}abgHTML=abgHTML.concat(curAbgHdr);
abgHTML.push("</tr><tr>");
abgHTML=abgHTML.concat(curAbgCont);
abgHTML.push("</tr></table>");
return abgHTML.join("");
}function getStatusInd(stat){var ind="";
if(stat==="MODIFIED"||stat==="ALTERED"){ind="<span class='res-modified'>&nbsp;</span>";
}return ind;
}}();
function RespTreatmentsComponentStyle(){this.initByNamespace("respt");
}RespTreatmentsComponentStyle.inherits(ComponentStyle);
function RespTreatmentsComponent(criterion){this.setCriterion(criterion);
this.setStyles(new RespTreatmentsComponentStyle());
this.setComponentLoadTimerName("USR:MPG.RESP_TREATMENTS.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.RESP_TREATMENTS.O1 - render component");
this.setIncludeLineNumber(false);
RespTreatmentsComponent.method("InsertData",function(){CERN_RESP_TREATMENT_O1.GetRespTreatmentData(this);
});
RespTreatmentsComponent.method("HandleSuccess",function(recordData){CERN_RESP_TREATMENT_O1.RenderRespTreatment(this,recordData);
});
}RespTreatmentsComponent.inherits(MPageComponent);
var CERN_RESP_TREATMENT_O1=function(){return{RenderRespTreatment:function(component,recordData){var countText="",sHTML="",jsHTML=[],nameSpace=component.getStyles().getNameSpace();
var i=0;
var criterion=component.getCriterion();
var personid=criterion.person_id+".0";
var df=new mp_formatter.DateTimeFormatter(MPAGE_LOCALE);
var codeArray=MP_Util.LoadCodeListJSON(recordData.CODES);
var aerosol_therapy_cnt=recordData.AEROSOL_THERAPY_QUAL;
if(aerosol_therapy_cnt>0){jsHTML.push("<div class='sub-sec'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl' title='",i18n.HIDE_SECTION,"'>-</span><span class='sub-sec-title'>",i18n.AEROSOL_THERAPY,"</span></h3><div class='sub-sec-content'><div class='",MP_Util.GetContentClass(component,aerosol_therapy_cnt),"'><h3 class='info-hd'><span>",i18n.AEROSOL_THERAPY_DETAILS,"</span></h3>");
for(i=0;
i<aerosol_therapy_cnt;
i++){var dataElem=recordData.AEROSOL_THERAPY[i];
var statusObj=MP_Util.GetValueFromArray(dataElem.STATUS_CD,codeArray);
var statusMean=statusObj.meaning;
var statusDisp=statusObj.display;
var resultDtTm=new Date();
resultDtTm.setISO8601(dataElem.EVENT_END_DT_TM);
var dataDtTm=df.format(resultDtTm,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_2YEAR);
var hvrDtTm=df.format(resultDtTm,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_4YEAR);
jsHTML.push("<dl class='",nameSpace,"-info'><dt><span>",dataElem.NAME,":</span></dt><dd><span>",EventViewerLink(personid,dataElem.ENCOUNTER_ID,dataElem.EVENT_ID,dataElem.VALUE),"</span>");
if(statusMean=="MODIFIED"||statusMean=="ALTERED"){jsHTML.push("<span class='res-modified'>&nbsp;</span>");
}jsHTML.push("</dd><dd><span class='date-time'>",dataDtTm,"</span></dd></dl>");
if(dataElem.VALUE!="--"){jsHTML.push("<h4 class='det-hd'><span>",i18n.RESULT_DETAILS,"</span></h4><div class='hvr'><dl class='",nameSpace,"-det'><dt><span>",dataElem.NAME,":</span></dt><dd class='",nameSpace,"-det-name'><span>",dataElem.VALUE," ",dataElem.VALUE_UNITS,"</span></dd><dt><span>",i18n.RESULT_DT_TM,":</span></dt><dd><span>",hvrDtTm,"</span></dd><dt><span>",i18n.DOCUMENTED_BY,":</span></dt><dd class='",nameSpace,"-det-ord-by'><span>",dataElem.DOCUMENTED_BY,"</span></dd><dt><span>",i18n.STATUS,":</span></dt><dd class='",nameSpace,"-det-status'><span>",statusDisp,"</span></dd></dl></div>");
}}jsHTML.push("</div></div></div><hr/>");
}var incentive_spiro_cnt=recordData.INCENTIVE_SPIRO_QUAL;
if(incentive_spiro_cnt>0){jsHTML.push("<div class='sub-sec'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl' title='",i18n.HIDE_SECTION,"'>-</span><span class='sub-sec-title'>",i18n.INCENTIVE_SPIROMETRY,"</span></h3><div class='sub-sec-content'><div class='",MP_Util.GetContentClass(component,incentive_spiro_cnt),"'><h3 class='info-hd'><span>",i18n.INCENTIVE_SPIROMETRY_DETAILS,"</span></h3>");
for(i=0;
i<incentive_spiro_cnt;
i++){var dataElem=recordData.INCENTIVE_SPIRO[i];
var statusObj=MP_Util.GetValueFromArray(dataElem.STATUS_CD,codeArray);
var statusMean=statusObj.meaning;
var statusDisp=statusObj.display;
var resultDtTm=new Date();
resultDtTm.setISO8601(dataElem.EVENT_END_DT_TM);
var dataDtTm=df.format(resultDtTm,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_2YEAR);
var hvrDtTm=df.format(resultDtTm,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_4YEAR);
jsHTML.push("<dl class='",nameSpace,"-info'><dt><span>",dataElem.NAME,":</span></dt><dd><span>",EventViewerLink(personid,dataElem.ENCOUNTER_ID,dataElem.EVENT_ID,dataElem.VALUE),"</span>");
if(statusMean=="MODIFIED"||statusMean=="ALTERED"){jsHTML.push("<span class='res-modified'>&nbsp;</span>");
}jsHTML.push("</dd><dd><span class='date-time'>",dataDtTm,"</span></dd></dl>");
if(dataElem.VALUE!="--"){jsHTML.push("<h4 class='det-hd'><span>",i18n.RESULT_DETAILS,"</span></h4><div class='hvr'><dl class='",nameSpace,"-det'><dt><span>",dataElem.NAME,":</span></dt><dd class='",nameSpace,"-det-name'><span>",dataElem.VALUE," ",dataElem.VALUE_UNITS,"</span></dd><dt><span>",i18n.RESULT_DT_TM,":</span></dt><dd><span>",hvrDtTm,"</span></dd><dt><span>",i18n.DOCUMENTED_BY,":</span></dt><dd class='",nameSpace,"-det-ord-by'><span>",dataElem.DOCUMENTED_BY,"</span></dd><dt><span>",i18n.STATUS,":</span></dt><dd class='",nameSpace,"-det-status'><span>",statusDisp,"</span></dd></dl></div>");
}}jsHTML.push("</div></div></div><hr/>");
}var cough_suction_cnt=recordData.COUGH_SUCTION_QUAL;
if(cough_suction_cnt>0){jsHTML.push("<div class='sub-sec'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl' title='",i18n.HIDE_SECTION,"'>-</span><span class='sub-sec-title'>",i18n.COUGH_SUCTION,"</span></h3><div class='sub-sec-content'><div class='",MP_Util.GetContentClass(component,cough_suction_cnt),"'><h3 class='info-hd'><span>",i18n.COUGH_SUCTION_DETAILS,"</span></h3>");
for(i=0;
i<cough_suction_cnt;
i++){var dataElem=recordData.COUGH_SUCTION[i];
var statusObj=MP_Util.GetValueFromArray(dataElem.STATUS_CD,codeArray);
var statusMean=statusObj.meaning;
var statusDisp=statusObj.display;
var resultDtTm=new Date();
resultDtTm.setISO8601(dataElem.EVENT_END_DT_TM);
var dataDtTm=df.format(resultDtTm,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_2YEAR);
var hvrDtTm=df.format(resultDtTm,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_4YEAR);
jsHTML.push("<dl class='",nameSpace,"-info'><dt><span>",dataElem.NAME,":</span></dt><dd><span>",EventViewerLink(personid,dataElem.ENCOUNTER_ID,dataElem.EVENT_ID,dataElem.VALUE),"</span>");
if(statusMean=="MODIFIED"||statusMean=="ALTERED"){jsHTML.push("<span class='res-modified'>&nbsp;</span>");
}jsHTML.push("</dd><dd><span class='date-time'>",dataDtTm,"</span></dd></dl>");
if(dataElem.VALUE!="--"){jsHTML.push("<h4 class='det-hd'><span>",i18n.RESULT_DETAILS,"</span></h4><div class='hvr'><dl class='",nameSpace,"-det'><dt><span>",dataElem.NAME,":</span></dt><dd class='",nameSpace,"-det-name'><span>",dataElem.VALUE," ",dataElem.VALUE_UNITS,"</span></dd><dt><span>",i18n.RESULT_DT_TM,":</span></dt><dd><span>",hvrDtTm,"</span></dd><dt><span>",i18n.DOCUMENTED_BY,":</span></dt><dd class='",nameSpace,"-det-ord-by'><span>",dataElem.DOCUMENTED_BY,"</span></dd><dt><span>",i18n.STATUS,":</span></dt><dd class='",nameSpace,"-det-status'><span>",statusDisp,"</span></dd></dl></div>");
}}jsHTML.push("</div></div></div><hr/>");
}var chest_physio_cnt=recordData.CHEST_PHYSIO_QUAL;
if(chest_physio_cnt>0){jsHTML.push("<div class='sub-sec'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl' title='",i18n.HIDE_SECTION,"'>-</span><span class='sub-sec-title'>",i18n.CHEST_PHYSIOTHERAPY,"</span></h3><div class='sub-sec-content'><div class='",MP_Util.GetContentClass(component,chest_physio_cnt),"'><h3 class='info-hd'><span>",i18n.CHEST_PHYSIOTHERAPY_DETAILS,"</span></h3>");
for(i=0;
i<chest_physio_cnt;
i++){var dataElem=recordData.CHEST_PHYSIO[i];
var statusObj=MP_Util.GetValueFromArray(dataElem.STATUS_CD,codeArray);
var statusMean=statusObj.meaning;
var statusDisp=statusObj.display;
var resultDtTm=new Date();
resultDtTm.setISO8601(dataElem.EVENT_END_DT_TM);
var dataDtTm=df.format(resultDtTm,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_2YEAR);
var hvrDtTm=df.format(resultDtTm,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_4YEAR);
jsHTML.push("<dl class='",nameSpace,"-info'><dt><span>",dataElem.NAME,":</span></dt><dd><span>",EventViewerLink(personid,dataElem.ENCOUNTER_ID,dataElem.EVENT_ID,dataElem.VALUE),"</span>");
if(statusMean=="MODIFIED"||statusMean=="ALTERED"){jsHTML.push("<span class='res-modified'>&nbsp;</span>");
}jsHTML.push("</dd><dd><span class='date-time'>",dataDtTm,"</span></dd></dl>");
if(dataElem.VALUE!="--"){jsHTML.push("<h4 class='det-hd'><span>",i18n.RESULT_DETAILS,"</span></h4><div class='hvr'><dl class='",nameSpace,"-det'><dt><span>",dataElem.NAME,":</span></dt><dd class='",nameSpace,"-det-name'><span>",dataElem.VALUE," ",dataElem.VALUE_UNITS,"</span></dd><dt><span>",i18n.RESULT_DT_TM,":</span></dt><dd><span>",hvrDtTm,"</span></dd><dt><span>",i18n.DOCUMENTED_BY,":</span></dt><dd class='",nameSpace,"-det-ord-by'><span>",dataElem.DOCUMENTED_BY,"</span></dd><dt><span>",i18n.STATUS,":</span></dt><dd class='",nameSpace,"-det-status'><span>",statusDisp,"</span></dd></dl></div>");
}}jsHTML.push("</div></div></div><hr />");
}countText="";
sHTML+=jsHTML.join("");
MP_Util.Doc.FinalizeComponent(sHTML,component,countText);
return;
},GetRespTreatmentData:function(component){var criterion=component.getCriterion();
var lookBackUnits=component.getLookbackUnits();
var lookBackUnitTypeFlag=component.getLookbackUnitTypeFlag();
var sAerosolTherapyCds="0.0";
var sIncentiveSpiroCds="0.0";
var sCoughSuctionCds="0.0";
var sChestPhysioCds="0.0";
var groups=component.getGroups();
var xl=(groups!=null)?groups.length:0;
for(var x=0;
x<xl;
x++){var group=groups[x];
if(group instanceof MPageEventSetGroup){grpName=group.getGroupName();
switch(grpName){case"MP_RESP_AER":sAerosolTherapyCds=("value("+group.getEventSets()+")");
break;
case"MP_RESP_INCENT":sIncentiveSpiroCds=("value("+group.getEventSets()+")");
break;
case"MP_RESP_COUGH":sCoughSuctionCds=("value("+group.getEventSets()+")");
break;
case"MP_RESP_CHEST_PHYS":sChestPhysioCds=("value("+group.getEventSets()+")");
break;
}}}var sendArr=["^MINE^",criterion.person_id+".0",((component.getScope()==2)?criterion.encntr_id+".0":"0.0"),lookBackUnits,lookBackUnitTypeFlag,sAerosolTherapyCds,sIncentiveSpiroCds,sCoughSuctionCds,sChestPhysioCds,criterion.provider_id+".0",criterion.ppr_cd+".0"];
MP_Core.XMLCclRequestWrapper(component,"MP_RETRIEVE_RESP_TREATMENTS",sendArr,true);
return;
}};
function EventViewerLink(personid,encntrid,eventid,result){var ar=[];
var params=[personid,encntrid,eventid,'"EVENT"'];
ar.push("<a onclick='MP_Util.LaunchClinNoteViewer(",params.join(","),"); return false;' href='#'>",result,"</a>");
return ar.join("");
}}();
function SocialComponentStyle(){this.initByNamespace("soc");
}SocialComponentStyle.inherits(ComponentStyle);
function SocialComponent(criterion){this.setCriterion(criterion);
this.setStyles(new SocialComponentStyle());
this.setComponentLoadTimerName("USR:MPG.SOCIAL.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.SOCIAL.O1 - render component");
this.setIncludeLineNumber(true);
this.setScope(2);
this.setResultCount(1);
SocialComponent.method("HandleSuccess",function(replyAr,component){CERN_SOCIAL_O1.RenderComponent(component,replyAr[0].getResponse());
});
SocialComponent.method("openTab",function(){var criterion=this.getCriterion();
var paramString=criterion.person_id+"|"+criterion.encntr_id+"|"+0+"|0|0";
MP_Util.LogMpagesEventInfo(this,"POWERFORM",paramString,"social.js","openTab");
MPAGES_EVENT("POWERFORM",paramString);
this.InsertData();
});
SocialComponent.method("openDropDown",function(formID){var criterion=this.getCriterion();
var paramString=criterion.person_id+"|"+criterion.encntr_id+"|"+formID+"|0|0";
MP_Util.LogMpagesEventInfo(this,"POWERFORM",paramString,"social.js","openDropDown");
MPAGES_EVENT("POWERFORM",paramString);
this.InsertData();
});
}SocialComponent.inherits(MeasurementBaseComponent);
var CERN_SOCIAL_O1=function(){return{RenderComponent:function(component,recordData){var timerRenderComponent=MP_Util.CreateTimer(component.getComponentRenderTimerName());
try{var sHTML="",countText="";
var ar=[];
var codeArray=MP_Util.LoadCodeListJSON(recordData.CODES);
var personnelArray=MP_Util.LoadPersonelListJSON(recordData.PRSNL);
var measureArray=CERN_MEASUREMENT_BASE_O1.LoadMeasurementDataArray(recordData,personnelArray,codeArray);
var df=new mp_formatter.DateTimeFormatter(MPAGE_LOCALE);
var measLen=measureArray.length;
ar.push("<div class='",MP_Util.GetContentClass(component,measLen),"'>");
for(var i=0,l=measureArray.length;
i<l;
i++){var measObject=measureArray[i];
var display=measObject.getEventCode().display;
var oDate=measObject.getDateTime();
var sDate=(oDate)?df.format(oDate,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_2YEAR):"";
ar.push("<dl class='soc-info'><dt class='soc-disp-lbl'>",display,"</dt><dd class='soc-name'>",display,"</dd><dt class='soc-res-lbl'>",i18n.discernabu.social_o1.RESULT," </dt><dd class='soc-res'>");
ar.push(MP_Util.Measurement.GetNormalcyResultDisplay(measObject));
ar.push("</dd><dt class='socdate'>",sDate,"</dt><dd class='soc-dt'><span class='date-time'>",sDate,"</span></dd></dl>");
}ar.push("</div>");
sHTML=ar.join("");
countText=MP_Util.CreateTitleText(component,measLen);
var compNS=component.getStyles().getNameSpace();
MP_Util.Doc.FinalizeComponent(sHTML,component,countText);
}catch(err){if(timerRenderComponent){timerRenderComponent.Abort();
timerRenderComponent=null;
}throw (err);
}finally{if(timerRenderComponent){timerRenderComponent.Stop();
}}}};
}();
function SocialHistoryComponentStyle(){this.initByNamespace("sh");
}SocialHistoryComponentStyle.inherits(ComponentStyle);
function SocialHistoryComponent(criterion){this.setCriterion(criterion);
this.setStyles(new SocialHistoryComponentStyle());
this.setComponentLoadTimerName("USR:MPG.SOCIAL_HISTORY.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.SOCIAL_HISTORY.O1 - render component");
this.setIncludeLineNumber(true);
this.setScope(1);
SocialHistoryComponent.method("InsertData",function(){CERN_SOCIAL_HISTORY_O1.GetSocialHistoryTable(this);
});
SocialHistoryComponent.method("HandleSuccess",function(recordData){CERN_SOCIAL_HISTORY_O1.RenderComponent(this,recordData);
});
}SocialHistoryComponent.inherits(MPageComponent);
var CERN_SOCIAL_HISTORY_O1=function(){return{GetSocialHistoryTable:function(component){var sendAr=[];
var criterion=component.getCriterion();
sendAr.push("^MINE^",criterion.person_id+".0",criterion.provider_id+".0",criterion.ppr_cd+".0");
MP_Core.XMLCclRequestWrapper(component,"MP_GET_SOCIAL_HISTORY",sendAr,true);
},RenderComponent:function(component,recordData){var timerRenderComponent=MP_Util.CreateTimer(component.getComponentRenderTimerName());
try{var i=0;
var j=0;
var k=0;
var shhtml="";
var socialCnt=0;
var social="";
var socDetlCnt=0;
var socDetl="";
var comntCnt=0;
var comment="";
var shArray=[];
var category="";
var riskAssessment="";
var updatedPrsn="";
var personnelArray=MP_Util.LoadPersonelListJSON(recordData.PRSNL);
var codeArray=MP_Util.LoadCodeListJSON(recordData.CODES);
var df=new mp_formatter.DateTimeFormatter(MPAGE_LOCALE);
var updateDT=new Date();
socialCnt=recordData.SOCIAL_CNT;
shArray.push("<div class ='",MP_Util.GetContentClass(component,socialCnt),"'>");
for(i=0;
i<socialCnt;
i++){social=recordData.SOCIAL[i];
category=social.CATEGORY;
if(social.RISK_ASSESSMENT_CD>0){var eventObj=MP_Util.GetValueFromArray(social.RISK_ASSESSMENT_CD,codeArray);
riskAssessment=eventObj.display;
}else{riskAssessment="";
}var detailTxt="";
var detailTag="";
if(social.SHX_DETAIL_CNT>0){for(j=0,socDetlCnt=social.SHX_DETAIL_CNT;
j<socDetlCnt;
j++){socDetl=social.SHX_DETAIL[j];
detailTxt+=socDetl.DETAIL_TEXT+"<br />";
}detailTag=i18n.DETAILS;
}var updatedTime="";
if(social.UPDT_DT_TM!=""){updateDT.setISO8601(social.UPDT_DT_TM);
updatedTime=df.format(updateDT,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_4YEAR);
}if(social.UPDT_PRSNL_ID>0){var prsnlObj=MP_Util.GetValueFromArray(social.UPDT_PRSNL_ID,personnelArray);
updatedPrsn=prsnlObj.fullName;
}else{updatedPrsn="";
}var commentTxt="";
if(social.COMMENT_CNT>0){for(k=0,comntCnt=social.COMMENT_CNT;
k<comntCnt;
k++){comment=social.COMMENTS[k];
commentTxt+=comment.COMMENT_TXT+"<br />";
}}shArray.push("<dl class='sh-info'><dt>",i18n.SOCIAL_HISTORY_INFORMATION,"</dt><dd class = 'sh-risk'><span class='sh-cat'>",category,":</span><span class='sh-assess detail-line'>",riskAssessment,"</span></dd><dd class='sh-flag'><span>",detailTag,"</span></dd></dl> <h4 class='det-hd'>",i18n.SOCIAL_HISTORY_DETAILS,":</h4> <div class= 'hvr'><dl class='sh-det'><dt><span>",i18n.CATEGORY,":</span></dt><dd><span>",category,"</span></dd><dt><span>",i18n.DETAILS,":</span></dt><dd><span>",detailTxt,"</span></dd><dt><span>",i18n.LAST_UPDATED,":</span></dt><dd><span>",updatedTime,"</span></dd><dt><span>",i18n.LAST_UPDATED_BY,":</span></dt><dd><span>",updatedPrsn,"</span></dd><dt><span>",i18n.COMMENTS,":</span></dt><dd><span>",commentTxt,"</span></dd></dl></div>");
}shArray.push("</div>");
shhtml=shArray.join("");
countText=MP_Util.CreateTitleText(component,socialCnt);
MP_Util.Doc.FinalizeComponent(shhtml,component,countText);
}catch(err){if(timerRenderComponent){timerRenderComponent.Abort();
timerRenderComponent=null;
}throw (err);
}finally{if(timerRenderComponent){timerRenderComponent.Stop();
}}}};
}();
function VisitsComponentStyle(){this.initByNamespace("vis");
}VisitsComponentStyle.inherits(ComponentStyle);
function VisitsComponent(criterion){this.setCriterion(criterion);
this.setStyles(new VisitsComponentStyle());
this.setComponentLoadTimerName("USR:MPG.VISITS.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.VISITS.O1 - render component");
this.setScope(1);
this.setIncludeLineNumber(true);
VisitsComponent.method("HandleSuccess",function(recordData){CERN_VISITS_O1.RenderComponent(this,recordData);
});
VisitsComponent.method("InsertData",function(){CERN_VISITS_O1.GetVisits(this);
});
}VisitsComponent.inherits(MPageComponent);
var CERN_VISITS_O1=function(){return{GetVisits:function(component){var sendAr=[];
var program="mp_get_visits";
var criterion=component.getCriterion();
var prsnlInfo=criterion.getPersonnelInfo();
var encntrs=prsnlInfo.getViewableEncounters();
var encntrVal=(encntrs)?"value("+encntrs+")":"0.0";
sendAr.push("^MINE^",criterion.person_id+".0",criterion.provider_id+".0",encntrVal);
MP_Core.XMLCclRequestWrapper(component,program,sendAr,true);
return;
},RenderComponent:function(component,recordData){var timerRenderComponent=MP_Util.CreateTimer(component.getComponentRenderTimerName());
try{var countText="";
var jsHTML=[];
var jsonPrevious=[];
var jsonFuture=[];
var jsPrevious=[];
var jsFuture=[];
var visitCount=recordData.VISIT_CNT;
var futureCount=recordData.FUTURE_VISIT_CNT;
for(var p=0;
p<visitCount;
p++){jsonPrevious.push(recordData.VISIT[p]);
}for(var f=futureCount;
f--;
){jsonFuture.push(recordData.FUTURE_VISIT[f]);
}jsonFuture.sort(VisitSorter);
jsHTML=populateSubSections(jsonPrevious,i18n.PREVIOUS);
jsHTML=jsHTML.concat(populateSubSections(jsonFuture,i18n.FUTURE));
var visLen=visitCount+futureCount;
var content=[];
content.push("<div class ='",MP_Util.GetContentClass(component,visLen),"'>",jsHTML.join(""),"</div>");
var vishtml=content.join("");
countText=MP_Util.CreateTitleText(component,visLen);
MP_Util.Doc.FinalizeComponent(vishtml,component,countText);
}catch(err){alert("An error has occurred in Visits : "+err.name+" - "+err.message);
if(timerRenderComponent){timerRenderComponent.Abort();
timerRenderComponent=null;
}}finally{if(timerRenderComponent){timerRenderComponent.Stop();
}}}};
function VisitSorter(a,b){var aDate=a.DATE;
var bDate=b.DATE;
if(aDate>bDate){return 1;
}else{if(aDate<bDate){return -1;
}else{return 0;
}}}function VisitSorterRev(a,b){var aDate=a.DATE;
var bDate=b.DATE;
if(aDate>bDate){return -1;
}else{if(aDate<bDate){return 1;
}else{return 0;
}}}function populateSubSections(jsData,sectionName){var DataCount=jsData.length;
var jsSection=[];
var jsHTMLContent=[];
for(p=0;
p<DataCount;
p++){var DataObj=jsData[p];
var dateTime=new Date();
dateTime.setISO8601(DataObj.DATE);
jsSection.push("<dl class='vis-info'>","<dt class='vis-dt'>",i18n.DATE,"</dt>","<dd class='vis-dt'>",dateTime.format("shortDate3"),"</dd><dt class='vis-tp'>",i18n.TYPE,"</dt>","<dd class='vis-tp'>",DataObj.TYPE,"</dd>","<dt class='vis-lc'>",i18n.LOCATION,"</dt>","<dd class='vis-lc'>",DataObj.LOCATION," </dd></dl>","<h4 class='det-hd'><span>",i18n.VISIT_DETAILS,"</span></h4>","<div class='hvr'><dl class='vis-det'>","<dt class='vis-det-vr'><span>",i18n.VISIT_REASON,":</span></dt>","<dd class='vis-det-vr'>",DataObj.DESCRIPTION,"</dd></dl> </div>");
}jsHTMLContent.push("<div class='sub-sec'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl' title='",i18n.HIDE_SECTION,"'>-</span><span class='sub-sec-title'>",sectionName," (",DataCount,") </span></h3>","<div class='sub-sec-content'>","<div class='content-hdr'><dl class ='vis-info-hdr hdr'>","<dd class ='vis-dt'><span>",i18n.DATE,"</span></dd>","<dd class ='vis-tp'><span>",i18n.TYPE,"</span></dd>","<dd class ='vis-lc'><span>",i18n.LOCATION,"</span></dd></dl></div>","<div class='content-body'>");
if(jsSection.length>0){jsHTMLContent.push(jsSection.join(""));
}else{jsHTMLContent.push("<span class='res-none'>",i18n.NO_RESULTS_FOUND,"</span>");
}jsHTMLContent.push("</div></div></div>");
return jsHTMLContent;
}}();
function VitalSignComponentStyle(){this.initByNamespace("vs");
}VitalSignComponentStyle.inherits(ComponentStyle);
function VitalSignComponent(criterion){this.setCriterion(criterion);
this.setStyles(new VitalSignComponentStyle());
this.setIncludeLineNumber(false);
this.m_graphLink=1;
this.setResultCount(3);
this.setIncludeEventSetInfo(true);
this.setComponentLoadTimerName("USR:MPG.VITALSIGNS.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.VITALSIGNS.O1 - render component");
VitalSignComponent.method("HandleSuccess",function(replyAr,component){CERN_VITALSIGN_O1.RenderComponent(component,replyAr);
});
VitalSignComponent.method("setGraphFlag",function(value){this.m_graphLink=value;
});
VitalSignComponent.method("getGraphFlag",function(){return(this.m_graphLink);
});
VitalSignComponent.method("openTab",function(){var paramString=criterion.person_id+"|"+criterion.encntr_id+"|"+0+"|0|0";
MPAGES_EVENT("POWERFORM",paramString);
CERN_EventListener.fireEvent(null,this,EventListener.EVENT_CLINICAL_EVENT,"VitalSigns");
});
VitalSignComponent.method("openDropDown",function(formID){var criterion=this.getCriterion();
var paramString=criterion.person_id+"|"+criterion.encntr_id+"|"+formID+"|0|0";
MPAGES_EVENT("POWERFORM",paramString);
CERN_EventListener.fireEvent(null,this,EventListener.EVENT_CLINICAL_EVENT,"VitalSigns");
});
VitalSignComponent.method("refresh",function(event,args){this.setEditMode(true);
MP_Util.Doc.HideHovers();
this.InsertData();
});
CERN_EventListener.addListener(this,EventListener.EVENT_CLINICAL_EVENT,this.refresh,this);
}VitalSignComponent.inherits(MeasurementBaseComponent);
var CERN_VITALSIGN_O1=function(){var VitalTable=function(seqGroup){var m_seqGroup=seqGroup;
var m_rows=[];
var m_eventSets=[];
this.addRows=function(group,recordData){var vitalsI18N=i18n.discernabu.vitals_o1;
var results=null;
var oVitalRow=null;
switch(group.getGroupName()){case vitalsI18N.TEMPERATURE:case vitalsI18N.HEART_RATE:case vitalsI18N.BLOOD_PRESSURE:results=CERN_MEASUREMENT_BASE_O1.LoadMeasurementDataArray(recordData);
oVitalRow=new VitalRow(group,m_seqGroup);
oVitalRow.init(results);
m_rows.push(oVitalRow);
break;
default:results=CERN_MEASUREMENT_BASE_O1.LoadMeasurementDataMap(recordData);
flattenEventSets(recordData.EVENT_SETS);
for(var x=results.length;
x--;
){oVitalRow=new VitalRow(group,m_seqGroup);
var result=results[x];
oVitalRow.setId(m_eventSets[result.name]);
oVitalRow.init(result);
m_rows.push(oVitalRow);
}break;
}};
this.getRows=function(){return m_rows;
};
function flattenEventSets(eventSets){if(eventSets&&!m_eventSets.length){for(var x=eventSets.length;
x--;
){var eventSet=eventSets[x];
m_eventSets[eventSet.EVENT_SET_NAME]=eventSet.EVENT_SET_CD;
}}}};
var BPResult=function(label,measAr){var m_ar=measAr;
var m_disp=label;
var m_date=null;
if(measAr&&measAr.length>0){m_date=(measAr[0])?measAr[0].getDateTime():measAr[1].getDateTime();
}this.getDisplay=function(){return m_disp;
};
this.getResults=function(){return m_ar;
};
this.getDateTime=function(){return m_date;
};
};
var VitalRow=function(group,seqGroup){var m_dis=null;
var m_seq=0;
var m_id=0;
var m_measAr=null;
var m_type=0;
var m_group=group;
var m_seqGroup=seqGroup;
this.init=function(results){var vitalsI18N=i18n.discernabu.vitals_o1;
switch(m_group.getGroupName()){case vitalsI18N.TEMPERATURE:m_seq=1;
m_measAr=results;
m_dis=vitalsI18N.TEMPERATURE;
m_id=m_group.getGroupId();
m_type=CERN_VITALSIGN_O1.TYPE_TEMPERATURE;
break;
case vitalsI18N.HEART_RATE:m_seq=2;
m_measAr=results;
m_dis=vitalsI18N.HEART_RATE;
m_id=m_group.getGroupId();
m_type=CERN_VITALSIGN_O1.TYPE_STANDARD_GROUPING;
break;
case vitalsI18N.BLOOD_PRESSURE:m_seq=3;
m_measAr=pairResults(results);
m_dis=vitalsI18N.BLOOD_PRESSURE;
m_id=m_group.getGroupId();
m_type=CERN_VITALSIGN_O1.TYPE_BLOOD_PRESSURE;
break;
default:m_seq=4;
m_measAr=results.value;
m_dis=results.name;
m_type=CERN_VITALSIGN_O1.TYPE_DISCRETE_RESULT;
break;
}if(m_seqGroup){var items=m_seqGroup.getItems();
for(var x=items.length;
x--;
){if(items[x]===m_id){m_seq=x;
break;
}}}};
this.getDisplay=function(){return m_dis;
};
this.getSequence=function(){return m_seq;
};
this.setId=function(val){m_id=val;
};
this.getId=function(){return m_id;
};
this.getMeasureArray=function(){return m_measAr;
};
this.getType=function(){return m_type;
};
this.getEventSets=function(){if(m_group instanceof MPageEventSetGroup){return m_group.getEventSets();
}return null;
};
function pairResults(meas){var bpMeas1=[];
var bpMeas2=[];
var bpMeas3=[];
var measCnt=0;
var label1="";
var label2="";
var label3="";
var currMeas=0;
var bpEventCds=[];
for(var j=0;
((j<meas.length)&&(measCnt<3));
j++){currMeas=meas[j];
var k=j;
var matchFound=false;
var label=[];
var meas1,meas2;
if(currMeas!=-1){if(k+1<(meas.length)){while(currMeas.getDateTime().getTime()==meas[k+1].getDateTime().getTime()){if(currMeas.getUpdateDateTime().getTime()==meas[k+1].getUpdateDateTime().getTime()){label=checkBPPair(currMeas.getEventCode().codeValue,meas[k+1].getEventCode().codeValue,group);
if(label[0]){matchFound=true;
measCnt++;
if(label[1]){meas1=currMeas;
meas2=meas[k+1];
}else{meas2=currMeas;
meas1=meas[k+1];
}if(measCnt==1){bpMeas1.push(meas1);
bpMeas1.push(meas2);
label1=label[0];
}if(measCnt==2){bpMeas2.push(meas1);
bpMeas2.push(meas2);
label2=label[0];
}if(measCnt==3){bpMeas3.push(meas1);
bpMeas3.push(meas2);
label3=label[0];
}meas.splice(k+1,1);
break;
}}k++;
if(k>=(meas.length-1)){break;
}}}if(!matchFound){measCnt++;
var labelOrder=getBPLabel(currMeas.getEventCode().codeValue,group);
if(labelOrder[1]==0){meas1=currMeas;
meas2=0;
}else{meas2=currMeas;
meas1=0;
}if(measCnt==1){bpMeas1.push(meas1);
bpMeas1.push(meas2);
label1=labelOrder[0];
}if(measCnt==2){bpMeas2.push(meas1);
bpMeas2.push(meas2);
label2=labelOrder[0];
}if(measCnt==3){bpMeas3.push(meas1);
bpMeas3.push(meas2);
label3=labelOrder[0];
}}}}var returnAr=[];
if(bpMeas1&&bpMeas1.length>0){returnAr.push(new BPResult(label1,bpMeas1));
}if(bpMeas2&&bpMeas2.length>0){returnAr.push(new BPResult(label2,bpMeas2));
}if(bpMeas3&&bpMeas3.length>0){returnAr.push(new BPResult(label3,bpMeas3));
}return returnAr;
}function getBPLabel(codeValue,group){if(group instanceof MPageGrouper){var bpGroups=group.getGroups();
for(var y=0;
y<bpGroups.length;
y++){if(bpGroups[y] instanceof MPageEventCodeGroup){var groupName=bpGroups[y].getGroupName();
ecArry=bpGroups[y].getEventCodes();
for(var i=0;
i<ecArry.length;
i++){if(ecArry[i]==codeValue){if(i==0){return[groupName,0];
}else{return[groupName,1];
}}}}}}}function checkBPPair(eventCd1,eventCd2,group){var cd1Fnd=false,cd2Fnd=false;
var ec="";
var correctOrder=true;
var ecArry=[];
if(group instanceof MPageGrouper){var bpGroups=group.getGroups();
for(var y=0;
y<bpGroups.length;
y++){if(bpGroups[y] instanceof MPageEventCodeGroup){ecArry=bpGroups[y].getEventCodes();
for(var i=0;
i<ecArry.length;
i++){if(ecArry[i]==eventCd1){cd1Fnd=true;
if(i==0){correctOrder=true;
}else{correctOrder=false;
}}else{if(ecArry[i]==eventCd2){cd2Fnd=true;
}}}if(cd1Fnd&&cd2Fnd){return([bpGroups[y].getGroupName(),correctOrder]);
}}cd1Fnd=false;
cd2Fnd=false;
}}return([false,false]);
}};
var HoverResults=function(oMeasure){var m_df=MP_Util.GetDateFormatter();
var m_normalcy=MP_Util.Measurement.GetNormalcyClass(oMeasure);
var m_date=m_df.format(oMeasure.getDateTime(),mp_formatter.DateTimeFormatter.FULL_DATE_TIME_4YEAR);
var m_display=(oMeasure.getEventCode())?oMeasure.getEventCode().display:"";
var m_status=(oMeasure.getStatus())?oMeasure.getStatus().display:"";
var m_sResult=MP_Util.Measurement.GetString(oMeasure);
var m_sCritHigh="",m_sCritLow="",m_sNormHigh="",m_sNormLow="";
var m_results=oMeasure.getResult();
if(m_results instanceof MP_Core.QuantityValue){var refRange=m_results.getRefRange();
if(refRange){if(refRange.getCriticalHigh()!=0||refRange.getCriticalLow()!=0){m_sCritHigh=refRange.getCriticalHigh();
m_sCritLow=refRange.getCriticalLow();
}if(refRange.getNormalHigh()!=0||refRange.getNormalLow()!=0){m_sNormHigh=refRange.getNormalHigh();
m_sNormLow=refRange.getNormalLow();
}}}this.getDisplay=function(){return m_display;
};
this.getStatus=function(){return m_status;
};
this.getDateTime=function(){return m_date;
};
this.getNormalcy=function(){return m_normalcy;
};
this.getCriticalHigh=function(){return m_sCritHigh;
};
this.getCriticalLow=function(){return m_sCritLow;
};
this.getNormalHigh=function(){return m_sNormHigh;
};
this.getNormalLow=function(){return m_sNormLow;
};
this.getResultDisplay=function(){return m_sResult;
};
this.toHTML=function(){var vitalsI18n=i18n.discernabu.vitals_o1;
var ar=["<h4 class='det-hd'><span>",vitalsI18n.LABORATORY_DETAILS,"</span></h4><div class='hvr'><dl class='vs-det'><dt class='vs-det-type'><span>",m_display,":</span></dt><dd class='result'><span class='",m_normalcy,"'>",m_sResult,"</span></dd><dt class='vs-det-type'><span>",vitalsI18n.DATE_TIME,":</span></dt><dd class='result'><span>",m_date,"</span></dd><dt class='vs-det-type'><span>",vitalsI18n.STATUS,":</span></dt><dd class='result'><span>",m_status,"</span></dd><dt class='vs-det-type'><span>",vitalsI18n.NORMAL_LOW,":</span></dt><dd class='result'><span>",m_sNormLow,"</span></dd><dt class='vs-det-type'><span>",vitalsI18n.NORMAL_HIGH,":</span></dt><dd class='result'><span>",m_sNormHigh,"</span></dd><dt class='vs-det-type'><span>",vitalsI18n.CRITICAL_LOW,":</span></dt><dd class='result'><span>",m_sCritLow,"</span></dd><dt class='vs-det-type'><span>",vitalsI18n.CRITICAL_HIGH,":</span></dt><dd class='result'><span>",m_sCritHigh,"</span></dd></dl></div>"];
return ar.join("");
};
};
return{RenderComponent:function(component,replyAr){var timerRenderComponent=MP_Util.CreateTimer(component.getComponentRenderTimerName());
try{var ar=[];
var x=0,y=0,xl=0;
var vitalsI18n=i18n.discernabu.vitals_o1;
var seqGroup=null;
var withinText=(component.getDateFormat()==3)?("<span>"+vitalsI18n.WITHIN+"</span>"):"";
var groups=component.getGroups();
for(x=groups.length;
x--;
){if(groups[x] instanceof MPageSequenceGroup){seqGroup=groups[x];
break;
}}var oVitalTable=new VitalTable(seqGroup);
for(x=replyAr.length;
x--;
){var reply=replyAr[x];
if(reply.getStatus()==="S"){for(y=groups.length;
y--;
){var group=groups[y];
if(group.getGroupName()===reply.getName()){oVitalTable.addRows(group,reply.getResponse());
}}}}var vitalRows=oVitalTable.getRows();
vitalRows.sort(SortVitalRows);
ar.push("<div class='",MP_Util.GetContentClass(component,vitalRows.length),"'>");
ar.push("<div class='content-hdr'><table class='vs-table'><tr class='hdr'><th class='vs-lbl'><span>&nbsp;</span></th><th class='vs-res0'><span>",vitalsI18n.LATEST,"</span><br /><span>",withinText,"</span></th><th class='vs-res1'><span>",vitalsI18n.PREVIOUS,"</span><br /><span>",withinText,"</span></th></tr></table><table class='vs-table'>");
for(x=0,xl=vitalRows.length;
x<xl;
x++){ar.push("<tr class='",((x%2)==0)?"odd":"even","'>");
ar.push(createVitalRow(vitalRows[x],component));
ar.push("</tr>");
}ar.push("</table></div></div>");
var sHTML=ar.join("");
var countText=MP_Util.CreateTitleText(component,vitalRows.length);
MP_Util.Doc.FinalizeComponent(sHTML,component,countText);
}catch(err){if(timerRenderComponent){timerRenderComponent.Abort();
timerRenderComponent=null;
}throw (err);
}finally{if(timerRenderComponent){timerRenderComponent.Stop();
}component.setEditMode(false);
}}};
function createVitalRow(row,component){var ar=[];
if(component.getGraphFlag()===1){var compId=component.getComponentId();
var groupId=(row.getType()!==CERN_VITALSIGN_O1.TYPE_DISCRETE_RESULT)?row.getId():0;
var eventCode=(row.getType()===CERN_VITALSIGN_O1.TYPE_DISCRETE_RESULT)?row.getMeasureArray()[0].getEventCode().codeValue:0;
ar.push("<td class='vs-lbl'><span class='row-label'><a onClick='MP_Util.GraphResults(",eventCode,",",compId,",",groupId,");'>",row.getDisplay(),"</a></span></td>");
}else{ar.push("<td class='vs-lbl'><span class='row-label'>",row.getDisplay(),"</span></td>");
}ar.push(createVitalCells(row,component));
return ar.join("");
}function createVitalCells(row,component){var ar=[];
var x=0;
var vitalsI18n=i18n.discernabu.vitals_o1;
var oMeasures=row.getMeasureArray();
var nMeasures=(oMeasures.length>3)?3:oMeasures.length;
for(x=0;
x<nMeasures;
x++){var oVal=oMeasures[x];
var faceUpDtTm=null;
if(row.getType()!==CERN_VITALSIGN_O1.TYPE_BLOOD_PRESSURE){faceUpDtTm=MP_Util.DisplayDateByOption(component,oVal.getDateTime());
var includeMaxResult=(row.getType()===CERN_VITALSIGN_O1.TYPE_TEMPERATURE&&x===0)?true:false;
if(includeMaxResult){var criterion=component.getCriterion();
var sEncntr=(component.getScope()==2)?criterion.encntr_id+".0":"0.0";
var sEventSets=MP_Util.CreateParamArray(row.getEventSets(),1);
var tempAr=[criterion.person_id+".0",sEncntr,criterion.provider_id+".0",criterion.position_cd+".0",'"'+sEventSets+'"'];
ar.push("<td onmouseover='CERN_VITALSIGNS_O1_UTIL.GetMaxMinTempResult(this, ",tempAr.join(","),");' class='vs-res",x,"'>");
}else{ar.push("<td class='vs-res",x,"'>");
}ar.push("<dl class='vs-info'><dt><span>",vitalsI18n.VALUE,"</span></dt><dd class='vs-res'>",MP_Util.Measurement.GetNormalcyResultDisplay(oVal,true),"<br /><span class='within'>",faceUpDtTm,"</span></dd></dl>",createVitalCellHover(oVal),"</td>");
}else{var resAr=oVal.getResults();
faceUpDtTm=MP_Util.DisplayDateByOption(component,oVal.getDateTime());
var sRes1=(resAr[0])?MP_Util.Measurement.GetNormalcyResultDisplay(resAr[0],true):"--";
var sRes2=(resAr[1])?MP_Util.Measurement.GetNormalcyResultDisplay(resAr[1],true):"--";
ar.push("<td class='vs-res",x,"'><dl class='vs-info'><dt><span>",vitalsI18n.VALUE,"</span></dt><dd class='vs-res'>",sRes1,"/",sRes2,"<br /><span class='within'>",faceUpDtTm,"</span></dd></dl>",createVitalCellHover(oVal),"</td>");
}}for(x=nMeasures;
x<3;
x++){ar.push("<td class='vs-res",x,"'><dl class='vs-info'><dt><span>",vitalsI18n.VALUE,"</span></dt><dd class='vs-res'><span>--</span></dd></dl></td>");
}return ar.join("");
}function createBPHoverSpan(val1,val2,label,spanClass1,spanClass2){if((!val1||val1==="")&&(!val2||val2==="")){return("<dt class='vs-det-type'><span>"+label+":</span></dt><dd class='result'></dd>");
}var returnAr=["<dt class='vs-det-type'><span>",label,":</span></dt><dd class='result'>"];
var span1=(spanClass1)?"<span class='"+spanClass1+"'>":"<span>";
var span2=(spanClass2)?"<span class='"+spanClass2+"'>":"<span>";
if(val1&&val1!==""){returnAr.push(span1,val1,"</span>");
}else{returnAr.push(span1,"--</span>");
}returnAr.push(" / ");
if(val2&&val2!==""){returnAr.push(span2,val2,"</span>");
}else{returnAr.push(span2,"--</span>");
}returnAr.push("</dd>");
return returnAr.join("");
}function createVitalCellHover(meas){var ar=[];
var vitalsI18n=i18n.discernabu.vitals_o1;
if(meas instanceof BPResult){var df=new mp_formatter.DateTimeFormatter(MPAGE_LOCALE);
var measAr=meas.getResults();
var meas1=measAr[0];
var meas2=measAr[1];
var hov1=(meas1)?new HoverResults(meas1):null;
var hov2=(meas2)?new HoverResults(meas2):null;
var resVal1=null;
var resVal2=null;
var resNormalcy1=null;
var resNormalcy2=null;
var normLow1=null;
var normLow2=null;
var normHigh1=null;
var normHigh2=null;
var critLow1=null;
var critLow2=null;
var critHigh1=null;
var critHigh2=null;
var status1=null;
var status2=null;
var dateTime=null;
if(meas1){resNormalcy1=hov1.getNormalcy();
resVal1=hov1.getResultDisplay();
normLow1=hov1.getNormalLow();
normHigh1=hov1.getNormalHigh();
critLow1=hov1.getCriticalLow();
critHigh1=hov1.getCriticalHigh();
status1=hov1.getStatus();
dateTime=hov1.getDateTime();
}if(meas2){resNormalcy2=hov2.getNormalcy();
resVal2=hov2.getResultDisplay();
normLow2=hov2.getNormalLow();
normHigh2=hov2.getNormalHigh();
critLow2=hov2.getCriticalLow();
critHigh2=hov2.getCriticalHigh();
status2=hov2.getStatus();
dateTime=hov2.getDateTime();
}ar.push("<h4 class='det-hd'><span>",vitalsI18n.LABORATORY_DETAILS,"</span></h4><div class='hvr'><dl class='vs-det'>",createBPHoverSpan(resVal1,resVal2,meas.getDisplay(),resNormalcy1,resNormalcy2),"<dt class='vs-det-type'><span>",vitalsI18n.DATE_TIME,":</span></dt><dd class='result'><span>",dateTime,"</span></dd>",createBPHoverSpan(status1,status2,vitalsI18n.STATUS),createBPHoverSpan(normLow1,normLow2,vitalsI18n.NORMAL_LOW),createBPHoverSpan(normHigh1,normHigh2,vitalsI18n.NORMAL_HIGH),createBPHoverSpan(critLow1,critLow2,vitalsI18n.CRITICAL_LOW),createBPHoverSpan(critHigh1,critHigh2,vitalsI18n.CRITICAL_HIGH));
ar.push("</dl></div>");
}else{var hover=new HoverResults(meas);
ar.push(hover.toHTML());
}return ar.join("");
}function SortVitalRows(a,b){if(a.getSequence()>b.getSequence()){return 1;
}else{if(a.getSequence()<b.getSequence()){return -1;
}}if(a.getDisplay().toUpperCase()>b.getDisplay().toUpperCase()){return 1;
}if(a.getDisplay().toUpperCase()<b.getDisplay().toUpperCase()){return -1;
}return 0;
}}();
CERN_VITALSIGN_O1.TYPE_STANDARD_GROUPING=0;
CERN_VITALSIGN_O1.TYPE_TEMPERATURE=1;
CERN_VITALSIGN_O1.TYPE_BLOOD_PRESSURE=2;
CERN_VITALSIGN_O1.TYPE_DISCRETE_RESULT=3;
var CERN_VITALSIGNS_O1_UTIL=function(){return{GetMaxMinTempResult:function(cell,personId,encntrId,providerId,pprCd,eventSetCds){if(!Util.Style.ccss(cell,"vs-cached")){var vitalI18N=i18n.discernabu.vitals_o1;
Util.Style.acss(cell,"vs-cached");
var hvrDiv=Util.Style.g("hvr",cell,"div");
var dl=Util.Style.g("vs-det",hvrDiv[0],"dl");
var spanMaxResult=AddAdditionalElement(dl[0],vitalI18N.TWO_DAY_MAX);
var spanMinResult=AddAdditionalElement(dl[0],vitalI18N.TWO_DAY_MIN);
var timerGetMaxTemp=MP_Util.CreateTimer("ENG:MPG.VITALSIGNS.O1 - get 48 hour max temp");
var info=new XMLCclRequest();
info.onreadystatechange=function(){if(this.readyState==4&&this.status==200){try{var jsonEval=JSON.parse(this.responseText);
var recordData=jsonEval.RECORD_DATA;
var df=MP_Util.GetDateFormatter();
if(recordData.STATUS_DATA.STATUS==="S"){var results=CERN_MEASUREMENT_BASE_O1.LoadMeasurementDataArray(recordData);
results.sort(SortTemperatures);
var maxResult=results[0];
var minResult=results[results.length-1];
var sDateMax="&nbsp;<span>"+df.format(maxResult.getDateTime(),mp_formatter.DateTimeFormatter.FULL_DATE_TIME_4YEAR)+"</span>";
var sDateMin="&nbsp;<span>"+df.format(minResult.getDateTime(),mp_formatter.DateTimeFormatter.FULL_DATE_TIME_4YEAR)+"</span>";
spanMaxResult.innerHTML=MP_Util.Measurement.GetNormalcyResultDisplay(maxResult)+sDateMax;
spanMinResult.innerHTML=MP_Util.Measurement.GetNormalcyResultDisplay(minResult)+sDateMin;
}else{if(recordData.STATUS_DATA.STATUS==="Z"){spanMaxResult.innerHTML="&nbsp;";
spanMinResult.innerHTML="&nbsp;";
}else{spanMaxResult.innerHTML=vitalI18N.ERROR_RETREIVING_DATA;
spanMinResult.innerHTML=vitalI18N.ERROR_RETREIVING_DATA;
}}}catch(err){if(timerGetMaxTemp){timerGetMaxTemp.Abort();
timerGetMaxTemp=null;
}spanMaxResult.innerHTML=vitalI18N.ERROR_RETREIVING_DATA;
spanMinResult.innerHTML=vitalI18N.ERROR_RETREIVING_DATA;
}finally{if(timerGetMaxTemp){timerGetMaxTemp.Stop();
}}}if(this.readyState==4){MP_Util.ReleaseRequestReference(this);
}};
info.open("GET","MP_RETRIEVE_N_RESULTS_JSON",true);
var sendAr=["^MINE^",personId+".0",encntrId+".0",providerId+".0",pprCd+".0",200,"^^",eventSetCds,"0.0",2,2];
info.send(sendAr.join(","));
}}};
function SortTemperatures(a,b){var val1=GetFahrenheitValue(a);
var val2=GetFahrenheitValue(b);
if(val1>val2){return -1;
}else{if(val1<val2){return 1;
}}return 0;
}function GetFahrenheitValue(temp){var tempObj=temp.getResult();
var uom=(tempObj.getUOM())?tempObj.getUOM().meaning:"";
var tempVal=parseFloat(MP_Util.Measurement.GetString(temp,null,null,true));
if(uom==="DEGC"||tempVal<55){tempVal=(tempVal*1.8)+32;
}return tempVal;
}function AddAdditionalElement(dl,label){var dt=Util.cep("dt",{className:"vs-det-type"});
var span=Util.cep("span");
var txt=document.createTextNode(label+":");
Util.ac(txt,span);
Util.ac(span,dt);
Util.ac(dt,dl);
var dd=Util.cep("dd",{className:"result"});
var spanResult=Util.cep("span");
var txtResult=document.createTextNode(i18n.discernabu.vitals_o1.LOADING_DATA+"...");
Util.ac(txtResult,spanResult);
Util.ac(spanResult,dd);
Util.ac(dd,dl);
return spanResult;
}}();
function WeightsComponentStyle(){this.initByNamespace("wm");
}WeightsComponentStyle.inherits(ComponentStyle);
function WeightsComponent(criterion){this.setCriterion(criterion);
this.setStyles(new WeightsComponentStyle());
this.setComponentLoadTimerName("USR:MPG.WEIGHTS.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.WEIGHTS.O1 - render component");
this.m_includeAdmission=false;
this.m_includeAdmissionChange=false;
this.m_changeFlag=1;
this.setIncludeLineNumber(true);
this.m_graphLink=1;
WeightsComponent.method("InsertData",function(){CERN_WEIGHTS_O1.GetWeightAndMeasurements(this);
});
WeightsComponent.method("setIncludeAdmission",function(value){this.m_includeAdmission=value;
});
WeightsComponent.method("isAdmissionIncluded",function(){return(this.m_includeAdmission);
});
WeightsComponent.method("setIncludeAdmissionChange",function(value){this.m_includeAdmissionChange=value;
});
WeightsComponent.method("isAdmissionChangeIncluded",function(){return(this.m_includeAdmissionChange);
});
WeightsComponent.method("setChangeFlag",function(value){this.m_changeFlag=value;
});
WeightsComponent.method("getChangeFlag",function(){return(this.m_changeFlag);
});
WeightsComponent.method("setGraphFlag",function(value){this.m_graphLink=value;
});
WeightsComponent.method("getGraphFlag",function(){return(this.m_graphLink);
});
WeightsComponent.method("HandleSuccess",function(recordData){CERN_WEIGHTS_O1.RenderComponent(this,recordData);
});
CERN_EventListener.addListener(this,EventListener.EVENT_CLINICAL_EVENT,this.InsertData,this);
}WeightsComponent.inherits(MPageComponent);
var CERN_WEIGHTS_O1=function(){return{GetWeightAndMeasurements:function(component){var sendAr=[];
var criterion=component.getCriterion();
var groups=component.getGroups();
var encntrOption=(component.getScope()===1)?"0.0":(criterion.encntr_id+".0");
var lookBackUnits=(component.getLookbackUnits()!==0)?component.getLookbackUnits():"365";
var lookBackType=component.getLookbackUnitTypeFlag();
var eventSets=(groups&&groups.length>0)?groups[0].getEventSets():null;
var numResults=(component.isAdmissionIncluded()||component.isAdmissionChangeIncluded())?1000:2;
var sEventSets=MP_Util.CreateParamArray(eventSets,1);
sendAr.push("^MINE^",criterion.person_id+".0",encntrOption,criterion.provider_id+".0",criterion.ppr_cd+".0",numResults,"^^",sEventSets,0,lookBackUnits,lookBackType);
MP_Core.XMLCclRequestWrapper(component,"MP_RETRIEVE_N_RESULTS_JSON",sendAr,true);
},RenderComponent:function(component,recordData){var timerRenderComponent=MP_Util.CreateTimer(component.getComponentRenderTimerName());
try{var weightsI18n=i18n.discernabu.weights_o1;
var jsHTML=[];
var sHTML="";
var codeArray=MP_Util.LoadCodeListJSON(recordData.CODES);
var personnelArray=MP_Util.LoadPersonelListJSON(recordData.PRSNL);
var mapObjects=CERN_MEASUREMENT_BASE_O1.LoadMeasurementDataMap(recordData,personnelArray,codeArray);
if(mapObjects&&mapObjects.length>0){var contentClass=MP_Util.GetContentClass(component,mapObjects.length);
var headerClass="content-hdr";
if(component.isScrollingEnabled()&&(mapObjects.length>=component.getScrollNumber())){contentClass+=" body-scroll";
headerClass+=" hdr-scroll";
}jsHTML.push("<div class='",headerClass,"'><table class='wm-tbl-full'><tr class='hdr'><th class='wm-res-nm'>&nbsp;</th><th class='wm-res'>",weightsI18n.LATEST);
if(component.getDateFormat()==3){jsHTML.push("<br/>",weightsI18n.WITHIN);
}jsHTML.push("</th><th class='wm-res'>",weightsI18n.PREVIOUS);
if(component.getDateFormat()==3){jsHTML.push("<br />",weightsI18n.WITHIN);
}jsHTML.push("</th><th class='wm-res-chn'>",weightsI18n.CHANGE,"</th>");
if(component.isAdmissionIncluded()){jsHTML.push("<th class='wm-res'>",weightsI18n.ADMISSION,"</th>");
}if(component.isAdmissionChangeIncluded()){jsHTML.push("<th class='wm-res-chn'>",weightsI18n.CHANGE,"</th>");
}jsHTML.push("</tr></table></div>");
jsHTML.push("<div class='",contentClass,"'>");
jsHTML.push("<table class='wm-tbl-full'>");
for(var i=0,l=mapObjects.length;
i<l;
i++){jsHTML.push(createResultRow(mapObjects[i],i,codeArray,component));
}jsHTML.push("</table></div>");
sHTML=jsHTML.join("");
var countText=MP_Util.CreateTitleText(component,mapObjects.length);
jsHTML.push("</div>");
MP_Util.Doc.FinalizeComponent(sHTML,component,countText);
}}catch(err){if(timerRenderComponent){timerRenderComponent.Abort();
timerRenderComponent=null;
}throw (err);
}finally{if(timerRenderComponent){timerRenderComponent.Stop();
}}}};
function createResultRow(mapObject,rowNbr,codeArray,component){var criterion=component.getCriterion();
var compId=component.getComponentId();
var ar=[];
var arParam=[];
var rowClass=(rowNbr%2)?"even":"odd";
var rowDisplay="";
var m1=null;
var resAr=mapObject.value;
if(resAr&&resAr.length>0){m1=resAr[0];
rowDisplay=m1.getEventCode().display;
if(component.getGraphFlag()==1){ar.push("<tr class='",rowClass,"'><td class='wm-res-nm'><span><a onClick='MP_Util.GraphResults(",m1.getEventCode().codeValue,",",compId,",0.0);'>",rowDisplay,"</a></span></td>");
}else{ar.push("<tr class='",rowClass,"'><td class='wm-res-nm'><span>",rowDisplay,"</span></td>");
}var changeFlag=component.getChangeFlag();
ar.push(createResultCell(resAr[0],component,null,null));
ar.push(createResultCell(resAr[1],component,resAr[0],changeFlag));
ar.push(createChangeCell(resAr[0],resAr[1],changeFlag));
if(component.isAdmissionIncluded()){ar.push(createResultCell(resAr[resAr.length-1],component,resAr[0],changeFlag));
}if(component.isAdmissionChangeIncluded()){ar.push(createChangeCell(resAr[0],resAr[resAr.length-1],changeFlag));
}ar.push("</tr>");
}return ar.join("");
}function createChangeCell(curMeasurement,previousMeasurement,changeFlag){var ar=[];
ar.push("<td class='wm-res-chn'><span>",getChangeResults(curMeasurement,previousMeasurement,changeFlag,false),"</span></td>");
return ar.join("");
}function getChangeResults(curMeasurement,previousMeasurement,changeFlag,hoverFlag){var ar=[];
var precision=2;
var res=0;
if(previousMeasurement&&curMeasurement){var curResult=curMeasurement.getResult();
var prevResult=previousMeasurement.getResult();
if(curResult instanceof MP_Core.QuantityValue&&prevResult instanceof MP_Core.QuantityValue){var curUOM=(curResult.getUOM())?curResult.getUOM().meaning:"";
var prevUOM=(prevResult.getUOM())?prevResult.getUOM().meaning:"";
if(curUOM===prevUOM){var diff=curResult.getRawValue()-prevResult.getRawValue();
if(changeFlag===0){if(parseInt(curResult.getValue(),10)!==0){var val=diff/prevResult.getValue()*100;
res=MP_Util.Measurement.SetPrecision(val,2);
ar.push(res,"%");
}else{res=0;
ar.push(res,"%");
}}else{var prec=Math.max(curResult.getPrecision(),prevResult.getPrecision());
res=MP_Util.Measurement.SetPrecision(diff,prec);
var uom=curResult.getUOM().display;
if(curUOM==="OZ"){var pounds=Math.floor(Math.abs(res)/16);
var ounces=Math.abs(res)%16;
if(res<0){pounds*=-1;
}if(hoverFlag){ar.push(pounds," lb ",ounces," oz");
}else{ar.push("<span class='res-value'>",pounds,"</span><span class='unit'>lb</span> <span class='res-value'>",ounces,"</span><span class='unit'>oz</span>");
}}else{if(hoverFlag){ar.push(res," ",uom);
}else{ar.push("<span class='res-value'>",res,"</span><span class='unit'>",uom,"</span>");
}}}}else{ar.push("--");
}}else{ar.push("&nbsp;");
}}else{ar.push("&nbsp;");
}return ar.join("");
}function createResultCell(measurement,component,prevMeasurement,changeFlag){var ar=[];
var styleVal=(prevMeasurement)?"wm-res":"wm-res wm-latest";
if(measurement){ar.push("<td class ='",styleVal,"'><dl class='wm-info'><dd><span class='res-normal'>",getResult(measurement,false),"</span>");
if(component.getDateFormat()!=4){ar.push("<br/><span class='within'>",MP_Util.DisplayDateByOption(component,measurement.getDateTime()));
}ar.push("</span></dd></dl>",createResultHover(measurement,prevMeasurement,changeFlag),"</td>");
}else{ar.push("<td class ='wm-res'><dl class='wm-info'><dd><span>--</span></dd></dl>");
}return ar.join("");
}function createResultHover(measurement,prevMeasurement,changeFlag){var ar=[];
var value=getResult(measurement,true);
var oStatus=measurement.getStatus();
var sStatus=(oStatus)?oStatus.display:"";
var weightsI18n=i18n.discernabu.weights_o1;
var df=MP_Util.GetDateFormatter();
var dateTime=df.format(measurement.getDateTime(),mp_formatter.DateTimeFormatter.FULL_DATE_TIME_4YEAR);
ar.push("<h4 class='det-hd'><span>",weightsI18n.MEASUREMENT_DETAILS,"</span></h4><div class='hvr'><dl class='wm-det'><dt><span>",weightsI18n.NAME,":</span></dt><dd class='wm-det-name'><span>",measurement.getEventCode().display,"</span></dd><dt><span>",weightsI18n.RESULT,":</span></dt><dd class='wm-det-val'><span>",value,"</span></dd><dt><span>",weightsI18n.DATE_TIME,":</span></dt><dd class='wm-det-name'><span>",dateTime,"</span><dt><span>",weightsI18n.STATUS,":</span></dt><dd class='wm-det-name'><span>",sStatus,"</span></dd>");
if(prevMeasurement){ar.push("<dt><span>",weightsI18n.CHANGE,":</span></dt><dd class='wm-det-chn'><span>",getChangeResults(prevMeasurement,measurement,changeFlag,true),"</span></dd>");
}ar.push("</dl></div>");
return ar.join("");
}function getResult(measurement,hoverFlag){var value="";
var result=measurement.getResult();
if(result instanceof MP_Core.QuantityValue){if(result.getUOM().meaning==="OZ"){var num=parseInt(MP_Util.Measurement.GetString(measurement,null,null,true),10);
var pounds=Math.floor(num/16);
var ounces=num%16;
if(hoverFlag){value=pounds+" lb "+ounces+" oz";
}else{value="<span class='res-value'>"+pounds+"</span><span class='unit'>lb</span> <span class='res-value'>"+ounces+"</span><span class='unit'>oz</span>";
value=GetWMEventViewerLink(measurement,value)+MP_Util.Measurement.GetModifiedIcon(measurement);
}}else{if(hoverFlag){value=result.toString();
}else{value="<span class='res-value'>"+result.getValue()+"</span><span class='unit'>"+result.getUOM().display+"</span>";
value=GetWMEventViewerLink(measurement,value)+MP_Util.Measurement.GetModifiedIcon(measurement);
}}}else{if(result instanceof Date){var df=MP_Util.GetDateFormatter();
value=df.format(result,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_4YEAR);
}else{value=result;
}if(!hoverFlag){value=GetWMEventViewerLink(measurement,value);
}}return value;
}function GetWMEventViewerLink(oMeasurement,sResultDisplay){var params=[oMeasurement.getPersonId(),oMeasurement.getEncntrId(),oMeasurement.getEventId(),'"EVENT"'];
var ar=["<a onclick='MP_Util.LaunchClinNoteViewer(",params.join(","),"); return false;' href='#'>",sResultDisplay,"</a>"];
return ar.join("");
}}();
