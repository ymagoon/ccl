function DocumentBaseComponent(){this.m_resultStatusCodes=null;
this.m_resultStatusMeanings=null;
this.m_includeHover=true;
this.m_pcnFavorites=true;
this.setIncludeLineNumber(true);
DocumentBaseComponent.method("InsertData",function(){CERN_DOCUMENT_BASE_O1.GetDocumentsTable(this);
});
DocumentBaseComponent.method("setResultStatusCodes",function(value){this.m_resultStatusCodes=value;
});
DocumentBaseComponent.method("addResultStatusCode",function(value){if(!this.m_resultStatusCodes){this.m_resultStatusCodes=[];
}this.m_resultStatusCodes.push(value);
});
DocumentBaseComponent.method("getResultStatusCodes",function(){if(this.m_resultStatusCodes){return this.m_resultStatusCodes;
}else{if(this.m_resultStatusMeanings){var resStatusCodeSet=MP_Util.GetCodeSet(8,false);
if(this.m_resultStatusMeanings&&this.m_resultStatusMeanings.length>0){for(var x=this.m_resultStatusMeanings.length;
x--;
){var code=MP_Util.GetCodeByMeaning(resStatusCodeSet,this.m_resultStatusMeanings[x]);
if(code){this.addResultStatusCode(code.codeValue);
}}}}}return this.m_resultStatusCodes;
});
DocumentBaseComponent.method("addResultStatusMeaning",function(value){if(!this.m_resultStatusMeanings){this.m_resultStatusMeanings=[];
}this.m_resultStatusMeanings.push(value);
});
DocumentBaseComponent.method("setResultStatusMeanings",function(value){this.m_resultStatusMeanings=value;
});
DocumentBaseComponent.method("isHoverEnabled",function(){return this.m_includeHover;
});
DocumentBaseComponent.method("setHoverEnabled",function(value){this.m_includeHover=value;
});
DocumentBaseComponent.method("isPcnFavEnabled",function(){return this.m_pcnFavorites;
});
DocumentBaseComponent.method("setPcnFavEnabled",function(value){this.m_pcnFavorites=value;
});
DocumentBaseComponent.method("HandleSuccess",function(recordData){CERN_DOCUMENT_BASE_O1.RenderComponent(this,recordData);
});
}DocumentBaseComponent.inherits(MPageComponent);
var CERN_DOCUMENT_BASE_O1=function(){return{GetDocumentsTable:function(component){var mgr=new MP_Core.XMLCCLRequestThreadManager(CERN_DOCUMENT_BASE_O1.RenderReply,component,false);
var sendAr=[];
var request=null;
var thread=null;
var criterion=component.getCriterion();
var groups=component.getGroups();
var codes=component.getResultStatusCodes();
var events=(groups!=null&&groups.length>0)?groups[0].getEventSets():null;
var results=(codes!=null&&codes.length>0)?codes:null;
var encntrOption=(component.getScope()==2)?(criterion.encntr_id+".0"):"0.0";
sendAr.push("^MINE^",criterion.person_id+".0",encntrOption,criterion.provider_id+".0",component.getLookbackUnits());
if(events){sendAr.push("value("+events.join(",")+")");
}else{sendAr.push("0.0");
}if(results){sendAr.push("value("+results.join(",")+")");
}else{sendAr.push("0.0");
}var unitType=component.getLookbackUnitTypeFlag();
sendAr.push(criterion.ppr_cd+".0",unitType);
request=new MP_Core.ScriptRequest(component,"ENG:MPG.DOC.O1 - load documents");
request.setProgramName("MP_RETRIEVE_DOCUMENTS_JSON");
request.setParameters(sendAr);
request.setAsync(true);
thread=new MP_Core.XMLCCLRequestThread("GetDocumentData",component,request);
mgr.addThread(thread);
if(component.isPlusAddEnabled()){sendAr=[];
sendAr.push("^MINE^",criterion.provider_id);
request=new MP_Core.ScriptRequest(component,"ENG:MPG.DOC.O1 - load PCN Favs");
request.setProgramName("MP_GET_DOCUMENT_FAVORITES");
request.setParameters(sendAr);
request.setAsync(true);
thread=new MP_Core.XMLCCLRequestThread("GetPcnFavorites",component,request);
mgr.addThread(thread);
}mgr.begin();
},RenderReply:function(replyAr,component){var timerRenderComponent=MP_Util.CreateTimer(component.getComponentRenderTimerName());
var countText="";
var compNS=component.getStyles().getNameSpace();
var errMsg=[];
try{for(var repCnt=replyAr.length;
repCnt--;
){var reply=replyAr[repCnt];
var repStatus=reply.getStatus();
switch(reply.getName()){case"GetPcnFavorites":var favData=reply.getResponse();
appendDropDown(compNS,component,favData,component.getCriterion().static_content);
break;
case"GetDocumentData":if(repStatus=="F"){errMsg.push(reply.getError());
MP_Util.Doc.FinalizeComponent(MP_Util.HandleErrorResponse(component.getStyles().getNameSpace(),errMsg.join("<br />")),component,"");
}else{if(repStatus=="S"){var recordData=reply.getResponse();
var sHTML="";
sHTML=CERN_DOCUMENT_BASE_O1.RenderComponent(component,recordData);
countText=MP_Util.CreateTitleText(component,recordData.DOCS.length);
MP_Util.Doc.FinalizeComponent(sHTML,component,countText);
if(component.isScrollingEnabled()&&(recordData.DOCS.length>=component.getScrollNumber())){var xNode=Util.Style.g(compNS+"-info-hdr",document.body,"DL");
if(xNode[0]){Util.Style.acss(xNode[0],"hdr-scroll");
}}}else{countText=(component.isLineNumberIncluded()?"(0)":"");
MP_Util.Doc.FinalizeComponent(MP_Util.HandleNoDataResponse(component.getStyles().getNameSpace()),component,countText);
}}break;
}}}catch(err){if(timerRenderComponent){timerRenderComponent.Abort();
timerRenderComponent=null;
}throw (err);
}finally{if(timerRenderComponent){timerRenderComponent.Stop();
}}},RenderComponent:function(component,recordData){var compNS=component.getStyles().getNameSpace();
var DocI18n=i18n.discernabu.documents_base_o1;
var codeArray=MP_Util.LoadCodeListJSON(recordData.CODES);
var personnelArray=MP_Util.LoadPersonelListJSON(recordData.PRSNL);
var df=new mp_formatter.DateTimeFormatter(MPAGE_LOCALE);
var sHTML="";
var countText="";
var jsHTML=[];
jsHTML.push("<div class='content-hdr'><dl class='",compNS,"-info-hdr hdr'><dd class='",compNS+"-cat-hd'><span></span></dd>");
jsHTML.push("<dd class='",compNS,"-auth-hd'><span>",DocI18n.AUTHOR,"</span></dd>");
if(PathologyComponent&&(component instanceof PathologyComponent)){jsHTML.push("<dd class='",compNS,"-dt-hd'><span>",DocI18n.DATE,"</span></dd>");
}else{jsHTML.push("<dd class='",compNS,"-dt-hd'><span>",DocI18n.DATE_TIME,"</span></dd>");
}if(component.getDateFormat()==3){jsHTML.push("<dd class='",compNS+"-cat-hd'><span></span></dd><dd class='",compNS,"-auth-hd'><span></span></dd><dd class='",compNS,"-dt-hd'><span>",DocI18n.WITHIN,"</span></dd>");
}jsHTML.push("</dl></div>");
recordData.DOCS.sort(DocumentSorter);
jsHTML.push("<div class='",MP_Util.GetContentClass(component,recordData.DOCS.length),"'>");
for(var x=0,xl=recordData.DOCS.length;
x<xl;
x++){var dtHvr="",lastPrsnl="";
var author=DocI18n.UNKNOWN;
var docObj=recordData.DOCS[x];
var patId=docObj.PERSON_ID+".0";
var enctrId=docObj.ENCNTR_ID+".0";
var evntId=docObj.EVENT_ID+".0";
var docStatus=MP_Util.GetValueFromArray(docObj.RESULT_STATUS_CD,codeArray);
var doc=MP_Util.GetValueFromArray(docObj.EVENT_CD,codeArray);
var parentEventId=docObj.PARENT_EVENT_ID+".0";
var viewerType=docObj.VIEWER_TYPE;
var dateOfService=null;
var withinDateDos=null;
var dateTime=new Date();
if(docObj.EFFECTIVE_DT_TM!=""){dateTime.setISO8601(docObj.EFFECTIVE_DT_TM);
dateOfService=MP_Util.DisplayDateByOption(component,dateTime);
withinDateDos=MP_Util.CalcWithinTime(dateTime);
}else{dateOfService=DocI18n.UNKNOWN;
withinDateDos=DocI18n.UNKNOWN;
}var recentPart=GetLatestParticipation(docObj);
var authorPart=GetAuthorParticipant(docObj,codeArray);
if(authorPart){author=MP_Util.GetValueFromArray(authorPart.PRSNL_ID,personnelArray).fullName;
}if(recentPart&&recentPart.PRSNL_ID>0){lastPrsnl=MP_Util.GetValueFromArray(recentPart.PRSNL_ID,personnelArray).fullName;
var dtTm=new Date();
if(recentPart.DATE!==""){dtTm.setISO8601(recentPart.DATE);
dtHvr=df.format(dtTm,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_4YEAR);
}else{dtHvr=DocI18n.UNKNOWN;
}}else{lastPrsnl=DocI18n.UNKNOWN;
dtHvr=DocI18n.UNKNOWN;
}jsHTML.push("<dl class='",compNS,"-info'><dd class='",compNS+"-cat'><span>",MP_Util.CreateClinNoteLink(patId,enctrId,evntId,doc.display,viewerType,parentEventId),"</span>");
if(docStatus.meaning=="MODIFIED"||docStatus.meaning=="ALTERED"){jsHTML.push("<span class='res-modified'>&nbsp;</span>");
}jsHTML.push("</dd>");
jsHTML.push("<dd class='",compNS,"-auth'><span>",author,"</span></dd>");
if(component.getDateFormat()==3){jsHTML.push("<dd class='",compNS,"-dt'><span class='date-time'>",withinDateDos,"</span></dd>");
}else{jsHTML.push("<dd class='",compNS,"-dt'><span class='date-time'>",dateOfService,"</span></dd>");
}jsHTML.push("<dd class='",compNS,"-image'>");
if(docObj.IMAGE_URL!==""){var urlParam='javascript:MPAGES_SVC_EVENT("'+docObj.IMAGE_URL+'",^MINE,$PAT_PersonId$^)';
jsHTML.push("<a class='",compNS,"-image-found' href='",urlParam,"'>&nbsp;</a>");
}else{jsHTML.push("&nbsp;");
}jsHTML.push("</dd></dl>");
if(component.isHoverEnabled()){jsHTML.push("<h4 class='det-hd'><span>",DocI18n.DOCUMENTATION_DETAILS,"</span></h4><div class='hvr'><dl class='",compNS,"-det'><dt><span>",DocI18n.NAME,":</span></dt><dd class='",compNS,"-det-name'><span>",doc.display,"</span></dd><dt><span>",DocI18n.SUBJECT,":</span></dt><dd class='",compNS,"-det-subj'><span>",docObj.SUBJECT,"</span></dd><dt><span>",DocI18n.STATUS,":</span></dt><dd class='",compNS,"-det-status'><span>",MP_Util.GetValueFromArray(docObj.RESULT_STATUS_CD,codeArray).display,"</span></dd><dt><span>",DocI18n.LAST_UPDATED,":</span></dt><dd class='",compNS,"-det-dt'><span>",dtHvr,"</span></dd><dt><span>",DocI18n.LAST_UPDATED_BY,":</span></dt><dd class='",compNS,"-det-dt'><span>",lastPrsnl,"</span></dd></dl></div>");
}}jsHTML.push("</div>");
sHTML=jsHTML.join("");
return sHTML;
}};
function GetLatestParticipation(doc){var returnPart=null;
for(var x=doc.ACTION_PROVIDERS.length;
x--;
){var part=doc.ACTION_PROVIDERS[x];
if(!returnPart||part.DATE>returnPart.DATE){returnPart=part;
}}return(returnPart);
}function DocumentSorter(a,b){var aPart=GetLatestParticipation(a);
var bPart=GetLatestParticipation(b);
var aDate="";
var bDate="";
if(aPart){aDate=aPart.EFFECTIVE_DT_TM;
}if(bPart){bDate=bPart.EFFECTIVE_DT_TM;
}if(aDate>bDate){return -1;
}else{if(aDate<bDate){return 1;
}else{return 0;
}}}function GetAuthorParticipant(doc,codeArray){var returnPart=null,type_cd=null,status_cd=null,part=null,strPerform="PERFORM",strCompleted="COMPLETED";
for(var y=doc.ACTION_PROVIDERS.length;
y--;
){part=doc.ACTION_PROVIDERS[y];
type_cd=MP_Util.GetValueFromArray(part.TYPE_CD,codeArray);
status_cd=MP_Util.GetValueFromArray(part.STATUS_CD,codeArray);
if((type_cd&&type_cd.meaning===strPerform)&&(status_cd&&status_cd.meaning===strCompleted)){returnPart=part;
break;
}}return(returnPart);
}function appendDropDown(preSec,component,pcnFav,contentPath){if(preSec!="doc"){return;
}pre=component.getStyles().getId();
if((_g(pre+"Drop")!=null)&&_g(pre+"Menu")!=null){return;
}var img=Util.cep("img",{src:contentPath+"\\images\\3943_16.gif"});
var link=Util.cep("a",{className:"drop-Down",id:pre+"Drop"});
var menu=Util.cep("div",{id:pre+"Menu",className:"form-menu menu-hide"});
Util.ac(img,link);
var sec=_g(component.getStyles().getId());
var secCL=Util.Style.g("sec-title",sec,"span");
var secSpan=secCL[0];
Util.ac(link,secSpan);
Util.ac(menu,secSpan);
pcnFavLoad(pcnFav,component);
}function pcnFavLoad(pcnFav,component){var jsonPcnFav=pcnFav;
var docDropId=component.getStyles().getId()+"Drop";
var docDrop=_g(docDropId);
var htmlPcnFav=[];
var numId=0;
var pcn=jsonPcnFav.PRE_COMPLETED;
pcn.sort(function(obj1,obj2){function checkStrings(s1,s2){return(s1===s2)?0:((s1>s2)?1:-1);
}return checkStrings(obj1.DISPLAY.toUpperCase(),obj2.DISPLAY.toUpperCase());
});
if(!pcn[0]){htmlPcnFav.push("<div>",i18n.discernabu.documents_base_o1.DOCUMENT_FAVS,'<span class="favHidden" id="docCKI',numId,'">',i18n.DOCUMENT_FAVS,"</span></div>");
}else{var crit=component.getCriterion();
for(var j=0,l=pcn.length;
j<l;
j++){var pcNote=pcn[j];
numId=numId+1;
htmlPcnFav.push('<div><a id="doc',numId,'" href="#">',pcNote.DISPLAY,"</a>",'<span class="favHidden" id="docCKI',numId,'">',pcNote.SOURCE_IDENTIFIER,"</span>",'<span class="favHidden" id="docStyleID',numId,'">',component.getStyles().getId(),"</span>","</div>");
}}var pcnArray=htmlPcnFav.join("");
var newSpan=Util.cep("span");
newSpan.innerHTML=pcnArray;
var docMenuId=component.getStyles().getId()+"Menu";
var docMenu=_g(docMenuId);
Util.ac(newSpan,docMenu);
var docMenuList=_gbt("a",docMenu);
var dmLen=docMenuList.length;
for(var i=dmLen;
i--;
){Util.addEvent(docMenuList[i],"click",addDocDet);
}closeMenuInit(docMenu,component.getStyles().getId());
Util.addEvent(docDrop,"click",function(){if(Util.Style.ccss(Util.gns(this),"menu-hide")){_g(component.getStyles().getId()).style.zIndex=2;
Util.preventDefault();
Util.Style.rcss(Util.gns(this),"menu-hide");
}else{_g(component.getStyles().getId()).style.zIndex=1;
Util.Style.acss(Util.gns(this),"menu-hide");
}});
}function addDocDet(){try{var PowerNoteMPageUtils=window.external.DiscernObjectFactory("POWERNOTE");
var comp={};
if(PowerNoteMPageUtils){var menuVal=Util.gns(this);
var cki=menuVal.firstChild.data;
var spanDocStyleID=Util.gns(menuVal);
for(var x=0,xl=CERN_MPageComponents.length;
x<xl;
x++){comp=CERN_MPageComponents[x];
var styles=comp.getStyles();
if(styles.getId()==spanDocStyleID.firstChild.data){break;
}}var crit=comp.getCriterion();
PowerNoteMPageUtils.BeginNoteFromPrecompletedNote(crit.person_id+".0",crit.encntr_id+".0",cki+".0");
CERN_DOCUMENT_BASE_O1.GetDocumentsTable(comp);
}}catch(err){alert('An error has occured calling DiscernObjectFactory("POWERNOTE"): '+err.name+" "+err.message);
return;
}}function closeMenuInit(inMenu,compId){var menuId;
var docMenuId=compId+"Menu";
if(inMenu.id==docMenuId){menuId=compId;
}if(!e){var e=window.event;
}if(window.attachEvent){Util.addEvent(inMenu,"mouseleave",function(){Util.Style.acss(inMenu,"menu-hide");
_g(menuId).style.zIndex=1;
});
}else{Util.addEvent(inMenu,"mouseout",menuLeave);
}function menuLeave(e){if(!e){var e=window.event;
}var relTarg=e.relatedTarget||e.toElement;
if(e.relatedTarget.id==inMenu.id){Util.Style.acss(inMenu,"menu-hide");
_g(menuId).style.zIndex=1;
}e.stopPropagation();
Util.cancelBubble(e);
}}}();
function ObservationDelegate(){this.getData=function(sendAr,component){var handler=function(RECORDDATA,successStatus,errorMessage){if("S"===successStatus){component.HandleSuccess(RECORDDATA);
}else{alert(reg_Observation_i18n.reg_obsrv_FAIL_MESSAGE);
}};
RCM_Clinical_Util.makeTimerCCLRequest(component,"pm_get_obs_events",sendAr,true,function(status,RECORDDATA,errorInfo){if("S"===status){handler(RECORDDATA,status);
}else{if("F"===status){var alertMessage=[];
if(errorInfo&&errorInfo.length>0){alertMessage.push(errorInfo);
}if(RECORDDATA&&RECORDDATA.EXCEPTIONINFORMATION){alertMessage.push(RECORDDATA.EXCEPTIONINFORMATION[0].EXCEPTIONTYPE);
}if(RECORDDATA&&RECORDDATA.STATUS_DATA&&RECORDDATA.STATUS_DATA.SUBEVENTSTATUS){alertMessage.push(RECORDDATA.STATUS_DATA.SUBEVENTSTATUS[0].TARGETOBJECTVALUE);
}handler(RECORDDATA,status,alertMessage.join());
}}});
};
this.setData=function(sendAr,component){var handler=function(RECORDDATA,successStatus,errorMessage){if("S"===successStatus){window.location.reload();
}else{RegObservationView.popErrorDialog(2);
}};
RCM_Clinical_Util.makeTimerCCLRequest(component,"pm_obs_ens_mpage_event",sendAr,true,function(status,RECORDDATA,errorInfo){if("S"===status){handler(RECORDDATA,status);
}else{if("F"===status){var alertMessage=[];
if(errorInfo&&errorInfo.length>0){alertMessage.push(errorInfo);
}if(RECORDDATA&&JSON.stringify(RECORDDATA.EXCEPTIONINFORMATION.EXCEPTIONTYPE==="STALE_DATA")){RegObservationView.popErrorDialog(1);
}}}});
};
}var CERN_DEMO_BANNER_O1=function(){return{GetPatientDemographics:function(demoBanner,criterion){timerPatDemLoad=MP_Util.CreateTimer("USR:MPG.DEMO_BANNER.O1 - load component");
if(timerPatDemLoad){timerPatDemLoad.Start();
}var info=new XMLCclRequest();
info.onreadystatechange=function(){if(this.readyState==4&&this.status==200){var timer=MP_Util.CreateTimer("ENG:MPG.DEMO_BANNER.O1 – render component");
try{var jsHTML=[];
var sHTML="",birthDate="",visitReason="",mrnNbr,finNbr="",age="",isolation="";
var jsonText=JSON.parse(this.responseText);
var codeArray=MP_Util.LoadCodeListJSON(jsonText.RECORD_DATA.CODES);
var patInfo=jsonText.RECORD_DATA.DEMOGRAPHICS.PATIENT_INFO;
var nameFull=patInfo.PATIENT_NAME.NAME_FULL;
var enCodeArray=[];
var ptCodeArray=[];
var formattedAliasArray=[];
var dateTime=new Date();
if(patInfo.BIRTH_DT_TM!==""){dateTime.setISO8601(patInfo.BIRTH_DT_TM);
birthDate=dateTime.format("shortDate2");
age=MP_Util.CalcAge(dateTime);
}var oSex=MP_Util.GetValueFromArray(patInfo.SEX_CD,codeArray);
var encntrInfo=jsonText.RECORD_DATA.DEMOGRAPHICS.ENCOUNTER_INFO;
for(var j=0,e=encntrInfo.length;
j<e;
j++){visitReason=encntrInfo[j].REASON_VISIT;
for(var i=0,l=encntrInfo[j].ALIAS.length;
i<l;
i++){enCodeArray[i]=MP_Util.GetValueFromArray(encntrInfo[j].ALIAS[i].ALIAS_TYPE_CD,codeArray);
if(enCodeArray[i].meaning=="FIN NBR"){finNbr=encntrInfo[j].ALIAS[i].FORMATTED_ALIAS;
}if(enCodeArray[i].meaning=="MRN"){mrnNbr=encntrInfo[j].ALIAS[i].FORMATTED_ALIAS;
}}if(encntrInfo[j].ISOLATION_CD>0){var isoObj=MP_Util.GetValueFromArray(encntrInfo[j].ISOLATION_CD,codeArray);
isolation=isoObj.display;
}}aliasArry=jsonText.RECORD_DATA.DEMOGRAPHICS.PATIENT_INFO.ALIAS;
if(mrnNbr==""){for(var i=0,l=aliasArry.length;
i<l;
i++){ptCodeArray[i]=MP_Util.GetValueFromArray(aliasArry[i].ALIAS_TYPE_CD,codeArray);
if(ptCodeArray[i].meaning=="MRN"){mrnNbr=aliasArry[i].FORMATTED_ALIAS;
}}}var sexAbb=(oSex&&oSex!==null)?oSex.display:i18n.UNKNOWN;
jsHTML.push("<dl class='dmg-info'><dt class='dmg-pt-name-lbl'><span>",i18n.NAME,"</span></dt><dd class='dmg-pt-name'><span>",nameFull,"</span></dd><dt class='dmg-sex-age-lbl'><span>",i18n.SEX," ",i18n.AGE,"</span></dt><dd class='dmg-sex-age'><span>",sexAbb," ",age,"</span></dd><dt><span>",i18n.DOB,":</span></dt><dd class='dmg-dob'><span>",birthDate,"</span></dd><dt><span>",i18n.MRN,":</span></dt><dd class='dmg-mrn'><span>",mrnNbr,"</span></dd><dt><span>",i18n.FIN,":</span></dt><dd class='dmg-fin'><span>",finNbr,"</span></dd><dt><span>",i18n.ISOLATION,":</span></dt><dd class='dmg-isolation'><span>",isolation,"</span></dd><dt><span>",i18n.VISIT_REASON,":</span></dt><dd class='dmg-rfv'><span>",visitReason,"</span></dd></dl>");
demoBanner.innerHTML=jsHTML.join("");
}finally{if(timer){timer.Stop();
}if(timerPatDemLoad){timerPatDemLoad.Stop();
}}}if(this.readyState==4){MP_Util.ReleaseRequestReference(this);
}};
info.open("GET","MP_GET_PATIENT_DEMO",0);
var sendAr=[];
sendAr.push("^MINE^",criterion.person_id+".0",criterion.encntr_id+".0");
info.send(sendAr.join(","));
}};
}();
function DischargeOrdersComponentStyle(){this.initByNamespace("dishord");
}DischargeOrdersComponentStyle.inherits(ComponentStyle);
function DischargeOrdersComponent(criterion){this.setCriterion(criterion);
this.setStyles(new DischargeOrdersComponentStyle());
this.setComponentLoadTimerName("USR:MPG.DISCH_ORDERS.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.DISCH_ORDERS.O1 - render component");
this.setIncludeLineNumber(true);
this.setScope(2);
DischargeOrdersComponent.method("InsertData",function(){CERN_DISCH_ORDERS_O1.GetOrdersTable(this);
});
DischargeOrdersComponent.method("HandleSuccess",function(recordData){CERN_DISCH_ORDERS_O1.RenderComponent(this,recordData);
});
DischargeOrdersComponent.method("setCatalogCodes",function(value){this.m_catalogCodes=value;
});
DischargeOrdersComponent.method("addCatalogCode",function(value){if(this.m_catalogCodes==null){this.m_catalogCodes=[];
}this.m_catalogCodes.push(value);
});
DischargeOrdersComponent.method("getCatalogCodes",function(){if(this.m_catalogCodes!=null){return this.m_catalogCodes;
}return this.m_catalogCodes;
});
DischargeOrdersComponent.method("openTab",function(){var criterion=this.getCriterion();
var params=[criterion.person_id,".0|",criterion.encntr_id,".0|"];
params.push("{ORDER|0|0|0|0|0}");
params.push("|0|{2|127}|8");
MPAGES_EVENT("ORDERS",params.join(""));
this.InsertData();
});
}DischargeOrdersComponent.inherits(MPageComponent);
var CERN_DISCH_ORDERS_O1=function(){return{GetOrdersTable:function(component){var sendAr=[];
var criterion=component.getCriterion();
sendAr.push("^MINE^",criterion.person_id+".0",criterion.encntr_id+".0");
var codes=component.getCatalogCodes();
var catCd=(codes!=null&&codes.length>0)?codes:null;
if(catCd!=null){sendAr.push("value("+catCd.join(",")+")");
}else{sendAr.push("0");
}MP_Core.XMLCclRequestWrapper(component,"MP_GET_DISCH_ORDERS",sendAr,true);
},RenderComponent:function(component,recordData){var timerRenderComponent=MP_Util.CreateTimer(component.getComponentRenderTimerName());
try{var countText="";
var ordHTML="";
var jsORDHTML=[];
var jsOrdSec=[];
var jsDiscSec=[];
var discCount=0;
var ordCount=0;
var isPlusAddEnabled=component.isPlusAddEnabled();
var tableBody=[];
var ordItem=[];
if(recordData.ORDERS.length==0){ordItem.push(i18n.NO_RESULTS_FOUND);
ordHTML=ordItem.join("");
countText="(0)";
}else{var ordLen=recordData.ORDERS.length;
recordData.ORDERS.sort(OrderDateSort);
for(var j=0;
j<ordLen;
j++){var orders=recordData.ORDERS[j];
var ordName="",ordDate="",statusTypeDisp="",orderDetails="";
ordItem=[];
var dateTime=new Date();
if(orders!=null){dateTime.setISO8601(orders.ORIG_ORDER_DT_TM);
ordDate=dateTime.format("longDateTime3");
statusTypeDisp=orders.ORDER_STATUS;
orderDetails=orders.ORDER_DETAIL;
}if(orders.ORDER_DISPLAY!=null){ordName=orders.ORDER_DISPLAY;
}ordItem.push("<dl class='dishord-info'><dd class= 'dishord-name'>",ordName,"</dd></dl><h4 class='dishord-det-hd'><span>","</span></h4><div class='hvr'><dl class='dishord-det'><dt><span>",i18n.ORDER_NAME,":</span></dt><dd class='dishord-det-dt'><span>",ordName,"</span></dd><dt><span>",i18n.ORDER_DETAILS,":</span></dt><dd class='dishord-det-dt'><span>",orderDetails,"</span></dd><dt><span>",i18n.ORDER_DATE,":</span></dt><dd class='dishord-det-dt'><span>",ordDate,"</span></dd><dt><span>",i18n.ORDER_STATUS,":</span></dt><dd class='dishord-det-dt'><span>",statusTypeDisp,"</span></dd></dl></div>");
jsOrdSec=jsOrdSec.concat(ordItem);
ordCount++;
}jsORDHTML.push(jsOrdSec.join(""),"</span></div></div></div>");
tableBody=tableBody.concat(jsORDHTML);
ordHTML=tableBody.join("");
countText="("+(ordLen)+")";
}var compNS=component.getStyles().getNameSpace();
MP_Util.Doc.FinalizeComponent(ordHTML,component,countText);
if(component.isPlusAddEnabled()){appendDropDown(compNS,component,recordData,component.getCriterion().static_content);
}}catch(err){if(timerRenderComponent){timerRenderComponent.Abort();
timerRenderComponent=null;
}throw (err);
}finally{if(timerRenderComponent){timerRenderComponent.Stop();
}}}};
function OrderDateSort(a,b){if(a.ORIG_ORDER_DT_TM>b.ORIG_ORDER_DT_TM){return -1;
}else{if(a.ORIG_ORDER_DT_TM<b.ORIG_ORDER_DT_TM){return 1;
}}return 0;
}function appendDropDown(preSec,component,recdata,contentPath){if(preSec!="dishord"){return;
}pre=component.getStyles().getId();
if((_g(pre+"Drop")!=null)&&_g(pre+"Menu")!=null){return;
}var img=Util.cep("img",{src:contentPath+"\\images\\3943_16.gif"});
var link=Util.cep("a",{className:"drop-Down",id:pre+"Drop"});
var menu=Util.cep("div",{id:pre+"Menu",className:"form-menu menu-hide"});
Util.ac(img,link);
var sec=_g(component.getStyles().getId());
var secCL=Util.Style.g("sec-title",sec,"span");
var secSpan=secCL[0];
Util.ac(link,secSpan);
Util.ac(menu,secSpan);
loadDropDown(recdata,component);
}function loadDropDown(recdata,component){var jsonRecdata=null;
try{jsonRecdata=recdata;
}catch(err){alert(err.description);
}var docDropId=component.getStyles().getId()+"Drop";
var docDrop=_g(docDropId);
var htmlStr=[];
var numId=0;
var ordRec=jsonRecdata.DISCH_ORDERABLES;
if(ordRec[0]===null){htmlStr.push("<div>",i18n.DOCUMENT_FAVS,'<span class="favHidden" id="docCKI',numId,'">'," ","</span></div>");
}else{var crit=component.getCriterion();
for(var j=0,l=ordRec.length;
j<l;
j++){var rec=ordRec[j];
numId=numId+1;
htmlStr.push('<div><a id="doc',numId,'" href="#">',rec.ORDER_DISPLAY,"</a>",'<span class="favHidden" id="docCKI',numId,'">',rec.SYNONYM_ID,"</span>",'<span class="favHidden" id="docStyleID',numId,'">',component.getStyles().getId(),"</span>","</div>");
}}var ddarray=htmlStr.join("");
var newSpan=Util.cep("span");
newSpan.innerHTML=ddarray;
var docMenuId=component.getStyles().getId()+"Menu";
var docMenu=_g(docMenuId);
Util.ac(newSpan,docMenu);
var docMenuList=_gbt("a",docMenu);
var dmLen=docMenuList.length;
for(var i=dmLen;
i--;
){Util.addEvent(docMenuList[i],"click",addDocDet);
}closeMenuInit(docMenu,component.getStyles().getId());
Util.addEvent(docDrop,"click",function(){if(Util.Style.ccss(Util.gns(this),"menu-hide")){_g(component.getStyles().getId()).style.zIndex=2;
Util.preventDefault();
Util.Style.rcss(Util.gns(this),"menu-hide");
}else{_g(component.getStyles().getId()).style.zIndex=1;
Util.Style.acss(Util.gns(this),"menu-hide");
}});
}function addDocDet(){var menuVal=Util.gns(this);
var synonymId=menuVal.firstChild.data;
var spanDocStyleID=Util.gns(menuVal);
var comp=null;
for(var x=0,xl=CERN_MPageComponents.length;
x<xl;
x++){comp=CERN_MPageComponents[x];
var styles=comp.getStyles();
if(styles.getId()==spanDocStyleID.firstChild.data){break;
}}var crit=comp.getCriterion();
var params=[crit.person_id,".0|",crit.encntr_id,".0|"];
params.push("{ORDER|"+synonymId+"|0|0|0|0}");
params.push("|0|{2|127}|32");
MPAGES_EVENT("ORDERS",params.join(""));
CERN_DISCH_ORDERS_O1.GetOrdersTable(comp);
}function closeMenuInit(inMenu,compId){var menuId;
var docMenuId=compId+"Menu";
if(inMenu.id==docMenuId){menuId=compId;
}if(!e){var e=window.event;
}if(window.attachEvent){Util.addEvent(inMenu,"mouseleave",function(){Util.Style.acss(inMenu,"menu-hide");
_g(menuId).style.zIndex=1;
});
}else{Util.addEvent(inMenu,"mouseout",menuLeave);
}function menuLeave(e){if(!e){var e=window.event;
}var relTarg=e.relatedTarget||e.toElement;
if(e.relatedTarget.id==inMenu.id){Util.Style.acss(inMenu,"menu-hide");
_g(menuId).style.zIndex=1;
}e.stopPropagation();
Util.cancelBubble(e);
}}}();
function DocumentComponentStyle(){this.initByNamespace("doc");
}DocumentComponentStyle.inherits(ComponentStyle);
function DocumentComponent(criterion){this.setCriterion(criterion);
this.setStyles(new DocumentComponentStyle());
this.setComponentLoadTimerName("USR:MPG.DOCUMENTS.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.DOCUMENTS.O1 - render component");
DocumentComponent.method("openTab",function(){var criterion=this.getCriterion();
var sParms="/PERSONID="+criterion.person_id+" /ENCNTRID="+criterion.encntr_id+" /FIRSTTAB=^"+this.getLink()+"+^";
APPLINK(0,criterion.executable,sParms);
this.InsertData();
});
}DocumentComponent.inherits(DocumentBaseComponent);
function PatientInfoComponentStyle(){this.initByNamespace("pt");
}PatientInfoComponentStyle.inherits(ComponentStyle);
function PatientInfoComponent(criterion){this.rowCount=0;
this.setCriterion(criterion);
this.setStyles(new PatientInfoComponentStyle());
this.m_visitTypeMeanings=null;
this.m_visitTypeCodes=null;
this.m_chiefComplaintCodes=null;
this.m_estimatedDischargeDateCodes=null;
this.m_displayMedicalService=false;
this.m_displayRFV=false;
this.m_primaryPhysDisplay=false;
this.m_attedingPhysDisplay=false;
this.m_admittingPhysDisplay=false;
this.m_roombedDisplay=false;
this.m_admitDateDisplay=false;
this.m_modeofArrval=null;
this.m_advancedDirectives=null;
this.m_resusOrderCodes=null;
this.m_emergencyContactsDisplay=false;
this.m_documentTypeCodes=null;
this.setComponentLoadTimerName("USR:MPG.PATINFO.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.PATINFO.O1 - render component");
PatientInfoComponent.method("HandleSuccess",function(recordData){CERN_PATINFO_O1.GetPatientInfo(this,recordData);
});
PatientInfoComponent.method("InsertData",function(){CERN_PATINFO_O1.SendPatientData(this);
});
PatientInfoComponent.method("setVisitTypeCodes",function(value){this.m_visitTypeCodes=value;
});
PatientInfoComponent.method("addVisitTypeCode",function(value){if(this.m_visitTypeCodes==null){this.m_visitTypeCodes=[];
}this.m_visitTypeCodes.push(value);
});
PatientInfoComponent.method("getVisitTypeCodes",function(){if(this.m_visitTypeCodes!=null){return this.m_visitTypeCodes;
}});
PatientInfoComponent.method("setChiefComplaint",function(value){this.rowCount++;
this.m_chiefComplaintCodes=value;
});
PatientInfoComponent.method("addChiefComplaint",function(value){if(this.m_chiefComplaintCodes==null){this.m_chiefComplaintCodes=[];
}this.m_chiefComplaintCodes.push(value);
});
PatientInfoComponent.method("getChiefComplaint",function(){return this.m_chiefComplaintCodes;
});
PatientInfoComponent.method("setAdvancedDirectives",function(value){this.rowCount++;
this.m_advancedDirectives=value;
});
PatientInfoComponent.method("addAdvancedDirectives",function(value){if(this.m_advancedDirectives==null){this.m_advancedDirectives=[];
}this.m_advancedDirectives.push(value);
});
PatientInfoComponent.method("getAdvancedDirectives",function(){return this.m_advancedDirectives;
});
PatientInfoComponent.method("setResusOrders",function(value){this.rowCount++;
this.m_resusOrderCodes=value;
});
PatientInfoComponent.method("addResusOrders",function(value){if(this.m_resusOrderCodes==null){this.m_resusOrderCodes=[];
}this.m_resusOrderCodes.push(value);
});
PatientInfoComponent.method("getResusOrders",function(){return this.m_resusOrderCodes;
});
PatientInfoComponent.method("setEstimatedDischargeDate",function(value){this.rowCount++;
this.m_estimatedDischargeDateCodes=value;
});
PatientInfoComponent.method("addEstimatedDischargeDate",function(value){if(this.m_estimatedDischargeDateCodes==null){this.m_estimatedDischargeDateCodes=[];
}this.m_estimatedDischargeDateCodes.push(value);
});
PatientInfoComponent.method("getEstimatedDischargeDate",function(){return this.m_estimatedDischargeDateCodes;
});
PatientInfoComponent.method("setModeofArrival",function(value){this.rowCount++;
this.m_modeofArrival=value;
});
PatientInfoComponent.method("addModeofArrival",function(value){if(this.m_modeofArrival==null){this.m_modeofArrival=[];
}this.m_modeofArrival.push(value);
});
PatientInfoComponent.method("getModeofArrival",function(){return this.m_modeofArrival;
});
PatientInfoComponent.method("setDocumentTypes",function(value){this.m_documentTypeCodes=value;
});
PatientInfoComponent.method("addDocumentTypes",function(value){if(this.m_documentTypeCodes==null){this.m_documentTypeCodes=[];
}this.m_documentTypeCodes.push(value);
});
PatientInfoComponent.method("getDocumentTypes",function(){return this.m_documentTypeCodes;
});
PatientInfoComponent.method("isMedicalServiceDisplay",function(){return this.m_displayMedicalService;
});
PatientInfoComponent.method("setMedicalServiceDisplay",function(value){if(value==1){this.rowCount++;
}this.m_displayMedicalService=(value==1?true:false);
});
PatientInfoComponent.method("isRFVDisplay",function(){return this.m_displayRFV;
});
PatientInfoComponent.method("setRFVDisplay",function(value){if(value==1){this.rowCount++;
}this.m_displayRFV=(value==1?true:false);
});
PatientInfoComponent.method("isPrimaryPhysDisplay",function(){return this.m_primaryPhysDisplay;
});
PatientInfoComponent.method("setPrimaryPhysDisplay",function(value){if(value==1){this.rowCount++;
}this.m_primaryPhysDisplay=(value==1?true:false);
});
PatientInfoComponent.method("isAttendingPhysDisplay",function(){return this.m_attedingPhysDisplay;
});
PatientInfoComponent.method("setAttendingPhysDisplay",function(value){if(value==1){this.rowCount++;
}this.m_attedingPhysDisplay=(value==1?true:false);
});
PatientInfoComponent.method("isAdmittingPhysDisplay",function(){return this.m_admittingPhysDisplay;
});
PatientInfoComponent.method("setAdmittingPhysDisplay",function(value){if(value==1){this.rowCount++;
}this.m_admittingPhysDisplay=(value==1?true:false);
});
PatientInfoComponent.method("isRoomBedDisplay",function(){return this.m_roombedDisplay;
});
PatientInfoComponent.method("setRoomBedDisplay",function(value){if(value==1){this.rowCount++;
}this.m_roombedDisplay=(value==1?true:false);
});
PatientInfoComponent.method("isAdmitDateDisplay",function(){return this.m_admitDateDisplay;
});
PatientInfoComponent.method("setAdmitDateDisplay",function(value){if(value==1){this.rowCount++;
}this.m_admitDateDisplay=(value==1?true:false);
});
PatientInfoComponent.method("isEmergencyContactsDisplay",function(){return this.m_emergencyContactsDisplay;
});
PatientInfoComponent.method("setEmergencyContactsDisplay",function(value){this.m_emergencyContactsDisplay=(value==1?true:false);
});
PatientInfoComponent.method("getRowCount",function(){return this.rowCount;
});
PatientInfoComponent.method("getDietOrders",function(){return(this.m_diet);
});
PatientInfoComponent.method("setDietOrders",function(value){this.m_diet=value;
});
PatientInfoComponent.method("getPatientActivityOrders",function(){return(this.m_patAct);
});
PatientInfoComponent.method("setPatientActivityOrders",function(value){this.m_patAct=value;
});
}PatientInfoComponent.inherits(MPageComponent);
var CERN_PATINFO_O1=function(){var timerPatInfoLoad=null;
return{SendPatientData:function(component){var criterion=component.getCriterion();
var sendVal=[];
sendVal.push("^MINE^",criterion.person_id+".0",criterion.encntr_id+".0");
var codes=component.getVisitTypeCodes();
sendVal.push((codes!=null&&codes.length>0)?"value("+codes.join(",")+")":"0");
sendVal.push((component.getEstimatedDischargeDate()!=null)?"value("+component.getEstimatedDischargeDate().join(",")+")":"0.0");
sendVal.push((component.getChiefComplaint()!=null)?"value("+component.getChiefComplaint().join(",")+")":"0.0");
sendVal.push((component.getModeofArrival()!=null)?"value("+component.getModeofArrival().join(",")+")":"0.0");
sendVal.push((component.getAdvancedDirectives()!=null)?"value("+component.getAdvancedDirectives().join(",")+")":"0.0");
sendVal.push((component.getResusOrders()!=null)?"value("+component.getResusOrders().join(",")+")":"0.0");
sendVal.push((component.getDocumentTypes()!=null)?"value("+component.getDocumentTypes().join(",")+")":"0.0");
var prsnlInfo=criterion.getPersonnelInfo();
var encntrs=prsnlInfo.getViewableEncounters();
var encntrVal=(encntrs)?"value("+encntrs+")":"0.0";
sendVal.push(0,encntrVal,criterion.provider_id+".0",criterion.ppr_cd+".0");
sendVal.push((component.getDietOrders()!=null)?"value("+component.getDietOrders().join(",")+")":"0.0");
sendVal.push((component.getPatientActivityOrders()!=null)?"value("+component.getPatientActivityOrders().join(",")+")":"0.0");
MP_Core.XMLCclRequestWrapper(component,"mp_get_patinfo",sendVal,true);
return;
},GetPatientInfo:function(component,reportData){var criterion=component.getCriterion();
var patInfoI18n=i18n.discernabu.patinfo_o1;
var jsPtHTML=[];
var tempAr=[];
var ptHTML="";
var countText="";
var rfv=patInfoI18n.NO_RESULTS_FOUND;
var roomBed=patInfoI18n.NO_RESULTS_FOUND;
var admitDiag=patInfoI18n.NO_RESULTS_FOUND;
var admitDate=patInfoI18n.NO_RESULTS_FOUND;
var primPhys=patInfoI18n.NO_RESULTS_FOUND;
var attPhys=patInfoI18n.NO_RESULTS_FOUND;
var admPhys=patInfoI18n.NO_RESULTS_FOUND;
var medService=patInfoI18n.NO_RESULTS_FOUND;
var dischargeDate=patInfoI18n.NO_RESULTS_FOUND;
var recCount=0;
var dateTime=new Date();
var contact=5;
var patLstVstdisp;
var df=new mp_formatter.DateTimeFormatter(MPAGE_LOCALE);
var lastVisitDtTm=new Date();
var visitListCnt=reportData.VISIT_LIST.length;
var multVisitTypeInd=reportData.MULT_VISIT_TYPE_IND;
if(reportData.RFV!=""){rfv=reportData.RFV;
}if(reportData.ROOM_BED!=""){roomBed=reportData.ROOM_BED;
}if(reportData.ADMIT_DT_TM!=""){admitDate=reportData.ADMIT_DT_TM;
dateTime.setISO8601(admitDate);
admitDate=df.format(dateTime,mp_formatter.DateTimeFormatter.FULL_DATE_4YEAR);
}if(reportData.PRIMARY_PHYS!=""){primPhys=reportData.PRIMARY_PHYS;
}if(reportData.ATTENDING_PHYS!=""){attPhys=reportData.ATTENDING_PHYS;
}if(reportData.ADMITTING_PHYS!=""){admPhys=reportData.ADMITTING_PHYS;
}if(reportData.MED_SERVICE!=""){medService=reportData.MED_SERVICE;
}if(reportData.ESTIMATED_DEPART_DT_TM!=""){if(reportData.ESTIMATED_DEPART_DATE>0){dischargeDate=df.formatISO8601(reportData.ESTIMATED_DEPART_DT_TM,mp_formatter.DateTimeFormatter.FULL_DATE_4YEAR);
}else{dischargeDate=reportData.ESTIMATED_DEPART_DT_TM;
}}jsPtHTML.push("<div class='",MP_Util.GetContentClass(component,component.getRowCount()),"'>");
if(component.getChiefComplaint()!=null){var chiefComplaint="<dd class='pt-detail'><span>"+patInfoI18n.NO_RESULTS_FOUND+"</span></dd>";
if(reportData.CHIEFCOMPLAINTS.length>0){var complaint=reportData.CHIEFCOMPLAINTS[0].CHIEFCOMPLAINT;
if(complaint>""){tempAr=[];
var resModified=(reportData.CHIEFCOMPLAINTS[0].MODIFIED_FLAG>0)?"<span class='res-modified'>&nbsp;</span>":"";
var eventid=reportData.CHIEFCOMPLAINTS[0].EVENTID;
var viewerLink=ptEventViewerLink(criterion.person_id+".0",eventid,complaint);
tempAr.push("<dd class='pt-detail'><span>",viewerLink,"</span>",resModified,"</dd>");
chiefComplaint=tempAr.join("");
}}jsPtHTML.push("<dl class='pt-info'><dt class='pt-label'><span>",patInfoI18n.CHIEF_COMPLAINT,":</span></dt>",chiefComplaint,"</dl>");
}if(component.isRFVDisplay()){jsPtHTML.push("<dl class='pt-info'><dt class='pt-label'><span>",patInfoI18n.RFV,":</span></dt><dd class='pt-detail'><span>",rfv,"</span></dd></dl>");
}if(component.isPrimaryPhysDisplay()){jsPtHTML.push("<dl class='pt-info'><dt  class='pt-label'><span>",patInfoI18n.PRIM_PHYS,":</span></dt><dd class='pt-detail'><span>",primPhys,"</span></dd></dl>");
}if(component.isAttendingPhysDisplay()){jsPtHTML.push("<dl class='pt-info'><dt  class='pt-label'><span>",patInfoI18n.ATTEND_PHYS,":</span></dt><dd class='pt-detail'><span>",attPhys,"</span></dd></dl>");
}if(component.isAdmittingPhysDisplay()){jsPtHTML.push("<dl class='pt-info'><dt  class='pt-label'><span>",patInfoI18n.ADMIT_PHYS,":</span></dt><dd class='pt-detail'><span>",admPhys,"</span></dd></dl>");
}if(component.isMedicalServiceDisplay()){jsPtHTML.push("<dl class='pt-info'><dt  class='pt-label'><span>",patInfoI18n.SERVICE,":</span></dt><dd class='pt-detail'><span>",medService,"</span></dd></dl>");
}if(component.isRoomBedDisplay()){jsPtHTML.push("<dl class='pt-info'><dt class='pt-label'><span>",patInfoI18n.ROOM_BED,":</span></dt><dd class='pt-detail'><span>",roomBed,"</span></dd></dl>");
}if(component.isAdmitDateDisplay()){jsPtHTML.push("<dl class='pt-info'><dt class='pt-label'><span>",patInfoI18n.ADMIT_DATE,":</span></dt><dd class='pt-detail'><span>",admitDate,"</span></dd></dl>");
}if(component.getEstimatedDischargeDate()!=null){var resModified=(reportData.ESTIMATED_DEPART_MODIFIED_FLAG>0)?"<span class='res-modified'>&nbsp;</span>":"";
var eventid=reportData.ESTIMATED_DEPART_EVENTID;
if(eventid>0){var viewerLink=ptEventViewerLink(criterion.person_id+".0",eventid,dischargeDate);
}else{var viewerLink=dischargeDate;
}jsPtHTML.push("<dl class='pt-info'><dt class='pt-label'><span>",patInfoI18n.TARGETED_DISCHARGE_DATE,":</span></dt><dd class='pt-detail'><span>",viewerLink,"</span>",resModified,"</dd></dl>");
}if(component.getModeofArrival()!=null){var modeofArrival="<dd class='pt-detail'><span>"+patInfoI18n.NO_RESULTS_FOUND+"</span></dd>";
if(reportData.MODESOFARRIVAL.length>0){var arrival=reportData.MODESOFARRIVAL[0].MODEOFARRIVAL;
if(arrival>""){tempAr=[];
var resModified=(reportData.MODESOFARRIVAL[0].MODIFIED_FLAG>0)?"<span class='res-modified'>&nbsp;</span>":"";
var eventid=reportData.MODESOFARRIVAL[0].EVENTID;
var viewerLink=ptEventViewerLink(criterion.person_id+".0",eventid,arrival);
tempAr.push("<dd class='pt-detail'><span>",viewerLink,"</span>",resModified,"</dd>");
modeofArrival=tempAr.join("");
}}jsPtHTML.push("<dl class='pt-info'><dt class='pt-label'><span>",patInfoI18n.MODE_OF_ARRVAL,":</span></dt>",modeofArrival,"</dl>");
}if(component.getAdvancedDirectives()!=null){var advancedirective="<dd class='pt-detail'><span>"+patInfoI18n.NO_RESULTS_FOUND+"</span></dd>";
if(reportData.ADVANCEDDIRECTIVES.length>0){var directive=reportData.ADVANCEDDIRECTIVES[0].ADVANCEDIRECTIVE;
if(directive>""){tempAr=[];
var resModified=(reportData.ADVANCEDDIRECTIVES[0].MODIFIED_FLAG>0)?"<span class='res-modified'>&nbsp;</span>":"";
var eventid=reportData.ADVANCEDDIRECTIVES[0].EVENTID;
var viewerLink=ptEventViewerLink(criterion.person_id+".0",eventid,directive);
tempAr.push("<dd class='pt-detail'><span>",viewerLink,"</span>",resModified,"</dd>");
advancedirective=tempAr.join("");
}}jsPtHTML.push("<dl class='pt-info'><dt class='pt-label'><span>",patInfoI18n.ADVANCE_DIRECTIVE,":</span></dt>",advancedirective,"</dl>");
}if(visitListCnt>0){patLstVstdisp="";
var resModified=(reportData.LASTVISITDOCMODFLAG>0)?"<span class='res-modified'>&nbsp;</span>":"";
if(reportData.VISIT_LIST[0].UTCDATE!=""){var lastVisit=reportData.VISIT_LIST[0].UTCDATE;
lastVisitDtTm.setISO8601(lastVisit);
patLstVstdisp=df.format(lastVisitDtTm,mp_formatter.DateTimeFormatter.FULL_DATE_4YEAR);
}if(reportData.DOCVIEWERTYPE==="AP"){if((reportData.LASTVISITEVENTID>0)&&(reportData.LASTVISITPEVENTID>0)){jsPtHTML.push("<dl class='pt-info'><dt class='pt-label'><span>",patInfoI18n.LAST_VISIT,":</span></dt><dd class='pt-detail'><span>",MP_Util.CreateClinNoteLink(component.getCriterion().person_id,component.getCriterion().encntr_id,reportData.LASTVISITEVENTID,patLstVstdisp+"&nbsp("+reportData.VISIT_LIST[0].TYPE+")",reportData.DOCVIEWERTYPE,reportData.LASTVISITPEVENTID),"</span></dd></dl>");
}else{jsPtHTML.push("<dl class='pt-info'><dt class='pt-label'><span>",patInfoI18n.LAST_VISIT,":</span></dt><dd class='pt-detail'><span>",patLstVstdisp,"&nbsp","(",reportData.VISIT_LIST[0].TYPE,")","</span>",resModified,"</dd></dl>");
}}else{if((reportData.DOCVIEWERTYPE!=="STANDARD")&&(reportData.LASTVISITEVENTID>0)){jsPtHTML.push("<dl class='pt-info'><dt class='pt-label'><span>",patInfoI18n.LAST_VISIT,":</span></dt><dd class='pt-detail'><span>",MP_Util.CreateClinNoteLink(component.getCriterion().person_id,component.getCriterion().encntr_id,reportData.LASTVISITEVENTID,patLstVstdisp+"&nbsp("+reportData.VISIT_LIST[0].TYPE+")",reportData.DOCVIEWERTYPE,reportData.LASTVISITPEVENTID),"</span></dd></dl>");
}else{jsPtHTML.push("<dl class='pt-info'><dt class='pt-label'><span>",patInfoI18n.LAST_VISIT,":</span></dt><dd class='pt-detail'><span>",patLstVstdisp,"&nbsp","(",reportData.VISIT_LIST[0].TYPE,")","</span>",resModified,"</dd></dl>");
}}if(visitListCnt>1){jsPtHTML.push("<h4 class='det-hd'><span>",patInfoI18n.DETAILS,"</span></h4><div class='hvr'><dl class='pt-det'>");
if(multVisitTypeInd==0){for(var j=0,m=reportData.VISIT_LIST.length;
j<m;
j++){if(reportData.VISIT_LIST[j].UTCDATE!=""){var lastVis=reportData.VISIT_LIST[j].UTCDATE;
lastVisitDtTm.setISO8601(lastVis);
jsPtHTML.push("<dd><span>",df.format(lastVisitDtTm,mp_formatter.DateTimeFormatter.FULL_DATE_4YEAR),"</span></dd><br/>");
}}}else{if(multVisitTypeInd==1){for(var j=0,m=reportData.VISIT_LIST.length;
j<m;
j++){if(reportData.VISIT_LIST[0].UTCDATE!=""){var lastVisit1=reportData.VISIT_LIST[j].UTCDATE;
lastVisitDtTm.setISO8601(lastVisit1);
jsPtHTML.push("<dd><span>",df.format(lastVisitDtTm,mp_formatter.DateTimeFormatter.FULL_DATE_4YEAR),"&nbsp","(",reportData.VISIT_LIST[j].TYPE,")","</span></dd><br/>");
}}}}jsPtHTML.push("</dl></div>");
}}else{jsPtHTML.push("<dl class='pt-info'><dt class='pt-label'><span>",patInfoI18n.LAST_VISIT,":</span></dt><dd class='pt-detail'><span>",patInfoI18n.NO_RESULTS_FOUND,"</span></dd></dl>");
}if(component.getResusOrders()!=null){var codeStatus="";
var codeStatusDetails="";
for(i=0,k=reportData.RESUSCITATION.length;
i<k;
i++){if(i>0){codeStatus+=", ";
}codeStatus+=reportData.RESUSCITATION[i].CODE_STATUS;
codeStatusDetails=reportData.RESUSCITATION[i].CODE_STATUS_DETAILS;
}if(codeStatus==""){codeStatus=patInfoI18n.NO_RESULTS_FOUND;
codeStatusDetails="";
}jsPtHTML.push("<dl class='pt-info'><dt  class='pt-label'><span>",patInfoI18n.CODE_STATUS,":</span></dt><dd class='pt-detail'><span class='res-severe'>",codeStatus,"</span></dd></dl>");
if(codeStatusDetails!=""){jsPtHTML.push("<h4 class='det-hd'><span>",patInfoI18n.DETAILS,"</span></h4><div class='hvr'><dl class='pt-det'><dd><span>",codeStatusDetails,"</span></dd></dl></div>");
}}if(component.getDietOrders()||component.getPatientActivityOrders()){if(!reportData.DIET&&!reportData.ACTIVITY_ORDER){jsPtHTML.push("<div class='sub-sec closed'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl'>-</span><span class='sub-sec-title'>",patInfoI18n.DIET_ACTIVITY," (0) </span></h3><div class='sub-sec-content'><span class='res-none'>",patInfoI18n.NO_RESULTS_FOUND,"</span></div></div>");
}else{var counter=(reportData.DIET&&reportData.ACTIVITY_ORDER)?2:1;
jsPtHTML.push("<div class='sub-sec'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl'>-</span><span class='sub-sec-title'>",patInfoI18n.DIET_ACTIVITY," (",counter,")</span></h3><div class='sub-sec-content'>");
if(reportData.DIET){jsPtHTML.push("<dl class='pt-info'><dt class='pt-label'><span>",reportData.DIET,"</span></dt><dd class='pt-detail'><span>",reportData.DIET_ORDER_DISP,"</span></dd></dl>");
}if(reportData.ACTIVITY_ORDER){jsPtHTML.push("<dl class='pt-info'><dt class='pt-label'><span>",reportData.ACTIVITY_ORDER,"</span></dt><dd class='pt-detail'><span>",reportData.ACTIVITY_ORDER_DISP,"</span></dd></dl>");
}jsPtHTML.push("</div></div>");
}}if(component.isEmergencyContactsDisplay()){var contactList=reportData.CONTACT_LIST;
if(contactList.length>0){jsPtHTML.push("<div class='sub-sec'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl'>-</span><span class='sub-sec-title'>",patInfoI18n.EMER_CONTACT," (",contactList.length,")</span></h3><div class='sub-sec-content'>");
for(var j=0,m=contactList.length;
j<m;
j++){jsPtHTML.push("<dl class='pt-info'><dt class='pt-label'><span>",contactList[j].NAME,":</span></dt><dd class='pt-detail'><span>",contactList[j].NUMBER,"</span></dd></dl>");
if(contactList[j].CONTACT_PHONE.length>0){jsPtHTML.push("<h4 class='det-hd'><span>",patInfoI18n.DETAILS,"</span></h4><div class='hvr'><dl class='pt-det'>");
}for(var x=0,y=contactList[j].CONTACT_PHONE.length;
x<y;
x++){jsPtHTML.push("<dd><span>",contactList[j].CONTACT_PHONE[x].NUMBER,"</span></dd><br/>");
}jsPtHTML.push("</dl></div>");
}jsPtHTML.push("</div></div>");
}else{jsPtHTML.push("<div class='sub-sec closed'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl'>-</span><span class='sub-sec-title'>",patInfoI18n.EMER_CONTACT," (0)</span></h3><div class='sub-sec-content'><span class='res-none'>",patInfoI18n.NO_RESULTS_FOUND,"</span></div></div>");
}}jsPtHTML.push("</div>");
ptHTML=jsPtHTML.join("");
countText=MP_Util.CreateTitleText(component,component.getRowCount(),false,false,false);
MP_Util.Doc.FinalizeComponent(ptHTML,component,countText);
return;
}};
function ptEventViewerLink(personid,eventid,result){var ar=[];
var params=[personid,"0.0",eventid,'"EVENT"',"0.0"];
ar.push("<a onclick='MP_Util.LaunchClinNoteViewer(",params.join(","),"); return false;' href='#'>",result,"</a>");
return ar.join("");
}}();
function DischargePlanningComponentStyle(){this.initByNamespace("rrcm-dcp-dcp");
}DischargePlanningComponentStyle.inherits(ComponentStyle);
function DischargePlanningComponent(criterion){this.setCriterion(criterion);
this.setStyles(new DischargePlanningComponentStyle());
this.setComponentLoadTimerName("USR:MPG.NW-rcm-dcp-DISCHARGE-PLANNING.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.NW-rcm-dcp-DISCHARGE-PLANNING.O1 - render component");
this.setIncludeLineNumber(true);
this.setScope(2);
DischargePlanningComponent.method("openTab",function(){var paramString=criterion.person_id+"|"+criterion.encntr_id+"|"+0+"|0|0";
MPAGES_EVENT("POWERFORM",paramString);
var contentNode=this.getSectionContentNode();
contentNode.innerHTML="";
this.InsertData();
});
DischargePlanningComponent.method("openDropDown",function(formID){var criterion=this.getCriterion();
var paramString=criterion.person_id+"|"+criterion.encntr_id+"|"+formID+"|0|0";
MPAGES_EVENT("POWERFORM",paramString);
var contentNode=this.getSectionContentNode();
contentNode.innerHTML="";
this.InsertData();
});
DischargePlanningComponent.method("InsertData",function(){CERN_DischargePlanningInfo.getDischargePlanningData(this);
});
DischargePlanningComponent.method("HandleSuccess",function(recordData){CERN_DischargePlanningInfo.RenderComponent(this,recordData);
});
DocumentComponent.method("openTab",function(){var criterion=this.getCriterion();
var sParms="/PERSONID="+criterion.person_id+" /ENCNTRID="+criterion.encntr_id+" /FIRSTTAB=^"+this.getLink()+"+^";
APPLINK(0,criterion.executable,sParms);
this.InsertData();
});
DischargePlanningComponent.method("setCategoryMeaning",function(value){this.m_CategoryMeaning=value;
});
DischargePlanningComponent.method("getCategoryMeaning",function(){return this.m_CategoryMeaning;
});
DischargePlanningComponent.method("setReportMeaning",function(value){this.m_ReportMeaning=value;
});
DischargePlanningComponent.method("getReportMeaning",function(){return this.m_ReportMeaning;
});
DischargePlanningComponent.method("setDischargePlan",function(value){this.m_DischargePlan=value;
});
DischargePlanningComponent.method("getDischargePlan",function(){return this.m_DischargePlan;
});
DischargePlanningComponent.method("setEventSets",function(value){this.m_EventSets=value;
});
DischargePlanningComponent.method("getEventSets",function(){return this.m_EventSets;
});
DischargePlanningComponent.method("setVisitRelationshipTypes",function(value){this.m_VisitRelationshipTypes=value;
});
DischargePlanningComponent.method("getVisitRelationshipTypes",function(){return this.m_VisitRelationshipTypes;
});
DischargePlanningComponent.method("setEncntrTypes",function(value){this.m_EncntrTypes=value;
});
DischargePlanningComponent.method("getEncntrTypes",function(){return this.m_EncntrTypes;
});
DischargePlanningComponent.method("setMedicareFinacialTypes",function(value){this.m_MedicareFinacialTypes=value;
});
DischargePlanningComponent.method("getMedicareFinacialTypes",function(){return this.m_MedicareFinacialTypes;
});
DischargePlanningComponent.method("setEventSetsSort",function(value){this.m_EventSetsSort=value;
});
DischargePlanningComponent.method("getEventSetsSort",function(){return this.m_EventSetsSort;
});
DischargePlanningComponent.method("setAdmitMIM",function(value){this.m_AdmitMIM=value;
});
DischargePlanningComponent.method("getAdmitMIM",function(){return this.m_AdmitMIM;
});
DischargePlanningComponent.method("setDischargeMIM",function(value){this.m_DischargeMIM=value;
});
DischargePlanningComponent.method("getDischargeMIM",function(){return this.m_DischargeMIM;
});
DischargePlanningComponent.method("setReadmissionLink",function(value){this.m_ReadmissionLink=value;
});
DischargePlanningComponent.method("getReadmissionLink",function(){return this.m_ReadmissionLink;
});
}DischargePlanningComponent.inherits(MPageComponent);
var CERN_DischargePlanningInfo=function(){return{getDischargePlanningData:function(component){var sendAr=[];
var criterion=component.getCriterion();
var groups=component.getGroups();
var events=[];
events.push('^{"getDischargePlanningRequest": {"encntr_id": "',criterion.encntr_id,'.0",');
events.push('"category_meaning":"',component.getCategoryMeaning(),'",');
events.push('"report_meaning": "',component.getReportMeaning(),'",');
events.push('"discharge_plan": "',component.getDischargePlan(),'",');
events.push('"encntr_types": "',component.getEncntrTypes(),'",');
events.push('"relationships": "',component.getVisitRelationshipTypes(),'",');
events.push('"medicare_finacial_types": "',component.getMedicareFinacialTypes(),'",');
events.push('"event_sets": "',component.getEventSets(),'",');
events.push('"event_sets_sort": "',component.getEventSetsSort(),'",');
events.push('"admit_mim": "',component.getAdmitMIM(),'",');
events.push('"discharge_mim": "',component.getDischargeMIM(),'",');
events.push('"readmission_link": "',component.getReadmissionLink(),'"}}^');
var dc_dc_plan="",dc_dc_disp="",dc_transp_arrange="",dc_prof_skill_ant="",dc_dme_ant="",dc_dme_coord="";
var dc_plan_dc_dt_tm="",dc_adm_mim="",dc_disch_mim="";
sendAr.push("^MINE^","GETDISCHARGEPLANNING",events.join(""));
RCM_Clinical_Util.makeTimerCCLRequest(component,"rcm_discharge_planning",sendAr,true,function(status,RECORDDATA,errorInfo){if("S"===status){component.HandleSuccess(RECORDDATA);
}else{component.HandleSuccess(null);
}});
},RenderComponent:function(component,recordData){var timerRenderComponent=MP_Util.CreateTimer(component.getComponentRenderTimerName());
try{var jsHTML=[];
if(component.getCriterion().encntr_id===0){jsHTML.push("<div>",rcm_discharge_planning_i18n.RCM_INVALID_ENCOUNTER_MESSAGE,"</div>");
}else{var dateTime=new Date();
var rcmdisRowCount=2+recordData.EVENT_SETS.length+recordData.RELATED_PRSNL.length;
if(recordData.MEDICARE_IND===1){rcmdisRowCount+=2;
}var mode=0;
var appName=rcm_discharge_planning_i18n.RCM_POWERCHART;
var tab=recordData.READMISSION_LINK;
var params="/PERSONID="+component.criterion.person_id+" /ENCNTRID="+component.criterion.encntr_id+" /FIRSTTAB=^"+tab+"+^";
jsHTML.push("<div class='",MP_Util.GetContentClass(component,rcmdisRowCount),"'>");
jsHTML.push("<dl class='rcm-dcp-info'><dt><span>",rcm_discharge_planning_i18n.CURRENTDOCUMENTEDPLAN,":</span></dt><dd class='rcm-dcp-detail'><span>",recordData.DISCHARGE_EVENT_SET.VALUE,"</span></dd></dl>");
if(recordData.MEDICARE_IND===1){jsHTML.push("<dl class='rcm-dcp-info'><dt><span>",rcm_discharge_planning_i18n.ADMITIM);
jsHTML.push(":</span></dt><dd class='rcm-dcp-detail'><span>",recordData.ADMIT_MIM_EVENT_SET.VALUE,"</span></dd></dl>");
jsHTML.push("<dl class='rcm-dcp-info'><dt><span>",rcm_discharge_planning_i18n.DISCHARGEIM);
jsHTML.push(":</span></dt><dd class='rcm-dcp-detail'><span>",recordData.DISCHARGE_MIM_EVENT_SET.VALUE,"</span></dd></dl>");
}for(var i=0,eventLength=recordData.EVENT_SETS.length;
i<eventLength;
i++){jsHTML.push("<dl class='rcm-dcp-info'><dt><span>",recordData.EVENT_SETS[i].LABEL,":</span></dt>");
jsHTML.push("<dd class='rcm-dcp-detail'><span>",recordData.EVENT_SETS[i].VALUE,"</span></dd></dl>");
}for(var i=0,relLength=recordData.RELATED_PRSNL.length;
i<relLength;
i++){jsHTML.push("<dl class='rcm-dcp-info'><dt><span>",recordData.RELATED_PRSNL[i].RELATIONSHIPTYPENAME,":</span></dt>");
jsHTML.push("<dd class='rcm-dcp-detail'><span>",recordData.RELATED_PRSNL[i].NAME,"</span></dd></dl>");
}if(recordData.READMITTANCE_IND===1){jsHTML.push("<dl class='rcm-dcp-info'><dt><span>",rcm_discharge_planning_i18n.READMISSION,":</span></dt>");
jsHTML.push("<dd class='rcm-dcp-detail'><span>");
if(recordData.READMISSION_DOC_IND===1){jsHTML.push("<a style='color:black; text-decoration:none; font-weight:normal;'");
}else{jsHTML.push("<a style='color:red; text-decoration:none; font-weight:bold;'");
}jsHTML.push("href='javascript:APPLINK("+mode+', "'+appName+'", "'+params+"\");'>",rcm_discharge_planning_i18n.YES,"</a>&nbsp;</span></dd></dl>");
}jsHTML.push("<dl class='rcm-dcp-info'><dt><span></span></dt><dd class='rcm-dcp-detail'><span></span></dd></dl>");
jsHTML.push("</div>");
}sHTML=jsHTML.join("");
countText="&nbsp;";
MP_Util.Doc.FinalizeComponent(sHTML,component,countText);
if(component.getCriterion().encntr_id===0){var addPlus=document.getElementById("rrcm-dcp-dcpAdd");
if(addPlus){addPlus.style.display="none";
}var addDrop=document.getElementById("rrcm-dcp-dcpDrop");
if(addDrop){addDrop.style.display="none";
}}return;
}catch(err){if(timerRenderComponent){timerRenderComponent.Abort();
timerRenderComponent=null;
}throw (err);
}finally{if(timerRenderComponent){timerRenderComponent.Stop();
}}}};
}();
var CERN_InsuranceInfo=function(){var loc;
var faxImageFile;
return{getToggleArray:function(par,tog){return Util.Style.g(tog,par,"span");
},modifyDialog:null,modifyDialogLabelNameMap:{insDateModify:"authdates0"},GetInsuranceTable:function(component){this.component=component;
var sendAr=[];
var criterion=component.getCriterion();
sendAr.push("^MINE^",criterion.person_id+".0",+criterion.encntr_id+".0");
var ins_delegate=new InsuranceDelegate();
ins_delegate.getData(sendAr,this.component);
},initInsuranceLocHovers:function(node){var tr=Util.Style.g("sub-sec-hd",node,"H3");
for(var i=0,l=tr.length;
i<l;
i++){var m=tr[i];
if(m){var nm=Util.gns(Util.gns(m));
if(nm){if(Util.Style.ccss(nm,"ins-hvr")){hs(m,nm);
}}}}},handleOver:function(insLabel){if(CERN_InsuranceInfo.allowedToModify()){insLabel.style.border="dashed 1px #3797FE";
insLabel.style.cursor="hand";
}},handleOut:function(insLabel){if(CERN_InsuranceInfo.allowedToModify()){insLabel.style.border="";
}},getPosition:function(displayLabel){var position=$(displayLabel).offset();
var cursor={x:0,y:0};
cursor.x=position.left;
cursor.y=position.top+$(displayLabel).height()+3;
return cursor;
},allowedToModify:function(){if(this.RECORDDATA.CANMODIFYIND===1){return true;
}},closeDialog:function(){if(this.modifyDialog){this.modifyDialog.innerHTML="";
this.modifyDialog.style.display="none";
}},cancelDialog:function(){if(this.modifyDialog){this.modifyDialog.innerHTML="";
this.modifyDialog.style.display="none";
}},cancelErrorDialog:function(){document.getElementById("errorDialog").style.display="none";
},changeNumDays:function(){startDayString=document.getElementById("AuthStartDatePicker").value;
endDayString=document.getElementById("AuthEndDatePicker").value;
var startDay=new Date(startDayString);
var endDay=new Date(endDayString);
var oneDay=1000*60*60*24;
var diffInDaysInMillis=endDay.getTime()-startDay.getTime();
var diffInDays=0;
diffInDays=Math.ceil(diffInDaysInMillis/oneDay)+1;
if(document.getElementById("lblNumDays")){if(diffInDays<=0){document.getElementById("lblNumDays").innerHTML=rcm_insurance_info_i18n.RCM_NUMBER_OF_DAYS+" : 0 ";
}else{if(diffInDays===1){document.getElementById("lblNumDays").innerHTML=rcm_insurance_info_i18n.RCM_NUMBER_OF_DAYS+" :  1 ";
}else{if(diffInDays>1){document.getElementById("lblNumDays").innerHTML=rcm_insurance_info_i18n.RCM_NUMBER_OF_DAYS+" : "+diffInDays;
}}}}},openDialog:function(container,fieldName){CERN_InsuranceInfo.closeDialog();
if(this.modifyDialog===null){this.modifyDialog=document.getElementById("ins-modify-dialog");
}var content;
var flexButtonIds=["saveButton"];
var authorization=CERN_InsuranceInfo.getAuthorization(container.id);
if(fieldName==="authDates"){content="<div onMouseOver ='CERN_InsuranceInfo.changeNumDays()' onMouseOut='CERN_InsuranceInfo.changeNumDays()'><div><label>"+rcm_insurance_info_i18n.RCM_START_DATE+"</label></div><div><input type='text' name='AuthStartDatePicker' id='AuthStartDatePicker' value='' /></div><div><label>"+rcm_insurance_info_i18n.RCM_END_DATE+"</label></div><div><input type='text' name='AuthEndDatePicker' id='AuthEndDatePicker' value=''  /></div><div class='ins-modify-dialog-buttons'><span class=''>";
if((authorization.NUMBERAUTHQUALIFIERMEANING==="DAYS")||(CERN_InsuranceInfo.isDays(container.id))){content+="<label id='lblNumDays'>"+rcm_insurance_info_i18n.RCM_NUMBER_OF_DAYS+": 0 </label>";
}content+="<input type='button' onclick='CERN_InsuranceInfo.cancelDialog()' value='"+rcm_insurance_info_i18n.RCM_CANCEL+"'/><input type='button' onclick='CERN_InsuranceInfo.saveDialog(\""+container.id+'", "'+fieldName+"\")' id = 'saveButton' value='"+rcm_insurance_info_i18n.RCM_SAVE+"'/></span></div></div>";
this.modifyDialog.style.height=150+"px";
this.modifyDialog.innerHTML=content;
var formObject={};
RCM_Clinical_Util.addDatePicker(this.component,"AuthStartDatePicker");
RCM_Clinical_Util.addDatePicker(this.component,"AuthEndDatePicker");
RCM_Clinical_Util.addRequiredField(formObject,"AuthStartDatePicker","date",flexButtonIds);
RCM_Clinical_Util.addRequiredField(formObject,"AuthEndDatePicker","date",flexButtonIds);
RCM_Clinical_Util.setDateString("AuthStartDatePicker",authorization.SERVICEBEGINDATETIME);
RCM_Clinical_Util.setDateString("AuthEndDatePicker",authorization.SERVICEENDDATETIME);
$("#AuthStartDatePicker").keydown(function(){CERN_InsuranceInfo.changeNumDays();
});
$("#AuthEndDatePicker").keydown(function(){CERN_InsuranceInfo.changeNumDays();
});
}else{if(fieldName==="authFax"){this.loc=this.component.criterion.static_content;
this.faxImageFile=this.loc+"\\images\\5104_16.png";
if(authorization.CONTACTFAXNUMBER){content="<div><input type='text'  id='faxFieldNum'  value = '"+authorization.CONTACTFAXNUMBER+"'/>";
}else{content="<div><input type='text'  id='faxFieldNum' />";
}content+="<img id='infoImage' class= 'image-info' src='"+this.faxImageFile+"'/></div><div class= 'ins-hvr' id = 'hvrInfo'>"+rcm_insurance_info_i18n.RCM_FAX_INFORMATION+"</div> <div class='ins-modify-dialog-buttons'><span class='ins-modify-dialog-buttons'><input type='button' onclick='CERN_InsuranceInfo.cancelDialog()' value='"+rcm_insurance_info_i18n.RCM_CANCEL+"'/><input type='button' onclick='CERN_InsuranceInfo.saveDialog(\""+container.id+'", "'+fieldName+"\")' id = 'saveButton' value='"+rcm_insurance_info_i18n.RCM_SAVE+"'/></span></div>";
this.modifyDialog.style.height=60+"px";
this.modifyDialog.innerHTML=content;
var formObject={};
RCM_Clinical_Util.hs(infoImage,hvrInfo);
RCM_Clinical_Util.addMaskToTextBox("faxFieldNum","?99999999999999999999");
RCM_Clinical_Util.addRequiredField(formObject,"faxFieldNum","maskedtext",flexButtonIds);
}else{if(fieldName==="authNum"){content="<div><input type='text' name='authNumber' id='authNumber' value=''/></div><div class='ins-modify-dialog-buttons'><span class='ins-modify-dialog-buttons'><input type='button' onclick='CERN_InsuranceInfo.cancelDialog()' value='"+rcm_insurance_info_i18n.RCM_CANCEL+"'/><input type='button' onclick='CERN_InsuranceInfo.saveDialog(\""+container.id+'", "'+fieldName+"\")' id = 'saveButton' value='"+rcm_insurance_info_i18n.RCM_SAVE+"'/></span></div>";
this.modifyDialog.style.height=70+"px";
this.modifyDialog.innerHTML=content;
}else{if(fieldName==="authStatus"){content="<div><select id=authStatusDropDown><option value = '' selected = 'selected'></option>";
for(i=0;
i<this.RECORDDATA.AUTHORIZATIONSTATUSCDS.length;
i++){var savedStatus=authorization.AUTHORIZATIONSTATUSDISP;
var current=this.RECORDDATA.AUTHORIZATIONSTATUSCDS[i];
if(savedStatus===current.DISPLAY){content+="<option value = '"+current.VALUE+"' selected= 'selected'>"+current.DISPLAY+"</option>";
}else{content+="<option value = '"+current.VALUE+"'>"+current.DISPLAY+"</option>";
}}content+="</select></div> <div class='ins-modify-dialog-buttons'><span class='ins-modify-dialog-buttons'><input type='button' onclick='CERN_InsuranceInfo.cancelDialog()' value='"+rcm_insurance_info_i18n.RCM_CANCEL+"'/><input type='button' onclick='CERN_InsuranceInfo.saveDialog(\""+container.id+'", "'+fieldName+"\")' id = 'saveButton' value='"+rcm_insurance_info_i18n.RCM_SAVE+"'/></span></div></div>";
this.modifyDialog.style.height=50+"px";
this.modifyDialog.innerHTML=content;
}}}}var pos=CERN_InsuranceInfo.getPosition(container);
var currentWidth=parseInt(this.modifyDialog.currentStyle.width);
var currentHeight=parseInt(this.modifyDialog.currentStyle.height);
var currentXLoc=parseInt(pos.x);
var currentYLoc=parseInt(pos.y);
var currentBrowserWidth=document.body.offsetWidth;
var currentBrowserHeight=document.documentElement.clientHeight;
var maxHeight=$(document).scrollTop()+document.documentElement.clientHeight-currentHeight;
var screenDifference=(currentWidth+currentXLoc)-currentBrowserWidth;
var heightDifference=(currentHeight+currentYLoc)-currentBrowserHeight;
if(screenDifference>0){pos.x=currentXLoc-screenDifference-20;
}if(pos.y>maxHeight){pos.y=maxHeight-20;
}this.modifyDialog.style.top=pos.y+"px";
this.modifyDialog.style.left=pos.x+"px";
this.modifyDialog.style.display="block";
document.body.appendChild(this.modifyDialog);
var rePositionModifyDialog=function(){this.modifyDialog=document.getElementById("ins-modify-dialog");
if(this.modifyDialog){var position=CERN_InsuranceInfo.getPosition(container);
var modifyDialogHeight=this.modifyDialog.offsetHeight;
var maximumHeight=$(document).scrollTop()+document.documentElement.clientHeight-modifyDialogHeight;
if(position.y<$(document).scrollTop()){position.y=$(document).scrollTop();
}else{if(position.y>maximumHeight){position.y=maximumHeight;
}}var modifyDialogWidth=this.modifyDialog.offsetWidth;
var maximumWidth=document.documentElement.clientWidth-modifyDialogWidth;
if(position.x<0){position.x=0;
}else{if(position.x>maximumWidth){position.x=maximumWidth;
}}this.modifyDialog.style.top=position.y+"px";
this.modifyDialog.style.left=position.x+"px";
}};
var columnOne=$(".col1");
if(columnOne&&columnOne.length===1){columnOne.scroll(rePositionModifyDialog);
columnOne.resize(rePositionModifyDialog);
}var columnTwo=$(".col2");
if(columnTwo&&columnTwo.length===1){columnTwo.scroll(rePositionModifyDialog);
columnTwo.resize(rePositionModifyDialog);
}var columnThree=$(".col3");
if(columnThree&&columnThree.length===1){columnThree.scroll(rePositionModifyDialog);
columnThree.resize(rePositionModifyDialog);
}var screen=$(window);
if(screen&&screen.length===1){screen.scroll(rePositionModifyDialog);
screen.resize(rePositionModifyDialog);
}},getAuthorization:function(id){for(var i=0;
i<this.RECORDDATA.HEALTHPLANRELATIONSHIPS.length;
i++){var healthplan=this.RECORDDATA.HEALTHPLANRELATIONSHIPS[i];
for(var j=0;
j<healthplan.AUTHORIZATIONS.length;
j++){var authorization=healthplan.AUTHORIZATIONS[j];
if(authorization.ID===id){return authorization;
}}}return null;
},getHealthPlanRelationshipId:function(id){for(var i=0;
i<this.RECORDDATA.HEALTHPLANRELATIONSHIPS.length;
i++){var healthplan=this.RECORDDATA.HEALTHPLANRELATIONSHIPS[i];
for(var j=0;
j<healthplan.AUTHORIZATIONS.length;
j++){var authorization=healthplan.AUTHORIZATIONS[j];
if(authorization.ID===id){return healthplan.ID;
}}}return null;
},popDateErrorDialog:function(){document.getElementById("error-title").innerHTML=rcm_insurance_info_i18n.RCM_DATE_RANGE_ERROR;
document.getElementById("errorMessage").innerHTML=rcm_insurance_info_i18n.RCM_BAD_DATE;
document.getElementById("errorDialog").style.display="block";
document.body.appendChild(document.getElementById("errorDialog"));
},popSaveErrorMessage:function(){document.getElementById("error-title").innerHTML=rcm_insurance_info_i18n.RCM_SAVE_ERROR;
document.getElementById("errorMessage").innerHTML=rcm_insurance_info_i18n.RCM_MODIFY_FAIL_MESSAGE;
document.getElementById("errorDialog").style.display="block";
document.body.appendChild(document.getElementById("errorDialog"));
},popStaleDataErrorDialog:function(){CERN_InsuranceInfo.cancelDialog();
document.getElementById("error-title").innerHTML=rcm_insurance_info_i18n.RCM_STALE_DATA_ERROR;
document.getElementById("errorMessage").innerHTML=rcm_insurance_info_i18n.RCM_STALE_DATA_ERROR_MESSAGE;
document.getElementById("errorDialog").style.display="block";
document.body.appendChild(document.getElementById("errorDialog"));
},popFaxNumberErrorDialog:function(){document.getElementById("error-title").innerHTML=rcm_insurance_info_i18n.RCM_FAX_NUMBER_ERROR;
document.getElementById("errorMessage").innerHTML=rcm_insurance_info_i18n.RCM_FAX_NUMBER_ERROR_MESSAGE;
document.getElementById("errorDialog").style.display="block";
document.body.appendChild(document.getElementById("errorDialog"));
},popMissingDateErrorDialog:function(){document.getElementById("error-title").innerHTML=rcm_insurance_info_i18n.RCM_DATE_ERROR;
document.getElementById("errorMessage").innerHTML=rcm_insurance_info_i18n.RCM_MISSING_DATE_ERROR_MESSAGE;
document.getElementById("errorDialog").style.display="block";
document.body.appendChild(document.getElementById("errorDialog"));
},isDays:function(id){var auth=CERN_InsuranceInfo.getAuthorization(id);
var remaining=auth.REMAININGNUMBERAUTHORIZED;
var numAuth=auth.NUMBERAUTHORIZED;
var qualifier=auth.NUMBERAUTHORIZEDQUALIFIERDISP;
if(remaining===0&&numAuth===0&&qualifier.length===0){return true;
}},saveDialog:function(containerId,fieldName){$("#saveButton").attr("disabled","disabled");
document.getElementById("errorDialog").style.display="none";
var authorization=CERN_InsuranceInfo.getAuthorization(containerId);
var _serviceBeginDateTime=false;
var serviceBeginDateTime="";
var _serviceEndDateTime=false;
var serviceEndDateTime="";
var _numberAuthorized=false;
var numberAuthorized=0;
var _remainingNumberAuthorized=false;
var remainingNumberAuthorized=0;
var _faxNumber=false;
var faxNumber="";
var _authorizationNumber=false;
var authorizationNumber="";
var _authorizationStatusCd=false;
var authorizationStatusCd="";
var _authorizationQualifierMeaning=false;
var authorizationQualifierMeaning="";
var authorization=CERN_InsuranceInfo.getAuthorization(containerId);
if(fieldName==="authDates"){if(!((document.getElementById("AuthStartDatePicker").value)&&(document.getElementById("AuthEndDatePicker").value))){CERN_InsuranceInfo.popMissingDateErrorDialog();
document.getElementById("error-buttons").focus();
return 0;
}var startDateString=document.getElementById("AuthStartDatePicker").value;
var endDateString=document.getElementById("AuthEndDatePicker").value;
var startDate=new Date(startDateString);
var endDate=new Date(endDateString);
if(startDate>endDate){CERN_InsuranceInfo.popDateErrorDialog();
document.getElementById("error-buttons").focus();
return 0;
}var originalStartDate=new Date(RCM_Clinical_Util.formatJsonDateString(authorization.SERVICEBEGINDATETIME));
var originalEndDate=new Date(RCM_Clinical_Util.formatJsonDateString(authorization.SERVICEENDDATETIME));
if(startDate!==originalStartDate){_serviceBeginDateTime=true;
}if(endDate!==originalEndDate){_serviceEndDateTime=true;
}if(_serviceBeginDateTime||_serviceEndDateTime){serviceBeginDateTime=CERN_InsuranceInfo.formatDateString(startDate);
serviceEndDateTime=CERN_InsuranceInfo.formatDateString(endDate);
if(CERN_InsuranceInfo.isDays(containerId)){_authorizationQualifierMeaning=true;
authorizationQualifierMeaning="DAYS";
}if((authorization.NUMBERAUTHQUALIFIERMEANING==="DAYS")||(CERN_InsuranceInfo.isDays(containerId))){var orginalNumberAuthorized=parseInt(authorization.NUMBERAUTHORIZED);
var originalRemainingNumberAuthorized=parseInt(authorization.REMAININGNUMBERAUTHORIZED);
var oneDay=1000*60*60*24;
var diffInDaysInMillis=endDate.getTime()-startDate.getTime();
numberAuthorized=Math.ceil(diffInDaysInMillis/oneDay)+1;
if(numberAuthorized!==orginalNumberAuthorized){_numberAuthorized=true;
}var dateToday=new Date();
dateToday.setMilliseconds(0);
dateToday.setSeconds(0);
dateToday.setMinutes(0);
dateToday.setHours(0);
diffInDaysInMillis=endDate.getTime()-dateToday.getTime();
if(diffInDaysInMillis>0){remainingNumberAuthorized=diffInDaysInMillis/oneDay;
}if(remainingNumberAuthorized!==originalRemainingNumberAuthorized){_remainingNumberAuthorized=true;
}}}}if(fieldName==="authFax"){var newFaxNumber=document.getElementById("faxFieldNum").value;
var originalFaxNumber=parseInt(authorization.CONTACTFAXNUMBER);
if(newFaxNumber!==originalFaxNumber){_faxNumber=true;
faxNumber=newFaxNumber;
}var faxNumTextLength=document.getElementById("faxFieldNum").value.length;
if(faxNumTextLength<7){CERN_InsuranceInfo.popFaxNumberErrorDialog();
document.getElementById("error-buttons").focus();
return 0;
}}if(fieldName==="authStatus"){var newIndex=document.getElementById("authStatusDropDown").selectedIndex;
var Options=document.getElementById("authStatusDropDown").options;
var newStatusCd=Options[newIndex].value;
var originalStatus=authorization.AUTHORIZATIONSTATUSDISP;
if(originalStatus!==newStatusCd){_authorizationStatusCd=true;
authorizationStatusCd=newStatusCd;
}}if(fieldName==="authNum"){var newAuthNum=document.getElementById("authNumber").value;
if(newAuthNum.length>0){_authorizationNumber=true;
authorizationNumber=newAuthNum;
}}var hpAuthJson={id:authorization.ID,_serviceBeginDateTime:_serviceBeginDateTime==true?1:0,serviceBeginDateTime:serviceBeginDateTime,_serviceEndDateTime:_serviceEndDateTime==true?1:0,serviceEndDateTime:serviceEndDateTime,_numberAuthorized:_numberAuthorized==true?1:0,numberAuthorized:numberAuthorized,_remainingNumberAuthorized:_remainingNumberAuthorized==true?1:0,remainingNumberAuthorized:remainingNumberAuthorized,_faxNumber:_faxNumber==true?1:0,faxNumber:faxNumber,_comments:0,comments:"",_authorizationNumber:_authorizationNumber==true?1:0,authorizationNumber:authorizationNumber,_authorizationStatusCd:_authorizationStatusCd==true?1:0,authorizationStatusCd:authorizationStatusCd,_authorizationQualifierMeaning:_authorizationQualifierMeaning==true?1:0,authorizationQualifierMeaning:authorizationQualifierMeaning};
var healthPlanId=CERN_InsuranceInfo.getHealthPlanRelationshipId(authorization.ID);
var hprltnsJson=[{modifyHealthPlanRelationships:[{id:healthPlanId,healthPlanAuthorizations:[{modifyAuthorizations:[hpAuthJson]}]}]}];
var json={um_request:{encounterId:new String(this.component.criterion.encntr_id),version:this.RECORDDATA.VERSION,patientId:this.RECORDDATA.PATIENTID,healthPlanRelationships:hprltnsJson?hprltnsJson:[]}};
var sendAr=[];
sendAr.push("^MINE^","0.0","^MODIFY^");
sendAr.push("^",JSON.stringify(json),"^");
var insuranceSendDelegate=new InsuranceDelegate();
insuranceSendDelegate.setData(sendAr,this.component);
},formatDateString:function(date){var formattedString=[];
formattedString.push(date.format("dd-mmm-yyyy"));
formattedString.push(" 00:00:00");
return formattedString.join("");
},checkForNumValue:function(clickedField,id,fieldName){if(clickedField&&fieldName!=="authNum"){return'<td class="ins-value" ><span id ="'+id+'" onMouseOver= CERN_InsuranceInfo.handleOver(this) onMouseout= CERN_InsuranceInfo.handleOut(this) onclick= CERN_InsuranceInfo.openDialog(this,"'+fieldName+'")>'+clickedField+"</span>";
}else{if(clickedField&&fieldName==="authNum"){return'<td class="ins-value">'+clickedField;
}else{return'<td class="ins-value" id ="'+id+'"onMouseOver= CERN_InsuranceInfo.handleOver(this) onMouseout= CERN_InsuranceInfo.handleOut(this) onclick= CERN_InsuranceInfo.openDialog(this,"'+fieldName+'")>';
}}},GetInsuranceInfoTable:function(component,recordData){var insuranceContainer=document.getElementById("rcm-info-container");
if(insuranceContainer){insuranceContainer.parentNode.removeChild(insuranceContainer);
}this.RECORDDATA=recordData;
var jsHTML=[];
var sHTML="";
if(component.criterion.encntr_id===0){jsHTML.push("<div>",rcm_insurance_info_i18n.RCM_INVALID_ENCOUNTER_MESSAGE,"</div>");
sHTML=jsHTML.join("");
MP_Util.Doc.FinalizeComponent(sHTML,component,"");
return;
}jsHTML.push("<div id='rcm-info-container'>");
var dateTime=new Date();
var insuranceCnt=0;
if(recordData){insuranceCnt=recordData.HEALTHPLANRELATIONSHIPS.length;
}var insurancerowcnt=0;
var numberOfAuthFields=10;
if(insuranceCnt===0){jsHTML.push("<div>",rcm_insurance_info_i18n.RCM_NO_RESULT_FOUND,"</div>");
}for(var i=0;
i<insuranceCnt;
i++){insurancerowcnt=1+insurancerowcnt+(numberOfAuthFields*recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS.length);
}jsHTML.push("<div class='",MP_Util.GetContentClass(component,insurancerowcnt),"'>");
jsHTML.push('<div class="sub-sec-content">');
var hasPrimaryInsurance=false;
for(var i=0;
i<insuranceCnt;
i++){var priority=recordData.HEALTHPLANRELATIONSHIPS[i].PRIORITY;
if(priority<=3){var healthPlanBegEffDate=RCM_Clinical_Util.formatJsonDateString(recordData.HEALTHPLANRELATIONSHIPS[i].BEGINEFFECTIVEDATETIME);
var healthPlanEndEffDate=RCM_Clinical_Util.formatJsonDateString(recordData.HEALTHPLANRELATIONSHIPS[i].ENDEFFECTIVEDATETIME);
var sWithinHover='<h4><span class="ins-det-hd">'+rcm_insurance_info_i18n.RCM_INSURANCE_DETAILS+'</span></h4><div class="ins-hvr"><dl class="ins-det"><dt><span>'+rcm_insurance_info_i18n.RCM_SUBSCRIBER_ID+' : </span></dt><dd class="result"><span>'+recordData.HEALTHPLANRELATIONSHIPS[i].SUBSCRIBERID+"</span></dd><dt><span>"+rcm_insurance_info_i18n.RCM_MEMBER_ID+' : </span></dt><dd class="result"><span>'+recordData.HEALTHPLANRELATIONSHIPS[i].MEMBERID+"</span></dd><dt><span>"+rcm_insurance_info_i18n.RCM_GROUP_ID+' : </span></dt><dd class="result"><span>'+recordData.HEALTHPLANRELATIONSHIPS[i].GROUPID+"</span></dd><dt><span>"+rcm_insurance_info_i18n.RCM_ADDRESS+': </span></dt><dd class="result"><span>'+recordData.HEALTHPLANRELATIONSHIPS[i].FORMATTEDADDRESS+"</span></dd><dt><span>"+rcm_insurance_info_i18n.RCM_PHONE+': </span></dt><dd class="result"><span>'+recordData.HEALTHPLANRELATIONSHIPS[i].FORMATTEDPHONE+"</span></dd><dt><span>"+rcm_insurance_info_i18n.RCM_EFFECTIVE_DATE+': </span></dt><dd class="result"><span>'+(healthPlanBegEffDate?healthPlanBegEffDate:rcm_insurance_info_i18n.RCM_NA)+" - "+(healthPlanEndEffDate?healthPlanEndEffDate:rcm_insurance_info_i18n.RCM_NA)+" </span></dd></dl></div>";
}else{continue;
}if(priority===1){hasPrimaryInsurance=true;
jsHTML.push('<div class="sub-sec">');
jsHTML.push('<h3 class="sub-sec-hd">');
jsHTML.push('<span class="sub-sec-hd-tgl" id = "priheadtgl" title="',rcm_insurance_info_i18n.RCM_HIDE_SECTION,'">-</span>');
jsHTML.push('<span class="sub-sec-title">',rcm_insurance_info_i18n.RCM_PRIMARY,": ");
jsHTML.push(recordData.HEALTHPLANRELATIONSHIPS[i].HEALTHPLANNAME,"</span></h3>",sWithinHover);
}else{if(hasPrimaryInsurance===false){hasPrimaryInsurance=true;
jsHTML.push('<div class="sub-sec">');
jsHTML.push('<h3 class="sub-sec-hd">');
jsHTML.push('<span class="sub-sec-hd-tgl" id = "priheadtgl" title="',rcm_insurance_info_i18n.RCM_HIDE_SECTION,'">-</span>');
jsHTML.push('<span class="sub-sec-title">',rcm_insurance_info_i18n.RCM_PRIMARY,": ");
jsHTML.push(rcm_insurance_info_i18n.RCM_NO_PRIMARY_INSURANCE,"</span></h3>");
}}if(priority===2){jsHTML.push('<div class="sub-sec">');
jsHTML.push('<h3 class="sub-sec-hd">');
jsHTML.push('<span class="sub-sec-hd-tgl" id ="secheadtgl" title="',rcm_insurance_info_i18n.RCM_HIDE_SECTION,'">-</span>');
jsHTML.push('<span class="sub-sec-title">',rcm_insurance_info_i18n.RCM_SECONDARY,": ");
jsHTML.push(recordData.HEALTHPLANRELATIONSHIPS[i].HEALTHPLANNAME,"</span></h3>",sWithinHover);
}if(priority===3){jsHTML.push('<div class="sub-sec">');
jsHTML.push('<h3 class="sub-sec-hd">');
jsHTML.push('<span class="sub-sec-hd-tgl" id ="terheadtgl" title="',rcm_insurance_info_i18n.RCM_HIDE_SECTION,'">-</span>');
jsHTML.push('<span class="sub-sec-title">',rcm_insurance_info_i18n.RCM_TERTIARY,": ");
jsHTML.push(recordData.HEALTHPLANRELATIONSHIPS[i].HEALTHPLANNAME,"</span></h3>",sWithinHover);
}sWithinHover="";
var jsAuthHTML=[];
var allowToEdit=false;
if(recordData.CANMODIFYIND===1){allowToEdit=true;
}var statusEdit;
var AuthNumEdit;
var AuthDatesEdit;
var AuthFaxEdit;
var AuthCommentsEdit;
for(var j=0;
j<recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS.length;
j++){var dateString=[];
var begAuthDateTime=RCM_Clinical_Util.formatJsonDateString(recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS[j].SERVICEBEGINDATETIME);
var endAuthDateTime=RCM_Clinical_Util.formatJsonDateString(recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS[j].SERVICEENDDATETIME);
if(begAuthDateTime||endAuthDateTime){dateString.push(begAuthDateTime?begAuthDateTime:rcm_insurance_info_i18n.RCM_NA," - ",endAuthDateTime?endAuthDateTime:rcm_insurance_info_i18n.RCM_NA);
}if(allowToEdit===true){statusEdit=CERN_InsuranceInfo.checkForNumValue(recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS[j].AUTHORIZATIONSTATUSDISP,recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS[j].ID,"authStatus");
authNumEdit=CERN_InsuranceInfo.checkForNumValue(recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS[j].AUTHORIZATIONNUMBER,recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS[j].ID,"authNum");
authDatesEdit=CERN_InsuranceInfo.checkForNumValue(dateString.join(""),recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS[j].ID,"authDates");
authFaxEdit=CERN_InsuranceInfo.checkForNumValue(recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS[j].CONTACTFAXNUMBER,recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS[j].ID,"authFax");
}else{statusEdit='<td class="ins-value">'+recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS[j].AUTHORIZATIONSTATUSDISP;
authNumEdit='<td class="ins-value">'+recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS[j].AUTHORIZATIONNUMBER;
authDatesEdit='<td class="ins-value">'+dateString.join("");
authFaxEdit='<td class="ins-value">'+recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS[j].CONTACTFAXNUMBER;
authCommentsEdit='<td class="ins-value">'+RCM_Clinical_Util.decodeString(recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS[j].COMMENTTEXT);
}jsAuthHTML.push('<div class="sub-sec">');
jsAuthHTML.push('<h3 class="sub-sec-hd" id="authorizations"><span class="sub-sec-hd-tgl" title="',rcm_insurance_info_i18n.RCM_HIDE_SECTION,'">-');
jsAuthHTML.push('</span><span class="sub-sec-title">',rcm_insurance_info_i18n.RCM_AUTHORIZATION,"</span></h3>");
jsAuthHTML.push('<div class="sub-sec-content">');
jsAuthHTML.push('<table class="ins-table">');
jsAuthHTML.push('<tr><th class="ins-label">',rcm_insurance_info_i18n.RCM_STATUS,":</th>"+statusEdit+"</td></tr>");
jsAuthHTML.push('<tr><th class="ins-label">',rcm_insurance_info_i18n.RCM_DELAY_REASON,':</th><td class="ins-value">',recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS[j].DELAYREASONDISP,"</td></tr>");
if(recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS[j].DELAYREASONCOMMENTTEXT){jsAuthHTML.push('<tr><th class="ins-label">',rcm_insurance_info_i18n.RCM_DELAY_REASON_COMMENT,':</th><td class="ins-value">',recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS[j].DELAYREASONCOMMENTTEXT,"</td></tr>");
}jsAuthHTML.push('<tr><th class="ins-label">',rcm_insurance_info_i18n.RCM_AUTH_NUMBER,":</th>"+authNumEdit+"</td></tr>");
if(recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS[j].REFERENCENUMBER){jsAuthHTML.push('<tr><th class="ins-label">',rcm_insurance_info_i18n.RCM_REF_NUMBER,':</th><td class="ins-value" >',recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS[j].REFERENCENUMBER,"</td></tr>");
}jsAuthHTML.push('<tr><th class="ins-label">',rcm_insurance_info_i18n.RCM_AUTH_DATES,":</th>"+authDatesEdit+"</td></tr>");
jsAuthHTML.push('<tr><th class="ins-label" >',rcm_insurance_info_i18n.RCM_NUMBER_OF_DAYS,':</th><td class="ins-value" id = "',recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS[j].ID,'">',recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS[j].NUMBERAUTHORIZED," ",recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS[j].NUMBERAUTHORIZEDQUALIFIERDISP,"</td></tr>");
jsAuthHTML.push('<tr><th class="ins-label">',rcm_insurance_info_i18n.RCM_AUTH_FAX,":</th>"+authFaxEdit+"</td></tr>");
jsAuthHTML.push('<tr><th class="ins-label">',rcm_insurance_info_i18n.RCM_AUTH_PHONE,':</th><td class="ins-value">',recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS[j].CONTACTPHONENUMBER,"</td></tr>");
jsAuthHTML.push('<tr><th class="ins-label">',rcm_insurance_info_i18n.RCM_AUTH_COMMENTS,':</th><td class="ins-value">'+RCM_Clinical_Util.decodeString(recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS[j].COMMENTTEXT)+"</td></tr>");
jsAuthHTML.push("</table>");
jsAuthHTML.push("</div>");
jsAuthHTML.push("</div>");
}jsHTML.push('<div class="sub-sec-content">',jsAuthHTML.join(""),"</div></div>");
}jsHTML.push("</div>");
jsHTML.push("</div>");
jsHTML.push("<div id='ins-modify-dialog' class='ins-modify-dialog'>");
jsHTML.push("</div>");
jsHTML.push("<div id='errorDialog' class='ins-error-dialog'>");
jsHTML.push("<div class='error-title-bar'>");
jsHTML.push("<label id= 'error-title'></label>","</div>");
jsHTML.push("<div class='error-dialog-message-area'>");
jsHTML.push("<label id='errorMessage'></label></div>");
jsHTML.push("<input id='error-buttons' class='error-buttons' type='button' onclick = 'CERN_InsuranceInfo.cancelErrorDialog()' value='",rcm_insurance_info_i18n.RCM_OK,"' />");
jsHTML.push("</div></div>");
jsHTML.push("</div>");
sHTML=jsHTML.join("");
MP_Util.Doc.FinalizeComponent(sHTML,component,"");
var node=component.getSectionContentNode();
this.initInsuranceLocHovers(node);
var toggleArray=this.getToggleArray(node,"sub-sec-hd-tgl");
for(var k=0;
k<toggleArray.length;
k++){if(toggleArray[k].id==="terheadtgl"||toggleArray[k].id==="secheadtgl"){toggleArray[k].click(MP_Util.Doc.ExpandCollapse);
var checkClosed=Util.gp(Util.gp(toggleArray[k]));
if(!Util.Style.ccss(checkClosed,"closed")){toggleArray[k].innerHTML="+";
toggleArray[k].title=rcm_insurance_info_i18n.RCM_SHOW_SECTION;
}}}return;
}};
}();
function InsuranceInfoComponentStyle(){this.initByNamespace("ins");
}InsuranceInfoComponentStyle.inherits(ComponentStyle);
function InsuranceComponent(criterion){this.setCriterion(criterion);
this.setStyles(new InsuranceInfoComponentStyle());
this.setScope(2);
InsuranceComponent.method("InsertData",function(){CERN_InsuranceInfo.GetInsuranceTable(this);
});
InsuranceComponent.method("HandleSuccess",function(recordData){CERN_InsuranceInfo.GetInsuranceInfoTable(this,recordData);
});
}InsuranceComponent.inherits(MPageComponent);
function InsuranceDelegate(){this.getData=function(sendAr,component){var handler=function(RECORDDATA,successStatus,errorMessage){if("S"===successStatus){component.HandleSuccess(RECORDDATA);
}else{component.HandleSuccess(RECORDDATA);
}};
RCM_Clinical_Util.makeTimerCCLRequest(component,"RCM_MPC_INSURANCE_INFO",sendAr,true,function(status,RECORDDATA,errorInfo){if("S"===status){handler(RECORDDATA,status);
}else{if("F"===status){var alertMessage=[];
if(errorInfo&&errorInfo.length>0){alertMessage.push(errorInfo);
}if(RECORDDATA&&RECORDDATA.EXCEPTIONINFORMATION){alertMessage.push(RECORDDATA.EXCEPTIONINFORMATION[0].EXCEPTIONTYPE);
}if(RECORDDATA&&RECORDDATA.STATUS_DATA&&RECORDDATA.STATUS_DATA.SUBEVENTSTATUS){alertMessage.push(RECORDDATA.STATUS_DATA.SUBEVENTSTATUS[0].TARGETOBJECTVALUE);
}handler(RECORDDATA,status,alertMessage.join());
}}});
};
this.setData=function(sendAr,component){var handler=function(RECORDDATA,successStatus,errorMessage){CERN_InsuranceInfo.closeDialog();
if("S"===successStatus){CERN_InsuranceInfo.GetInsuranceTable(CERN_InsuranceInfo.component);
}else{CERN_InsuranceInfo.popSaveErrorMessage();
document.getElementById("error-buttons").focus();
}};
RCM_Clinical_Util.makeTimerCCLRequest(component,"rcm_modify_utilization_mgmt",sendAr,true,function(status,RECORDDATA,errorInfo){if("S"===status){handler(RECORDDATA,status);
}else{if("F"===status){var alertMessage=[];
if(errorInfo&&errorInfo.length>0){alertMessage.push(errorInfo);
}if(RECORDDATA&&JSON.stringify(RECORDDATA.EXCEPTIONINFORMATION.EXCEPTIONTYPE==="STALE_DATA")){CERN_InsuranceInfo.popStaleDataErrorDialog();
document.getElementById("error-buttons").focus();
}else{if(RECORDDATA&&RECORDDATA.STATUS_DATA&&RECORDDATA.STATUS_DATA.SUBEVENTSTATUS){alertMessage.push(RECORDDATA.STATUS_DATA.SUBEVENTSTATUS[0].TARGETOBJECTVALUE);
}else{handler(RECORDDATA,status,alertMessage.join());
}}}}});
};
}var CERN_VisitInfo=function(){return{GetVisitTable:function(component){var sendAr=[];
var criterion=component.getCriterion();
sendAr.push("^MINE^",criterion.person_id+".0",+criterion.encntr_id+".0",0);
RCM_Clinical_Util.makeTimerCCLRequest(component,"RCM_MPC_VISIT_INFO_SUM",sendAr,true,function(status,RECORDDATA,errorInfo){if("S"===status){component.HandleSuccess(RECORDDATA);
}else{component.HandleSuccess(null);
}});
},getVisToggleArray:function(par,tog){return Util.Style.g(tog,par,"span");
},initVisitLocHovers:function(node){var tr=Util.Style.g("vis-pe-row",node,"DIV");
for(var i=0,l=tr.length;
i<l;
i++){var m=tr[i];
if(m){var nm=Util.gns(m);
if(nm){if(Util.Style.ccss(nm,"hvr")){hs(m,nm);
}}}}},RenderComponent:function(component,recordData){var jsHTML=[];
var sHTML="";
if(component.criterion.encntr_id===0){jsHTML.push("<div>",rcm_visit_info_i18n.RCM_INVALID_ENCOUNTER_MESSAGE,"</div>");
sHTML=jsHTML.join("");
MP_Util.Doc.FinalizeComponent(sHTML,component,"");
return;
}var dateTime=new Date();
var visitRecData=recordData.VISIT_INFO;
var regDateTime=visitRecData.REGDTTM;
if(regDateTime&&regDateTime!==""){dateTime.setISO8601(regDateTime);
regDateTime=dateTime.format("longDateTime3");
}else{regDateTime="";
}var admitToBedDateTime=visitRecData.ADMITTOBEDDTTM;
if(admitToBedDateTime&&admitToBedDateTime!==""){dateTime.setISO8601(admitToBedDateTime);
admitToBedDateTime=dateTime.format("longDateTime3");
}else{admitToBedDateTime="";
}var dischargeDtTm=visitRecData.DISCHARGEDTTM;
if(dischargeDtTm&&dischargeDtTm!==""){dateTime.setISO8601(dischargeDtTm);
dischargeDtTm=dateTime.format("shortDate2");
}else{dischargeDtTm="";
}var oDisClass="";
if(visitRecData.DISCHARGEDTTM.length===0&&visitRecData.DISCHARGEDISP.length===0&&visitRecData.DISCHARGELOC.length===0){oDisClass="onLoadCollapse";
}rowCount=18+visitRecData.ENCNTRS_PAST_MONTH_CNT+visitRecData.KEY_PERSON_RELATIONSHIPS_CNT;
jsHTML.push('<div class="sub-sec">');
jsHTML.push("<div class='",MP_Util.GetContentClass(component,rowCount),"'>");
jsHTML.push('<div class="sub-sec-content">');
jsHTML.push("<div class='",MP_Util.GetContentClass(component,3),"'>");
jsHTML.push('<table class="vis-table">');
jsHTML.push('<tr><th class="vis-label">',rcm_visit_info_i18n.FIN_NUM,':</th><td class="vis-value">');
jsHTML.push(visitRecData.FIN+"</td></tr>");
jsHTML.push('<tr><th class="vis-label">',rcm_visit_info_i18n.ENCNTR_TYPE,':</th><td class="vis-value">'+visitRecData.ENCNTRTYPE+"</td></tr>");
jsHTML.push('<tr><th class="vis-label">',rcm_visit_info_i18n.FIN_CLASS,':</th><td class="vis-value">'+visitRecData.FINANCIALCLASS+"</td></tr>");
jsHTML.push("</table>");
jsHTML.push("</div>");
jsHTML.push('<div class="sub-sec">');
jsHTML.push('<h3 class=sub-sec-hd id="admitHead"><span>',rcm_visit_info_i18n.ADMIT_INFO,"</span></h3>");
jsHTML.push('<div class="sub-sec-content">');
jsHTML.push('<table class="vis-table">');
jsHTML.push('<tr><th class="vis-label">',rcm_visit_info_i18n.REG_DT_TM,':</th><td class="vis-value">',regDateTime,"</td></tr>");
jsHTML.push('<tr><th class="vis-label">',rcm_visit_info_i18n.INPATIENT_ADMIT,':</th><td class="vis-value">',admitToBedDateTime,"</td></tr>");
var attendDocName="";
if(visitRecData.PHYSLAST||visitRecData.PHYSFIRST){attendDocName=visitRecData.PHYSLAST+", "+visitRecData.PHYSFIRST;
}jsHTML.push('<tr><th class="vis-label">',rcm_visit_info_i18n.ATTENDING_PHD,':</th><td class="vis-value">',attendDocName,"</td></tr>");
jsHTML.push('<tr><th class="vis-label">',rcm_visit_info_i18n.REASON_FOR_VISIT,':</th><td class="vis-value">',visitRecData.VISITREAS,"</td></tr>");
jsHTML.push('<tr><th class="vis-label">',rcm_visit_info_i18n.ADMIT_DX,':</th><td class="vis-value">',visitRecData.ADMITDX,"</td></tr>");
jsHTML.push('<tr><th class="vis-label">',rcm_visit_info_i18n.ADMIT_SOURCE,':</th><td class="vis-value">',visitRecData.ADMITSOURCE,"</td></tr>");
jsHTML.push('<tr><th class="vis-label">',rcm_visit_info_i18n.ADMIT_TYPE,':</th><td class="vis-value">',visitRecData.ADMITTYPE,"</td></tr>");
jsHTML.push('<tr><th class="vis-label">',rcm_visit_info_i18n.LOCATION,':</th><td class="vis-value">',visitRecData.NURSEUNIT,"; ",visitRecData.ROOM,"; ",visitRecData.BED,"</td></tr>");
jsHTML.push('<tr><th class="vis-label">',rcm_visit_info_i18n.LOS,':</th><td class="vis-value">',visitRecData.LOS,"</td></tr>");
jsHTML.push("</table>");
jsHTML.push("</div>");
jsHTML.push("</div>");
jsHTML.push('<div class="sub-sec">');
jsHTML.push('<h3 class="sub-sec-hd" id="dischargeHead"><span class="sub-sec-hd-tgl" id = "dischargeheadtgl" title="',rcm_visit_info_i18n.SHOW_SECTION,'">-');
jsHTML.push('</span><span class="sub-sec-title">',rcm_visit_info_i18n.DISCHARGE_INFORMATION,"</span></h3>");
jsHTML.push('<div class="sub-sec-content">');
jsHTML.push('<table class="vis-table">');
var dischargeHide=false;
if((!dischargeDtTm||dischargeDtTm==="")&&(!visitRecData.DISCHARGEDISP||visitRecData.DISCHARGEDISP==="")&&(!visitRecData.DISCHARGELOC||visitRecData.DISCHARGELOC==="")){dischargeHide=true;
}jsHTML.push('<tr><th class="vis-label">',rcm_visit_info_i18n.DISCHARGE_DATE,':</th><td class="vis-value">',dischargeDtTm,"</td></tr>");
jsHTML.push('<tr><th class="vis-label">',rcm_visit_info_i18n.DISCHARGE_DISPOSITION,':</th><td class="vis-value">',visitRecData.DISCHARGEDISP,"</td></tr>");
if(visitRecData.FINAL_POST_ACUTE_ORG_NAME&&visitRecData.FINAL_POST_ACUTE_ORG_NAME!==""){jsHTML.push('<tr><th class="vis-label">',rcm_visit_info_i18n.POST_ACUTE_FACILITY,':</th><td class="vis-value">',visitRecData.FINAL_POST_ACUTE_ORG_NAME,"</td></tr>");
}else{if(visitRecData.DISCHARGELOC&&visitRecData.DISCHARGELOC!==""){jsHTML.push('<tr><th class="vis-label">',rcm_visit_info_i18n.DESTINATION_FACILITY,':</th><td class="vis-value">',visitRecData.DISCHARGELOC,"</td></tr>");
}else{jsHTML.push('<tr><th class="vis-label">',rcm_visit_info_i18n.POST_ACUTE_FACILITY,':</th><td class="vis-value">',"","</td></tr>");
}}jsHTML.push("</table>");
jsHTML.push("</div>");
jsHTML.push("</div>");
if(visitRecData.ENCNTRS_PAST_MONTH_CNT>0){jsHTML.push('<div class="sub-sec">');
jsHTML.push('<h3 class="sub-sec-hd" id="recentEncntrsHead"><span class="sub-sec-hd-tgl" id="dischargeheadtgl" title="',rcm_visit_info_i18n.SHOW_SECTION,'">-');
jsHTML.push('</span><span class="sub-sec-title">Encounters (',visitRecData.ENCNTRS_PAST_MONTH_CNT,")</span></h3>");
jsHTML.push('<div class="sub-sec-content">');
jsHTML.push("<div>");
jsHTML.push('<div class="vis-pe-header-parent"><div class="vis-pe-header">',rcm_visit_info_i18n.DISCHARGE_DATE,'</div><div class="vis-pe-header">',rcm_visit_info_i18n.ENCNTR_TYPE,'</div><div class="vis-pe-header">Final DRG</div></div>');
for(var i=0;
i<visitRecData.ENCNTRS_PAST_MONTH_CNT;
i++){var prevDischargDtTm=visitRecData.ENCNTRS_PAST_MONTH[i].DISCHARGE_DT;
if(prevDischargDtTm&&prevDischargDtTm!==""){dateTime.setISO8601(prevDischargDtTm);
prevDischargDtTm=dateTime.format("shortDate2");
}else{prevDischargDtTm="";
}var prevAdmitDtTm=visitRecData.ENCNTRS_PAST_MONTH[i].ADMIT_DT;
if(prevAdmitDtTm&&prevAdmitDtTm!==""){dateTime.setISO8601(prevAdmitDtTm);
prevAdmitDtTm=dateTime.format("shortDate2");
}else{prevAdmitDtTm="";
}jsHTML.push('<div class="vis-pe-row">');
jsHTML.push('<div class="vis-pe-result">',prevDischargDtTm,"</div>");
jsHTML.push('<div class="vis-pe-result">',visitRecData.ENCNTRS_PAST_MONTH[i].SECURED_INDICATOR?"<span class='vis-secured'>"+rcm_visit_info_i18n.RCM_SECURED+"</span>":visitRecData.ENCNTRS_PAST_MONTH[i].ENCNTR_TYPE,"</div>");
jsHTML.push('<div class="vis-pe-result">',visitRecData.ENCNTRS_PAST_MONTH[i].SECURED_INDICATOR?"<span class='vis-secured'>"+rcm_visit_info_i18n.RCM_SECURED+"</span>":visitRecData.ENCNTRS_PAST_MONTH[i].FINAL_DRG,"</div>");
jsHTML.push("</div>");
jsHTML.push('<div class="hvr">');
jsHTML.push('<dl class="vis-det">');
jsHTML.push("<dt><span>",rcm_visit_info_i18n.ADMIT_DATE,' :</span></dt><dd class="result"><span>',prevAdmitDtTm,"</span></dd>");
jsHTML.push("<dt><span>",rcm_visit_info_i18n.ATTENDING_PHD,': </span></dt><dd class="result"><span>',visitRecData.ENCNTRS_PAST_MONTH[i].SECURED_INDICATOR?"<span class='vis-secured'>"+rcm_visit_info_i18n.RCM_SECURED+"</span>":visitRecData.ENCNTRS_PAST_MONTH[i].ATTENDING,"</span></dd>");
jsHTML.push("<dt><span>",rcm_visit_info_i18n.DISCHARGE_DISPOSITION,': </span></dt><dd class="result"><span>',visitRecData.ENCNTRS_PAST_MONTH[i].SECURED_INDICATOR?"<span class='vis-secured'>"+rcm_visit_info_i18n.RCM_SECURED+"</span>":visitRecData.ENCNTRS_PAST_MONTH[i].DICHARGE_DISP,"</span></dd>");
if(visitRecData.ENCNTRS_PAST_MONTH[i].FINAL_POST_ACUTE_ORG_NAME&&visitRecData.ENCNTRS_PAST_MONTH[i].FINAL_POST_ACUTE_ORG_NAME!==""){jsHTML.push("<dt><span>",rcm_visit_info_i18n.POST_ACUTE_FACILITY,':</span></dt><dd class="result"><span>',visitRecData.ENCNTRS_PAST_MONTH[i].SECURED_INDICATOR?"<span class='vis-secured'>"+rcm_visit_info_i18n.RCM_SECURED+"</span>":visitRecData.ENCNTRS_PAST_MONTH[i].FINAL_POST_ACUTE_ORG_NAME,"</span></dd>");
}else{if(visitRecData.ENCNTRS_PAST_MONTH[i].DISCHARGELOC&&visitRecData.ENCNTRS_PAST_MONTH[i].DISCHARGELOC!==""){jsHTML.push("<dt><span>",rcm_visit_info_i18n.DESTINATION_FACILITY,': </span></dt><dd class="result"><span>',visitRecData.ENCNTRS_PAST_MONTH[i].SECURED_INDICATOR?"<span class='vis-secured'>"+rcm_visit_info_i18n.RCM_SECURED+"</span>":visitRecData.ENCNTRS_PAST_MONTH[i].DISCHARGELOC,"</span></dd>");
}else{jsHTML.push("<dt><span>",rcm_visit_info_i18n.POST_ACUTE_FACILITY,':</span></dt><dd class="result"><span>',visitRecData.ENCNTRS_PAST_MONTH[i].SECURED_INDICATOR?"<span class='vis-secured'>"+rcm_visit_info_i18n.RCM_SECURED+"</span>":"","</span></dd>");
}}jsHTML.push("<dt><span>",rcm_visit_info_i18n.FINAL_DIAGNOSIS,': </span></dt><dd class="result"><span>',visitRecData.ENCNTRS_PAST_MONTH[i].SECURED_INDICATOR?"<span class='vis-secured'>"+rcm_visit_info_i18n.RCM_SECURED+"</span>":visitRecData.ENCNTRS_PAST_MONTH[i].FINAL_DX,"</span></dd>");
jsHTML.push("</dl>");
jsHTML.push("</div>");
}jsHTML.push("</div>");
jsHTML.push("</div>");
jsHTML.push("</div>");
}jsHTML.push('<div class="sub-sec">');
jsHTML.push('<h3 class="sub-sec-hd" id="keypersonshead"><span class="sub-sec-hd-tgl" id = "keypersonstgl" title="',rcm_visit_info_i18n.SHOW_SECTION,'">-');
jsHTML.push('</span><span class="sub-sec-title">',rcm_visit_info_i18n.KEY_PERSON_RELATIONSHIPS,"</span></h3>");
jsHTML.push('<div class="sub-sec-content">');
jsHTML.push('<table class="vis-table">');
if(visitRecData.KEY_PERSON_RELATIONSHIPS_CNT===0){jsHTML.push('<tr><th class="vis-message">',rcm_visit_info_i18n.NO_KEY_PERSONS,"</th></tr>");
}else{for(var j=0;
j<visitRecData.KEY_PERSON_RELATIONSHIPS_CNT;
j++){jsHTML.push('<tr><th class="vis-label">',visitRecData.KEY_PERSON_RELATIONSHIPS[j].RELATIONSHIP_TYPE,':</th><td class="vis-value">',visitRecData.KEY_PERSON_RELATIONSHIPS[j].RELATED_PERSON_NAME_FULL,"</td></tr>");
}jsHTML.push("</table>");
jsHTML.push("</div>");
jsHTML.push("</div>");
jsHTML.push("</div>");
}jsHTML.push("</div>");
jsHTML.push("</div>");
sHTML=jsHTML.join("");
MP_Util.Doc.FinalizeComponent(sHTML,component,"");
var node=component.getSectionContentNode();
MP_Util.Doc.InitScrolling(Util.Style.g("scrollable",node,"div"),component.getScrollNumber(),"1.6");
this.initVisitLocHovers(node);
var toggleArray=this.getVisToggleArray(node,"sub-sec-hd-tgl");
for(var k=0;
k<toggleArray.length;
k++){if(((toggleArray[k].id=="dischargeheadtgl"&&dischargeHide)||toggleArray[k].id=="dischargeheadtgl")||((toggleArray[k].id=="keypersonstgl"&&dischargeHide)||toggleArray[k].id=="keypersonstgl")){toggleArray[k].click(MP_Util.Doc.ExpandCollapse);
var checkClosed=Util.gp(Util.gp(toggleArray[k]));
if(!Util.Style.ccss(checkClosed,"closed")){toggleArray[k].innerHTML="+";
toggleArray[k].title=rcm_visit_info_i18n.SHOW_SECTION;
}}}return;
}};
}();
function VisitInfoComponentStyle(){this.initByNamespace("vis");
}VisitInfoComponentStyle.inherits(ComponentStyle);
function VisitInfoComponent(criterion){this.setCriterion(criterion);
this.setStyles(new VisitInfoComponentStyle());
this.setScope(2);
VisitInfoComponent.method("InsertData",function(){CERN_VisitInfo.GetVisitTable(this);
});
VisitInfoComponent.method("HandleSuccess",function(recordData){CERN_VisitInfo.RenderComponent(this,recordData);
});
}VisitInfoComponent.inherits(MPageComponent);
function ObservationComponentStyle(){this.initByNamespace("obs_comp");
}ObservationComponentStyle.inherits(ComponentStyle);
ObservationComponent.inherits(MPageComponent);
function ObservationComponent(criterion){var component=this;
this.setCriterion(criterion);
this.setStyles(new ObservationComponentStyle());
this.setAlwaysExpanded(true);
ObservationComponent.method("InsertData",function(component){RegObservationView.getInfo(component);
});
ObservationComponent.method("HandleSuccess",function(recordData){RegObservationView.renderView(recordData,this);
});
}var RegObservationView=function(){return{renderView:function(recordData,component){var imageLoc=component.getCriterion().static_content+"\\images\\5323_16.png";
var plusLoc=component.getCriterion().static_content+"\\images\\3941_16.png";
var dropDownImg=component.getCriterion().static_content+"\\images\\6361_16.gif";
var jsHTML=[];
if(recordData.EVENT_DATE.length===0){jsHTML.push("<div class='noEventRow'>");
jsHTML.push("<div class='noObsHead'>",reg_Observation_i18n.reg_obsrv_NO_OBSERVATION_EVENTS,"</div>");
jsHTML.push("</div>");
}else{jsHTML.push("<div id='movingDiv' class='movingDiv'>");
jsHTML.push("<div class='vert_align'><input type='checkbox' id='filtercheckbox' name='filtercheckbox' class='filterCheckBox' onclick='RegObservationView.onCheckBoxChange()' value='' /><label class=filterCheckText>"+reg_Observation_i18n.reg_obsrv_SHOW_INACTIVE+"</label>");
jsHTML.push("</div>");
jsHTML.push("<div class='float_left'><button id='exclusion_btn' onblur='RegObservationView.show_addDropDown(this)' onclick='RegObservationView.show_addDropDown(this)'><img src='"+plusLoc+"'/><img src='"+imageLoc+"'/></button><br />");
jsHTML.push("<div class='add_dropDown' id='add_dropDown' onmouseout='RegObservationView.hideDropDown(this)' onblur='RegObservationView.hideDropDown(this)'>");
jsHTML.push("<div onMouseOver ='RegObservationView.dropDownMouseOver(this, \"add_dropDown\")' onMouseOut ='RegObservationView.dropDownMouseOut(this, \"add_dropDown\")' onclick='RegObservationView.exclusionDialog()'><label class='dropDownLabel1'>",reg_Observation_i18n.reg_obsrv_ADD_EXC_TIME,"</label></div>");
jsHTML.push("<div onMouseOver ='RegObservationView.dropDownMouseOver(this, \"add_dropDown\")' onMouseOut ='RegObservationView.dropDownMouseOut(this, \"add_dropDown\")' onclick='RegObservationView.displayAction()'><label class='dropDownLabel1'>",reg_Observation_i18n.reg_obsrv_ADD_ORDER,"</label></div>");
jsHTML.push("</div>");
jsHTML.push("</div>");
jsHTML.push("<table id='newTab'>");
jsHTML.push("<tr class='top-row'>");
jsHTML.push("<th class='totals_hd'>",reg_Observation_i18n.reg_obsrv_TOTALS,"</th>");
jsHTML.push("<th class='first_row_hd'>",reg_Observation_i18n.reg_obsrv_OBSERVATION,"</th>");
jsHTML.push("<th class='exclusion_hd'>",reg_Observation_i18n.reg_obsrv_EXCLUSION,"</th>");
jsHTML.push("<th class='first_row_hd'>",reg_Observation_i18n.reg_obsrv_EXPECTED,"</th>");
jsHTML.push("<th class='first_row_hd'>",reg_Observation_i18n.reg_obsrv_CHARGED,"</th>");
jsHTML.push("<th class='first_row_hd'>",reg_Observation_i18n.reg_obsrv_ROOMBED,"</th>");
jsHTML.push("</tr>");
jsHTML.push("<tr class=''>");
jsHTML.push("<td class='total_td' colspan='2'><div class='border-ln'></div><div class='heightSet'><label class='obs_total_digits'>",RegObservationView.toHours(recordData.OBSERVATION_MINUTES),"</label><label class='obs_total_text'>",reg_Observation_i18n.reg_obsrv_HRS,"</label><label class='obs_total_digits'>",RegObservationView.toMins(recordData.OBSERVATION_MINUTES),"</label><label class='obs_total_text'>",reg_Observation_i18n.reg_obsrv_MIN,"</label></div></td>");
jsHTML.push("<td class='total_td'><div class='border-ln'></div><div class='heightSetB'><label class='total_digits'>",RegObservationView.toHours(recordData.EXCLUSION_MINUTES),"</label><label class='total_text'>",reg_Observation_i18n.reg_obsrv_HRS,"</label><label class='total_digits'>",RegObservationView.toMins(recordData.EXCLUSION_MINUTES),"</label><label class='total_text'>",reg_Observation_i18n.reg_obsrv_MIN,"</label></div></td>");
jsHTML.push("<td class='total_td'><div class='border-ln'></div><div class='heightSetB'><label class='total_digits'>",recordData.OBSERVATION_HOURS_EXPECTED,"</label><label class='total_text'>",reg_Observation_i18n.reg_obsrv_HRS,"</label></div></td>");
jsHTML.push("<td class='total_td'><div class='border-ln'></div><div class='heightSetB'><label class='total_digits'>",recordData.OBSERVATION_HOURS_POSTED,"</label><label class='total_text'>",reg_Observation_i18n.reg_obsrv_HRS,"</label></div></td>");
jsHTML.push("<td class='total_td'><div class='heightSetB'><label class='total_digits'>",recordData.INPATIENT_DAYS,"</label><label class='total_text'>",reg_Observation_i18n.reg_obsrv_DAYS,"</label></div></td>");
jsHTML.push("</tr>");
jsHTML.push("</table>");
jsHTML.push("</div>");
jsHTML.push("<div class='clearBoth'>");
jsHTML.push("<div class='vert_align'><input type='checkbox' id='filtercheckbox' name='filtercheckbox' class='filterCheckBox' onclick='RegObservationView.onCheckBoxChange()' value='' /><label class=filterCheckText>"+reg_Observation_i18n.reg_obsrv_SHOW_INACTIVE+"</label>");
jsHTML.push("</div>");
jsHTML.push("<div class='float_left'><button id='exclusion_btn' onclick='RegObservationView.show_addDropDown()'><img src='"+plusLoc+"'/><img src='"+imageLoc+"'/></button><br />");
jsHTML.push("<div class='add_dropDown' id='add_dropDown' onmouseout='RegObservationView.hideDropDown(this)' onblur='RegObservationView.hideDropDown(this)'>");
jsHTML.push("<div onMouseOver ='RegObservationView.dropDownMouseOver(this, \"add_dropDown\")' onMouseOut ='RegObservationView.dropDownMouseOut(this, \"add_dropDown\")' onclick='RegObservationView.exclusionDialog()'><label class='dropDownLabel'>",reg_Observation_i18n.reg_obsrv_ADD_EXC_TIME,"</label></div>");
jsHTML.push("<div onMouseOver ='RegObservationView.dropDownMouseOver(this, \"add_dropDown\")' onMouseOut ='RegObservationView.dropDownMouseOut(this, \"add_dropDown\")' onclick='RegObservationView.displayAction()'><label class='dropDownLabel'>",reg_Observation_i18n.reg_obsrv_ADD_ORDER,"</label></div>");
jsHTML.push("</div>");
jsHTML.push("</div>");
jsHTML.push("</div>");
jsHTML.push("<table id='theTable' class='newPad'>");
jsHTML.push("<tr class='top-row'>");
jsHTML.push("<th class='totals_hd'>",reg_Observation_i18n.reg_obsrv_TOTALS,"</th>");
jsHTML.push("<th class='first_row_hd'>",reg_Observation_i18n.reg_obsrv_OBSERVATION,"</th>");
jsHTML.push("<th class='exclusion_hd'>",reg_Observation_i18n.reg_obsrv_EXCLUSION,"</th>");
jsHTML.push("<th class='first_row_hd'>",reg_Observation_i18n.reg_obsrv_EXPECTED,"</th>");
jsHTML.push("<th class='first_row_hd'>",reg_Observation_i18n.reg_obsrv_CHARGED,"</th>");
jsHTML.push("<th class='first_row_hd'>",reg_Observation_i18n.reg_obsrv_ROOMBED,"</th>");
jsHTML.push("</tr>");
jsHTML.push("<tr class=''>");
jsHTML.push("<td class='total_td' colspan='2'><div class='border-ln'></div><div class='heightSet'><label class='obs_total_digits'>",RegObservationView.toHours(recordData.OBSERVATION_MINUTES),"</label><label class='obs_total_text'>",reg_Observation_i18n.reg_obsrv_HRS,"</label><label class='obs_total_digits'>",RegObservationView.toMins(recordData.OBSERVATION_MINUTES),"</label><label class='obs_total_text'>",reg_Observation_i18n.reg_obsrv_MIN,"</label></div></td>");
jsHTML.push("<td class='total_td'><div class='border-ln'></div><div class='heightSetB'><label class='total_digits'>",RegObservationView.toHours(recordData.EXCLUSION_MINUTES),"</label><label class='total_text'>",reg_Observation_i18n.reg_obsrv_HRS,"</label><label class='total_digits'>",RegObservationView.toMins(recordData.EXCLUSION_MINUTES),"</label><label class='total_text'>",reg_Observation_i18n.reg_obsrv_MIN,"</label></div></td>");
jsHTML.push("<td class='total_td'><div class='border-ln'></div><div class='heightSetB'><label class='total_digits'>",recordData.OBSERVATION_HOURS_EXPECTED,"</label><label class='total_text'>",reg_Observation_i18n.reg_obsrv_HRS,"</label></div></td>");
jsHTML.push("<td class='total_td'><div class='border-ln'></div><div class='heightSetB'><label class='total_digits'>",recordData.OBSERVATION_HOURS_POSTED,"</label><label class='total_text'>",reg_Observation_i18n.reg_obsrv_HRS,"</label></div></td>");
jsHTML.push("<td class='total_td'><div class='heightSetB'><label class='total_digits'>",recordData.INPATIENT_DAYS,"</label><label class='total_text'>",reg_Observation_i18n.reg_obsrv_DAYS,"</label></div></td>");
jsHTML.push("</tr>");
jsHTML.push("<tr><td colspan='6'><div class='border_bottom'></div></td></tr>");
var eventDates=recordData.EVENT_DATE;
for(i=0;
i<eventDates.length;
i++){var theDate=new Date(RCM_Clinical_Util.formatJsonDateString(eventDates[i].PARENT_EVENT_DT_TM_FORMATTED));
if((eventDates[i].EVENT.length===1)&&(eventDates[i].EVENT[0].ACTIVE_IND===0)){jsHTML.push("<tr class='inactive'>");
}else{jsHTML.push("<tr>");
}jsHTML.push("<td class='date_td'>",theDate.format("mediumDate"),"</td>");
jsHTML.push("<td class='grey_td'><div class='border_right'></div><div class='heightSetC'><label class='duration_digit'>",RegObservationView.toHours(eventDates[i].OBSERVATION_MINUTES),"</label><label class='duration_text'>",reg_Observation_i18n.reg_obsrv_HRS,"</label><label class='duration_digit'>",RegObservationView.toMins(eventDates[i].OBSERVATION_MINUTES),"</label><label class='duration_text'>",reg_Observation_i18n.reg_obsrv_MIN,"</label></div></td>");
jsHTML.push("<td class='grey_td'><div class='border_left'></div><div class='border_right'></div><div class='heightSetD'><label class='duration_digit'>",RegObservationView.toHours(eventDates[i].EXCLUSION_MINUTES),"</label><label class='duration_text'>",reg_Observation_i18n.reg_obsrv_HRS,"</label><label class='duration_digit'>",RegObservationView.toMins(eventDates[i].EXCLUSION_MINUTES),"</label><label class='duration_text'>",reg_Observation_i18n.reg_obsrv_MIN,"</label></div></td>");
jsHTML.push("<td class='grey_td'><div class='border_left'></div><div class='border_right'></div><div class='heightSetD'><label class='duration_digit'>",eventDates[i].OBSERVATION_HOURS_EXPECTED,"</label><label class='duration_text'>",reg_Observation_i18n.reg_obsrv_HRS,"</label></div></td>");
jsHTML.push("<td class='grey_td'><div class='border_left'></div><div class='border_right'></div><div class='heightSetD'><label class='duration_digit'>",eventDates[i].OBSERVATION_HOURS_POSTED,"</label><label class='duration_text'>",reg_Observation_i18n.reg_obsrv_HRS,"</label></div></td>");
jsHTML.push("<td class='grey_td'><div class='heightSetD'><label class='duration_digit'>",eventDates[i].INPATIENT_DAYS,"</label><label class='duration_text'>",reg_Observation_i18n.reg_obsrv_DAYS,"</label></div></td>");
jsHTML.push("</tr>");
for(x=0;
x<eventDates[i].EVENT.length;
x++){var phys=eventDates[i].EVENT[x].ORDERING_PHYSICIAN_NAME;
var prsnl=eventDates[i].EVENT[x].ENTERED_BY_PERSONNEL_NAME;
var stat=eventDates[i].EVENT[x].ORDER_STATUS_DISPLAY;
var finclass=eventDates[i].EVENT[x].ENCNTR_FINANCIAL_CLASS_DISPLAY;
var NA=reg_Observation_i18n.reg_obsrv_NA;
if(eventDates[i].EVENT[x].EVENT_MEANING==="OBSERVATION"||eventDates[i].EVENT[x].EVENT_MEANING==="OUTPATIENT"||eventDates[i].EVENT[x].EVENT_MEANING==="INPATIENT"){if(eventDates[i].EVENT[x].ACTIVE_IND===0){if(x>0){jsHTML.push("<tr class='inactive'><td colspan='6'><div class='topBorder'></div></td></tr>");
}jsHTML.push("<tr class='inactive row_padding'>");
jsHTML.push("<td class='td_time inactive_row'><div class='row_padding'>",RegObservationView.formatTheDate(eventDates[i].EVENT[x].EVENT_START_DT_TM_FORMATTED),"</div></td>");
}else{if(x>0){jsHTML.push("<tr><td colspan='6'><div class='topBorder'></div></td></tr>");
}if(eventDates[i].EVENT[x].EVENT_TYPE_MEANING==="STARTINPAT"){jsHTML.push("<tr class='row_padding'>");
jsHTML.push("<td class='td_time inRow'><div class='row_padding'>",RegObservationView.formatTheDate(eventDates[i].EVENT[x].EVENT_START_DT_TM_FORMATTED),"</div></td>");
}else{if(eventDates[i].EVENT[x].EVENT_TYPE_MEANING==="OUTPATINBED"){jsHTML.push("<tr class='row_padding'>");
jsHTML.push("<td class='td_time outRow'><div class='row_padding'>",RegObservationView.formatTheDate(eventDates[i].EVENT[x].EVENT_START_DT_TM_FORMATTED),"</div></td>");
}else{jsHTML.push("<tr class='row_padding'>");
jsHTML.push("<td class='td_time obsRow'><div class='row_padding'>",RegObservationView.formatTheDate(eventDates[i].EVENT[x].EVENT_START_DT_TM_FORMATTED),"</div></td>");
}}}if(eventDates[i].EVENT[x].ORDER_ID){jsHTML.push("<td colspan='2'><div class='row_padding'><div class='text_left  detail_td'><label class='orderName' onclick = 'RegObservationView.displayAction()'>",eventDates[i].EVENT[x].DESCRIPTION,"</label><br /><label class='orderP'>",phys?phys:NA," | ",prsnl?prsnl:NA," | ",stat?stat:NA,finclass?" | "+finclass:"","</label></div></div></td>");
}else{jsHTML.push("<td colspan='2'><div class='row_padding'><div class='text_left  detail_td'><label class='' >",eventDates[i].EVENT[x].DESCRIPTION,"</label></div></div></td>");
}if(eventDates[i].EVENT[x].ORDER_STATUS_MEANING==="ORDERED"){jsHTML.push("<td colspan='3'><div class='row_padding'><div class='action_icon'><button id='actn_btn' class='action_btn' onblur='RegObservationView.hide_menu()' onclick='RegObservationView.actionEventsMenu(\""+eventDates[i].EVENT[x].ORDER_STATUS_MEANING+'", "'+eventDates[i].EVENT[x].ORDER_ID+"\",this)'><img src='"+dropDownImg+"'/></button><br />&nbsp</div><div class='trans-start'><label class='duration_digit'>",reg_Observation_i18n.reg_obsrv_TRANSACTION_DATE,"</label> <label class='dt_time'>"+RCM_Clinical_Util.formatJsonDateString(eventDates[i].EVENT[x].TRANSACTION_DT_TM_FORMATTED)+" "+RegObservationView.formatTheDate(eventDates[i].EVENT[x].TRANSACTION_DT_TM_FORMATTED)+"</label></div></div></td>");
}else{if(eventDates[i].EVENT[x].EVENT_TYPE_MEANING.length!==0){jsHTML.push("<td colspan='3'><div class='row_padding'><div class='action_icon'><br />&nbsp</div><div class='trans-start'><label class='duration_digit'>",reg_Observation_i18n.reg_obsrv_TRANSACTION_DATE,"</label> <label class='dt_time'>"+RCM_Clinical_Util.formatJsonDateString(eventDates[i].EVENT[x].TRANSACTION_DT_TM_FORMATTED)+" "+RegObservationView.formatTheDate(eventDates[i].EVENT[x].TRANSACTION_DT_TM_FORMATTED)+"</label></div></div></td>");
}}jsHTML.push("</tr>");
}else{if(eventDates[i].EVENT[x].EVENT_MEANING==="EXCLUSION"){if(eventDates[i].EVENT[x].ACTIVE_IND===0){if(x>0){jsHTML.push("<tr class='inactive'><td colspan='6'><div class='topBorder'></div></td></tr>");
}jsHTML.push("<tr class='inactive row_padding'>");
jsHTML.push("<td class='td_time inactive_row'><div class='row_padding'>",RegObservationView.formatTheDate(eventDates[i].EVENT[x].EVENT_STOP_DT_TM_FORMATTED),"</div></td>");
if(eventDates[i].EVENT[x].EVENT_TYPE_MEANING==="ADHOCEXCLUSN"){jsHTML.push("<td colspan='2' class='text_left  detail_td  orderP'><div class='row_padding'><label class='td_time'>"+eventDates[i].EVENT[x].DESCRIPTION+"</label><br />",reg_Observation_i18n.reg_obsrv_DURATION+" "+RegObservationView.toHours(eventDates[i].EVENT[x].DURATION),reg_Observation_i18n.reg_obsrv_HRS+RegObservationView.toMins(eventDates[i].EVENT[x].DURATION)+reg_Observation_i18n.reg_obsrv_MIN+"</div></div></td>");
jsHTML.push("<td colspan='3'><div class='row_padding'><div class='action_icon'>&nbsp</div><div class='trans-start text_right '><label class='duration_digit'>",reg_Observation_i18n.reg_obsrv_TRANSACTION_DATE,"</label> <label class='dt_time'>"+RCM_Clinical_Util.formatJsonDateString(eventDates[i].EVENT[x].TRANSACTION_DT_TM_FORMATTED)+" "+RegObservationView.formatTheDate(eventDates[i].EVENT[x].TRANSACTION_DT_TM_FORMATTED)+"</label><br /><label class='duration_digit'>",reg_Observation_i18n.reg_obsrv_START_DATE_TIME,"</label> <label class='dt_time '>"+RCM_Clinical_Util.formatJsonDateString(eventDates[i].EVENT[x].EVENT_START_DT_TM_FORMATTED)+" "+RegObservationView.formatTheDate(eventDates[i].EVENT[x].EVENT_START_DT_TM_FORMATTED)+"</label></div></div></td>");
}}else{if(x>0){jsHTML.push("<tr><td colspan='6'><div class='topBorder'></div></td></tr>");
}jsHTML.push("<tr class='row_padding'>");
jsHTML.push("<td class='td_time exclusionRow'><div class='row_padding'>",RegObservationView.formatTheDate(eventDates[i].EVENT[x].EVENT_STOP_DT_TM_FORMATTED),"</div></td>");
if(eventDates[i].EVENT[x].EVENT_TYPE_MEANING==="ADHOCEXCLUSN"){jsHTML.push("<td colspan='2' class='text_left  detail_td  orderP'><div class='row_padding'><label class='orderName' onclick= 'RegObservationView.exclusionDialog(\"UPT\","+eventDates[i].EVENT[x].PATIENT_EVENT_ID+', "'+eventDates[i].EVENT[x].DESCRIPTION+'","'+eventDates[i].EVENT[x].EVENT_START_DT_TM_FORMATTED+'","'+eventDates[i].EVENT[x].EVENT_STOP_DT_TM_FORMATTED+"\")'>"+eventDates[i].EVENT[x].DESCRIPTION+"</label><br />",reg_Observation_i18n.reg_obsrv_DURATION+" "+RegObservationView.toHours(eventDates[i].EVENT[x].DURATION),reg_Observation_i18n.reg_obsrv_HRS+RegObservationView.toMins(eventDates[i].EVENT[x].DURATION)+reg_Observation_i18n.reg_obsrv_MIN+"</div></div></td>");
jsHTML.push("<td colspan='3'><div class='row_padding'><div class='action_icon'><button id='actn_btn' class='action_btn' onblur='RegObservationView.hide_menu()' onclick='RegObservationView.actionEventsMenu(\"DELETE\", \""+eventDates[i].EVENT[x].PATIENT_EVENT_ID+"\",this)'><img src='"+dropDownImg+"'/></button></div><div class='trans-start text_right '><label class='duration_digit'>",reg_Observation_i18n.reg_obsrv_TRANSACTION_DATE,"</label> <label class='dt_time'>"+RCM_Clinical_Util.formatJsonDateString(eventDates[i].EVENT[x].TRANSACTION_DT_TM_FORMATTED)+" "+RegObservationView.formatTheDate(eventDates[i].EVENT[x].TRANSACTION_DT_TM_FORMATTED)+"</label><br /><label class='duration_digit'>",reg_Observation_i18n.reg_obsrv_START_DATE_TIME,"</label> <label class='dt_time '>"+RCM_Clinical_Util.formatJsonDateString(eventDates[i].EVENT[x].EVENT_START_DT_TM_FORMATTED)+" "+RegObservationView.formatTheDate(eventDates[i].EVENT[x].EVENT_START_DT_TM_FORMATTED)+"</label></div></div></td>");
}}if(eventDates[i].EVENT[x].ORDER_ID){jsHTML.push("<td colspan='2' class=' text_left  detail_td  orderP'><div class='row_padding'><div><label class='orderName' onclick = 'RegObservationView.displayAction()'>"+eventDates[i].EVENT[x].DESCRIPTION+"</label><br />"+eventDates[i].EVENT[x].ORDER_STATUS_DISPLAY+" | "+RegObservationView.toHours(eventDates[i].EVENT[x].DURATION)+reg_Observation_i18n.reg_obsrv_HRS+RegObservationView.toMins(eventDates[i].EVENT[x].DURATION)+reg_Observation_i18n.reg_obsrv_MIN+"</div></div></td>");
jsHTML.push("<td colspan='3'><div class='row_padding'><div class='action_icon '>&nbsp</div><div class='trans-start text_right '><label class='duration_digit'>",reg_Observation_i18n.reg_obsrv_TRANSACTION_DATE,"</label> <label class='dt_time'>"+RCM_Clinical_Util.formatJsonDateString(eventDates[i].EVENT[x].TRANSACTION_DT_TM_FORMATTED)+" "+RegObservationView.formatTheDate(eventDates[i].EVENT[x].TRANSACTION_DT_TM_FORMATTED)+"</label><br /><label class='duration_digit'>"+reg_Observation_i18n.reg_obsrv_START_DATE_TIME+"</label> <label class='dt_time '>"+RCM_Clinical_Util.formatJsonDateString(eventDates[i].EVENT[x].EVENT_START_DT_TM_FORMATTED)+" "+RegObservationView.formatTheDate(eventDates[i].EVENT[x].EVENT_START_DT_TM_FORMATTED)+"</label></div></div></td>");
}else{if(eventDates[i].EVENT[x].FORM_EVENT_ID){jsHTML.push("<td colspan='2' class=' text_left  detail_td  orderP'><div class='row_padding'><div><label class='orderName' onclick = 'RegObservationView.powerform("+eventDates[i].EVENT[x].DCP_FORMS_ACTIVITY_ID+")'>",eventDates[i].EVENT[x].DESCRIPTION,"</label><br />",reg_Observation_i18n.reg_obsrv_DURATION," "+RegObservationView.toHours(eventDates[i].EVENT[x].DURATION),reg_Observation_i18n.reg_obsrv_HRS+RegObservationView.toMins(eventDates[i].EVENT[x].DURATION)+reg_Observation_i18n.reg_obsrv_MIN+"</div></div></td>");
jsHTML.push("<td colspan='3'><div class='row_padding'><div class='action_icon '>&nbsp</div><div class='trans-start text_right '><label class='duration_digit'>",reg_Observation_i18n.reg_obsrv_TRANSACTION_DATE,"</label> <label class='dt_time'>"+RCM_Clinical_Util.formatJsonDateString(eventDates[i].EVENT[x].TRANSACTION_DT_TM_FORMATTED)+" "+RegObservationView.formatTheDate(eventDates[i].EVENT[x].TRANSACTION_DT_TM_FORMATTED)+"</label><br /><label class='duration_digit'>"+reg_Observation_i18n.reg_obsrv_START_DATE_TIME+"</label> <label class='dt_time '>"+RCM_Clinical_Util.formatJsonDateString(eventDates[i].EVENT[x].EVENT_START_DT_TM_FORMATTED)+" "+RegObservationView.formatTheDate(eventDates[i].EVENT[x].EVENT_START_DT_TM_FORMATTED)+"</label></div></div></td>");
}else{if(eventDates[i].EVENT[x].PATIENT_EVENT_ID<=0){jsHTML.push("<td colspan='2' class='text_left  detail_td  orderP'><div class='row_padding'><label class='td_time'>"+eventDates[i].EVENT[x].DESCRIPTION+"</label><br />"+reg_Observation_i18n.reg_obsrv_DURATION+" "+RegObservationView.toHours(eventDates[i].EVENT[x].DURATION),reg_Observation_i18n.reg_obsrv_HRS+RegObservationView.toMins(eventDates[i].EVENT[x].DURATION)+reg_Observation_i18n.reg_obsrv_MIN+"</div></td>");
jsHTML.push("<td colspan='3'><div class='row_padding'><div class='action_icon'>&nbsp</div><div class='trans-start text_right '><label class='duration_digit'>",reg_Observation_i18n.reg_obsrv_TRANSACTION_DATE,"</label> <label class='dt_time'>"+RCM_Clinical_Util.formatJsonDateString(eventDates[i].EVENT[x].TRANSACTION_DT_TM_FORMATTED)+" "+RegObservationView.formatTheDate(eventDates[i].EVENT[x].TRANSACTION_DT_TM_FORMATTED)+"</label><br /><label class='duration_digit'>"+reg_Observation_i18n.reg_obsrv_START_DATE_TIME+"</label> <label class='dt_time '>"+RCM_Clinical_Util.formatJsonDateString(eventDates[i].EVENT[x].EVENT_START_DT_TM_FORMATTED)+" "+RegObservationView.formatTheDate(eventDates[i].EVENT[x].EVENT_START_DT_TM_FORMATTED)+"</label></div></div></td>");
}}}jsHTML.push("</tr>");
}else{if(eventDates[i].EVENT[x].ACTIVE_IND===0){if(x>0){jsHTML.push("<tr class='inactive'><td colspan='6'><div class='topBorder'></div></td></tr>");
}jsHTML.push("<tr class='inactive row_padding'>");
jsHTML.push("<td class='td_time inactive_row'><div class='row_padding'>",RegObservationView.formatTheDate(eventDates[i].EVENT[x].EVENT_START_DT_TM_FORMATTED),"</div></td>");
}else{if(x>0){jsHTML.push("<tr><td colspan='6'><div class='topBorder'></div></td></tr>");
}jsHTML.push("<tr class='row_padding'>");
jsHTML.push("<td class='td_time'><div class='row_padding'>",RegObservationView.formatTheDate(eventDates[i].EVENT[x].EVENT_START_DT_TM_FORMATTED),"</div></td>");
}if(eventDates[i].EVENT[x].ORDER_ID){jsHTML.push("<td colspan='2'><div class='row_padding'><div class='text_left  detail_td'><label class='orderName' onclick = 'RegObservationView.displayAction()'>",eventDates[i].EVENT[x].DESCRIPTION,"</label><br /><label class='orderP'>",phys?phys:NA," | ",prsnl?prsnl:NA," | ",stat?stat:NA,finclass?" | "+finclass:"","</label></div></div></td>");
if(eventDates[i].EVENT[x].ORDER_STATUS_MEANING==="ORDERED"){jsHTML.push("<td colspan='3'><div class='row_padding'><div class='action_icon'><button id='actn_btn' class='action_btn' onblur='RegObservationView.hide_menu()' onclick='RegObservationView.actionEventsMenu(\""+eventDates[i].EVENT[x].ORDER_STATUS_MEANING+'", "'+eventDates[i].EVENT[x].ORDER_ID+"\",this)'><img src='"+dropDownImg+"'/></button><br />&nbsp</div><div class='trans-start'><label class='duration_digit'>",reg_Observation_i18n.reg_obsrv_TRANSACTION_DATE,"</label> <label class='dt_time'>"+RCM_Clinical_Util.formatJsonDateString(eventDates[i].EVENT[x].TRANSACTION_DT_TM_FORMATTED)+" "+RegObservationView.formatTheDate(eventDates[i].EVENT[x].TRANSACTION_DT_TM_FORMATTED)+"</label></div></div></td>");
}else{if(eventDates[i].EVENT[x].ORDER_STATUS_MEANING.length!==0){jsHTML.push("<td colspan='3'><div class='row_padding'><div class='action_icon'><br />&nbsp</div><div class='trans-start'><label class='duration_digit'>",reg_Observation_i18n.reg_obsrv_TRANSACTION_DATE,"</label> <label class='dt_time'>"+RCM_Clinical_Util.formatJsonDateString(eventDates[i].EVENT[x].TRANSACTION_DT_TM_FORMATTED)+" "+RegObservationView.formatTheDate(eventDates[i].EVENT[x].TRANSACTION_DT_TM_FORMATTED)+"</label></div></div></td>");
}}}else{if(eventDates[i].EVENT[x].FORM_EVENT_ID){jsHTML.push("<td colspan='2' class=' text_left  detail_td  orderP'><div class='row_padding'><div><label class='orderName' onclick = 'RegObservationView.powerform("+eventDates[i].EVENT[x].DCP_FORMS_ACTIVITY_ID+")'>",eventDates[i].EVENT[x].DESCRIPTION,"</label></div></div></td>");
jsHTML.push("<td colspan='3'><div class='row_padding'><div class='action_icon'><br />&nbsp</div><div class='trans-start'><label class='duration_digit'>",reg_Observation_i18n.reg_obsrv_TRANSACTION_DATE,"</label> <label class='dt_time'>"+RCM_Clinical_Util.formatJsonDateString(eventDates[i].EVENT[x].TRANSACTION_DT_TM_FORMATTED)+" "+RegObservationView.formatTheDate(eventDates[i].EVENT[x].TRANSACTION_DT_TM_FORMATTED)+"</label></div></div></td>");
}else{jsHTML.push("<td colspan='2' class=' text_left  detail_td  orderP'><div class='row_padding'><div><label class='dt_time'>",eventDates[i].EVENT[x].DESCRIPTION,"</label></div></div></td>");
jsHTML.push("<td colspan='3'><div class='row_padding'><div class='action_icon'><br />&nbsp</div><div class='trans-start'><label class='duration_digit'>",reg_Observation_i18n.reg_obsrv_TRANSACTION_DATE,"</label> <label class='dt_time'>"+RCM_Clinical_Util.formatJsonDateString(eventDates[i].EVENT[x].TRANSACTION_DT_TM_FORMATTED)+" "+RegObservationView.formatTheDate(eventDates[i].EVENT[x].TRANSACTION_DT_TM_FORMATTED)+"</label></div></div></td>");
}}jsHTML.push("</tr>");
}}}}jsHTML.push("</table>");
jsHTML.push("<div id='dropDown' class='dropDown' onmouseout='RegObservationView.hideDropDown(this)' onblur='RegObservationView.hideDropDown(this)'>");
jsHTML.push("</div>");
jsHTML.push("<div class='notOpaque'><div id='trans-div' class='transdiv'></div></div>");
jsHTML.push("<div class='add_dropDown' id='add_dropDown' >");
jsHTML.push("<div><label>",reg_Observation_i18n.reg_obsrv_ADD_EXC_TIME,"</label></div>");
jsHTML.push("<div><label>",reg_Observation_i18n.reg_obsrv_ADD_ORDER,"</label></div>");
jsHTML.push("<div>");
jsHTML.push("<div id='addHoc' class='addHoc'>");
jsHTML.push("<label class='addHoc_header'>",reg_Observation_i18n.reg_obsrv_EXCLUSION_TIME,"</label><br />");
jsHTML.push("<div class='addHocseparator'></div><br />");
jsHTML.push("<label id='orderLabel' for='orderDesc'>",reg_Observation_i18n.reg_obsrv_EXCLUSION_DESC,"</label><br />");
jsHTML.push("<textarea type='text' id='orderDesc' class='order_desc' onkeydown='RegObservationView.checkForTab(this, event)'></textarea>");
jsHTML.push("<div class='paddingDiv'>");
jsHTML.push("<div class='clearBoth'>");
jsHTML.push("<div class='float_left marginRight'><label for='addhoc_startDate'>",reg_Observation_i18n.reg_obsrv_START_DATE,"</label><br /><input type='text' id='addhoc_startDate' /></div>");
jsHTML.push("<div class='float_left'><label for='addhoc_startTime'>",reg_Observation_i18n.reg_obsrv_START_TIME,"</label><br /><input type='text' id='addhoc_startTime' onkeydown='RegObservationView.applyTimeMask(this, event)' onkeyup='RegObservationView.addSeperator(this, event)' class='addhocTime'/></div>");
jsHTML.push("</div>");
jsHTML.push("<div class='clearBoth'>");
jsHTML.push("<div class='float_left marginRight'><label for='addhoc_endDate'>",reg_Observation_i18n.reg_obsrv_END_DATE,"</label><br /><input type='text' id='addhoc_endDate' /></div>");
jsHTML.push("<div class='float_left marginRight'><label for='addhoc_endTime'>",reg_Observation_i18n.reg_obsrv_END_TIME,"</label><br /><input type='text' id='addhoc_endTime'  onkeydown='RegObservationView.applyTimeMask(this, event)' onkeyup='RegObservationView.addSeperator(this, event)' class='addhocTime marginRight' /><label class=''>",reg_Observation_i18n.reg_obsrv_DURATION,"</label><label id='duration_label'>--</label></div>");
jsHTML.push("</div>");
jsHTML.push("</div>");
jsHTML.push("<div class='btn_div'>");
jsHTML.push("<input type=button class='addhoc_btn leftButtonPadding' id='addhoc_SAVE' value='"+reg_Observation_i18n.reg_obsrv_SAVE+"' onclick='RegObservationView.save()' />");
jsHTML.push("<input type=button class='addhoc_btn' id='addhoc_CANCEL' value='"+reg_Observation_i18n.reg_obsrv_CANCEL+"' onclick='RegObservationView.cancel()' onkeydown='RegObservationView.checkForTab(this, event)'/>");
jsHTML.push("</div>");
jsHTML.push("</div>");
jsHTML.push("<div id='confirmDialog' class='confirmDialog'>");
jsHTML.push("<div class='confirmation_title_bar'>");
jsHTML.push("<label id= 'confirmation_title'>",reg_Observation_i18n.reg_obsrv_PLEASE_CONFIRM,"</label></div>");
jsHTML.push("<div class='confirmation_message_area'>");
jsHTML.push("<label id='confirmationMessage'>",reg_Observation_i18n.reg_obsrv_CONFIRMATION_MESSAGE,"</label></div>");
jsHTML.push("<input id='confirm-button1' class='confirm-button-left' type='button' onclick = 'RegObservationView.cancelErrorDialog()' value='",reg_Observation_i18n.reg_obsrv_YES,"' />");
jsHTML.push("<input id='confirm-button' class='confirm-button' type='button' onclick = 'RegObservationView.cancelDialog()' value='",reg_Observation_i18n.reg_obsrv_NO,"' />");
jsHTML.push("</div></div>");
jsHTML.push("</div>");
jsHTML.push("<div id='pm_obs_errorDialog' class='pm_obs_errorDialog'>");
jsHTML.push("<div class='pm_obs_error_title_bar'>");
jsHTML.push("<label id= 'pm_obs_error_title'></label>","</div>");
jsHTML.push("<div class='pm_obs_error_message_area'>");
jsHTML.push("<label id='pm_obs_errorMessage'></label></div>");
jsHTML.push("<input id='pm_obs_error-button' class='error-buttons' type='button' onclick = 'RegObservationView.cancelErrorDialog()' value='",reg_Observation_i18n.reg_obsrv_OK,"' />");
jsHTML.push("</div></div>");
jsHTML.push("</div>");
}var sHTML=jsHTML.join("");
MP_Util.Doc.FinalizeComponent(sHTML,component,"");
RegObservationView.hideInactive();
$("#addHoc").hide();
var rePositionHeader=function(btn){document.getElementById("movingDiv").style.top=$(".col2").scrollTop();
};
$(window).resize(function(){rePositionHeader();
});
$(".col2").scroll(function(){rePositionHeader();
});
RegObservationView.getExclusionStuff();
},onCheckBoxChange:function(){if(document.getElementById("filtercheckbox").checked){RegObservationView.showInactive();
}else{RegObservationView.hideInactive();
}},confirmDialog:function(id){document.getElementById("confirm-button1").onclick=function(){RegObservationView.deleteEx(id);
};
document.getElementById("confirmDialog").style.display="block";
document.getElementById("trans-div").style.display="block";
$(".notOpaque").append($("#confirmDialog"));
},cancelDialog:function(){document.getElementById("confirmDialog").style.display="none";
document.getElementById("trans-div").style.display="none";
},getExclusionStuff:function(){var startDatePicker=RCM_Clinical_Util.addDatePicker(this.component,"addhoc_startDate");
var endDatePicker=RCM_Clinical_Util.addDatePicker(this.component,"addhoc_endDate");
document.getElementById("addhoc_startDate").value="";
document.getElementById("addhoc_endDate").value="";
RCM_Clinical_Util.addRequiredField({},"addhoc_startDate","date");
RCM_Clinical_Util.addRequiredField({},"addhoc_endDate","date");
RCM_Clinical_Util.maskRequiredField("addhoc_startTime");
RCM_Clinical_Util.maskRequiredField("addhoc_endTime");
RCM_Clinical_Util.addRequiredField({},"orderDesc","textarea");
$("#orderDesc").keyup(function(){if(($("#orderDesc").val().length>0)&&(document.getElementById("duration_label").innerText!=="--")){$("#addhoc_SAVE").removeAttr("disabled");
}else{$("#addhoc_SAVE").attr("disabled","disabled");
}});
$("#addhoc_startDate").keyup(function(){if(startDatePicker.checkDate(document.getElementById("addhoc_startDate"))){RegObservationView.calcDuration(startDatePicker,endDatePicker);
}else{$("#addhoc_SAVE").attr("disabled","disabled");
document.getElementById("duration_label").innerText="--";
}});
$("#addhoc_startDate").bind("select",function(){RegObservationView.calcDuration(startDatePicker,endDatePicker);
});
$("#addhoc_endDate").keyup(function(){if(endDatePicker.checkDate(document.getElementById("addhoc_endDate"))){RegObservationView.calcDuration(startDatePicker,endDatePicker);
}else{$("#addhoc_SAVE").attr("disabled","disabled");
document.getElementById("duration_label").innerText="--";
}});
$("#addhoc_endDate").bind("select",function(){RegObservationView.calcDuration(startDatePicker,endDatePicker);
});
$("#addhoc_startTime").keyup(function(){RegObservationView.calcDuration(startDatePicker,endDatePicker);
if($("#addhoc_startTime").val().length>0){RegObservationView.calcDuration(startDatePicker,endDatePicker);
}else{document.getElementById("duration_label").innerText="--";
$("#addhoc_SAVE").attr("disabled","disabled");
}});
$("#addhoc_endTime").keyup(function(){if($("#addhoc_endTime").val().length>=5){RegObservationView.calcDuration(startDatePicker,endDatePicker);
}else{$("#addhoc_SAVE").attr("disabled","disabled");
document.getElementById("duration_label").innerText="--";
}});
},getInfo:function(component){this.component=component;
var json={REQUEST:{person_id:this.component.getCriterion().person_id,encntr_id:this.component.getCriterion().encntr_id}};
var sendAr=[];
sendAr.push("^MINE^","0.0");
sendAr.push("^",JSON.stringify(json),"^");
var obsTest=new ObservationDelegate();
obsTest.getData(sendAr,component);
},hideDropDown:function(element){element.style.display="none";
},checkForTab:function(curElement,event){var keynum;
if(window.event){keynum=event.keyCode;
}else{if(e.which){keynum=e.which;
}}if(keynum===9){if(event.shiftKey&&curElement.id==="orderDesc"){document.getElementById("addhoc_CANCEL").focus();
event.returnValue=false;
}else{if(curElement.id==="addhoc_CANCEL"&&!event.shiftKey){document.getElementById("orderDesc").focus();
event.returnValue=false;
}}}},cancelErrorDialog:function(){document.getElementById("pm_obs_errorDialog").style.display="none";
},popErrorDialog:function(errorType){if(errorType===1){document.getElementById("pm_obs_error_title").innerHTML=reg_Observation_i18n.RCM_STALE_DATA_ERROR;
document.getElementById("pm_obs_errorMessage").innerHTML=reg_Observation_i18n.RCM_STALE_DATA_ERROR_MESSAGE;
document.getElementById("pm_obs_errorDialog").style.display="block";
document.body.appendChild(document.getElementById("pm_obs_errorDialog"));
}else{if(errorType===2){document.getElementById("pm_obs_error_title").innerHTML=reg_Observation_i18n.reg_obsrv_SAVE_ERROR;
document.getElementById("pm_obs_errorMessage").innerHTML=reg_Observation_i18n.reg_obsrv_SAVE_ERROR_MESSAGE;
document.getElementById("pm_obs_errorDialog").style.display="block";
document.body.appendChild(document.getElementById("pm_obs_errorDialog"));
}}},formatTheDate:function(dateString){var date=new Date();
date.setISO8601(dateString);
var formattedString=date.format("HH:MM");
return(formattedString);
},powerform:function(activityId){var dPersonId=this.component.getCriterion().person_id;
var dEncounterId=this.component.getCriterion().encntr_id+".0";
var formId=0;
var activityId=activityId;
var chartMode=1;
var mpObj=window.external.DiscernObjectFactory("POWERFORM");
mpObj.OpenForm(dPersonId,dEncounterId,formId,activityId,chartMode);
},toHours:function(minutes){var minutes=minutes;
var hours=0;
var mins=0;
hours=Math.floor(minutes/60);
return(hours);
},toMins:function(minutes){var hours=RegObservationView.toHours(minutes);
var mins=minutes-(hours*60);
return(mins);
},hideInactive:function(){$(".inactive").hide();
document.getElementById("movingDiv").style.top=document.getElementById("newTab").style.top;
document.getElementById("movingDiv").style.top=$(".col2").scrollTop();
},showInactive:function(){$(".inactive").show();
},show_addDropDown:function(btn){if(document.getElementById("add_dropDown").style.display==="block"){document.getElementById("add_dropDown").style.display="none";
}else{document.getElementById("add_dropDown").style.display="block";
$(".dropDownLabel1").mouseover(function(){btn.onblur=function(){};
});
$(".dropDownLabel1").mouseout(function(){btn.onblur=function(){RegObservationView.hide_exclusionDrop();
};
});
}document.getElementById("dropDown").style.display="none";
},hide_exclusionDrop:function(){document.getElementById("add_dropDown").style.display="none";
},calcDuration:function(startDatePicker,endDatePicker){var startDate;
var startTime;
var endDate;
var endTime;
startDate=RCM_Clinical_Util.getDate("addhoc_startDate");
endDate=RCM_Clinical_Util.getDate("addhoc_endDate");
startTime=RegObservationView.getAddhocTime("addhoc_startTime");
endTime=RegObservationView.getAddhocTime("addhoc_endTime");
if(startDate&&endDate&&startTime&&endTime){startDate.setHours(startTime.getHours(),startTime.getMinutes(),0,0);
endDate.setHours(endTime.getHours(),endTime.getMinutes(),0,0);
var oneMinute=1000*60;
if(endDate>startDate){var durationInMillis=endDate.getTime()-startDate.getTime();
var durationInMinutes=Math.ceil(durationInMillis/oneMinute);
var durationInHours=RegObservationView.toHours(durationInMinutes);
if(durationInHours>=2){document.getElementById("duration_label").innerText=durationInHours+" "+reg_Observation_i18n.reg_obsrv_HRS+RegObservationView.toMins(durationInMinutes)+reg_Observation_i18n.reg_obsrv_MIN;
}else{document.getElementById("duration_label").innerText=durationInHours+" "+reg_Observation_i18n.reg_obsrv_HR+RegObservationView.toMins(durationInMinutes)+reg_Observation_i18n.reg_obsrv_MIN;
}if($("#orderDesc").val().length>0){$("#addhoc_SAVE").removeAttr("disabled");
}}else{document.getElementById("duration_label").innerText="--";
$("#addhoc_SAVE").attr("disabled","disabled");
}}},actionEventsMenu:function(currStatus,id,btn){if((document.getElementById("dropDown").style.top===$(btn).offset().top+$(btn).height()+3+"px")&&(document.getElementById("dropDown").style.display==="block")){document.getElementById("dropDown").style.display="none";
return;
}var topPos=$(btn).offset().top+$(btn).height()+3+"px";
var eventOptions=[];
var option1;
var option2;
if(currStatus==="ORDERED"){option1=RegObservationView.addOption(reg_Observation_i18n.reg_obsrv_CANCEL_DC,'RegObservationView.cancelDCAction("'+id+'")');
option2=RegObservationView.addOption(reg_Observation_i18n.reg_obsrv_COMPLETE,'RegObservationView.completeAction("'+id+'")');
eventOptions.push(option1);
eventOptions.push(option2);
}else{if(currStatus==="COMPLETED"){option1=RegObservationView.addOption(reg_Observation_i18n.reg_obsrv_DISPLAY,"RegObservationView.displayAction()");
eventOptions.push(option1);
}else{if(currStatus==="DELETE"){option1=RegObservationView.addOption(reg_Observation_i18n.reg_obsrv_DELETE,'RegObservationView.confirmDialog("'+id+'")');
eventOptions.push(option1);
}}}RegObservationView.createMenu(eventOptions,btn);
},hide_menu:function(){document.getElementById("dropDown").style.display="none";
},addOption:function(name,action){return{name:name,action:action,getName:function(){return this.name;
},getAction:action};
},cancelDCAction:function(id){var m_dPersonId=this.component.getCriterion().person_id;
var m_dEncounterId=this.component.getCriterion().encntr_id;
var cancelId=id;
var m_dCancelDCReason=0;
var nDate=new Date();
var newStr=nDate.format("isoDate")+nDate.format("isoTime");
newStr=newStr.replace(/-/g,"");
newStr=newStr.replace(/:/g,"");
newStr=newStr+"00";
var PowerOrdersMPageUtils=window.external.DiscernObjectFactory("POWERORDERS");
var m_hMOEW=PowerOrdersMPageUtils.CreateMOEW(m_dPersonId,m_dEncounterId,0,2,127);
PowerOrdersMPageUtils.InvokeCancelDCAction(m_hMOEW,cancelId,newStr,m_dCancelDCReason);
PowerOrdersMPageUtils.DisplayMOEW(m_hMOEW);
},completeAction:function(id){var m_dPersonId=this.component.getCriterion().person_id;
var m_dEncounterId=this.component.getCriterion().encntr_id;
var completeId=id;
var PowerOrdersMPageUtils=window.external.DiscernObjectFactory("POWERORDERS");
var m_hMOEW=PowerOrdersMPageUtils.CreateMOEW(m_dPersonId,m_dEncounterId,0,2,127);
PowerOrdersMPageUtils.InvokeCompleteAction(m_hMOEW,completeId);
PowerOrdersMPageUtils.DisplayMOEW(m_hMOEW);
},displayAction:function(){var m_dPersonId=this.component.getCriterion().person_id;
var m_dEncounterId=this.component.getCriterion().encntr_id;
var PowerOrdersMPageUtils=window.external.DiscernObjectFactory("POWERORDERS");
var m_hMOEW=PowerOrdersMPageUtils.CreateMOEW(m_dPersonId,m_dEncounterId,0,2,127);
PowerOrdersMPageUtils.DisplayMOEW(m_hMOEW);
},createMenu:function(eventOptions,btn){var content=0;
for(x=0;
x<eventOptions.length;
x++){if(content===0){content="<div class='dropDownLabel' onclick='"+eventOptions[x].action+"'  onMouseOver ='RegObservationView.dropDownMouseOver(this, \"dropDown\")' onMouseOut ='RegObservationView.dropDownMouseOut(this, \"dropDown\")'><label >"+eventOptions[x].name+"</label></div>";
}else{content+="<div class='dropDownLabel' onclick='"+eventOptions[x].action+"' onMouseOver ='RegObservationView.dropDownMouseOver(this, \"dropDown\")' onMouseOut ='RegObservationView.dropDownMouseOut(this, \"dropDown\")'><label>"+eventOptions[x].name+"</label></div>";
}}document.getElementById("add_dropDown").style.display="none";
var btnWidth=btn.offsetLeft;
document.getElementById("dropDown").innerHTML=content;
document.getElementById("dropDown").style.display="block";
document.getElementById("dropDown").style.top=$(btn).offset().top+$(btn).height()+3;
document.getElementById("dropDown").style.left=$(btn).height()+$(btn).offset().left-$(document.getElementById("dropDown")).width()+12;
document.body.appendChild(document.getElementById("dropDown"));
var rePositionModifyDialog=function(btn){document.getElementById("dropDown").style.top=$(btn).offset().top+$(btn).height()+3;
document.getElementById("dropDown").style.left=$(btn).height()+$(btn).offset().left-$(document.getElementById("dropDown")).width()+12;
};
$(window).resize(function(){rePositionModifyDialog(btn);
});
$(".col2").scroll(function(){rePositionModifyDialog(btn);
});
$(".dropDownLabel").mouseover(function(){btn.onblur=function(){};
});
$(".dropDownLabel").mouseout(function(){btn.onblur=function(){RegObservationView.hide_menu();
};
});
},dropDownMouseOver:function(element,divName){element.style.background="#568ECB";
element.style.color="#FFFFFF";
document.getElementById(divName).style.display="block";
},dropDownMouseOut:function(element,divName){element.style.background="#FFFFFF";
element.style.color="black";
document.getElementById(divName).style.display="block";
},exclusionDialog:function(actionType,eventId,desc,startDate,endDate){document.getElementById("dropDown").style.display="none";
document.getElementById("add_dropDown").style.display="none";
if(actionType){document.getElementById("addhoc_SAVE").onclick=function(){RegObservationView.save(actionType,eventId);
};
document.getElementById("orderDesc").value=desc;
RCM_Clinical_Util.setDateString("addhoc_startDate",startDate);
document.getElementById("addhoc_startTime").value=RegObservationView.formatTheDate(startDate);
RCM_Clinical_Util.setDateString("addhoc_endDate",endDate);
document.getElementById("addhoc_endTime").value=RegObservationView.formatTheDate(endDate);
RCM_Clinical_Util.umMaskRequiredField("orderDesc");
RCM_Clinical_Util.umMaskRequiredField("addhoc_startDate");
RCM_Clinical_Util.umMaskRequiredField("addhoc_endDate");
RCM_Clinical_Util.umMaskRequiredField("addhoc_startTime");
RCM_Clinical_Util.umMaskRequiredField("addhoc_endTime");
RegObservationView.calcDuration(document.getElementById("addhoc_startDate"),document.getElementById("addhoc_endDate"));
$("#addhoc_SAVE").removeAttr("disabled");
}else{document.getElementById("addhoc_SAVE").onclick=function(){RegObservationView.save();
};
RCM_Clinical_Util.maskRequiredField("orderDesc");
RCM_Clinical_Util.maskRequiredField("addhoc_startDate");
RCM_Clinical_Util.maskRequiredField("addhoc_endDate");
RCM_Clinical_Util.maskRequiredField("addhoc_startTime");
RCM_Clinical_Util.maskRequiredField("addhoc_endTime");
$("#addhoc_SAVE").attr("disabled","disabled");
}document.getElementById("addHoc").style.display="block";
document.getElementById("trans-div").style.display="block";
$(".notOpaque").append($(".addHoc"));
document.getElementById("orderDesc").focus();
},formatDateString:function(date){var formattedString=[];
formattedString.push(date.format("dd-mmm-yyyy HH:MM:ss"));
return formattedString.join("");
},save:function(actionType,eventId){var startDate=RCM_Clinical_Util.getDate("addhoc_startDate");
var endDate=RCM_Clinical_Util.getDate("addhoc_endDate");
var startTime=RegObservationView.getAddhocTime("addhoc_startTime");
var endTime=RegObservationView.getAddhocTime("addhoc_endTime");
startDate.setHours(startTime.getHours(),startTime.getMinutes(),0,0);
endDate.setHours(endTime.getHours(),endTime.getMinutes(),0,0);
var oneMinute=1000*60;
var durationInMillis=endDate.getTime()-startDate.getTime();
var durationInMinutes=Math.ceil(durationInMillis/oneMinute);
var desc=$.trim($("#orderDesc").val());
var json={REQUEST:{encntr_id:String(this.component.getCriterion().encntr_id),person_id:String(this.component.getCriterion().person_id),action:actionType?String(actionType):"ADD",event_dt_tm:RegObservationView.formatDateString(startDate),patient_event_id:eventId?String(eventId):"0.0",event_detail:[{action:"ADD",patient_event_detail_id:"0.0",value_meaning:"DURATION",value_string:"",value_numeric:String(durationInMinutes)},{action:"ADD",patient_event_detail_id:"0.0",value_meaning:"DESCRIPTION",value_string:String(desc),value_numeric:""}]}};
var sendAr=[];
sendAr.push("^MINE^","0.0");
sendAr.push("^",JSON.stringify(json),"^");
var obsSendDelegate=new ObservationDelegate();
obsSendDelegate.setData(sendAr,this.component);
RegObservationView.cancel();
},deleteEx:function(eventId){var json={REQUEST:{encntr_id:String(this.component.getCriterion().encntr_id),person_id:String(this.component.getCriterion().person_id),action:"DEL",event_dt_tm:"",patient_event_id:eventId?String(eventId):"0.0",event_detail:[{action:"ADD",patient_event_detail_id:"0.0",value_meaning:"DURATION",value_string:"",value_numeric:""},{action:"ADD",patient_event_detail_id:"0.0",value_meaning:"DESCRIPTION",value_string:"",value_numeric:""}]}};
var sendAr=[];
sendAr.push("^MINE^","0.0");
sendAr.push("^",JSON.stringify(json),"^");
var obsSendDelegate=new ObservationDelegate();
obsSendDelegate.setData(sendAr,this.component);
RegObservationView.cancelDialog();
},cancel:function(){document.getElementById("addHoc").style.display="none";
document.getElementById("addhoc_startTime").value="";
document.getElementById("addhoc_endTime").value="";
document.getElementById("orderDesc").value="";
document.getElementById("duration_label").innerText="--";
document.getElementById("addhoc_startDate").value="";
document.getElementById("addhoc_endDate").value="";
document.getElementById("trans-div").style.display="none";
},applyTimeMask:function(element,e){var keynum;
var numcheck;
var keychar;
var date;
if(window.event){keynum=event.keyCode;
}else{if(e.which){keynum=e.which;
}}if(keynum===46){element.value="";
}if(keynum===78){date=new Date();
element.value=(date.getHours()>9?date.getHours():"0"+date.getHours())+":"+(date.getMinutes()>9?date.getMinutes():"0"+date.getMinutes());
}if(element.value.length===5&&keynum===38){var hrs=Number(element.value.substring(0,2));
if(hrs===23){hours=0;
}else{var hours=hrs+1;
}var mins=Number(element.value.substring(3,5));
var minutes=mins+1;
if(mins===59){if(hrs<9||hrs===23){element.value="0"+hours+":00";
}else{element.value=hours+":00";
}}else{if(mins<9){element.value=element.value.substring(0,2)+":0"+minutes;
}else{element.value=element.value.substring(0,2)+":"+minutes;
}}}if(element.value.length===5&&keynum===40){var hrs=Number(element.value.substring(0,2));
if(hrs===0){hours=23;
}else{var hours=hrs-1;
}var mins=Number(element.value.substring(3,5));
var minutes=mins-1;
if(mins===0){if(hours<10&&hrs!==0){element.value="0"+hours+":59";
}else{element.value=hours+":59";
}}else{if(minutes<10){element.value=element.value.substring(0,2)+":0"+minutes;
}else{element.value=element.value.substring(0,2)+":"+minutes;
}}}keychar=String.fromCharCode(keynum);
numcheck=/\d/;
if(((!numcheck.test(keychar)&&!(keynum>=96&&keynum<=105))||element.value.length>=4)&&!(keynum>=35&&keynum<=40)&&(keynum!=8)&&(keynum!=9)){event.returnValue=false;
}},addSeperator:function(element,event){var keynum;
if(window.event){keynum=event.keyCode;
}else{if(e.which){keynum=e.which;
}}if(keynum===8){element.value=element.value.replace(":","");
}if(element.value.length===4){element.value=element.value.substring(0,2)+":"+element.value.substring(2,4);
}RegObservationView.checkTime(element);
},checkTime:function(element){var dateText=element;
var hours=dateText.value.substring(0,2);
var mins=dateText.value.substring(3,5);
if(hours<24&&mins<60&&dateText.value.length===5){RCM_Clinical_Util.umMaskRequiredField(element.id);
}else{RCM_Clinical_Util.maskRequiredField(element.id);
}},getAddhocTime:function(id){var dateText=document.getElementById(id);
var hours=dateText.value.substring(0,2);
var mins=dateText.value.substring(3,5);
var theDate=new Date();
if(hours<24&&mins<60&&dateText.value.length===5){theDate.setHours(hours,mins,0,0);
return theDate;
}}};
}();
