const express = require("express");

/**
 * This function calls checkCodeCoverage, then trims the request url to it's base folder and passes
 * the result of the promise to the serveStatic function.
 * @function coverage
 * @param {*} gaia The MPages Gaia object
 * @param {*} args The arguments passed to the command
 * @param {String} req The requested route
 * @param {*} res The response for the request
 * @param {Function} next The next function to be ran
 * @returns {undefined}
 */
const coverage = (gaia, args, req, res, next) => {
    gaia.runCommand("unit-testing", "checkCodeCoverage", args)
        .then((evidenceFolder) => {
            req.url = req.url.substr("/unit-testing/coverage".length) || "/";
            express.static(evidenceFolder)(req, res, next);
        })
        .catch((err) => {
            console.log(err);
            res.status(404).send("You must run your unit tests to see code coverage");
        });
};

module.exports = {
    coverage
};
