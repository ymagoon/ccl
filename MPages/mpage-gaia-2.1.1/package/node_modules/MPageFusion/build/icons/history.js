"use strict";

const fs = require("fs");
const path = require("path");
const historyPath = path.join(__dirname, ".history");

/**
 * Retrieves the history of icon updates by reading the history log file.
 * @returns {Promise} A promise to the history of icon updates.
 */
const getHistory = () => new Promise((resolve, reject) => {
    fs.readFile(historyPath, (err, data) => {
        if(err) {
            resolve([]);
        } else {
            let history = null;
            try {
                history = JSON.parse(data);
            } catch (exe) {
                history = [];
                console.warn("There was an issue parsing the history file, proceeding with an empty history.");
            } finally {
                resolve(history);
            }
        }
    });
});

/**
 * Writes the provided history to the icon history file.
 * @param {Array<Object>} history - The history of icon updates to be written.
 * @returns {Promise} A Promise to write the history.
 */
const writeHistory = (history = []) => new Promise((resolve, reject) => {
    fs.writeFile(historyPath, JSON.stringify(history), (err) => {
        if(err) {
            console.warn("There was an error writing to the icon history file. Please follow up and verify.");
        }
        resolve();
    });
});

module.exports = {
    getHistory,
    writeHistory
};
