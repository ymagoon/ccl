var CERN_DEMO_BANNER_O1=function(){function initHoversDemoBanner(trg,par){gen=Util.Style.g(trg,par,"SPAN");
for(var i=0,l=gen.length;
i<l;
i++){var m=gen[i];
if(m){var nm=Util.gns(Util.gns(m));
if(nm){if(Util.Style.ccss(nm,"hvr")){hs(m,nm);
}}}}}return{GetPatientDemographics:function(demoBanner,criterion){var sendAr=["^MINE^",criterion.person_id+".0",criterion.encntr_id+".0"];
var request=new MP_Core.ScriptRequest(null,"USR:MPG.DEMO_BANNER.O1 - load component");
request.setProgramName("MP_GET_PATIENT_DEMO");
request.setParameters(sendAr);
MP_Core.XMLCCLRequestCallBack(null,request,function(replyObj){MP_Util.LogScriptCallInfo(null,this,"demobanner.js","GetPatientDemographics");
var recordData=replyObj.getResponse();
if(!recordData){return;
}try{var timer=MP_Util.CreateTimer("ENG:MPG.DEMO_BANNER.O1 - render component");
var age="";
var birthDate="";
var birthDtTm=new Date();
var codeArray=null;
var deceasedDate="";
var deceasedDtTm=new Date();
var enCodeArray=[];
var finNbr="";
var i=0;
var isolation="";
var j=0;
var jsHTML=[];
var localBirthDtTm=new Date();
var localDeceasedDtTm=new Date();
var mrnNbr="";
var nameFull="";
var patInfo=null;
var ptCodeArray=[];
var sexDisp="";
var sexObj=null;
var visitReason="";
codeArray=MP_Util.LoadCodeListJSON(recordData.CODES);
patInfo=recordData.DEMOGRAPHICS.PATIENT_INFO;
nameFull=patInfo.PATIENT_NAME.NAME_FULL;
if(patInfo.ABS_BIRTH_DT_TM!==""){var regexp="([0-9]{4})(-([0-9]{2})(-([0-9]{2})(T([0-9]{2}):([0-9]{2})(:([0-9]{2})(.([0-9]+))?)?(Z|(([-+])([0-9]{2}):([0-9]{2})))?)?)?)?";
var d=patInfo.ABS_BIRTH_DT_TM.match(new RegExp(regexp));
birthDtTm=new Date(d[1],d[3]-1,d[5],d[7],d[8],d[10]);
birthDate=birthDtTm.format("shortDate2");
}else{if(patInfo.BIRTH_DT_TM!==""){birthDtTm.setISO8601(patInfo.BIRTH_DT_TM);
birthDate=birthDtTm.format("shortDate2");
}}if(patInfo.DECEASED_DT_TM!==""){deceasedDtTm.setISO8601(patInfo.DECEASED_DT_TM);
deceasedDate=deceasedDtTm.format("shortDate2");
}if(patInfo.LOCAL_DECEASED_DT_TM&&patInfo.LOCAL_BIRTH_DT_TM){localBirthDtTm.setISO8601(patInfo.LOCAL_BIRTH_DT_TM);
localDeceasedDtTm.setISO8601(patInfo.LOCAL_DECEASED_DT_TM);
age=MP_Util.CalcAge(localBirthDtTm,localDeceasedDtTm);
}else{if(patInfo.LOCAL_BIRTH_DT_TM){localBirthDtTm.setISO8601(patInfo.LOCAL_BIRTH_DT_TM);
age=MP_Util.CalcAge(localBirthDtTm);
}}var encntrInfo=recordData.DEMOGRAPHICS.ENCOUNTER_INFO;
for(j=0,e=encntrInfo.length;
j<e;
j++){visitReason=encntrInfo[j].REASON_VISIT;
for(i=0,l=encntrInfo[j].ALIAS.length;
i<l;
i++){enCodeArray[i]=MP_Util.GetValueFromArray(encntrInfo[j].ALIAS[i].ALIAS_TYPE_CD,codeArray);
if(enCodeArray[i].meaning=="FIN NBR"){finNbr=encntrInfo[j].ALIAS[i].FORMATTED_ALIAS;
}if(enCodeArray[i].meaning=="MRN"){mrnNbr=encntrInfo[j].ALIAS[i].FORMATTED_ALIAS;
}}if(encntrInfo[j].ISOLATION_CD>0){var isoObj=MP_Util.GetValueFromArray(encntrInfo[j].ISOLATION_CD,codeArray);
isolation=isoObj.display;
}}aliasArry=recordData.DEMOGRAPHICS.PATIENT_INFO.ALIAS;
if(mrnNbr===""){for(i=0,l=aliasArry.length;
i<l;
i++){ptCodeArray[i]=MP_Util.GetValueFromArray(aliasArry[i].ALIAS_TYPE_CD,codeArray);
if(ptCodeArray[i].meaning=="MRN"){mrnNbr=aliasArry[i].FORMATTED_ALIAS;
}}}sexObj=MP_Util.GetValueFromArray(patInfo.SEX_CD,codeArray);
sexDisp=(sexObj)?sexObj.display:i18n.UNKNOWN;
jsHTML.push("<div id='demobanner'",criterion.category_mean,"><dl class='dmg-info'><dt class='dmg-pt-name-lbl'><span>",i18n.NAME,"</span></dt><dd class='dmg-pt-name'><span>",nameFull,"</span></dd><dt class='dmg-sex-lbl'><span>",i18n.SEX," ","</span></dt><dd class='dmg-sex'><span>",sexDisp," ","</span></dd><dt class='dmg-age-lbl'><span>",i18n.AGE,"</span></dt>");
if(deceasedDate!==""){jsHTML.push("<span class='dmg-deceased'>",age,"</span><h4 class='det-hd'><span class='dmg-info'>",i18n.AGE,"</span></h4><div class='hvr'><dl class='dmg-info'><dt class='dmg-info'><span >",i18n.DECEASED,":</span></dt><dd class='dmg-info'><span>",deceasedDate,"</span></dd></dl></div>");
}else{jsHTML.push("<dd class='dmg-age'><span>",age,"</span></dd>");
}jsHTML.push("<dt><span>",i18n.DOB,":</span></dt><dd class='dmg-dob'><span>",birthDate,"</span></dd><dt><span>",i18n.MRN,":</span></dt><dd class='dmg-mrn'><span>",mrnNbr,"</span></dd><dt><span>",i18n.FIN,":</span></dt><dd class='dmg-fin'><span>",finNbr,"</span></dd><dt><span>",i18n.ISOLATION,":</span></dt><dd class='dmg-isolation'><span>",isolation,"</span></dd><dt><span>",i18n.VISIT_REASON,":</span></dt><dd class='dmg-rfv'><span>",visitReason,"</span></dd></dl></div>");
demoBanner.innerHTML=jsHTML.join("");
initHoversDemoBanner("dmg-deceased",_g("demobanner"+criterion.category_mean));
}catch(err){MP_Util.LogJSError(err,null,"demobanner.js","GetPatientDemographics");
if(timer){timer.Abort();
timer=null;
}}finally{if(timer){timer.Stop();
}}});
}};
}();
