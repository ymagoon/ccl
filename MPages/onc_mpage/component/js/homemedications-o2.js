function HomeMedicationsComponentStyle2(){this.initByNamespace("hml2");
}HomeMedicationsComponentStyle2.prototype=new ComponentStyle();
HomeMedicationsComponentStyle2.prototype.constructor=ComponentStyle;
function HomeMedicationsComponent2(criterion){this.setCriterion(criterion);
this.setStyles(new HomeMedicationsComponentStyle2());
this.setComponentLoadTimerName("USR:MPG.HOME_MEDS.O2 - load component");
this.setComponentRenderTimerName("ENG:MPG.HOME_MEDS.O2 - render component");
this.setIncludeLineNumber(true);
this.setScope(1);
this.m_medModInd=false;
this.m_editMode=false;
this.m_medModObj={};
this.m_origOrder={};
this.m_medRec=false;
this.m_medHistory=false;
this.m_medRecAdmit=false;
this.m_medRecTransfer=false;
this.m_medRecCrossEncTx=false;
this.m_medRecDischarge=false;
this.setHasActionsMenu(true);
this.compliance=false;
this.m_initialRenew=true;
this.compMenuReference={};
this.m_compMenuSequence=[];
this.inMillennium=CERN_Platform.inMillenniumContext();
this.m_base=null;
this.m_grouper_arr=[];
this.m_wasListenerAdded=false;
this.m_segmentedControl=null;
this.m_sidePanel=null;
this.m_sidePanelShowing=false;
this.m_componentTable=null;
this.m_tableHoverExtension=null;
this.m_mfaBanner=null;
this.m_home_meds_i18n=i18n.discernabu.homemeds_o2;
this.m_millDataInd=1;
this.pageIndex=0;
this.pager=null;
this.m_viewOutsideRecordsInd=true;
this.m_millDataInd=1;
this.externalHomeMed={};
this.m_patientRequestList=[];
this.m_otherCharMedsList=[];
this.m_displayHiData=false;
this.m_orderInquiryPriv=1;
HomeMedicationsComponent2.method("InsertData",function(){CERN_HOME_MEDS_O2.GetHomeMedications(this);
});
HomeMedicationsComponent2.method("HandleSuccess",function(recordData){var timerRenderComponent=MP_Util.CreateTimer(this.getComponentRenderTimerName());
try{CERN_HOME_MEDS_O2.RenderComponent(this,recordData);
CERN_HOME_MEDS_O2.initializeSidePanel(this);
}catch(err){if(timerRenderComponent){timerRenderComponent.Abort();
timerRenderComponent=null;
}throw (err);
}finally{if(timerRenderComponent){timerRenderComponent.Stop();
}}});
CERN_EventListener.addListener(this,EventListener.EVENT_ORDER_ACTION,this.InsertData,this);
HomeMedicationsComponent2.method("isMedModInd",function(){return this.m_medModInd;
});
HomeMedicationsComponent2.method("setMedModInd",function(value){this.m_medModInd=(value==1?true:false);
});
HomeMedicationsComponent2.method("setMedRec",function(value){this.m_medRec=(value==1?true:false);
});
HomeMedicationsComponent2.method("getMedRec",function(value){return(this.m_medRec);
});
HomeMedicationsComponent2.method("setMedHistory",function(value){this.m_medHistory=(value==1?true:false);
});
HomeMedicationsComponent2.method("getMedHistory",function(){return(this.m_medHistory);
});
HomeMedicationsComponent2.method("setMedRecAdmit",function(value){this.m_medRecAdmit=(value==1?true:false);
});
HomeMedicationsComponent2.method("getMedRecAdmit",function(){return(this.m_medRecAdmit);
});
HomeMedicationsComponent2.method("setMedRecTransfer",function(value){this.m_medRecTransfer=(value==1?true:false);
});
HomeMedicationsComponent2.method("getMedRecTransfer",function(){return(this.m_medRecTransfer);
});
HomeMedicationsComponent2.method("setMedRecCrossEncTx",function(value){this.m_medRecCrossEncTx=(value==1?true:false);
});
HomeMedicationsComponent2.method("getMedRecCrossEncTx",function(){return(this.m_medRecCrossEncTx);
});
HomeMedicationsComponent2.method("setMedRecDischarge",function(value){this.m_medRecDischarge=(value==1?true:false);
});
HomeMedicationsComponent2.method("getMedRecDischarge",function(){return(this.m_medRecDischarge);
});
HomeMedicationsComponent2.method("openTab",function(){var criterion=this.getCriterion();
var sParms="/PERSONID="+criterion.person_id+" /ENCNTRID="+criterion.encntr_id+" /FIRSTTAB=^"+this.getLink()+"+^";
APPLINK(0,criterion.executable,sParms);
this.InsertData();
});
HomeMedicationsComponent2.method("setAllData",function(recordData){this.allData=recordData;
});
HomeMedicationsComponent2.method("getAllData",function(){return this.allData;
});
HomeMedicationsComponent2.method("setComponentTable",function(componentTable){this.m_componentTable=componentTable;
});
HomeMedicationsComponent2.method("getComponentTable",function(){return this.m_componentTable;
});
HomeMedicationsComponent2.prototype.getAllOrders=function(){return this.allData.ORDERS;
};
HomeMedicationsComponent2.prototype.setOutsideRecordsInd=function(value){this.m_viewOutsideRecordsInd=value;
var cookieValue=(value)?"yes":"no";
MP_Util.AddCookieProperty(this.getComponentId(),"VIEW_HOME_MEDS_OUTSIDE_RECORDS",cookieValue);
MP_Util.WriteCookie();
};
HomeMedicationsComponent2.prototype.getOutsideRecordsInd=function(){var viewOutsideRecordsCookie=MP_Util.GetCookieProperty(this.getComponentId(),"VIEW_HOME_MEDS_OUTSIDE_RECORDS");
if(viewOutsideRecordsCookie){this.setOutsideRecordsInd(viewOutsideRecordsCookie==="yes");
}return this.m_viewOutsideRecordsInd;
};
HomeMedicationsComponent2.prototype.isPatientEnteredDataDisplayEnabled=function(){return(this.getPatientEnteredDataInd()&&this.getOutsideRecordsInd());
};
HomeMedicationsComponent2.prototype.getOtherChartMedsList=function(){return this.m_otherCharMedsList;
};
HomeMedicationsComponent2.prototype.getPatientRequestList=function(){return this.m_patientRequestList;
};
HomeMedicationsComponent2.prototype.setDisplayHiDataInd=function(value){this.m_displayHiData=value;
};
HomeMedicationsComponent2.prototype.getDisplayHiDataInd=function(){return this.m_displayHiData;
};
HomeMedicationsComponent2.prototype.setSegmentedControl=function(value){this.m_segmentedControl=value;
};
HomeMedicationsComponent2.prototype.getSegmentedControl=function(){return this.m_segmentedControl;
};
HomeMedicationsComponent2.method("setMedStatusData",function(statusData){this.medStatusData=statusData;
});
HomeMedicationsComponent2.method("getMedStatusData",function(){return this.medStatusData;
});
HomeMedicationsComponent2.method("setCompliance",function(value){this.compliance=value;
});
HomeMedicationsComponent2.method("hasCompliance",function(){return this.compliance;
});
HomeMedicationsComponent2.method("setInitialRenew",function(value){this.m_initialRenew=value;
});
HomeMedicationsComponent2.method("getInitialRenew",function(){return this.m_initialRenew;
});
HomeMedicationsComponent2.prototype.setTableHoverExtension=function(hoverExtension){this.m_tableHoverExtension=hoverExtension;
};
HomeMedicationsComponent2.prototype.getTableHoverExtension=function(){return this.m_tableHoverExtension;
};
HomeMedicationsComponent2.prototype.resizeComponent=function(){var compDOMObj=null;
var container=null;
var viewHeight=0;
var componentId=this.getComponentId();
var accordion=$("#AccordionContainer"+componentId);
var accordionContent=$("#Accordion"+componentId+"Content");
var accordionContentStyle;
var isExpanded=false;
if(accordion.length>0){isExpanded=accordion.hasClass("Expanded");
if(isExpanded){accordion.removeClass("Expanded");
if(accordionContent.length){accordionContentStyle=accordionContent.attr("style");
accordionContent.removeAttr("style");
}}}container=$("#vwpBody");
if(!container.length){return;
}viewHeight=container.height();
compDOMObj=$("#"+this.getStyles().getId());
if(!compDOMObj.length){return;
}this.calcDynamicSize(compDOMObj,viewHeight);
if(isExpanded&&accordion.length>0){accordion.addClass("Expanded");
accordionContent.attr("style",accordionContentStyle);
}};
HomeMedicationsComponent2.prototype.calcDynamicSize=function(compDOM,viewHeight){var compId=this.getComponentId();
var extDataTableDOM=compDOM.find("#hml2"+compId+"externaldata");
var extDataTablePagerDOM=compDOM.find("#pager"+compId);
var tableDOM=compDOM.find("#hml2"+compId+"table");
var mainContainersDOM=extDataTableDOM.add(tableDOM.closest(".content-body"));
var innerContentBodyDOM=mainContainersDOM.find(".content-body");
var sidePanel=this.m_sidePanel;
var contentBodyMaxHeight=viewHeight;
var sidePanelMaxHeight=viewHeight;
var adjacents=".sec-hd,.hml2-meds-header-info-container,#hml2Ftr"+compId+",#hml2Content"+compId;
adjacentElements=compDOM.find(adjacents);
adjacentElements.filter("#hml2Content"+this.getComponentId()).each(function(){var paddingSpace=$(this).innerHeight()-$(this).height();
contentBodyMaxHeight-=paddingSpace;
sidePanelMaxHeight-=paddingSpace;
});
adjacentElements.filter(".sec-hd, .hml2-meds-header-info-container").each(function(){var adjElementHeight=$(this).outerHeight();
contentBodyMaxHeight-=adjElementHeight;
sidePanelMaxHeight-=adjElementHeight;
});
if(extDataTableDOM.length){contentBodyMaxHeight-=parseInt(extDataTableDOM.closest(".hml2-externaldata-container").css("margin-bottom"),10);
if(extDataTablePagerDOM.length){contentBodyMaxHeight-=extDataTablePagerDOM.outerHeight();
}}adjacentElements.filter(".hml2-content-ft").each(function(){contentBodyMaxHeight-=$(this).outerHeight();
});
contentBodyMaxHeight/=mainContainersDOM.length;
mainContainersDOM.css({"max-height":contentBodyMaxHeight+"px","overflow-y":"hidden"});
innerContentBodyDOM.each(function(){var _this=$(this);
var table=_this.closest(".content-body");
var tableHeaderHeight=table.find(".content-hdr").outerHeight();
var tableBorderHeight=innerContentBodyDOM.outerHeight()-innerContentBodyDOM.height();
_this.css({"max-height":(contentBodyMaxHeight-tableHeaderHeight-tableBorderHeight)+"px","overflow-y":"auto"});
});
var compTable=this.getComponentTable();
if(compTable){compTable.updateAfterResize();
}if(this.m_externalDataTable){this.m_externalDataTable.updateAfterResize();
}if(sidePanel&&this.m_sidePanelShowing){sidePanel.collapseSidePanel();
sidePanel.setMinHeight(contentBodyMaxHeight+"px");
sidePanel.setHeight(contentBodyMaxHeight+"px");
sidePanel.resizePanel(sidePanelMaxHeight+"px");
sidePanel.expandSidePanel();
}};
HomeMedicationsComponent2.method("renderAccordion",function(component){});
}HomeMedicationsComponent2.inherits(MPageComponent);
HomeMedicationsComponent2.prototype.setWasListenerAdded=function(value){this.m_wasListenerAdded=value;
};
HomeMedicationsComponent2.prototype.getWasListenerAdded=function(){return this.m_wasListenerAdded;
};
HomeMedicationsComponent2.prototype.loadFilterMappings=function(){this.addFilterMappingObject("WF_HOME_MEDS_INFO_BUTTON_IND",{setFunction:this.setHasInfoButton,type:"BOOLEAN",field:"FREETEXT_DESC"});
this.addFilterMappingObject("WF_PAT_ENTERED_HOME_MEDS",{setFunction:this.setPatientEnteredDataInd,type:"BOOLEAN",field:"FREETEXT_DESC"});
this.addFilterMappingObject("WF_HOME_MEDS_EXT_DATA_IND",{setFunction:this.setExternalDataInd,type:"BOOLEAN",field:"FREETEXT_DESC"});
this.addFilterMappingObject("WF_HM_EXT_DATA_TEST_URI",{setFunction:this.setHITestUri,type:"STRING",field:"FREETEXT_DESC"});
this.addFilterMappingObject("WF_HM_MR_HIS_IND",{setFunction:this.setMedHistory,type:"BOOLEAN",field:"FREETEXT_DESC"});
this.addFilterMappingObject("WF_HM_MR_ADM_IND",{setFunction:this.setMedRecAdmit,type:"BOOLEAN",field:"FREETEXT_DESC"});
this.addFilterMappingObject("WF_HM_MR_TRNS_IND",{setFunction:this.setMedRecTransfer,type:"BOOLEAN",field:"FREETEXT_DESC"});
this.addFilterMappingObject("WF_HM_MR_CTRNS_IND",{setFunction:this.setMedRecCrossEncTx,type:"BOOLEAN",field:"FREETEXT_DESC"});
this.addFilterMappingObject("WF_HM_MR_DSCH_IND",{setFunction:this.setMedRecDischarge,type:"BOOLEAN",field:"FREETEXT_DESC"});
this.addFilterMappingObject("WF_HOME_MEDS_REQD",{setFunction:this.setGapCheckRequiredInd,type:"BOOLEAN",field:"FREETEXT_DESC"});
this.addFilterMappingObject("WF_HOME_MEDS_HELP_TXT",{setFunction:this.setRequiredCompDisclaimerText,type:"STRING",field:"FREETEXT_DESC"});
this.addFilterMappingObject("WF_HOME_MEDS_REQ_OVR",{setFunction:this.setOverrideInd,type:"Boolean",field:"FREETEXT_DESC"});
};
HomeMedicationsComponent2.prototype.launchMedicationReconciliation=function(compId,recMode,venueCode){var component=MP_Util.GetCompObjById(compId);
var criterion=component.getCriterion();
var mrObject={};
try{MP_Util.LogDiscernInfo(this,"ORDERS","homemedications-o2.js","launchMedicationReconciliation");
mrObject=window.external.DiscernObjectFactory("ORDERS");
mrObject.PersonId=criterion.person_id;
mrObject.EncntrId=criterion.encntr_id;
mrObject.reconciliationMode=recMode;
mrObject.defaultVenue=venueCode;
mrObject.LaunchOrdersMode(2,0,0);
component.InsertData();
}catch(err){MP_Util.LogJSError(err,null,"homemedications.js","launchMedicationReconciliation");
alert(i18n.discernabu.homemeds_o2.ERROR_MEDS_REC);
}};
HomeMedicationsComponent2.prototype.satisfierRequirement=function(){var compID=this.getComponentId();
var component=MP_Util.GetCompObjById(compID);
var medRecStatusReply=component.getMedStatusData();
var isSatisfied=medRecStatusReply.MEDREC_DISCHARGE_STATUS.STATUS_FLAG===0?true:false;
return isSatisfied;
};
HomeMedicationsComponent2.prototype.updateSatisfierRequirementIndicator=function(){if(this.getGapCheckRequiredInd()){var component=this;
var isRequirementSatisfied=component.satisfierRequirement();
this.setSatisfiedInd(isRequirementSatisfied);
CERN_EventListener.fireEvent(this,this,EventListener.EVENT_SATISFIER_UPDATE,{satisfied:isRequirementSatisfied});
component.updateComponentRequiredIndicator();
}};
HomeMedicationsComponent2.prototype.preProcessing=function(){this.setOutsideRecordsInd(this.isPatientEnteredDataDisplayEnabled());
this.setDisplayHiDataInd(this.getExternalDataInd()&&!this.getPatientEnteredDataInd());
var compMenu=this.getMenu();
var hmi18n=i18n.discernabu.homemeds_o2;
var mnuDisplay="";
var compID=this.getComponentId();
var style=this.getStyles();
var groupNum=-1;
var groupLen=this.m_grouper_arr.length;
var firstGroupingLabel="";
var uniqueComponentId=style.getId();
var pageLevelFilters=null;
var groupingApplied=false;
var self=this;
var z=0;
if(compMenu){var compMenuSequence=new Menu("compMenuSequence"+compID);
var compMenuInfoButton=new MenuSelection("compMenuInfoButton"+compID);
var compMenuSeperator=new MenuSeparator("compMenuSeperator"+compID);
var compMenuRenew=new MenuSelection("compMenuRenew"+compID);
var compMenuCancel=new MenuSelection("compMenuCancel"+compID);
var compMenuComplete=new MenuSelection("compMenuComplete"+compID);
var compMenuReset=new MenuSelection("compMenuReset"+compID);
var compMenuGoto=new MenuSelection("compMenuGoto"+compID);
var compMenuSign=new MenuSelection("compMenuSign"+compID);
compMenuSequence.setLabel(hmi18n.SEQUENCEBY);
compMenuSequence.setAnchorConnectionCorner(["top","left"]);
compMenuSequence.setContentConnectionCorner(["top","right"]);
compMenuSequence.setIsDisabled(false);
compMenu.addMenuItem(compMenuSequence);
if(self.hasInfoButton()){compMenuInfoButton.setLabel(i18n.discernabu.INFO_BUTTON);
compMenu.addMenuItem(compMenuInfoButton);
this.compMenuReference[compMenuInfoButton.getId()]=compMenuInfoButton;
}compMenuInfoButton.setClickFunction(function(clickEvent){clickEvent.id="mnuInfoButton"+compID;
CERN_HOME_MEDS_O2.callInfoButtonClick(clickEvent);
});
compMenu.addMenuItem(compMenuSeperator);
compMenuRenew.setLabel(hmi18n.MED_RENEW);
compMenu.addMenuItem(compMenuRenew);
compMenuRenew.setIsDisabled(true);
this.compMenuReference[compMenuRenew.getId()]=compMenuRenew;
compMenuCancel.setLabel(hmi18n.MED_CANCEL);
compMenu.addMenuItem(compMenuCancel);
compMenuCancel.setIsDisabled(true);
this.compMenuReference[compMenuCancel.getId()]=compMenuCancel;
compMenuComplete.setLabel(hmi18n.MED_COMPLETE);
compMenu.addMenuItem(compMenuComplete);
compMenuComplete.setIsDisabled(true);
this.compMenuReference[compMenuComplete.getId()]=compMenuComplete;
compMenuReset.setLabel(hmi18n.MED_RESET);
compMenu.addMenuItem(compMenuReset);
compMenuReset.setIsDisabled(true);
this.compMenuReference[compMenuReset.getId()]=compMenuReset;
compMenuGoto.setLabel(hmi18n.MED_GTO);
compMenu.addMenuItem(compMenuGoto);
compMenuGoto.setIsDisabled(true);
this.compMenuReference[compMenuGoto.getId()]=compMenuGoto;
compMenuSign.setLabel(hmi18n.MED_SIGN);
compMenu.addMenuItem(compMenuSign);
compMenuSign.setIsDisabled(true);
this.compMenuReference[compMenuSign.getId()]=compMenuSign;
compMenuRenew.setClickFunction(function(clickEvent){clickEvent.id="mnuRenew"+compID;
CERN_HOME_MEDS_O2.callQueueOrder(clickEvent);
});
compMenuCancel.setClickFunction(function(clickEvent){clickEvent.id="medCnclBtn"+compID;
CERN_HOME_MEDS_O2.callQueueOrder(clickEvent);
});
compMenuComplete.setClickFunction(function(clickEvent){clickEvent.id="medCmpltBtn"+compID;
CERN_HOME_MEDS_O2.callQueueOrder(clickEvent);
});
compMenuReset.setClickFunction(function(clickEvent){clickEvent.id="mnuRnwReset"+compID;
CERN_HOME_MEDS_O2.callResetRows(clickEvent);
});
compMenuGoto.setClickFunction(function(clickEvent){clickEvent.id="mnuGtOrders"+compID;
CERN_HOME_MEDS_O2.callSignMedMods(clickEvent);
});
compMenuSign.setClickFunction(function(clickEvent){clickEvent.id="mnuSign"+compID;
CERN_HOME_MEDS_O2.callSignMedMods(clickEvent);
});
var bedrockFlag=0;
for(var i=0;
i<10;
i++){if(self.getGrouperLabel(i)){bedrockFlag=1;
break;
}}if(bedrockFlag===0){compMenu.removeMenuItem(compMenuSequence);
compMenu.removeMenuItem(compMenuSeperator);
}if(self.getGrouperFilterLabel()){mnuDisplay=self.getGrouperFilterLabel();
groupingApplied=true;
}var groupingFilterItem;
if(groupLen>0){groupingFilterItem=new MenuSelection("groupingFilterItem"+uniqueComponentId+"-"+10);
groupingFilterItem.setLabel(hmi18n.DEFAULT);
compMenuSequence.addMenuItem(groupingFilterItem);
groupingFilterItem.setClickFunction(CERN_HOME_MEDS_O2.createFilterClickFunction(groupingFilterItem,10,compID));
if(mnuDisplay===""){groupingFilterItem.setIsSelected(true);
}}for(z=0,c=0;
c<groupLen&&z<10;
z++){var currentLabel=self.getGrouperLabel(z);
if(currentLabel){c++;
groupingFilterItem=new MenuSelection("groupingFilterItem"+uniqueComponentId+"-"+z);
groupingFilterItem.setLabel(currentLabel);
if(currentLabel===mnuDisplay){groupingFilterItem.setIsSelected(true);
}groupingFilterItem.setClickFunction(CERN_HOME_MEDS_O2.createFilterClickFunction(groupingFilterItem,z,compID));
compMenuSequence.addMenuItem(groupingFilterItem);
}}var groupingFilterNonCatItem=new MenuSelection("groupingFilterNonCatItem"+uniqueComponentId+"-"+groupLen+1);
groupingFilterNonCatItem.setLabel(hmi18n.NON_CATEGORIZED);
if(hmi18n.NON_CATEGORIZED===mnuDisplay){groupingFilterNonCatItem.setIsSelected(true);
}var resourceName=this.getCriterion().category_mean+"pageLevelFilters";
var pageLevelFilters=MP_Resources.getSharedResource(resourceName);
if(pageLevelFilters&&pageLevelFilters.isResourceAvailable()){var plFilters=pageLevelFilters.getResourceData();
var plFiltersLen=plFilters.length;
if(plFiltersLen>0){for(var index=0;
index<plFiltersLen;
index++){var filterObj=plFilters[index];
switch(filterObj.F_MN){case"WF_HI_LOOKUP_KEY":this.setHILookupKey(filterObj.VALS[0].FTXT);
break;
case"WF_HI_ALIAS_TYPE":this.setAliasType(filterObj.VALS[0].FTXT);
break;
case"WF_HI_ALIAS_POOL_CD":this.setAliasPoolCd(filterObj.VALS[0].PE_ID);
break;
}}}}groupingFilterNonCatItem.setClickFunction(CERN_HOME_MEDS_O2.createFilterClickFunction(groupingFilterNonCatItem,groupLen+1,compID));
compMenuSequence.addMenuItem(groupingFilterNonCatItem);
MP_MenuManager.updateMenuObject(compMenu);
self.m_compMenuSequence=compMenuSequence;
}if(self.getExternalDataInd()){self.authenticateExternalDataAccess();
}};
HomeMedicationsComponent2.prototype.authenticateExternalDataAccess=function(){var component=this;
var authStatus=new Mfa_Auth().RetrieveMfaAuthStatus();
var authStatusData;
var status=4;
var disableExternalData=function(status,message){component.setMfaBanner(status,message);
component.setExternalDataInd(false);
component.setDisplayHiDataInd(false);
};
if(authStatus.isResourceAvailable()){authStatusData=authStatus.getResourceData();
if(authStatusData){status=authStatusData.status;
if(status!==0&&status!==5){disableExternalData(status,authStatusData.message);
}}}else{disableExternalData(status,i18n.discernabu.mfa_auth.MFA_ERROR_MSG);
}component.auditMfaAuth(status);
};
HomeMedicationsComponent2.prototype.setMfaBanner=function(status,message){var component=this;
var hmI18n=component.m_home_meds_i18n;
var alertBanner=new MPageUI.AlertBanner();
if(status===2||status===3){alertBanner.setType(MPageUI.ALERT_OPTIONS.TYPE.INFO);
}else{alertBanner.setType(MPageUI.ALERT_OPTIONS.TYPE.ERROR);
}alertBanner.setPrimaryText(message).setSecondaryText(hmI18n.MFA_RESTRICTION);
component.m_mfaBanner=alertBanner;
};
HomeMedicationsComponent2.prototype.auditMfaAuth=function(status){var component=this;
var providerID=component.getCriterion().provider_id+".0";
var mpEventAudit=new MP_EventAudit();
var dateFormatter=new mp_formatter.DateTimeFormatter(MPAGE_LOCALE);
var dateTime=new Date();
dateTime=dateFormatter.format(dateTime,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_4YEAR);
mpEventAudit.setAuditMode(0);
mpEventAudit.setAuditEventName("MPD_HOME_MEDICATIONS_MFA_ATTEMPT");
mpEventAudit.setAuditEventType("SECURITY");
mpEventAudit.setAuditParticipantType("PERSON");
mpEventAudit.setAuditParticipantRoleCd("PROVIDER");
mpEventAudit.setAuditParticipantIDType("PROVIDER_NUMBER");
mpEventAudit.setAuditParticipantID(providerID);
mpEventAudit.setAuditParticipantName("STATUS="+status+";DATE="+dateTime);
mpEventAudit.addAuditEvent();
mpEventAudit.submit();
};
var CERN_HOME_MEDS_O2=function(){var m_df=null;
return{createFilterClickFunction:function(menuItem,index,compID){return function(){var defaultFilterIndex=10;
var self=MP_Util.GetCompObjById(compID);
var compMenuArr=self.m_compMenuSequence?self.m_compMenuSequence.getMenuItemArray():null;
var compMenuArrLength=compMenuArr?compMenuArr.length:0;
for(var a=compMenuArrLength;
a--;
){compMenuArr[a].setIsSelected(false);
}menuItem.setIsSelected(true);
if(index==defaultFilterIndex){firstGroupingLabel="";
CERN_HOME_MEDS_O2.ShowLoadingImage(compID);
CERN_HOME_MEDS_O2.DisplayAllData(compID,-1,firstGroupingLabel);
}else{var grouperCriteria=self.getGrouperCriteria(index);
var recordData=self.getAllData();
self.setGrouperFilterLabel(menuItem.getLabel());
self.setGrouperFilterCriteria(grouperCriteria);
CERN_HOME_MEDS_O2.ShowLoadingImage(compID);
MP_Core.AppUserPreferenceManager.UpdateSingleCompPreferences(self,true);
if(recordData){CERN_HOME_MEDS_O2.RenderComponent(self,recordData);
CERN_HOME_MEDS_O2.initializeSidePanel(self);
}}};
},GetHomeMedications:function(component){var sendAr=[];
var criterion=component.getCriterion();
var prsnlInfo=criterion.getPersonnelInfo();
var encntrs=prsnlInfo.getViewableEncounters();
var encntrVal=(encntrs)?"value("+encntrs+")":"0.0";
var aliasType=component.getAliasType()||"^^";
var aliasPoolCd=(component.getAliasPoolCd())?component.getAliasPoolCd()+".0":"0.0";
var pageIndex=0;
var millDataInd=1;
var homeMedsInd=0;
var interopDataInd=(component.getPatientEnteredDataInd()&&component.getOutsideRecordsInd())?1:0;
var workflowInd=1;
var medStatusReplyFlag=false;
if(!component.getWasListenerAdded()){CERN_EventListener.addListener(component,EventListener.EVENT_ORDER_ACTION,component.InsertData,component);
component.setWasListenerAdded(true);
}if(component.getMedHistory()||component.getMedRecAdmit()||component.getMedRecDischarge()||component.getMedRecTransfer()||component.getMedRecCrossEncTx()){medStatusReplyFlag=true;
}var hiTestURI="^^";
var lookupKey="^^";
if(component.getExternalDataInd()){hiTestURI=("^"+component.getHITestUri()+"^");
lookupKey=("^"+component.getHILookupKey()+"^");
}sendAr.push("^MINE^",criterion.person_id+".0",encntrVal,criterion.provider_id+".0",component.getScope(),criterion.ppr_cd+".0",homeMedsInd,lookupKey,aliasType,aliasPoolCd,hiTestURI,pageIndex,millDataInd,interopDataInd,workflowInd);
var request=new MP_Core.ScriptRequest(component,component.getComponentLoadTimerName());
request.setProgramName("MP_GET_HOME_MEDS_JSON");
request.setParameters(sendAr);
request.setAsync(true);
component.m_base=new MPageComponents.HomeMedicationsBase(component);
component.m_base.setCriterion(criterion);
component.setInitialRenew(true);
if(component.m_millDataInd){MP_Core.XMLCCLRequestCallBack(component,request,function(reply){var recordData=reply.getResponse();
if(recordData.STATUS_DATA.STATUS!=="S"&&recordData.STATUS_DATA.STATUS!=="Z"){var error=new Error("MP_GET_HOME_MEDS_JSON status failure");
MP_Util.LogJSError(error,component,"homemedications-o2.js","GetHomeMedications");
throw error;
}if((component.getMedRec()&&medStatusReplyFlag)||component.getGapCheckRequiredInd()){var statusScriptRequest=new ComponentScriptRequest();
statusScriptRequest.setProgramName("MP_GET_MED_STATUS");
statusScriptRequest.setParameterArray(["^MINE^",criterion.person_id+".0",criterion.encntr_id+".0",criterion.provider_id+".0",criterion.ppr_cd+".0"]);
statusScriptRequest.setComponent(component);
statusScriptRequest.setName("GetMedsStatusData");
statusScriptRequest.setResponseHandler(function(scriptReply){if(scriptReply.getStatus()==="S"){component.setMedStatusData(scriptReply.getResponse());
}component.HandleSuccess(reply.getResponse());
});
statusScriptRequest.performRequest();
}else{component.HandleSuccess(reply.getResponse());
}});
}else{MP_Core.XMLCCLRequestCallBack(component,request,function(reply){var compId=component.getComponentId();
var response=reply.getResponse();
var errMsg=[];
try{var status=response.STATUS_DATA.SUBEVENTSTATUS[0].OPERATIONSTATUS;
if(status==="S"){var allData=component.getAllData();
allData.HIURI=response.HIURI;
allData.HTTPREPLY=response.HTTPREPLY;
component.setAllData(response);
var hasExtDataProcessedSuccessfully=CERN_HOME_MEDS_O2.processExtDataForRender(component);
if(hasExtDataProcessedSuccessfully){component.m_externalDataTable.bindData(component.externalHomeMed.groups);
component.m_externalDataTable.refresh();
component.m_millDataInd=1;
}else{errMsg=[];
errMsg.push("Error in retriving external data");
$("#hml2"+compId+"externaldata").html(MP_Util.HandleErrorResponse("",errMsg.join("<br/>")));
component.m_millDataInd=1;
}}else{errMsg=[];
errMsg.push("Error in retriving external data");
$("#hml2"+compId+"externaldata").html(MP_Util.HandleErrorResponse("",errMsg.join("<br/>")));
component.m_millDataInd=1;
}}catch(err){MP_Util.LogJSError(err,null,"homemedications.js","HealtheIntent data pagination");
errMsg=[];
errMsg.push("Error in retriving external data");
$("#hml2"+compId+"externaldata").html(MP_Util.HandleErrorResponse("",errMsg.join("<br/>")));
component.m_millDataInd=1;
}finally{$("#hiDataHomeMedication"+compId+"table").find(".loading-screen").remove();
}});
}},RenderComponent:function(component,recordData){var criterion=component.getCriterion();
var ipath=criterion.static_content;
var medCompId=component.getComponentId();
component.m_sidePanelShowing=false;
try{var sHTML="";
var countText="";
var jsHTML=[];
var currentDate=new Date();
var meds=[];
var medCnt=0;
var codeArray=MP_Util.LoadCodeListJSON(recordData.CODES);
var personnelArray=MP_Util.LoadPersonelListJSON(recordData.PRSNL);
var df=CERN_HOME_MEDS_O2.getDateFormatter();
var hmI18n=i18n.discernabu.homemeds_o2;
component.m_medModObj.jsonRoutes=null;
component.setCompliance(false);
var imgType="";
var imgClass="";
var edtCls="";
var catCodeList="";
var modHTML="";
var displayMedsRec=component.getMedRec();
var componentId=component.getComponentId();
component.setAllData(recordData);
CERN_HOME_MEDS_O2.DisplayAllData(componentId);
var rootNode=component.getRootComponentNode();
var lookBackContainer=$(rootNode).find(".sec-hd");
var healthPlanSelectorEle=lookBackContainer.find(".hm-healthplan-selector");
if(healthPlanSelectorEle.length){healthPlanSelectorEle.remove();
}if(component.hasInfoButton()&&component.isInfoButtonEnabled()){CERN_HOME_MEDS_O2.enableInfoButtonClick(component);
}if(recordData.ORDERS.length>0){if(component.isMedModInd()){Util.addEvent(_g("medRnwBtn"+medCompId),"click",CERN_HOME_MEDS_O2.queueOrder);
Util.addEvent(_g("medCnclBtn"+medCompId),"click",CERN_HOME_MEDS_O2.queueOrder);
Util.addEvent(_g("medCmpltBtn"+medCompId),"click",CERN_HOME_MEDS_O2.queueOrder);
var medModRootId="hml2"+medCompId;
var medCompSec=_g(medModRootId);
medCompSec.onselectstart=function(){return false;
};
component.addMenuOption("mnuRenew","mnuRenew"+medCompId,hmI18n.MED_RENEW_RX,true,"click",CERN_HOME_MEDS_O2.queueOrder);
component.addMenuOption("mnuCancel","mnuCancel"+medCompId,hmI18n.MED_CANCEL,true,"click",CERN_HOME_MEDS_O2.queueOrder);
component.addMenuOption("mnuComplete","mnuComplete"+medCompId,hmI18n.MED_COMPLETE,true,"click",CERN_HOME_MEDS_O2.queueOrder);
component.addMenuOption("mnuRnwReset","mnuRnwReset"+medCompId,hmI18n.MED_RESET,true,"click",CERN_HOME_MEDS_O2.resetRows);
component.addMenuOption("mnuGtOrders","mnuGtOrders"+medCompId,hmI18n.MED_GTO,true,"click",CERN_HOME_MEDS_O2.signMedMods);
component.addMenuOption("mnuSign","mnuSign"+medCompId,hmI18n.MED_SIGN,true,"click",CERN_HOME_MEDS_O2.signMedMods);
component.createMenu();
Util.addEvent(_g("medSgnBtn"+medCompId),"click",CERN_HOME_MEDS_O2.signMedMods);
}CERN_HOME_MEDS_O2.bindMedRowSelection(component);
component.setEditMode(false);
}if(component.getDisplayHiDataInd()&&!component.getPatientEnteredDataInd()){var hiDataControlBtn=document.getElementById("hiDataControlBtn"+component.getComponentId());
$(hiDataControlBtn).click(function(){var timer=new CapabilityTimer("CAP:MPG Display HealtheIntent Data");
timer.capture();
CERN_HOME_MEDS_O2.showHIData(component);
});
}else{if(component.getExternalDataInd()&&component.getDisplayHiDataInd()){var timer=new CapabilityTimer("CAP:MPG Display HealtheIntent Data");
timer.capture();
CERN_HOME_MEDS_O2.showHIData(component);
}}}catch(err){throw (err);
}if(!component.getOutsideRecordsInd()){$("#medStatusContainer"+medCompId).css("margin-top","0");
}},callQueueOrder:function(event){CERN_HOME_MEDS_O2.queueOrder.call(event,event);
},callResetRows:function(event){CERN_HOME_MEDS_O2.resetRows.call(event,event);
},callSignMedMods:function(event){CERN_HOME_MEDS_O2.signMedMods.call(event,event);
},callInfoButtonClick:function(event){CERN_HOME_MEDS_O2.infoButtonClick.call(event,event);
},getStatusObject:function(sCode,performedBy,performedDate,isMedsHistoryStatus){var dateFormatObj=MP_Util.GetDateFormatter();
var statusObj={};
statusObj.clsName="";
statusObj.status="";
statusObj.performedBy=performedBy?performedBy:"";
statusObj.performedDate="";
if(performedDate){var dateTime=new Date();
dateTime.setISO8601(performedDate);
statusObj.performedDate=dateFormatObj.format(dateTime,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_4YEAR);
}var hmI18n=i18n.discernabu.homemeds_o2;
switch(sCode){case 0:statusObj.clsName="complete";
statusObj.status=hmI18n.COMPLETE;
break;
case 1:if(isMedsHistoryStatus){statusObj.clsName="not-started";
statusObj.status=hmI18n.INCOMPLETE;
}else{statusObj.clsName="partial";
statusObj.status=hmI18n.PARTIAL;
}break;
case 2:statusObj.clsName="inerror";
statusObj.status=hmI18n.INERROR;
break;
case 3:statusObj.clsName="partial-inprocess";
statusObj.status=hmI18n.PENDING_PARTIAL;
break;
case 4:statusObj.clsName="partial-complete";
statusObj.status=hmI18n.PENDING_COMPLETE;
break;
case 5:statusObj.clsName="not-started";
statusObj.status=hmI18n.NOT_STARTED;
break;
default:statusObj.clsName="unknown";
statusObj.status=hmI18n.UNKNOWN;
}return statusObj;
},getInfoButtonClass:function(component){var infoIconsClass="";
var componentId=component.getComponentId();
if(component.hasInfoButton()&&component.isInfoButtonEnabled()){if(!component.compMenuReference["compMenuInfoButton"+componentId].isSelected()){component.compMenuReference["compMenuInfoButton"+componentId].setIsSelected(true);
}infoIconsClass="hml2-info-icon-col";
}else{infoIconsClass="hml2-info-icon-col hidden";
}return infoIconsClass;
},getFieldsSuggestedForChange:function(order){var modList=[];
if(order.INTEROP&&order.INTEROP.length){var interop=order.INTEROP[0];
if(interop.DOSE.STATUS){modList.push("DOSE");
}if(interop.PHYSICIAN.STATUS){modList.push("PHYSICIAN");
}if(interop.FREQUENCY.STATUS){modList.push("FREQUENCY");
}if(interop.STATUS.STATUS){modList.push("COMPLIANCE");
}}return modList;
},processHomeMedsData:function(medications,component){var hmI18n=i18n.discernabu.homemeds_o2;
var recordData=component.getAllData();
var criterion=component.getCriterion();
var ipath=criterion.static_content||"";
var infoClass="";
var codeArray=MP_Util.LoadCodeListJSON(recordData.CODES);
var personnelArray=MP_Util.LoadPersonelListJSON(recordData.PRSNL);
var df=CERN_HOME_MEDS_O2.getDateFormatter();
var imgType="";
var imgClass="";
var edtCls="";
var catCodeList="";
var modHTML="";
var bMedMod=component.isMedModInd();
var orders=[];
var interopData=null;
var orderStatus=null;
var medOrigDate=null;
var lastDoseDate=null;
var respProv=null;
var compliance=null;
var medName=null;
var medNameHover=null;
var dateTime=null;
var compComment=null;
var ordComment=null;
var provider=null;
var code=null;
var ordersMedInfo=null;
var hxInd=null;
var inOfficeIndicator=null;
var ordId=null;
var extId=0;
var priCriteriaCd=null;
var synonymId=null;
var catCode=null;
var sigLine=null;
var medsLength=medications.length;
var medCompId=component.getComponentId();
var medIdFrag=medCompId+"_";
var request=null;
var patRequestInd=null;
for(var x=0;
x<medsLength;
x++){orders=medications[x];
orderStatus=MP_Util.GetValueFromArray(orders.CORE.STATUS_CD,codeArray);
if(orderStatus&&orderStatus.meaning!=="MEDSTUDENT"){medOrigDate="--";
lastDoseDate="--";
respProv="--";
compliance="--";
compComment="--";
medName=CERN_HOME_MEDS_O2.getMedicationDisplayName(orders);
medNameHover=CERN_HOME_MEDS_O2.getMedicationDisplayNameForHover(orders);
dateTime=new Date();
if(orders.INTEROP&&orders.INTEROP.length){interopData=orders.INTEROP[0];
request=MP_Util.GetValueFromArray(interopData.REQUEST_TYPE,codeArray).meaning;
patRequestInd=1;
}else{patRequestInd=0;
}if(!patRequestInd){compComment=(orders.DETAILS.COMPLIANCE_COMMENT)?orders.DETAILS.COMPLIANCE_COMMENT:"--";
ordComment=(orders.COMMENTS.ORDER_COMMENT)?orders.COMMENTS.ORDER_COMMENT.replace(/\n/g,"<br />"):"--";
}if(orders.SCHEDULE.ORIG_ORDER_DT_TM!==""){dateTime.setISO8601(orders.SCHEDULE.ORIG_ORDER_DT_TM);
medOrigDate=df.format(dateTime,mp_formatter.DateTimeFormatter.FULL_DATE_4YEAR);
}if(!patRequestInd&&orders.DETAILS.LAST_DOSE_DT_TM!==""){dateTime.setISO8601(orders.DETAILS.LAST_DOSE_DT_TM);
lastDoseDate=df.format(dateTime,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_2YEAR);
}if(orders.CORE.RESPONSIBLE_PROVIDER_ID>0){provider=MP_Util.GetValueFromArray(orders.CORE.RESPONSIBLE_PROVIDER_ID,personnelArray);
respProv=provider.fullName;
}if(orders.INTEROP.length&&interopData.STATUS.MODIFIED_STATUS_CODE.LABEL){compliance=interopData.STATUS.MODIFIED_STATUS_CODE.LABEL;
}else{if(orders.INTEROP.length&&interopData.STATUS.STATUS_CODE.LABEL){compliance=interopData.STATUS.STATUS_CODE.LABEL;
}else{var complianceCode=MP_Util.GetValueFromArray(orders.DETAILS.COMPLIANCE_STATUS_CD,codeArray);
compliance=(complianceCode)?complianceCode.display:"--";
}}ordersMedInfo=orders.MEDICATION_INFORMATION;
hxInd=ordersMedInfo.ORIGINALLY_ORDERED_AS_TYPE.DOCUMENTED_IND;
rxInd=ordersMedInfo.ORIGINALLY_ORDERED_AS_TYPE.PRESCRIPTION_IND;
inOfficeIndicator=ordersMedInfo.ORIGINALLY_ORDERED_AS_TYPE.SATELLITE_IND;
ordId=ordersMedInfo.ORDER_ID;
if(orders.INTEROP.length>=1){extId=interopData.EXT_DATA_INFO_ID;
}priCriteriaCd=ordersMedInfo.PRIMARY_CRITERIA_CD;
synonymId=ordersMedInfo.SYNONYM_ID;
imgType="3796_16.png";
imgClass="hml2-hx";
edtCls="-hx";
if(rxInd===1){imgType="4969_16.png";
imgClass="hml2-rx";
edtCls="";
}else{if(inOfficeIndicator===1){imgType="5635.gif";
imgClass="hml2-sx";
edtCls="";
}}if(bMedMod){component.m_medModObj.medModCompId=medCompId;
component.m_medModObj.medModIdFrag=medIdFrag;
catCode=ordersMedInfo.CATALOG_CD;
sigLine="";
if(!patRequestInd&&catCode){catCodeList+=catCode+":";
}modHTML='<span class="hml2-sig detail-line disp-rfl-cnt"></span><span class="hml2-dur"></span><span class="hml2-disp-qty-cd"></span><span class="hml2-cat-cd">'+catCode+"</span>";
}switch(request){case"ADD":orders.PAT_REQUEST_DISPLAY="<span>"+hmI18n.ADD+"</span>";
break;
case"UPDATE":orders.PAT_REQUEST_DISPLAY="<span>"+hmI18n.MODIFY+"</span>";
break;
default:orders.PAT_REQUEST_DISPLAY="<span>--</span>";
}if(!request){orders.INFO_ICON_DISPLAY='<div class ="hml2-info-icon-div"><span data-patId="'+criterion.person_id+'" data-encId="'+criterion.encntr_id+'" data-synonymId="'+synonymId+'" data-priCriteriaCd="'+priCriteriaCd+'" class="hml2-info-icon">&nbsp;</span></div>';
}else{orders.INFO_ICON_DISPLAY='<div class ="hml2-info-icon-div"></div>';
}var orderInfoId="hml2Info"+medIdFrag+ordId;
var rxIconHtml='<span class="hml2-rx-hx"><img src="'+ipath+"/images/"+imgType+'" alt="" class="'+imgClass+'"/></span>';
orders.MEDICATION_DISPLAY=rxIconHtml+'<span class="hml2-info" data-synonymId = "'+synonymId+'" data-order-id = "'+ordId+'"ext-data-info-id="'+extId+'" data-pat-request-ind="'+patRequestInd+'" id = "'+orderInfoId+'"><span class="hml2-name">'+medName+'</span><span class="hml2-sig detail-line">'+orders.DISPLAYS.SIMPLIFIED_DISPLAY_LINE+modHTML+"</span></span>";
orders.MEDICATION_TEXT=orders.DISPLAYS.DISPLAY_NAME;
orders.MED_ORDER_HOVER=['<h4 class="det-hd"><span>'+hmI18n.MED_DETAIL+"</span></h4>",'<dl class="hml2-hover">',"<dt><span>"+hmI18n.HOME_MEDICATION+"</span></dt>","<dd><span>"+medNameHover+"</span></dd>","<dt><span>"+hmI18n.ORDER_DETAILS+"</span></dt>","<dd><span>"+orders.DISPLAYS.CLINICAL_DISPLAY_LINE+"</span></dd>","<dt><span>"+hmI18n.ORDER_COMMENT+"</span></dt>","<dd><span>"+ordComment+"</span></dd>","<dt><span>"+hmI18n.ORDER_DATE+"</span></dt>","<dd><span>"+medOrigDate+"</span></dd>","<dt><span>"+hmI18n.RESPONSIBLE_PROVIDER+"</span></dt>","<dd><span>"+respProv+"</span></dd>","<dt><span>"+hmI18n.TYPE+"</span></dt>","<dd><span>"+CERN_HOME_MEDS_O2.getHomeMedicationType(orders)+"</span></dd>","</dl>"].join("");
if(lastDoseDate){orders.LAST_DOSE_DATE_DISPLAY="<span>"+lastDoseDate+"</span>";
}else{orders.LAST_DOSE_DATE_DISPLAY="<span>--</span>";
}orders.COMPLIANCE_DISPLAY="<span>"+compliance+"</span>";
orders.COMP_COMMENT_DISPLAY="<span>"+compComment+"</span>";
orders.FORMULARY_DISPLAY="";
}}component.m_medModObj.catCodeList+=catCodeList;
},createMedsHistoryHTML:function(component,requestType,order){var displayHTML="";
var hmI18n=component.m_home_meds_i18n;
var componentId=component.getComponentId();
if(requestType==="ADD"){displayHTML="<dd>"+hmI18n.ADD_THIS_MEDICATION_WITHIN+' <a class="pat-req-meds-hx-link" id="addPatRequest'+componentId+'">'+hmI18n.MEDS_HISTORY+".</a></dd>";
}else{if(requestType==="UPDATE"){var originalComplianceDisplay="--";
if(order.DETAILS.COMPLIANCE_STATUS_CD){var codeArray=MP_Util.LoadCodeListJSON(component.getAllData().CODES);
var originalCompliance=MP_Util.GetValueFromArray(order.DETAILS.COMPLIANCE_STATUS_CD,codeArray);
originalComplianceDisplay=(originalCompliance)?originalCompliance.display:"--";
}var modifiedMeds=CERN_HOME_MEDS_O2.getFieldsSuggestedForChange(order);
var modifiedMedsCount=modifiedMeds.length;
displayHTML+="<dd>"+hmI18n.UPDATE_THIS_MEDICATION_WITHIN+' <a class="pat-req-meds-hx-link" id="addPatRequest'+componentId+'">'+hmI18n.MEDS_HISTORY+".</a></dd>";
for(var i=0;
i<modifiedMedsCount;
i++){switch(modifiedMeds[i]){case"DOSE":displayHTML+='<dd class="hml2-bullet-listed hml2-pat-req-indent">'+hmI18n.CHANGE_DOSE_FROM+' "'+(order.INTEROP[0].DOSE.DOSE||"--")+'" '+hmI18n.TO+' "'+(order.INTEROP[0].DOSE.MODIFIED_DOSE||"--")+'" ';
break;
case"PHYSICIAN":displayHTML+='<dd class="hml2-bullet-listed hml2-pat-req-indent">'+hmI18n.CHANGE_PHYSICIAN_FROM+' "'+(order.INTEROP[0].PHYSICIAN.PHYSICIAN||"--")+'" '+hmI18n.TO+' "'+(order.INTEROP[0].PHYSICIAN.MODIFIED_PHYSICIAN||"--")+'" ';
break;
case"FREQUENCY":displayHTML+='<dd class="hml2-bullet-listed hml2-pat-req-indent">'+hmI18n.CHANGE_FREQUENCY_FROM+' "'+(order.INTEROP[0].FREQUENCY.FREQUENCY||"--")+'" '+hmI18n.TO+' "'+(order.INTEROP[0].FREQUENCY.MODIFIED_FREQUENCY||"--")+'" ';
break;
case"COMPLIANCE":displayHTML+='<dd class="hml2-bullet-listed hml2-pat-req-indent">'+hmI18n.CHANGE_COMPLIANCE_FROM+' "'+originalComplianceDisplay+'" '+hmI18n.TO+' "'+(order.INTEROP[0].STATUS.MODIFIED_STATUS_CODE.LABEL||"--")+'" ';
break;
}displayHTML+="</dd>";
}}}return displayHTML;
},launchMedsHistory:function(component){var criterion=component.getCriterion();
try{MP_Util.LogDiscernInfo(component,"POWERORDERS","homemedications-o2.js","medsHistory");
var PowerOrdersMPageUtils=window.external.DiscernObjectFactory("POWERORDERS");
var m_dPersonId=criterion.person_id;
var m_dEncounterId=criterion.encntr_id;
var m_hMOEW=PowerOrdersMPageUtils.CreateMOEW(m_dPersonId,m_dEncounterId,0,4,121);
PowerOrdersMPageUtils.DisplayMOEW(m_hMOEW);
PowerOrdersMPageUtils.DestroyMOEW(m_hMOEW);
component.InsertData();
}catch(err){logger.logJSError(err,this,"homemedications-o2.js","launchMedsHistory");
}},bindMedRowSelection:function(component){var rootMedSecCont=component.getSectionContentNode();
var componentTableElt=Util.Style.g("component-table",rootMedSecCont,"div")[0];
var medRows=Util.Style.g("result-info",componentTableElt,"dl");
var mrLen=medRows.length;
for(var i=0;
i<mrLen;
i++){Util.addEvent(medRows[i],"click",CERN_HOME_MEDS_O2.medRowSel);
}},bindColumnHeaderClick:function(component){var componentTable=component.getComponentTable();
var componentId=component.getComponentId();
$("#"+componentTable.getNamespace()+"header").on("click",".sort-option",function(){var sidePanel=component.m_sidePanel;
if(sidePanel&&component.m_sidePanelShowing){sidePanel.m_cornerCloseButton.click();
}if(component.inMillennium&&component.isMedModInd()){CERN_HOME_MEDS_O2.resetActiveActions(component);
CERN_HOME_MEDS_O2.disableActions(component);
}CERN_HOME_MEDS_O2.bindMedRowSelection(component);
if(component.hasInfoButton()&&component.isInfoButtonEnabled()){$("#hml2Content"+componentId).find(".hml2-info-icon-col").removeClass("hidden");
CERN_HOME_MEDS_O2.enableInfoButtonClick(component);
}CERN_HOME_MEDS_O2.disableHeaderClick();
});
},resetActiveActions:function(component){var componentId=component.getComponentId();
var rootNode=component.getRootComponentNode();
component.setInitialRenew(true);
$("medSgnBtn"+componentId).prop("disabled",true);
component.compMenuReference["compMenuSign"+componentId].setIsDisabled(true);
$(rootNode).find(".hml2-formulary").addClass("hml2-hidden");
},createTableColumn:function(columnId,columnDisplay,sortable,primarySortField,renderTemplate,customClass){var tableColumn=new TableColumn();
tableColumn.setColumnId(columnId).setColumnDisplay(columnDisplay).setIsSortable(sortable).setPrimarySortField(primarySortField).setRenderTemplate(renderTemplate).setCustomClass(customClass);
return tableColumn;
},toggleTableCellHover:function(component,enableHoverFlag,target){var componentId=component.getComponentId();
var hoverExtension=component.getTableHoverExtension();
var hoverTemplate=null;
var tableColumns=component.getComponentTable().getColumns();
var tableColumnsCnt=tableColumns.length;
var tableColumn=null;
var infoIconId="infoICon"+componentId;
var requestId="request"+componentId;
var formularyId="formulary"+componentId;
var i=0;
var tableRow=target.parent();
var rowId=tableRow.attr("id");
var selectors="#"+rowId+":"+infoIconId+",#"+rowId+":"+requestId+",#"+rowId+":"+formularyId;
var allCells=target.siblings().add(target);
var noHoverCells=allCells.filter(selectors.replace(/:/g,"\\:"));
if(enableHoverFlag){hoverTemplate=function(data){return"<span>"+data.RESULT_DATA.MED_ORDER_HOVER+"</span>";
};
var marginHeight=null;
noHoverCells.each(function(){marginHeight=parseInt($(this).css("margin-top"))+parseInt($(this).css("margin-bottom"));
$(this).css({height:(tableRow.height()-marginHeight)+"px","background-color":tableRow.css("background-color")});
});
tableRow.addClass("mpage-tooltip-hover");
}else{hoverTemplate="";
tableRow.removeClass("mpage-tooltip-hover");
target.removeClass("mpage-tooltip-hover");
noHoverCells.each(function(){$(this).css({height:$(this).children().css("height"),"background-color":"transparent"});
});
}for(i=0;
i<tableColumnsCnt;
i++){tableColumn=tableColumns[i];
if(tableColumn.getColumnId()!==infoIconId){hoverExtension.addHoverForColumn(tableColumn,hoverTemplate);
}}},createTableCellHover:function(component,medicationColumn,lastDoseColumn,complianceColumn,compCommentColumn,formularyColumn){var componentId=component.getComponentId();
var medsComponentTable=component.getComponentTable();
var hoverTemplateFn=function(data){return"<span>"+data.RESULT_DATA.MED_ORDER_HOVER+"</span>";
};
var hoverExtension=new TableCellHoverExtension();
hoverExtension.addHoverForColumn(medicationColumn,hoverTemplateFn);
hoverExtension.addHoverForColumn(lastDoseColumn,hoverTemplateFn);
hoverExtension.addHoverForColumn(complianceColumn,hoverTemplateFn);
hoverExtension.addHoverForColumn(compCommentColumn,hoverTemplateFn);
hoverExtension.addHoverForColumn(formularyColumn,hoverTemplateFn);
hoverExtension.setOnHoverCallback(function(event){var $target=$("#"+event.currentTarget.id.replace(/:/g,"\\:"));
var enableHoverFlag;
var $componentTable=$("#hml2"+componentId+"tableBody");
var selectedTableRows=$componentTable.find(".hml2-med-selected").length;
var renewTableRows=$componentTable.find(".hml2-rnwd").length;
var cancelTableRows=$componentTable.find(".hml2-cncld").length;
var completeTableRows=$componentTable.find(".hml2-cmplt").length;
var patRequestInd=$target.parent().find(".hml2-info").attr("data-pat-request-ind");
if(selectedTableRows||renewTableRows||cancelTableRows||completeTableRows||parseInt(patRequestInd,10)){enableHoverFlag=false;
CERN_HOME_MEDS_O2.toggleTableCellHover(component,enableHoverFlag,$target);
}else{enableHoverFlag=true;
CERN_HOME_MEDS_O2.toggleTableCellHover(component,enableHoverFlag,$target);
}});
hoverExtension.setOnLeaveCallback(function(event){var $target=$("#"+event.currentTarget.id.replace(/:/g,"\\:"));
CERN_HOME_MEDS_O2.toggleTableCellHover(component,false,$target);
});
return hoverExtension;
},createExternalDataControl:function(component,displayError){var externalDataImgUrl=null;
var externalDataImgSpan=null;
var externalDataTitleSpan=null;
var externalDataBtnSpan=null;
if(displayError){externalDataImgUrl=component.getCriterion().static_content+"/images/6965.png";
externalDataImgSpan="<span><img height='22' width='22' style='float:left' id='externalData' src= '"+externalDataImgUrl+"'></span>";
externalDataTitleSpan="<span style='margin-left:5px; padding-top:5px; font-weight: bold;'>"+i18n.discernabu.homemeds_o2.EXTERNAL_DATA_LABEL_ERR+"</span>";
externalDataBtnSpan="<span style='float:right'><button class='hml2-hi-ext-btn' id='hiDataControlBtn"+component.getComponentId()+"' style='display: none'>"+i18n.discernabu.homemeds_o2.VIEW_OUTSIDE_RECORDS+"</button></span>";
}else{externalDataImgUrl=component.getCriterion().static_content+"/images/6965.png";
externalDataImgSpan="<span><img height='22' width='22' style='float:left' id='externalData' src= '"+externalDataImgUrl+"'></span>";
externalDataTitleSpan="<span style='margin-left:5px; padding-top:5px;font-weight: bold;'>"+i18n.discernabu.homemeds_o2.EXTERNAL_DATA_LABEL+"</span>";
externalDataBtnSpan="<span style='float:right'><button class='hml2-hi-ext-btn' id='hiDataControlBtn"+component.getComponentId()+"'>"+i18n.discernabu.homemeds_o2.VIEW_OUTSIDE_RECORDS+"</button></span>";
}var showExternalDataContainer="<div id=hiAddDataContainer"+component.getComponentId()+" class='hml2-hi-ext-label'>"+externalDataImgSpan+externalDataTitleSpan+externalDataBtnSpan+"</div>";
return showExternalDataContainer;
},DisplayAllData:function(componentId,groupNum,sortName){try{var parentDiv=_g("grouperSelect"+componentId)||{};
if(!groupNum||groupNum==-1||parentDiv.selectedVal!=groupNum){var component=MP_Util.GetCompObjById(componentId);
component.setInitialRenew(true);
var criterion=component.getCriterion();
var recordData=component.getAllData();
var medCompId=componentId;
var hmI18n=i18n.discernabu.homemeds_o2;
var medsContainer=[];
var compNS=component.getStyles().getNameSpace();
var displayMedsRec=component.getMedRec();
var medStatusReply=component.getMedStatusData();
if(isFinite(groupNum)){if(groupNum==-1){MP_Core.AppUserPreferenceManager.ClearCompPreferences(componentId);
component.setGrouperFilterLabel("");
}}var personnelArray=MP_Util.LoadPersonelListJSON(recordData.PRSNL);
var venueAdm=0;
var venueDisch=0;
var medRecHtml="";
var medRecHtmlStatus="";
var medHxStatusHtml="";
var mrAdmnStatusHtml="";
var mrTransferStatusHtml="";
var mrCrxEncntrTxStatusHtml="";
var mrDischargeStatusHtml="";
var medRecFiltersFlag=false;
var outsideRecsChkbox="";
var segmentedControl=null;
var segmentedControlDisplay="";
var medrecLinkSeperatorFlag="";
if(component.getPatientEnteredDataInd()){var patRequestCheckedAttr=(component.getOutsideRecordsInd())?"checked":"";
outsideRecsChkbox='<div class ="hml2-pull-right"><dl class="hml2-outside-recs-action"><dd><label ><input type="checkbox" '+patRequestCheckedAttr+' name="view-outside-rec-chk" id="hml2-outside-recs-checkbox'+componentId+'" />'+hmI18n.VIEW_OUTSIDE_RECORDS+"</label></dd></dl></div>";
}else{if(component.getExternalDataInd()){component.setOutsideRecordsInd(true);
}}if(medStatusReply&&criterion.encntr_id!==0){if(component.getMedHistory()){var medsHistStatusObj=CERN_HOME_MEDS_O2.getStatusObject(-1);
if(medStatusReply){medsHistStatusObj=CERN_HOME_MEDS_O2.getStatusObject(medStatusReply.MEDS_HIST_STATUS.STATUS_FLAG,medStatusReply.MEDS_HIST_STATUS.PERFORMED_PRSNL_NAME,medStatusReply.MEDS_HIST_STATUS.PERFORMED_DATE,true);
}if(component.inMillennium){medHxStatusHtml="<h3 class='info-hd'>"+hmI18n.STATUS+"</h3><dl class='"+compNS+"-status result-info'><dd class='"+compNS+"-status-img "+medsHistStatusObj.clsName+"'>&nbsp;</dd><dd><a id='medsHistory"+componentId+"'>"+hmI18n.MEDS_HISTORY+"</a></dd></dl><div class='result-details hover'><h4 class='det-hd'><span>"+hmI18n.STATUS+"</span></h4><dl class='"+compNS+"-det'><dt><span>"+hmI18n.STATUS+":</span></dt><dd><span>"+medsHistStatusObj.status+"</span></dd><dt><span>"+hmI18n.LAST_DOCUMENTED+":</span></dt><dd><span>"+medsHistStatusObj.performedDate+"</span></dd><dt><span>"+hmI18n.LAST_DOC_BY+":</span></dt><dd><span>"+medsHistStatusObj.performedBy+"</span></dd></dl></div>";
}else{medHxStatusHtml="<h3 class='info-hd'>"+hmI18n.STATUS+"</h3><dl class='"+compNS+"-status'><dd class='"+compNS+"-status-img meds-hist-status "+medsHistStatusObj.clsName+"'>&nbsp;</dd><dd>"+hmI18n.MEDS_HISTORY+"</dd></dl>";
}medRecHtml+=medHxStatusHtml;
medrecLinkSeperatorFlag=compNS+"-medrec-link-seperator";
medRecFiltersFlag=true;
}if(component.getMedRecAdmit()){var mrAdmissionStatusObj=CERN_HOME_MEDS_O2.getStatusObject(-1);
var admissionTitle=MP_Util.GetCodeValueByMeaning("ADMISSION",4003029);
var medRecAdmitTitle="";
if(admissionTitle){medRecAdmitTitle=admissionTitle.display;
}else{medRecAdmitTitle=hmI18n.ADMISSION_MEDREC;
}if(medStatusReply){mrAdmissionStatusObj=CERN_HOME_MEDS_O2.getStatusObject(medStatusReply.MEDREC_ADMISSION_STATUS.STATUS_FLAG,medStatusReply.MEDREC_ADMISSION_STATUS.PERFORMED_PRSNL_NAME,medStatusReply.MEDREC_ADMISSION_STATUS.PERFORMED_DATE);
venueAdm=medStatusReply.VENUE_CODE.ADMISSION;
}if(component.inMillennium){mrAdmnStatusHtml="<h3 class='info-hd'>"+hmI18n.STATUS+"</h3><dl class='"+compNS+"-status result-info'><dd class="+medrecLinkSeperatorFlag+">&nbsp;</dd><dd class='"+compNS+"-status-img "+mrAdmissionStatusObj.clsName+"'>&nbsp;</dd><dd><a id='medRecAdmission"+componentId+"'>"+medRecAdmitTitle+"</a></dd></dl><div class='result-details hover'><h4 class='det-hd'><span>"+hmI18n.STATUS+"</span></h4><dl class='"+compNS+"-det'><dt><span>"+hmI18n.STATUS+":</span></dt><dd><span>"+mrAdmissionStatusObj.status+"</span></dd><dt><span>"+hmI18n.LAST_RECONED+":</span></dt><dd><span>"+mrAdmissionStatusObj.performedDate+"</span></dd><dt><span>"+hmI18n.LAST_RECONED_BY+":</span></dt><dd><span>"+mrAdmissionStatusObj.performedBy+"</span></dd></dl></div>";
}else{mrAdmnStatusHtml="<h3 class='info-hd'>"+hmI18n.STATUS+"</h3><dl class='"+compNS+"-status'><dd class="+medrecLinkSeperatorFlag+">&nbsp;</dd><dd class='"+compNS+"-status-img med-rec-status "+mrAdmissionStatusObj.clsName+"'>&nbsp;</dd><dd>"+medRecAdmitTitle+"</dd></dl>";
}medRecFiltersFlag=true;
medrecLinkSeperatorFlag=compNS+"-medrec-link-seperator";
medRecHtml+=mrAdmnStatusHtml;
}if(component.getMedRecTransfer()){var mrTransferStatusObj=CERN_HOME_MEDS_O2.getStatusObject(-1);
var medRecTransferName=MP_Util.GetCodeValueByMeaning("TRANSFER",4003029);
var imgClass="";
var transferHoverHtml="";
var medRecTransferTitle="";
if(medRecTransferName){medRecTransferTitle=medRecTransferName.display;
}else{medRecTransferTitle=hmI18n.TRANSFER_MEDREC;
}if(medStatusReply){mrTransferStatusObj=CERN_HOME_MEDS_O2.getStatusObject(medStatusReply.MEDREC_TRANSFER_STATUS.STATUS_FLAG,medStatusReply.MEDREC_TRANSFER_STATUS.PERFORMED_PRSNL_NAME,medStatusReply.MEDREC_TRANSFER_STATUS.PERFORMED_DATE);
if(medStatusReply.MEDREC_TRANSFER_STATUS.CROSS_ENCNTR_IND===0){if(mrTransferStatusObj.clsName==="partial-inprocess"||mrTransferStatusObj.clsName==="partial-complete"){imgClass=compNS+"-status-img "+mrTransferStatusObj.clsName;
transferHoverHtml="<div class='result-details hover'><h4 class='det-hd'><span>"+hmI18n.STATUS+"</span></h4><dl class='"+compNS+"-det'><dt><span>"+hmI18n.STATUS+":</span></dt><dd><span>"+mrTransferStatusObj.status+"</span></dd><dt><span>"+hmI18n.LAST_RECONED+":</span></dt><dd><span>"+mrTransferStatusObj.performedDate+"</span></dd><dt><span>"+hmI18n.LAST_RECONED_BY+":</span></dt><dd><span>"+mrTransferStatusObj.performedBy+"</span></dd></dl></div>";
}}}if(component.inMillennium){mrTransferStatusHtml="<h3 class='info-hd'>"+hmI18n.STATUS+"</h3><dl class='"+compNS+"-status result-info'><dd class="+medrecLinkSeperatorFlag+">&nbsp;</dd><dd class='"+imgClass+"'>&nbsp;</dd><dd><a id='medRecTransfer"+componentId+"'>"+medRecTransferTitle+"</a></dd></dl>";
mrTransferStatusHtml+=transferHoverHtml;
}else{mrTransferStatusHtml="<h3 class='info-hd'>"+hmI18n.STATUS+"</h3><dl class='"+compNS+"-status result-info'><dd class="+medrecLinkSeperatorFlag+">&nbsp;</dd><dd class='"+imgClass+"'>&nbsp;</dd><dd>"+medRecTransferTitle+"</dd></dl>";
}medRecFiltersFlag=true;
medrecLinkSeperatorFlag=compNS+"-medrec-link-seperator";
medRecHtml+=mrTransferStatusHtml;
}if(component.getMedRecCrossEncTx()){var mrTransferStatusObj=CERN_HOME_MEDS_O2.getStatusObject(-1);
var crossEncTxName=MP_Util.GetCodeValueByMeaning("XENCTRANSFER",4003029);
var imgClass="";
var crossEncntrTxHoverHtml="";
var medRecXEncntrTxTitle="";
if(crossEncTxName){medRecXEncntrTxTitle=crossEncTxName.display;
}else{medRecXEncntrTxTitle=hmI18n.CROSS_ENCNTR_TRASNFER;
}if(medStatusReply){mrTransferStatusObj=CERN_HOME_MEDS_O2.getStatusObject(medStatusReply.MEDREC_TRANSFER_STATUS.STATUS_FLAG,medStatusReply.MEDREC_TRANSFER_STATUS.PERFORMED_PRSNL_NAME,medStatusReply.MEDREC_TRANSFER_STATUS.PERFORMED_DATE);
if(medStatusReply.MEDREC_TRANSFER_STATUS.CROSS_ENCNTR_IND===1){if(mrTransferStatusObj.clsName==="partial-inprocess"||mrTransferStatusObj.clsName==="partial-complete"){imgClass=compNS+"-status-img "+mrTransferStatusObj.clsName;
crossEncntrTxHoverHtml="<div class='result-details hover'><h4 class='det-hd'><span>"+hmI18n.STATUS+"</span></h4><dl class='"+compNS+"-det'><dt><span>"+hmI18n.STATUS+":</span></dt><dd><span>"+mrTransferStatusObj.status+"</span></dd><dt><span>"+hmI18n.LAST_RECONED+":</span></dt><dd><span>"+mrTransferStatusObj.performedDate+"</span></dd><dt><span>"+hmI18n.LAST_RECONED_BY+":</span></dt><dd><span>"+mrTransferStatusObj.performedBy+"</span></dd></dl></div>";
}}}if(component.inMillennium){mrCrxEncntrTxStatusHtml="<h3 class='info-hd'>"+hmI18n.STATUS+"</h3><dl class='"+compNS+"-status result-info'><dd class="+medrecLinkSeperatorFlag+">&nbsp;</dd><dd class='"+imgClass+"'>&nbsp;</dd><dd><a id='medRecCrossEncntrTx"+componentId+"'>"+medRecXEncntrTxTitle+"</a></dd></dl>";
mrCrxEncntrTxStatusHtml+=crossEncntrTxHoverHtml;
}else{mrCrxEncntrTxStatusHtml="<h3 class='info-hd'>"+hmI18n.STATUS+"</h3><dl class='"+compNS+"-status result-info'><dd class="+medrecLinkSeperatorFlag+">&nbsp;</dd><dd class='"+imgClass+"'>&nbsp;</dd><dd>"+medRecXEncntrTxTitle+"</dd></dl>";
}medRecFiltersFlag=true;
medrecLinkSeperatorFlag=compNS+"-medrec-link-seperator";
medRecHtml+=mrCrxEncntrTxStatusHtml;
}if(component.getMedRecDischarge()){var mrDischargeStatusObj=CERN_HOME_MEDS_O2.getStatusObject(-1);
var statusTitle="";
var medRecDischargeTitle="";
if(medStatusReply){if(medStatusReply.ENCNTR_TYPE===2){statusTitle=MP_Util.GetCodeValueByMeaning("OUTPATIENT",4003029);
if(statusTitle){medRecDischargeTitle=statusTitle.display;
}else{medRecDischargeTitle=hmI18n.OUTPATIENT_MEDREC;
}}else{statusTitle=MP_Util.GetCodeValueByMeaning("DISCHARGE",4003029);
if(statusTitle){medRecDischargeTitle=statusTitle.display;
}else{medRecDischargeTitle=hmI18n.DISCHARGE_MEDREC;
}}mrDischargeStatusObj=CERN_HOME_MEDS_O2.getStatusObject(medStatusReply.MEDREC_DISCHARGE_STATUS.STATUS_FLAG,medStatusReply.MEDREC_DISCHARGE_STATUS.PERFORMED_PRSNL_NAME,medStatusReply.MEDREC_DISCHARGE_STATUS.PERFORMED_DATE);
venueDisch=medStatusReply.VENUE_CODE.DISCHARGE;
}if(component.inMillennium){mrDischargeStatusHtml="<h3 class='info-hd'>"+hmI18n.STATUS+"</h3><dl class='"+compNS+"-status result-info'><dd class="+medrecLinkSeperatorFlag+">&nbsp;</dd><dd class='"+compNS+"-status-img "+mrDischargeStatusObj.clsName+"'>&nbsp;</dd><dd><a id='medRecDischarge"+componentId+"'>"+medRecDischargeTitle+"</a></dd></dl><div class='result-details hover'><h4 class='det-hd'><span>"+hmI18n.STATUS+"</span></h4><dl class='"+compNS+"-det'><dt><span>"+hmI18n.STATUS+":</span></dt><dd><span>"+mrDischargeStatusObj.status+"</span></dd><dt><span>"+hmI18n.LAST_RECONED+":</span></dt><dd><span>"+mrDischargeStatusObj.performedDate+"</span></dd><dt><span>"+hmI18n.LAST_RECONED_BY+":</span></dt><dd><span>"+mrDischargeStatusObj.performedBy+"</span></dd></dl></div>";
}else{mrDischargeStatusHtml="<h3 class='info-hd'>"+hmI18n.STATUS+"</h3><dl class='"+compNS+"-status result-info'><dd class="+medrecLinkSeperatorFlag+">&nbsp;</dd><dd class='"+compNS+"-status-img med-rec-status "+mrDischargeStatusObj.clsName+"'>&nbsp;</dd><dd>"+medRecDischargeTitle+"</dd></dl>";
}medRecFiltersFlag=true;
medRecHtml+=mrDischargeStatusHtml;
}if(medRecFiltersFlag){medRecHtmlStatus="<div class='"+compNS+"-status-container hml2-pull-right' id='medStatusContainer"+componentId+"'><dl class='"+compNS+"-status'><dd>"+hmI18n.STATUS+":</dd></dl>";
medRecHtmlStatus+=medRecHtml;
medRecHtmlStatus+="</div>";
}else{medRecHtmlStatus="<div class='"+compNS+"-status-container hml2-pull-right' id='medStatusContainer"+componentId+"'>";
medRecHtmlStatus+=medRecHtml;
medRecHtmlStatus+="</div>";
}}if(CERN_HOME_MEDS_O2.shouldDisplayMedsHeader(component)){var medsHeaderInfoContainer=null;
if(component.isPatientEnteredDataDisplayEnabled()&&component.getExternalDataInd()){var validHiData=CERN_HOME_MEDS_O2.processExtDataForRender(component);
segmentedControl=CERN_HOME_MEDS_O2.createSegmentedButton(component,recordData,validHiData);
component.setSegmentedControl(segmentedControl);
segmentedControlDisplay=segmentedControl.render();
medsHeaderInfoContainer="<div class='hml2-meds-header-info-container hml2-meds-header-info-container-with-segmented-control'>"+segmentedControlDisplay+"<div class='hml2-clearfix hml2-pull-right-no-width hml2-padding-top5 hml2-width'>"+medRecHtmlStatus+outsideRecsChkbox+"</div></div>";
}else{segmentedControlDisplay="<div class = 'btn-group hml2-padding-top20'></div>";
medsHeaderInfoContainer="<div class='hml2-meds-header-info-container'>"+segmentedControlDisplay+"<div class='hml2-clearfix hml2-pull-right-no-width hml2-padding-top5 hml2-width'>"+medRecHtmlStatus+outsideRecsChkbox+"</div></div>";
}medsContainer.push(medsHeaderInfoContainer);
}if(component.m_mfaBanner){medsContainer.push("<div id='hml2-meds-mfa-banner-container'>"+component.m_mfaBanner.render()+"</div>");
}if(component.getDisplayHiDataInd()&&component.getOutsideRecordsInd()){try{var status=recordData.STATUS_DATA.SUBEVENTSTATUS[0].OPERATIONSTATUS;
if(status==="S"){if(CERN_HOME_MEDS_O2.processExtDataForRender(component)){if(!component.isPatientEnteredDataDisplayEnabled()){var externalDataHTML=CERN_HOME_MEDS_O2.createExternalDataControl(component,false);
medsContainer.push(externalDataHTML);
}var extData="<div id ='hml2"+medCompId+"externaldata' class ='hml2-ext-table'></div><div id='pager"+medCompId+"'></div>";
medsContainer.push(extData);
}else{if(component.externalHomeMed.total_results!==0){var externalDataHTML=CERN_HOME_MEDS_O2.createExternalDataControl(component,true);
medsContainer.push(externalDataHTML+"</br>");
}}}else{var externalDataHTML=CERN_HOME_MEDS_O2.createExternalDataControl(component,true);
medsContainer.push(externalDataHTML);
medsContainer.push("</br>");
}}catch(err){logger.logJSError(err,this,"homemedications-o2.js","Retriving Healthe Intent data");
var externalDataHTML=CERN_HOME_MEDS_O2.createExternalDataControl(component,true);
medsContainer.push(externalDataHTML);
medsContainer.push("</br>");
}}medsContainer.push("<div id='hml2-loading",medCompId,"' class='hml2-loading'></div>");
var complianceText=CERN_HOME_MEDS_O2.getComplianceInfo(recordData.COMPLIANCE,personnelArray);
if(complianceText&&complianceText.length>0){medsContainer.push(complianceText);
component.setCompliance(true);
}var ipath=criterion.static_content;
var countText="";
var medCnt=0;
var rowCnt=0;
var codeArray=MP_Util.LoadCodeListJSON(recordData.CODES);
var df=CERN_HOME_MEDS_O2.getDateFormatter();
var imgClass="";
var edtCls="";
var modHTML="";
var bMedMod=component.isMedModInd();
var grouperCriteria;
var hasFilters=false;
var homeMedsTable;
var prescribedTblGroup;
var suspendedTblGroup;
var inOfficeTblGroup;
var prescribedMeds=[];
var suspendedMeds=[];
var inOfficeMeds=[];
var patReqCount=0;
var medsCount;
var med;
var medStatus;
var isGroupFilterSelected=false;
var patRequestPrefInd=component.isPatientEnteredDataDisplayEnabled();
var otherMeds=[];
homeMedsTable=(new ComponentTable()).setNamespace("hml2"+medCompId).setIsHeaderEnabled(true);
if(recordData.ORDERS.length>0){if(isFinite(groupNum)){parentDiv.selectedVal=groupNum;
if(groupNum!=-1){grouperCriteria=component.getGrouperCriteria(groupNum);
component.setGrouperFilterCriteria(grouperCriteria);
recordData=CERN_HOME_MEDS_O2.sortByDropdownValue(recordData,grouperCriteria);
MP_Core.AppUserPreferenceManager.SaveCompPreferences(componentId);
}}else{for(var y=0;
y<=10;
y++){if(component.getGrouperLabel(y)){hasFilters=true;
break;
}}isGroupFilterSelected=hasFilters&&component.getGrouperFilterLabel();
if(!isGroupFilterSelected){if(recordData.ORDERS.length){recordData.ORDERS.sort(CERN_HOME_MEDS_O2.SortByMedicationName);
}}else{$("#filter-grouping-selected-label-"+component.getStyles().getId()).html(component.getGrouperFilterLabel());
var dummyCriteria=component.getGrouperFilterCriteria();
if(!dummyCriteria){dummyCriteria=component.getGrouperFilterEventSets();
}if(dummyCriteria){recordData=CERN_HOME_MEDS_O2.sortByDropdownValue(recordData,dummyCriteria,component);
}}}CERN_HOME_MEDS_O2.setMedicationRows(recordData.ORDERS,component);
patReqCount=component.getPatientRequestList().length;
medsCount=component.getOtherChartMedsList().length;
medsContainer.push("<div class='",MP_Util.GetContentClass(component,medsCount),"'>");
for(var i=0;
i<medsCount;
i++){med=component.m_otherCharMedsList[i];
medStatus=MP_Util.GetValueFromArray(med.CORE.STATUS_CD,codeArray);
medType=med.MEDICATION_INFORMATION.ORIGINALLY_ORDERED_AS_TYPE.SATELLITE_IND;
if(medStatus&&medStatus.meaning==="SUSPENDED"){suspendedMeds.push(med);
}else{if(medType===1){inOfficeMeds.push(med);
}else{prescribedMeds.push(med);
}}}var tableSortingEnabled=!(isGroupFilterSelected);
if(patRequestPrefInd&&!component.getDisplayHiDataInd()){homeMedicationsCapTimer=new CapabilityTimer("CAP:MPG HOME MEDICATIONS LOAD PATIENT ENTERED DATA");
homeMedicationsCapTimer.capture();
var patRequestsTblGroup=new TableGroup();
patRequestsTblGroup.setGroupId("PATREQUEST"+componentId);
patRequestsTblGroup.setDisplay("<span class='hml2-pat-req-icon'>&nbsp;</span>"+hmI18n.PATIENT_REQUESTS);
patRequestsTblGroup.setShowCount(true);
patRequestsTblGroup.setCanCollapse(false);
if(patReqCount){var requestColumn=CERN_HOME_MEDS_O2.createTableColumn("request"+medCompId,hmI18n.REQUEST,tableSortingEnabled,"PAT_REQUEST_DISPLAY","${PAT_REQUEST_DISPLAY}","hml2-pat-request-col");
requestColumn.addSecondarySortField("MEDICATION_TEXT",TableColumn.SORT.ASCENDING);
requestColumn.addSecondarySortField("LAST_DOSE_DATE_DISPLAY",TableColumn.SORT.DESCENDING);
homeMedsTable.addColumn(requestColumn);
CERN_HOME_MEDS_O2.processHomeMedsData(component.m_patientRequestList,component);
patRequestsTblGroup.bindData(component.m_patientRequestList);
}homeMedsTable.addGroup(patRequestsTblGroup);
}CERN_HOME_MEDS_O2.processHomeMedsData(prescribedMeds,component);
var infoIconsClass=CERN_HOME_MEDS_O2.getInfoButtonClass(component);
var infoIconColumn=CERN_HOME_MEDS_O2.createTableColumn("infoICon"+medCompId,"",false,"INFO_ICON_DISPLAY","${INFO_ICON_DISPLAY}",infoIconsClass);
var medColClass=(patRequestPrefInd&&patReqCount&&!component.getDisplayHiDataInd())?"hml2-med-col-with-pat-req":"hml2-med-col";
var medicationColumn=CERN_HOME_MEDS_O2.createTableColumn("medication"+medCompId,hmI18n.MEDICATION,tableSortingEnabled,"MEDICATION_TEXT","${MEDICATION_DISPLAY}",medColClass);
if(tableSortingEnabled){medicationColumn.addSecondarySortField("LAST_DOSE_DATE_DISPLAY",TableColumn.SORT.DESCENDING);
}var lastDoseClass=(patRequestPrefInd&&patReqCount&&!component.getDisplayHiDataInd())?"hml2-last-dose-with-pat-req":"hml2-last-dose";
var lastDoseColumn=CERN_HOME_MEDS_O2.createTableColumn("lastDoseDate"+medCompId,hmI18n.LAST_DOSE,tableSortingEnabled,"LAST_DOSE_DATE_DISPLAY","${LAST_DOSE_DATE_DISPLAY}",lastDoseClass);
if(tableSortingEnabled){lastDoseColumn.setDefaultSort(TableColumn.SORT.DESCENDING);
}var complianceColumn=CERN_HOME_MEDS_O2.createTableColumn("compliance"+medCompId,hmI18n.COMPLIANCE,tableSortingEnabled,"COMPLIANCE_DISPLAY","${COMPLIANCE_DISPLAY}","hml2-compliance");
var compCommentClass=(patRequestPrefInd&&patReqCount&&!component.getDisplayHiDataInd())?"hml2-compliance-comment-with-pat-req":"hml2-compliance-comment";
var compCommentColumn=CERN_HOME_MEDS_O2.createTableColumn("compComment"+medCompId,hmI18n.COMPLIANCE_COMMENT,tableSortingEnabled,"COMP_COMMENT_DISPLAY","${COMP_COMMENT_DISPLAY}",compCommentClass);
var formularyDisplay="<span>"+hmI18n.FORMULARY+"</span>";
var formularyColumn=CERN_HOME_MEDS_O2.createTableColumn("formulary"+medCompId,formularyDisplay,false,"","${FORMULARY_DISPLAY}","hml2-formulary hml2-hidden");
homeMedsTable.addColumn(infoIconColumn);
homeMedsTable.addColumn(medicationColumn);
homeMedsTable.addColumn(lastDoseColumn);
homeMedsTable.addColumn(complianceColumn);
homeMedsTable.addColumn(compCommentColumn);
homeMedsTable.addColumn(formularyColumn);
prescribedTblGroup=new TableGroup();
prescribedTblGroup.bindData(prescribedMeds);
prescribedTblGroup.setGroupId("PRESCRIBED"+medCompId);
if(patRequestPrefInd&&!component.getDisplayHiDataInd()){prescribedTblGroup.setHideHeader(false);
prescribedTblGroup.setDisplay(hmI18n.OTHER_CHART_MEDICATIONS);
prescribedTblGroup.setShowCount(true);
prescribedTblGroup.setCanCollapse(false);
if(tableSortingEnabled){homeMedsTable.sortByColumnInDirection("medication"+medCompId,TableColumn.SORT.ASCENDING);
if(patReqCount){homeMedsTable.sortByColumnInDirection("request"+medCompId,TableColumn.SORT.ASCENDING);
}}}else{prescribedTblGroup.setHideHeader(true);
homeMedsTable.sortByColumnInDirection("medication"+medCompId,TableColumn.SORT.ASCENDING);
}homeMedsTable.addGroup(prescribedTblGroup);
if(suspendedMeds.length){CERN_HOME_MEDS_O2.processHomeMedsData(suspendedMeds,component);
suspendedTblGroup=new TableGroup();
suspendedTblGroup.bindData(suspendedMeds);
suspendedTblGroup.setGroupId("SUSPENDED"+medCompId);
suspendedTblGroup.setDisplay(i18n.SUSPENDED);
suspendedTblGroup.setShowCount(true);
if(component.getOutsideRecordsInd()){suspendedTblGroup.setCanCollapse(false);
}else{suspendedTblGroup.setCanCollapse(true);
}homeMedsTable.addGroup(suspendedTblGroup);
}if(inOfficeMeds.length){CERN_HOME_MEDS_O2.processHomeMedsData(inOfficeMeds,component);
inOfficeTblGroup=new TableGroup();
inOfficeTblGroup.bindData(inOfficeMeds);
inOfficeTblGroup.setGroupId("INOFFICE"+medCompId);
inOfficeTblGroup.setDisplay(hmI18n.ADMINISTERED_IN_OFFICE);
inOfficeTblGroup.setShowCount(true);
inOfficeTblGroup.setCanCollapse(true);
homeMedsTable.addGroup(inOfficeTblGroup);
}if(tableSortingEnabled){if(patReqCount&&component.getOutsideRecordsInd()&&!component.getDisplayHiDataInd()){homeMedsTable.sortByColumnInDirection("request"+medCompId,TableColumn.SORT.ASCENDING);
}else{homeMedsTable.sortByColumnInDirection("medication"+medCompId,TableColumn.SORT.ASCENDING);
}}var medHoverTemplate="${RESULT_DATA.MED_ORDER_HOVER}";
component.setComponentTable(homeMedsTable);
var hoverExtension=CERN_HOME_MEDS_O2.createTableCellHover(component,medicationColumn,lastDoseColumn,complianceColumn,compCommentColumn,formularyColumn);
component.setTableHoverExtension(hoverExtension);
homeMedsTable.addExtension(hoverExtension);
medsContainer.push(homeMedsTable.render());
medsContainer.push("<div id ='hml2",medCompId,"sidePanelContainer' class='hml2-side-panel'>&nbsp;</div>");
medCnt=prescribedMeds.length+suspendedMeds.length+inOfficeMeds.length;
if(component.getOutsideRecordsInd()){medCnt+=patReqCount;
}}else{bMedMod=false;
if(recordData.COMPLIANCE.NO_KNOWN_HOME_MEDS_IND===0&&recordData.COMPLIANCE.UNABLE_TO_OBTAIN_IND===0){medsContainer.push("<span class='res-none'>",hmI18n.NO_RESULTS_FOUND,"</span>");
}}if(bMedMod){if(_g("hml2Ftr"+medCompId)){Util.de(_g("hml2Ftr"+medCompId));
}var secCont=component.getSectionContentNode();
var medModFt=Util.cep("div",{className:"hml2-content-ft",id:"hml2Ftr"+medCompId});
var medModFtHTML='<div class="med-rnw-row" id="medRnwRow'+medCompId+'"><button class="hml2-rnw-btn" id="medRnwBtn'+medCompId+'" disabled="true"><img id="medRnwImg'+medCompId+'"  src="'+ipath+'/images/renew_disabled.gif" alt="" /> '+hmI18n.MED_RENEW+'</button><button class="hml2-rnw-btn" id="medCnclBtn'+medCompId+'" disabled="true"><img id="medCnclImg'+medCompId+'" src="'+ipath+'/images/cancel_disabled.gif" alt="" /> '+hmI18n.MED_CANCEL+'</button><button class="hml2-rnw-btn" id="medCmpltBtn'+medCompId+'" disabled="true"><img id="medCmpltImg'+medCompId+'" src="'+ipath+'/images/complete_disabled.gif" alt="" /> '+hmI18n.MED_COMPLETE+'</button><button class="hml2-rnw-btn hml2-sgn-btn" id="medSgnBtn'+medCompId+'" disabled="true"> '+hmI18n.MED_SIGN+' </button></div><div class= "hml2-sgn-row" id="medSgnRow'+medCompId+'"> <span class="hml2-route">'+hmI18n.DEF_ROUTE_LBL+': <a id="routeLink'+medCompId+'" class="hml2-route-link hml2-dthrd" >'+hmI18n.MED_NONE_SELECTED+"</a></span></div>";
medModFt.innerHTML=medModFtHTML;
Util.ia(medModFt,secCont);
}var eventArg={count:medCnt};
CERN_EventListener.fireEvent(component,component,EventListener.EVENT_COUNT_UPDATE,eventArg);
countText=MP_Util.CreateTitleText(component,medCnt);
component.updateSatisfierRequirementIndicator();
MP_Util.Doc.FinalizeComponent(medsContainer.join(""),component,countText);
if(component.inMillennium){var statusNode=document.getElementById("medStatusContainer"+componentId);
component.initHovers(statusNode);
if(component.getMedHistory()){$("#medsHistory"+componentId).click(function(){CERN_HOME_MEDS_O2.launchMedsHistory(component);
});
}if(component.getMedRecAdmit()){$("#medRecAdmission"+componentId).click(function(){component.launchMedicationReconciliation(componentId,1,venueAdm);
});
}if(component.getMedRecDischarge()){$("#medRecDischarge"+componentId).click(function(){component.launchMedicationReconciliation(componentId,3,venueDisch);
});
}if(component.getMedRecTransfer()){$("#medRecTransfer"+componentId).click(function(){component.launchMedicationReconciliation(componentId,2,0);
});
}if(component.getMedRecCrossEncTx()){$("#medRecCrossEncntrTx"+componentId).click(function(){component.launchMedicationReconciliation(componentId,6,0);
});
}}homeMedsTable.finalize();
if(segmentedControl){segmentedControl.attachEvents();
}if(component.getComponentTable()){CERN_HOME_MEDS_O2.bindColumnHeaderClick(component);
if(component.getOutsideRecordsInd()){CERN_HOME_MEDS_O2.disableHeaderClick();
}}$("#hml2-outside-recs-checkbox"+componentId).click(function(){var $this=$(this);
if($this.is(":checked")){component.setOutsideRecordsInd(true);
}else{component.setOutsideRecordsInd(false);
}component.InsertData();
});
}}catch(e){MP_Util.LogJSError(e,component,"homemedications-o2.js","displayAllData");
throw e;
}},shouldDisplayMedsHeader:function(comp){return comp.getPatientEnteredDataInd()||(comp.getMedRec()&&(comp.getMedHistory()||comp.getMedRecAdmit()||comp.getMedRecTransfer()||comp.getMedRecCrossEncTx()||comp.getMedRecDischarge()));
},disableHeaderClick:function(){$(".hml2-sec :header").click(function(){return false;
});
},createSegmentedButton:function(component,recordData,validHiData){var self=this;
var hmI18n=i18n.discernabu.homemeds_o2;
var segment=new MPageUI.SegmentedControl();
segment.addSegment({label:hmI18n.PATIENT_REQUESTS,selected:!component.getDisplayHiDataInd(),onSelect:function(){component.setDisplayHiDataInd(false);
component.InsertData();
}});
segment.addSegment({label:hmI18n.OUTSIDE_RECORDS_SEGMENTED_CONTROL,disabled:!validHiData,selected:component.getDisplayHiDataInd(),onSelect:function(){component.setDisplayHiDataInd(true);
component.InsertData();
}});
return segment;
},initializeSidePanel:function(component){var compId=component.m_componentId;
var sidePanelContId="hml2"+compId+"sidePanelContainer";
var sidePanelObj=_g(sidePanelContId);
var tableObj=$("#hml2"+compId+"table");
var footerObj=$("#hml2Ftr"+compId);
var tableHeight=null;
if(tableObj&&tableObj.length){tableHeight=tableObj.css("height");
}else{logger.logError("Table object was not found in initializeSidePanel function.");
return;
}if(sidePanelObj){component.m_sidePanel=new CompSidePanel(compId,sidePanelContId);
component.m_sidePanel.setExpandOption(component.m_sidePanel.expandOption.EXPAND_DOWN);
component.m_sidePanel.setHeight(tableHeight);
component.m_sidePanel.setMinHeight(tableHeight);
component.m_sidePanel.renderPreBuiltSidePanel();
component.m_sidePanel.setContents("<div>&nbsp;</div>","hml2Content"+compId);
component.m_sidePanel.showCornerCloseButton();
component.m_sidePanel.setCornerCloseFunction(function(){$("#"+sidePanelContId).hide();
tableObj.removeClass("hml2-table-with-panel");
footerObj.removeClass("hml2-footer-with-panel");
component.m_sidePanelShowing=false;
var selectedRowsObj=tableObj.find(".hml2-med-selected");
var selectedRows=[];
if(selectedRowsObj.length){for(var i=0;
i<selectedRowsObj.length;
i++){selectedRows.push(selectedRowsObj[i]);
}CERN_HOME_MEDS_O2.removeCurrentHighlightedRows(component,selectedRows);
}});
}},createRemoveRequestButton:function(medsCompObj,selectedRow,rowOrderInfo,sidePanel){var compId=medsCompObj.getComponentId();
var criterion=medsCompObj.getCriterion();
var hmI18n=i18n.discernabu.homemeds_o2;
var ipath=criterion.static_content;
var ordersMedInfo=rowOrderInfo.MEDICATION_INFORMATION;
var iconName=(ordersMedInfo.ORIGINALLY_ORDERED_AS_TYPE.PRESCRIPTION_IND)?"4969_16.png":"3796_16.png";
var sidePanelObject=$("#sidePanelContents"+compId);
$("<img class='hml2-side-panel-hx-icon' />").prependTo("#sidePanelHeaderText"+compId).attr({src:ipath+"/images/"+iconName,alt:""});
var buttonStyleEnum=MPageUI.BUTTON_OPTIONS.STYLE;
var removeRequestBtn=new MPageUI.Button();
removeRequestBtn.setLabel(hmI18n.REMOVE_REQUEST);
removeRequestBtn.setStyle("hml2-remove-request-btn "+buttonStyleEnum.SECONDARY);
removeRequestBtn.setOnClickCallback(function(){var removeRequestRoot=$(removeRequestBtn.getRootElement());
homeMedicationsCapTimer=new CapabilityTimer("CAP:MPG HOME MEDICATIONS RECONCILE PATIENT ENTERED DATA");
homeMedicationsCapTimer.capture();
removeRequestBtn.setDisabled(true);
removeRequestRoot.css("cursor","wait");
try{var groupId="PATREQUEST"+compId;
var homeMedsCompTable=medsCompObj.getComponentTable();
var patRecTableGroup=homeMedsCompTable.getGroupById(groupId);
var selRowId=selectedRow[0].attributes.id.nodeValue.split(":")[2];
var row=patRecTableGroup.getRowById(selRowId);
var rowIndex=$.inArray(row,patRecTableGroup.rows);
var extDataInfoId=rowOrderInfo.INTEROP[0].EXT_DATA_INFO_ID;
var prsnlId=criterion.provider_id;
var encounterId=rowOrderInfo.CORE.ENCNTR_ID||criterion.encntr_id;
var chartReferenceId=ordersMedInfo.ORDER_ID;
var removeStatusCode=MP_Util.GetCodeValueByMeaning("ACKNOWLEDGED",4003508).codeValue;
var requestJson='{"REQUESTIN":{"UPDATESTATUS":[{"EXT_DATA_INFO_ID":'+extDataInfoId+'.0,"STATUS_CODE":'+removeStatusCode+'.0,"CHART_REFERENCE_ID":'+chartReferenceId+'.0,"PERSONNEL_ID":'+prsnlId+'.0,"ENCNTR_ID":'+encounterId+".0}]}}";
var scriptRequest=new ScriptRequest();
scriptRequest.setProgramName("mp_exec_std_request");
scriptRequest.setDataBlob(requestJson);
scriptRequest.setParameterArray(["^MINE^","^^",3202004,3202004,964756]);
scriptRequest.setRawDataIndicator(true);
scriptRequest.setResponseHandler(function(scriptReply){try{var responseData=JSON.parse(scriptReply.getResponse());
if(responseData.RECORD_DATA.STATUS.SUCCESS_INDICATOR===1){removeRequestBtn.setDisabled(false);
removeRequestRoot.css("cursor","default");
medsCompObj.InsertData();
medsCompObj.m_sidePanelShowing=false;
}else{CERN_HOME_MEDS_O2.displayRemoveRequestErrorBanner(medsCompObj);
removeRequestBtn.setDisabled(false);
removeRequestRoot.css("cursor","default");
}}catch(error){CERN_HOME_MEDS_O2.displayRemoveRequestErrorBanner(medsCompObj);
removeRequestBtn.setDisabled(false);
removeRequestRoot.css("cursor","default");
}});
scriptRequest.performRequest();
}catch(err){CERN_HOME_MEDS_O2.displayRemoveRequestErrorBanner(medsCompObj);
removeRequestBtn.setDisabled(false);
removeRequestRoot.css("cursor","default");
}});
sidePanel.setActionsAsHTML(removeRequestBtn.render());
removeRequestBtn.attachEvents();
},removeCurrentHighlightedRows:function(component,selectedRows){var selectedRowsLength=selectedRows.length;
for(var j=0;
j<selectedRowsLength;
j++){if(Util.Style.ccss(selectedRows[j],"hml2-med-selected")){Util.Style.rcss(selectedRows[j],"hml2-med-selected");
var formularyEle=$(selectedRows[j]).find(".hml2-formulary");
if($(formularyEle).hasClass("hml2-wb")){$(formularyEle).removeClass("hml2-wb");
}Util.Style.rcss(selectedRows[j],"hml2-wb");
component.m_medModObj.lastMedSel=null;
}}var rootMedSecCont=component.getSectionContentNode();
var rnwdLen=Util.Style.g("hml2-rnwd",rootMedSecCont,"dl").length;
var cncldLen=Util.Style.g("hml2-cncld",rootMedSecCont,"dl").length;
var cmpltLen=Util.Style.g("hml2-cmplt",rootMedSecCont,"dl").length;
if(rnwdLen===0&&cncldLen===0&&cmpltLen===0){component.setEditMode(false);
}if(component.inMillennium&&component.isMedModInd()){CERN_HOME_MEDS_O2.disableActions(component);
}},ShowLoadingImage:function(compId){var dialog=_g("hml2-loading"+compId);
dialog.innerHTML+="<div id='loadingimage"+compId+"' class='hml2-comm-loading'>&nbsp;</div>";
var loadingImage=_g("loadingimage"+compId);
if(dialog.style.display==="block"){dialog.style.display="none";
}else{loadingImage.style.height=$("#hml2Content"+compId).height()+"px";
dialog.style.display="block";
}},processExtDataForRender:function(component){var hasExtDataProcessedSuccessfully=false;
try{component.externalHomeMed=JSON.parse(component.getAllData().HTTPREPLY.BODY);
if(component.externalHomeMed.groups.length===0){return hasExtDataProcessedSuccessfully;
}for(var i=0;
i<component.externalHomeMed.groups.length;
i++){component.externalHomeMed.groups[i].MED_NAME="--";
component.externalHomeMed.groups[i].DOSE="";
component.externalHomeMed.groups[i].START_DATE="--";
component.externalHomeMed.groups[i].COMMENTS="--";
component.externalHomeMed.groups[i].PROVIDER="--";
component.externalHomeMed.groups[i].STOP_DATE=null;
component.externalHomeMed.groups[i].STATUS="--";
if(component.externalHomeMed.groups[i].most_recent_medication){component.externalHomeMed.groups[i].DOSE=component.externalHomeMed.groups[i].most_recent_medication.dose;
var medName=component.externalHomeMed.groups[i]["name"];
if(medName){component.externalHomeMed.groups[i].MED_NAME=medName;
}var parsedStartDtString=component.externalHomeMed.groups[i].most_recent_medication.start_datetime;
var startDate=null;
if(parsedStartDtString){startDate=new Date();
startDate.setISO8601(parsedStartDtString);
var df=CERN_HOME_MEDS_O2.getDateFormatter();
component.externalHomeMed.groups[i].START_DATE=df.format(startDate,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_2YEAR);
}var parsedStopDtString=component.externalHomeMed.groups[i].most_recent_medication.stop_datetime;
var stopDate=null;
var today=new Date();
if(parsedStopDtString){stopDate=new Date();
stopDate.setISO8601(parsedStopDtString);
var df=CERN_HOME_MEDS_O2.getDateFormatter();
component.externalHomeMed.groups[i].STOP_DATE=df.format(stopDate,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_2YEAR);
if(!startDate||(startDate.getTime()>today.getTime())||(stopDate&&stopDate.getTime()<today.getTime())){component.externalHomeMed.groups[i].STATUS=i18n.discernabu.homemeds_o2.STATUSINACTIVE;
}else{component.externalHomeMed.groups[i].STATUS=i18n.discernabu.homemeds_o2.STATUSACTIVE;
}}else{if(startDate&&(startDate.getTime()<=today.getTime())){component.externalHomeMed.groups[i].STATUS=i18n.discernabu.homemeds_o2.STATUSACTIVE;
}else{component.externalHomeMed.groups[i].STATUS=i18n.discernabu.homemeds_o2.STATUSINACTIVE;
}}var comments=component.externalHomeMed.groups[i].most_recent_medication.comments;
if(comments!=null&&comments.length>0){var commentsText=[];
for(var ind=0;
ind<comments.length;
ind++){commentsText[ind]=comments[ind].text;
}component.externalHomeMed.groups[i].COMMENTS=commentsText;
}var provider=component.externalHomeMed.groups[i].most_recent_medication.prescribing_provider_name;
if(provider){component.externalHomeMed.groups[i].PROVIDER=provider;
}}}hasExtDataProcessedSuccessfully=true;
return hasExtDataProcessedSuccessfully;
}catch(err){return hasExtDataProcessedSuccessfully;
}},showHIData:function(component){var compId=component.getComponentId();
var externalDataDiv=$("#hml2"+compId+"externaldata");
var pagerContainer=$("#pager"+compId);
externalDataDiv.add(pagerContainer).wrapAll("<div class='hml2-externaldata-container'></div>");
var imgUrl="<span><img height='22' width='22' class='hml2-ext-img' id='externalDataImg' src= '"+component.getCriterion().static_content+"/images/6965.png'></span>";
var label="<p id = 'externalDataLabel'>"+imgUrl+"<span class='hml2-ext-dt-label'>"+i18n.discernabu.homemeds_o2.OUTSIDE_RECORDS+"</span></p></br>";
$("#hiAddDataContainer"+compId).html(label).removeClass("hml2-hi-ext-label");
component.m_externalDataTable=new ComponentTable();
component.m_externalDataTable.setNamespace("hiDataHomeMedication"+compId);
var medication=new TableColumn();
medication.setColumnId("Medication");
medication.setCustomClass("hml2-ext-name");
medication.setColumnDisplay(i18n.discernabu.homemeds_o2.MEDICATION);
medication.setPrimarySortField("MED_NAME");
medication.setIsSortable(true);
medication.setRenderTemplate("<span>${MED_NAME}</span>&nbsp;<span class='hml2-sig detail-line'>${DOSE}</span>");
var startDate=new TableColumn();
startDate.setColumnId("StartDate");
startDate.setCustomClass("hml2-ext-start-date");
startDate.setColumnDisplay(i18n.discernabu.homemeds_o2.START_DATE);
startDate.setPrimarySortField("START_DATE");
startDate.setIsSortable(true);
startDate.setRenderTemplate("<span>${START_DATE}</span>");
var comments=new TableColumn();
comments.setColumnId("Comments");
comments.setCustomClass("hml2-ext-comments");
comments.setColumnDisplay(i18n.discernabu.homemeds_o2.COMMENTS);
comments.setPrimarySortField("COMMENTS");
comments.setIsSortable(true);
comments.setRenderTemplate("<span>${COMMENTS}</span>");
var provider=new TableColumn();
provider.setColumnId("Provider");
provider.setCustomClass("hml2-ext-provider");
provider.setColumnDisplay(i18n.discernabu.homemeds_o2.PROVIDER);
provider.setPrimarySortField("PROVIDER");
provider.setIsSortable(true);
provider.setRenderTemplate("<span>${PROVIDER}</span>");
component.m_externalDataTable.addColumn(medication);
component.m_externalDataTable.addColumn(startDate);
component.m_externalDataTable.addColumn(comments);
component.m_externalDataTable.addColumn(provider);
var hoverExtension=new TableRowHoverExtension();
hoverExtension.setHoverRenderer(function(data){var source="--";
if(data.RESULT_DATA.most_recent_medication&&data.RESULT_DATA.most_recent_medication.source&&data.RESULT_DATA.most_recent_medication.source.partition_description&&data.RESULT_DATA.most_recent_medication.source.type){source=data.RESULT_DATA.most_recent_medication.source.partition_description+" ("+data.RESULT_DATA.most_recent_medication.source.type+")";
}var result=['<h4 class="det-hd"><span></span></h4>','<dl class="hml2-hover">',"<dt><span>"+i18n.discernabu.homemeds_o2.SOURCE+"</span></dt>","<dd><span>"+source+"</span></dd>","<dt><span>"+i18n.discernabu.homemeds_o2.STATUS+"</span></dt>","<dd><span>"+data.RESULT_DATA.STATUS+"</span></dd>","</dl>"].join("");
return result;
});
component.m_externalDataTable.addExtension(hoverExtension);
component.m_externalDataTable.bindData(component.externalHomeMed.groups);
label=component.m_externalDataTable.render();
externalDataDiv.append(label);
if(component.externalHomeMed.total_results!=null&&component.externalHomeMed.total_results>20){var noOfPages=Math.ceil(component.externalHomeMed.total_results/20);
var lastPageNo=0;
component.pager=new MPageUI.Pager().setNumberPages(noOfPages).setCurrentPageLabelPattern("${currentPage}/${numberPages}").setNextLabel(i18n.discernabu.homemeds_o2.NEXT).setPreviousLabel(i18n.discernabu.homemeds_o2.PREVIOUS);
component.pager.setOnPageChangeCallback(function(){if(lastPageNo<arguments[0].currentPage){component.pageIndex=component.pageIndex+20;
component.m_millDataInd=0;
MP_Util.LoadSpinner("hiDataHomeMedication"+compId+"table");
CERN_HOME_MEDS_O2.GetHomeMedications(component);
lastPageNo=arguments[0].currentPage;
}else{component.pageIndex=component.pageIndex-20;
component.m_millDataInd=0;
MP_Util.LoadSpinner("hiDataHomeMedication"+compId+"table");
CERN_HOME_MEDS_O2.GetHomeMedications(component);
lastPageNo=arguments[0].currentPage;
}});
pagerContainer.addClass("hml2-row-pager").append(component.pager.render());
component.pager.attachEvents();
}component.m_externalDataTable.finalize();
component.resizeComponent();
},sortByDropdownValue:function(recordData,sortCriteria,component){var multumArray=[];
var nonMultumArray=[];
var homeMedsi18n=i18n.discernabu.homemeds_o2;
var sortSequenceLength=sortCriteria.length;
var homeMedOrders=recordData.ORDERS;
var homeMedOrderCount=homeMedOrders.length;
var homeMedOrderIndex=homeMedOrderCount;
while(homeMedOrderIndex--){var order=homeMedOrders[homeMedOrderIndex];
var orderMedInfo=order.MEDICATION_INFORMATION;
var multumArrLenPrev=multumArray.length;
if(sortSequenceLength){for(var catIdObjArrInd=0;
catIdObjArrInd<orderMedInfo.MULTUM_CATEGORY_IDS.length;
catIdObjArrInd++){var catId=orderMedInfo.MULTUM_CATEGORY_IDS[catIdObjArrInd].MULTUM_CATEGORY_ID;
if(sortCriteria.indexOf(catId)!==-1){multumArray.push(order);
break;
}}}if(multumArrLenPrev===multumArray.length){nonMultumArray.push(order);
}}if(homeMedOrderCount&&sortSequenceLength){var sortedMultumArray=[];
for(var seqIndex=sortSequenceLength;
seqIndex--;
){var currDrugClassId=sortCriteria[seqIndex];
var multumArrIndex=multumArray.length;
var likeMultumArr=[];
var likeMultumCount=0;
while(multumArrIndex--){var multOrder=multumArray[multumArrIndex];
var multumCategoryObjArr=multOrder.MEDICATION_INFORMATION.MULTUM_CATEGORY_IDS;
var categoryObjArrIndex=multumCategoryObjArr.length;
var multumCategoryIdsArr=[];
while(categoryObjArrIndex--){multumCategoryIdsArr.push(multumCategoryObjArr[categoryObjArrIndex].MULTUM_CATEGORY_ID);
}var seqMatchFound=multumCategoryIdsArr.indexOf(currDrugClassId);
if(seqMatchFound!==-1){likeMultumArr.push(multOrder);
likeMultumCount=likeMultumCount+1;
}}if(likeMultumCount>=1){likeMultumArr.sort(CERN_HOME_MEDS_O2.SortByMedicationName);
}var likeMultumArrLength=likeMultumArr.length;
for(var multumIndex=0;
multumIndex<likeMultumArrLength;
multumIndex++){if($.inArray(likeMultumArr[multumIndex],sortedMultumArray)===-1){sortedMultumArray.push(likeMultumArr[multumIndex]);
}}}nonMultumArray.sort(CERN_HOME_MEDS_O2.SortByMedicationName);
var nonMultumArrayLength=nonMultumArray.length;
for(var nonMultumArrayIndex=0;
nonMultumArrayIndex<nonMultumArrayLength;
nonMultumArrayIndex++){sortedMultumArray.push(nonMultumArray[nonMultumArrayIndex]);
}recordData.ORDERS=sortedMultumArray;
}else{nonMultumArray.sort(CERN_HOME_MEDS_O2.SortByMedicationName);
multumArray.sort(CERN_HOME_MEDS_O2.SortByMedicationName);
var nonMultumCount=nonMultumArray.length;
for(var sortIndex=0;
sortIndex<nonMultumCount;
sortIndex++){multumArray.push(nonMultumArray[sortIndex]);
}recordData.ORDERS=multumArray;
}return recordData;
},getComplianceInfo:function(compliance,personnelArray){var ar=[];
var lastDocDate="",lastDocBy="",msg="";
var hmI18n=i18n.discernabu.homemeds_o2;
if(compliance.NO_KNOWN_HOME_MEDS_IND===0&&compliance.UNABLE_TO_OBTAIN_IND===0){return;
}if(compliance.NO_KNOWN_HOME_MEDS_IND==1){msg=hmI18n.NO_KNOWN_HOME_MEDS;
}else{if(compliance.UNABLE_TO_OBTAIN_IND==1){msg=hmI18n.UNABLE_TO_OBTAIN_MED_HIST;
}}if(compliance.PERFORMED_PRSNL_ID>0){var provider=MP_Util.GetValueFromArray(compliance.PERFORMED_PRSNL_ID,personnelArray);
lastDocBy=provider.fullName;
}if(compliance.PERFORMED_DATE!==""){var dateTime=new Date();
dateTime.setISO8601(compliance.PERFORMED_DATE);
var df=CERN_HOME_MEDS_O2.getDateFormatter();
lastDocDate=df.format(dateTime,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_4YEAR);
}ar.push("<dl class='hml2-info'><dd><span class='important-icon'> </span><span>",msg,"</span></dd></dl><h4 class='det-hd'><span>",hmI18n.MED_DETAIL,"</span></h4>","<div class='hvr'><dl class='hml2-det'>","<dt><span>",hmI18n.LAST_DOC_DT_TM,":</span></dt><dd class='hml2-det-name'><span>",lastDocDate,"</span></dd><dt><span>",i18n.discernabu.homemeds_o2.LAST_DOC_BY,":</span></dt><dd class='hml2-det-dt'><span>",lastDocBy,"</span></dd></dl></div>");
return ar.join("");
},SortByMedicationName:function(a,b){var aName=CERN_HOME_MEDS_O2.getMedicationDisplayName(a);
var bName=CERN_HOME_MEDS_O2.getMedicationDisplayName(b);
var aUpper=(aName!==null)?aName.toUpperCase():"";
var bUpper=(bName!==null)?bName.toUpperCase():"";
if(aUpper>bUpper){return 1;
}else{if(aUpper<bUpper){return -1;
}return 0;
}},getMedicationDisplayName:function(order){var medName="";
if(order.DISPLAYS!==null){medName=order.DISPLAYS.DISPLAY_NAME;
}return(medName);
},getMedicationDisplayNameForHover:function(order){var medName="";
if(order.DISPLAYS!==null){medName=order.DISPLAYS.HOVER_NAME;
}return(medName);
},getHomeMedicationType:function(order){if(order.MEDICATION_INFORMATION.ORIGINALLY_ORDERED_AS_TYPE.PRESCRIPTION_IND!==""&&order.MEDICATION_INFORMATION.ORIGINALLY_ORDERED_AS_TYPE.PRESCRIPTION_IND==1){return i18n.discernabu.homemeds_o2.PRESCRIBED;
}else{if(order.MEDICATION_INFORMATION.ORIGINALLY_ORDERED_AS_TYPE.DOCUMENTED_IND!==""&&order.MEDICATION_INFORMATION.ORIGINALLY_ORDERED_AS_TYPE.DOCUMENTED_IND==1){return i18n.discernabu.homemeds_o2.DOCUMENTED;
}else{if(order.MEDICATION_INFORMATION.ORIGINALLY_ORDERED_AS_TYPE.SATELLITE_IND!==""&&order.MEDICATION_INFORMATION.ORIGINALLY_ORDERED_AS_TYPE.SATELLITE_IND===1){return i18n.discernabu.homemeds_o2.INOFFICE;
}else{return"";
}}}},getDateFormatter:function(){if(m_df===null){m_df=new mp_formatter.DateTimeFormatter(MPAGE_LOCALE);
}return m_df;
},getRouteJSON:function(component){try{MP_Util.LogDiscernInfo(component,"POWERORDERS","homemedications-o2.js","getRouteJSON");
var PowerOrdersMPageUtils=window.external.DiscernObjectFactory("POWERORDERS");
var criterion=component.getCriterion();
var m_dPersonId=criterion.person_id;
var m_dEncounterId=criterion.encntr_id;
var m_hMOEW=PowerOrdersMPageUtils.CreateMOEW(m_dPersonId,m_dEncounterId,0,2,127);
var m_routeListJSON=PowerOrdersMPageUtils.GetConsolidatedRoutingOptions(m_hMOEW,component.m_medModObj.catCodeList);
if(m_routeListJSON){component.m_medModObj.jsonRoutes=JSON.parse(m_routeListJSON);
}PowerOrdersMPageUtils.DestroyMOEW(m_hMOEW);
}catch(err){MP_Util.LogJSError(err,component,"homemedications-o2.js","getRouteJSON");
alert(i18n.discernabu.homemeds_o2.ROUTE_LIST_ERROR+": "+err.description);
}},formatDispQ:function(inVal){var nf=new mp_formatter.NumericFormatter(MPAGE_LOCALE);
var decSep=nf.lc.decimalPoint;
var thouSep=nf.lc.thousandsSep;
var decPos=inVal.lastIndexOf(decSep);
var thouPos=inVal.lastIndexOf(thouSep);
var intSec="";
var decSec="";
var numArr=inVal.split(decSep);
var localDispStr;
var apiVal;
var intParts;
if(numArr.length===2&&decPos>thouPos){intParts=numArr[0].split(thouSep);
numArr[0]=intParts.join("");
if(!isNaN(numArr[0])&&!isNaN(numArr[1])){intSec=numArr[0];
decSec=numArr[1];
}else{return[null,null];
}}else{if(numArr.length===1){intParts=numArr[0].split(thouSep);
numArr[0]=intParts.join("");
if(!isNaN(numArr[0])){intSec=numArr[0];
}else{return[null,null];
}}else{return[null,null];
}}if(decSec){localDispStr=intSec+decSep+decSec;
apiVal=intSec+"."+decSec;
}else{localDispStr=intSec;
apiVal=intSec;
}return[localDispStr,apiVal];
},getRowContentType:function(tableRow){var rowInfoDiv=Util.Style.g("hml2-info",tableRow,"span")[0];
var patRequestInd=rowInfoDiv.getAttribute("data-pat-request-ind");
return(parseInt(patRequestInd,10))?"REQUEST":"PRESCRIBED";
},medRowSel:function(e){var parentContSec=$(this).closest(".sec-content");
var idFromContSec=parseInt(parentContSec.attr("id").replace("hml2Content",""),10);
var medComp=MP_Util.GetCompObjById(idFromContSec);
var isMedModInd=medComp.isMedModInd();
var compNS=medComp.getStyles().getNameSpace();
medComp.setEditMode(true);
var medCompId=medComp.getComponentId();
var rootMedSecCont=medComp.getSectionContentNode();
var previousSelectedRows=Util.Style.g("hml2-med-selected",rootMedSecCont,"dl");
var currentRowType=CERN_HOME_MEDS_O2.getRowContentType(this);
var previousRowType="";
var curImg=null;
var curSrc=null;
var newSrc=null;
var i=0;
var j=0;
if(!e){e=window.event;
}var startRowType="REQUEST";
if(medComp.m_medModObj.lastMedSel){startRowType=CERN_HOME_MEDS_O2.getRowContentType($("#"+medComp.m_medModObj.lastMedSel.replace(/:/g,"\\:"))[0]);
}if(e.shiftKey&&medComp.m_medModObj.lastMedSel&&startRowType!=="REQUEST"){if(startRowType!=="REQUEST"&&currentRowType!=="REQUEST"){var startPos=_g(medComp.m_medModObj.lastMedSel);
var strtIndx;
var endIndx;
var componentTableElt=Util.Style.g("component-table",rootMedSecCont,"div")[0];
var medRows=Util.Style.g("result-info",componentTableElt,"dl");
var medLen=medRows.length;
for(i=0;
i<medLen;
i++){var curId=medRows[i].id;
if(curId==medComp.m_medModObj.lastMedSel){strtIndx=i;
}else{if(curId==this.id){endIndx=i;
}}}if(strtIndx>endIndx){var tempIndx=strtIndx;
strtIndx=endIndx;
endIndx=tempIndx;
}for(j=strtIndx;
j<=endIndx;
j++){Util.Style.acss(medRows[j],"hml2-med-selected");
CERN_HOME_MEDS_O2.addBackGroundToSelectedRow(this,compNS);
}}medComp.m_medModObj.lastMedSel=null;
}else{if(Util.Style.ccss(this,"hml2-med-selected")){Util.Style.rcss(this,"hml2-med-selected");
var formularyEle=$(this).find(".hml2-formulary");
if($(formularyEle).hasClass("hml2-wb")){$(formularyEle).removeClass("hml2-wb");
}Util.Style.rcss(this,"hml2-wb");
medComp.m_medModObj.lastMedSel=null;
}else{if(currentRowType==="REQUEST"){CERN_HOME_MEDS_O2.removeCurrentHighlightedRows(medComp,previousSelectedRows);
}else{if(previousSelectedRows.length){previousRowType=CERN_HOME_MEDS_O2.getRowContentType(previousSelectedRows[0]);
if(previousRowType==="REQUEST"){CERN_HOME_MEDS_O2.removeCurrentHighlightedRows(medComp,previousSelectedRows);
medComp.m_sidePanel.m_cornerCloseButton.click();
}}}var componentTable=$("#hml2"+medCompId+"tableBody");
componentTable.find(".mpage-tooltip-hover").each(function(){var childCell=$(this).children().first();
CERN_HOME_MEDS_O2.toggleTableCellHover(medComp,false,childCell);
});
Util.Style.acss(this,"hml2-med-selected");
CERN_HOME_MEDS_O2.addBackGroundToSelectedRow(this,compNS);
medComp.m_medModObj.lastMedSel=this.id;
}}var selectedRows=Util.Style.g("hml2-med-selected",rootMedSecCont,"dl");
var selectLen=selectedRows.length;
if(selectLen>0){if(selectLen==1&&!medComp.m_medModObj.m_editMode){var hml2Dets=Util.Style.g("hvr");
var detLen=hml2Dets.length;
for(i=detLen;
i--;
){hml2Dets[i].style.display="none";
}}medComp.setEditMode(true);
if(medComp.inMillennium&&currentRowType!=="REQUEST"&&isMedModInd){CERN_HOME_MEDS_O2.enableActions(medComp);
}var activeRowsFound=false;
for(j=0;
j<selectLen;
j++){if(Util.Style.ccss(selectedRows[j],"hml2-rnwd")||Util.Style.ccss(selectedRows[j],"hml2-cncld")||Util.Style.ccss(selectedRows[j],"hml2-cmplt")){activeRowsFound=true;
}}if(!activeRowsFound&&isMedModInd){medComp.compMenuReference["compMenuReset"+medCompId].setIsDisabled(true);
}}else{var rnwdLen=Util.Style.g("hml2-rnwd",rootMedSecCont,"dl").length;
var cncldLen=Util.Style.g("hml2-cncld",rootMedSecCont,"dl").length;
var cmpltLen=Util.Style.g("hml2-cmplt",rootMedSecCont,"dl").length;
if(rnwdLen===0&&cncldLen===0&&cmpltLen===0){medComp.setEditMode(false);
}if(medComp.inMillennium&&isMedModInd){CERN_HOME_MEDS_O2.disableActions(medComp);
}}CERN_HOME_MEDS_O2.showHidePanel(selectedRows,medComp);
},showHidePanel:function(selectedRows,medsCompObj){var numSelectedRows=selectedRows.length;
var sidePanel=medsCompObj.m_sidePanel;
var compId=medsCompObj.m_componentId;
var rowType=CERN_HOME_MEDS_O2.getRowContentType(selectedRows[0]);
if(numSelectedRows===0){sidePanel.m_cornerCloseButton.click();
return;
}var $container=$("#sidePanelAlertBanner"+compId);
$container.find(".alert-msg").remove();
if(!medsCompObj.m_sidePanelShowing&&rowType==="REQUEST"){var sidePanelContainer=_g("hml2"+compId+"sidePanelContainer");
var tableObj=_g("hml2"+compId+"table");
var footerObj=$("#hml2Ftr"+compId);
if(tableObj.classList){tableObj.classList.add("hml2-table-with-panel");
}else{tableObj.className+=" hml2-table-with-panel";
}footerObj.addClass("hml2-footer-with-panel");
var tableHeight=tableObj.offsetHeight;
var footerHeight=footerObj.outerHeight();
sidePanel.setHeight(tableHeight+"px");
sidePanel.setMinHeight(tableHeight+"px");
sidePanel.resizePanel((tableHeight+footerHeight)+"px");
sidePanelContainer.style.display="inline-block";
medsCompObj.m_sidePanelShowing=true;
sidePanel.showPanel();
}sidePanel.expandSidePanel();
CERN_HOME_MEDS_O2.renderSingleSidePanel(selectedRows,medsCompObj);
},buildPatRequestSection:function(order,component){var interopData=order.INTEROP[0];
var componentId=component.getComponentId();
var codeArray=MP_Util.LoadCodeListJSON(component.allData.CODES);
var hmI18n=i18n.discernabu.homemeds_o2;
var patRequestHtml="";
var requestType=null;
var df=CERN_HOME_MEDS_O2.getDateFormatter();
var dateTime=new Date();
var displayTime="--";
if(order.INTEROP.length&&interopData.SUBMITTED_ON){dateTime.setISO8601(interopData.SUBMITTED_ON);
displayTime=dateTime.format("mediumDate")+" "+dateTime.format("militaryTime");
}var patientComment=order.COMMENTS.ORDER_COMMENT;
var prescribingPhysician=(interopData.PHYSICIAN.PHYSICIAN)?interopData.PHYSICIAN.PHYSICIAN:"--";
var sectionHeader="";
var sectionInfo="";
if(interopData.REQUEST_TYPE){requestType=MP_Util.GetValueFromArray(interopData.REQUEST_TYPE,codeArray).meaning;
}else{return"";
}var medsHistoryLinkHTML=CERN_HOME_MEDS_O2.createMedsHistoryHTML(component,requestType,order);
var patientCodeValue=MP_Util.GetCodeValueByMeaning("PROXY",4003506);
var patientProxyCodeValue=MP_Util.GetCodeValueByMeaning("PATIENT",4003506);
var submittedSourceCode=interopData.SUBMITTED_BY_TYPE;
var originatingSourceDisplay="--";
switch(submittedSourceCode){case patientCodeValue.codeValue:originatingSourceDisplay=patientCodeValue.display;
break;
case patientProxyCodeValue.codeValue:originatingSourceDisplay=patientProxyCodeValue.display;
break;
}var commentText=(interopData.COMMENTS.length?interopData.COMMENTS[0].COMMENT:"--");
var originatingAuthor=interopData.SUBMITTED_BY_NAME||"--";
if(requestType==="ADD"){sectionHeader=hmI18n.ADDITIONS;
sectionInfo+="<dl>"+medsHistoryLinkHTML+'</dl><dl class="hml2-detail-group"><dt class="hml2-detail-label secondary-text hml2-status-mod">'+hmI18n.COMPLIANCE+"</dt><dd>"+interopData.STATUS.STATUS_CODE.LABEL+'</dd></dl><dl class="hml2-detail-group"><dt class="hml2-detail-label secondary-text hml2-status-mod">'+hmI18n.PRESCRIBING_PHYSICIAN+"</dt><dd>"+prescribingPhysician+'</dd></dl><dl class="hml2-detail-group"></dl><dl class="hml2-detail-group"><dt class="hml2-detail-label secondary-text hml2-status-mod">'+hmI18n.ORIGINATING_SOURCE+"</dt><dd>"+originatingSourceDisplay+'</dd></dl><dl class="hml2-detail-group"><dt class="hml2-detail-label secondary-text hml2-status-mod">'+hmI18n.ORIGINATING_AUTHOR+"</dt><dd>"+originatingAuthor+'</dd></dl><dl><dt class="hml2-detail-label"></dt><dd class="hml2-status-mod">'+hmI18n.PATIENT_COMMENT+"</dd></dl><dl><dd>"+commentText+"</dd></dl>";
}else{if(requestType==="UPDATE"){sectionHeader=hmI18n.MODIFICATIONS;
sectionInfo+=CERN_HOME_MEDS_O2.createMedsHistoryHTML(component,requestType,order);
sectionInfo+='<dl class="hml2-detail-group"><dt class="hml2-detail-label secondary-text hml2-status-mod">'+hmI18n.ORIGINATING_SOURCE+"</dt><dd>"+originatingSourceDisplay+'</dd></dl><dl class="hml2-detail-group"><dt class="hml2-detail-label secondary-text hml2-status-mod">'+hmI18n.ORIGINATING_AUTHOR+"</dt><dd>"+originatingAuthor+'</dd></dl><dl><dt class="hml2-detail-label"></dt><dd class="hml2-status-mod">'+hmI18n.PATIENT_COMMENT+"</dd></dl><dl><dd>"+commentText+"</dd></dl>";
}}patRequestHtml+='<div id="patRe" class="hml2-detail-section sp-body-contents-padding"><dl><dt class="hml2-detail-label secondary-text hlm2-expand-content-section"><span class="hml2-side-panel-tgl hml2-hide-expand-btn" title="Collapse">-</span><span class="hml2-pat-req-icon">&nbsp;</span><span>'+hmI18n.OUTSIDE_REQUESTS+'</span><span class="hml2-detail-group hml2-pull-right">'+displayTime+'</span></dt></dl><div class="hml2-expand-content"><dl><dt class="hml2-detail-label"></dt><dd class="hml2-status-mod">'+sectionHeader+"</dd></dl><div>"+sectionInfo+"</div></div></div>";
if(requestType==="UPDATE"){patRequestHtml+='<div class="sp-separator2">&nbsp;</div>';
}return patRequestHtml;
},setMedicationRows:function(orders,component){var medCount=orders.length;
component.m_patientRequestList=[];
component.m_otherCharMedsList=[];
for(var i=0;
i<medCount;
i++){var medOrder=orders[i];
if(medOrder.INTEROP.length){component.m_patientRequestList.push(medOrder);
}else{component.m_otherCharMedsList.push(medOrder);
}}},renderSingleSidePanel:function(selectedRow,medsCompObj){var orders=[];
var sidePanel=medsCompObj.m_sidePanel;
var compId=medsCompObj.m_componentId;
var hmI18n=medsCompObj.m_home_meds_i18n;
var df=CERN_HOME_MEDS_O2.getDateFormatter();
var codeArray=MP_Util.LoadCodeListJSON(medsCompObj.allData.CODES);
var personnelArray=MP_Util.LoadPersonelListJSON(medsCompObj.allData.PRSNL);
var rowOrderInfo={};
var selectedRowInfo=Util.Style.g("hml2-info",selectedRow[0],"span")[0];
var rowType=CERN_HOME_MEDS_O2.getRowContentType(selectedRow[0]);
orders=medsCompObj.getAllOrders();
var orderId=selectedRowInfo.getAttribute("data-order-id");
var extDataId=selectedRowInfo.getAttribute("ext-data-info-id");
var patRequestSectionHTML="";
if(rowType==="REQUEST"){orders=medsCompObj.m_patientRequestList;
}else{orders=medsCompObj.m_otherCharMedsList;
}if(orderId!=0){for(var x=0;
x<orders.length;
x++){if(orderId==orders[x].CORE.ORDER_ID){rowOrderInfo=orders[x];
break;
}}}else{for(var x=0;
x<orders.length;
x++){if(orders[x].INTEROP.length>=1){if(extDataId==orders[x].INTEROP[0].EXT_DATA_INFO_ID){rowOrderInfo=orders[x];
break;
}}}}var lastDoseDate="--";
var medOrigDate="--";
var dateTime=new Date();
var respProv="--";
if(rowOrderInfo.DETAILS.LAST_DOSE_DT_TM!==""){dateTime.setISO8601(rowOrderInfo.DETAILS.LAST_DOSE_DT_TM);
lastDoseDate=df.format(dateTime,mp_formatter.DateTimeFormatter.FULL_DATE_4YEAR);
}var compComment=(rowOrderInfo.DETAILS.COMPLIANCE_COMMENT)?rowOrderInfo.DETAILS.COMPLIANCE_COMMENT:"--";
if(rowOrderInfo.SCHEDULE.ORIG_ORDER_DT_TM!==""){dateTime.setISO8601(rowOrderInfo.SCHEDULE.ORIG_ORDER_DT_TM);
medOrigDate=df.format(dateTime,mp_formatter.DateTimeFormatter.FULL_DATE_4YEAR);
}if(rowOrderInfo.CORE.RESPONSIBLE_PROVIDER_ID>0){var provider=MP_Util.GetValueFromArray(rowOrderInfo.CORE.RESPONSIBLE_PROVIDER_ID,personnelArray);
respProv=provider.fullName;
}var medType=CERN_HOME_MEDS_O2.getHomeMedicationType(rowOrderInfo)||"--";
var ordComment=(rowOrderInfo.COMMENTS.ORDER_COMMENT)?rowOrderInfo.COMMENTS.ORDER_COMMENT.replace(/\n/g,"<br />"):"--";
if(rowType==="REQUEST"){patRequestSectionHTML=CERN_HOME_MEDS_O2.buildPatRequestSection(rowOrderInfo,medsCompObj);
}var contentHTML="<div id='sidePanelScrollContainer"+compId+"'>"+patRequestSectionHTML+"<div class='hml2-detail-section'>";
var patReqType=null;
if(rowOrderInfo.INTEROP.length){patReqType=MP_Util.GetValueFromArray(rowOrderInfo.INTEROP[0].REQUEST_TYPE,codeArray).meaning;
}if(patReqType==="UPDATE"){contentHTML+="<dl class='hml2-detail-group'><dt class='hml2-detail-label secondary-text hml2-status-mod'>"+hmI18n.LAST_DOSE+"</dt><dd>"+lastDoseDate+"</dd></dl><dl class='hml2-detail-group'><dt class='hml2-detail-label secondary-text hml2-status-mod'>"+hmI18n.COMPLIANCE_COMMENT+"</dt><dd>"+compComment+"</dd></dl></div><div class='sp-separator2'>&nbsp;</div><div class='hml2-detail-section'><dl class='hml2-detail-group'><dt class='hml2-detail-label secondary-text'>"+hmI18n.ORDER_DATE+"</dt><dd>"+medOrigDate+"</dd></dl><dl class='hml2-detail-group'><dt class='hml2-detail-label secondary-text'>"+hmI18n.RESPONSIBLE_PROVIDER+"</dt><dd>"+respProv+"</dd></dl><dl><dt class='hml2-detail-label secondary-text'>"+hmI18n.TYPE+"</dt><dd>"+medType+"</dd></dl></div></div>";
}sidePanel.setTitleText(rowOrderInfo.DISPLAYS.DISPLAY_NAME);
if(rowType==="REQUEST"){CERN_HOME_MEDS_O2.createRemoveRequestButton(medsCompObj,selectedRow,rowOrderInfo,sidePanel);
}sidePanel.setSubtitleText(rowOrderInfo.DISPLAYS.CLINICAL_DISPLAY_LINE);
sidePanel.setContents(contentHTML,"hml2Content"+compId);
if(rowType==="REQUEST"&&(patReqType==="ADD"||"UPDATE")){$("#sidePanelScrollContainer"+compId).on("click",".pat-req-meds-hx-link",function(){medsCompObj.m_sidePanel.m_cornerCloseButton.click();
CERN_HOME_MEDS_O2.launchMedsHistory(medsCompObj);
});
}var sidePanelContainer=$("#sidePanel"+compId);
sidePanelContainer.on("click",".hml2-side-panel-tgl",function(event){if(event.target&&event.target.parentElement.className==="hml2-detail-label secondary-text hlm2-expand-content-section"){var patReqSubSection=sidePanelContainer.find(".hml2-expand-content");
if(patReqSubSection.hasClass("hml2-closed")){patReqSubSection.removeClass("hml2-closed");
$(this).removeClass("hml2-show-expand-btn").addClass("hml2-hide-expand-btn");
var sPanelExpander=$("#sidePanelExpandCollapse"+compId);
sPanelExpander.removeClass("hidden");
if(sPanelExpander.children().hasClass("sp-expand")){sPanelExpander.click();
}}else{patReqSubSection.addClass("hml2-closed");
$(this).removeClass("hml2-hide-expand-btn").addClass("hml2-show-expand-btn");
}}});
},displayRemoveRequestErrorBanner:function(component){var sidePanel=component.m_sidePanel;
var alertBanner=new MPageUI.AlertBanner();
var hmI18n=component.m_home_meds_i18n;
sidePanel.setAlertBannerAsHTML("");
alertBanner.setType(MPageUI.ALERT_OPTIONS.TYPE.ERROR);
alertBanner.setPrimaryText(hmI18n.REMOVE_REQUEST_ACTION_ERROR);
sidePanel.setAlertBannerAsHTML(alertBanner.render());
},renderMultiRowSidePanel:function(selectedRows,medsCompObj){var sidePanel=medsCompObj.m_sidePanel;
var compId=medsCompObj.m_componentId;
var hmI18n=medsCompObj.m_home_meds_i18n;
var rowCount=selectedRows.length;
var itemsSelectedText=hmI18n.ITEMS_SELECTED.replace("{0}",rowCount);
sidePanel.setTitleText(itemsSelectedText);
sidePanel.removeSubtitle();
sidePanel.setContents("<div class='sp-multiple-items-icon'>&nbsp;</div>","hml2Content"+compId);
},addBackGroundToSelectedRow:function(row,compNS){var formularyRow=$(row).find(".hml2-formulary");
if($(formularyRow).children().length){var unknownRating=$(formularyRow).find(".health-plan-unknown");
if(unknownRating.length&&!$(unknownRating).text()){return;
}$(formularyRow).addClass("hml2-wb");
}},enableActions:function(medComp){var criterion=medComp.getCriterion();
var ipath=criterion.static_content;
var medCompId=medComp.m_medModObj.medModCompId;
var compID=medComp.getComponentId();
_g("medRnwBtn"+medCompId).disabled=false;
_g("medCnclBtn"+medCompId).disabled=false;
_g("medCmpltBtn"+medCompId).disabled=false;
_g("medRnwImg"+medCompId).src=ipath+"/images/renew.gif";
_g("medCnclImg"+medCompId).src=ipath+"/images/cancel.gif";
_g("medCmpltImg"+medCompId).src=ipath+"/images/complete.gif";
medComp.compMenuReference["compMenuRenew"+compID].setIsDisabled(false);
medComp.compMenuReference["compMenuCancel"+compID].setIsDisabled(false);
medComp.compMenuReference["compMenuComplete"+compID].setIsDisabled(false);
},appendNoHealthPlanContainer:function(compId){var component=MP_Util.GetCompObjById(compId);
var noHealthPlanDiv=_g("hml2"+compId+"NoHealthPlans");
if(noHealthPlanDiv){return;
}noHealthPlanDiv=Util.cep("div",{className:"message-container",id:"hml2"+compId+"NoHealthPlans"});
var m_contentNode=component.getRootComponentNode();
if(m_contentNode){var m_contentNodeHd=_gbt("H2",m_contentNode)[0];
Util.ia(noHealthPlanDiv,m_contentNodeHd);
}component.m_base.setAlertMessageElementId(noHealthPlanDiv);
},disableActions:function(medComp){var criterion=medComp.getCriterion();
var ipath=criterion.static_content;
var medCompId=medComp.m_medModObj.medModCompId;
var compID=medComp.getComponentId();
_g("medRnwBtn"+medCompId).disabled=true;
_g("medCnclBtn"+medCompId).disabled=true;
_g("medCmpltBtn"+medCompId).disabled=true;
_g("medRnwImg"+medCompId).src=ipath+"/images/renew_disabled.gif";
_g("medCnclImg"+medCompId).src=ipath+"/images/cancel_disabled.gif";
_g("medCmpltImg"+medCompId).src=ipath+"/images/complete_disabled.gif";
medComp.compMenuReference["compMenuRenew"+compID].setIsDisabled(true);
medComp.compMenuReference["compMenuCancel"+compID].setIsDisabled(true);
medComp.compMenuReference["compMenuComplete"+compID].setIsDisabled(true);
medComp.compMenuReference["compMenuReset"+compID].setIsDisabled(true);
},queueOrder:function(e){if(Util.Style.ccss(this,"hml2-dthrd")||Util.Style.ccss(this,"opts-menu-item-dthr")){if(!e){e=window.event;
}Util.cancelBubble(e);
}else{var medCompId=parseInt(this.id.replace(/[^\d]/g,""),10);
var medComp=MP_Util.GetCompObjById(medCompId);
var criterion=medComp.getCriterion();
var ipath=criterion.static_content;
var rootMedSecCont=medComp.getSectionContentNode();
var hmI18n=i18n.discernabu.homemeds_o2;
var rtUid="";
var rType;
if(this.id==("medRnwBtn"+medCompId)||this.id==("mnuRenew"+medCompId)){rType="hml2-rnwd";
}else{if(this.id==("medCnclBtn"+medCompId)||this.id==("mnuCancel"+medCompId)){rType="hml2-cncld";
}else{if(this.id==("medCmpltBtn"+medCompId)||this.id==("mnuComplete"+medCompId)){rType="hml2-cmplt";
}}}if(rType==="hml2-rnwd"&&medComp.getInitialRenew()){var isLoadSuccess=true;
var componentTableElt=Util.Style.g("component-table",rootMedSecCont,"div")[0];
var allRows=Util.Style.g("result-info",componentTableElt,"dl");
var allRowsLen=allRows.length;
var renewOrdIdsJson=null;
if(allRowsLen){renewOrdIdsJson="{ 'RENEW_ORDER_RECORD' : {'RENEWABLE_ORDERS':[";
for(var rowIndx=0;
rowIndx<allRowsLen;
rowIndx++){var orderInfo=Util.Style.g("hml2-info",allRows[rowIndx],"span")[0];
var orderId=orderInfo.getAttribute("data-order-id");
var synonymId=orderInfo.getAttribute("data-synonymId");
renewOrdIdsJson+="{'ORDER_ID':"+orderId+".0,'SYNONYM_ID' :"+synonymId+".0}";
if(rowIndx<allRowsLen-1){renewOrdIdsJson+=",";
}}renewOrdIdsJson+="]}}";
}var renewTimer=new RTMSTimer("USR:MPG.HOME_MEDS.O2 - renew action");
var renewRequest=new ScriptRequest();
var compBase=medComp.m_base;
renewRequest.setProgramName("mp_get_home_medications_renew");
renewRequest.setParameterArray(["^MINE^","^"+renewOrdIdsJson+"^"]);
renewRequest.setAsyncIndicator(false);
renewRequest.setResponseHandler(function(scriptReply){var renewReply=scriptReply.getResponse();
if(renewReply.STATUS_DATA.STATUS==="S"){var orders=renewReply.ORDERS;
CERN_HOME_MEDS_O2.addRenewData(medCompId,allRows,orders);
medComp.setInitialRenew(false);
}else{isLoadSuccess=false;
}});
renewRequest.setLoadTimer(renewTimer);
renewRequest.performRequest();
if(!isLoadSuccess){var errorModal=MP_ModalDialog.retrieveModalDialogObject("errorModal");
if(!errorModal){var refreshButton=null;
var cancelButton=null;
errorModal=MP_Util.generateModalDialogBody("errorModal","error",hmI18n.RENEW_SCRIPT_ERROR,hmI18n.RENEW_SCRIPT_ERROR_ACTION);
errorModal.setHeaderTitle(i18n.ERROR_OCCURED);
refreshButton=new ModalButton("refreshButton");
refreshButton.setText(i18n.REFRESH).setCloseOnClick(true);
refreshButton.setOnClickFunction(function(){medComp.InsertData();
});
errorModal.addFooterButton(refreshButton);
cancelButton=new ModalButton("cancelButton");
cancelButton.setText(i18n.CANCEL).setCloseOnClick(true);
errorModal.addFooterButton(cancelButton);
}else{errorModal=MP_Util.generateModalDialogBody("errorModal","error",hmI18n.RENEW_SCRIPT_ERROR,hmI18n.RENEW_SCRIPT_ERROR_ACTION);
}MP_ModalDialog.updateModalDialogObject(errorModal);
MP_ModalDialog.showModalDialog("errorModal");
return;
}}var selectedRows=Util.Style.g("hml2-med-selected",rootMedSecCont,"dl");
medComp.m_base.setSelectedRows(selectedRows);
var selRowLen=selectedRows.length;
for(var i=0;
i<selRowLen;
i++){var selRow=selectedRows[i];
var origDispQty;
var origRflQty;
var curDispQ=Util.Style.g("hml2-disp-q",selRow,"span")[0];
if(curDispQ){origDispQty=Util.Style.g("hml2-dq-qty",curDispQ,"span")[0].innerHTML;
if(rType==="hml2-rnwd"){Util.Style.rcss(curDispQ,"hml2-hide-sig-line");
}Util.Style.acss(curDispQ,"hml2-disp-q-rnw");
Util.addEvent(curDispQ,"click",CERN_HOME_MEDS_O2.changeDispQ);
}var curRfl=Util.Style.g("hml2-rfl",selRow,"span")[0];
if(curRfl){if(rType==="hml2-rnwd"){Util.Style.rcss(curRfl,"hml2-hide-sig-line");
}Util.Style.acss(curRfl,"hml2-rfl-rnw");
origRflQty=parseInt(curRfl.innerHTML,10);
Util.addEvent(curRfl,"click",CERN_HOME_MEDS_O2.changeRfl);
}var prevRt=Util.Style.g("hml2-rt-spn",selRow,"span")[0];
if(prevRt){if(rType=="hml2-cncld"||rType=="hml2-cmplt"){Util.de(prevRt);
}}else{if(rType=="hml2-rnwd"){var curDur=Util.Style.g("hml2-dur",selRow,"span")[0];
if(curDur){if(!medComp.m_medModObj.jsonRoutes){CERN_HOME_MEDS_O2.getRouteJSON(medComp);
}var curCatCode=(Util.Style.g("hml2-cat-cd",selRow,"span")[0]).innerHTML;
if(medComp.m_medModObj.jsonRoutes[curCatCode]){var routeInfo=CERN_HOME_MEDS_O2.searchRoutes(curCatCode,null,medComp);
var defRoute=routeInfo[3];
var routeFrag=Util.cep("span",{className:"hml2-rt-spn"});
rtUid=routeInfo[0]+routeInfo[1]+routeInfo[2];
routeFrag.innerHTML='<span class="hml2-route-opt-spn">'+defRoute+'</span><span class="hml2-rt-uid cat-'+curCatCode+'">'+rtUid+"</span>";
Util.addEvent(routeFrag,"click",CERN_HOME_MEDS_O2.routeSelect);
curDur.parentNode.insertBefore(routeFrag,curDur);
}}}}var imgSpan=Util.Style.g("hml2-rx-hx",selRow,"span");
var curImg=Util.gc(imgSpan[0]);
if(!medComp.m_origOrder[selRow.id]){var origSrc;
if(curImg.src.search(/_selected/)>-1){origSrc=curImg.src.replace("_selected.gif",".gif");
}else{origSrc=curImg.src;
}CERN_HOME_MEDS_O2.setOrigOrder(medComp,selRow.id,origDispQty,origRflQty,origSrc);
}Util.Style.rcss(selRow,"hml2-med-selected");
Util.Style.rcss(selRow,"hml2-rnwd");
Util.Style.rcss(selRow,"hml2-cncld");
Util.Style.rcss(selRow,"hml2-cmplt");
Util.Style.acss(selRow,rType);
if(rType=="hml2-rnwd"){curImg.src=ipath+"/images/renew.gif";
}else{if(rType=="hml2-cncld"){curImg.src=ipath+"/images/cancel.gif";
}else{if(rType=="hml2-cmplt"){curImg.src=ipath+"/images/complete.gif";
}}}}if(rType==="hml2-rnwd"){CERN_HOME_MEDS_O2.appendNoHealthPlanContainer(medCompId);
if(medComp.m_base.getHealthPlanSelector()){if(medComp.m_base.getHealthPlanSelector().getCurrentPlan()){medComp.m_base.healthPlanSelectorCallback(medComp.m_base.getHealthPlanSelector().getCurrentPlan());
}}else{var rootNode=medComp.getRootComponentNode();
var lookBackContainer=$(rootNode).find(".sec-hd");
medComp.m_base.initializeHealthPlanSelector(lookBackContainer);
$(rootNode).find(".hml2-formulary").removeClass("hml2-hidden");
}}CERN_HOME_MEDS_O2.checkIntersection(rtUid,medComp);
_g("medSgnBtn"+medCompId).disabled=false;
var compID=medComp.getComponentId();
medComp.compMenuReference["compMenuGoto"+compID].setIsDisabled(false);
medComp.compMenuReference["compMenuSign"+compID].setIsDisabled(false);
var totRoutes=Util.Style.g("hml2-rt-uid",rootMedSecCont,"span").length;
if(totRoutes){Util.Style.rcss(_g("routeLink"+medCompId),"hml2-dthrd");
}CERN_HOME_MEDS_O2.disableActions(medComp);
medComp.compMenuReference["compMenuReset"+compID].setIsDisabled(false);
if(medComp.m_sidePanelShowing){medComp.m_sidePanel.m_cornerCloseButton.click();
}}Util.Style.rcss(this,"hml2-mnu-hvr");
},getRowForOrder:function(order,allRows){var index=0;
var orderRow=null;
var rowInfoElt=null;
var rowOrderId=null;
while((!orderRow)&&(index<allRows.length)){rowInfoElt=Util.Style.g("hml2-info",allRows[index],"span")[0];
rowOrderId=parseInt(rowInfoElt.getAttribute("data-order-id"),10);
if(rowOrderId===order.MEDICATION_INFORMATION.ORDER_ID){orderRow=allRows[index];
}index++;
}return orderRow;
},addRenewData:function(medCompId,allRows,orders){var ordLen=orders.length;
var hmI18n=i18n.discernabu.homemeds_o2;
for(var i=0;
i<ordLen;
i++){var curOrder=orders[i];
var curRow=CERN_HOME_MEDS_O2.getRowForOrder(curOrder,allRows);
if(curRow){var imgSpan=Util.Style.g("hml2-rx-hx",curRow,"span");
var imgClass=Util.gc(imgSpan[0]).className;
var documentedMedClass="";
if(imgClass!=="hml2-rx"){documentedMedClass="-hx";
}var ordMedInfo=curOrder.MEDICATION_INFORMATION;
var orderId=ordMedInfo.ORDER_ID;
var duration=ordMedInfo.DURATION;
var dispenseQty=ordMedInfo.DISPENSE_QTY;
var dispenseQtyUnit=ordMedInfo.DISPENSE_QTY_UNIT;
var dispenseQtyCd=ordMedInfo.DISPENSE_QTY_UNIT_CD;
var refillCount=ordMedInfo.NBR_REFILLS;
var cki=ordMedInfo.CKI;
var signatureLine=" ";
if(dispenseQty){var formattedDispenseQty=CERN_HOME_MEDS_O2.formatDispQ(dispenseQty);
if(formattedDispenseQty[0]){dispenseQty=formattedDispenseQty[0];
}else{dispenseQty=0;
}signatureLine+=' <span class="hml2-hide-sig-line hml2-disp-q'+documentedMedClass+'" id="dq'+medCompId+"_"+orderId+'"><span class="hml2-dq-qty" id="dqQty'+medCompId+"_"+orderId+'">'+dispenseQty+'</span><span class="hml2-dq-tp"> '+dispenseQtyUnit+"</span></span>";
}if(refillCount){if(parseInt(refillCount,10)){refillCount=parseInt(refillCount,10);
}else{refillCount=0;
}signatureLine+=' <span class="hml2-hide-sig-line hml2-rfl'+documentedMedClass+'" id="rfl'+medCompId+"_"+orderId+'">'+refillCount+" "+hmI18n.REFILLS+"</span>";
}else{if(imgClass=="hml2-rx"){refillCount=0;
signatureLine+=' <span class="hml2-hide-sig-line hml2-rfl" id="rfl'+medCompId+"_"+orderId+'">'+refillCount+" "+hmI18n.REFILLS+"</span>";
}}Util.Style.g("disp-rfl-cnt",curRow,"span")[0].innerHTML=signatureLine;
Util.Style.g("hml2-disp-qty-cd",curRow,"span")[0].innerHTML=dispenseQtyCd;
Util.Style.g("hml2-dur",curRow,"span")[0].innerHTML=duration;
var ckiFromRow=$(curRow).data("cki");
if(!ckiFromRow){$(curRow).attr("data-cki",cki);
}}}},setOrigOrder:function(medComp,ordId,dispQty,rflQty,rxType){medComp.m_origOrder[ordId]={};
medComp.m_origOrder[ordId].ordId=ordId;
medComp.m_origOrder[ordId].dispQty=dispQty;
medComp.m_origOrder[ordId].rflQty=rflQty;
medComp.m_origOrder[ordId].rxType=rxType;
},searchRoutes:function(curCatCode,uid,medComp){var fieldDispVal,fieldVal,meanId,defRoute;
var curCatList=medComp.m_medModObj.jsonRoutes[curCatCode];
var hmI18n=i18n.discernabu.homemeds_o2;
var i=0;
if(curCatList.pharmacies.length){var pharms=curCatList.pharmacies;
var phLen=pharms.length;
for(i=phLen;
i--;
){var curPharm=pharms[i];
if(uid){if(uid==curPharm.fieldDispValue+curPharm.fieldValue+curPharm.meanId){defRoute=curPharm.display;
return[curPharm.fieldDispValue,curPharm.fieldValue,curPharm.meanId,defRoute];
}}else{if(curPharm.bDefault){defRoute=curPharm.display;
return[curPharm.fieldDispValue,curPharm.fieldValue,curPharm.meanId,defRoute];
}}}}if(!defRoute){if(curCatList.printers.length){var printers=curCatList.printers;
var prLen=printers.length;
for(i=prLen;
i--;
){var curPrint=printers[i];
if(uid){if(uid==curPrint.fieldDispValue+curPrint.fieldValue+curPrint.meanId){defRoute=curPrint.display;
return[curPrint.fieldDispValue,curPrint.fieldValue,curPrint.meanId,defRoute];
}}else{if(curPrint.bDefault){defRoute=curPrint.display;
return[curPrint.fieldDispValue,curPrint.fieldValue,curPrint.meanId,defRoute];
}}}}}if(!defRoute){if(curCatList.doNotSendReasons.length){var dns=curCatList.doNotSendReasons;
var dnsLen=dns.length;
for(i=dnsLen;
i--;
){var curDns=dns[i];
if(uid){if(uid==curDns.fieldDispValue+curDns.fieldValue+curDns.meanId){defRoute=curDns.display;
return[curDns.fieldDispValue,curDns.fieldValue,curDns.meanId,defRoute];
}}else{if(curDns.bDefault){defRoute=hmI18n.DNS_LABEL+": "+curDns.display;
return[curDns.fieldDispValue,curDns.fieldValue,curDns.meanId,defRoute];
}}}}}if(!uid){return[null,null,null,hmI18n.NO_DEFAULTS];
}},searchRouteInt:function(curCatCode,uid,interType,medComp){var curCatList=medComp.m_medModObj.jsonRoutes[curCatCode];
var i=0;
if(interType==="pharmInt"){if(curCatList.pharmacies){var pharms=curCatList.pharmacies;
var phLen=pharms.length;
for(i=0;
i<phLen;
i++){var curPharm=pharms[i];
if(uid==curPharm.fieldDispValue+curPharm.fieldValue+curPharm.meanId){return curPharm;
}}}}else{if(interType==="printInt"){if(curCatList.printers){var printers=curCatList.printers;
var prLen=printers.length;
for(i=0;
i<prLen;
i++){var curPrint=printers[i];
if(uid==curPrint.fieldDispValue+curPrint.fieldValue+curPrint.meanId){return curPrint;
}}}}else{if(interType==="dnsInt"){if(curCatList.doNotSendReasons){var dns=curCatList.doNotSendReasons;
var dnsLen=dns.length;
for(i=0;
i<dnsLen;
i++){var curDns=dns[i];
if(uid==curDns.fieldDispValue+curDns.fieldValue+curDns.meanId){return curDns;
}}}}}}},checkIntersection:function(inUid,medComp){var medCompId=medComp.m_medModObj.medModCompId;
var jsonRoutes=medComp.m_medModObj.jsonRoutes;
var uids=Util.Style.g("hml2-rt-uid",_g("hml2"+medCompId),"span");
var uLen=uids.length;
var rtLink=_g("routeLink"+medCompId);
var hmI18n=i18n.discernabu.homemeds_o2;
var catCd=null;
if(uLen===0){rtLink.onclick=null;
rtLink.innerHTML=hmI18n.MED_NONE_SELECTED;
}else{var defRoute=Util.gps(uids[0]).innerHTML;
if(uLen===1){var uid=uids[0].innerHTML;
rtLink.innerHTML='<span class="hml2-route-opt-spn">'+defRoute+'</span><span class="hml2-defrt-uid">'+uid+"</span>";
catCd=uids[0].className.replace("hml2-rt-uid cat-","");
jsonRoutes.intersectionList={};
jsonRoutes.intersectionList.pharmacies=jsonRoutes[catCd].pharmacies;
jsonRoutes.intersectionList.printers=jsonRoutes[catCd].printers;
jsonRoutes.intersectionList.doNotSendReasons=jsonRoutes[catCd].doNotSendReasons;
rtLink.onclick=CERN_HOME_MEDS_O2.routeSelect;
}else{var pharmIntersect=[];
var printIntersect=[];
var dnsIntersect=[];
var multi=false;
var matchUid;
var defUid;
if(inUid!=="reset"){defUid=inUid;
}else{defUid=uids[0].innerHTML;
}for(var i=0;
i<uLen;
i++){catCd=uids[i].className.replace("hml2-rt-uid cat-","");
if(i===0){pharmIntersect=jsonRoutes[catCd].pharmacies;
printIntersect=jsonRoutes[catCd].printers;
dnsIntersect=jsonRoutes[catCd].doNotSendReasons;
matchUid=uids[i].innerHTML;
}else{pharmIntersect=CERN_HOME_MEDS_O2.getIntersect(pharmIntersect,jsonRoutes[catCd].pharmacies,catCd,"pharmInt",medComp);
printIntersect=CERN_HOME_MEDS_O2.getIntersect(printIntersect,jsonRoutes[catCd].printers,catCd,"printInt",medComp);
dnsIntersect=CERN_HOME_MEDS_O2.getIntersect(dnsIntersect,jsonRoutes[catCd].doNotSendReasons,catCd,"dnsInt",medComp);
}if(matchUid!==uids[i].innerHTML){multi=true;
defUid=hmI18n.DEF_ROUTE_MULTI;
}}jsonRoutes.intersectionList={};
jsonRoutes.intersectionList.pharmacies=pharmIntersect;
jsonRoutes.intersectionList.printers=printIntersect;
jsonRoutes.intersectionList.doNotSendReasons=dnsIntersect;
if(multi){defRoute=hmI18n.DEF_ROUTE_MULTI;
}rtLink.onclick=CERN_HOME_MEDS_O2.routeSelect;
rtLink.innerHTML='<span class="hml2-route-opt-spn">'+defRoute+'</span><span class="hml2-defrt-uid">'+defUid+"</span>";
}}},getIntersect:function(list1,list2,catCd,interType,medComp){var intersection=[];
var tempUids=[];
var getCount=function(arr){var countObj={},len=arr.length,tmp;
for(var i=0;
i<len;
i++){tmp=countObj[arr[i]];
countObj[arr[i]]=tmp?tmp+1:1;
}return countObj;
};
var l1Len=list1.length;
var l2Len=list2.length;
for(var l1i=0;
l1i<l1Len;
l1i++){var curL1=list1[l1i];
var l1Uid=curL1.fieldDispValue+curL1.fieldValue+curL1.meanId;
tempUids.push(l1Uid);
}for(var l2i=0;
l2i<l2Len;
l2i++){var curL2=list2[l2i];
var l2Uid=curL2.fieldDispValue+curL2.fieldValue+curL2.meanId;
tempUids.push(l2Uid);
}var uidObj=getCount(tempUids);
for(var uid in uidObj){if(uidObj[uid]===2){intersection.push(CERN_HOME_MEDS_O2.searchRouteInt(catCd,uid,interType,medComp));
}}return intersection;
},routeSelect:function(){var medComp;
if(this.id){var idFromRouteLink=parseInt(this.id.replace("routeLink",""),10);
medComp=MP_Util.GetCompObjById(idFromRouteLink);
}else{var parentContSec=$(this).closest(".sec-content");
var idFromContSec=parseInt(parentContSec.attr("id").replace("hml2Content",""),10);
medComp=MP_Util.GetCompObjById(idFromContSec);
}var rtSpan=this;
var catCode;
var isIntList=false;
var medCompId=medComp.m_medModObj.medModCompId;
var i=0;
if(Util.Style.ccss(this,"hml2-rt-spn")){var catCodeEl=Util.gc(this,1);
catCode=catCodeEl.className.replace("hml2-rt-uid cat-","");
}else{catCode="intersectionList";
isIntList=true;
}var curUid=Util.gc(rtSpan,1).innerHTML;
var ofs=Util.goff(rtSpan);
medComp.m_medModObj.routeOpt=Util.gc(rtSpan);
medComp.m_medModObj.routeUid=Util.gc(rtSpan,1);
var pharmHTML="";
var printHTML="";
var dnsHTML="";
var extraPrinters=false;
var hmI18n=i18n.discernabu.homemeds_o2;
var jsonRoutes=medComp.m_medModObj.jsonRoutes;
if(!jsonRoutes){alert(hmI18n.NO_ROUTE_OPT);
}if(jsonRoutes[catCode]){var dispStr;
var rtClass="hml2-route-opt";
var curCatList=jsonRoutes[catCode];
var rtUid=null;
if(curCatList.pharmacies.length){var pharms=curCatList.pharmacies;
var phLen=pharms.length;
if(phLen>3){phLen=3;
}for(i=0;
i<phLen;
i++){var curPharm=pharms[i];
dispStr=curPharm.display;
rtUid=curPharm.fieldDispValue+curPharm.fieldValue+curPharm.meanId;
if(curUid==rtUid){rtClass+=" hml2-rt-sel";
}var addrs=curPharm.streetAddress;
pharmHTML+='<div class="hml2-rt-pharm '+rtClass+'" >'+dispStr+" - "+addrs+'</div><span class="hml2-rt-uid cat-'+catCode+'">'+rtUid+'</span><div class="hml2-rt-hover"><div class="hml2-rt-hover-hd">'+dispStr+" - "+curPharm.pharmNum+'</div><div class="hml2-rt-addr"><div>'+curPharm.streetAddress+"</div><div>"+curPharm.city+", "+curPharm.state+" "+curPharm.zip+"</div><div>"+curPharm.country+"</div></div><div>"+hmI18n.MED_MOD_TEL+": "+curPharm.tel+"</div><div>"+hmI18n.MED_MOD_FAX+": "+curPharm.fax+"</div></div>";
rtClass=rtClass.replace(" hml2-rt-sel","");
}}if(curCatList.printers.length){var printers=curCatList.printers;
var prLen=printers.length;
var curPrinter=null;
if(prLen<5){for(i=0;
i<prLen;
i++){curPrinter=printers[i];
dispStr=curPrinter.display;
rtUid=curPrinter.fieldDispValue+curPrinter.fieldValue+curPrinter.meanId;
if(curUid==rtUid){rtClass+=" hml2-rt-sel";
}printHTML+='<div class="hml2-rt-printer '+rtClass+'" >'+dispStr+'</div><span class="hml2-rt-uid cat-'+catCode+'">'+rtUid+"</span>";
rtClass=rtClass.replace(" hml2-rt-sel","");
}}else{for(i=0;
i<prLen;
i++){curPrinter=printers[i];
dispStr=curPrinter.display;
rtUid=curPrinter.fieldDispValue+curPrinter.fieldValue+curPrinter.meanId;
if(curUid==rtUid){rtClass+=" hml2-rt-sel";
}if(i==3){extraPrinters=true;
printHTML+='<div class="hml2-rt-more-printer hml2-route-opt" id="morePrinter'+medCompId+'">'+hmI18n.MORE_PRINTERS+"</div>";
printHTML+='<div class="hml2-rt-more-menu menu-hide cat'+catCode+'" id="morePrintMenu'+medCompId+'">';
printHTML+='<div class="hml2-rt-printer '+rtClass+'" >'+dispStr+'</div><span class="hml2-rt-uid cat-'+catCode+'">'+rtUid+"</span>";
}else{printHTML+='<div class="hml2-rt-printer '+rtClass+'" >'+dispStr+'</div><span class="hml2-rt-uid cat-'+catCode+'">'+rtUid+"</span>";
}rtClass=rtClass.replace(" hml2-rt-sel","");
}printHTML+="</div>";
}}if(curCatList.doNotSendReasons.length){var dns=curCatList.doNotSendReasons;
var dnsLen=dns.length;
if(dnsLen>3){dnsLen=3;
}for(i=0;
i<dnsLen;
i++){var curDNS=dns[i];
dispStr=curDNS.display;
rtUid=curDNS.fieldDispValue+curDNS.fieldValue+curDNS.meanId;
if(curUid==rtUid){rtClass+=" hml2-rt-sel";
}dnsHTML+='<div class="'+rtClass+'" >'+hmI18n.DNS_LABEL+": "+dispStr+'</div><span class="hml2-rt-uid cat-'+catCode+'">'+rtUid+"</span>";
rtClass=rtClass.replace(" hml2-rt-sel","");
}}}if(pharmHTML){pharmHTML+='<hr class="hml2-rt-hr" />';
}if(printHTML){printHTML+='<hr class="hml2-rt-hr" />';
}var routeMnu=Util.cep("div",{className:"hml2-rt-menu",id:"rtMnu"+medCompId});
if(!pharmHTML&&!printHTML&&!dnsHTML){routeMnu.innerHTML=hmI18n.NO_DEFAULTS;
}else{routeMnu.innerHTML=pharmHTML+printHTML+dnsHTML;
}var closeRtMnu=function(e){if(!e){e=window.event;
}if(!_g("morePrintDiv"+medCompId)){Util.de(this);
Util.cancelBubble(e);
}};
if(window.attachEvent){Util.addEvent(routeMnu,"mouseleave",closeRtMnu);
}else{Util.addEvent(routeMnu,"mouseout",closeRtMnu);
}var changeRoute=function(e){e=e||window.event;
var target=e.target||e.srcElement;
if(Util.Style.ccss(target,"hml2-rt-menu")){return;
}CERN_HOME_MEDS_O2.unHltRouteRow.call(target);
if(target.id!="morePrinter"+medCompId){if(target.nodeName.toLowerCase()==="div"&&Util.Style.ccss(target,"hml2-route-opt")){if(isIntList){var uids=Util.Style.g("hml2-rt-uid",_g("hml2"+medCompId),"span");
var uLen=uids.length;
var newRoute=target.innerHTML;
var newUid=Util.gns(target).innerHTML;
var catCodes=[];
var isPrinter=Util.Style.ccss(target,"hml2-rt-printer");
for(var i=0;
i<uLen;
i++){var curUid=uids[i];
if(isPrinter){var catCd=curUid.className.replace("hml2-rt-uid cat-","");
catCodes.push(catCd);
}Util.gps(curUid).innerHTML=newRoute;
curUid.innerHTML=newUid;
}CERN_HOME_MEDS_O2.checkIntersection(newUid,medComp);
if(isPrinter){CERN_HOME_MEDS_O2.orderPrinters(catCodes,newUid,medComp);
}}else{medComp.m_medModObj.routeOpt.innerHTML=target.innerHTML;
medComp.m_medModObj.routeUid.innerHTML=Util.gns(target).innerHTML;
CERN_HOME_MEDS_O2.checkIntersection(medComp.m_medModObj.routeUid.innerHTML,medComp);
}Util.cancelBubble(e);
Util.de(routeMnu);
var mPrintDiv=_g("morePrintDiv"+medCompId);
if(mPrintDiv){Util.de(mPrintDiv);
}}}};
Util.addEvent(routeMnu,"click",changeRoute);
var rtMenuRows=Util.Style.g("hml2-route-opt",routeMnu,"div");
var rtMnLen=rtMenuRows.length;
for(i=rtMnLen;
i--;
){Util.addEvent(rtMenuRows[i],"mouseover",CERN_HOME_MEDS_O2.hltRouteRow);
Util.addEvent(rtMenuRows[i],"mouseout",CERN_HOME_MEDS_O2.unHltRouteRow);
}Util.ac(routeMnu,document.body);
if(_g("morePrinter"+medCompId)){Util.addEvent(_g("morePrinter"+medCompId),"click",function(){CERN_HOME_MEDS_O2.showMorePrinters(this,isIntList,medComp);
});
}var vp=gvs();
if((ofs[0]+routeMnu.offsetWidth)>=vp[1]){routeMnu.style.left=(vp[1]-routeMnu.offsetWidth-5)+"px";
}else{routeMnu.style.left=ofs[0]+"px";
}routeMnu.style.top=($(this).offset().top+$(this).height())+"px";
Util.cancelBubble();
},hltRouteRow:function(){var parentId=Util.gp(this).id;
var idFromRouteMenu=parseInt(parentId.replace("rtMnu",""),10);
medComp=MP_Util.GetCompObjById(idFromRouteMenu);
var medCompId=medComp.m_medModObj.medModCompId;
if(this.id=="morePrinter"+medCompId){Util.Style.acss(this,"hml2-mp-hvr");
}else{Util.Style.acss(this,"hml2-mnu-hvr");
var mpBtn=_g("morePrinter"+medCompId);
if(mpBtn){if(Util.Style.ccss(mpBtn,"hml2-mp-hvr")){Util.Style.rcss(mpBtn,"hml2-mp-hvr");
}}}if(Util.Style.ccss(this,"hml2-rt-pharm")){var ofs=Util.goff(this);
var rtToolTip=Util.gns(Util.gns(this));
var thisWidth=this.offsetWidth;
var showRtDet=function(){var rtHTML=rtToolTip.innerHTML;
var rtWidth=rtToolTip.offsetWidth;
medComp.m_medModObj.rtDiv=Util.cep("div",{className:"hml2-rt-div"});
medComp.m_medModObj.rtDiv.innerHTML=rtHTML;
Util.ac(medComp.m_medModObj.rtDiv,document.body);
var divOfs=medComp.m_medModObj.rtDiv.offsetWidth+15;
var vpOfs=ofs[0]-divOfs;
if(vpOfs>0){medComp.m_medModObj.rtDiv.style.left=vpOfs+"px";
medComp.m_medModObj.ttArrow=Util.cep("span",{className:"hml2-tt-arr-lt"});
medComp.m_medModObj.ttArrow.style.left=(ofs[0]-18)+"px";
}else{medComp.m_medModObj.rtDiv.style.left=(ofs[0]+thisWidth+16)+"px";
medComp.m_medModObj.ttArrow=Util.cep("span",{className:"hml2-tt-arr-rt"});
medComp.m_medModObj.ttArrow.style.left=(ofs[0]+thisWidth+3)+"px";
}medComp.m_medModObj.rtDiv.style.top=(ofs[1]-5)+"px";
medComp.m_medModObj.ttArrow.style.top=(ofs[1]+2)+"px";
Util.ac(medComp.m_medModObj.ttArrow,document.body);
};
medComp.m_medModObj.rtTimer=setTimeout(showRtDet,500);
}},unHltRouteRow:function(){var rootId=CERN_HOME_MEDS_O2.searchParentByClass(this,"hml2-rt-menu");
var parentId=rootId.id;
var idFromRouteMenu=parseInt(parentId.replace("rtMnu",""),10);
medComp=MP_Util.GetCompObjById(idFromRouteMenu);
var medCompId=medComp.m_medModObj.medModCompId;
if(this.id==("morePrinter"+medCompId)){var mPrintDv=_g("morePrintDiv"+medCompId);
if(!mPrintDv){Util.Style.rcss(this,"hml2-mp-hvr");
}}else{Util.Style.rcss(this,"hml2-mnu-hvr");
}clearTimeout(medComp.m_medModObj.rtTimer);
Util.de(medComp.m_medModObj.rtDiv);
Util.de(medComp.m_medModObj.ttArrow);
},showMorePrinters:function(that,isIntList,medComp){var medCompId=medComp.m_medModObj.medModCompId;
if(_g("morePrintDiv"+medCompId)){Util.de(_g("morePrintDiv"+medCompId));
}else{var ofs=Util.goff(that);
var moreMenu=Util.gns(that);
var thisWidth=that.offsetWidth;
var mmClassName=moreMenu.className;
var catCode=mmClassName.replace("hml2-rt-more-menu menu-hide cat","");
var mpHTML=moreMenu.innerHTML;
var mpDiv=Util.cep("div",{className:"hml2-mp-div",id:"morePrintDiv"+medCompId});
mpDiv.innerHTML=mpHTML;
Util.ac(mpDiv,document.body);
var divOfs=mpDiv.offsetWidth;
var vpOfs=ofs[0]-divOfs;
if(vpOfs>0){mpDiv.style.left=(vpOfs-2)+"px";
Util.Style.acss(mpDiv,"hml2-mpd-lt");
}else{mpDiv.style.left=(ofs[0]+thisWidth+6)+"px";
Util.Style.acss(mpDiv,"hml2-mpd-rt");
}mpDiv.style.top=(ofs[1]-5)+"px";
var closePrintMnu=function(e){if(!e){e=window.event;
}Util.de(mpDiv);
var mpBtn=_g("morePrinter"+medCompId);
if(mpBtn){if(Util.Style.ccss(mpBtn,"hml2-mp-hvr")){Util.Style.rcss(mpBtn,"hml2-mp-hvr");
}}Util.cancelBubble(e);
};
var changePrinter=function(){var newPrinter=this.innerHTML;
var newUidEl=Util.gns(this);
var newUid=newUidEl.innerHTML;
var catCodes=[];
var i=0;
if(isIntList){var uids=Util.Style.g("hml2-rt-uid",_g("hml2"+medCompId),"span");
var uLen=uids.length;
for(i=0;
i<uLen;
i++){var catCd=uids[i].className.replace("hml2-rt-uid cat-","");
Util.gps(uids[i]).innerHTML=newPrinter;
uids[i].innerHTML=newUid;
catCodes.push(catCd);
}catCodes.push("intersectionList");
}else{medComp.m_medModObj.routeOpt.innerHTML=newPrinter;
medComp.m_medModObj.routeUid.innerHTML=newUid;
catCodes.push(newUidEl.className.replace("hml2-rt-uid cat-",""));
}CERN_HOME_MEDS_O2.checkIntersection(newUid,medComp);
CERN_HOME_MEDS_O2.orderPrinters(catCodes,newUid,medComp);
Util.de(mpDiv);
Util.de(_g("rtMnu"+medCompId));
Util.cancelBubble();
};
var mpOptions=Util.Style.g("hml2-rt-printer",_g("morePrintDiv"+medCompId),"div");
var mpoLen=mpOptions.length;
for(i=0;
i<mpoLen;
i++){Util.addEvent(mpOptions[i],"click",changePrinter);
}if(window.attachEvent){Util.addEvent(mpDiv,"mouseleave",closePrintMnu);
}else{Util.addEvent(mpDiv,"mouseout",closePrintMnu);
}var mpMenuRows=Util.Style.g("hml2-rt-printer",_g("morePrintDiv"+medCompId),"div");
var mpMnLen=mpMenuRows.length;
for(i=mpMnLen;
i--;
){Util.addEvent(mpMenuRows[i],"mouseover",CERN_HOME_MEDS_O2.hltMP);
Util.addEvent(mpMenuRows[i],"mouseout",CERN_HOME_MEDS_O2.unHltMP);
}}Util.cancelBubble();
},orderPrinters:function(catCodes,newUid,medComp){var jsonRoutes=medComp.m_medModObj.jsonRoutes;
var catCdLen=catCodes.length;
for(var j=0;
j<catCdLen;
j++){var catCode=catCodes[j];
if(jsonRoutes[catCode].printers.length){var printers=jsonRoutes[catCode].printers;
var prLen=printers.length;
for(var i=0;
i<prLen;
i++){var curPrinter=printers[i];
var rtUid=curPrinter.fieldDispValue+curPrinter.fieldValue+curPrinter.meanId;
if(rtUid===newUid){var prnToMove=printers.splice(i,1);
printers.splice(0,0,prnToMove[0]);
break;
}}}}},hltMP:function(){Util.Style.acss(this,"hml2-mnu-hvr");
},unHltMP:function(){Util.Style.rcss(this,"hml2-mnu-hvr");
},rflTblInit:function(e,tId,selTable){var tempTbl=Util.ce("span");
tempTbl.innerHTML=selTable;
document.body.appendChild(tempTbl);
var tblAdded=_g(tId);
var p=getPosition(e),top=p.y-10,left=p.x-25;
tblAdded.style.display="block";
tblAdded.style.left=left+"px";
tblAdded.style.top=top+"px";
var txtBox=_g("tb"+tId);
txtBox.select();
Util.addEvent(tblAdded,"click",function(e){if(!e){e=window.event;
}Util.cancelBubble(e);
});
return tblAdded;
},searchParentByClass:function(el,elClass){if(!el.parentNode){return el;
}el=el.parentNode;
while(el.parentNode&&!Util.Style.ccss(el,elClass)){el=el.parentNode;
}return el;
},changeDispQ:function(e){var pContentSec=CERN_HOME_MEDS_O2.searchParentByClass(this,"sec-content");
var idFromContentSec=parseInt(pContentSec.id.replace("hml2Content",""),10);
medComp=MP_Util.GetCompObjById(idFromContentSec);
var medCompId=medComp.m_medModObj.medModCompId;
if(!e){e=window.event;
}Util.cancelBubble(e);
var medIdFrag=medComp.m_medModObj.medModIdFrag;
var idStr=this.id;
var idNum=idStr.replace("dq"+medIdFrag,"");
var hml2InfoId="hml2Info"+medIdFrag+idNum;
var orderInfo=_g(hml2InfoId);
var pRow=CERN_HOME_MEDS_O2.searchParentByClass(orderInfo,"result-info");
var cDispQ=this;
if(Util.Style.ccss(pRow,"hml2-rnwd")){if(Util.Style.ccss(cDispQ,"hml2-disp-q-rnw")){var dqTab=cDispQ.innerHTML;
var dispSpnId=cDispQ.id;
var tId="Tbl"+cDispQ.id;
var qty=Util.Style.g("hml2-dq-qty",cDispQ,"span")[0].innerHTML;
var typ=Util.Style.g("hml2-dq-tp",cDispQ,"span")[0].innerHTML;
var curTable=_g(tId);
if(curTable){Util.Style.rcss(curTable,"hml2-hide-tbl");
}else{var selTable="<table class='hml2-hvr-tbl' id='"+tId+"'><tr><td class='hml2-ref-tab'><span class='hml2-rnw-t'>"+dqTab+"</span></td><td class='hml2-rt-crnr'></td></tr><tr class='hml2-row-hd'><td class='hml2-row-tl'>&nbsp; </td><td class='hml2-row-tr'>&nbsp;</td></tr><tr class='hml2-row'><td class='hml2-row-l' colspan='2'><input type='text' class='hml2-qty-txt' id='tb"+tId+"' value='"+qty+"' /><span>"+typ+"</span> </td></tr><tr class='hml2-row'><td class='hml2-row-l' colspan='2'>&nbsp; </td></tr><tr class='hml2-row-hd'><td class='hml2-row-bl'>&nbsp; </td><td class='hml2-row-br'>&nbsp;</td></tr></table>";
var tblAdded=CERN_HOME_MEDS_O2.rflTblInit(e,tId,selTable);
Util.Style.g("hml2-row-tl",tblAdded,"td")[0].style.width=cDispQ.offsetWidth;
var closeTbl=function(e){if(!e){e=window.event;
}var curQ=Util.Style.g("hml2-qty-txt",tblAdded,"input")[0].value;
var newQty;
var formatArr=CERN_HOME_MEDS_O2.formatDispQ(curQ);
if(formatArr[0]>0){newQty=formatArr[0];
Util.Style.acss(tblAdded,"hml2-hide-tbl");
Util.Style.g("hml2-dq-qty",_g(dispSpnId),"span")[0].innerHTML=newQty;
Util.cancelBubble(e);
}else{alert(i18n.discernabu.homemeds_o2.INVALID_QTY);
}Util.cancelBubble(e);
Util.de(tblAdded);
};
if(window.attachEvent){Util.addEvent(tblAdded,"mouseleave",closeTbl);
}else{Util.addEvent(tblAdded,"mouseout",closeTbl);
}var rtCorners=Util.Style.g("hml2-rt-crnr",tblAdded,"td");
Util.addEvent(rtCorners[0],"mouseover",closeTbl);
}}}},changeRfl:function(e){var pContentSec=CERN_HOME_MEDS_O2.searchParentByClass(this,"sec-content");
var idFromContentSec=parseInt(pContentSec.id.replace("hml2Content",""),10);
medComp=MP_Util.GetCompObjById(idFromContentSec);
var medCompId=medComp.m_medModObj.medModCompId;
if(!e){e=window.event;
}Util.cancelBubble(e);
var medIdFrag=medComp.m_medModObj.medModIdFrag;
var idStr=this.id;
var idNum=idStr.replace("rfl"+medIdFrag,"");
var hml2InfoId="hml2Info"+medIdFrag+idNum;
var orderInfo=_g(hml2InfoId);
var pRow=CERN_HOME_MEDS_O2.searchParentByClass(orderInfo,"result-info");
var cRfl=this;
if(Util.Style.ccss(pRow,"hml2-rnwd")){if(Util.Style.ccss(cRfl,"hml2-rfl-rnw")){var rflTab=cRfl.innerHTML;
var rflId=cRfl.id;
var tId="Tbl"+cRfl.id;
var qty=parseInt(rflTab,10);
var curRflTbl=_g(tId);
if(curRflTbl){Util.Style.rcss(curRflTbl,"hml2-hide-tbl");
}else{var hmI18n=i18n.discernabu.homemeds_o2;
var selTable="<table class='hml2-rfl-hvr-tbl' id='"+tId+"'><tr><td class='hml2-ref-tab'><span class='hml2-rnw-t'>"+rflTab+"</span></td><td class='hml2-rt-crnr'></td></tr><tr class='hml2-row-hd'><td class='hml2-row-tl'>&nbsp; </td><td class='hml2-row-tr'>&nbsp;</td></tr><tr class='hml2-row'><td class='hml2-row-l' colspan='2'><input type='text' class='hml2-qty-txt' id='tb"+tId+"' value='"+qty+"' /><span> "+hmI18n.REFILLS+"</span> </td></tr><tr class='hml2-row'><td class='hml2-row-l' colspan='2'><label><input type='checkbox' class='hml2-rfl-all' id='rflAll"+medCompId+"' value='Apply to All' />"+hmI18n.MED_APPLY_TO_ALL+"</label></td></tr><tr class='hml2-row-hd'><td class='hml2-row-bl'>&nbsp; </td><td class='hml2-row-br'>&nbsp;</td></tr></table>";
var tblAdded=CERN_HOME_MEDS_O2.rflTblInit(e,tId,selTable);
Util.Style.g("hml2-row-tl",tblAdded,"td")[0].style.width=cRfl.offsetWidth;
var closeRflTbl=function(e){if(!e){e=window.event;
}var newQty;
var origQty=Util.Style.g("hml2-qty-txt",tblAdded,"input")[0].value;
var rootMedSecCont=medComp.getSectionContentNode();
if(origQty=="0"){newQty=origQty;
}else{newQty=parseInt(origQty,10);
if(newQty<0){newQty=null;
}}if(newQty){var refillAll=_g("rflAll"+medCompId);
if(refillAll.checked){var allRenewals=Util.Style.g("hml2-rnwd",rootMedSecCont,"dl");
var renLen=allRenewals.length;
for(var i=renLen;
i--;
){var curRefill=Util.Style.g("hml2-rfl-rnw",allRenewals[i],"span");
if(curRefill[0]){curRefill[0].innerHTML=newQty+" "+hmI18n.REFILLS;
}}}else{_g(rflId).innerHTML=newQty+" "+hmI18n.REFILLS;
}Util.Style.acss(tblAdded,"hml2-hide-tbl");
Util.cancelBubble(e);
}else{alert(hmI18n.INVALID_QTY);
}Util.cancelBubble(e);
Util.de(tblAdded);
};
if(window.attachEvent){Util.addEvent(tblAdded,"mouseleave",closeRflTbl);
}else{Util.addEvent(tblAdded,"mouseout",closeRflTbl);
}var rtCorners=Util.Style.g("hml2-rt-crnr",tblAdded,"td");
Util.addEvent(rtCorners[0],"mouseover",closeRflTbl);
}}}},enableInfoButtonClick:function(component){var componentId=component.getComponentId();
$("#hml2Content"+componentId).find(".hml2-info-icon").click(function(e){e.stopPropagation();
var patId=$(this).attr("data-patId");
var encId=$(this).attr("data-encId");
var synonymId=$(this).attr("data-synonymId");
var priCriteriaCd=$(this).attr("data-priCriteriaCd");
var launchInfoBtnApp=CERN_Platform.getDiscernObject("INFOBUTTONLINK");
try{if(launchInfoBtnApp){launchInfoBtnApp.SetInfoButtonData(parseFloat(patId),parseFloat(encId),parseFloat(priCriteriaCd),1,2);
launchInfoBtnApp.AddMedication(parseFloat(synonymId));
launchInfoBtnApp.LaunchInfoButton();
}}catch(err){var error_name=(err.name)?err.name:"";
var error_msg=(err.message)?err.message:i18n.discernabu.INFO_BUTTON_ERROR_MSG;
MP_Util.LogError(error_name+error_msg);
var errorModal=MP_ModalDialog.retrieveModalDialogObject("errorModal");
if(!errorModal){errorModal=MP_Util.generateModalDialogBody("errorModal","error",error_msg,i18n.discernabu.INFO_BUTTON_ERROR_ACTION);
errorModal.setHeaderTitle(i18n.ERROR_OCCURED);
var closeButton=new ModalButton("closeButton");
closeButton.setText(i18n.CLOSE).setCloseOnClick(true);
errorModal.addFooterButton(closeButton);
}MP_ModalDialog.updateModalDialogObject(errorModal);
MP_ModalDialog.showModalDialog("errorModal");
return;
}});
},infoButtonClick:function(e){var medCompId=parseInt(this.id.replace(/[^\d]/g,""),10);
var component=MP_Util.GetCompObjById(medCompId);
var componentId=component.getComponentId();
var infoColumns=$("#hml2Content"+componentId).find(".hml2-info-icon-col");
if(component.compMenuReference["compMenuInfoButton"+componentId].isSelected()){component.compMenuReference["compMenuInfoButton"+componentId].setIsSelected(false);
MP_Core.AppUserPreferenceManager.SaveCompPreferences(componentId,"","",false,"0");
component.setIsInfoButtonEnabled(false);
infoColumns.addClass("hidden");
}else{component.compMenuReference["compMenuInfoButton"+componentId].setIsSelected(true);
MP_Core.AppUserPreferenceManager.SaveCompPreferences(componentId,"","",false,"1");
component.setIsInfoButtonEnabled(true);
infoColumns.removeClass("hidden");
}if(component.hasInfoButton()&&component.isInfoButtonEnabled()){CERN_HOME_MEDS_O2.enableInfoButtonClick(component);
}},resetRows:function(e){if(Util.Style.ccss(this,"hml2-dthrd")||Util.Style.ccss(this,"opts-menu-item-dthr")){if(!e){e=window.event;
}Util.cancelBubble(e);
}else{var idFromResetBtn=parseInt(this.id.replace("mnuRnwReset",""),10);
medComp=MP_Util.GetCompObjById(idFromResetBtn);
var medCompId=medComp.m_medModObj.medModCompId;
var origOrder=medComp.m_origOrder;
var rootMedSecCont=medComp.getSectionContentNode();
var componentTableElt=Util.Style.g("component-table",rootMedSecCont,"div")[0];
var medRows=Util.Style.g("result-info",componentTableElt,"dl");
var medsLen=medRows.length;
var totRenews=Util.Style.g("hml2-rnwd",componentTableElt,"dl").length;
var totCancels=Util.Style.g("hml2-cncld",componentTableElt,"dl").length;
var totCompletes=Util.Style.g("hml2-cmplt",componentTableElt,"dl").length;
if(totRenews||totCancels||totCompletes){for(var i=0;
i<medsLen;
i++){var curRow=medRows[i];
var curId=curRow.id;
var imgSpan=Util.Style.g("hml2-rx-hx",curRow,"span");
var curImg=Util.gc(imgSpan[0]);
var curSrc=curImg.src;
var origDispQty;
var origRflQty;
if(origOrder[curId]){origDispQty=origOrder[curId].dispQty;
origRflQty=origOrder[curId].rflQty;
curImg.src=origOrder[curId].rxType;
}else{if(curSrc.search(/_selected/)>-1){var newSrc=curSrc.replace("_selected.gif",".gif");
curImg.src=newSrc;
}}Util.Style.rcss(curRow,"hml2-med-selected");
Util.Style.rcss(curRow,"hml2-cncld");
Util.Style.rcss(curRow,"hml2-rnwd");
Util.Style.rcss(curRow,"hml2-cmplt");
var renewEl=Util.Style.g("hml2-disp-q-rnw",curRow,"span")[0];
if(renewEl){Util.Style.rcss(renewEl,"hml2-disp-q-rnw");
Util.Style.acss(renewEl,"hml2-hide-sig-line");
if(origDispQty){Util.Style.g("hml2-dq-qty",renewEl,"span")[0].innerHTML=origDispQty;
}}var rflEl=Util.Style.g("hml2-rfl-rnw",curRow,"span")[0];
if(rflEl){var hmI18n=i18n.discernabu.homemeds_o2;
Util.Style.rcss(rflEl,"hml2-rfl-rnw");
Util.Style.acss(rflEl,"hml2-hide-sig-line");
rflEl.innerHTML=origRflQty+" "+hmI18n.REFILLS;
}var prevRt=Util.Style.g("hml2-rt-spn",curRow,"span")[0];
if(prevRt){Util.de(prevRt);
}CERN_HOME_MEDS_O2.checkIntersection("reset",medComp);
}}CERN_HOME_MEDS_O2.disableActions(medComp);
var compID=medComp.getComponentId();
_g("medSgnBtn"+medCompId).disabled=true;
medComp.compMenuReference["compMenuGoto"+compID].setIsDisabled(true);
medComp.compMenuReference["compMenuSign"+compID].setIsDisabled(true);
medComp.setEditMode(false);
var totRoutes=Util.Style.g("hml2-rt-uid",rootMedSecCont,"span").length;
if(totRoutes===0){Util.Style.acss(_g("routeLink"+medCompId),"hml2-dthrd");
}if(medComp.m_sidePanelShowing){medComp.m_sidePanel.m_cornerCloseButton.click();
}}Util.Style.rcss(this,"hml2-mnu-hvr");
},signMedMods:function(e){if(Util.Style.ccss(this,"hml2-dthrd")||Util.Style.ccss(this,"opts-menu-item-dthr")){if(!e){e=window.event;
}Util.cancelBubble(e);
}else{var medCompId=parseInt(this.id.replace(/[^\d]/g,""),10);
var medComp=MP_Util.GetCompObjById(medCompId);
var PowerOrdersMPageUtils=window.external.DiscernObjectFactory("POWERORDERS");
MP_Util.LogDiscernInfo(medComp,"POWERORDERS","homemedications-o2.js","signMedMods");
var criterion=medComp.getCriterion();
var m_dPersonId=parseFloat(criterion.person_id);
var m_dEncounterId=parseFloat(criterion.encntr_id);
var bDefRt=true;
if(this.id==("routeLink"+medCompId)||this.id==("mnuGtOrders"+medCompId)){bDefRt=false;
}var medSec=medComp.getSectionContentNode();
var medIdFrag=medComp.m_medModObj.medModIdFrag;
var failedOrders="";
var m_hMOEW=PowerOrdersMPageUtils.CreateMOEW(m_dPersonId,m_dEncounterId,0,2,127);
var cancels=Util.Style.g("hml2-cncld",medSec,"dl");
var canLen=cancels.length;
var curCancel;
var i=0;
if(canLen>0){var m_dCancelDCReason=0;
var d=new Date();
var twoDigit=function(num){num=(String(num).length<2)?String("0"+num):String(num);
return num;
};
var cancelDate=""+d.getFullYear()+twoDigit((d.getMonth()+1))+twoDigit(d.getDate())+twoDigit(d.getHours())+twoDigit(d.getMinutes())+twoDigit(d.getSeconds())+"99";
for(i=0;
i<canLen;
i++){var cancelRowInfo=Util.Style.g("hml2-info",cancels[i],"span")[0];
var cancelId=parseFloat((cancelRowInfo.id).replace("hml2Info"+medIdFrag,""))||0;
curCancel=PowerOrdersMPageUtils.InvokeCancelDCAction(m_hMOEW,cancelId,cancelDate,m_dCancelDCReason);
if(!curCancel){failedOrders+=Util.Style.g("hml2-name",cancels[i],"span")[0].innerHTML+"\n";
}}}var completes=Util.Style.g("hml2-cmplt",medSec,"dl");
var curComplete;
for(i=0,l=completes.length;
i<l;
i++){var completeRowInfo=Util.Style.g("hml2-info",completes[i],"span")[0];
var completeId=parseFloat((completeRowInfo.id).replace("hml2Info"+medIdFrag,""))||0;
curComplete=PowerOrdersMPageUtils.InvokeCompleteAction(m_hMOEW,completeId);
if(!curComplete){failedOrders+=Util.Style.g("hml2-name",completes[i],"span")[0].innerHTML+"\n";
}}var renewals=Util.Style.g("hml2-rnwd",medSec,"dl");
var curRenewal;
for(i=0,l=renewals.length;
i<l;
i++){var numRfls,dispQty;
curRenewal=renewals[i];
var curRowInfo=Util.Style.g("hml2-info",curRenewal,"span")[0];
var renewalId=parseFloat((curRowInfo.id).replace("hml2Info"+medIdFrag,""))||0;
var dur=0;
var durCd=0;
var dispDur=0;
var dispDurCd=0;
var rflSpan=Util.Style.g("hml2-rfl",curRenewal,"span")[0];
if(rflSpan){numRfls=parseFloat(rflSpan.innerHTML)||0;
}else{numRfls=0;
}var dispQtySpan=Util.Style.g("hml2-dq-qty",curRenewal,"span")[0];
if(dispQtySpan){var formatArr=CERN_HOME_MEDS_O2.formatDispQ(dispQtySpan.innerHTML);
if(formatArr[1]){dispQty=formatArr[1];
}else{dispQty=0;
}}else{dispQty=0;
}var dispQtyCd=parseFloat(Util.Style.g("hml2-disp-qty-cd",curRenewal,"span")[0].innerHTML)||0;
var routeUidEl=Util.Style.g("hml2-rt-uid",curRenewal,"span")[0];
var meanId,fieldVal,fieldDispVal;
if(routeUidEl){var routeUid=routeUidEl.innerHTML;
var catCd=routeUidEl.className.replace("hml2-rt-uid cat-","");
var routeInfo=CERN_HOME_MEDS_O2.searchRoutes(catCd,routeUid,medComp);
if(routeInfo){meanId=parseFloat(routeInfo[2]);
fieldVal=parseFloat(routeInfo[1]);
fieldDispVal=routeInfo[0];
}else{meanId=0;
fieldVal=0;
fieldDispVal=0;
}}curRenewal=PowerOrdersMPageUtils.InvokeRenewActionWithRouting(m_hMOEW,renewalId,dur,durCd,dispDur,dispDurCd,numRfls,dispQty,dispQtyCd,meanId,fieldVal,fieldDispVal);
if(!curRenewal){failedOrders+=Util.Style.g("hml2-name",renewals[i],"span")[0].innerHTML+"\n";
}}var bSign;
var showMOEW;
var hmI18n=i18n.discernabu.homemeds_o2;
if(failedOrders!==""){if(curRenewal||curCancel||curComplete){failedOrders=hmI18n.FAILED_ORDERS+":\n\n"+failedOrders+"\n "+hmI18n.CONTINUE_SIGN;
var confirmFailed=confirm(failedOrders);
if(confirmFailed){if(bDefRt){bSign=PowerOrdersMPageUtils.SignOrders(m_hMOEW);
}else{showMOEW=PowerOrdersMPageUtils.DisplayMOEW(m_hMOEW);
}}}else{failedOrders=hmI18n.FAILED_ORDERS+":\n\n"+failedOrders+"\n "+hmI18n.NO_VALID_ORDERS;
alert(failedOrders);
}}else{if(bDefRt){bSign=PowerOrdersMPageUtils.SignOrders(m_hMOEW);
}else{showMOEW=PowerOrdersMPageUtils.DisplayMOEW(m_hMOEW);
}}PowerOrdersMPageUtils.DestroyMOEW(m_hMOEW);
if(bSign||showMOEW){medComp.InsertData();
}else{_g("medSgnBtn"+medCompId).value=hmI18n.MED_SIGN;
}}}};
}();
