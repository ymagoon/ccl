function BBOverviewComponentStyle(){this.initByNamespace("bbo");
}BBOverviewComponentStyle.inherits(ComponentStyle);
function BBOverviewComponent(criterion){this.m_bbOrderableCodes=[];
this.setCriterion(criterion);
this.setStyles(new BBOverviewComponentStyle());
this.setComponentLoadTimerName("USR:MPG.BBOVERVIEW.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.BBOVERVIEW.O1 - render component");
this.setIncludeLineNumber(false);
}BBOverviewComponent.prototype=new MPageComponent();
BBOverviewComponent.prototype.constructor=MPageComponent;
BBOverviewComponent.prototype.setBBOrderableCodes=function(bbOrderableCodes){this.m_bbOrderableCodes=bbOrderableCodes;
};
BBOverviewComponent.prototype.getBBOrderableCodes=function(){return this.m_bbOrderableCodes;
};
BBOverviewComponent.prototype.loadFilterMappings=function(){this.addFilterMappingObject("BB_ORDERS",{setFunction:this.setBBOrderableCodes,type:"ARRAY",field:"PARENT_ENTITY_ID"});
};
BBOverviewComponent.prototype.overviewI18nDateTime=function(bboDateTime){var resultDtTm=new Date();
resultDtTm.setISO8601(bboDateTime);
return resultDtTm.format("longDateTime3");
};
BBOverviewComponent.prototype.retrieveComponentData=function(){var self=this;
var criterion=this.getCriterion();
var sendAr=["^MINE^",criterion.person_id+".0",criterion.encntr_id+".0",MP_Util.CreateParamArray(this.getBBOrderableCodes(),1)];
var request=new MP_Core.ScriptRequest(this,this.getComponentLoadTimerName());
request.setProgramName("MP_BBSUM_OVERVIEW");
request.setParameters(sendAr);
request.setAsync(true);
MP_Core.XMLCCLRequestCallBack(this,request,function(reply){self.renderComponent(reply);
});
};
BBOverviewComponent.prototype.renderComponent=function(reply){var nullDateTime="/Date(0000-00-00T00:00:00.000+00:00)/";
var errMsg=[];
var replyStatus="";
var timerRenderComponent=null;
try{timerRenderComponent=MP_Util.CreateTimer(this.getComponentRenderTimerName());
replyStatus=reply.getStatus();
if(replyStatus!=="S"){if(replyStatus==="F"){errMsg.push(reply.getError());
this.finalizeComponent(MP_Util.HandleErrorResponse(this.getStyles().getNameSpace(),errMsg.join("<br />")),"");
}else{this.finalizeComponent(MP_Util.HandleNoDataResponse(this.getStyles().getNameSpace()),"(0)");
}return;
}var recordData=reply.getResponse();
var bboArray=[];
bboArray.push("<div class='content-body'><table><tr><td>"+i18n.lab.bbt_overview_o1.BLOOD_GROUP+"</td>");
if(recordData.BLOOD_GROUP_CNT<1){bboArray.push("<td class='bbo_noresult'>"+i18n.lab.bbt_overview_o1.NO_BLOOD_GROUP);
}else{bboArray.push("<td>",recordData.BLOOD_GROUP);
}bboArray.push("</td></tr>");
bboArray.push("<tr><td>"+i18n.lab.bbt_overview_o1.ANTIBODIES+"</td>");
var ABRecLen=recordData.ANTIBODYLIST.length;
if(ABRecLen===0){bboArray.push("<td class='bbo_noresult'>"+i18n.lab.bbt_overview_o1.NO_ANTIBODIES);
}else{bboArray.push("<td>");
for(var i=0,allLen=ABRecLen;
i<allLen;
i++){bboArray.push(recordData.ANTIBODYLIST[i].ANTIBODY_CHART_NAME);
if(i<ABRecLen-1){bboArray.push(", ");
}}}bboArray.push("</td></tr>");
bboArray.push("<tr><td>"+i18n.lab.bbt_overview_o1.TRANSFUSION_REQUIREMENTS+"</td>");
var TRRecLen=recordData.TRANSREQLIST.length;
if(TRRecLen===0){bboArray.push("<td class='bbo_noresult'>"+i18n.lab.bbt_overview_o1.NO_TRANS_REQ);
}else{bboArray.push("<td>");
for(var i=0,allLen=TRRecLen;
i<allLen;
i++){bboArray.push(recordData.TRANSREQLIST[i].REQUIREMENT_DISP);
if(i<TRRecLen-1){bboArray.push(", ");
}}}bboArray.push("</td></tr>");
bboArray.push("<tr><td>"+i18n.lab.bbt_overview_o1.ANTIGENS+" </td>");
var ANGenLen=recordData.ANTIGENLIST.length;
if(ANGenLen===0){bboArray.push("<td class='bbo_noresult'>"+i18n.lab.bbt_overview_o1.NO_ANTIGENS);
}else{bboArray.push("<td>");
for(var i=0,GLen=ANGenLen;
i<GLen;
i++){bboArray.push(recordData.ANTIGENLIST[i].DISPLAY);
if(i<ANGenLen-1){bboArray.push(" ");
}}}bboArray.push("</td></tr>");
bboArray.push("<tr><td>"+i18n.lab.bbt_overview_o1.SPECIMEN_AVAILABILITY+"</td>");
if(recordData.EXPIRY_DT_TM===nullDateTime){bboArray.push("<td class='bbo_noresult'>"+i18n.lab.bbt_overview_o1.NO_SPECIMEN+"</td></tr></table></div>");
}else{bboArray.push("<td>"+i18n.lab.bbt_overview_o1.CURRENT_UNTIL+": "+this.overviewI18nDateTime(recordData.EXPIRY_DT_TM_STR)+"</td></tr></table></div>");
}var countText=MP_Util.CreateTitleText(this,0);
this.finalizeComponent(bboArray.join(""),countText);
}catch(err){if(timerRenderComponent){timerRenderComponent.Abort();
timerRenderComponent=null;
}MP_Util.LogJSError(this,err,"mp_bbsum_overview.js","renderComponent");
throw (err);
}finally{if(timerRenderComponent){timerRenderComponent.Stop();
}}};
MP_Util.setObjectDefinitionMapping("MP_BBT_OVERVIEW_LAYOUT",BBOverviewComponent);
