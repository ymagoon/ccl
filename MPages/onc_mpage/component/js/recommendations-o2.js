function RecommendationsO2ComponentStyle(){this.initByNamespace("recom-o2");
}RecommendationsO2ComponentStyle.prototype=new ComponentStyle();
RecommendationsO2ComponentStyle.prototype.constructor=ComponentStyle;
function RecommendationsO2Component(criterion){this.setCriterion(criterion);
this.setStyles(new RecommendationsO2ComponentStyle());
this.setComponentLoadTimerName("USR:MPG.RECOMMENDATIONS.O2 - load component");
this.setComponentRenderTimerName("ENG:MPG.RECOMMENDATIONS.O2 - render component");
this.setIncludeLineNumber(true);
this.setLookBackDropDown(true);
this.setPlusAddCustomInd(true);
this.m_recommendationsTable=null;
this.DATE_RANGE_TRIGGER={DEFAULT:1,MODAL_WINDOW:2};
this.FILTERS={CATEGORY:1,PRIORITY:2,FAVORITES:3,NONE:4};
this.DUE_TYPE={DUE:0,OVERDUE:1,NEARDUE:2,SATISFIED:3};
this.m_defaultCols={PRIORITY:2,FREQUENCY:3,DUE:4,REFERENCE:5};
this.m_alertType={ERROR:1,WARNING:2,INFO:3};
this.m_recomPrefObj={groupByPref:this.FILTERS.NONE,savedColumnsObj:{PRIORITY:true,FREQUENCY:true,DUE:true,REFERENCE:true},favoritesObject:[],REQUIRED:0};
this.m_lastSelFilter=this.FILTERS.NONE;
this.m_lastSelectedRow="";
this.m_personnelArray=null;
this.RECORD_STATUS_TYPE={SATISFIED:0,POSTPONED:1,PENDING:2,SKIPPED:3,CANCELED:4,OTHERSATISFIER:5,UNDONE:6,REFUSED:7,EXPIRED:8};
this.HOVER_SECTION={EXPECTATION:1,FREQUENCY:2,DUE_DATE:3,NONE:0};
this.m_historyLookback="";
this.m_anchorDate=new Date();
this.m_statusBarPos=0;
this.m_$sidePanelContainer=null;
this.m_sidePanel=null;
this.m_sidePanelMinHeight=251;
this.m_$tableView=null;
this.m_hoverContainerClassName="";
this.m_allowAdditions=false;
this.m_allowModifications=false;
this.m_allowFreeText=false;
this.m_expectReason=false;
this.m_reasonOnFrequencyModification=false;
this.m_reasonOnDueDateModification=false;
this.m_showSatisfiers=false;
this.m_freeTextSatisfiers=null;
this.m_freeTextCounter=0;
this.m_recommendationsDataReply=[];
this.m_currentProviderName="";
this.m_reasonCodeSet=[];
this.m_timeUnitsCodeSet=[];
this.m_selectedExpectationsList=[];
this.m_selectedFreeTextExpectationsList=[];
this.RECOMMENDATION_TYPE={EXPECTATION:0,FREE_TEXT:1};
this.FREQUENCY_TYPE={SEASONAL:0,VARIABLE:1,ONE_TIME_ONLY:2,FIXED_NO_OF_DAYS:3};
this.m_reasonOnAddition=0;
this.m_commentOnAddition="";
this.m_allAvailableExpectations={};
this.m_i18nStrings=i18n.discernabu.recommendations_o2;
this.m_componentId=this.getComponentId();
this.m_expectationsWithFixedDaysFrequency=[];
this.m_actionOverrideCounter=0;
this.m_isSidePanelLoading=false;
this.m_isSidePanelOpen=false;
this.m_hasDueDateChanged=false;
this.m_hasFrequencyChanged=false;
this.m_modifyObject={};
this.RECOMMENDATION_ACTION={NO_ACTION:-1,MODIFY:0,EXPIRE:1,POSTPONE:2,REFUSE:3,MANUAL_SATISFY:4,UNDO:5,SYSTEM_SATISFY_PROCEDURE:6};
this.m_currentAction=this.RECOMMENDATION_ACTION.NO_ACTION;
this.m_popup=null;
this.m_modifierTypesAndReasons=null;
this.m_actionObject=null;
this.setOverrideInd(false);
this.setRequiredCompDisclaimerText(this.m_i18nStrings.OVERDUE_ALERT);
this.m_groupId=0;
this.m_dueDateRangeUserPreference=0;
this.m_undoActionReasons=[];
this.m_systemSatisfierAction={componentId:null,recommendationId:null,modifiedRowId:null};
this.m_addProcedureAction=null;
this.m_addProcedureName="";
this.m_nomenclatureId=0;
this.m_addProcedureDateSelector=null;
this.m_viewReferenceTextObj=null;
this.m_referenceTextExistsObj=null;
this.m_scriptReply=null;
this.referenceTextCapTimer=null;
this.refTextResponse=null;
this.m_hvrExtension=null;
this.m_lastSelectedRowProperty="";
}RecommendationsO2Component.prototype=new MPageComponent();
RecommendationsO2Component.prototype.constructor=MPageComponent;
RecommendationsO2Component.prototype.getComponentScriptReply=function(){return this.m_scriptReply;
};
RecommendationsO2Component.prototype.setComponentScriptReply=function(scriptReply){if(typeof scriptReply!=="object"){throw new Error("The parameter passed to setComponentScriptReply is not an object or invalid");
}this.m_scriptReply=scriptReply;
};
RecommendationsO2Component.prototype.getReferenceTextExistsObj=function(){return this.m_referenceTextExistsObj;
};
RecommendationsO2Component.prototype.setReferenceTextExistsObj=function(referenceTextExistsObj){if(typeof referenceTextExistsObj!=="object"){throw new Error("The parameter passed to setReferenceTextExistsObj is not an object or invalid");
}this.m_referenceTextExistsObj=referenceTextExistsObj;
};
RecommendationsO2Component.prototype.getReferenceTextObj=function(){return this.m_viewReferenceTextObj;
};
RecommendationsO2Component.prototype.setReferenceTextObj=function(referenceTextObj){if(typeof referenceTextObj!=="object"){throw new Error("The parameter passed to setReferenceTextObj is not an object or invalid");
}this.m_viewReferenceTextObj=referenceTextObj;
};
RecommendationsO2Component.prototype.getGroupId=function(){return this.m_groupId;
};
RecommendationsO2Component.prototype.setGroupId=function(groupId){if(typeof groupId!=="number"){throw new Error("The parameter passed to setGroupId is not a number or invalid");
}this.m_groupId=groupId;
};
RecommendationsO2Component.prototype.getPendingDueDatePreference=function(){return this.m_dueDateRangeUserPreference;
};
RecommendationsO2Component.prototype.setPendingDueDatePreference=function(duePendingDatePreference){this.m_dueDateRangeUserPreference=duePendingDatePreference;
};
RecommendationsO2Component.prototype.getReasonOnAddition=function(){return this.m_reasonOnAddition;
};
RecommendationsO2Component.prototype.setReasonOnAddition=function(reasonValue){if(typeof reasonValue!=="number"){throw new Error("The reason value passed is not a number");
}this.m_reasonOnAddition=reasonValue;
};
RecommendationsO2Component.prototype.getCommentOnAddition=function(){return this.m_commentOnAddition;
};
RecommendationsO2Component.prototype.setCommentOnAddition=function(commentString){if(typeof commentString!=="string"){throw new Error("The comment passed is not a string");
}this.m_commentOnAddition=commentString;
};
RecommendationsO2Component.prototype.getSelectedFreeTextExpectationsList=function(){return this.m_selectedFreeTextExpectationsList;
};
RecommendationsO2Component.prototype.setSelectedFreeTextExpectationsList=function(selectedFreeTextList){if(!(selectedFreeTextList instanceof Array)){throw new Error("The free text expectation list passed is not an Array");
}this.m_selectedFreeTextExpectationsList=selectedFreeTextList;
};
RecommendationsO2Component.prototype.addItemToSelectedFreeTextExpectationsList=function(selectedFreeTextExpectationObj){if(typeof selectedFreeTextExpectationObj!=="object"){throw new Error("The selected free text expectation passed is not an object");
}this.m_selectedFreeTextExpectationsList.push(selectedFreeTextExpectationObj);
};
RecommendationsO2Component.prototype.getSelectedExpectationsList=function(){return this.m_selectedExpectationsList;
};
RecommendationsO2Component.prototype.setSelectedExpectationsList=function(selectedList){if(!(selectedList instanceof Array)){throw new Error("The expectation list passed is not an Array");
}this.m_selectedExpectationsList=selectedList;
};
RecommendationsO2Component.prototype.addItemToSelectedExpectationsList=function(selectedExpectationObj){if(typeof selectedExpectationObj!=="object"){throw new Error("The selected expectations list passed is not an object");
}this.m_selectedExpectationsList.push(selectedExpectationObj);
};
RecommendationsO2Component.prototype.getFreeTextCounter=function(){return this.m_freeTextCounter;
};
RecommendationsO2Component.prototype.getIncrementedFreeTextCounter=function(){return ++this.m_freeTextCounter;
};
RecommendationsO2Component.prototype.setFreeTextCounter=function(freeTextCounter){if(typeof freeTextCounter!=="number"){throw new Error("The free text counter passed is not a number");
}this.m_freeTextCounter=freeTextCounter;
};
RecommendationsO2Component.prototype.getCurrentProviderName=function(){return this.m_currentProviderName;
};
RecommendationsO2Component.prototype.setCurrentProviderName=function(providerName){if(typeof providerName!=="string"){throw new Error("The provider name passed is not a string");
}this.m_currentProviderName=providerName;
};
RecommendationsO2Component.prototype.getReasonCodeSet=function(){return this.m_reasonCodeSet;
};
RecommendationsO2Component.prototype.setReasonCodeSet=function(reasonCodeSet){if(!(reasonCodeSet instanceof Array)){throw new Error("The reason code set passed is not an array");
}this.m_reasonCodeSet=reasonCodeSet;
};
RecommendationsO2Component.prototype.getTimeUnitsCodeSet=function(){return this.m_timeUnitsCodeSet;
};
RecommendationsO2Component.prototype.setTimeUnitsCodeSet=function(timeUnitsCodeSet){if(!(timeUnitsCodeSet instanceof Array)){throw new Error("The code set passed is not an array");
}this.m_timeUnitsCodeSet=timeUnitsCodeSet;
};
RecommendationsO2Component.prototype.getAllowAdditionIndicator=function(){return this.m_allowAdditions;
};
RecommendationsO2Component.prototype.setAllowAdditionIndicator=function(additionIndicator){if(typeof additionIndicator!=="boolean"){throw new Error("The addition indicator passed is not a boolean value");
}this.m_allowAdditions=additionIndicator;
};
RecommendationsO2Component.prototype.getAllowModificationIndicator=function(){return this.m_allowModifications;
};
RecommendationsO2Component.prototype.setAllowModificationIndicator=function(modificationIndicator){if(typeof modificationIndicator!=="boolean"){throw new Error("The modification indicator passed is not a boolean value");
}this.m_allowModifications=modificationIndicator;
};
RecommendationsO2Component.prototype.getAllowFreeTextAdditionIndicator=function(){return this.m_allowFreeText;
};
RecommendationsO2Component.prototype.setAllowFreeTextAdditionIndicator=function(freeTextIndicator){if(typeof freeTextIndicator!=="boolean"){throw new Error("The free text indicator passed is not a boolean value");
}this.m_allowFreeText=freeTextIndicator;
};
RecommendationsO2Component.prototype.getExpectReasonAdditionIndicator=function(){return this.m_expectReason;
};
RecommendationsO2Component.prototype.setExpectReasonAdditionIndicator=function(expectReasonIndicator){if(typeof expectReasonIndicator!=="boolean"){throw new Error("The reason expected indicator passed is not a boolean value");
}this.m_expectReason=expectReasonIndicator;
};
RecommendationsO2Component.prototype.getRecommendationsDataReply=function(){return this.m_recommendationsDataReply;
};
RecommendationsO2Component.prototype.setRecommendationsDataReply=function(dataReply){if(!(dataReply instanceof Array)){throw new Error("The data reply passed is not an array");
}this.m_recommendationsDataReply=dataReply;
};
RecommendationsO2Component.prototype.getAllAvailableExpectations=function(){return this.m_allAvailableExpectations;
};
RecommendationsO2Component.prototype.setAllAvailableExpectations=function(availableExpectations){if(typeof availableExpectations!=="object"){throw new Error("The availableExpectations passed is not an object");
}this.m_allAvailableExpectations=availableExpectations;
};
RecommendationsO2Component.prototype.getPatientDOB=function(){return this.m_patientDOB;
};
RecommendationsO2Component.prototype.getExpectationsWithFixedDaysFrequency=function(){return this.m_expectationsWithFixedDaysFrequency;
};
RecommendationsO2Component.prototype.setExpectationsWithFixedDaysFrequency=function(frequencyObjectList){if(!(frequencyObjectList instanceof Array)){throw new Error("The frequencyObjectList passed is not an array");
}this.m_expectationsWithFixedDaysFrequency=frequencyObjectList;
};
RecommendationsO2Component.prototype.addExpectationWithFixedDaysFrequency=function(frequencyObject){if(typeof frequencyObject!=="object"){throw new Error("The frequencyObject passed is not an object");
}this.m_expectationsWithFixedDaysFrequency.push(frequencyObject);
};
RecommendationsO2Component.prototype.getActionOverrideCount=function(){return this.m_actionOverrideCounter;
};
RecommendationsO2Component.prototype.setActionOverrideCount=function(actionOverrideCount){if(typeof actionOverrideCount!=="number"){throw new Error("The actionOverrideCount passed is not a number");
}this.m_actionOverrideCounter=actionOverrideCount;
};
RecommendationsO2Component.prototype.incrementActionOverrideCount=function(){this.m_actionOverrideCounter++;
};
RecommendationsO2Component.prototype.getReasonOnFrequencyModification=function(){return this.m_reasonOnFrequencyModification;
};
RecommendationsO2Component.prototype.setReasonOnFrequencyModification=function(value){if(typeof value!=="boolean"){throw new Error("Invalid parameter passed to setReasonOnFrequencyModification function");
}this.m_reasonOnFrequencyModification=value;
};
RecommendationsO2Component.prototype.getReasonOnDueDateModification=function(){return this.m_reasonOnDueDateModification;
};
RecommendationsO2Component.prototype.setReasonOnDueDateModification=function(value){if(typeof value!=="boolean"){throw new Error("Invalid parameter passed to setReasonOnDueDateModification function");
}this.m_reasonOnDueDateModification=value;
};
RecommendationsO2Component.prototype.getDueDateChangeIndicator=function(){return this.m_hasDueDateChanged;
};
RecommendationsO2Component.prototype.setDueDateChangeIndicator=function(value){if(typeof value!=="boolean"){throw new Error("Invalid parameter passed to setDueDateChanged function");
}this.m_hasDueDateChanged=value;
};
RecommendationsO2Component.prototype.getFrequencyChangeIndicator=function(){return this.m_hasFrequencyChanged;
};
RecommendationsO2Component.prototype.setFrequencyChangeIndicator=function(value){if(typeof value!=="boolean"){throw new Error("Invalid parameter passed to setDueDateChanged function");
}this.m_hasFrequencyChanged=value;
};
RecommendationsO2Component.prototype.getShowSatisfiersPreference=function(){return this.m_showSatisfiers;
};
RecommendationsO2Component.prototype.setShowSatisfiersPreference=function(value){if(typeof value!=="boolean"){throw new Error("Invalid parameter passed to setShowSatisfiersPreference function");
}this.m_showSatisfiers=value;
};
RecommendationsO2Component.prototype.getPopupObject=function(){return this.m_popup;
};
RecommendationsO2Component.prototype.setPopupObject=function(obj){if(typeof obj!=="object"){throw new Error("Invalid parameter passed to setPopupObject function");
}this.m_popup=obj;
};
RecommendationsO2Component.prototype.getModifierTypesAndReasons=function(){return this.m_modifierTypesAndReasons;
};
RecommendationsO2Component.prototype.setModifierTypesAndReasons=function(obj){if(typeof obj!=="object"){throw new Error("Invalid parameter passed to setModifierTypesAndReasons function");
}this.m_modifierTypesAndReasons=obj;
};
RecommendationsO2Component.prototype.getActionObject=function(){return this.m_actionObject;
};
RecommendationsO2Component.prototype.setActionObject=function(obj){if(typeof obj!=="object"){throw new Error("Invalid parameter passed to setActionObject function");
}this.m_actionObject=obj;
};
RecommendationsO2Component.prototype.getFreeTextSatisfiers=function(){return this.m_freeTextSatisfiers;
};
RecommendationsO2Component.prototype.setFreeTextSatisfiers=function(freeTextSatisfiers){if(typeof freeTextSatisfiers!=="object"){throw new Error("Invalid parameter passed to setFreeTextSatisfiers function");
}this.m_freeTextSatisfiers=freeTextSatisfiers;
};
RecommendationsO2Component.prototype.getCurrentActionType=function(){return this.m_currentAction;
};
RecommendationsO2Component.prototype.setCurrentActionType=function(currentActionType){if(typeof currentActionType!=="number"){throw new Error("The parameter passed to setCurrentActionType is not a number");
}this.m_currentAction=currentActionType;
};
RecommendationsO2Component.prototype.getUndoReasonCodeSet=function(){return this.m_undoActionReasons;
};
RecommendationsO2Component.prototype.setUndoReasonCodeSet=function(undoReasons){if(!(undoReasons instanceof Array)){throw new Error("The parameter passed to setUndoActionReasons is not an array");
}this.m_undoActionReasons=undoReasons;
};
RecommendationsO2Component.prototype.getAddProcedureName=function(){return this.m_addProcedureName;
};
RecommendationsO2Component.prototype.setAddProcedureName=function(procedureName){if(typeof procedureName!=="string"){throw new Error("The parameter passed to setaddProcedureName is not a string");
}this.m_addProcedureName=procedureName;
};
RecommendationsO2Component.prototype.getAddProcedureAction=function(){return this.m_addProcedureAction;
};
RecommendationsO2Component.prototype.setAddProcedureAction=function(procedureAction){if(typeof procedureAction!=="object"){throw new Error("The parameter passed to setAddProcedureAction is not an Object");
}this.m_addProcedureAction=procedureAction;
};
RecommendationsO2Component.prototype.getNomenclatureId=function(){return this.m_nomenclatureId;
};
RecommendationsO2Component.prototype.setNomenclatureId=function(nomenclatureId){if(typeof nomenclatureId!=="number"){throw new Error("The parameter passed to setNomenclatureId is not a number");
}this.m_nomenclatureId=nomenclatureId;
};
RecommendationsO2Component.prototype.getProcedureDateSelector=function(){return this.m_addProcedureDateSelector;
};
RecommendationsO2Component.prototype.setProcedureDateSelector=function(procedureDateSelector){if(typeof procedureDateSelector!=="object"){throw new Error("The parameter passed to setProcedureDateSelector is not an object");
}this.m_addProcedureDateSelector=procedureDateSelector;
};
RecommendationsO2Component.prototype.loadFilterMappings=function(){this.addFilterMappingObject("WF_RCMND_OVERDUE_IND",{setFunction:this.setGapCheckRequiredInd,type:"Boolean",field:"FREETEXT_DESC"});
};
RecommendationsO2Component.prototype.openTab=function(){var addRecommendationModal=MP_ModalDialog.retrieveModalDialogObject("addRecommendation");
var component=this;
var category_mean=component.getCriterion().category_mean;
var capTimer=null;
var compId=component.m_componentId;
component.setFreeTextCounter(0);
if(!addRecommendationModal){var providerLabel="<span class='recom-o2-add-rec-provider-name'></span>";
addRecommendationModal=new ModalDialog("addRecommendation");
addRecommendationModal.setHeaderTitle(this.m_i18nStrings.ADD_RECOMMENDATION);
var addButton=new ModalButton("addRecButton");
addButton.setText(i18n.SAVE).setIsDithered(true);
addButton.setOnClickFunction(function(){var allRequiredFields=$("#addRecRightContainer"+compId).find(".recom-o2-required-field");
var isEmpty=false;
allRequiredFields.each(function(){var element=$(this);
if(!element.val()){isEmpty=true;
element.focus();
return false;
}if(element.hasClass("recom-o2-sel-series-freq-val")){if(parseInt(element.val(),10)===0){isEmpty=true;
element.focus();
return false;
}}});
if(!isEmpty){var saveFailureMsgContainer=$(".recom-o2-save-failure-msg");
if(!saveFailureMsgContainer.hasClass("hidden")){saveFailureMsgContainer.addClass("hidden");
}var expectationsWithFixedDaysFrequency=component.getExpectationsWithFixedDaysFrequency();
var selectedExpectations=component.getSelectedExpectationsList();
for(var expIdx=expectationsWithFixedDaysFrequency.length;
expIdx--;
){for(var selectedExpIdx=selectedExpectations.length;
selectedExpIdx--;
){if(expectationsWithFixedDaysFrequency[expIdx].SERIES_ID===selectedExpectations[selectedExpIdx].RECOMMENDATION_TEMP_ID){if(expectationsWithFixedDaysFrequency[expIdx].FREQUENCY_VALUE===selectedExpectations[selectedExpIdx].FREQUENCY_VALUE&&expectationsWithFixedDaysFrequency[expIdx].FREQUENCY_UNIT_CD===selectedExpectations[selectedExpIdx].FREQUENCY_UNIT_CD){selectedExpectations[selectedExpIdx].FREQUENCY_VALUE=0;
selectedExpectations[selectedExpIdx].FREQUENCY_UNIT_CD=0;
}break;
}}}var allSelectedExpectations=selectedExpectations.concat(component.getSelectedFreeTextExpectationsList());
component.saveExpectations(allSelectedExpectations);
capTimer=new CapabilityTimer("CAP:MPG_Recommendations_O2_Add_New",category_mean);
if(capTimer){capTimer.addMetaData("rtms.legacy.metadata.1","Add New Recommendations");
capTimer.capture();
}}});
addRecommendationModal.addFooterButton(addButton);
var cancelButton=new ModalButton("cancelRecButton");
cancelButton.setText(i18n.CANCEL);
cancelButton.setOnClickFunction(function(){component.setSelectedFreeTextExpectationsList([]);
component.setSelectedExpectationsList([]);
component.setExpectationsWithFixedDaysFrequency([]);
component.setActionOverrideCount(0);
component.setCommentOnAddition("");
component.setReasonOnAddition(0);
var addRecommendationsWindow=MP_ModalDialog.retrieveModalDialogObject("addRecommendation");
addRecommendationsWindow.setFooterButtonDither("addRecButton",true);
MP_ModalDialog.closeModalDialog("addRecommendation");
});
addRecommendationModal.addFooterButton(cancelButton);
addRecommendationModal.setFooterText(component.m_i18nStrings.RECORDED_FOR+" : "+providerLabel);
addRecommendationModal.setLeftMarginPercentage(20).setRightMarginPercentage(20).setIsFooterAlwaysShown(true).setIsBodySizeFixed(false);
addRecommendationModal.setFooterButtonCloseOnClick("addRecButton",false);
addRecommendationModal.setFooterButtonCloseOnClick("cancelRecButton",false);
addRecommendationModal.setBodyDataFunction(function(){var freeTextLink="";
if(component.getAllowFreeTextAdditionIndicator()){freeTextLink="<a class='recom-o2-free-text-link'>"+component.m_i18nStrings.ADD_FREETEXT+"</a>";
}var leftWindowContainer="<div id='addRecLeftContainer"+compId+"' class='recom-o2-add-rec-left-container'><div class='recom-o2-add-rec-header secondary-text'>"+component.m_i18nStrings.AVAILABLE_EXPECTATIONS+"</div><div class='recom-o2-add-rec-available-recs preloader'></div><div class='recom-o2-add-rec-free-text'>"+freeTextLink+"</div></div>";
var reasonCommentsContainer="<div class='recom-o2-add-rec-reason-comment-container'><div class='recom-o2-add-rec-reason secondary-text'></div><div class='recom-o2-add-rec-comment secondary-text'></div></div>";
var rightWindowContainer="<div id='addRecRightContainer"+compId+"' class='recom-o2-add-rec-right-container'><div class='recom-o2-add-rec-header secondary-text'>"+component.m_i18nStrings.SELECTED_EXPECTATIONS+"</div><div class='recom-o2-add-rec-selected-recs'></div>"+reasonCommentsContainer+"</div>";
var modalDialogBodyHtml="<div  id='addRecMainContainer"+compId+"' class='recom-o2-add-rec-main-container'><div id='addRecsaveFailure"+compId+"' class='recom-o2-save-failure-msg hidden'></div>"+leftWindowContainer+rightWindowContainer+"</div>";
addRecommendationModal.setBodyHTML(modalDialogBodyHtml);
if(!component.getCurrentProviderName().length||!component.getReasonCodeSet().length||!component.getTimeUnitsCodeSet().length){var recommendationsDataRequest=new ScriptRequest();
recommendationsDataRequest.setProgramName("mp_get_data_add_expectation");
recommendationsDataRequest.setParameterArray(["^MINE^",component.getCriterion().provider_id+".0",1]);
recommendationsDataRequest.setResponseHandler(function(replyObj){component.saveCodeSetData(replyObj);
});
recommendationsDataRequest.performRequest();
}if(component.getAllAvailableExpectations().SCHED){component.renderAddRecommendationsWindow(null);
}else{var APPLICATION_NUMBER=966300;
var TASK_NUMBER=966310;
var REQUEST_NUMBER=966318;
var availableRecommendationsRequest=new ScriptRequest();
availableRecommendationsRequest.setProgramName("mp_exec_std_request");
availableRecommendationsRequest.setDataBlob(JSON.stringify({REQUESTIN:{}}));
availableRecommendationsRequest.setParameterArray(["^MINE^","^^",APPLICATION_NUMBER,TASK_NUMBER,REQUEST_NUMBER]);
availableRecommendationsRequest.setResponseHandler(function(replyObj){component.renderAddRecommendationsWindow(replyObj);
});
availableRecommendationsRequest.performRequest();
}});
MP_ModalDialog.addModalDialogObject(addRecommendationModal);
}MP_ModalDialog.updateModalDialogObject(addRecommendationModal);
MP_ModalDialog.showModalDialog("addRecommendation");
};
RecommendationsO2Component.prototype.saveCodeSetData=function(replyObj){try{if(replyObj.getStatus()==="S"){var dataRequired=replyObj.getResponse();
this.setCurrentProviderName(dataRequired.RECORDED_FOR_FULL_NAME);
this.setReasonCodeSet(dataRequired.REASONS);
this.setTimeUnitsCodeSet(dataRequired.FREQUENCY_RANGE);
}}catch(error){logger.logJSError(error,RecommendationsO2Component,"recommendations-o2.js","saveCodeSetData");
}};
RecommendationsO2Component.prototype.renderAddRecommendationsWindow=function(replyObj){var addRecommendationsWindow=MP_ModalDialog.retrieveModalDialogObject("addRecommendation");
var compId=this.m_componentId;
try{$("#vwpModalDialogaddRecommendation").find(".recom-o2-add-rec-provider-name").text(this.getCurrentProviderName());
this.renderReasonAndCommentsSection();
if(replyObj){if(replyObj.getStatus()==="S"){var availableRecs=replyObj.getResponse();
this.processAvailableRecommendations(availableRecs);
this.setAllAvailableExpectations(availableRecs);
var availableRecsHtmlContent=this.renderAvailableRecommendations(availableRecs);
$(".recom-o2-add-rec-left-container").find(".recom-o2-add-rec-available-recs").removeClass("preloader").append(availableRecsHtmlContent);
$("li.recom-o2-add-rec-schedule-list-item ul").hide();
}else{var messageType="error";
var messageInfo=this.m_i18nStrings.INLINE_ERROR_INFO;
var messageText=this.m_i18nStrings.INLINE_ERROR_MESSAGE;
var customClass="recom-o2-add-rec-inline-error";
if(replyObj.getStatus()==="Z"){messageType="information";
messageInfo=" ";
messageText=this.m_i18nStrings.INLINE_INFO_MESSAGE;
customClass="recom-o2-add-rec-inline-information";
}var inlineErrorHTML=MP_Core.generateUserMessageHTML(messageType,messageInfo,messageText,customClass);
if(this.getAllowFreeTextAdditionIndicator()){$("#addRecLeftContainer"+compId).find(".recom-o2-add-rec-available-recs").removeClass("preloader").append(inlineErrorHTML);
}else{$("#addRecMainContainer"+compId).empty().append(inlineErrorHTML);
addRecommendationsWindow.setLeftMarginPercentage(30).setRightMarginPercentage(30);
}}}else{var availableBuiltRecs=this.getAllAvailableExpectations();
this.processAvailableRecommendations(availableBuiltRecs);
var availableBuiltRecsHtmlContent=this.renderAvailableRecommendations(availableBuiltRecs);
$(".recom-o2-add-rec-left-container").find(".recom-o2-add-rec-available-recs").removeClass("preloader").append(availableBuiltRecsHtmlContent);
$("li.recom-o2-add-rec-schedule-list-item ul").hide();
}this.addEventListenersForLeftPanel();
this.addEventListenersForRightPanel();
}catch(error){logger.logJSError(error,RecommendationsO2Component,"recommendations-o2.js","renderAddRecommendationsWindow");
}};
RecommendationsO2Component.prototype.renderReasonAndCommentsSection=function(){var compId=this.m_componentId;
var expectReasonOnAdd=this.getExpectReasonAdditionIndicator();
var isRequiredStyle=expectReasonOnAdd?"recom-o2-required-display":"";
var isRequiredValue=expectReasonOnAdd?"recom-o2-required-field":"";
var reasonCommentContainer=$("#addRecMainContainer"+compId).find(".recom-o2-add-rec-reason-comment-container");
var reasonDropDown="<select class='recom-o2-add-rec-reason-dropdown "+isRequiredValue+"'><option value=''></option>";
var reasonCodeSet=this.getReasonCodeSet();
var reasonCodeSetLength=reasonCodeSet.length;
for(var reasonIndex=0;
reasonIndex<reasonCodeSetLength;
reasonIndex++){reasonDropDown+="<option value='"+reasonCodeSet[reasonIndex].REASON_CD+"'>"+reasonCodeSet[reasonIndex].REASON_DISPLAY+"</option>";
}reasonDropDown+="</select>";
var reasonHtml="<span class='recom-o2-reason "+isRequiredStyle+"'>"+i18n.REASON+"</span><br/>"+reasonDropDown;
var commentHtml=i18n.COMMENTS+"<br/><textarea id='addRecComment"+compId+"' class='recom-o2-add-rec-add-comment' cols='40' rows='2' maxlength='1000' placeholder='"+this.m_i18nStrings.ADD_A_COMMENT+"'></textarea>";
reasonCommentContainer.find(".recom-o2-add-rec-reason").append(reasonHtml);
reasonCommentContainer.find(".recom-o2-add-rec-comment").append(commentHtml);
};
RecommendationsO2Component.prototype.renderAvailableRecommendations=function(availableRecs){var availableRecsHtml="<ul class='recom-o2-add-rec-schedule-list'>";
var compId=this.m_componentId;
var scheduleList=availableRecs.SCHED;
var scheduleListLength=scheduleList.length;
for(var scheduleIndex=0;
scheduleIndex<scheduleListLength;
scheduleIndex++){if(scheduleList[scheduleIndex].EXPECT_SCHED_TYPE_FLAG!==1){var seriesHtml="<ul class='recom-o2-add-rec-series-list'>";
var scheduleDisabledIndicator=scheduleList[scheduleIndex].DITHERED_IND?"checked disabled":"";
var seriesList=scheduleList[scheduleIndex].SERIES;
var seriesListLength=seriesList.length;
for(var seriesIndex=0;
seriesIndex<seriesListLength;
seriesIndex++){var seriesDisabledIndicator;
if(scheduleDisabledIndicator){seriesDisabledIndicator="checked disabled";
}else{if(seriesList[seriesIndex].DITHERED_IND){seriesDisabledIndicator="checked disabled";
}else{seriesDisabledIndicator="";
}}seriesHtml+="<li id='series"+seriesList[seriesIndex].EXPECT_SERIES_ID+compId+"'class='recom-o2-add-rec-series-list-item' series-id='"+seriesList[seriesIndex].EXPECT_SERIES_ID+"' expect-id='"+seriesList[seriesIndex].EXPECT[0].EXPECT_ID+"' step-id='"+seriesList[seriesIndex].EXPECT[0].STEP[0].EXPECT_STEP_ID+"'><input type='checkbox' class='recom-o2-add-rec-series-checkbox' "+seriesDisabledIndicator+"/>"+seriesList[seriesIndex].EXPECT_SERIES_NAME+"</li>";
}seriesHtml+="</ul>";
availableRecsHtml+="<li id='schedule"+scheduleList[scheduleIndex].EXPECT_SCHED_ID+compId+"' class='recom-o2-add-rec-schedule-list-item' schedule-id='"+scheduleList[scheduleIndex].EXPECT_SCHED_ID+"'><div class='recom-o2-add-rec-expand-collapse-icon'/><input type='checkbox' class='recom-o2-add-rec-schedule-checkbox' "+scheduleDisabledIndicator+"/>&nbsp;"+scheduleList[scheduleIndex].EXPECT_SCHED_NAME+seriesHtml+"</li>";
}}availableRecsHtml+="</ul>";
return availableRecsHtml;
};
RecommendationsO2Component.prototype.addEventListenersForLeftPanel=function(){var component=this;
var compId=this.m_componentId;
var availableRecommendations=$("#addRecMainContainer"+compId).find(".recom-o2-add-rec-available-recs");
availableRecommendations.on("click","div.recom-o2-add-rec-expand-collapse-icon",function(){$(this).toggleClass("expanded");
$(this).parent("li.recom-o2-add-rec-schedule-list-item").find("ul.recom-o2-add-rec-series-list").toggle();
});
availableRecommendations.on("change",".recom-o2-add-rec-schedule-checkbox",function(){var seriesListItemToChange=$(this).parent("li.recom-o2-add-rec-schedule-list-item").find("ul li.recom-o2-add-rec-series-list-item");
var checkIndicator=this.checked;
if(checkIndicator){seriesListItemToChange.each(function(){var currentCheckbox=$(this).find(":checkbox");
if(!currentCheckbox.prop("disabled")&&!currentCheckbox.prop("checked")){currentCheckbox.prop("checked",checkIndicator);
component.addSeriesToRightPanelSelectedList($(this));
}});
}else{seriesListItemToChange.each(function(){var currentCheckbox=$(this).find(":checkbox");
if(!currentCheckbox.prop("disabled")){var seriesId=$(this).attr("series-id");
$("#addRecRightContainer"+compId).find(".recom-o2-add-rec-selected-recs #selected"+seriesId+compId).find(".recom-o2-sel-series-del-button").click();
}});
}});
availableRecommendations.on("change",".recom-o2-add-rec-series-checkbox",function(){var seriesListItem=$(this).parent("li.recom-o2-add-rec-series-list-item");
var scheduleListItemToChange=seriesListItem.closest(".recom-o2-add-rec-schedule-list-item");
if($(this).prop("checked")){component.addSeriesToRightPanelSelectedList(seriesListItem);
var isAllSerieseChecked=true;
scheduleListItemToChange.find("li.recom-o2-add-rec-series-list-item").each(function(){if(!$(this).find(":checkbox").prop("checked")){isAllSerieseChecked=false;
return;
}});
scheduleListItemToChange.find(".recom-o2-add-rec-schedule-checkbox").prop("checked",isAllSerieseChecked);
}else{scheduleListItemToChange.find(".recom-o2-add-rec-schedule-checkbox").prop("checked",false);
var seriesId=seriesListItem.attr("series-id");
$("#addRecRightContainer"+compId).find(".recom-o2-add-rec-selected-recs #selected"+seriesId+compId).find(".recom-o2-sel-series-del-button").click();
}});
$("#addRecMainContainer"+compId).find(".recom-o2-add-rec-free-text").on("click",".recom-o2-free-text-link",function(){component.addFreeTextToRightPanelSelectedList();
});
};
RecommendationsO2Component.prototype.addEventListenersForRightPanel=function(){var component=this;
var compId=this.m_componentId;
var selectedRecommendations=$("#addRecRightContainer"+compId).find(".recom-o2-add-rec-selected-recs");
selectedRecommendations.on("click",".recom-o2-sel-series-del-button",function(){var selectedSeries=$(this).closest(".recom-o2-selected-series");
var seriesId=selectedSeries.attr("series-id");
var recommendationType=component.RECOMMENDATION_TYPE.FREE_TEXT;
if(selectedSeries.attr("series-type")==="expectation"){recommendationType=component.RECOMMENDATION_TYPE.EXPECTATION;
var checkboxToUpdate=$(".recom-o2-add-rec-available-recs").find("li #series"+seriesId+compId).find(":checkbox");
checkboxToUpdate.prop("checked",false);
checkboxToUpdate.closest(".recom-o2-add-rec-schedule-list-item").find(".recom-o2-add-rec-schedule-checkbox").prop("checked",false);
}selectedSeries.remove();
component.removeSelectedRecommendationListItem(recommendationType,seriesId);
if(!$("#addRecRightContainer"+compId).find(".recom-o2-selected-series").length){var addRecommendationsWindow=MP_ModalDialog.retrieveModalDialogObject("addRecommendation");
addRecommendationsWindow.setFooterButtonDither("addRecButton",true);
}});
selectedRecommendations.on("keypress",".recom-o2-sel-series-age-value",function(evt){var charCode=evt.which?evt.which:evt.keyCode;
if(charCode>31&&(charCode<48||charCode>57)){return false;
}return true;
});
selectedRecommendations.on("focusout",".recom-o2-sel-series-age-value",function(){var ageValue=$(this).val();
var datePickerElement=$(this).closest(".recom-o2-sel-series-due-date").find(".recom-o2-sel-series-date .recom-o2-date-selector-button");
if(ageValue){var ageFieldsContainer=$(this).closest(".recom-o2-sel-series-age");
var ageUnitSelected=ageFieldsContainer.find(".recom-o2-selected-series-age-drop-down option:selected").attr("meaning");
var dueDate=component.validateDueDateBasedOnAgeSelected(parseInt(ageValue,10),ageUnitSelected);
var informationMessageContainer=ageFieldsContainer.find(".recom-o2-inline-future-date-message");
if(dueDate){datePickerElement.datepicker("setDate",dueDate);
if(!informationMessageContainer.hasClass("hidden")){informationMessageContainer.addClass("hidden");
}}else{var inlineErrorHTML=MP_Core.generateUserMessageHTML("information","",component.m_i18nStrings.FUTURE_DATE_INFO_MESSAGE);
informationMessageContainer.empty().html(inlineErrorHTML);
informationMessageContainer.removeClass("hidden");
datePickerElement.datepicker("setDate",new Date());
}}else{datePickerElement.datepicker("setDate",new Date());
var dateInformationMessageContainer=$(this).closest(".recom-o2-sel-series-age").find(".recom-o2-inline-future-date-message");
if(!dateInformationMessageContainer.hasClass("hidden")){dateInformationMessageContainer.addClass("hidden");
}}datePickerElement.prev(".recom-o2-date-selector-input").change();
});
selectedRecommendations.on("change",".recom-o2-selected-series-age-drop-down",function(){$(this).closest(".recom-o2-sel-series-age").find(".recom-o2-sel-series-age-value").focusout();
});
selectedRecommendations.on("focusout",".recom-o2-new-series-title",function(){var recommendationTempId=$(this).closest(".recom-o2-selected-series").attr("series-id");
component.updateSelectedRecommendationListItem(recommendationTempId,"EXPECTATION_FTDESC",$(this).val(),component.RECOMMENDATION_TYPE.FREE_TEXT);
});
selectedRecommendations.on("keypress",".recom-o2-sel-series-freq-val",function(evt){var charCode=evt.which?evt.which:evt.keyCode;
if(charCode>31&&(charCode<48||charCode>57)){return false;
}return true;
});
selectedRecommendations.on("focusout",".recom-o2-sel-series-freq-val",function(){var recommendationTempId=$(this).closest(".recom-o2-selected-series").attr("series-id");
var frequencyUnitDropDown=$(this).parent(".recom-o2-sel-series-freq-options").find(".recom-o2-selected-series-frequency-drop-down");
var frequencyUnitVal=parseFloat(frequencyUnitDropDown.val());
var recommendationType=component.getTheRecommendationTypeBasedOnElement($(this));
component.updateSelectedRecommendationListItem(recommendationTempId,"FREQUENCY_VALUE",parseInt($(this).val(),10),recommendationType);
component.updateSelectedRecommendationListItem(recommendationTempId,"FREQUENCY_UNIT_CD",frequencyUnitVal,recommendationType);
});
selectedRecommendations.on("change",".recom-o2-selected-series-frequency-drop-down",function(){var recommendationTempId=$(this).closest(".recom-o2-selected-series").attr("series-id");
var recommendationType=component.getTheRecommendationTypeBasedOnElement($(this));
var frequencyCodeValue=$(this).find("option:selected").val();
component.updateSelectedRecommendationListItem(recommendationTempId,"FREQUENCY_UNIT_CD",parseFloat(frequencyCodeValue),recommendationType);
});
selectedRecommendations.on("change",".recom-o2-date-selector-input",function(){var recommendationTempId=$(this).closest(".recom-o2-selected-series").attr("series-id");
var recommendationType=component.getTheRecommendationTypeBasedOnElement($(this));
var dateValue=$(this).parent(".recom-o2-sel-series-date").find("#dateValueButton"+recommendationTempId+compId).datepicker("getDate");
component.updateSelectedRecommendationListItem(recommendationTempId,"NEW_DUE_DT_TM",dateValue,recommendationType);
});
$(".recom-o2-add-rec-reason-comment-container").on("change",".recom-o2-add-rec-reason-dropdown",function(){var reasonValue=$(this).find("option:selected").val();
component.setReasonOnAddition(parseFloat(reasonValue));
});
$(".recom-o2-add-rec-reason-comment-container").on("focusout",".recom-o2-add-rec-add-comment",function(){var commentValue=$(this).val();
component.setCommentOnAddition(commentValue);
});
selectedRecommendations.on("change",".recom-o2-sel-series-one-time-checkbox",function(){var checkedProperty=this.checked;
var selectedSeries=$(this).closest(".recom-o2-selected-series");
var frequencyFields=selectedSeries.find(".recom-o2-sel-series-freq-options");
var recommendationTempId=selectedSeries.attr("series-id");
var recommendationType=component.getTheRecommendationTypeBasedOnElement($(this));
if(checkedProperty){frequencyFields.find(".recom-o2-sel-series-freq-val").val("").prop("disabled",true).removeClass("recom-o2-required-field");
frequencyFields.find(".recom-o2-selected-series-frequency-drop-down").prop("disabled",true);
component.updateSelectedRecommendationListItem(recommendationTempId,"FREQUENCY_VALUE",0,recommendationType);
component.updateSelectedRecommendationListItem(recommendationTempId,"FREQUENCY_UNIT_CD",0,recommendationType);
}else{frequencyFields.find(".recom-o2-sel-series-freq-val").prop("disabled",false).addClass("recom-o2-required-field");
frequencyFields.find(".recom-o2-selected-series-frequency-drop-down").prop("disabled",false);
}});
$(".recom-o2-add-rec-reason-comment-container").on("paste keyup change",".recom-o2-add-rec-add-comment",function(){var maxLength=1000;
var currentCommentText=$(this).val();
if(currentCommentText.length>maxLength){$(this).val(currentCommentText.substring(0,maxLength));
}});
};
RecommendationsO2Component.prototype.validateDueDateBasedOnAgeSelected=function(ageValue,ageUnit){if(!this.getPatientDOB()){throw new Error("The patient DOB is not available");
}var patientCurrentAgeInSelectedUnit=this.GetDateDiffString(this.getPatientDOB(),new Date(),ageUnit);
if(patientCurrentAgeInSelectedUnit>ageValue){return false;
}else{return this.getDateBasedOnDifference(this.getPatientDOB(),ageValue,ageUnit);
}};
RecommendationsO2Component.prototype.getDateBasedOnDifference=function(beginDate,difference,differenceUnits){var calculatedDate=new Date(beginDate);
var DAYS_IN_WEEK=7;
var MIL_SECS_IN_HOUR=3600000;
switch(differenceUnits.toUpperCase()){case"YEARS":calculatedDate.setFullYear(calculatedDate.getFullYear()+difference);
break;
case"MONTHS":calculatedDate.setMonth(calculatedDate.getMonth()+difference);
break;
case"WEEKS":calculatedDate.setDate(calculatedDate.getDate()+DAYS_IN_WEEK*difference);
break;
case"DAYS":calculatedDate.setDate(calculatedDate.getDate()+difference);
break;
case"HOURS":calculatedDate.setTime(calculatedDate.getTime()+difference*MIL_SECS_IN_HOUR);
break;
default:calculatedDate.setFullYear(calculatedDate.getFullYear()+difference);
break;
}return calculatedDate;
};
RecommendationsO2Component.prototype.getTheRecommendationTypeBasedOnElement=function(element){var seriesType=element.closest(".recom-o2-selected-series").attr("series-type");
if(seriesType==="free-text"){return this.RECOMMENDATION_TYPE.FREE_TEXT;
}else{if(seriesType==="expectation"){return this.RECOMMENDATION_TYPE.EXPECTATION;
}}};
RecommendationsO2Component.prototype.addFreeTextToRightPanelSelectedList=function(){var addRecommendationsWindow=MP_ModalDialog.retrieveModalDialogObject("addRecommendation");
addRecommendationsWindow.setFooterButtonDither("addRecButton",false);
var criterion=this.getCriterion();
var freeTextCounter=this.getIncrementedFreeTextCounter();
var freeTextCounterWithID=freeTextCounter.toString()+this.m_componentId;
var disabledPropertyForAge="";
if(!this.getPatientDOB()){disabledPropertyForAge="disabled";
}var freqDropDown=this.renderDropDownWithUnitsCodeSet("frequency",freeTextCounter,"");
var ageDropDown=this.renderDropDownWithUnitsCodeSet("age",freeTextCounter,disabledPropertyForAge);
var seriesName="<span class='recom-o2-series-title-text recom-o2-required-display secondary-text'>"+this.m_i18nStrings.NEW_EXPECTATION_TITLE+"</span>";
var seriesHeader="<div class='recom-o2-sel-series-heading'><div class='recom-o2-sel-series-name'>"+seriesName+"</div><div class='recom-o2-sel-series-del-button'></div></div>";
var expectationNameHtml="<div class='recom-o2-new-series-title-input'><input type='text' size='32' id='freeTextName"+freeTextCounterWithID+"' series-id='"+freeTextCounter+"' class='recom-o2-new-series-title recom-o2-required-field'/><span class='secondary-text'><input type ='checkbox' class='recom-o2-sel-series-one-time-checkbox'/>&nbsp;"+this.m_i18nStrings.ONE_TIME_ONLY+"</span></div>";
var frequencyContentHtml="<div class='recom-o2-sel-series-frequency'><span class='recom-o2-frequency-text recom-o2-required-display secondary-text'>"+this.m_i18nStrings.FREQUENCY+"</span><div class='recom-o2-sel-series-freq-options'><input id='freqVal"+freeTextCounterWithID+"' class='recom-o2-sel-series-freq-val recom-o2-required-field' type='text' maxlength='3' size='3' onpaste='return false'/>"+freqDropDown+"</div></div>";
var ageContentHtml="<div class='recom-o2-sel-series-age secondary-text'>"+i18n.AGE+"<br/><input id='ageVal"+freeTextCounterWithID+"' class='recom-o2-sel-series-age-value' type='text' maxlength='3' size='3' onpaste='return false'"+disabledPropertyForAge+"/>"+ageDropDown+" &nbsp;"+this.m_i18nStrings.OR+" &nbsp;<br/><div class='recom-o2-inline-future-date-message hidden'></div></div>";
var dateContentHtml="<div class='recom-o2-sel-series-date'><span class='recom-o2-required-display secondary-text'>"+i18n.DATE+"</span><br/><input id='dateVal"+freeTextCounterWithID+"' type='text' size='10' class='recom-o2-date-selector-input recom-o2-required-field' readonly='true'/><input type='button' id='dateValueButton"+freeTextCounterWithID+"' class='recom-o2-date-selector-button'/></div>";
var selectedSeriesHtml="<div id='selected"+freeTextCounterWithID+"' class='recom-o2-selected-series free-text' series-id='"+freeTextCounter+"' series-type='free-text'>"+seriesHeader+expectationNameHtml+"<div class='recom-o2-sel-series-options'>"+frequencyContentHtml+"<div class='recom-o2-sel-series-due-date'>"+ageContentHtml+dateContentHtml+"</div></div></div>";
$("#addRecRightContainer"+this.m_componentId).find(".recom-o2-add-rec-selected-recs").prepend(selectedSeriesHtml);
this.attachDatePicker(freeTextCounter,"selected",false,new Date());
var addActionObject=this.getAssignActionObject();
addActionObject.RECOMMENDATION_TEMP_ID=freeTextCounter.toString();
addActionObject.PERSON_ID=criterion.person_id;
addActionObject.ON_BEHALF_OF_PRSNL_ID=criterion.provider_id;
addActionObject.NEW_DUE_DT_TM=new Date();
this.addItemToSelectedFreeTextExpectationsList(addActionObject);
};
RecommendationsO2Component.prototype.addSeriesToRightPanelSelectedList=function(seriesListItem){try{var addRecommendationsWindow=MP_ModalDialog.retrieveModalDialogObject("addRecommendation");
addRecommendationsWindow.setFooterButtonDither("addRecButton",false);
var seriesId=seriesListItem.attr("series-id");
var expectId=seriesListItem.attr("expect-id");
var stepId=seriesListItem.attr("step-id");
var seriesName=seriesListItem.text();
var criterion=this.getCriterion();
var compId=this.m_componentId;
var disabledPropertyForAge="";
var disablePropertyForFrequency="";
var currentFrequencyValueObject=null;
var seriesFrequencyTypeObject=this.determineFrequencyType(parseInt(seriesId,10));
var seriesFrequencyType=seriesFrequencyTypeObject.frequencyType;
var frequencyTypes=this.FREQUENCY_TYPE;
var frequencyDisplay="";
switch(seriesFrequencyType){case frequencyTypes.SEASONAL:disablePropertyForFrequency="disabled";
frequencyDisplay=this.m_i18nStrings.SEASONAL;
break;
case frequencyTypes.VARIABLE:frequencyDisplay=this.m_i18nStrings.VARIABLE;
break;
case frequencyTypes.ONE_TIME_ONLY:disablePropertyForFrequency="disabled";
frequencyDisplay=this.m_i18nStrings.ONE_TIME_ONLY;
break;
case frequencyTypes.FIXED_NO_OF_DAYS:var seriesFrequencyInDays=seriesFrequencyTypeObject.frequencyInDays;
currentFrequencyValueObject=this.formatFrequency(seriesFrequencyInDays);
break;
}if(!this.getPatientDOB()){disabledPropertyForAge="disabled";
}var freqDropDown=this.renderDropDownWithUnitsCodeSet("frequency",seriesId,disablePropertyForFrequency);
var ageDropDown=this.renderDropDownWithUnitsCodeSet("age",seriesId,disabledPropertyForAge);
var seriesHeader="<div class='recom-o2-sel-series-heading'><div class='recom-o2-sel-series-name'>"+seriesName+"</div><div class='recom-o2-sel-series-del-button'></div></div>";
var frequencyContentHtml="<div class='recom-o2-sel-series-frequency  secondary-text'>"+this.m_i18nStrings.FREQUENCY+"<span class='recom-o2-sel-series-freq-display'>"+frequencyDisplay+"</span><div class='recom-o2-sel-series-freq-options'><input id='freqVal"+seriesId+compId+"' class='recom-o2-sel-series-freq-val' type='text' maxlength='3' size='3' onpaste='return false'"+disablePropertyForFrequency+"/>"+freqDropDown+"</div></div>";
var ageContentHtml="<div class='recom-o2-sel-series-age secondary-text'>"+i18n.AGE+"<br/><input id='ageVal"+seriesId+compId+"' class='recom-o2-sel-series-age-value' type='text' maxlength='3' size='3' onpaste='return false' "+disabledPropertyForAge+"/>"+ageDropDown+" &nbsp;"+this.m_i18nStrings.OR+" &nbsp;<br/><div class='recom-o2-inline-future-date-message hidden'></div></div>";
var dateContentHtml="<div class='recom-o2-sel-series-date secondary-text'><span class='recom-o2-required-display'>"+i18n.DATE+"</span><br/><input id='dateVal"+seriesId+compId+"' type='text' size='10' class='recom-o2-date-selector-input' readonly='true'/><input type='button' id='dateValueButton"+seriesId+compId+"' class='recom-o2-date-selector-button'/></div>";
var selectedSeriesHtml="<div id='selected"+seriesId+compId+"' class='recom-o2-selected-series' series-id='"+seriesId+"' series-type='expectation'>"+seriesHeader+"<div class='recom-o2-sel-series-options'>"+frequencyContentHtml+"<div class='recom-o2-sel-series-due-date'>"+ageContentHtml+dateContentHtml+"</div></div></div>";
$("#addRecRightContainer"+compId).find(".recom-o2-add-rec-selected-recs").append(selectedSeriesHtml);
this.attachDatePicker(seriesId,"selected",false,new Date());
var addActionObject=this.getAssignActionObject();
if(currentFrequencyValueObject){var currentSeriesContent=$("#selected"+seriesId+compId);
currentSeriesContent.find("#freqVal"+seriesId+compId).val(currentFrequencyValueObject.frequencyValue);
$("#frequencyOption"+seriesId+compId).val(currentFrequencyValueObject.frequencyCodeValue);
addActionObject.FREQUENCY_VALUE=currentFrequencyValueObject.frequencyValue;
addActionObject.FREQUENCY_UNIT_CD=currentFrequencyValueObject.frequencyCodeValue;
var fixedDaysFrequencyObject={SERIES_ID:seriesId,FREQUENCY_VALUE:currentFrequencyValueObject.frequencyValue,FREQUENCY_UNIT_CD:currentFrequencyValueObject.frequencyCodeValue};
this.addExpectationWithFixedDaysFrequency(fixedDaysFrequencyObject);
}addActionObject.RECOMMENDATION_TEMP_ID=seriesId;
addActionObject.PERSON_ID=criterion.person_id;
addActionObject.EXPECT_ID=parseFloat(expectId);
addActionObject.STEP_ID=parseFloat(stepId);
addActionObject.ON_BEHALF_OF_PRSNL_ID=criterion.provider_id;
addActionObject.NEW_DUE_DT_TM=new Date();
this.addItemToSelectedExpectationsList(addActionObject);
}catch(error){logger.logJSError(error,RecommendationsO2Component,"recommendations-o2.js","addSeriesToRightPanelSelectedList");
}};
RecommendationsO2Component.prototype.renderDropDownWithUnitsCodeSet=function(context,seriesId,disabledProperty){var dropDown="<select id='"+context+"Option"+seriesId+this.m_componentId+"' class='recom-o2-selected-series-"+context+"-drop-down' "+disabledProperty+">";
var unitsCodes=this.getTimeUnitsCodeSet();
var codeSetLength=unitsCodes.length;
for(var codeIndex=0;
codeIndex<codeSetLength;
codeIndex++){dropDown+="<option value='"+unitsCodes[codeIndex].FREQUENCY_CD+"' meaning='"+unitsCodes[codeIndex].FREQUENCY_MEANING+"'>"+unitsCodes[codeIndex].FREQUENCY_DISPLAY+"</option>";
}dropDown+="</select>";
return dropDown;
};
RecommendationsO2Component.prototype.attachDatePicker=function(seriesId,containerDiv,allowPastDates,dateObject){var compId=this.m_componentId;
var datePickerElement=null;
var minDateValue=allowPastDates?"":"0d";
var datePickerOptions={showOn:"both",buttonImage:CERN_static_content+"/images/4974.png",buttonImageOnly:true,buttonText:"",changeMonth:true,changeYear:true,minDate:minDateValue,altField:$("#dateVal"+seriesId+compId),showButtonPanel:true,dateFormat:dateFormat.masks.shortdate.toLowerCase(),onSelect:function(){var futureDateMsg=$(this).closest(".recom-o2-sel-series-due-date").find(".recom-o2-inline-future-date-message");
if(!(futureDateMsg.hasClass("hidden"))){futureDateMsg.addClass("hidden");
}$("#dateVal"+seriesId+compId).change();
}};
datePickerElement=$("#"+containerDiv+seriesId+compId).find("#dateValueButton"+seriesId+compId);
datePickerElement.datepicker(datePickerOptions);
if(dateObject){datePickerElement.datepicker("setDate",dateObject);
}};
RecommendationsO2Component.prototype.removeSelectedRecommendationListItem=function(recommendationType,recommendationId){var listToUpdate=[];
var listIndexToRemove=-1;
if(recommendationType===this.RECOMMENDATION_TYPE.FREE_TEXT){listToUpdate=this.getSelectedFreeTextExpectationsList();
}else{if(recommendationType===this.RECOMMENDATION_TYPE.EXPECTATION){listToUpdate=this.getSelectedExpectationsList();
}}for(var listIndex=listToUpdate.length;
listIndex--;
){if(listToUpdate[listIndex].RECOMMENDATION_TEMP_ID===recommendationId){listIndexToRemove=listIndex;
break;
}}if(listIndexToRemove!==-1){listToUpdate.splice(listIndexToRemove,1);
}};
RecommendationsO2Component.prototype.updateSelectedRecommendationListItem=function(recommendationTempId,updateField,updateValue,recommendationType){var listToUpdate=[];
if(recommendationType===this.RECOMMENDATION_TYPE.EXPECTATION){listToUpdate=this.getSelectedExpectationsList();
}else{if(recommendationType===this.RECOMMENDATION_TYPE.FREE_TEXT){listToUpdate=this.getSelectedFreeTextExpectationsList();
}}for(var listIndex=listToUpdate.length;
listIndex--;
){if(listToUpdate[listIndex].RECOMMENDATION_TEMP_ID===recommendationTempId){var ListItemToUpdate=listToUpdate[listIndex];
ListItemToUpdate[updateField]=updateValue;
break;
}}};
RecommendationsO2Component.prototype.processAvailableRecommendations=function(availableRecs){var scheduleList=availableRecs.SCHED;
var scheduleListAssigned=this.getRecommendationsDataReply();
scheduleList.sort(function(a,b){if(a.EXPECT_SCHED_NAME.toUpperCase()>b.EXPECT_SCHED_NAME.toUpperCase()){return 1;
}else{if(a.EXPECT_SCHED_NAME.toUpperCase()<b.EXPECT_SCHED_NAME.toUpperCase()){return -1;
}}return 0;
});
for(var i=scheduleListAssigned.length;
i--;
){for(var j=scheduleList.length;
j--;
){if(scheduleListAssigned[i].SCHEDULE_ID===scheduleList[j].EXPECT_SCHED_ID){if(scheduleListAssigned[i].SERIES.length===scheduleList[j].SERIES.length){scheduleList[j].DITHERED_IND=true;
}else{var seriesList=scheduleListAssigned[i].SERIES;
var availableSeries=scheduleList[j].SERIES;
for(var seriesIndex=seriesList.length;
seriesIndex--;
){for(var availSeriesIndex=availableSeries.length;
availSeriesIndex--;
){if(seriesList[seriesIndex].SERIES_ID===availableSeries[availSeriesIndex].EXPECT_SERIES_ID){availableSeries[availSeriesIndex].DITHERED_IND=true;
break;
}}}}break;
}}}};
RecommendationsO2Component.prototype.isFavoriteSet=function(expectId){var favObjLength=this.m_recomPrefObj.favoritesObject.length;
var favObj=this.m_recomPrefObj.favoritesObject;
for(var i=0;
i<favObjLength;
i++){if(expectId===favObj[i].EXPECT_ID){return favObj[i].FAVORITE;
}}};
RecommendationsO2Component.prototype.processResultsForRender=function(recomRecs){var recomRecsLength=recomRecs.length;
var compNS=this.getStyles().getNameSpace();
var recomi18n=i18n.discernabu.recommendations_o2;
var addProcedureActionObject=this.getAddProcedureAction();
for(recomRecsLength;
recomRecsLength--;
){var recomResult=recomRecs[recomRecsLength];
var dueDate="--";
var dateTime=new Date();
var frequency="";
var statusText="";
var imgClass="";
var overdueClass="";
var expectId=recomResult.EXPECT_ID;
switch(recomResult.DUE_STATUS_FLAG){case this.DUE_TYPE.OVERDUE:imgClass=compNS+"-overdue-img";
overdueClass=compNS+"-overdue";
statusText=recomi18n.OVER_DUE;
break;
case this.DUE_TYPE.NEARDUE:imgClass=compNS+"-neardue-img";
statusText=recomi18n.NEAR_DUE;
break;
case this.DUE_TYPE.DUE:imgClass=compNS+"-due-img";
statusText=recomi18n.DUE;
break;
case this.DUE_TYPE.SATISFIED:statusText=recomi18n.NOT_DUE;
break;
}recomResult.DUE_STATUS_TEXT=statusText;
if(recomResult.GROUP_NAME==="!FREETEXT!"){recomResult.GROUP_NAME=recomi18n.FREETEXT;
recomResult.FAVORITES_DISP=recomi18n.OTHERS;
}if(recomResult.GROUP_NAME!==recomi18n.FREETEXT){if(this.isFavoriteSet(expectId)){recomResult.FAVORITES="<span expectId='"+expectId+"' class='recom-o2-fav-set'></span>";
recomResult.FAVORITES_DISP=recomi18n.FAVORITES;
}else{recomResult.FAVORITES="<span expectId='"+expectId+"' class='recom-o2-fav-not-set'></span>";
recomResult.FAVORITES_DISP=recomi18n.OTHERS;
}}if(recomResult.FREQ_VALUE===-2){frequency=recomi18n.SEASONAL;
}else{if(recomResult.FREQ_VALUE===-1){frequency=recomi18n.VARIABLE;
}else{if(recomResult.FREQ_VALUE===0){frequency=recomi18n.ONE_TIME_ONLY;
}else{if(recomResult.FREQ_VALUE>0){frequency="Q "+recomResult.FREQ_VALUE+recomResult.FREQ_UNIT_DISP;
}}}}recomResult.FREQUENCY_TEXT=frequency;
this.processResultsForHovering(recomResult);
if(recomResult.DUE_DATE_UTC!==""){dateTime.setISO8601(recomResult.DUE_DATE_UTC);
dueDate=dateTime.format(dateFormat.masks.shortDate2);
}var expClass=overdueClass;
var frqClass=overdueClass;
var dueClass=overdueClass;
recomResult.DUE_IMAGE="<div class='"+imgClass+"'>&nbsp;</div>";
recomResult.EXPECTATION_NAME="<span class='"+expClass+"'>"+recomResult.EXPECT_STEP+"</span>";
recomResult.PRIORITY_TYPE="<span class='"+overdueClass+"'>"+recomResult.PRIORITY_DISP+"</span>";
recomResult.FREQUENCY="<span class='"+frqClass+"'>"+frequency+"</span>";
recomResult.DUE_DATE_STRING="<span class='"+dueClass+"'>"+dueDate+"</span>";
recomResult.EXPECTATION_NAME=recomResult.HAS_EXP_MODIFY_IND?(recomResult.EXPECTATION_NAME+"<span class='recom-o2-modify-indicator "+overdueClass+"'></span>"):recomResult.EXPECTATION_NAME;
recomResult.FREQUENCY=recomResult.HAS_FREQ_MODIFY_IND?(recomResult.FREQUENCY+"<span class='recom-o2-modify-indicator "+overdueClass+"'></span>"):recomResult.FREQUENCY;
recomResult.DUE_DATE_STRING=recomResult.HAS_DUE_DATE_MODIFY_IND?(recomResult.DUE_DATE_STRING+"<span class='recom-o2-modify-indicator "+overdueClass+"'></span>"):recomResult.DUE_DATE_STRING;
recomResult.REFERENCE_TEXT=this.hasReferenceText(recomResult)?("<span class='recom-o2-reference-text-icon'></span>"):"";
if(this.m_modifyObject.saveSuccessful&&recomResult.RECOMMENDATION_ID===this.m_modifyObject.RECOMMENDATION_ID){this.m_modifyObject.modifiedRowId="row"+recomRecsLength;
}else{if(this.getActionObject()&&this.getActionObject().saveSuccessful&&recomResult.RECOMMENDATION_ID===this.getActionObject().RECOMMENDATION_ID){this.getActionObject().modifiedRowId="row"+recomRecsLength;
}else{if(recomResult.RECOMMENDATION_ID===this.m_systemSatisfierAction.recommendationId&&this.m_componentId===this.m_systemSatisfierAction.componentId){this.m_systemSatisfierAction.modifiedRowId="row"+recomRecsLength;
}else{if(addProcedureActionObject&&addProcedureActionObject.saveSuccessful&&recomResult.RECOMMENDATION_ID===addProcedureActionObject.RECOMMENDATION_ID){addProcedureActionObject.modifiedRowId="row"+recomRecsLength;
}}}}}};
RecommendationsO2Component.prototype.hasReferenceText=function(recomResult){if(this.m_referenceTextExistsObj){var entityList=this.m_referenceTextExistsObj;
var entityListLength=entityList.length;
var satisfiers=recomResult.SATISFIERS;
var currentEntity=null;
var hasReferencetext=false;
var satisfierLength=satisfiers.length;
var currentSatisfier=null;
for(var i=0;
i<entityListLength;
i++){currentEntity=entityList[i];
if(currentEntity.PARENT_ENTITY_ID===recomResult.EXPECT_ID){recomResult.EXPECTATION_REF_TEXT_ENTITY=currentEntity;
hasReferencetext=true;
recomResult.EXPECTATION_REF_TEXT=1;
}else{if(currentEntity.PARENT_ENTITY_ID===recomResult.SCHED_ID){recomResult.SCHEDULE_REF_TEXT_ENTITY=currentEntity;
hasReferencetext=true;
recomResult.SCHEDULE_REF_TEXT=1;
}else{for(var j=0;
j<satisfierLength;
j++){currentSatisfier=satisfiers[j];
if(currentEntity.PARENT_ENTITY_ID===currentSatisfier.EXPECT_SAT_ID){currentSatisfier.SATISFIER_REF_TEXT_ENTITY=currentEntity;
hasReferencetext=true;
currentSatisfier.SCHEDULE_REF_TEXT=1;
}}}}}return hasReferencetext;
}else{return false;
}};
RecommendationsO2Component.prototype.updateFavoriteObj=function(curElementExpectId,boolFav){var preferenceObj=this.m_recomPrefObj.favoritesObject;
var preferenceObjLen=preferenceObj.length;
for(preferenceObjLen;
preferenceObjLen--;
){var curFav=preferenceObj[preferenceObjLen];
var curFavRecomId=curFav.EXPECT_ID;
if(curFavRecomId===curElementExpectId){curFav.FAVORITE=boolFav;
return true;
}}return false;
};
RecommendationsO2Component.prototype.processResultsForHovering=function(recomResult){recomResult.HAS_EXP_MODIFY_IND=false;
recomResult.HAS_FREQ_MODIFY_IND=false;
recomResult.HAS_DUE_DATE_MODIFY_IND=false;
recomResult.EXP_HOVER="";
recomResult.FREQ_HOVER="";
recomResult.DUE_DATE_HOVER="";
if(!recomResult.HAS_MODIFY_IND){return;
}var compNS=this.getStyles().getNameSpace();
this.m_hoverContainerClassName=compNS+(CERN_Platform.isTouchModeEnabled()?("-rp-content-data "+compNS+"-rp-hover-details"):"-hover ");
if(recomResult.ASSIGNED_INFO.length){recomResult.HAS_EXP_MODIFY_IND=true;
recomResult.EXP_HOVER=this.processAssignedInfo(recomResult.ASSIGNED_INFO);
}if(recomResult.FREQ_HIST.length){recomResult.HAS_FREQ_MODIFY_IND=true;
recomResult.FREQ_HOVER=this.processFrequencyHistoryInfo(recomResult.FREQ_HIST);
}if(recomResult.DUE_HIST.length){recomResult.HAS_DUE_DATE_MODIFY_IND=true;
recomResult.DUE_DATE_HOVER=this.processDueDateHistoryInfo(recomResult.DUE_HIST);
}};
RecommendationsO2Component.prototype.processDueDateHistoryInfo=function(dueDateHistoryList){var recomi18n=i18n.discernabu.recommendations_o2;
var listLength=dueDateHistoryList.length;
var dueDateHistoryInfoHtml="";
for(var index=0;
index<listLength;
index++){var dateTime=new Date();
var date="--";
var due=dueDateHistoryList[index];
var provider=MP_Util.GetValueFromArray(due.ACTION_PRSNL_ID,this.m_personnelArray);
var providerName=(provider===null)?"--":provider.fullName;
if(due.ACTION_DATE!==""){dateTime.setISO8601(due.ACTION_DATE);
date=dateTime.format("shortDate2");
}var prevDate="--";
var newDate="--";
if(due.PREV_DUE_DATE!==""){dateTime.setISO8601(due.PREV_DUE_DATE);
prevDate=dateTime.format("shortDate2");
}if(due.DUE_DATE!==""){dateTime.setISO8601(due.DUE_DATE);
newDate=dateTime.format("shortDate2");
}due.REASON_TEXT=due.REASON_TEXT||"--";
due.ACTION_COMMENT=due.ACTION_COMMENT.replace(/\n/g,"<br />")||"--";
dueDateHistoryInfoHtml+="<span class = '"+this.m_hoverContainerClassName+"'><p>"+recomi18n.MODIFIED_BY.replace("{0}",providerName).replace("{1}",date)+"</p><p>"+recomi18n.DUE_DATE_CHANGED_FROM.replace("{0}",prevDate).replace("{1}",newDate)+"</p><p>"+recomi18n.REASON+" "+due.REASON_TEXT+" </p><p>"+recomi18n.COMMENTS+" "+due.ACTION_COMMENT+"</p></span>";
}return dueDateHistoryInfoHtml;
};
RecommendationsO2Component.prototype.processFrequencyHistoryInfo=function(freqHistoryList){var recomi18n=i18n.discernabu.recommendations_o2;
var listLength=freqHistoryList.length;
var frequencyHistoryInfoHtml="";
for(var index=0;
index<listLength;
index++){var dateTime=new Date();
var date="--";
var freq=freqHistoryList[index];
var provider=MP_Util.GetValueFromArray(freq.ACTION_PRSNL_ID,this.m_personnelArray);
var providerName=(provider===null)?i18n.UNKNOWN:provider.fullName;
if(freq.ACTION_DATE!==""){dateTime.setISO8601(freq.ACTION_DATE);
date=dateTime.format("shortDate2");
}var prevFreq;
if(freq.PREV_FREQ_VALUE===0){prevFreq=this.getInitialFrequency(freqHistoryList);
}else{if(freq.PREV_FREQ_VALUE===-1){prevFreq=recomi18n.VARIABLE;
}else{prevFreq=freq.PREV_FREQ_VALUE+" "+freq.PREV_FREQ_UNIT_DISP;
}}var newfreq;
if(freq.FREQ_VALUE===0){newfreq=this.getInitialFrequency(freqHistoryList);
}else{if(freq.FREQ_VALUE===-1){newfreq=recomi18n.VARIABLE;
}else{newfreq=freq.FREQ_VALUE+" "+freq.FREQ_UNIT_DISP;
}}freq.REASON_TEXT=(freq.REASON_TEXT)?freq.REASON_TEXT:"--";
freq.ACTION_COMMENT=(freq.ACTION_COMMENT)?freq.ACTION_COMMENT.replace(/\n/g,"<br />"):"--";
frequencyHistoryInfoHtml+="<span class = '"+this.m_hoverContainerClassName+"'><p>"+recomi18n.MODIFIED_BY.replace("{0}",providerName).replace("{1}",date)+"</p><p>"+recomi18n.FREQUENCY_CHANGED_FROM.replace("{0}",prevFreq).replace("{1}",newfreq)+"</p><p>"+recomi18n.REASON+" "+freq.REASON_TEXT+" </p><p>"+recomi18n.COMMENTS+" "+freq.ACTION_COMMENT+"</p></span>";
}return frequencyHistoryInfoHtml;
};
RecommendationsO2Component.prototype.getInitialFrequency=function(freqHistoryList){var listLength=freqHistoryList.length;
var recomi18n=i18n.discernabu.recommendations_o2;
if(freqHistoryList[listLength-1].PREV_FREQ_VALUE===0){return recomi18n.ONE_TIME_ONLY;
}else{if(freqHistoryList[listLength-1].PREV_FREQ_VALUE===-1){return recomi18n.VARIABLE;
}}return freqHistoryList[listLength-1].PREV_FREQ_VALUE+" "+freqHistoryList[listLength-1].PREV_FREQ_UNIT_DISP;
};
RecommendationsO2Component.prototype.processAssignedInfo=function(assignedInfoList){var recomi18n=i18n.discernabu.recommendations_o2;
var dateTime=new Date();
var date="--";
var assignedInfoHtml="";
var infoObj=assignedInfoList[0];
var provider=MP_Util.GetValueFromArray(infoObj.ACTION_PRSNL_ID,this.m_personnelArray);
var providerName=(provider===null)?i18n.UNKNOWN:provider.fullName;
if(infoObj.ACTION_DATE!==""){dateTime.setISO8601(infoObj.ACTION_DATE);
date=dateTime.format("shortDate2");
}infoObj.REASON_TEXT=(infoObj.REASON_TEXT)?infoObj.REASON_TEXT:"--";
infoObj.ACTION_COMMENT=(infoObj.ACTION_COMMENT)?infoObj.ACTION_COMMENT.replace(/\n/g,"<br />"):"--";
assignedInfoHtml="<span class = '"+this.m_hoverContainerClassName+"'><p>"+recomi18n.ASSIGNED_BY.replace("{0}",providerName).replace("{1}",date)+"</p><p>"+recomi18n.REASON+" "+infoObj.REASON_TEXT+"</p><p>"+recomi18n.COMMENTS+" "+infoObj.ACTION_COMMENT+"</p></span>";
return assignedInfoHtml;
};
RecommendationsO2Component.prototype.retrieveComponentData=function(){var criterion=this.getCriterion();
var retrieveAdditionalDetails=1;
var self=this;
this.resetModifyIndicators();
var loadTimer=new RTMSTimer(this.getComponentLoadTimerName());
var renderTimer=new RTMSTimer(this.getComponentRenderTimerName());
var rootComponentNode=this.getRootComponentNode();
if(rootComponentNode){$(rootComponentNode).find(".sec-total").html(i18n.LOADING_DATA+"...");
}var scriptRequest=new ComponentScriptRequest();
scriptRequest.setProgramName("MP_GET_HMI");
scriptRequest.setParameterArray(["^MINE^",criterion.person_id+".0",criterion.provider_id+".0",criterion.encntr_id+".0",retrieveAdditionalDetails,criterion.position_cd+".0"]);
scriptRequest.setComponent(this);
scriptRequest.setLoadTimer(loadTimer);
scriptRequest.setRenderTimer(renderTimer);
scriptRequest.setResponseHandler(function(scriptReply){self.renderComponent(scriptReply);
});
scriptRequest.performRequest();
};
RecommendationsO2Component.prototype.createColumn=function(colInfo){var column=new TableColumn();
column.setColumnId(colInfo.ID);
column.setCustomClass(colInfo.CLASS);
column.setColumnDisplay(colInfo.DISPLAY);
if(colInfo.SORTABLE){column.setPrimarySortField(colInfo.PRIMARY_SORT_FIELD);
column.setIsSortable(colInfo.SORTABLE);
column.addSecondarySortField(colInfo.SEC_SORT_FIELD,TableColumn.SORT.ASCENDING);
}column.setRenderTemplate("${ "+colInfo.RENDER_TEMPLATE+"}");
return column;
};
RecommendationsO2Component.prototype.generateFilterHtml=function(){var userPrefs=this.getPreferencesObj();
var compID=this.getComponentId();
var compNS=this.getStyles().getNameSpace();
var recomi18n=i18n.discernabu.recommendations_o2;
var groupFilterHtml="";
var filterName="";
var filter="";
if(userPrefs!==null&&userPrefs.groupByPref!==0){this.m_recomPrefObj.groupByPref=userPrefs.groupByPref;
}filter=this.m_recomPrefObj.groupByPref;
switch(filter){case this.FILTERS.CATEGORY:filterName=recomi18n.CATEGORY;
break;
case this.FILTERS.PRIORITY:filterName=recomi18n.PRIORITY;
break;
case this.FILTERS.FAVORITES:filterName=recomi18n.FAVORITES;
break;
default:filterName=recomi18n.NONE;
break;
}groupFilterHtml="<div class='"+compNS+"-controls' id='recomControls"+compID+"'><span class='"+compNS+"-groupby'>"+recomi18n.GROUP_BY+"</span><span id='"+compID+"qFilterSpan' class='"+compNS+"-filter'>"+filterName+"<span class='wrkflw-selectArrow'></span></span></div><div id='"+compID+"recomFilterMenu' class='"+compNS+"-filterdiv'><div id='recom-category-filter"+compID+"' class='"+compNS+"-allfilter'>"+recomi18n.CATEGORY+"</div><div id='recom-priority-filter"+compID+"' class='"+compNS+"-allfilter'>"+recomi18n.PRIORITY+"</div>";
if(this.isFavoriteAvaliable()){groupFilterHtml+="<div id='recom-favorites-filter"+compID+"' class='"+compNS+"-allfilter'>"+recomi18n.FAVORITES+"</div>";
}else{groupFilterHtml+="<div id='recom-favorites-filter"+compID+"' class='"+compNS+"-allfilter-disabled'>"+recomi18n.FAVORITES+"</div>";
}groupFilterHtml+="<div id='recom-none-filter"+compID+"' class='"+compNS+"-allfilter'>"+recomi18n.NONE+"</div></div>";
return groupFilterHtml;
};
RecommendationsO2Component.prototype.selectDefaultRow=function(scrollToTop){if(this.m_$tableView&&this.m_$tableView.length){var tableRowArr=this.m_$tableView.find(".result-info");
var firstRow=tableRowArr[0];
var rowId=this.getRowId(firstRow);
var scrollTop=0;
this.m_lastSelectedRow="";
this.m_lastSelectedRowProperty="";
this.updateInfo(firstRow,this.m_recommendationsTable.getRowById(rowId).getResultData(),true,this.refTextResponse);
if(scrollToTop){$("#"+this.m_recommendationsTable.getNamespace()+"tableBody").scrollTop(scrollTop);
}}};
RecommendationsO2Component.prototype.groupByFilter=function(filter,recomResults){var compID=this.getComponentId();
var quickFilter=$("#"+compID+"qFilterSpan");
var filterText="";
var recomi18n=i18n.discernabu.recommendations_o2;
if(this.m_lastSelFilter!==filter){this.m_lastSelFilter=filter;
switch(filter){case this.FILTERS.CATEGORY:filterText=recomi18n.CATEGORY;
this.m_recommendationsTable.quickGroup("GROUP_NAME","<span>${GROUP_NAME}</span>",false);
this.m_recommendationsTable.getGroupSequence().sort();
break;
case this.FILTERS.PRIORITY:filterText=recomi18n.PRIORITY;
this.m_recommendationsTable.sortByColumnInDirection("PRIORITY",TableColumn.SORT.DESCENDING);
this.m_recommendationsTable.quickGroup("PRIORITY_DISP","<span>${PRIORITY_DISP}</span>",false);
break;
case this.FILTERS.FAVORITES:this.m_recommendationsTable.clearGroups();
filterText=recomi18n.FAVORITES;
var fav=this.getFavorite(recomResults);
var others=this.getOthers(recomResults);
this.m_recommendationsTable.sortByColumnInDirection("FAVORITES",TableColumn.SORT.ASCENDING);
if(fav.length){var favoritesGroup=new TableGroup();
favoritesGroup.setGroupId(recomi18n.FAVORITES).setDisplay("").setHideHeader(true).setShowCount(false);
favoritesGroup.bindData(fav);
this.m_recommendationsTable.addGroup(favoritesGroup);
if(others.length){var othersGroup=new TableGroup();
othersGroup.setGroupId(recomi18n.OTHERS).setDisplay(this.m_i18nStrings.OTHERS).setShowCount(true).setIsExpanded(false);
othersGroup.bindData(others);
this.m_recommendationsTable.addGroup(othersGroup);
}}break;
case this.FILTERS.NONE:filterText=recomi18n.NONE;
this.m_recommendationsTable.clearGroups();
break;
default:break;
}this.m_recommendationsTable.sortByColumnInDirection("DUE",TableColumn.SORT.ASCENDING);
switch(filter){case this.FILTERS.CATEGORY:filterText=recomi18n.CATEGORY;
break;
case this.FILTERS.PRIORITY:filterText=recomi18n.PRIORITY;
break;
case this.FILTERS.FAVORITES:filterText=recomi18n.FAVORITES;
break;
case this.FILTERS.NONE:filterText=recomi18n.NONE;
break;
}if(quickFilter.length>0){quickFilter[0].firstChild.nodeValue=filterText;
}this.m_recomPrefObj.groupByPref=this.m_lastSelFilter;
this.resetSidePanelHeight();
if(this.m_isSidePanelOpen){this.selectDefaultRow(true);
}this.setPreferencesObj(this.m_recomPrefObj);
this.savePreferences(true);
}quickFilter.click();
};
RecommendationsO2Component.prototype.getFavorite=function(recomResults){var fav=[];
var favLen=recomResults.length;
for(var i=0;
i<favLen;
i++){var curRec=recomResults[i];
if(curRec.FAVORITES_DISP===this.m_i18nStrings.FAVORITES){fav.push(curRec);
}}return fav;
};
RecommendationsO2Component.prototype.getOthers=function(recomResults){var others=[];
var othersLen=recomResults.length;
for(var i=0;
i<othersLen;
i++){var curRec=recomResults[i];
if(curRec.FAVORITES_DISP===this.m_i18nStrings.OTHERS){others.push(curRec);
}}return others;
};
RecommendationsO2Component.prototype.attachListeners=function(recomResults){var compNS=this.getStyles().getNameSpace();
var compID=this.getComponentId();
var quickFilter=$("#"+compID+"qFilterSpan");
var filterMenu=$("#"+compID+"recomFilterMenu");
var classVisible=compNS+"-visible";
var classHvrClick=compNS+"-qHvr-click";
var classHvrUnClick=compNS+"-qHvr-unclick";
var classFilterHover=compNS+"-filter-hover";
function closeGroupByMenuWindow(){filterMenu.removeClass(classVisible);
quickFilter.removeClass(classHvrClick);
quickFilter.addClass(classHvrUnClick);
}quickFilter.click(function(){if(filterMenu.hasClass(classVisible)){closeGroupByMenuWindow();
}else{filterMenu.addClass(classVisible);
$(this).removeClass(classHvrUnClick);
$(this).removeClass(classFilterHover);
$(this).addClass(classHvrClick);
}});
quickFilter.mouseenter(function(){if(!(filterMenu.hasClass(classVisible))){$(this).removeClass(classHvrUnClick);
$(this).addClass(classFilterHover);
}});
quickFilter.mouseleave(function(){if(!(filterMenu.hasClass(classVisible))){$(this).removeClass(classHvrUnClick);
$(this).removeClass(classFilterHover);
}});
var quickFilterMenuArr=filterMenu.find("."+compNS+"-allfilter,."+compNS+"-allfilter-disabled");
var component=this;
quickFilterMenuArr.each(function(index){$(this).click(function(){component.groupByFilter(index+1,recomResults);
});
});
filterMenu.mouseleave(function(){if(filterMenu.hasClass(classVisible)){closeGroupByMenuWindow();
}});
};
RecommendationsO2Component.prototype.addCellClickExtension=function(recomRecords){var component=this;
var cellClickExtension=new TableCellClickCallbackExtension();
cellClickExtension.setCellClickCallback(function(event,data){if(data.COLUMN_ID==="FAVORITES"){component.onFavouriteClick(event,data,recomRecords);
}else{component.onRowClick(event,data);
}});
this.m_recommendationsTable.addExtension(cellClickExtension);
};
RecommendationsO2Component.prototype.findRecomResult=function(expectId,recomRecords){var curResult=null;
var recomResultLen=recomRecords.length;
for(recomResultLen;
recomResultLen--;
){curResult=recomRecords[recomResultLen];
if(curResult.EXPECT_ID===expectId){return curResult;
}}};
RecommendationsO2Component.prototype.onFavouriteClick=function(event,data,recomRecords){var self=this;
var componentTable=this.getComponentTable();
var currentElement=$(event.currentTarget.lastChild);
var curElementRecomId=parseInt(currentElement.attr("expectId"),10);
var curRecom=null;
if(currentElement.hasClass("recom-o2-fav-set")){curRecom=self.findRecomResult(curElementRecomId,recomRecords);
currentElement.removeClass("recom-o2-fav-set").addClass("recom-o2-fav-not-set");
curRecom.FAVORITES="<span expectId='"+curElementRecomId+"' class='recom-o2-fav-not-set'></span>";
curRecom.FAVORITES_DISP=this.m_i18nStrings.OTHERS;
if(!self.updateFavoriteObj(curElementRecomId,false)){self.m_recomPrefObj.favoritesObject.push({EXPECT_ID:curElementRecomId,FAVORITE:false});
}}else{if(currentElement.hasClass("recom-o2-fav-not-set")){currentElement.removeClass("recom-o2-fav-not-set").addClass("recom-o2-fav-set");
curRecom=self.findRecomResult(curElementRecomId,recomRecords);
curRecom.FAVORITES="<span expectId='"+curElementRecomId+"' class='recom-o2-fav-set'></span>";
curRecom.FAVORITES_DISP=this.m_i18nStrings.FAVORITES;
if(!self.updateFavoriteObj(curElementRecomId,true)){self.m_recomPrefObj.favoritesObject.push({EXPECT_ID:curElementRecomId,FAVORITE:true});
}}}if(self.m_recomPrefObj.groupByPref===self.FILTERS.FAVORITES){self.updateGrouping(recomRecords);
}self.updateFavoriteFilter(recomRecords);
componentTable.refresh();
self.setPreferencesObj(self.m_recomPrefObj);
self.savePreferences(true);
};
RecommendationsO2Component.prototype.updateFavoriteFilter=function(recomRecords){var compID=this.getComponentId();
var favoriteFilter=$("#recom-favorites-filter"+compID);
var fav=this.getFavorite(recomRecords);
if(fav.length){favoriteFilter.removeClass("recom-o2-allfilter-disabled").addClass("recom-o2-allfilter");
}else{favoriteFilter.removeClass("recom-o2-allfilter").addClass("recom-o2-allfilter-disabled");
}};
RecommendationsO2Component.prototype.updateGrouping=function(recomResults){this.m_recommendationsTable.clearGroups();
var fav=this.getFavorite(recomResults);
var others=this.getOthers(recomResults);
this.m_recommendationsTable.sortByColumnInDirection("FAVORITES",TableColumn.SORT.ASCENDING);
if(fav.length){var favoritesGroup=new TableGroup();
favoritesGroup.setGroupId("FAVORITES").setDisplay("").setShowCount(false).setHideHeader(true);
favoritesGroup.bindData(fav);
this.m_recommendationsTable.addGroup(favoritesGroup);
if(others.length){var othersGroup=new TableGroup();
othersGroup.setGroupId("OTHERS").setDisplay(this.m_i18nStrings.OTHERS).setShowCount(true);
othersGroup.bindData(others);
this.m_recommendationsTable.addGroup(othersGroup);
}}};
RecommendationsO2Component.prototype.getReferenceTextExistsData=function(recomResult){var entityList=[];
var satisfiers=recomResult.SATISFIERS;
var satisfierLength=satisfiers.length;
var currentSatisfier=null;
if(recomResult.EXPECTATION_REF_TEXT_ENTITY){entityList.push(recomResult.EXPECTATION_REF_TEXT_ENTITY);
}if(recomResult.SCHEDULE_REF_TEXT_ENTITY){entityList.push(recomResult.SCHEDULE_REF_TEXT_ENTITY);
}for(var i=0;
i<satisfierLength;
i++){currentSatisfier=satisfiers[i];
if(currentSatisfier.SATISFIER_REF_TEXT_ENTITY){entityList.push(currentSatisfier.SATISFIER_REF_TEXT_ENTITY);
}}return entityList;
};
RecommendationsO2Component.prototype.onRowClick=function(event,data){var selRow="";
if(data.RESULT_DATA.GROUP_NAME!=="!FREETEXT!"){this.refTextResponse=this.getReferenceTextExistsData(data.RESULT_DATA);
}if(!this.m_isSidePanelLoading){selRow=$(event.target).parents("dl.result-info");
if(!selRow.length||data.RESULT_DATA===null){return;
}if(!this.m_isSidePanelOpen){this.hideColumnsOnSidePanelOpen();
}}var selectedRowProperty=selRow.prop("id");
var selectedRowId="#"+selectedRowProperty.replace(/:/g,"\\:");
var selectedRowObj=this.m_$tableView.find(selectedRowId);
this.updateInfo(selectedRowObj,data.RESULT_DATA,false,this.refTextResponse);
};
RecommendationsO2Component.prototype.getModifiedRowObject=function(modifiedRowId){var modifiedRowObject=null;
var compID=this.getComponentId();
if(this.m_recommendationsTable.isGroupingApplied()){var reObj=new RegExp("recom-o2"+compID+":\\w+:"+modifiedRowId+"$");
modifiedRowObject=this.m_$tableView.find("dl").filter(function(){return this.id.match(reObj);
});
}else{modifiedRowObject=this.m_$tableView.find("#recom-o2"+compID+"\\:"+modifiedRowId);
}return modifiedRowObject;
};
RecommendationsO2Component.prototype.updateInfo=function(selRow,data,isInitialLoad,refTextResponse){var rowId=this.getRowId(selRow);
var selRowObj=$(selRow);
var propId=selRowObj.prop("id");
if(this.m_lastSelectedRowProperty===propId&&!selRowObj.hasClass(this.getStyles().getNameSpace()+"-row-selected-init")){if(!this.m_isSidePanelOpen){this.m_sidePanel.showPanel();
this.m_isSidePanelOpen=true;
this.m_$tableView.removeClass("recom-o2-table").addClass("recom-o2-table-with-side-panel");
this.updateSelRowBgColor(selRow,false);
}return;
}this.updateSelRowBgColor(selRow,isInitialLoad);
this.m_$sidePanelContainer.off();
this.renderReadingPane(data,refTextResponse);
this.m_lastSelectedRow=rowId;
this.m_lastSelectedRowProperty=propId;
};
RecommendationsO2Component.prototype.getRowId=function(rowObj){var rowId="";
var identifiers=$(rowObj).attr("id").split(":");
if(this.m_recommendationsTable.isGroupingApplied()){rowId=identifiers[2];
}else{rowId=identifiers[1];
}return rowId;
};
RecommendationsO2Component.prototype.updateSelRowBgColor=function(selRowObj,isInitialLoad){var compNS=this.getStyles().getNameSpace();
var prevRow=this.m_$tableView.find(".selected");
if(prevRow.length>0&&this.m_lastSelectedRow===this.getRowId(prevRow)){prevRow.removeClass(compNS+"-row-selected");
prevRow.removeClass(compNS+"-row-selected-init");
prevRow.removeClass("selected");
prevRow.children("*").children("*").css("color","");
}if(isInitialLoad){$(selRowObj).addClass(compNS+"-row-selected-init selected");
}else{$(selRowObj).addClass(compNS+"-row-selected selected");
}};
RecommendationsO2Component.prototype.hideColumnsOnSidePanelOpen=function(){var compId=this.getComponentId();
var compNS=this.getStyles().getNameSpace();
var componentTable=this.getComponentTable();
var componentTableCols=componentTable.columns;
componentTableCols[2].setCustomClass("hidden");
this.m_$tableView.find("#"+compNS+compId+"columnHeaderPRIORITY").addClass("hidden");
componentTableCols[3].setCustomClass("hidden");
this.m_$tableView.find("#"+compNS+compId+"columnHeaderFREQUENCY").addClass("hidden");
componentTableCols[5].setCustomClass("hidden");
this.m_$tableView.find("#"+compNS+compId+"columnHeaderREFERENCE_TEXT").addClass("hidden");
componentTableCols[6].setCustomClass("recom-o2-favorites-on-colhide");
this.m_$tableView.find("#"+compNS+compId+"columnHeaderFAVORITES").addClass("recom-o2-favorites-on-colhide");
componentTableCols[1].setCustomClass("recom-o2-expectation-on-colhide");
this.m_$tableView.find("#"+compNS+compId+"columnHeaderEXPECTATION_NAME").addClass("recom-o2-expectation-on-colhide");
if(this.m_recomPrefObj.savedColumnsObj.DUE){componentTableCols[4].setCustomClass("recom-o2-due-on-colhide");
this.m_$tableView.find("#"+compNS+compId+"columnHeaderDUE").addClass("recom-o2-due-on-colhide");
}var tableBodyTag="#"+this.getComponentTable().getNamespace()+"tableBody";
$(tableBodyTag).on("mouseleave",this.m_hvrExtension.getTarget(),function(){$(".mpage-tooltip").remove();
});
componentTable.refresh();
};
RecommendationsO2Component.prototype.createReferenceTextAlert=function(component){var compID=component.getComponentId();
var primaryText=component.m_i18nStrings.REFERENCE_TEXT_FAILURE;
var secondaryText=component.m_i18nStrings.INLINE_ERROR_MESSAGE;
var type=component.m_alertType.ERROR;
var referenceError=$("#"+compID+"referenceError");
if(component.m_isSidePanelOpen){referenceError.empty().append(component.getErrorAlert(type,primaryText,secondaryText));
}};
RecommendationsO2Component.prototype.renderReadingPane=function(data,refTextResponse){var recomi18n=i18n.discernabu.recommendations_o2;
var compID=this.getComponentId();
var compNS=this.getStyles().getNameSpace();
var recommendationId=data.RECOMMENDATION_ID;
var sidePanelHtml="";
var lastSatisfiedDate=new Date();
var lastSatisfiedDateString="--";
var self=this;
var hoverDetails="";
var popupHtml="";
var sidePanelActionsHtml="";
var referenceHTML="";
var referenceMenu=MP_MenuManager.getMenuObject("referenceMenu"+compID+recommendationId);
var referenceTextArray=null;
var referenceTextArrayLength=0;
var satisfierLength=0;
var satisfiers=null;
var satisfierReferenceMenuItem=MP_MenuManager.getMenuObject("satisfierReferenceMenuItem"+compID+recommendationId);
var scheduleReferenceMenuItem=null;
var expectationReferenceMenuItem=null;
var referenceTextButton=null;
var currentSatisfier=null;
var currentEntity=null;
var referenceError=$("#"+compID+"referenceError");
if(referenceError.length===0){$("#sidePanelHeader"+compID).append("<div id='"+compID+"referenceError'></div>");
}else{referenceError.empty();
}if(refTextResponse){referenceTextArray=refTextResponse;
referenceTextArrayLength=referenceTextArray.length;
satisfierLength=data.SATISFIERS.length;
satisfiers=data.SATISFIERS;
if(!this.m_viewReferenceTextObj){this.m_viewReferenceTextObj=new ReferenceTextViewer(compNS+compID+"referenceText",this);
}}if(CERN_Platform.isTouchModeEnabled()){var expectationHoverDetails=this.getHoverDeatilsHtmlForSidePanel(this.HOVER_SECTION.EXPECTATION,data);
var frequencyHoverDetails=this.getHoverDeatilsHtmlForSidePanel(this.HOVER_SECTION.FREQUENCY,data);
var dueDateHoverDetails=this.getHoverDeatilsHtmlForSidePanel(this.HOVER_SECTION.DUE_DATE,data);
hoverDetails=expectationHoverDetails+frequencyHoverDetails+dueDateHoverDetails;
}if(data.LAST_SAT_DATE!==""){lastSatisfiedDate.setISO8601(data.LAST_SAT_DATE);
lastSatisfiedDateString=lastSatisfiedDate.format(dateFormat.masks.shortDate2);
}var clickFunctionForReferenceText=function(menuItem,windowHeader,entityName){var menuId=menuItem.getId();
var entityId=menuId.match(/\d/g);
entityId=entityId.join("");
self.m_viewReferenceTextObj.setWindowHeader(windowHeader);
self.m_viewReferenceTextObj.setEntityName(entityName);
self.m_viewReferenceTextObj.setEntityId(parseInt(entityId,10));
self.m_viewReferenceTextObj.setErrorMethod(self.createReferenceTextAlert);
self.m_viewReferenceTextObj.viewReferenceText();
self.referenceTextCapTimer.capture();
};
if(referenceTextArrayLength>1){referenceTextButton=new MPageUI.Button();
referenceTextButton.setLabel(recomi18n.VIEW_REFERENCE_TEXT);
referenceTextButton.setStyle(MPageUI.BUTTON_OPTIONS.STYLE.LINK);
referenceTextButton.setIcon("recom-o2-reference-button-icon");
referenceTextButton.setIconPosition(MPageUI.BUTTON_OPTIONS.ICON_POSITION.RIGHT);
referenceTextButton.setOnClickCallback(function(){MP_MenuManager.showMenu("referenceMenu"+compID+recommendationId);
});
referenceHTML="<span class = 'recom-o2-view-ref-text' id ='"+compID+"referenceTextButton' >"+referenceTextButton.render()+"</span>";
if(!referenceMenu){referenceMenu=new Menu("referenceMenu"+compID+recommendationId);
referenceMenu.setAnchorConnectionCorner(["bottom","right"]);
referenceMenu.setContentConnectionCorner(["top","right"]);
referenceMenu.setIsDisabled(false);
for(var i=0;
i<referenceTextArrayLength;
i++){currentEntity=referenceTextArray[i];
if(currentEntity.PARENT_ENTITY_NAME==="HEALTH_MAINT_SCHED"){scheduleReferenceMenuItem=new MenuSelection("scheduleReferenceMenuItem"+currentEntity.PARENT_ENTITY_ID);
scheduleReferenceMenuItem.setLabel(recomi18n.SCHEDULE_REF_TEXT);
scheduleReferenceMenuItem.setClickFunction(function(){clickFunctionForReferenceText(this,data.GROUP_NAME,"HEALTH_MAINT_SCHED");
});
}if(currentEntity.PARENT_ENTITY_NAME==="HEALTH_MAINT_EXPECT"){expectationReferenceMenuItem=new MenuSelection("expectationReferenceMenuItem"+currentEntity.PARENT_ENTITY_ID);
expectationReferenceMenuItem.setLabel(recomi18n.EXPECTATION_REF_TEXT);
expectationReferenceMenuItem.setClickFunction(function(){clickFunctionForReferenceText(this,data.EXPECT_STEP,"HEALTH_MAINT_EXPECT");
});
}if(currentEntity.PARENT_ENTITY_NAME==="HEALTH_MAINT_SAT"){if(!satisfierReferenceMenuItem){satisfierReferenceMenuItem=new Menu("satisfierReferenceMenuItem"+compID+recommendationId);
satisfierReferenceMenuItem.setLabel(recomi18n.SATISFIER_REF_TEXT);
satisfierReferenceMenuItem.setAnchorConnectionCorner(["top","left"]);
satisfierReferenceMenuItem.setContentConnectionCorner(["top","right"]);
}for(var satisfierCount=0;
satisfierCount<satisfierLength;
satisfierCount++){currentSatisfier=satisfiers[satisfierCount];
if(currentEntity.PARENT_ENTITY_ID===currentSatisfier.EXPECT_SAT_ID){var satisfierMenuItem=new MenuSelection("satisfierMenuItem"+currentEntity.PARENT_ENTITY_ID);
satisfierMenuItem.setLabel(currentSatisfier.EXPECT_SAT_NAME);
satisfierMenuItem.setClickFunction(function(){clickFunctionForReferenceText(this,this.getLabel(),"HEALTH_MAINT_SAT");
});
satisfierReferenceMenuItem.addMenuItem(satisfierMenuItem);
break;
}}}}if(scheduleReferenceMenuItem){referenceMenu.addMenuItem(scheduleReferenceMenuItem);
}if(expectationReferenceMenuItem){referenceMenu.addMenuItem(expectationReferenceMenuItem);
}if(satisfierReferenceMenuItem){referenceMenu.addMenuItem(satisfierReferenceMenuItem);
}referenceMenu.setAnchorElementId(compID+"referenceTextButton");
MP_MenuManager.addMenuObject(referenceMenu);
}}else{if(referenceTextArrayLength===1){currentEntity=referenceTextArray[0];
var headerTitle="";
if(currentEntity.PARENT_ENTITY_NAME==="HEALTH_MAINT_SCHED"){headerTitle=data.GROUP_NAME;
}else{if(currentEntity.PARENT_ENTITY_NAME==="HEAlTH_MAINT_EXPECT"){headerTitle=data.EXPECT_STEP;
}else{for(var j=0;
j<satisfierLength;
j++){currentSatisfier=satisfiers[j];
if(currentEntity.PARENT_ENTITY_ID===currentSatisfier.EXPECT_SAT_ID){headerTitle=currentSatisfier.EXPECT_SAT_NAME;
break;
}}}}referenceHTML="<span id='"+compID+"referenceText' parent_entity_name='"+currentEntity.PARENT_ENTITY_NAME+"' parent_entity_id='"+currentEntity.PARENT_ENTITY_ID+"' header_title='"+headerTitle+"'><a class='recom-o2-view-ref-text'>"+recomi18n.VIEW_REFERENCE_TEXT+"</a></span>";
}}this.m_sidePanel.setTitleText(data.EXPECT_STEP);
this.m_sidePanel.setSubtitleAsHTML(this.getDueInfoHtml(data));
var sidePanelSubtitle=$("#"+compID+"rp-dueInfo");
sidePanelSubtitle.append(referenceHTML);
if(referenceTextButton){referenceTextButton.attachEvents();
$("#"+referenceTextButton.getId()).focusout(function(){if(referenceMenu&&!referenceMenu.isMouseOverMenu()&&satisfierReferenceMenuItem&&!satisfierReferenceMenuItem.isMouseOverMenu()){MP_MenuManager.closeMenuStack(true);
}else{if(!satisfierReferenceMenuItem&&referenceMenu&&!referenceMenu.isMouseOverMenu()){MP_MenuManager.closeMenuStack(true);
}}});
}sidePanelHtml="<div id="+compID+"rp-last-satisfied class='"+compNS+"-rp-last-satisfied'><span class='"+compNS+"-rp-title-text'>"+recomi18n.LAST_SATISFIED+"</span></br><span class='"+compNS+"-rp-content-data'>"+lastSatisfiedDateString+"</span><span class='"+compNS+"-rp-freq'>"+data.FREQUENCY_TEXT+"</span></div>"+this.getTimeLineGraphHtml(data)+"<div id=sidePanelScrollContainer"+compID+">"+hoverDetails+this.getHistoryInfoHtml(data,lastSatisfiedDateString)+"<br/><br/></div>";
this.m_sidePanel.setContents(sidePanelHtml,"recom-o2"+this.getComponentId());
this.m_sidePanel.showCornerCloseButton();
this.m_sidePanel.setCornerCloseFunction(function(){var referenceTextError=$("#"+compID+"referenceError");
if(referenceTextError.length){referenceTextError.empty();
}var prevRow=self.m_$tableView.find(".selected");
var componentTable=self.getComponentTable();
var componentTableCols=componentTable.columns;
prevRow.removeClass("recom-o2-row-selected").removeClass("recom-o2-row-selected-init").removeClass("selected");
self.m_$tableView.removeClass("recom-o2-table-with-side-panel").addClass("recom-o2-table");
self.m_isSidePanelOpen=false;
self.m_clickedRow=null;
if(self.m_recomPrefObj.savedColumnsObj.PRIORITY===true){componentTableCols[2].setCustomClass(compNS+"-priority");
self.m_$tableView.find("#"+compNS+compID+"columnHeaderPRIORITY").removeClass("hidden");
}if(self.m_recomPrefObj.savedColumnsObj.FREQUENCY===true){componentTableCols[3].setCustomClass(compNS+"-frequency");
self.m_$tableView.find("#"+compNS+compID+"columnHeaderFREQUENCY").removeClass("hidden");
}if(self.m_recomPrefObj.savedColumnsObj.REFERENCE===true){componentTableCols[5].setCustomClass(compNS+"-reference-text");
self.m_$tableView.find("#"+compNS+compID+"columnHeaderREFERENCE_TEXT").removeClass("hidden");
}componentTableCols[6].setCustomClass(compNS+"-favorites");
self.m_$tableView.find("#"+compNS+compID+"columnHeaderFAVORITES").removeClass("recom-o2-favorites-on-colhide");
componentTableCols[1].setCustomClass(compNS+"-expectation");
self.m_$tableView.find("#"+compNS+compID+"columnHeaderEXPECTATION_NAME").removeClass("recom-o2-expectation-on-colhide");
if(self.m_recomPrefObj.savedColumnsObj.DUE){componentTableCols[4].setCustomClass(compNS+"-due");
self.m_$tableView.find("#"+compNS+compID+"columnHeaderDUE").removeClass("recom-o2-due-on-colhide");
}componentTable.refresh();
});
this.setDueDateChangeIndicator(false);
this.setFrequencyChangeIndicator(false);
sidePanelActionsHtml="<div id='recommendationsSPAction"+compID+"' class='recom-o2-sp-actions'>";
if(this.getShowSatisfiersPreference()){var dropdownSymbolHtml="<span class='recom-o2-action-dropdown-symbol'>&nbsp;</span>";
popupHtml=this.createPopupHtml(data);
if(popupHtml!==""){sidePanelActionsHtml+="<div class='sp-button2 recom-o2-actions-button' id='actionsRecomButton"+compID+"'>"+this.m_i18nStrings.ACTIONS+dropdownSymbolHtml+"</div>";
}}if(this.getAllowModificationIndicator()){sidePanelActionsHtml+="<div class='sp-button2 recom-o2-modify-button' id='modifyRecomButton"+compID+"'>"+this.m_i18nStrings.MODIFY+"</div>";
}sidePanelActionsHtml+="</div>";
this.m_sidePanel.setActionsAsHTML(sidePanelActionsHtml);
if(popupHtml!==""){this.attachPopupToActionsButton(popupHtml);
}this.addEventHandlersForSidePanelActions(sidePanelHtml,sidePanelActionsHtml,data,popupHtml);
this.addEventHandlersForUndoActionInSidePanel(data);
this.addEventHandlersForClinicalNoteLinkInSidePanel();
this.m_$tableView.removeClass("recom-o2-table").addClass("recom-o2-table-with-side-panel");
this.m_sidePanel.showPanel();
this.m_sidePanel.showHideExpandBar();
this.m_isSidePanelOpen=true;
this.adjustScrollBarPosition(true);
if(CERN_Platform.isTouchModeEnabled()){$("#"+compID+"show-more-frequency").click(function(){self.showMoreOrLessContents(self.HOVER_SECTION.FREQUENCY);
});
$("#"+compID+"show-more-due-date").click(function(){self.showMoreOrLessContents(self.HOVER_SECTION.DUE_DATE);
});
}this.styleTimelineGraph();
};
RecommendationsO2Component.prototype.getHoverDeatilsHtmlForSidePanel=function(sectionId,data){var recomi18n=i18n.discernabu.recommendations_o2;
var compNS=this.getStyles().getNameSpace();
var compID=this.getComponentId();
var needShowMore=true;
var hideClassName="";
var containerId="";
var ellipseId="";
var showMoreId="";
var hoverDetails="";
var modifyIndicator=false;
var hoverDetailsHtml="--";
var showMoreContainerHtml="";
var sectionName="";
var sectionSeparatorHtml="";
var CHARACTER_LIMIT=350;
switch(sectionId){case this.HOVER_SECTION.EXPECTATION:needShowMore=false;
hoverDetails=data.EXP_HOVER;
modifyIndicator=data.HAS_EXP_MODIFY_IND;
sectionName=recomi18n.FREETEXT_EXPECTATION;
break;
case this.HOVER_SECTION.FREQUENCY:containerId=compID+"freq-details";
ellipseId=compID+"more-eclipse-frequency";
showMoreId=compID+"show-more-frequency";
hoverDetails=data.FREQ_HOVER;
modifyIndicator=data.HAS_FREQ_MODIFY_IND;
sectionName=recomi18n.FREQUENCY_DETAILS;
break;
case this.HOVER_SECTION.DUE_DATE:containerId=compID+"due-date-details";
ellipseId=compID+"more-eclipse-due-date";
showMoreId=compID+"show-more-due-date";
hoverDetails=data.DUE_DATE_HOVER;
modifyIndicator=data.HAS_DUE_DATE_MODIFY_IND;
sectionName=recomi18n.DUE_DATE_DETAILS;
break;
}if(needShowMore&&hoverDetails.length>CHARACTER_LIMIT){hideClassName=compNS+"-rp-hide-section";
var elipseHtml="<span id='"+ellipseId+"'>[...]</span>";
var showMoreHtml="<a id='"+showMoreId+"' class='"+compNS+"-rp-align-right showmore'>"+recomi18n.SHOW_MORE+"</a>";
showMoreContainerHtml="<div class='"+compNS+"-show-more-container'>"+elipseHtml+showMoreHtml+"</div>";
}if(modifyIndicator&&hoverDetails!==""){hoverDetailsHtml="<div id='"+containerId+"' class='"+compNS+"-rp-hover-details-section "+hideClassName+"'>"+hoverDetails+"</div>"+showMoreContainerHtml;
}sectionSeparatorHtml="<p class='"+compNS+"-rp-history-hd'><span class='"+compNS+"-rp-title-text'>"+sectionName+"</span></p>";
return(sectionSeparatorHtml+hoverDetailsHtml);
};
RecommendationsO2Component.prototype.showMoreOrLessContents=function(sectionId){var recomi18n=i18n.discernabu.recommendations_o2;
var compNS=this.getStyles().getNameSpace();
var compID=this.getComponentId();
var $showMore=null;
var $detailsContainer=null;
var containerClassName=compNS+"-rp-hide-section";
var showMoreClassName="showmore";
var showLessClassName="showless";
var $elipse=null;
if(sectionId===this.HOVER_SECTION.FREQUENCY){$showMore=$("#"+compID+"show-more-frequency");
$detailsContainer=$("#"+compID+"freq-details");
$elipse=$("#"+compID+"more-eclipse-frequency");
}else{if(sectionId===this.HOVER_SECTION.DUE_DATE){$showMore=$("#"+compID+"show-more-due-date");
$detailsContainer=$("#"+compID+"due-date-details");
$elipse=$("#"+compID+"more-eclipse-due-date");
}}if($showMore.hasClass(showMoreClassName)){$showMore.removeClass(showMoreClassName);
$showMore.addClass(showLessClassName);
$showMore.html(recomi18n.SHOW_LESS);
$detailsContainer.removeClass(containerClassName);
$elipse.addClass("hide");
}else{$showMore.removeClass(showLessClassName);
$showMore.addClass(showMoreClassName);
$showMore.html(recomi18n.SHOW_MORE);
$detailsContainer.addClass(containerClassName);
$elipse.removeClass("hide");
}var $expCollapseIconObj=$("#sidePanelExpandCollapseIcon"+compID);
if($expCollapseIconObj.hasClass("sp-collapse")){this.m_sidePanel.expandSidePanel();
}};
RecommendationsO2Component.prototype.getHistoryInfoHtml=function(data,lastSatisfiedDateString){var recomi18n=i18n.discernabu.recommendations_o2;
var compID=this.getComponentId();
var compNS=this.getStyles().getNameSpace();
var listLength=data.HISTORY.length;
var historyHtml="";
var historyInfoHtml="";
var clinicalNoteDisplay="";
if(!listLength){return("");
}for(var index=0;
index<listLength;
index++){var histObj=data.HISTORY[index];
var provider=MP_Util.GetValueFromArray(histObj.PRSNL_ID,this.m_personnelArray);
var providerName=(provider===null)?"--":provider.fullName;
var date=new Date();
var modifierId=histObj.MODIFIER_ID;
var nextDueDate="--";
var recomActionId=histObj.RECOMMENDATION_ACTION_ID;
var modifierTypeCd=histObj.MODIFIER_TYPE_CD;
var organizationId=histObj.ORGANIZATION_ID;
var nextDueAndReasonHtml="";
var clinicalEventId=histObj.CLINICAL_EVENT_ID;
var noteTypeDisplay=histObj.NOTE_TYPE_DISPLAY;
var clinicalNoteInd=(histObj.CLINICAL_NOTE_IND===1)?true:false;
if(histObj.RECORDED_DATE!==""){date.setISO8601(histObj.RECORDED_DATE);
}if(histObj.NEXT_DUE_DATE!==""){date.setISO8601(histObj.NEXT_DUE_DATE);
nextDueDate=date.format(dateFormat.masks.shortDate2);
}var commentText=histObj.COMMENT?histObj.COMMENT:"--";
var reasonText=histObj.REASON_DISP?histObj.REASON_DISP:"";
var undoLinkHtml=histObj.UNDO_ENABLED?"<a class='recom-o2-history-item-undo-option' data-comment-text= '"+commentText+"' data-reason-text= '"+reasonText+"' data-providername-text= '"+providerName+"'  data-modifier-id='"+modifierId+"' data-action-id='"+recomActionId+"' data-modifier-type-cd='"+modifierTypeCd+"' data-org-id='"+organizationId+"' data-status-flag='"+histObj.STATUS_FLAG+"' data-next-due-date='"+nextDueDate+"'>"+recomi18n.UNDO+"</a>":"";
var actionInfoHtml="<div class='recom-o2-history-item-action-info'><span class='recom-o2-action-type-display'>"+this.getActionDescription(histObj.STATUS_FLAG,false)+"</span>"+undoLinkHtml;
if(clinicalNoteInd){clinicalNoteDisplay=(CERN_Platform.inMillenniumContext())?"<a class = 'recom-o2-clinical-link' data-clinical-event-id='"+clinicalEventId+"'> ("+noteTypeDisplay+")</a>":"<span class = 'recom-o2-clinical-note-display secondary-text'> ("+noteTypeDisplay+")</span>";
}if(reasonText!==""){nextDueAndReasonHtml+="<div class='recom-o2-history-item-due-info secondary-text'>"+recomi18n.UNTIL+"&nbsp; "+nextDueDate+"</div><div class='recom-o2-reason-text secondary-text'>("+reasonText+")</div>";
}else{nextDueAndReasonHtml+="<div class='recom-o2-history-item-due-info secondary-text'>"+recomi18n.UNTIL+"&nbsp; "+nextDueDate+"</div><div class='recom-o2-reason-text secondary-text'>"+reasonText+"</div>";
}var commentHtml="<div class='recom-o2-history-item-comment-info'><span class ='secondary-text'>"+recomi18n.COMMENT+":&nbsp;</span>"+commentText+"</div>";
var providerInfoHtml="<div class='recom-o2-history-item-provider-info'><span class ='secondary-text'>"+recomi18n.RECORDED_FOR+":&nbsp;</span>"+providerName+"</div>";
if(histObj.STATUS_FLAG===6){for(var undoneIndex=0;
undoneIndex<listLength;
undoneIndex++){var undoneHistObj=data.HISTORY[undoneIndex];
var undoneProvider=MP_Util.GetValueFromArray(undoneHistObj.PRSNL_ID,this.m_personnelArray);
var undoneProviderName=(undoneProvider===null)?"--":undoneProvider.fullName;
var undoneNextDueDate="--";
var undoneNextDueAndReasonHtml="";
var undoneActionDate="--";
if(index!==undoneIndex){if(histObj.MODIFIER_ID===undoneHistObj.MODIFIER_ID){if(histObj.RECORDED_DATE!==""){date.setISO8601(histObj.RECORDED_DATE);
undoneActionDate=date.format(dateFormat.masks.mediumDate);
}if(undoneHistObj.NEXT_DUE_DATE!==""){date.setISO8601(undoneHistObj.NEXT_DUE_DATE);
undoneNextDueDate=date.format(dateFormat.masks.shortDate2);
}var undoneOnInfoHtml="<div class='recom-o2-history-item-action-info '><span class='recom-o2-action-type-display'>"+this.getActionDescription(histObj.STATUS_FLAG,false)+"</span><span class='secondary-text'>&nbsp;"+recomi18n.ON+"&nbsp;"+undoneActionDate+"</span></div>";
var undoneActionInfoHtml="<div class='recom-o2-history-item-action-info'><span class='recom-o2-action-type-display'>"+this.getActionDescription(undoneHistObj.STATUS_FLAG,false)+"</span></div>";
var undoneReasonText=undoneHistObj.REASON_DISP?undoneHistObj.REASON_DISP:"";
var undoneReason="<div class='recom-o2-undo-reason-text'><span class ='secondary-text'>"+recomi18n.REASON+"&nbsp;</span>"+reasonText+"</div>";
if(undoneReasonText!==""){undoneNextDueAndReasonHtml+="<div class='recom-o2-history-item-due-info secondary-text'>"+recomi18n.UNTIL+"&nbsp; "+undoneNextDueDate+"</div>&nbsp;<span class='recom-o2-reason-text secondary-text'>("+undoneReasonText+")</span>";
}else{undoneNextDueAndReasonHtml+="<div class='recom-o2-history-item-due-info secondary-text'>"+recomi18n.UNTIL+"&nbsp; "+undoneNextDueDate+"</div>&nbsp;<span class='recom-o2-reason-text secondary-text'>"+undoneReasonText+"</span>";
}var undoneCommentText=undoneHistObj.COMMENT?undoneHistObj.COMMENT:"--";
var undoneCommentHtml="<div class='recom-o2-history-item-comment-info'><span class ='secondary-text'>"+recomi18n.COMMENT+":&nbsp;</span>"+undoneCommentText+"</div>";
var undoneProviderInfoHtml="<div class='recom-o2-history-item-provider-info'><span class ='secondary-text'>"+recomi18n.RECORDED_FOR+":&nbsp;</span>"+undoneProviderName+"</div>";
historyInfoHtml+="<div class='recom-o2-history-item' id='historyItem"+undoneHistObj.MODIFIER_ID+undoneHistObj.RECOMMENDATION_ACTION_ID+"'>"+undoneOnInfoHtml+"<div class ='recom-o2-satisfier-action-info'>"+undoneActionInfoHtml+undoneNextDueAndReasonHtml+undoneCommentHtml+undoneProviderInfoHtml+"</div>"+undoneReason+commentHtml+providerInfoHtml+"</div>";
}}}}else{if(histObj.UNDO_ENABLED===1||histObj.IS_UNDO_DONE===0){historyInfoHtml+="<div class='recom-o2-history-item' id='historyItem"+modifierId+recomActionId+"'>"+actionInfoHtml+clinicalNoteDisplay+"</div>"+nextDueAndReasonHtml+commentHtml+providerInfoHtml+"</div>";
}}}historyHtml="<p id='"+compID+"-rp-history-hd' class='"+compNS+"-rp-history-hd'><span class='"+compNS+"-rp-title-text'>"+recomi18n.HISTORY+"</span><span class='"+compNS+"-rp-align-right'>"+this.m_historyLookback+" - "+recomi18n.PRESENT+"</span></p><div id="+compID+"rp-history class='"+compNS+"-rp-history' data-last-satisfied-date='"+lastSatisfiedDateString+"'>"+historyInfoHtml+"</div>";
return historyHtml;
};
RecommendationsO2Component.prototype.getDueInfoHtml=function(data){var compID=this.getComponentId();
var dueDate="--";
var dueDateTime=new Date();
var compNS=this.getStyles().getNameSpace();
var imgClass=compNS+"-rp-img ";
var dueInfoHtml="";
var elapsedTime="";
if(data.DUE_DATE_UTC!==""){dueDateTime.setISO8601(data.DUE_DATE_UTC);
}dueDate=dueDateTime.format(dateFormat.masks.shortDate2);
if(data.OVER_DUE_DATE!==""&&data.DUE_STATUS_FLAG===this.DUE_TYPE.OVERDUE){dueDateTime.setISO8601(data.OVER_DUE_DATE);
}elapsedTime=(this.m_anchorDate>dueDateTime)?this.GetDateDiffString(dueDateTime,this.m_anchorDate,""):this.GetDateDiffString(this.m_anchorDate,dueDateTime,"");
elapsedTime=(data.DUE_STATUS_FLAG===this.DUE_TYPE.OVERDUE)?i18n.discernabu.recommendations_o2.AGO.replace("{0}",elapsedTime):elapsedTime;
elapsedTime=(data.DUE_STATUS_FLAG===this.DUE_TYPE.DUE)?i18n.discernabu.recommendations_o2.TODAY:elapsedTime;
switch(data.DUE_STATUS_FLAG){case this.DUE_TYPE.OVERDUE:imgClass+=compNS+"-overdue-img";
break;
case this.DUE_TYPE.DUE:imgClass+=compNS+"-due-img";
break;
case this.DUE_TYPE.NEARDUE:imgClass+=compNS+"-neardue-img";
break;
default:break;
}var statusImageHtml=(data.DUE_STATUS_FLAG!==this.DUE_TYPE.SATISFIED)?("<div class='"+imgClass+"'>&nbsp;</div>"):"";
dueInfoHtml="<div id="+compID+"rp-dueInfo class='"+compNS+"-rp-dueInfo'>"+statusImageHtml+"<span class='"+compNS+"-rp-dueinfo-week-indicator'>"+elapsedTime+"</span><span class='"+compNS+"-rp-dueinfo-date'>("+dueDate+")</span></div>";
return dueInfoHtml;
};
RecommendationsO2Component.prototype.getActionDescription=function(action_flag,undoFlag){var statusText="";
var recomi18n=i18n.discernabu.recommendations_o2;
switch(action_flag){case this.RECORD_STATUS_TYPE.SATISFIED:statusText=undoFlag?recomi18n.SATISFY:recomi18n.SATISFIED;
break;
case this.RECORD_STATUS_TYPE.POSTPONED:statusText=undoFlag?recomi18n.POSTPONE:recomi18n.POSTPONED;
break;
case this.RECORD_STATUS_TYPE.PENDING:statusText=recomi18n.PENDING;
break;
case this.RECORD_STATUS_TYPE.SKIPPED:statusText=recomi18n.SKIPPED;
break;
case this.RECORD_STATUS_TYPE.CANCELED:statusText=recomi18n.CANCELED;
break;
case this.RECORD_STATUS_TYPE.OTHERSATISFIER:statusText=recomi18n.OTHER_SATISFIER;
break;
case this.RECORD_STATUS_TYPE.UNDONE:statusText=recomi18n.UNDONE;
break;
case this.RECORD_STATUS_TYPE.EXPIRED:statusText=recomi18n.SYSCANCELLED;
break;
case this.RECORD_STATUS_TYPE.REFUSED:statusText=undoFlag?recomi18n.REFUSE:recomi18n.REFUSED;
break;
default:statusText=recomi18n.UNKNOWN_STATUS;
break;
}return statusText;
};
RecommendationsO2Component.prototype.getTimeLineGraphHtml=function(data){var compID=this.getComponentId();
var compNS=this.getStyles().getNameSpace();
var graph_anchor_date=new Date(this.m_anchorDate.valueOf());
var dummyDate=new Date(2100,12,31,0,0,0,0);
var due_date=new Date(dummyDate.valueOf());
var near_due_date=new Date(dummyDate.valueOf());
var over_due_date=new Date(dummyDate.valueOf());
var graphHtml="";
var $graphDiv=$("<div id="+compID+"graphdiv class='"+compNS+"-rp-graphdiv'/>");
if(data.NEAR_DUE_DATE!==""){near_due_date.setISO8601(data.NEAR_DUE_DATE);
}else{near_due_date.setISO8601(data.DUE_DATE_UTC);
}if(data.DUE_DATE_UTC!==""){due_date.setISO8601(data.DUE_DATE_UTC);
}if(data.OVER_DUE_DATE!==""){over_due_date.setISO8601(data.OVER_DUE_DATE);
}if(data.LAST_SAT_DATE!==""){graph_anchor_date.setISO8601(data.LAST_SAT_DATE);
}else{if(data.DUE_STATUS_FLAG!==this.DUE_TYPE.SATISFIED){if(near_due_date<this.m_anchorDate){graph_anchor_date=new Date(near_due_date.valueOf());
}else{if(due_date<this.m_anchorDate){graph_anchor_date=new Date(due_date.valueOf());
}else{if(over_due_date<this.m_anchorDate){graph_anchor_date=new Date(over_due_date.valueOf());
}else{graph_anchor_date=new Date(this.m_anchorDate.valueOf());
}}}}else{graph_anchor_date=new Date(this.m_anchorDate.valueOf());
}}var notDueLength=(near_due_date.valueOf()!==dummyDate.valueOf())?Math.max(0,near_due_date-graph_anchor_date):0;
var nearDueLength=(due_date.valueOf()!==dummyDate.valueOf()&&near_due_date.valueOf()!==dummyDate.valueOf())?Math.max(0,due_date-near_due_date):0;
var dueLength=(over_due_date.valueOf()!==dummyDate.valueOf()&&due_date.valueOf()!==dummyDate.valueOf())?Math.max(0,over_due_date-due_date):0;
var overdueLength=(over_due_date.valueOf()!==dummyDate.valueOf())?Math.max(0,this.m_anchorDate-over_due_date):0;
var totalLength=0;
var notDuePercent=0;
var nearDuePercent=0;
var duePercent=0;
var overduePercent=0;
if(dueLength===0){if(data.DUE_STATUS_FLAG===this.DUE_TYPE.OVERDUE){duePercent=95;
overduePercent=5;
this.m_statusBarPos=0.98;
}else{if(data.DUE_STATUS_FLAG===this.DUE_TYPE.SATISFIED){notDuePercent=95;
duePercent=5;
this.m_statusBarPos=0.1;
}else{duePercent=100;
this.m_statusBarPos=0.9;
}}}else{totalLength=notDueLength+nearDueLength+dueLength+overdueLength;
notDuePercent=(notDueLength/totalLength*100);
nearDuePercent=(nearDueLength/totalLength*100);
duePercent=(dueLength/totalLength*100);
overduePercent=(overdueLength/totalLength*100);
this.m_statusBarPos=(this.m_anchorDate-graph_anchor_date)/totalLength;
this.m_statusBarPos=(this.m_statusBarPos<=0)?0.02:this.m_statusBarPos;
this.m_statusBarPos=(this.m_statusBarPos>=1)?0.98:this.m_statusBarPos;
}var $graphNotDueBar=$("<div id='"+compID+"-graph-notDueBar' class='"+compNS+"-graph-not-due' style='width:"+notDuePercent+"%;'/>");
var $graphNearDueBar=$("<div id='"+compID+"-graph-nearDueBar' class='"+compNS+"-graph-near-due' style='width:"+nearDuePercent+"%;'/>");
var $graphDueBar=$("<div id='"+compID+"-graph-dueBar' class='"+compNS+"-graph-due' style='width:"+duePercent+"%;'/>");
var $graphOverdueBar=$("<div id='"+compID+"-graph-overdueBar' class='"+compNS+"-graph-over-due' style='width:"+overduePercent+"%;'/>");
$graphDiv.append($graphNotDueBar);
$graphDiv.append($graphNearDueBar);
$graphDiv.append($graphDueBar);
$graphDiv.append($graphOverdueBar);
if(notDuePercent>0){$graphNotDueBar.addClass(compNS+"-graph-left");
}else{if(nearDuePercent>0){$graphNearDueBar.addClass(compNS+"-graph-left");
}else{if(duePercent>0){$graphDueBar.addClass(compNS+"-graph-left");
}else{$graphOverdueBar.addClass(compNS+"-graph-left");
}}}if(overduePercent>0){if($graphOverdueBar.hasClass(compNS+"-graph-left")){$graphOverdueBar.removeClass(compNS+"-graph-left").addClass(compNS+"-graph-both");
}else{$graphOverdueBar.addClass(compNS+"-graph-right");
}}else{if(duePercent>0){if($graphDueBar.hasClass(compNS+"-graph-left")){$graphDueBar.removeClass(compNS+"-graph-left").addClass(compNS+"-graph-both");
}else{$graphDueBar.addClass(compNS+"-graph-right");
}}else{if(nearDuePercent>0){if($graphNearDueBar.hasClass(compNS+"-graph-left")){$graphNearDueBar.removeClass(compNS+"-graph-left").addClass(compNS+"-graph-both");
}else{$graphNearDueBar.addClass(compNS+"-graph-right");
}}else{if($graphNotDueBar.hasClass(compNS+"-graph-left")){$graphNotDueBar.removeClass(compNS+"-graph-left").addClass(compNS+"-graph-both");
}else{$graphNotDueBar.addClass(compNS+"-graph-right");
}}}}data.DUE_STATUS_TEXT=(data.LAST_SAT_DATE!==""&&data.DUE_STATUS_FLAG===this.DUE_TYPE.SATISFIED)?i18n.discernabu.recommendations_o2.SATISFIED:data.DUE_STATUS_TEXT;
graphHtml="<div id='"+compID+"graphWrapper'>"+$graphDiv[0].outerHTML+"<div id='"+compID+"-graph-statusbar' title="+data.DUE_STATUS_TEXT+"><span id='"+compID+"-graph-statusbar-text' class='"+compNS+"-graph-statusbar-text'>"+data.DUE_STATUS_TEXT+"</span></div></div>";
return graphHtml;
};
RecommendationsO2Component.prototype.styleTimelineGraph=function(){var compID=this.getComponentId();
var compNS=this.getStyles().getNameSpace();
var $graphStatusBar=$("#"+compID+"-graph-statusbar");
if(!$graphStatusBar.length){return;
}var graphWidth=0;
var labelClass=compNS+"-graph-statusbar center";
var bubbleX=0;
var bubbleWidth=76;
var halfBubbleWidth=(bubbleWidth/2);
var desiredBubbleCaretX=0;
var bubbleLeftCaretOffset=15;
var $graphDiv=$("#"+compID+"graphdiv");
if(!$graphDiv.length){return;
}graphWidth=$graphDiv.width();
desiredBubbleCaretX=graphWidth*this.m_statusBarPos;
if(desiredBubbleCaretX<halfBubbleWidth){$graphStatusBar.removeClass();
labelClass=compNS+"-graph-statusbar left";
bubbleX=desiredBubbleCaretX-bubbleLeftCaretOffset;
}else{if((graphWidth-desiredBubbleCaretX)<halfBubbleWidth){$graphStatusBar.removeClass();
labelClass=compNS+"-graph-statusbar right";
bubbleX=desiredBubbleCaretX-(bubbleWidth-bubbleLeftCaretOffset);
}else{bubbleX=desiredBubbleCaretX-halfBubbleWidth;
}}var minLeftMargin=0;
var maxLeftMargin=graphWidth-bubbleWidth;
bubbleX=Math.min(Math.max(minLeftMargin,bubbleX),maxLeftMargin);
$graphStatusBar.css("margin-left",bubbleX+"px");
$graphStatusBar.addClass(labelClass);
};
RecommendationsO2Component.prototype.resizeComponent=function(){MPageComponent.prototype.resizeComponent.call(this,null);
if(this.m_isSidePanelOpen){this.m_sidePanel.resizePanel();
this.resetSidePanelHeight();
}this.styleTimelineGraph();
};
RecommendationsO2Component.prototype.resetSidePanelHeight=function(){if(this.m_$tableView&&this.m_$tableView.length&&this.m_sidePanel){var sidePanelHeight=Math.max(this.m_$tableView.height(),this.m_sidePanelMinHeight);
this.m_sidePanel.setMinHeight(sidePanelHeight+"px");
this.m_sidePanel.setHeight(sidePanelHeight+"px");
this.m_sidePanel.showHideExpandBar();
}};
RecommendationsO2Component.prototype.initializeSidePanel=function(){var compID=this.getComponentId();
var maxViewHeight=($("#vwpBody").height()-70)+"px";
var tableHeight=$("#"+this.m_recommendationsTable.getNamespace()+"tableBody").height();
try{this.m_sidePanel=new CompSidePanel(compID,this.m_$sidePanelContainer.attr("id"));
this.m_sidePanel.setExpandOption(this.m_sidePanel.expandOption.EXPAND_DOWN);
this.m_sidePanel.setMinHeight(this.m_sidePanelMinHeight+"px");
this.m_sidePanel.setHeight(tableHeight);
this.m_sidePanel.setOffsetHeight(40);
this.m_sidePanel.setMaxHeight(maxViewHeight);
this.m_sidePanel.setApplyBodyContentsPadding(true);
this.m_sidePanel.renderPreBuiltSidePanel();
this.m_sidePanel.setContents("<div></div>","recom-o2"+this.getComponentId());
this.m_sidePanel.hidePanel();
}catch(err){logger.logJSError(err,RecommendationsO2Component,"recommendations-o2.js","initializeSidePanel");
}};
RecommendationsO2Component.prototype.displayTimeInterval=function(reply){var compID=this.getComponentId();
var compNS=this.getStyles().getNameSpace();
var date=new Date();
var endDate="";
var recomObject=$("#"+compNS+compID);
if(!recomObject.length){return;
}var titleObj=recomObject.find(".sec-hd");
if(!titleObj.length){return;
}if(reply.PENDING_EXPECT_END_DATE!==""){date.setISO8601(reply.PENDING_EXPECT_END_DATE);
}endDate=date.format("mmmm yyyy");
var intervalText=i18n.discernabu.recommendations_o2.PRESENT+" - "+endDate;
var timeIntervalObj=$("#"+compID+"-time-interval");
if(timeIntervalObj.length){timeIntervalObj.text(intervalText);
return;
}timeIntervalObj="<span id='"+compID+"-time-interval' class='"+compNS+"-time-interval'>"+intervalText+"</span>";
titleObj.append(timeIntervalObj);
};
RecommendationsO2Component.prototype.displayRecomStaleDataMsg=function(reply){var compID=this.getComponentId();
$("#"+compID+"-stale-warning").remove();
if(typeof(reply.COHERENCY_ACTIVE_IND)==="undefined"){return;
}if(reply.COHERENCY_ACTIVE_IND!==0){return;
}if(!reply.COHERENCY_VALID_DT_TM){return;
}var compNS=this.getStyles().getNameSpace();
var $recomContent=$("#"+compNS+"Content"+this.getComponentId());
if(!$recomContent.length){return;
}var dateTime=new Date();
var df=new mp_formatter.DateTimeFormatter(MPAGE_LOCALE);
dateTime.setISO8601(reply.COHERENCY_VALID_DT_TM);
var recomWarnDateStr=df.format(dateTime,mp_formatter.DateTimeFormatter.FULL_DATE_4YEAR)+" "+df.format(dateTime,mp_formatter.DateTimeFormatter.TIME_24HOUR);
var recomWarnStr="<div id ='"+compID+"-stale-warning' class='sub-title-disp "+compNS+"-stale-warning'>"+i18n.discernabu.recommendations_o2.STALE_DATA_MSG.replace("{0}",recomWarnDateStr)+"</div>";
$recomContent.before(recomWarnStr);
};
RecommendationsO2Component.prototype.renderComponent=function(replyObj){var component=replyObj.getComponent();
var self=this;
this.referenceTextCapTimer=new CapabilityTimer("CAP:MPG_Recommendations_O2_Reference_Text",component.getCriterion().category_mean);
var timerRenderComponent=MP_Util.CreateTimer(component.getComponentRenderTimerName(),component.getCriterion().category_mean);
var compID=component.getComponentId();
var compNS=component.getStyles().getNameSpace();
var recomi18n=i18n.discernabu.recommendations_o2;
var recomHTML="";
var tableViewObj=null;
var userPrefAlert="";
var compContainerObj=null;
var countText="";
var reply=replyObj.getResponse();
self.m_referenceTextExistsObj=reply.REFERENCE_TEXT_EXISTS;
var recomRecords=reply.RECS;
var allRemindersAssigned=reply.REMINDER;
var userPrefs=null;
var addProcedureActionObject=this.getAddProcedureAction();
this.processAndSaveRecommendationsReply(allRemindersAssigned);
var $sidePanelContainer=null;
if(!replyObj.getStatus()){replyObj.setStatus("F");
}try{userPrefs=this.getPreferencesObj();
}catch(err){var text=this.m_i18nStrings.UNABLE_TO_RETRIEVE_PREFS;
var alertMarkup=self.getErrorAlert(this.m_alertType.WARNING,text,"");
userPrefAlert+=alertMarkup;
}if(userPrefs){if(userPrefs.savedColumnsObj){self.m_recomPrefObj.savedColumnsObj=userPrefs.savedColumnsObj;
}if(userPrefs.favoritesObject){self.m_recomPrefObj.favoritesObject=userPrefs.favoritesObject;
}if(typeof userPrefs.REQUIRED!=="undefined"){self.m_recomPrefObj.REQUIRED=userPrefs.REQUIRED;
}}try{if(replyObj.getStatus()!=="F"){this.setAllowAdditionIndicator(reply.ENABLE_HM_ADDITION===1?true:false);
this.setAllowModificationIndicator(reply.ENABLE_HM_MODIFICATION===1?true:false);
this.setAllowFreeTextAdditionIndicator(reply.ENABLE_HM_ADD_FREETEXT===1?true:false);
this.setExpectReasonAdditionIndicator(reply.ADD_EXPECT_REASON_PREF===1?true:false);
this.setReasonOnFrequencyModification(reply.MODIFY_FREQ_REASON_PREF===1?true:false);
this.setReasonOnDueDateModification(reply.MODIFY_DUE_DATE_REASON_PREF===1?true:false);
this.setShowSatisfiersPreference(reply.SHOW_SATISFIERS===1?true:false);
var freeTextSatisfiers={DONE_ELSEWHERE_PREF:reply.REQUIRE_HM_DONEELSE===1?true:false,DONE_ELSEWHERE_LABEL:reply.HM_DONEELSE_LABEL,REFUSE_PREF:reply.REQUIRE_HM_REFUSE===1?true:false,REFUSE_LABEL:reply.HM_REFUSE_LABEL,CANCEL_PREF:reply.REQUIRE_HM_CANCEL===1?true:false,CANCEL_LABEL:reply.HM_CANCEL_LABEL};
this.setFreeTextSatisfiers(freeTextSatisfiers);
this.setModifierTypesAndReasons({MODIFIER_TYPES:reply.MODIFIER_TYPES,EXPIRE_REASONS:reply.EXPIRE_REASONS,POSTPONE_REASONS:reply.POSTPONE_REASONS,REFUSE_REASONS:reply.REFUSE_REASONS,SATISFY_REASONS:reply.SATISFY_REASONS});
this.setPendingDueDatePreference(parseInt(reply.PENDING_FUTURE_PREF,10));
component.displayRecomStaleDataMsg(reply);
component.setGroupId(reply.GROUP_ID);
component.displayDateRangePreferenceSelector();
if(replyObj.getStatus()==="S"){recomHTML=component.generateFilterHtml();
compContainerObj=$("<div></div>").attr("id",compID+"maincontainer").addClass(compNS+"-maincontainer");
tableViewObj=$("<div id='"+compID+"tableview' class='"+compNS+"-table'/>");
component.m_personnelArray=MP_Util.LoadPersonelListJSON(reply.PRSNL);
component.processResultsForRender(recomRecords);
component.m_recommendationsTable=new ComponentTable();
component.m_recommendationsTable.setNamespace(compNS+compID);
var imgColInfo={ID:"DUE_IMAGE",CLASS:compNS+"-image",DISPLAY:"&nbsp;",SORTABLE:false,PRIMARY_SORT_FIELD:"",SEC_SORT_FIELD:"",RENDER_TEMPLATE:"DUE_IMAGE"};
var expectationColInfo={ID:"EXPECTATION_NAME",CLASS:compNS+"-expectation",DISPLAY:recomi18n.EXPECTATION,SORTABLE:true,PRIMARY_SORT_FIELD:"EXPECT_STEP",SEC_SORT_FIELD:"DUE_DATE",RENDER_TEMPLATE:"EXPECTATION_NAME"};
var priorityColInfo={ID:"PRIORITY",CLASS:compNS+"-priority",DISPLAY:recomi18n.PRIORITY,PRIMARY_SORT_FIELD:"PRIORITY_SEQ",SEC_SORT_FIELD:"DUE_DATE",SORTABLE:true,RENDER_TEMPLATE:"PRIORITY_TYPE"};
var freqColInfo={ID:"FREQUENCY",CLASS:compNS+"-frequency",DISPLAY:recomi18n.FREQUENCY,PRIMARY_SORT_FIELD:"",SEC_SORT_FIELD:"",SORTABLE:false,RENDER_TEMPLATE:"FREQUENCY"};
var dueColInfo={ID:"DUE",CLASS:compNS+"-due",DISPLAY:recomi18n.DUE,PRIMARY_SORT_FIELD:"DUE_DATE",SEC_SORT_FIELD:"EXPECT_STEP",SORTABLE:true,RENDER_TEMPLATE:"DUE_DATE_STRING"};
var favoritesColInfo={ID:"FAVORITES",CLASS:compNS+"-favorites",DISPLAY:recomi18n.FAVORITES,PRIMARY_SORT_FIELD:"FAVORITES_DISP",SEC_SORT_FIELD:"DUE_DATE",SORTABLE:true,RENDER_TEMPLATE:"FAVORITES"};
var referenceTextColInfo={ID:"REFERENCE_TEXT",CLASS:compNS+"-reference-text",DISPLAY:recomi18n.REFERENCE,PRIMARY_SORT_FIELD:"",SEC_SORT_FIELD:"",SORTABLE:false,RENDER_TEMPLATE:"REFERENCE_TEXT"};
component.m_recommendationsTable.addColumn(component.createColumn(imgColInfo));
var expColum=component.createColumn(expectationColInfo);
component.m_recommendationsTable.addColumn(expColum);
component.m_recommendationsTable.addColumn(component.createColumn(priorityColInfo));
var freqColum=component.createColumn(freqColInfo);
component.m_recommendationsTable.addColumn(freqColum);
var dueColum=component.createColumn(dueColInfo);
component.m_recommendationsTable.addColumn(dueColum);
var referenceColum=component.createColumn(referenceTextColInfo);
component.m_recommendationsTable.addColumn(referenceColum);
var favoritesColum=component.createColumn(favoritesColInfo);
component.m_recommendationsTable.addColumn(favoritesColum);
if(!CERN_Platform.isTouchModeEnabled()){this.m_hvrExtension=new TableCellHoverExtension();
this.m_hvrExtension.addHoverForColumn(expColum,component.onHovering);
this.m_hvrExtension.addHoverForColumn(freqColum,component.onHovering);
this.m_hvrExtension.addHoverForColumn(dueColum,component.onHovering);
component.m_recommendationsTable.addExtension(this.m_hvrExtension);
this.m_hvrExtension.finalize=function(table){var thiz=this;
var tableBodyTag="#"+table.getNamespace()+"tableBody";
var elementMap={};
$(tableBodyTag).on("mouseenter",this.getTarget(),function(event){var anchor=this;
var anchorId=$(this).attr("id");
if(thiz.getHoverClass()!==""&&$(this).children("."+compNS+"-modify-indicator").length>0){$(this).addClass(thiz.getHoverClass());
}if(!elementMap[anchorId]){elementMap[anchorId]={};
}thiz.onHover(event);
elementMap[anchorId].TIMEOUT=setTimeout(function(){thiz.showHover(event,table,anchor);
},500);
});
$(tableBodyTag).on("mouseleave",this.getTarget(),function(event){$(this).removeClass("mpage-tooltip-hover");
if(elementMap[$(this).attr("id")]){clearTimeout(elementMap[$(this).attr("id")].TIMEOUT);
}thiz.onLeave(event);
});
};
}component.addCellClickExtension(recomRecords);
var grpToggleExtension=new TableGroupToggleCallbackExtension();
grpToggleExtension.setGroupToggleCallback(function(){component.resetSidePanelHeight();
});
component.m_recommendationsTable.addExtension(grpToggleExtension);
component.m_recommendationsTable.bindData(recomRecords);
component.setComponentTable(component.m_recommendationsTable);
component.m_lastSelFilter=component.FILTERS.NONE;
component.groupByFilter(component.m_recomPrefObj.groupByPref,recomRecords);
component.m_recommendationsTable.sortByColumnInDirection("DUE",TableColumn.SORT.ASCENDING);
tableViewObj.append($(component.m_recommendationsTable.render()));
$sidePanelContainer=$("<div id='"+compID+"sidePanelContainer' class='"+compNS+"-sidepanel-container'/>");
compContainerObj.append(userPrefAlert);
compContainerObj.append(tableViewObj,$sidePanelContainer);
recomHTML+=compContainerObj[0].outerHTML;
var bDate=new Date();
if(reply.SATIS_EXPECT_START_DATE!==""){bDate.setISO8601(reply.SATIS_EXPECT_START_DATE);
}component.m_historyLookback=bDate.format("mmmm yyyy");
component.m_anchorDate.setISO8601(reply.ANCHOR_DATE);
component.m_recommendationsTable.toggleColumnSort=function(columnId){ComponentTable.prototype.toggleColumnSort.call(this,columnId);
if(component.m_isSidePanelOpen){component.selectDefaultRow(true);
}};
this.updateOverdueIndicatorBasedOnOverdueCount(reply.OVERDUE_CNT);
}else{if((replyObj.getStatus()==="Z")){var OVEDUE_COUNT=0;
recomHTML+=MP_Util.HandleNoDataResponse(component.getStyles().getNameSpace());
this.updateOverdueIndicatorBasedOnOverdueCount(OVEDUE_COUNT);
}}countText=MP_Util.CreateTitleText(component,recomRecords.length);
component.finalizeComponent(recomHTML,countText);
if(replyObj.getStatus()==="S"){component.customizeColumnsBasedOnUserPreferences();
}component.m_$tableView=$("#"+compID+"tableview");
component.m_$sidePanelContainer=$("#"+compID+"sidePanelContainer");
if(this.m_$sidePanelContainer&&this.m_$sidePanelContainer.length){component.initializeSidePanel();
}CERN_EventListener.fireEvent(component,component,EventListener.EVENT_COUNT_UPDATE,{count:recomRecords.length});
component.attachListeners(recomRecords);
if(component.m_modifyObject.saveSuccessful&&component.m_modifyObject.modifiedRowId){this.selectModifiedRow(this.RECOMMENDATION_ACTION.MODIFY);
}else{if(component.getActionObject()&&component.getActionObject().saveSuccessful&&component.getActionObject().modifiedRowId){this.selectModifiedRow(this.RECOMMENDATION_ACTION.MANUAL_SATISFY);
}else{if(this.m_systemSatisfierAction.recommendationId){this.updateSelection(this);
}else{if(addProcedureActionObject&&addProcedureActionObject.saveSuccessful&&addProcedureActionObject.modifiedRowId){this.selectModifiedRow(this.RECOMMENDATION_ACTION.SYSTEM_SATISFY_PROCEDURE);
}}}}}else{var errMsg=[];
errMsg.push(replyObj.getError());
component.finalizeComponent(MP_Util.HandleErrorResponse(component.getStyles().getNameSpace(),errMsg.join("<br />")),"");
CERN_EventListener.fireEvent(component,component,EventListener.EVENT_COUNT_UPDATE,{count:0});
this.setAllowAdditionIndicator(false);
this.setAllowModificationIndicator(false);
this.setAllowFreeTextAdditionIndicator(false);
this.setExpectReasonAdditionIndicator(false);
this.setSatisfiedInd(false);
}}catch(err){if(timerRenderComponent){timerRenderComponent.Abort();
timerRenderComponent=null;
}throw (err);
}finally{if(timerRenderComponent){timerRenderComponent.Stop();
}}};
RecommendationsO2Component.prototype.updateOverdueIndicatorBasedOnOverdueCount=function(overdueCount){if(overdueCount>0){this.setSatisfiedInd(false);
CERN_EventListener.fireEvent(this,this,EventListener.EVENT_SATISFIER_UPDATE,{satisfied:false});
}else{this.setSatisfiedInd(true);
CERN_EventListener.fireEvent(this,this,EventListener.EVENT_SATISFIER_UPDATE,{satisfied:true});
}this.updateComponentRequiredIndicator();
};
RecommendationsO2Component.prototype.isFavoriteAvaliable=function(){var favObj=this.m_recomPrefObj.favoritesObject;
var favLen=favObj.length;
for(var i=0;
i<favLen;
i++){var curFav=favObj[i];
if(curFav.FAVORITE===true){return true;
}}return false;
};
RecommendationsO2Component.prototype.customizeColumnsBasedOnUserPreferences=function(){var self=this;
var compID=self.getComponentId();
var compNS=self.getStyles().getNameSpace();
var componentTable=self.getComponentTable();
var componentTableCols=componentTable.columns;
var colHeader=null;
var currentCol=null;
if(!self.m_recomPrefObj.savedColumnsObj.PRIORITY){colHeader=$("#"+compNS+compID+"columnHeaderPRIORITY");
currentCol=componentTableCols[2];
currentCol.setCustomClass("hidden");
colHeader.addClass("hidden");
}if(!self.m_recomPrefObj.savedColumnsObj.FREQUENCY){colHeader=$("#"+compNS+compID+"columnHeaderFREQUENCY");
currentCol=componentTableCols[3];
currentCol.setCustomClass("hidden");
colHeader.addClass("hidden");
}if(!self.m_recomPrefObj.savedColumnsObj.DUE){colHeader=$("#"+compNS+compID+"columnHeaderDUE");
currentCol=componentTableCols[4];
currentCol.setCustomClass("hidden");
colHeader.addClass("hidden");
}if(!self.m_recomPrefObj.savedColumnsObj.REFERENCE){colHeader=$("#"+compNS+compID+"columnHeaderREFERENCE_TEXT");
currentCol=componentTableCols[5];
currentCol.setCustomClass("hidden");
colHeader.addClass("hidden");
}componentTable.refresh();
};
RecommendationsO2Component.prototype.selectModifiedRow=function(actionPerformed){var modifiedRowId="";
var modifiedRowObject=null;
if(typeof actionPerformed!=="number"){throw new Error("Invalid parameter was passed to selectModifiedRow function");
}switch(actionPerformed){case this.RECOMMENDATION_ACTION.MODIFY:modifiedRowId=this.m_modifyObject.modifiedRowId;
break;
case this.RECOMMENDATION_ACTION.MANUAL_SATISFY:modifiedRowId=this.getActionObject().modifiedRowId;
break;
case this.RECOMMENDATION_ACTION.SYSTEM_SATISFY_PROCEDURE:modifiedRowId=this.getAddProcedureAction().modifiedRowId;
break;
}switch(actionPerformed){case this.RECOMMENDATION_ACTION.MODIFY:this.m_modifyObject={};
break;
case this.RECOMMENDATION_ACTION.MANUAL_SATISFY:this.setActionObject(null);
break;
case this.RECOMMENDATION_ACTION.SYSTEM_SATISFY_PROCEDURE:this.setAddProcedureAction(null);
break;
}this.hideColumnsOnSidePanelOpen();
modifiedRowObject=this.getModifiedRowObject(modifiedRowId);
if(modifiedRowObject!==null&&modifiedRowObject.length>0){this.updateInfo(modifiedRowObject,this.m_recommendationsTable.getRowById(modifiedRowId).getResultData(),false,this.refTextResponse);
}};
RecommendationsO2Component.prototype.openDateRangeModalWindow=function(){var compId=this.getComponentId();
var compNS=this.getStyles().getNameSpace();
var months=0;
var years=0;
var modifiedMonthValue=0;
var modifiedYearValue=0;
var self=this;
var dialogBodyHTML="";
var resetButtonItem=null;
var dateRangeModalDialog=MP_ModalDialog.retrieveModalDialogObject(compId+"dateRangeModalDialog");
if(!dateRangeModalDialog){dateRangeModalDialog=new ModalDialog(compId+"dateRangeModalDialog").setHeaderTitle(self.m_i18nStrings.DUE_DATE_RANGE).setIsBodySizeFixed(false);
dateRangeModalDialog.setBodyDataFunction(function(){var pendingFuturePref=self.getPendingDueDatePreference();
switch(pendingFuturePref){case 6:years=0;
months=6;
break;
case 12:years=0;
months=12;
break;
case 60:years=5;
months=0;
break;
case 120:years=10;
months=0;
break;
default:if(pendingFuturePref<=24){months=pendingFuturePref;
years=0;
}else{months=pendingFuturePref%12;
years=Math.floor(pendingFuturePref/12);
}break;
}dialogBodyHTML="<div id='"+compId+"dateRangeErrorAlert'></div>";
dialogBodyHTML+="<div>"+self.getErrorAlert(self.m_alertType.INFO,self.m_i18nStrings.SAVE_DATE_RANGE,"")+"</div>";
dialogBodyHTML+="<div ><div class='"+compNS+"-modal-from' >"+i18n.FROM+":  "+self.m_i18nStrings.TODAY+"</div><div ><table id='dateRangeTable' class='recom-o2-modal-table' ><tr class='"+compNS+"-modal-table-row'><th class='"+compNS+"-modal-to'></th><th class='"+compNS+"-modal-table-th'>&nbsp;&nbsp;"+self.m_i18nStrings.YEAR_S+"</th><th class='"+compNS+"-modal-table-th'>"+self.m_i18nStrings.MONTH_S+"</th></tr><tr class='"+compNS+"-modal-table-row'><td class='"+compNS+"-modal-to'>"+self.m_i18nStrings.TO+": </td><td class='"+compNS+"-modal-table-td'>&nbsp;&nbsp;<input class='"+compNS+"-modal-input' id='"+compId+"years' type='text' value='"+years+"'></input></td ><td class='"+compNS+"-modal-table-td'><input class='"+compNS+"-modal-input' id='"+compId+"months' type='text' value='"+months+"'></input></td></tr></table></div></div>";
dateRangeModalDialog.setBodyHTML(dialogBodyHTML);
});
dateRangeModalDialog.m_margins={top:25,right:38,bottom:5,left:40};
var saveButton=new ModalButton(compId+"saveDateRangeButton");
saveButton.setText(i18n.SAVE).setIsDithered(true).setCloseOnClick(false);
saveButton.setOnClickFunction(function(){var newOfYears=parseInt($("#"+compId+"years").val(),10);
var newOfMonths=parseInt($("#"+compId+"months").val(),10);
var dateRangeText=self.createDateRangeText(newOfYears,newOfMonths);
var totalMonths=(newOfYears*12)+newOfMonths;
self.saveDateRange(totalMonths,self.DATE_RANGE_TRIGGER.MODAL_WINDOW);
});
var cancelButton=new ModalButton(compId+"cancelDateRangeButton");
cancelButton.setText(i18n.CANCEL).setIsDithered(false).setCloseOnClick(true);
var resetButton=new ModalButton(compId+"resetDateRangeButton");
resetButton.setText(this.m_i18nStrings.RESET).setIsDithered(false).setCloseOnClick(false);
resetButton.setOnClickFunction(function(){$("#"+compId+"years").val(years);
$("#"+compId+"months").val(months);
modifiedYearValue=parseInt($("#"+compId+"years").val(),10);
modifiedMonthValue=parseInt($("#"+compId+"months").val(),10);
var modified=self.isDaterangeModalModified(years,months,modifiedYearValue,modifiedMonthValue);
if(modified){$("#"+compId+"saveDateRangeButton").attr("disabled",false);
}else{$("#"+compId+"saveDateRangeButton").attr("disabled",true);
}});
dateRangeModalDialog.addFooterButton(resetButton);
dateRangeModalDialog.addFooterButton(saveButton);
dateRangeModalDialog.addFooterButton(cancelButton);
MP_ModalDialog.addModalDialogObject(dateRangeModalDialog);
MP_ModalDialog.showModalDialog(dateRangeModalDialog.getId());
resetButtonItem=$("#"+compId+"resetDateRangeButton");
resetButtonItem.removeClass("dyn-modal-button").addClass("recom-o2-reset-button");
}else{MP_ModalDialog.showModalDialog(dateRangeModalDialog.getId());
resetButtonItem=$("#"+compId+"resetDateRangeButton");
resetButtonItem.removeClass("dyn-modal-button").addClass("recom-o2-reset-button");
}$("#"+compId+"years,#"+compId+"months").on("input",function(){$("#"+compId+"years").keypress(function(key){if(key.charCode<48||key.charCode>57){return false;
}});
$("#"+compId+"months").keypress(function(key){if(key.charCode<48||key.charCode>57){return false;
}});
modifiedYearValue=parseInt($("#"+compId+"years").val(),10);
modifiedMonthValue=parseInt($("#"+compId+"months").val(),10);
var modified=self.isDaterangeModalModified(years,months,modifiedYearValue,modifiedMonthValue);
if(modified){$("#"+compId+"saveDateRangeButton").attr("disabled",false);
}else{$("#"+compId+"saveDateRangeButton").attr("disabled",true);
}});
};
RecommendationsO2Component.prototype.isDaterangeModalModified=function(years,months,modifiedYearValue,modifiedMonthValue){if(years===modifiedYearValue&&months===modifiedMonthValue){return false;
}else{if(modifiedYearValue===0&&modifiedMonthValue===0){return false;
}else{if(isNaN(modifiedYearValue)||isNaN(modifiedMonthValue)){return false;
}else{return true;
}}}};
RecommendationsO2Component.prototype.getPreferenceUpdateRequestObject=function(){return{app_qual:0,app:[],position_qual:0,position:[],prsnl_qual:1,prsnl:[{app_number:600005,prsnl_id:this.getCriterion().provider_id,group_qual:1,group:[{group_id:this.getGroupId(),view_name:"HEALTHMAINT",view_seq:0,comp_name:"HEALTHMAINT",comp_seq:0,pref_qual:1,pref:[{pref_id:0,pref_name:"",pref_value:"",sequence:0,merge_id:0,merge_name:"",active_ind:1}]}]}]};
};
RecommendationsO2Component.prototype.saveDateRange=function(dateRangeValue,value){var category_mean=this.getCriterion().category_mean;
var capTimer=new CapabilityTimer("CAP:MPG_Recommendations_O2_Time_Frame_Selector",category_mean);
var component=this;
var compId=this.getComponentId();
var preferenceName="TIME_RANGE_PENDING";
var text="";
var preferenceValue=""+dateRangeValue+"";
var blobIn={REQUESTIN:component.getPreferenceUpdateRequestObject()};
blobIn.REQUESTIN.prsnl[0].group[0].pref[0].pref_name=preferenceName;
blobIn.REQUESTIN.prsnl[0].group[0].pref[0].pref_value=preferenceValue;
var CPS_UPD_DETAIL_PREFS_REQUEST=961205;
var CPS_UPD_DETAIL_PREFS_TASK=961205;
var CPS_UPD_DETAIL_PREFS_APPLICATION=962000;
var scriptRequest=new ScriptRequest();
scriptRequest.setProgramName("MP_EXEC_STD_REQUEST");
scriptRequest.setParameterArray(["^MINE^","^^",CPS_UPD_DETAIL_PREFS_APPLICATION,CPS_UPD_DETAIL_PREFS_TASK,CPS_UPD_DETAIL_PREFS_REQUEST]);
scriptRequest.setDataBlob(MP_Util.enhancedStringify(blobIn));
scriptRequest.setResponseHandler(function(scriptReply){if(scriptReply.getStatus()==="S"){MP_ModalDialog.closeModalDialog(compId+"dateRangeModalDialog");
component.m_sidePanel.hidePanel();
component.refreshComponent();
}else{if(value===component.DATE_RANGE_TRIGGER.MODAL_WINDOW){var alert=$("#"+compId+"dateRangeErrorAlert");
text=component.m_i18nStrings.UNABLE_TO_SAVE_PREFS;
alert.empty().append(component.getErrorAlert(component.m_alertType.ERROR,text,""));
}else{var dialogBodyHTML="";
var dateRangeErrorModalDialog=MP_ModalDialog.retrieveModalDialogObject("dateRangeErrorModalDialog");
if(!dateRangeErrorModalDialog){dateRangeErrorModalDialog=new ModalDialog("dateRangeErrorModalDialog").setHeaderTitle(i18n.ERROR_OCCURED).setIsBodySizeFixed(false);
dateRangeErrorModalDialog.setBodyDataFunction(function(){text=component.m_i18nStrings.UNABLE_TO_SAVE_PREFS;
dialogBodyHTML=component.getErrorAlert(component.m_alertType.ERROR,text,"");
dateRangeErrorModalDialog.setBodyHTML(dialogBodyHTML);
});
dateRangeErrorModalDialog.m_margins={top:25,right:38,bottom:5,left:40};
var closeButton=new ModalButton(compId+"closeDateRangeButton");
closeButton.setText(i18n.CLOSE).setIsDithered(false).setCloseOnClick(true);
dateRangeErrorModalDialog.addFooterButton(closeButton);
MP_ModalDialog.addModalDialogObject(dateRangeErrorModalDialog);
MP_ModalDialog.showModalDialog(dateRangeErrorModalDialog.getId());
}else{MP_ModalDialog.showModalDialog(dateRangeErrorModalDialog.getId());
}}}});
scriptRequest.performRequest();
capTimer.capture();
};
RecommendationsO2Component.prototype.createDateRangeText=function(years,months){if(years===0){return months+" "+this.m_i18nStrings.MONTHS;
}if(months===0){return years+" "+this.m_i18nStrings.YEARS;
}return years+" "+this.m_i18nStrings.YR+" "+months+" "+this.m_i18nStrings.MO;
};
RecommendationsO2Component.prototype.displayDateRangePreferenceSelector=function(){var self=this;
var pendingFuturePref=this.getPendingDueDatePreference();
var compID=this.getComponentId();
var compNS=self.getStyles().getNameSpace();
var recomObject=$("#recom-o2"+compID);
var headerElementsContainer=$(".header-elements-container");
var $_btnCustom=null;
var $_btnCustomDropDown=null;
var dateRangeObj="";
var $_lookbackContainer=null;
var $_btns=null;
var $_rootElement=$("#"+compNS+compID);
headerElementsContainer=$($_rootElement.children().find(".header-elements-container"));
if(!recomObject.length){return;
}var titleObj=recomObject.find(".sec-hd");
if(!titleObj.length){return;
}var lookBackRangeSegmentedControl=new MPageUI.SegmentedControl();
lookBackRangeSegmentedControl.setSelectMode(MPageUI.SEGMENTED_CONTROL_OPTIONS.SELECT_MODE.SINGLE);
lookBackRangeSegmentedControl.addSegment({label:"6 "+self.m_i18nStrings.MONTHS,onSelect:function(){$_btnCustom.removeClass("active");
self.saveDateRange(6,self.DATE_RANGE_TRIGGER.DEFAULT);
},onDeselect:function(){},selected:pendingFuturePref===6?true:false});
lookBackRangeSegmentedControl.addSegment({label:"1 "+self.m_i18nStrings.YEARS,onSelect:function(){$_btnCustom.removeClass("active");
self.saveDateRange(12,self.DATE_RANGE_TRIGGER.DEFAULT);
},onDeselect:function(){},selected:pendingFuturePref===12?true:false});
lookBackRangeSegmentedControl.addSegment({label:"5 "+self.m_i18nStrings.YEARS,onSelect:function(){$_btnCustom.removeClass("active");
self.saveDateRange(60,self.DATE_RANGE_TRIGGER.DEFAULT);
},onDeselect:function(){},selected:pendingFuturePref===60?true:false});
var splitButton=new MPageUI.SplitButton();
if(pendingFuturePref===6||pendingFuturePref===12||pendingFuturePref===60||pendingFuturePref===120){splitButton.setLabel("10 "+self.m_i18nStrings.YEARS);
splitButton.addOptions([{label:self.m_i18nStrings.OTHERS,onSelect:function(){self.openDateRangeModalWindow(pendingFuturePref);
}}]);
}else{var months=0;
var years=0;
if(pendingFuturePref!==6&&pendingFuturePref!==12&&pendingFuturePref!==60){if(pendingFuturePref<=24){months=pendingFuturePref;
years=0;
}else{months=pendingFuturePref%12;
years=Math.floor(pendingFuturePref/12);
}}var dateRangeText=self.createDateRangeText(years,months);
splitButton.setLabel(dateRangeText);
splitButton.addOptions([{label:"10 "+self.m_i18nStrings.YEARS,onSelect:function(){lookBackRangeSegmentedControl.deselectAllSegments();
self.saveDateRange(120,self.DATE_RANGE_TRIGGER.DEFAULT);
}},{type:MPageUI.MENU_OPTIONS.TYPE.SEPARATOR},{label:self.m_i18nStrings.OTHERS,onSelect:function(){lookBackRangeSegmentedControl.deselectAllSegments();
self.openDateRangeModalWindow(pendingFuturePref);
}}]);
}splitButton.setLabelButtonClickCallback(function(){if($_btnCustom.hasClass("btn")){lookBackRangeSegmentedControl.deselectAllSegments();
$_btnCustom.addClass("active");
self.saveDateRange(120,self.DATE_RANGE_TRIGGER.DEFAULT);
}});
var dateRangeMarkUp=lookBackRangeSegmentedControl.render()+splitButton.render();
dateRangeObj="<div id='"+compID+"DateRangeSelector' class='"+compNS+"-date-range-selector'>&nbsp;";
var dateRangeSelectorObj=$("#"+compID+"DateRangeSelector");
if(dateRangeSelectorObj.length===0){dateRangeObj+=dateRangeMarkUp+"</div>";
headerElementsContainer.append(dateRangeObj);
}else{dateRangeObj=$("#"+compID+"DateRangeSelector");
dateRangeObj.empty().append(dateRangeMarkUp);
}$_btnCustom=$("#"+splitButton.getLabelButton().getId());
$_btnCustomDropDown=$("#"+splitButton.getDropdownButton().getId());
if(pendingFuturePref!==6&&pendingFuturePref!==12&&pendingFuturePref!==60){$_btnCustom.addClass("active");
}lookBackRangeSegmentedControl.attachEvents();
splitButton.attachEvents();
$_lookbackContainer=$("#"+compID+"DateRangeSelector");
$_btns=$($_lookbackContainer.find(".btn"));
$_btns.addClass("recom-o2-lookback-button");
$_btnCustomDropDown.removeClass("btn dropdown-toggle").addClass(compNS+"-time-frame-drop-down");
$(".caret").removeClass("caret").addClass(compNS+"-time-frame-caret");
};
RecommendationsO2Component.prototype.processAndSaveRecommendationsReply=function(recommendationsReply){var assignedRecommendations=[];
var recLength=recommendationsReply.length;
for(var recIndex=recLength;
recIndex--;
){if(recommendationsReply[recIndex].SERIES_ID){var scheduleFound=false;
for(var assignedRecIndex=assignedRecommendations.length;
assignedRecIndex--;
){if(assignedRecommendations[assignedRecIndex].SCHEDULE_ID===recommendationsReply[recIndex].SCHEDULE_ID){var seriesFound=false;
var seriesList=assignedRecommendations[assignedRecIndex].SERIES;
for(var seriesIndex=seriesList.length;
seriesIndex--;
){if(seriesList[seriesIndex].SERIES_ID===recommendationsReply[recIndex].SERIES_ID){seriesFound=true;
break;
}}if(!seriesFound){assignedRecommendations[assignedRecIndex].SERIES.push({SERIES_ID:recommendationsReply[recIndex].SERIES_ID});
}scheduleFound=true;
break;
}}if(!scheduleFound){assignedRecommendations.push({SCHEDULE_ID:recommendationsReply[recIndex].SCHEDULE_ID,SERIES:[{SERIES_ID:recommendationsReply[recIndex].SERIES_ID}]});
}}}this.setRecommendationsDataReply(assignedRecommendations);
};
RecommendationsO2Component.prototype.preProcessing=function(){this.m_patientDOB=this.getCriterion().getPatientInfo().getDOB();
var compMenu=new MPageUI.Menu();
var menuId="mainCompMenu"+this.getStyles().getId();
var self=this;
compMenu=MP_MenuManager.getMenuObject(menuId);
try{compMenu.m_activeInd=true;
var customizeTableCols="customizeTableColsItem"+menuId;
this.m_customizeTableColsItem=new MenuSelection(customizeTableCols);
this.m_customizeTableColsItem.setLabel(this.m_i18nStrings.CUSTOMIZE_TABLE_COLUMNS);
this.m_customizeTableColsItem.setIsDisabled(true);
this.m_customizeTableColsItem.setClickFunction(function(){self.customizeTableColumns();
});
compMenu.insertMenuItem(this.m_customizeTableColsItem,0);
}catch(err){}};
RecommendationsO2Component.prototype.customizeTableColumns=function(){var dialogBodyHTML="";
var compId=this.getComponentId();
var compNS=this.getStyles().getNameSpace();
var self=this;
var customizeTableDialog=MP_ModalDialog.retrieveModalDialogObject("customizeTableColumns");
var resetButtonItem=null;
if(!customizeTableDialog){customizeTableDialog=new ModalDialog("customizeTableColumns").setHeaderTitle(this.m_i18nStrings.CUSTOM_COLUMNS).setIsBodySizeFixed(false);
var componentTable=this.getComponentTable();
var componentTableCols=componentTable.columns;
var componentTableLength=componentTableCols.length;
var recomColCount=2;
customizeTableDialog.setBodyDataFunction(function(){dialogBodyHTML="<div id='errorAlert'></div>";
dialogBodyHTML+="<div ><table id='customColumnsTable"+compId+"' class='"+compNS+"-custom-table' ><th class='"+compNS+"-table-header-show' >"+self.m_i18nStrings.SHOW+"</th><th class='"+compNS+"-table-header-column' >"+self.m_i18nStrings.COLUMN+"</th>";
dialogBodyHTML+="<tr><td class='"+compNS+"-td'><input type='checkbox' disabled checked id='"+compId+componentTableCols[1].columnId+"'></input></td><td class='"+compNS+"-disabled'>"+componentTableCols[1].columnDisplay+"<span class = 'recom-o2-lock-icon'></span></td></tr>";
for(recomColCount=2;
recomColCount<componentTableLength;
recomColCount++){if(componentTableCols[recomColCount].columnId!=="FAVORITES"){var checked=self.isColumnChecked(recomColCount);
if(checked){if(componentTableCols[recomColCount].columnId==="PRIORITY"||componentTableCols[recomColCount].columnId==="FREQUENCY"||componentTableCols[recomColCount].columnId==="REFERENCE_TEXT"){dialogBodyHTML+="<tr><td class='"+compNS+"-td'><input type='checkbox' checked id='"+compId+componentTableCols[recomColCount].columnId+"'></input></td><td class='"+compNS+"-td'>"+componentTableCols[recomColCount].columnDisplay+"<span class = 'secondary-text'>&nbsp;( "+self.m_i18nStrings.SIDE_PANE_HIDDEN_INFO_TEXT+" )</span></td></tr>";
}else{dialogBodyHTML+="<tr><td class='"+compNS+"-td'><input type='checkbox' checked id='"+compId+componentTableCols[recomColCount].columnId+"'></input></td><td class='"+compNS+"-td'>"+componentTableCols[recomColCount].columnDisplay+"</td></tr>";
}}else{if(componentTableCols[recomColCount].columnId==="PRIORITY"||componentTableCols[recomColCount].columnId==="FREQUENCY"||componentTableCols[recomColCount].columnId==="REFERENCE_TEXT"){dialogBodyHTML+="<tr><td class='"+compNS+"-td'><input type='checkbox' id='"+compId+componentTableCols[recomColCount].columnId+"'></input></td><td class='"+compNS+"-td'>"+componentTableCols[recomColCount].columnDisplay+"<span class = 'secondary-text'>&nbsp;( "+self.m_i18nStrings.SIDE_PANE_HIDDEN_INFO_TEXT+" )</span></td></tr>";
}else{dialogBodyHTML+="<tr><td class='"+compNS+"-td'><input type='checkbox' id='"+compId+componentTableCols[recomColCount].columnId+"'></input></td><td class='"+compNS+"-td'>"+componentTableCols[recomColCount].columnDisplay+"</td></tr>";
}}}}dialogBodyHTML+="</table></div>";
customizeTableDialog.setBodyHTML(dialogBodyHTML);
});
customizeTableDialog.m_margins={top:25,right:38,bottom:5,left:40};
var saveButton=new ModalButton("saveCustomColumnsButton");
saveButton.setText(i18n.SAVE).setIsDithered(true).setCloseOnClick(false);
saveButton.setOnClickFunction(function(){self.saveSelectedColumns();
});
var cancelButton=new ModalButton("cancelCustomColumnsButton");
cancelButton.setText(i18n.CANCEL).setIsDithered(false).setCloseOnClick(true);
var resetButton=new ModalButton("resetCustomColumnsButton");
resetButton.setText(this.m_i18nStrings.RESET).setIsDithered(false).setCloseOnClick(true);
resetButton.setOnClickFunction(function(){self.resetColumnPreferences();
});
customizeTableDialog.addFooterButton(resetButton);
customizeTableDialog.addFooterButton(saveButton);
customizeTableDialog.addFooterButton(cancelButton);
MP_ModalDialog.addModalDialogObject(customizeTableDialog);
MP_ModalDialog.showModalDialog(customizeTableDialog.getId());
resetButtonItem=$("#resetCustomColumnsButton");
resetButtonItem.removeClass("dyn-modal-button").addClass(compNS+"-reset-button");
}else{MP_ModalDialog.showModalDialog(customizeTableDialog.getId());
resetButtonItem=$("#resetCustomColumnsButton");
resetButtonItem.removeClass("dyn-modal-button").addClass(compNS+"-reset-button");
}$("#customColumnsTable"+compId).on("change","input[type=checkbox]",function(){var modified=self.isModalModified();
if(modified){$("#saveCustomColumnsButton").attr("disabled",false);
}else{$("#saveCustomColumnsButton").attr("disabled",true);
}});
};
RecommendationsO2Component.prototype.isModalModified=function(){var currentPref={PRIORITY:true,FREQUENCY:true,DUE:true,REFERENCE:true};
var compId=this.getComponentId();
var componentTable=this.getComponentTable();
var componentTableCols=componentTable.columns;
var previousSavedPrefs=this.m_recomPrefObj;
var tableCol=$("#"+compId+componentTableCols[2].columnId);
if(!tableCol[0].checked){currentPref.PRIORITY=false;
}tableCol=$("#"+compId+componentTableCols[3].columnId);
if(!tableCol[0].checked){currentPref.FREQUENCY=false;
}tableCol=$("#"+compId+componentTableCols[4].columnId);
if(!tableCol[0].checked){currentPref.DUE=false;
}tableCol=$("#"+compId+componentTableCols[5].columnId);
if(!tableCol[0].checked){currentPref.REFERENCE=false;
}if(previousSavedPrefs.savedColumnsObj.PRIORITY===currentPref.PRIORITY&&previousSavedPrefs.savedColumnsObj.FREQUENCY===currentPref.FREQUENCY&&previousSavedPrefs.savedColumnsObj.DUE===currentPref.DUE&&previousSavedPrefs.savedColumnsObj.REFERENCE===currentPref.REFERENCE){return false;
}else{return true;
}};
RecommendationsO2Component.prototype.resetColumnPreferences=function(){var compId=this.getComponentId();
var compNS=this.getStyles().getNameSpace();
var componentTable=this.getComponentTable();
var componentTableCols=componentTable.columns;
var colHeader=null;
var currentCol=null;
this.m_recomPrefObj.savedColumnsObj={PRIORITY:true,FREQUENCY:true,DUE:true,REFERENCE:true};
colHeader=this.m_$tableView.find("#recom-o2"+compId+"columnHeaderPRIORITY");
currentCol=componentTableCols[2];
currentCol.setCustomClass(compNS+"-priority");
colHeader.removeClass("hidden");
colHeader=this.m_$tableView.find("#recom-o2"+compId+"columnHeaderFREQUENCY");
currentCol=componentTableCols[3];
currentCol.setCustomClass(compNS+"-frequency");
colHeader.removeClass("hidden");
colHeader=this.m_$tableView.find("#recom-o2"+compId+"columnHeaderDUE");
currentCol=componentTableCols[4];
currentCol.setCustomClass(compNS+"-due");
colHeader.removeClass("hidden");
if(this.m_$tableView.hasClass("recom-o2-table")){currentCol.setCustomClass(compNS+"-due");
this.m_$tableView.find("#"+compNS+compId+"columnHeaderDUE").removeClass("recom-o2-due-on-colhide");
}colHeader=this.m_$tableView.find("#recom-o2"+compId+"columnHeaderREFERENCE_TEXT");
currentCol=componentTableCols[5];
currentCol.setCustomClass(compNS+"-reference-text");
colHeader.removeClass("hidden");
if(this.m_$tableView.hasClass("recom-o2-table-with-side-panel")){this.hideColumnsOnSidePanelOpen();
}else{componentTable.refresh();
}this.setPreferencesObj(this.m_recomPrefObj);
this.savePreferences(true);
};
RecommendationsO2Component.prototype.saveSelectedColumns=function(){var self=this;
var compId=this.getComponentId();
var compNS=this.getStyles().getNameSpace();
var componentTable=this.getComponentTable();
var componentTableCols=componentTable.columns;
var componentTableLength=componentTableCols.length;
var previousSavedPrefs=this.m_recomPrefObj;
var colHeader=null;
var currentCol=null;
var category_mean=this.getCriterion().category_mean;
var capTimer=new CapabilityTimer("CAP:MPG_Recommendations_O2_Add_Remove_Column",category_mean);
for(var i=2;
i<componentTableLength;
i++){if(componentTableCols[i].columnId!=="FAVORITES"){var tableCol=$("#"+compId+componentTableCols[i].columnId);
var columnId=tableCol[0].id;
if(tableCol[0].checked===false){switch(columnId){case compId+"PRIORITY":this.m_recomPrefObj.savedColumnsObj.PRIORITY=false;
break;
case compId+"FREQUENCY":this.m_recomPrefObj.savedColumnsObj.FREQUENCY=false;
break;
case compId+"DUE":this.m_recomPrefObj.savedColumnsObj.DUE=false;
break;
case compId+"REFERENCE_TEXT":this.m_recomPrefObj.savedColumnsObj.REFERENCE=false;
break;
}}else{switch(columnId){case compId+"PRIORITY":this.m_recomPrefObj.savedColumnsObj.PRIORITY=true;
break;
case compId+"FREQUENCY":this.m_recomPrefObj.savedColumnsObj.FREQUENCY=true;
break;
case compId+"DUE":this.m_recomPrefObj.savedColumnsObj.DUE=true;
break;
case compId+"REFERENCE_TEXT":this.m_recomPrefObj.savedColumnsObj.REFERENCE=true;
break;
}}}}try{this.setPreferencesObj(this.m_recomPrefObj);
this.savePreferences(true);
if(self.m_recomPrefObj.savedColumnsObj.DUE===false){colHeader=$("#"+compNS+compId+"columnHeaderDUE");
currentCol=componentTableCols[4];
currentCol.setCustomClass("hidden");
colHeader.addClass("hidden");
}else{currentCol=componentTableCols[4];
this.m_$tableView.find("#"+compNS+compId+"columnHeaderDUE").removeClass("hidden");
if(this.m_$tableView.hasClass("recom-o2-table")){currentCol.setCustomClass(compNS+"-due");
this.m_$tableView.find("#"+compNS+compId+"columnHeaderDUE").removeClass("recom-o2-due-on-colhide");
}else{currentCol.setCustomClass("recom-o2-due-on-colhide");
this.m_$tableView.find("#"+compNS+compId+"columnHeaderDUE").addClass("recom-o2-due-on-colhide");
}}if(this.m_$tableView.hasClass("recom-o2-table")){if(self.m_recomPrefObj.savedColumnsObj.PRIORITY===false){colHeader=$("#"+compNS+compId+"columnHeaderPRIORITY");
currentCol=componentTableCols[2];
currentCol.setCustomClass("hidden");
colHeader.addClass("hidden");
}else{colHeader=$("#"+compNS+compId+"columnHeaderPRIORITY");
currentCol=componentTableCols[2];
currentCol.setCustomClass(compNS+"-priority");
colHeader.removeClass("hidden");
}if(self.m_recomPrefObj.savedColumnsObj.FREQUENCY===false){colHeader=$("#"+compNS+compId+"columnHeaderFREQUENCY");
currentCol=componentTableCols[3];
currentCol.setCustomClass("hidden");
colHeader.addClass("hidden");
}else{colHeader=$("#"+compNS+compId+"columnHeaderFREQUENCY");
currentCol=componentTableCols[3];
currentCol.setCustomClass(compNS+"-frequency");
colHeader.removeClass("hidden");
}if(self.m_recomPrefObj.savedColumnsObj.REFERENCE===false){colHeader=$("#"+compNS+compId+"columnHeaderREFERENCE_TEXT");
currentCol=componentTableCols[5];
currentCol.setCustomClass("hidden");
colHeader.addClass("hidden");
}else{colHeader=$("#"+compNS+compId+"columnHeaderREFERENCE_TEXT");
currentCol=componentTableCols[5];
currentCol.setCustomClass(compNS+"-reference-text");
colHeader.removeClass("hidden");
}componentTable.refresh();
}MP_ModalDialog.closeModalDialog("customizeTableColumns");
componentTable.refresh();
}catch(err){var alert=$("#errorAlert");
var text=this.m_i18nStrings.UNABLE_TO_SAVE_PREFS;
alert.empty().append(self.getErrorAlert(this.m_alertType.ERROR,text,""));
this.m_recomPrefObj.savedColumnsObj.EXPECTATION=previousSavedPrefs.savedColumnsObj.EXPECTATION;
this.m_recomPrefObj.savedColumnsObj.PRIORITY=previousSavedPrefs.savedColumnsObj.PRIORITY;
this.m_recomPrefObj.savedColumnsObj.FREQUENCY=previousSavedPrefs.savedColumnsObj.FREQUENCY;
this.m_recomPrefObj.savedColumnsObj.DUE=previousSavedPrefs.savedColumnsObj.DUE;
this.m_recomPrefObj.savedColumnsObj.REFERENCE=previousSavedPrefs.savedColumnsObj.REFERENCE;
}capTimer.capture();
};
RecommendationsO2Component.prototype.isColumnChecked=function(index){switch(index){case this.m_defaultCols.PRIORITY:return this.m_recomPrefObj.savedColumnsObj.PRIORITY;
case this.m_defaultCols.FREQUENCY:return this.m_recomPrefObj.savedColumnsObj.FREQUENCY;
case this.m_defaultCols.DUE:return this.m_recomPrefObj.savedColumnsObj.DUE;
case this.m_defaultCols.REFERENCE:return this.m_recomPrefObj.savedColumnsObj.REFERENCE;
default:return true;
}};
RecommendationsO2Component.prototype.getErrorAlert=function(value,primaryText,secondaryText){var markup="";
var banner=new MPageUI.AlertBanner();
switch(value){case this.m_alertType.ERROR:banner.setType(MPageUI.ALERT_OPTIONS.TYPE.ERROR);
break;
case this.m_alertType.WARNING:banner.setType(MPageUI.ALERT_OPTIONS.TYPE.WARNING);
break;
case this.m_alertType.INFO:banner.setType(MPageUI.ALERT_OPTIONS.TYPE.INFO);
break;
default:banner.setType(MPageUI.ALERT_OPTIONS.TYPE.ERROR);
break;
}primaryText=primaryText?primaryText:"Please try again";
secondaryText=secondaryText?secondaryText:"";
banner.setPrimaryText(primaryText);
banner.setSecondaryText(secondaryText);
markup=banner.render();
return markup;
};
RecommendationsO2Component.prototype.postProcessing=function(){MPageComponent.prototype.postProcessing.call(this);
var componentStyles=this.getStyles();
var componentHeaderContainer=$("#"+componentStyles.getId()).find("span."+componentStyles.getTitle());
if(componentHeaderContainer.find("a.add-plus")){componentHeaderContainer.find("a.add-plus").addClass("hidden");
}if(this.getAllowAdditionIndicator()){this.setPlusAddEnabled(this.getAllowAdditionIndicator());
this.getRenderStrategy().addComponentSection(componentHeaderContainer,this.getRenderStrategy().createPlusAddControl());
}if(this.getComponentTable()){this.m_customizeTableColsItem.setIsDisabled(false);
}};
RecommendationsO2Component.prototype.onHovering=function(data){var text=null;
if(data.COLUMN_ID==="EXPECTATION_NAME"&&data.RESULT_DATA.HAS_EXP_MODIFY_IND){text=data.RESULT_DATA.EXP_HOVER;
}else{if(data.COLUMN_ID==="FREQUENCY"&&data.RESULT_DATA.HAS_FREQ_MODIFY_IND){text=data.RESULT_DATA.FREQ_HOVER;
}else{if(data.COLUMN_ID==="DUE"&&data.RESULT_DATA.HAS_DUE_DATE_MODIFY_IND){text=data.RESULT_DATA.DUE_DATE_HOVER;
}}}return text;
};
RecommendationsO2Component.prototype.GetDateDiffString=function(beginDate,endDate,specificUnit){var mathFlag=1;
var abbreviateFlag=false;
var i18nCore=i18n.discernabu;
var timeDiff=0;
var returnVal="";
endDate=(!endDate)?new Date():endDate;
mathFlag=(!mathFlag)?0:mathFlag;
var one_minute=1000*60;
var one_hour=one_minute*60;
var one_day=one_hour*24;
var one_week=one_day*7;
var valHours=0;
var valDays=0;
var valWeeks=0;
var valMonths=0;
var valYears=0;
timeDiff=(endDate.getTime()-beginDate.getTime());
var mathFunc=null;
var comparisonFunc=null;
if(mathFlag===0){mathFunc=function(val){return Math.ceil(val);
};
comparisonFunc=function(lowerVal,upperVal){return(lowerVal<=upperVal);
};
}else{mathFunc=function(val){return Math.floor(val);
};
comparisonFunc=function(lowerVal,upperVal){return(lowerVal<upperVal);
};
}var calcMonths=function(){var removeCurYr=0;
var removeCurMon=0;
var yearDiff=0;
var monthDiff=0;
var dayDiff=endDate.getDate();
if(endDate.getMonth()>beginDate.getMonth()){monthDiff=endDate.getMonth()-beginDate.getMonth();
if(endDate.getDate()<beginDate.getDate()){removeCurMon=1;
}}else{if(endDate.getMonth()<beginDate.getMonth()){monthDiff=12-beginDate.getMonth()+endDate.getMonth();
removeCurYr=1;
if(endDate.getDate()<beginDate.getDate()){removeCurMon=1;
}}else{if(endDate.getDate()<beginDate.getDate()){removeCurYr=1;
monthDiff=11;
}}}if(endDate.getDate()>=beginDate.getDate()){dayDiff=endDate.getDate()-beginDate.getDate();
}yearDiff=(endDate.getFullYear()-beginDate.getFullYear())-removeCurYr;
monthDiff+=(yearDiff*12)+(dayDiff/32)-removeCurMon;
return monthDiff;
};
valHours=mathFunc(timeDiff/one_hour);
valDays=mathFunc(timeDiff/one_day);
valWeeks=mathFunc(timeDiff/one_week);
valMonths=calcMonths();
valMonths=mathFunc(valMonths);
valYears=mathFunc(valMonths/12);
if(specificUnit){switch(specificUnit){case"HOURS":return valHours;
case"DAYS":return valDays;
case"WEEKS":return valWeeks;
case"MONTHS":return valMonths;
case"YEARS":return valYears;
}}if(comparisonFunc(valWeeks,2)){returnVal=abbreviateFlag?(i18nCore.WITHIN_DAYS.replace("{0}",valDays)):(i18nCore.X_DAYS.replace("{0}",valDays));
}else{if(comparisonFunc(valMonths,2)){returnVal=abbreviateFlag?(i18nCore.WITHIN_WEEKS.replace("{0}",valWeeks)):(i18nCore.X_WEEKS.replace("{0}",valWeeks));
}else{if(comparisonFunc(valYears,2)){returnVal=abbreviateFlag?(i18nCore.WITHIN_MONTHS.replace("{0}",valMonths)):(i18nCore.X_MONTHS.replace("{0}",valMonths));
}else{returnVal=abbreviateFlag?(i18nCore.WITHIN_YEARS.replace("{0}",valYears)):(i18nCore.X_YEARS.replace("{0}",valYears));
}}}return(returnVal);
};
RecommendationsO2Component.prototype.getScriptRequestStructure=function(requestNumber){if(typeof requestNumber!=="number"){throw new Error("Invalid parameter passed to getScriptRequestStructure function");
}var requestStructure=null;
switch(requestNumber){case 966321:requestStructure={REQUESTIN:{QUAL:[],ALLOW_RECOMMENDATION_SERVER_IND:0}};
break;
case 966325:requestStructure={REQUESTIN:{DUE_ACTIONS:[],POSTPONE_ACTIONS:[],CANCEL_ACTIONS:[],SATISFY_ACTIONS:[],FREQUENCY_ACTIONS:[],DUE_DATE_ACTIONS:[],ASSIGN_ACTIONS:[],UNDO_ACTIONS:[],ASSIGN_ACTION_OVERRIDE_CNT:0}};
break;
case 115467:requestStructure={REQUESTIN:{PROCEDURES:[{PROVIDERS:[],COMMENTS:[],MODIFIER_GROUPS:[],DIAGNOSIS_GROUPS:[],PROCEDURE_ID:0,VERSION:0,ENCOUNTER_ID:this.getCriterion().encntr_id,NOMENCLATURE_ID:0,FREE_TEXT:"",PERFORMED_DT_TM:"",PERFORMED_DT_TM_PREC:0,MINUTES:0,PRIORITY:0,ANESTHESIA_CD:0,ANESTHESIA_MINUTES:0,TISSUE_TYPE_CD:0,LOCATION_ID:0,FREE_TEXT_LOCATION:"",NOTE:"",RANKING_CD:0,CLINICAL_SERVICE_CD:0,ACTIVE_IND:1,END_EFFECTIVE_DT_TM:"",CONTRIBUTOR_SYSTEM_CD:0,PROCEDURE_TYPE:2,SUPPRESS_NARRATIVE_IND:0,PERFORMED_DT_TM_PREC_CD:0,LATERALITY_CD:0}]}};
break;
}return requestStructure;
};
RecommendationsO2Component.prototype.getAssignActionObject=function(){return{PERSON_ID:0,EXPECT_ID:0,STEP_ID:0,EXPECTATION_FTDESC:"",ON_BEHALF_OF_PRSNL_ID:0,REASON_CD:0,COMMENT:"",FREQUENCY_VALUE:0,FREQUENCY_UNIT_CD:0,NEW_DUE_DT_TM:"",PREV_FREQUENCY_VALUE:0,PREV_FREQUENCY_UNIT_CD:0};
};
RecommendationsO2Component.prototype.getAddExpectationsBlobIn=function(checkedExpectations){if(!checkedExpectations||!checkedExpectations.length){throw new Error("Invalid parameter passed in to getAddExpectationsBlobIn function");
}var addRequestStructure=this.getScriptRequestStructure(966325);
var reasonCodeValue=this.getReasonOnAddition();
var commentText=this.getCommentOnAddition();
for(var i=checkedExpectations.length;
i--;
){delete checkedExpectations[i].RECOMMENDATION_TEMP_ID;
checkedExpectations[i].REASON_CD=reasonCodeValue;
checkedExpectations[i].COMMENT=commentText;
}addRequestStructure.REQUESTIN.ASSIGN_ACTIONS=checkedExpectations;
addRequestStructure.REQUESTIN.ASSIGN_ACTION_OVERRIDE_CNT=this.getActionOverrideCount();
return JSON.stringify(addRequestStructure).replace(/\\n/g,"\n");
};
RecommendationsO2Component.prototype.saveExpectations=function(checkedExpectations){if(!checkedExpectations||!checkedExpectations.length){throw new Error("Invalid parameter passed in to saveExpectations function");
}var addRecommendationsWindow=MP_ModalDialog.retrieveModalDialogObject("addRecommendation");
addRecommendationsWindow.setFooterButtonDither("addRecButton",true);
for(var i=checkedExpectations.length;
i--;
){var curentAssignedDate=checkedExpectations[i].NEW_DUE_DT_TM;
if(checkedExpectations[i].NEW_DUE_DT_TM){if(typeof checkedExpectations[i].NEW_DUE_DT_TM!=="string"){var dateForComparision=new Date(curentAssignedDate.getFullYear(),curentAssignedDate.getMonth(),curentAssignedDate.getDate());
var currentDate=new Date();
var currentDateForComparision=new Date(currentDate.getFullYear(),currentDate.getMonth(),currentDate.getDate());
if(dateForComparision.getTime()===currentDateForComparision.getTime()){checkedExpectations[i].NEW_DUE_DT_TM="";
}else{checkedExpectations[i].NEW_DUE_DT_TM=JSON.stringify(checkedExpectations[i].NEW_DUE_DT_TM).replace(/"/g,"");
this.incrementActionOverrideCount();
}}else{this.incrementActionOverrideCount();
}}if(checkedExpectations[i].FREQUENCY_VALUE!==0){this.incrementActionOverrideCount();
}}var self=this;
var scriptRequest=new ScriptRequest();
scriptRequest.setProgramName("MP_ADD_RECOMMENDATIONS");
scriptRequest.setParameterArray(["^MINE^"]);
scriptRequest.setDataBlob(this.getAddExpectationsBlobIn(checkedExpectations));
scriptRequest.setResponseHandler(function(scriptReply){if(scriptReply.getStatus()==="S"){self.setSelectedFreeTextExpectationsList([]);
self.setSelectedExpectationsList([]);
self.setExpectationsWithFixedDaysFrequency([]);
self.setActionOverrideCount(0);
self.setCommentOnAddition("");
self.setReasonOnAddition(0);
MP_ModalDialog.closeModalDialog("addRecommendation");
self.retrieveComponentData();
}else{var saveFailureMsgContainer=$(".recom-o2-save-failure-msg");
if(saveFailureMsgContainer.hasClass("hidden")){var saveErrorHTML=MP_Core.generateUserMessageHTML("error",self.m_i18nStrings.ADD_RECC_FAILED_TITLE,self.m_i18nStrings.ADD_RECC_FAILED_TEXT,"recom-o2-save-failure");
saveFailureMsgContainer.empty().html(saveErrorHTML);
saveFailureMsgContainer.removeClass("hidden");
}addRecommendationsWindow.setFooterButtonDither("addRecButton",false);
}});
scriptRequest.performRequest();
};
RecommendationsO2Component.prototype.determineFrequencyType=function(seriesID){if(typeof seriesID!=="number"){throw new Error("Invalid parameter passed in to determineFrequencyType function");
}var allExpectations=this.getAllAvailableExpectations().SCHED;
var foundSeriesID=false;
var expectationObj;
for(var schedIndex=allExpectations.length;
schedIndex--;
){if(allExpectations[schedIndex].EXPECT_SCHED_TYPE_FLAG!==1){for(var seriesIndex=allExpectations[schedIndex].SERIES.length;
seriesIndex--;
){if(allExpectations[schedIndex].SERIES[seriesIndex].EXPECT_SERIES_ID===seriesID){foundSeriesID=true;
expectationObj=allExpectations[schedIndex].SERIES[seriesIndex].EXPECT[0];
break;
}}if(foundSeriesID){break;
}}}if(typeof expectationObj==="undefined"){throw new Error("Invalid seriesID passed to determineFrequencyType function");
}var frequencyObject={frequencyType:-1,frequencyInDays:-1};
for(var i=expectationObj.STEP.length;
i--;
){if(expectationObj.STEP[i].START_TIME_OF_YEAR>0||expectationObj.STEP[i].END_TIME_OF_YEAR>0){frequencyObject.frequencyType=this.FREQUENCY_TYPE.SEASONAL;
return frequencyObject;
}}var frequencyValue=0;
var foundSatisfierDuration=false;
var satisfiers=expectationObj.SAT;
for(i=satisfiers.length;
i--;
){if(foundSatisfierDuration===false&&satisfiers[i].SATISFIED_DURATION>0){frequencyValue=satisfiers[i].SATISFIED_DURATION;
foundSatisfierDuration=true;
}if(foundSatisfierDuration===true){if(satisfiers[i].SATISFIED_DURATION!==frequencyValue&&satisfiers[i].SATISFIED_DURATION!==0){frequencyObject.frequencyType=this.FREQUENCY_TYPE.VARIABLE;
return frequencyObject;
}}}if(foundSatisfierDuration===true){frequencyObject.frequencyType=this.FREQUENCY_TYPE.FIXED_NO_OF_DAYS;
frequencyObject.frequencyInDays=frequencyValue;
}else{frequencyObject.frequencyType=this.FREQUENCY_TYPE.ONE_TIME_ONLY;
}return frequencyObject;
};
RecommendationsO2Component.prototype.formatFrequency=function(inputFrequency){if(typeof inputFrequency!=="number"){throw new Error("Invalid parameter passed in to formatFrequency function");
}var ONE_WEEK_IN_DAYS=7;
var TWO_WEEKS_IN_DAYS=14;
var ONE_MONTH_IN_DAYS=30;
var TWO_MONTHS_IN_DAYS=60;
var ONE_YEAR_IN_DAYS=365;
var TWO_YEARS_IN_DAYS=730;
var formattedFrequency={frequencyValue:0,frequencyMeaning:"",frequencyCodeValue:0};
if(inputFrequency<TWO_WEEKS_IN_DAYS){formattedFrequency.frequencyValue=inputFrequency;
formattedFrequency.frequencyMeaning="DAYS";
}else{if(inputFrequency<TWO_MONTHS_IN_DAYS){formattedFrequency.frequencyValue=Math.floor(inputFrequency/ONE_WEEK_IN_DAYS);
formattedFrequency.frequencyMeaning="WEEKS";
}else{if(inputFrequency<TWO_YEARS_IN_DAYS){formattedFrequency.frequencyValue=Math.floor(inputFrequency/ONE_MONTH_IN_DAYS);
formattedFrequency.frequencyMeaning="MONTHS";
}else{formattedFrequency.frequencyValue=Math.floor(inputFrequency/ONE_YEAR_IN_DAYS);
formattedFrequency.frequencyMeaning="YEARS";
}}}var frequencyCodeValues=this.getTimeUnitsCodeSet();
for(var i=frequencyCodeValues.length;
i--;
){if(frequencyCodeValues[i].FREQUENCY_MEANING===formattedFrequency.frequencyMeaning){formattedFrequency.frequencyCodeValue=frequencyCodeValues[i].FREQUENCY_CD;
break;
}}return formattedFrequency;
};
RecommendationsO2Component.prototype.addEventHandlersForSidePanelActions=function(sidePanelHtml,modifyButtonHTML,dataObject,popupHtml){var self=this;
var compID=this.getComponentId();
var recomID=dataObject.RECOMMENDATION_ID;
this.m_$sidePanelContainer.on("click","#"+compID+"referenceText",function(){var entityName=$(this).attr("parent_entity_name");
var entityId=$(this).attr("parent_entity_id");
var headerTitle=$(this).attr("header_title");
self.m_viewReferenceTextObj.setWindowHeader(headerTitle);
self.m_viewReferenceTextObj.setEntityName(entityName);
self.m_viewReferenceTextObj.setEntityId(parseInt(entityId,10));
self.m_viewReferenceTextObj.setErrorMethod(self.createReferenceTextAlert);
self.m_viewReferenceTextObj.viewReferenceText();
self.referenceTextCapTimer.capture();
});
this.m_$sidePanelContainer.on("click","#modifyRecomButton"+compID,function(){if(!$(this).hasClass("disabled")&&!self.m_isSidePanelLoading){self.m_currentAction=self.RECOMMENDATION_ACTION.MODIFY;
self.m_modifyObject={GROUP_NAME:dataObject.GROUP_NAME,RECOMMENDATION_ID:dataObject.RECOMMENDATION_ID,FREQUENCY_VALUE:dataObject.FREQ_VALUE,FREQ_UNIT_DISP:dataObject.FREQ_UNIT_DISP,DUE_DATE_UTC:dataObject.DUE_DATE_UTC,FREQUENCY_HISTORY:dataObject.FREQ_HIST};
if(!self.getCurrentProviderName().length||!self.getReasonCodeSet().length||!self.getTimeUnitsCodeSet().length){self.m_sidePanel.setContents("<div class = 'recom-o2-modify-pre-loader'></div>");
self.m_isSidePanelLoading=true;
var recommendationsDataRequest=new ScriptRequest();
recommendationsDataRequest.setProgramName("mp_get_data_add_expectation");
recommendationsDataRequest.setParameterArray(["^MINE^",self.getCriterion().provider_id+".0",1]);
recommendationsDataRequest.setResponseHandler(function(replyObj){self.saveCodeSetData(replyObj);
self.renderModifyExpectation();
self.m_sidePanel.expandSidePanel();
self.m_sidePanel.m_cornerCloseButton.hide();
self.m_isSidePanelLoading=false;
});
recommendationsDataRequest.performRequest();
}else{self.renderModifyExpectation();
self.m_sidePanel.expandSidePanel();
self.m_sidePanel.m_cornerCloseButton.hide();
}}});
this.m_$sidePanelContainer.on("click","#actionsRecomButton"+compID,function(){if(!$(this).hasClass("disabled")&&!self.m_isSidePanelLoading){self.getPopupObject().toggle();
self.attachPopupHandler(dataObject);
}});
this.m_$sidePanelContainer.on("click","#saveRecomButton"+recomID+compID,function(){var categoryMean=self.getCriterion().category_mean;
var modifyExpectationCapTimer=null;
var satisfyExpectationCapTimer=null;
var undoExpectationActionCapTimer=null;
if($(this).hasClass("disabled")!==true){self.removeSidePanelErrorMessage();
switch(self.m_currentAction){case self.RECOMMENDATION_ACTION.MODIFY:self.modifyExpectation();
modifyExpectationCapTimer=new CapabilityTimer("CAP:MPG_Recommendations_O2_Modify",categoryMean);
if(modifyExpectationCapTimer){modifyExpectationCapTimer.addMetaData("rtms.legacy.metadata.1","Modify Recommendation");
modifyExpectationCapTimer.capture();
}break;
case self.RECOMMENDATION_ACTION.EXPIRE:case self.RECOMMENDATION_ACTION.POSTPONE:case self.RECOMMENDATION_ACTION.REFUSE:case self.RECOMMENDATION_ACTION.MANUAL_SATISFY:self.satisfyExpectation();
satisfyExpectationCapTimer=new CapabilityTimer("CAP:MPG_Recommendations_O2_Manual_Satisfiers",categoryMean);
if(satisfyExpectationCapTimer){satisfyExpectationCapTimer.addMetaData("rtms.legacy.metadata.1","Satisfy Recommendation");
satisfyExpectationCapTimer.capture();
}break;
case self.RECOMMENDATION_ACTION.UNDO:self.undoExpectationAction($(this));
undoExpectationActionCapTimer=new CapabilityTimer("CAP:MPG_Recommendations_O2_Undo_satisfier",categoryMean);
if(undoExpectationActionCapTimer){undoExpectationActionCapTimer.addMetaData("rtms.legacy.metadata.1","Undo Recommendation Action");
undoExpectationActionCapTimer.capture();
}break;
case self.RECOMMENDATION_ACTION.SYSTEM_SATISFY_PROCEDURE:self.chartProcedureSatisfier($(this));
var procedureSatisfierCapTimer=new CapabilityTimer("CAP:MPG_Recommendations_O2_Procedure_Satisfier",categoryMean);
if(procedureSatisfierCapTimer){procedureSatisfierCapTimer.addMetaData("rtms.legacy.metadata.1","Procedure Satisfier Action");
procedureSatisfierCapTimer.capture();
}break;
}}});
this.m_$sidePanelContainer.on("click","#cancelButton"+recomID+compID,function(){self.m_currentAction=self.RECOMMENDATION_ACTION.NO_ACTION;
self.removeSidePanelErrorMessage();
self.m_$sidePanelContainer.find("#modifyContainer"+recomID+compID).off();
self.m_$sidePanelContainer.find("#actionContainer"+recomID+compID).off();
self.m_$sidePanelContainer.find("#undoActionContainer"+recomID+compID).off();
self.m_sidePanel.m_cornerCloseButton.show();
self.setDueDateChangeIndicator(false);
self.setFrequencyChangeIndicator(false);
self.m_sidePanel.collapseSidePanel();
self.m_sidePanel.setContents(sidePanelHtml,"recom-o2"+compID);
self.m_sidePanel.setActionsAsHTML(modifyButtonHTML);
self.attachPopupToActionsButton(popupHtml);
self.styleTimelineGraph();
self.adjustScrollBarPosition(true);
});
$("body").mouseup(function(event){var targetElement=$(event.target);
if(event.target.getAttribute("id")!=="actionsRecomButton"+self.getComponentId()&&!targetElement.parents("#actionsRecomButton"+self.getComponentId()).length){var popup=self.getPopupObject();
if(popup&&popup.exists()&&popup.isOpen()){if(!targetElement.hasClass("tooltipster-content")&&!targetElement.parents().hasClass("tooltipster-content")){popup.hide();
}}}});
$(".wrkflw-views").scroll(function(){var popup=self.getPopupObject();
if(popup&&popup.exists()){popup.hide();
}});
};
RecommendationsO2Component.prototype.removeSidePanelErrorMessage=function(){var modifyFailedContainer=this.m_$sidePanelContainer.find(".recom-o2-sp-err-msg");
if(!modifyFailedContainer.hasClass("hidden")){modifyFailedContainer.addClass("hidden");
}};
RecommendationsO2Component.prototype.renderModifyExpectation=function(){var compID=this.getComponentId();
var recomID=this.m_modifyObject.RECOMMENDATION_ID;
var saveAndCancelButtonHTML="<div id='recommendationsSPAction"+compID+"' class='recom-o2-sp-actions'><div class='sp-button2 recom-o2-cancel-button' id='cancelButton"+recomID+compID+"'>"+i18n.CANCEL+"</div><div class='sp-button2 recom-o2-save-button disabled' id='saveRecomButton"+recomID+compID+"'>"+i18n.SAVE+"</div></div>";
var frequencyCodeValues=this.getTimeUnitsCodeSet();
for(var i=frequencyCodeValues.length;
i--;
){if(frequencyCodeValues[i].FREQUENCY_DISPLAY===this.m_modifyObject.FREQ_UNIT_DISP){this.m_modifyObject.FREQUENCY_UNIT_CD=frequencyCodeValues[i].FREQUENCY_CD;
this.m_modifyObject.NEW_FREQUENCY_VALUE=this.m_modifyObject.FREQUENCY_VALUE;
this.m_modifyObject.NEW_FREQUENCY_UNIT_CD=frequencyCodeValues[i].FREQUENCY_CD;
break;
}}this.m_sidePanel.setContents(this.createModifyHtml(),"recom-o2"+compID);
this.attachDatePicker(recomID,"modifyContainer",false,false);
this.m_sidePanel.setActionsAsHTML(saveAndCancelButtonHTML);
this.m_$sidePanelContainer.find("#frequencyOption"+recomID+compID).val(this.m_modifyObject.FREQUENCY_UNIT_CD);
var $selectedAgeOption=this.m_$sidePanelContainer.find("#ageOption"+recomID+compID).find(":selected");
this.m_modifyObject.AGE_UNIT_MEANING=$selectedAgeOption.attr("meaning");
this.m_modifyObject.AGE_UNIT_CD=$selectedAgeOption.attr("value");
this.addEventHandlersForModifyContainer();
this.adjustScrollBarPosition(false);
};
RecommendationsO2Component.prototype.resetModifyIndicators=function(){this.setDueDateChangeIndicator(false);
this.setFrequencyChangeIndicator(false);
this.m_isSidePanelLoading=false;
this.m_isSidePanelOpen=false;
this.m_lastSelectedRow="";
this.m_lastSelectedRowProperty="";
};
RecommendationsO2Component.prototype.createModifyHtml=function(){var compID=this.getComponentId();
var recomID=this.m_modifyObject.RECOMMENDATION_ID;
var dateTime=new Date();
var currentDateForComparision=new Date(dateTime.getFullYear(),dateTime.getMonth(),dateTime.getDate());
var freqValue=this.m_modifyObject.FREQUENCY_VALUE;
var disabledPropertyForFrequency="";
var dateClass="recom-o2-modify-date-value";
var frequencyLabel=this.m_i18nStrings.RECURRING;
var unitsCodes=this.getTimeUnitsCodeSet();
var codeSetLength=unitsCodes.length;
if(this.m_modifyObject.DUE_DATE_UTC!==""){dateTime.setISO8601(this.m_modifyObject.DUE_DATE_UTC);
this.m_modifyObject.OLD_DUE_DATE=dateTime;
if(this.m_modifyObject.OLD_DUE_DATE<currentDateForComparision){dateClass+=" required-field-input";
this.m_modifyObject.DATE_PICKER_DUE_DT_TM=undefined;
}else{this.m_modifyObject.DATE_PICKER_DUE_DT_TM=this.m_modifyObject.OLD_DUE_DATE;
this.m_modifyObject.NEW_DUE_DT_TM=this.m_modifyObject.DATE_PICKER_DUE_DT_TM;
}}switch(this.m_modifyObject.FREQUENCY_VALUE){case 0:frequencyLabel=this.m_i18nStrings.ONE_TIME_ONLY;
disabledPropertyForFrequency="disabled";
freqValue="";
break;
case -1:frequencyLabel=this.m_i18nStrings.VARIABLE;
freqValue="";
break;
case -2:frequencyLabel=this.m_i18nStrings.SEASONAL;
disabledPropertyForFrequency="disabled";
freqValue="";
break;
}var modifyFailedHtml="<div class = 'recom-o2-sp-err-msg hidden'></div>";
var dueLabel="<span class = 'recom-o2-modify-due-label secondary-text'>"+this.m_i18nStrings.DUE+"</span>";
var changeDueDateDiv="<div class = 'recom-o2-due-date-label-sp'><span>"+dateTime.format(dateFormat.masks.longDate)+"</span><span id = 'changeDueDateImage"+recomID+compID+"'class='recom-o2-modify-due-date-icon'></span></div>";
var dateAgeDropDown="<select id='DateOrAgeSelector"+recomID+compID+"' class='recom-o2-date-age-selector'><option value='DateOption'>"+i18n.DATE+"</option>";
if(this.getPatientDOB()){dateAgeDropDown+="<option value='AgeOption'>"+i18n.AGE+"</option>";
}else{dateAgeDropDown+="<option value='AgeOption' disabled title='"+this.m_i18nStrings.DOB_NOT_DOCUMENTED+"'>"+i18n.AGE+"</option>";
}var dateSection=dateAgeDropDown+"</select><div class = 'recom-o2-modify-date-section'><input id='dateVal"+recomID+compID+"' type='text' size='10' class='"+dateClass+"' readonly='true' value = '"+dateTime.format(dateFormat.masks.shortdate4yr)+"'/><input type='button' id='dateValueButton"+recomID+compID+"' class='recom-o2-date-selector-button'/></div>";
var ageDropDown="<select id='ageOption"+recomID+compID+"' class = 'recom-o2-modify-age-drop-down'>";
for(var codeIndex=0;
codeIndex<codeSetLength;
codeIndex++){ageDropDown+="<option value='"+unitsCodes[codeIndex].FREQUENCY_CD+"' meaning='"+unitsCodes[codeIndex].FREQUENCY_MEANING+"'>"+unitsCodes[codeIndex].FREQUENCY_DISPLAY+"</option>";
}ageDropDown+="</select>";
var ageContentHtml="<div class = 'hidden'><input id='modifiedAgeValue"+recomID+compID+"' class='recom-o2-modify-age-value' type='text' maxlength='3' size='3' onpaste='return false'/>"+ageDropDown+"</div>";
var futureDateHtml="<div class='recom-o2-modify-future-date-message hidden'>"+this.m_i18nStrings.FUTURE_DATE_MESSAGE+"</div>";
var editSection="<div id = 'editDueDate"+compID+"'class = 'recom-o2-due-date-div-sp hidden'>"+dateSection+ageContentHtml+futureDateHtml+"</div>";
var dueDateFaceUp="<div id = 'dueDateDiv"+compID+"' class = 'recom-o2-modify-date-div'>"+dueLabel+changeDueDateDiv+editSection+"</div>";
var resetToDefaultAnchorTag="<a class='recom-o2-reset-to-default-link', href='javascript:void(0)'>"+this.m_i18nStrings.RESET_TO_DEFAULT+"</a>";
var resetToDefaultLabel="<span class='recom-o2-reset-to-default-span disabled'>"+this.m_i18nStrings.RESET_TO_DEFAULT+"</span>";
var resetToDefaultLink=this.enableResetToDefaultLink()?resetToDefaultAnchorTag:resetToDefaultLabel;
var frequencyDropDown=this.renderDropDownWithUnitsCodeSet("frequency",recomID,disabledPropertyForFrequency);
var frequencyContentHtml="<div id = 'modifyFreqDiv"+compID+"' class = 'recom-o2-modify-freq-section'><span class = 'recom-o2-modify-freq-label secondary-text'>"+frequencyLabel+"</span><div class='recom-o2-modify-freq-div'><input id='modifiedFrequencyValue"+recomID+compID+"' class='recom-o2-modify-freq-value' type='text' maxlength='3' size='3' onpaste='return false' value = '"+freqValue+"'"+disabledPropertyForFrequency+"/>"+frequencyDropDown+resetToDefaultLink+"</div></div>";
var reasonDropDown="<select class = 'recom-o2-modify-reason-drop-down'><option value='0'>&nbsp;--</option>";
var reasonCodeSet=this.getReasonCodeSet();
var reasonCodeSetLength=reasonCodeSet.length;
for(var reasonIndex=0;
reasonIndex<reasonCodeSetLength;
reasonIndex++){reasonDropDown+="<option value='"+reasonCodeSet[reasonIndex].REASON_CD+"'>&nbsp;"+reasonCodeSet[reasonIndex].REASON_DISPLAY+"</option>";
}reasonDropDown+="</select>";
var reasonHtml="<div class = 'recom-o2-modify-reason'><span class='recom-o2-modify-reason-label secondary-text'>"+i18n.REASON+"</span><br/>"+reasonDropDown+"</div>";
var providerName=" "+this.getCurrentProviderName();
var recordedForHtml="<div class = 'recom-o2-modify-recorded-for'><span class='secondary-text'>"+this.m_i18nStrings.RECORDED_FOR+"</span><br/><input class = 'recom-o2-provider-name' type = 'text' size = '"+providerName.length+"' readonly = 'true' value = '"+providerName+"'/></div>";
var reasonAndRecordedForHtml="<div class = 'recom-o2-modify-reason-recorded-for'>"+reasonHtml+recordedForHtml+"</div>";
var commentHtml="<div class = 'recom-o2-comment-section'><span class = 'secondary-text'>"+i18n.COMMENTS+"</span><br/><textarea id='modifyRecComment"+recomID+compID+"' class='recom-o2-comment-area' rows='3' maxlength='1000' placeholder='"+this.m_i18nStrings.ADD_A_COMMENT+"'></textarea></div>";
var modifyHtml="<div id='modifyContainer"+recomID+compID+"' class='recom-o2-modify-controls'>"+modifyFailedHtml+dueDateFaceUp+frequencyContentHtml+reasonAndRecordedForHtml+commentHtml+"</div>";
return"<div id=sidePanelScrollContainer"+compID+">"+modifyHtml+"</div>";
};
RecommendationsO2Component.prototype.addEventHandlersForModifyContainer=function(){var self=this;
var compID=this.getComponentId();
var recomID=this.m_modifyObject.RECOMMENDATION_ID;
var $modifyContainer=this.m_$sidePanelContainer.find("#modifyContainer"+recomID+compID);
var numbersOnly=function(evt){var charCode=evt.which?evt.which:evt.keyCode;
if(charCode>31&&(charCode<48||charCode>57)){return false;
}return true;
};
$modifyContainer.on("keypress",".recom-o2-modify-freq-value",numbersOnly);
$modifyContainer.on("keypress",".recom-o2-modify-age-value",numbersOnly);
var frequencyHandler=function(){switch($(this).attr("id")){case"modifiedFrequencyValue"+recomID+compID:self.m_modifyObject.NEW_FREQUENCY_VALUE=parseInt(this.value,10);
break;
case"frequencyOption"+recomID+compID:self.m_modifyObject.NEW_FREQUENCY_UNIT_CD=parseInt(this.value,10);
break;
}if(self.m_modifyObject.FREQUENCY_VALUE!==self.m_modifyObject.NEW_FREQUENCY_VALUE||self.m_modifyObject.FREQUENCY_UNIT_CD!==self.m_modifyObject.NEW_FREQUENCY_UNIT_CD){self.setFrequencyChangeIndicator(true);
if(self.getReasonOnFrequencyModification()){$modifyContainer.find(".recom-o2-modify-reason-label").addClass("recom-o2-modify-required-field");
}}else{self.setFrequencyChangeIndicator(false);
$modifyContainer.find(".recom-o2-modify-reason-label").removeClass("recom-o2-modify-required-field");
}self.enableOrDisableSaveButton();
};
$modifyContainer.on("keyup",".recom-o2-modify-freq-value",frequencyHandler);
$modifyContainer.on("change","#frequencyOption"+recomID+compID,frequencyHandler);
var ageHandler=function(){var $ageObject=$(this);
var $futureDateObject=$ageObject.closest("#editDueDate"+compID).find(".recom-o2-modify-future-date-message");
var currentDate=new Date();
var currentDateForComparision=new Date(currentDate.getFullYear(),currentDate.getMonth(),currentDate.getDate());
switch($ageObject.attr("id")){case"modifiedAgeValue"+recomID+compID:self.m_modifyObject.AGE_VALUE=parseInt(this.value,10);
break;
case"ageOption"+recomID+compID:self.m_modifyObject.AGE_UNIT_CD=parseInt(this.value,10);
self.m_modifyObject.AGE_UNIT_MEANING=$ageObject.find(":selected").attr("meaning");
break;
}if(isNaN(self.m_modifyObject.AGE_VALUE)){self.m_modifyObject.AGE_DUE_DT_TM=false;
if(!$futureDateObject.hasClass("hidden")){self.m_modifyObject.showFutureMsg=false;
$futureDateObject.addClass("hidden");
}}else{self.m_modifyObject.AGE_DUE_DT_TM=self.validateDueDateBasedOnAgeSelected(self.m_modifyObject.AGE_VALUE,self.m_modifyObject.AGE_UNIT_MEANING);
if(self.m_modifyObject.AGE_DUE_DT_TM&&self.m_modifyObject.AGE_DUE_DT_TM>currentDateForComparision){self.m_modifyObject.NEW_DUE_DT_TM=self.m_modifyObject.AGE_DUE_DT_TM;
if(!$futureDateObject.hasClass("hidden")){self.m_modifyObject.showFutureMsg=false;
$futureDateObject.addClass("hidden");
}}else{self.m_modifyObject.AGE_DUE_DT_TM=false;
self.m_modifyObject.showFutureMsg=true;
$futureDateObject.removeClass("hidden");
}}self.enableOrDisableSaveButton();
};
$modifyContainer.on("keyup","#modifiedAgeValue"+recomID+compID,ageHandler);
$modifyContainer.on("change","#ageOption"+recomID+compID,ageHandler);
$modifyContainer.on("change","#dateVal"+this.m_modifyObject.RECOMMENDATION_ID+compID,function(){self.m_modifyObject.DATE_PICKER_DUE_DT_TM=$(this).parent(".recom-o2-modify-date-section").find("#dateValueButton"+recomID+compID).datepicker("getDate");
self.m_modifyObject.NEW_DUE_DT_TM=self.m_modifyObject.DATE_PICKER_DUE_DT_TM;
$(this).removeClass("required-field-input");
self.enableOrDisableSaveButton();
});
$modifyContainer.on("click","#changeDueDateImage"+recomID+compID,function(){$(this).closest(".recom-o2-due-date-label-sp").addClass("hidden").next("#editDueDate"+compID).removeClass("hidden").siblings(".recom-o2-modify-due-label").addClass("recom-o2-modify-required-field");
if(self.getReasonOnDueDateModification()){$modifyContainer.find(".recom-o2-modify-reason-label").addClass("recom-o2-modify-required-field");
}self.setDueDateChangeIndicator(true);
self.enableOrDisableSaveButton();
});
$modifyContainer.on("change","#DateOrAgeSelector"+this.m_modifyObject.RECOMMENDATION_ID+compID,function(){var $dateAgeSelector=$(this);
var $futureDateMsg=$dateAgeSelector.closest("#editDueDate"+compID).find(".recom-o2-modify-future-date-message");
switch(this.value){case"DateOption":$dateAgeSelector.next().removeClass("hidden").addClass("recom-o2-modify-date-section").next().addClass("hidden").removeClass("recom-o2-modify-age-section");
if(!$futureDateMsg.hasClass("hidden")){$futureDateMsg.addClass("hidden");
}self.m_modifyObject.NEW_DUE_DT_TM=self.m_modifyObject.DATE_PICKER_DUE_DT_TM;
break;
case"AgeOption":$dateAgeSelector.next().removeClass("recom-o2-modify-date-section").addClass("hidden").next().addClass("recom-o2-modify-age-section").removeClass("hidden");
if(self.m_modifyObject.showFutureMsg){$futureDateMsg.removeClass("hidden");
}self.m_modifyObject.NEW_DUE_DT_TM=self.m_modifyObject.AGE_DUE_DT_TM;
break;
}self.enableOrDisableSaveButton();
});
$modifyContainer.on("click",".recom-o2-reset-to-default-link",function(){self.m_modifyObject.NEW_FREQUENCY_VALUE=self.m_modifyObject.PREV_FREQ_VALUE;
self.m_modifyObject.NEW_FREQUENCY_UNIT_CD=self.m_modifyObject.PREV_FREQ_UNIT_CD;
if(self.m_modifyObject.PREV_FREQ_VALUE===-1){$modifyContainer.find("#modifiedFrequencyValue"+recomID+compID).val("");
$modifyContainer.find("#frequencyOption"+recomID+compID).val("");
}else{$modifyContainer.find("#modifiedFrequencyValue"+recomID+compID).val(self.m_modifyObject.PREV_FREQ_VALUE);
$modifyContainer.find("#frequencyOption"+recomID+compID).val(self.m_modifyObject.PREV_FREQ_UNIT_CD);
}$modifyContainer.find(".recom-o2-modify-reason-drop-down").focus();
self.checkRequiredFieldsForResetToDefault();
self.setFrequencyChangeIndicator(true);
});
$modifyContainer.on("change",".recom-o2-modify-reason-drop-down",function(){self.m_modifyObject.REASON_CD=parseInt(this.value,10);
self.enableOrDisableSaveButton();
});
$modifyContainer.on("focusout","#modifyRecComment"+recomID+compID,function(){self.m_modifyObject.COMMENT_TEXT=this.value;
});
$modifyContainer.on("paste keyup change",".recom-o2-modify-rec-comment",function(){var maxLength=1000;
var currentCommentText=$(this).val();
if(currentCommentText.length>maxLength){$(this).val(currentCommentText.substring(0,maxLength));
}});
};
RecommendationsO2Component.prototype.isReasonMandatoryField=function(){if(this.getDueDateChangeIndicator()&&this.getReasonOnDueDateModification()){return true;
}if(this.getFrequencyChangeIndicator()&&this.getReasonOnFrequencyModification()){return true;
}return false;
};
RecommendationsO2Component.prototype.enableResetToDefaultLink=function(){if(this.m_modifyObject.GROUP_NAME===this.m_i18nStrings.FREETEXT){return false;
}var frequencyHistory=this.m_modifyObject.FREQUENCY_HISTORY;
var frequencyModificationCount=frequencyHistory.length;
if(frequencyModificationCount){this.m_modifyObject.PREV_FREQ_VALUE=frequencyHistory[frequencyModificationCount-1].PREV_FREQ_VALUE;
var frequencyCodeValues=this.getTimeUnitsCodeSet();
for(var i=frequencyCodeValues.length;
i--;
){if(frequencyCodeValues[i].FREQUENCY_DISPLAY===frequencyHistory[frequencyModificationCount-1].PREV_FREQ_UNIT_DISP){this.m_modifyObject.PREV_FREQ_UNIT_CD=frequencyCodeValues[i].FREQUENCY_CD;
break;
}}if(this.m_modifyObject.NEW_FREQUENCY_VALUE===null){return false;
}if(this.m_modifyObject.PREV_FREQ_VALUE!==this.m_modifyObject.NEW_FREQUENCY_VALUE||this.m_modifyObject.PREV_FREQ_UNIT_CD!==this.m_modifyObject.NEW_FREQUENCY_UNIT_CD){return true;
}}return false;
};
RecommendationsO2Component.prototype.checkRequiredFieldsForResetToDefault=function(){if(this.getDueDateChangeIndicator()){this.enableOrDisableSaveButton();
}else{this.m_$sidePanelContainer.find(".recom-o2-modify-reason-label").removeClass("recom-o2-modify-required-field");
this.m_$sidePanelContainer.find("#saveRecomButton"+this.m_modifyObject.RECOMMENDATION_ID+this.getComponentId()).removeClass("disabled");
}};
RecommendationsO2Component.prototype.enableOrDisableSaveButton=function(){var saveButton=this.m_$sidePanelContainer.find("#saveRecomButton"+this.m_modifyObject.RECOMMENDATION_ID+this.getComponentId());
if(this.areRequiredFieldsPopulated()){saveButton.removeClass("disabled");
}else{saveButton.addClass("disabled");
}};
RecommendationsO2Component.prototype.areRequiredFieldsPopulated=function(){var recomID=this.m_modifyObject.RECOMMENDATION_ID;
var compID=this.getComponentId();
var isDueDateModified=false;
var isFrequencyModified=false;
if(this.getDueDateChangeIndicator()){isDueDateModified=true;
switch(this.m_$sidePanelContainer.find("#DateOrAgeSelector"+recomID+compID).val()){case"DateOption":if(!this.m_modifyObject.DATE_PICKER_DUE_DT_TM){return false;
}break;
case"AgeOption":if(!this.m_modifyObject.AGE_DUE_DT_TM){return false;
}break;
}}if(this.getFrequencyChangeIndicator()){isFrequencyModified=true;
if(this.m_modifyObject.NEW_FREQUENCY_VALUE===-1){return true;
}if(isNaN(this.m_modifyObject.NEW_FREQUENCY_VALUE)||this.m_modifyObject.NEW_FREQUENCY_VALUE<=0){return false;
}}if(!isDueDateModified&&!isFrequencyModified){return false;
}if(this.isReasonMandatoryField()&&!this.m_modifyObject.REASON_CD){return false;
}return true;
};
RecommendationsO2Component.prototype.getDueDateActionObject=function(){return{RECOMMENDATION_ID:0,RESTORE_DEFAULT:0,NEW_DUE_DT_TM:"",ON_BEHALF_OF_PRSNL_ID:0,REASON_CD:0,COMMENT:"",PREV_DUE_DT_TM:"",PERSON_ID:0};
};
RecommendationsO2Component.prototype.getFrequencyActionObject=function(){return{RECOMMENDATION_ID:0,RESTORE_DEFAULT:0,FREQUENCY_VALUE:0,FREQUENCY_UNIT_CD:0,ON_BEHALF_OF_PRSNL_ID:0,REASON_CD:0,COMMENT:"",PREV_FREQUENCY_VALUE:0,PREV_FREQUENCY_UNIT_CD:0,DUE_DT_TM:"",PERSON_ID:0};
};
RecommendationsO2Component.prototype.getModifyExpectationsBlobIn=function(dueDateRequest,frequencyRequest){if(!dueDateRequest&&!frequencyRequest){throw new Error("Invalid parameters passed to getModifyExpectationsBlobIn function");
}var modifyExpectationRequest=this.getScriptRequestStructure(966325);
if(dueDateRequest&&dueDateRequest.length){modifyExpectationRequest.REQUESTIN.DUE_DATE_ACTIONS=dueDateRequest;
}if(frequencyRequest&&frequencyRequest.length){modifyExpectationRequest.REQUESTIN.FREQUENCY_ACTIONS=frequencyRequest;
}return this.getCriterion().is_utc===1?MP_Util.enhancedStringify(modifyExpectationRequest,0,0,1):MP_Util.enhancedStringify(modifyExpectationRequest);
};
RecommendationsO2Component.prototype.modifyExpectation=function(){var self=this;
var compID=self.getComponentId();
var recomID=self.m_modifyObject.RECOMMENDATION_ID;
var dueDateActions=[];
var frequencyActions=[];
var PCO_HM_REDIRECT_MODIFICATIONS={APPLICATION:966300,TASK:966320,REQUEST:966325};
var scriptRequest=new ScriptRequest();
if(this.getDueDateChangeIndicator()){var dueDateObj=this.getDueDateActionObject();
this.m_modifyObject.NEW_DUE_DT_TM.setHours(12);
this.m_modifyObject.NEW_DUE_DT_TM.setMinutes(0);
this.m_modifyObject.NEW_DUE_DT_TM.setSeconds(0);
if(this.getCriterion().is_utc){dueDateObj.NEW_DUE_DT_TM=JSON.stringify(this.m_modifyObject.NEW_DUE_DT_TM).replace(/"/g,"");
}else{dueDateObj.NEW_DUE_DT_TM=this.m_modifyObject.NEW_DUE_DT_TM.format(dateFormat.masks.isoDateTime);
}dueDateObj.PERSON_ID=this.getCriterion().person_id;
dueDateObj.ON_BEHALF_OF_PRSNL_ID=this.getCriterion().provider_id;
dueDateObj.RECOMMENDATION_ID=this.m_modifyObject.RECOMMENDATION_ID;
dueDateObj.REASON_CD=this.m_modifyObject.REASON_CD;
dueDateObj.COMMENT=this.m_modifyObject.COMMENT_TEXT;
dueDateActions.push(dueDateObj);
}if(this.getFrequencyChangeIndicator()){var frequencyObj=this.getFrequencyActionObject();
frequencyObj.PERSON_ID=this.getCriterion().person_id;
frequencyObj.ON_BEHALF_OF_PRSNL_ID=this.getCriterion().provider_id;
frequencyObj.RECOMMENDATION_ID=this.m_modifyObject.RECOMMENDATION_ID;
frequencyObj.FREQUENCY_VALUE=this.m_modifyObject.NEW_FREQUENCY_VALUE;
frequencyObj.FREQUENCY_UNIT_CD=this.m_modifyObject.NEW_FREQUENCY_UNIT_CD;
frequencyObj.REASON_CD=this.m_modifyObject.REASON_CD;
frequencyObj.COMMENT=this.m_modifyObject.COMMENT_TEXT;
frequencyObj.PREV_FREQUENCY_VALUE=this.m_modifyObject.FREQUENCY_VALUE;
frequencyObj.PREV_FREQUENCY_UNIT_CD=this.m_modifyObject.FREQUENCY_UNIT_CD;
frequencyActions.push(frequencyObj);
}scriptRequest.setProgramName("MP_EXEC_STD_REQUEST");
scriptRequest.setParameterArray(["^MINE^","^^",PCO_HM_REDIRECT_MODIFICATIONS.APPLICATION,PCO_HM_REDIRECT_MODIFICATIONS.TASK,PCO_HM_REDIRECT_MODIFICATIONS.REQUEST]);
scriptRequest.setDataBlob(this.getModifyExpectationsBlobIn(dueDateActions,frequencyActions));
scriptRequest.setResponseHandler(function(scriptReply){if(scriptReply.getStatus()==="S"){self.m_$sidePanelContainer.find("#modifyContainer"+recomID+compID).off();
self.m_modifyObject.saveSuccessful=true;
self.retrieveComponentData();
}else{var modifyFailedContainer=self.m_$sidePanelContainer.find(".recom-o2-sp-err-msg");
if(modifyFailedContainer.hasClass("hidden")){var saveErrorHTML=MP_Core.generateUserMessageHTML("error",self.m_i18nStrings.MODIFY_EXP_FAILED_TITLE,"","recom-o2-modify-failure");
modifyFailedContainer.empty().html(saveErrorHTML);
modifyFailedContainer.removeClass("hidden");
}self.m_$sidePanelContainer.find("#saveRecomButton"+recomID+compID).removeClass("disabled");
}});
this.m_$sidePanelContainer.find("#saveRecomButton"+recomID+compID).addClass("disabled");
scriptRequest.performRequest();
};
RecommendationsO2Component.prototype.adjustScrollBarPosition=function(deductFixedDivHeight){var graphHeight=0;
var compID=this.getComponentId();
if(deductFixedDivHeight){graphHeight=this.m_$sidePanelContainer.find("#"+compID+"rp-last-satisfied").height()+this.m_$sidePanelContainer.find("#"+compID+"graphWrapper").height()+20;
}this.m_sidePanel.expandSidePanel=function(){if(!this.m_sidePanelObj.hasClass("sp-focusin")){this.m_expCollapseBarObj.removeClass("hidden");
this.m_parentContainer.css({position:"absolute"});
this.m_sidePanelObj.addClass("sp-focusin");
this.m_expCollapseIconObj.addClass("sp-collapse").removeClass("sp-expand");
}this.m_previousMinHeight=this.m_minHeight;
var heightVal=parseInt(this.m_height,10);
var minHeightVal=parseInt(this.m_minHeight,10);
if(heightVal>minHeightVal){this.setMinHeight(this.m_height);
}this.m_scrollContainer.css("max-height","");
var titleHeight=null;
if(this.m_usingUpdatedPanel){var bodyContentHeight=this.m_sidePanelBodyContents[0].offsetHeight;
titleHeight=this.m_sidePanelContents.height()-bodyContentHeight;
}else{var contentHeight=this.m_sidePanelContents[0].offsetHeight;
titleHeight=contentHeight-this.m_scrollContainer.height();
}this.m_sidePanelObj.css({height:"auto"});
var scrollMaxHeight=(this.m_sidePanelObj.height()-titleHeight)+1;
if(graphHeight){scrollMaxHeight=scrollMaxHeight-graphHeight;
}this.m_scrollContainer.css("max-height",scrollMaxHeight+"px");
if(scrollMaxHeight===this.m_scrollContainer.height()){this.m_scrollContainer.addClass("sp-add-scroll");
}if(this.m_onExpandFunc){this.m_onExpandFunc();
}};
};
RecommendationsO2Component.prototype.createPopupHtml=function(data){if(typeof data!=="object"){throw new Error("Invalid parameter passed to createPopupHtml function");
}var popupHtml="<div class = 'recom-o2-satisfier-list'>";
var foundSatisfier=false;
var freeTextSatisfiers=this.getFreeTextSatisfiers();
var isFreeText=data.SERIES_ID===0?true:false;
if(isFreeText){if(freeTextSatisfiers.DONE_ELSEWHERE_PREF){popupHtml+="<div class = 'recom-o2-satisfier-item' data-action = 'free-text-satisfy'>"+freeTextSatisfiers.DONE_ELSEWHERE_LABEL+"</div>";
foundSatisfier=true;
}if(freeTextSatisfiers.REFUSE_PREF){popupHtml+="<div class = 'recom-o2-satisfier-item' data-action = 'free-text-refuse'>"+freeTextSatisfiers.REFUSE_LABEL+"</div>";
foundSatisfier=true;
}if(freeTextSatisfiers.CANCEL_PREF){popupHtml+="<div class = 'recom-o2-satisfier-item' data-action = 'free-text-cancel'>"+freeTextSatisfiers.CANCEL_LABEL+"</div>";
foundSatisfier=true;
}}else{for(var satisfierIndex=0;
satisfierIndex<data.SATISFIERS.length;
satisfierIndex++){switch(data.SATISFIERS[satisfierIndex].ENTRY_TYPE_MEANING.toUpperCase()){case"POSTPONE":case"REFUSE":case"EXPIRE":case"MANUAL":popupHtml+="<div id = '"+data.SATISFIERS[satisfierIndex].EXPECT_SAT_ID+"'class = 'recom-o2-satisfier-item' data-action = '"+data.SATISFIERS[satisfierIndex].ENTRY_TYPE_MEANING+"'>"+data.SATISFIERS[satisfierIndex].EXPECT_SAT_NAME+"</div>";
foundSatisfier=true;
break;
case"PROCEDURE":popupHtml+="<div id = '"+data.SATISFIERS[satisfierIndex].EXPECT_SAT_ID+"'class = 'recom-o2-satisfier-item' data-action = '"+data.SATISFIERS[satisfierIndex].ENTRY_TYPE_MEANING+"' data-proc-name = '"+data.SATISFIERS[satisfierIndex].PROCEDURE_NAME_DISPLAY+"' data-nomenclature-id = '"+data.SATISFIERS[satisfierIndex].ENTRY_ID+"'>"+data.SATISFIERS[satisfierIndex].EXPECT_SAT_NAME+"</div>";
foundSatisfier=true;
break;
}if(CERN_Platform.inMillenniumContext()){switch(data.SATISFIERS[satisfierIndex].ENTRY_TYPE_MEANING.toUpperCase()){case"POWERFORM":popupHtml+="<div id = '"+data.SATISFIERS[satisfierIndex].EXPECT_SAT_ID+"'class = 'recom-o2-satisfier-item' data-action = '"+data.SATISFIERS[satisfierIndex].ENTRY_TYPE_MEANING+"'>"+data.SATISFIERS[satisfierIndex].EXPECT_SAT_NAME+"</div>";
foundSatisfier=true;
break;
case"PRESCRIPTION":if(data.SATISFIERS[satisfierIndex].FILTER_IND===0){popupHtml+="<div id = '"+data.SATISFIERS[satisfierIndex].EXPECT_SAT_ID+"'class = 'recom-o2-satisfier-item' data-action = '"+data.SATISFIERS[satisfierIndex].ENTRY_TYPE_MEANING+"'>"+data.SATISFIERS[satisfierIndex].EXPECT_SAT_NAME+"</div>";
foundSatisfier=true;
}break;
case"ORDER":if(data.SATISFIERS[satisfierIndex].FILTER_IND===0){popupHtml+="<div id = '"+data.SATISFIERS[satisfierIndex].EXPECT_SAT_ID+"'class = 'recom-o2-satisfier-item' data-action = '"+data.SATISFIERS[satisfierIndex].ENTRY_TYPE_MEANING+"'>"+data.SATISFIERS[satisfierIndex].EXPECT_SAT_NAME+"</div>";
foundSatisfier=true;
}break;
default:}}}}popupHtml+="</div>";
return foundSatisfier?popupHtml:"";
};
RecommendationsO2Component.prototype.attachPopupToActionsButton=function(popupHtml){if(typeof popupHtml!=="string"){throw new Error("Invalid parameter passed to attachPopupToActionsButton function");
}var popup=new MPageUI.Popup();
this.setPopupObject(popup);
popup.setBodyContent(popupHtml);
popup.setPosition(MPageUI.POPUP_OPTIONS.POSITION.BOTTOM_RIGHT);
popup.setAnchorId("actionsRecomButton"+this.getComponentId());
};
RecommendationsO2Component.prototype.attachPopupHandler=function(dataObject){if(typeof dataObject!=="object"){throw new Error("Invalid parameter passed to attachPopupHandler function");
}var self=this;
if(this.getPopupObject().isOpen()){$(".recom-o2-satisfier-list").on("click",".recom-o2-satisfier-item",function(){if(!self.m_isSidePanelLoading){var selectedSatisfier=$(this);
var satisfierID=0;
var actionMeaning=selectedSatisfier.attr("data-action");
var isFreeText=dataObject.SERIES_ID===0?true:false;
if(isFreeText){switch(actionMeaning){case"free-text-satisfy":actionMeaning="MANUAL";
break;
case"free-text-refuse":actionMeaning="REFUSE";
break;
case"free-text-cancel":actionMeaning="EXPIRE";
break;
}}else{satisfierID=parseInt(selectedSatisfier.attr("id"),10);
}var modifierTypeCd=self.getModifierTypeCd(actionMeaning);
if(actionMeaning==="POWERFORM"||actionMeaning==="ORDER"||actionMeaning==="PRESCRIPTION"){self.getPopupObject().hide();
self.systemSatisfierHandler(actionMeaning,dataObject,satisfierID);
}else{if(actionMeaning==="PROCEDURE"){self.setAddProcedureName(selectedSatisfier.attr("data-proc-name"));
self.setNomenclatureId(parseInt(selectedSatisfier.attr("data-nomenclature-id"),10));
self.getPopupObject().hide();
self.systemSatisfierHandler(actionMeaning,dataObject,satisfierID);
}else{var manualActionObject={EXPECT_MOD_ID:0,PERSON_ID:self.getCriterion().person_id,SERIES_ID:dataObject.SERIES_ID,EXPECTATION_ID:dataObject.EXPECT_ID,STEP_ID:dataObject.STEP_ID,SAT_PRSNL_ID:self.getCriterion().provider_id,MODIFIER_TYPE_CD:modifierTypeCd,MODIFIER_REASON_CD:0,MODIFIER_DT_TM:new Date(),STATUS_IND:1,LONG_TEXT_ID:0,COMMENT:"",ORGANIZATION_ID:dataObject.ORGANIZATION_ID,EXPECT_SAT_ID:satisfierID,RECOMMENDATION_ID:dataObject.RECOMMENDATION_ID,FORCE_INSERT_IND:0,RECOMMENDATION_ACTION_ID:0,DUE_DATE_UTC:dataObject.DUE_DATE_UTC,useFutureDate:false};
self.setActionObject(manualActionObject);
var detailFlag=0;
if(isFreeText){detailFlag=1;
}else{if(!self.getCurrentProviderName().length||!self.getReasonCodeSet().length||!self.getTimeUnitsCodeSet().length){detailFlag=3;
}else{detailFlag=2;
}}self.getPopupObject().hide();
self.m_sidePanel.setContents("<div class = 'recom-o2-modify-pre-loader'></div>");
self.m_isSidePanelLoading=true;
var recommendationsDataRequest=new ScriptRequest();
recommendationsDataRequest.setProgramName("mp_get_data_add_expectation");
recommendationsDataRequest.setParameterArray(["^MINE^",self.getCriterion().provider_id+".0",detailFlag,satisfierID]);
recommendationsDataRequest.setResponseHandler(function(replyObj){if(detailFlag===3||detailFlag===1){self.saveCodeSetData(replyObj);
}self.renderManualSatisfy(replyObj,actionMeaning,isFreeText);
self.addEventHandlersForManualSatisfy();
self.m_sidePanel.expandSidePanel();
self.m_sidePanel.m_cornerCloseButton.hide();
self.m_isSidePanelLoading=false;
});
recommendationsDataRequest.performRequest();
}}}});
}else{$(".recom-o2-satisfier-list").off();
}};
RecommendationsO2Component.prototype.getModifierTypeCd=function(actionMeaning){if(typeof actionMeaning!=="string"){throw new Error("Invalid action meaning passed to getModifierTypeCd function");
}if(actionMeaning==="MANUAL"){actionMeaning="SATISFY";
}var modifierTypeCd=0;
var modifierTypes=this.getModifierTypesAndReasons().MODIFIER_TYPES;
for(var i=modifierTypes.length;
i--;
){if(modifierTypes[i].MODIFIER_TYPE_MEANING===actionMeaning){modifierTypeCd=modifierTypes[i].MODIFIER_TYPE_CD;
break;
}}return modifierTypeCd;
};
RecommendationsO2Component.prototype.renderManualSatisfy=function(replyObj,manualAction,isFreeText){if(typeof replyObj!=="object"||typeof manualAction!=="string"||typeof isFreeText!=="boolean"){throw new Error("Invalid parameter passed to renderManualSatisfy function");
}var actionObject=this.getActionObject();
var recomID=actionObject.RECOMMENDATION_ID;
var compID=this.getComponentId();
var disabledSaveButton="";
var dueDate=new Date();
var currentDateForComparison=new Date(dueDate.getFullYear(),dueDate.getMonth(),dueDate.getDate());
dueDate.setISO8601(actionObject.DUE_DATE_UTC);
var dueDateForComparison=new Date(dueDate.getFullYear(),dueDate.getMonth(),dueDate.getDate());
if(dueDateForComparison>currentDateForComparison){actionObject.useFutureDate=true;
}switch(manualAction){case"POSTPONE":this.m_currentAction=this.RECOMMENDATION_ACTION.POSTPONE;
disabledSaveButton=actionObject.useFutureDate?"":"disabled";
break;
case"REFUSE":this.m_currentAction=this.RECOMMENDATION_ACTION.REFUSE;
break;
case"EXPIRE":this.m_currentAction=this.RECOMMENDATION_ACTION.EXPIRE;
break;
case"MANUAL":this.m_currentAction=this.RECOMMENDATION_ACTION.MANUAL_SATISFY;
break;
}var saveAndCancelButtonHTML="<div id='recommendationsSPSatisfy"+compID+"' class='recom-o2-sp-actions'><div class='sp-button2 recom-o2-cancel-button' id='cancelButton"+recomID+compID+"'>"+i18n.CANCEL+"</div><div class='sp-button2 recom-o2-save-button "+disabledSaveButton+"' id='saveRecomButton"+recomID+compID+"'>"+i18n.SAVE+"</div></div>";
this.m_sidePanel.setContents(this.createSatisfyHtml(replyObj.getResponse()),"recom-o2"+compID,isFreeText);
switch(manualAction){case"POSTPONE":if(actionObject.useFutureDate){this.attachDatePicker(recomID,"actionContainer",false,dueDate);
}else{this.attachDatePicker(recomID,"actionContainer",false,new Date());
}break;
case"MANUAL":this.attachDatePicker(recomID,"actionContainer",true,new Date());
break;
}this.m_sidePanel.setActionsAsHTML(saveAndCancelButtonHTML);
this.adjustScrollBarPosition(false);
};
RecommendationsO2Component.prototype.createSatisfyHtml=function(responseObject,isFreeText){if(typeof responseObject!=="object"){throw new Error("Invalid parameter passed to createSatisfyHtml");
}var actionObject=this.getActionObject();
var recomID=actionObject.RECOMMENDATION_ID;
var compID=this.getComponentId();
var providerName=" "+this.getCurrentProviderName();
var actionReasons=this.getModifierTypesAndReasons();
var dateTime=new Date();
var dateClass="recom-o2-postpone-date-value recom-o2-common-style disabled";
var contentHtml="";
var reasonIndex=0;
if(actionObject.useFutureDate){dateTime.setISO8601(actionObject.DUE_DATE_UTC);
}else{dateClass+=" required-field-input";
}var expireReasons=actionReasons.EXPIRE_REASONS;
var postponeReasons=actionReasons.POSTPONE_REASONS;
var refuseReasons=actionReasons.REFUSE_REASONS;
var satisfyReasons=actionReasons.SATISFY_REASONS;
if(!isFreeText&&responseObject.SATISFY_REASONS.length){expireReasons=responseObject.SATISFY_REASONS;
postponeReasons=responseObject.SATISFY_REASONS;
refuseReasons=responseObject.SATISFY_REASONS;
satisfyReasons=responseObject.SATISFY_REASONS;
}var actionFailedHtml="<div class = 'recom-o2-sp-err-msg hidden'></div>";
switch(this.m_currentAction){case this.RECOMMENDATION_ACTION.EXPIRE:contentHtml="<span class = 'secondary-text'>"+this.m_i18nStrings.REASON_FOR_CANCEL+"</span></br><select class = 'recom-o2-satisfy-reasons recom-o2-common-style'><option value = '0'>&nbsp;--</option>";
for(reasonIndex=0;
reasonIndex<expireReasons.length;
reasonIndex++){contentHtml+="<option value = '"+expireReasons[reasonIndex].REASON_CD+"'>"+expireReasons[reasonIndex].REASON_DISPLAY+"</option>";
}contentHtml+="</select>";
break;
case this.RECOMMENDATION_ACTION.POSTPONE:contentHtml="<span class = 'recom-o2-modify-required-field secondary-text'>"+this.m_i18nStrings.POSTPONE_UNTIL+"</span>";
contentHtml+="<div class = 'recom-o2-postpone-ui'><div class = 'recom-o2-postpone-date-range'>";
contentHtml+="<label class = 'recom-o2-radio-button-text'><input id = ''rangeRadioButton"+recomID+compID+"' type='radio' name= 'RangeOrDateSelector' class= 'recom-o2-postpone-radio-button' value='range' checked />"+this.m_i18nStrings.POSTPONE+"</label><input id='postponeRangeValue"+recomID+compID+"' class='recom-o2-common-style recom-o2-postpone-range-value' type='text' maxlength='3' size='3' onpaste='return false' />"+this.renderDropDownWithUnitsCodeSet("postpone",recomID,"");
contentHtml+="<div class = 'recom-o2-postpone-date'><label class = 'recom-o2-radio-button-text'><input id = 'dateRadioButton"+recomID+compID+"' type='radio' name= 'RangeOrDateSelector' class= 'recom-o2-postpone-radio-button' value='date'/>"+i18n.DATE+"</label><input id='dateVal"+recomID+compID+"' type='text' size='10' class='"+dateClass+"' readonly='true' value = '"+dateTime.format(dateFormat.masks.shortDate2)+"'/><input type='button' id='dateValueButton"+recomID+compID+"' class='recom-o2-date-selector-button disabled'/></div></div>";
contentHtml+="<div class = 'recom-o2-postpone-reason'><span class = 'secondary-text'>"+this.m_i18nStrings.REASON+"</span></br><select class = 'recom-o2-satisfy-reasons recom-o2-common-style'><option value = '0'>&nbsp;--</option>";
for(reasonIndex=0;
reasonIndex<postponeReasons.length;
reasonIndex++){contentHtml+="<option value = '"+postponeReasons[reasonIndex].REASON_CD+"'>"+postponeReasons[reasonIndex].REASON_DISPLAY+"</option>";
}contentHtml+="</select></div>";
break;
case this.RECOMMENDATION_ACTION.REFUSE:contentHtml="<span class = 'secondary-text'>"+this.m_i18nStrings.REASON_FOR_REFUSAL+"</span></br><select class = 'recom-o2-satisfy-reasons recom-o2-common-style'><option value = '0'>&nbsp;--</option>";
for(reasonIndex=0;
reasonIndex<refuseReasons.length;
reasonIndex++){contentHtml+="<option value = '"+refuseReasons[reasonIndex].REASON_CD+"'>"+refuseReasons[reasonIndex].REASON_DISPLAY+"</option>";
}contentHtml+="</select>";
break;
case this.RECOMMENDATION_ACTION.MANUAL_SATISFY:contentHtml="<span class = 'recom-o2-modify-required-field secondary-text'>"+this.m_i18nStrings.SATISFY_DATE+"</span>";
contentHtml+="<div class = 'recom-o2-satisfy-action'><div class = 'recom-o2-satisfy-date-range'>";
contentHtml+="<input id='dateVal"+recomID+compID+"' type='text' size='10' class='recom-o2-satisfy-date-value recom-o2-common-style' readonly='true' value = '"+dateTime.format(dateFormat.masks.shortDate2)+"'/><input type='button' id='dateValueButton"+recomID+compID+"' class='recom-o2-date-selector-button disabled'/></div>";
contentHtml+="<div class = 'recom-o2-postpone-reason'><span class = 'secondary-text'>"+this.m_i18nStrings.REASON+"</span></br><select class = 'recom-o2-satisfy-reasons recom-o2-common-style'><option value = '0'>&nbsp;--</option>";
for(reasonIndex=0;
reasonIndex<satisfyReasons.length;
reasonIndex++){contentHtml+="<option value = '"+satisfyReasons[reasonIndex].REASON_CD+"'>"+satisfyReasons[reasonIndex].REASON_DISPLAY+"</option>";
}contentHtml+="</select></div>";
break;
}var recordedForHtml="<div class = 'recom-o2-action-recorded-for'><span class='secondary-text'>"+this.m_i18nStrings.RECORDED_FOR+"</span><br/><input class = 'recom-o2-provider-name' type = 'text' size = '"+providerName.length+"' readonly = 'true' value = '"+providerName+"'/></div>";
var commentHtml="<div class = 'recom-o2-comment-section'><span class = 'secondary-text'>"+i18n.COMMENTS+"</span><br/><textarea id='actionComment"+recomID+compID+"' class='recom-o2-satisfy-comment-area' rows='3' maxlength='1000' placeholder='"+this.m_i18nStrings.ADD_A_COMMENT+"'></textarea></div>";
contentHtml+=recordedForHtml+commentHtml;
if(this.m_currentAction===this.RECOMMENDATION_ACTION.POSTPONE||this.m_currentAction===this.RECOMMENDATION_ACTION.MANUAL_SATISFY){contentHtml+="</div>";
}var actionHtml="<div id=sidePanelScrollContainer"+compID+"><div id='actionContainer"+recomID+compID+"' class='recom-o2-action-controls'>"+actionFailedHtml+contentHtml+"</div></div>";
return actionHtml;
};
RecommendationsO2Component.prototype.addEventHandlersForManualSatisfy=function(){var self=this;
var recomID=this.getActionObject().RECOMMENDATION_ID;
var compID=this.getComponentId();
var $actionContainer=this.m_$sidePanelContainer.find("#actionContainer"+recomID+compID);
var numbersOnly=function(evt){var charCode=evt.which?evt.which:evt.keyCode;
if(charCode>31&&(charCode<48||charCode>57)){return false;
}return true;
};
$actionContainer.on("keypress",".recom-o2-postpone-range-value",numbersOnly);
var postponeRangeHandler=function(){var currentField=$(this);
var actionObject=self.getActionObject();
var saveButton=self.m_$sidePanelContainer.find("#saveRecomButton"+recomID+compID);
var dateValueButton=self.m_$sidePanelContainer.find("#dateValueButton"+recomID+compID);
var dateInputBox=self.m_$sidePanelContainer.find("#dateVal"+recomID+compID);
var postponeValue=0;
var postponeUnit="";
var postponeByInMilliSeconds=0;
var dueDate=new Date();
var ONE_DAY_IN_MILLISECONDS=86400000;
var ONE_WEEK_IN_DAYS=7;
var ONE_MONTH_IN_DAYS=30;
var ONE_YEAR_IN_DAYS=365;
if(actionObject.useFutureDate){dueDate.setISO8601(actionObject.DUE_DATE_UTC);
}switch(currentField.attr("id")){case"postponeRangeValue"+recomID+compID:postponeValue=parseInt(currentField.val(),10);
postponeUnit=currentField.next("#postponeOption"+recomID+compID).find("option:selected").attr("meaning");
break;
case"postponeOption"+recomID+compID:postponeValue=parseInt(currentField.prev("#postponeRangeValue"+recomID+compID).val(),10);
postponeUnit=currentField.find("option:selected").attr("meaning");
break;
}if(isNaN(postponeValue)){postponeByInMilliSeconds=0;
}else{switch(postponeUnit){case"DAYS":postponeByInMilliSeconds=postponeValue*ONE_DAY_IN_MILLISECONDS;
break;
case"WEEKS":postponeByInMilliSeconds=postponeValue*ONE_WEEK_IN_DAYS*ONE_DAY_IN_MILLISECONDS;
break;
case"MONTHS":postponeByInMilliSeconds=postponeValue*ONE_MONTH_IN_DAYS*ONE_DAY_IN_MILLISECONDS;
break;
case"YEARS":postponeByInMilliSeconds=postponeValue*ONE_YEAR_IN_DAYS*ONE_DAY_IN_MILLISECONDS;
break;
}}dueDate.setTime(dueDate.getTime()+postponeByInMilliSeconds);
dateValueButton.datepicker("setDate",dueDate);
actionObject.MODIFIER_DT_TM=dateValueButton.datepicker("getDate");
if(self.isCurrentDate(actionObject.MODIFIER_DT_TM)){if(!saveButton.hasClass("disabled")){saveButton.addClass("disabled");
if(!dateInputBox.hasClass("required-field-input")){dateInputBox.addClass("required-field-input");
}}}else{saveButton.removeClass("disabled");
dateInputBox.removeClass("required-field-input");
}};
$actionContainer.on("keyup","#postponeRangeValue"+recomID+compID,postponeRangeHandler);
$actionContainer.on("change","#postponeOption"+recomID+compID,postponeRangeHandler);
var postponeDateHandler=function(){var actionObject=self.getActionObject();
var saveButton=self.m_$sidePanelContainer.find("#saveRecomButton"+recomID+compID);
var dateInputBox=$(this);
actionObject.MODIFIER_DT_TM=self.m_$sidePanelContainer.find("#dateValueButton"+recomID+compID).datepicker("getDate");
if(self.isCurrentDate(actionObject.MODIFIER_DT_TM)){if(!saveButton.hasClass("disabled")){saveButton.addClass("disabled");
if(!dateInputBox.hasClass("required-field-input")){dateInputBox.addClass("required-field-input");
}}}else{saveButton.removeClass("disabled");
dateInputBox.removeClass("required-field-input");
}};
$actionContainer.on("change","#dateVal"+recomID+compID,postponeDateHandler);
var radioButtonHandler=function(){switch(this.value){case"range":self.m_$sidePanelContainer.find("#dateVal"+recomID+compID).addClass("disabled");
$(this).parent().next("#postponeRangeValue"+recomID+compID).removeAttr("disabled").trigger("keyup").next("#postponeOption"+recomID+compID).removeAttr("disabled");
break;
case"date":self.m_$sidePanelContainer.find("#postponeRangeValue"+recomID+compID).attr("disabled","true").next("#postponeOption"+recomID+compID).attr("disabled","true");
$(this).parent().next("#dateVal"+recomID+compID).removeClass("disabled");
break;
}};
$actionContainer.on("click",".recom-o2-postpone-radio-button",radioButtonHandler);
$actionContainer.on("change",".recom-o2-satisfy-reasons",function(){self.getActionObject().MODIFIER_REASON_CD=parseInt(this.value,10);
});
$actionContainer.on("focusout","#actionComment"+recomID+compID,function(){self.getActionObject().COMMENT=this.value;
});
$actionContainer.on("paste keyup change","#actionComment"+recomID+compID,function(){var maxLength=1000;
var currentCommentText=$(this).val();
if(currentCommentText.length>maxLength){$(this).val(currentCommentText.substring(0,maxLength));
}});
$actionContainer.on("change",".recom-o2-postpone-date-value",function(){self.m_$sidePanelContainer.find("#dateRadioButton"+recomID+compID).attr("checked",true);
});
};
RecommendationsO2Component.prototype.isCurrentDate=function(dateObject){var currentDate=new Date();
if(typeof dateObject!=="object"){throw new Error("Invalid date parameter sent to isCurrentDate function");
}if(dateObject.getDate()===currentDate.getDate()&&dateObject.getMonth()===currentDate.getMonth()&&dateObject.getFullYear()===currentDate.getFullYear()){return true;
}else{return false;
}};
RecommendationsO2Component.prototype.satisfyExpectation=function(){var self=this;
var compID=self.getComponentId();
var actionObject=self.getActionObject();
var recomID=actionObject.RECOMMENDATION_ID;
var scriptRequest=new ScriptRequest();
var PCO_HM_ENS_RECOMMENDATION={APPLICATION:966300,TASK:966320,REQUEST:966321};
scriptRequest.setProgramName("MP_EXEC_STD_REQUEST");
scriptRequest.setParameterArray(["^MINE^","^^",PCO_HM_ENS_RECOMMENDATION.APPLICATION,PCO_HM_ENS_RECOMMENDATION.TASK,PCO_HM_ENS_RECOMMENDATION.REQUEST]);
scriptRequest.setDataBlob(this.getRecommendationActionBlobIn());
scriptRequest.setResponseHandler(function(scriptReply){if(scriptReply.getStatus()==="S"){self.m_$sidePanelContainer.find("#actionContainer"+recomID+compID).off();
self.getActionObject().saveSuccessful=true;
self.retrieveComponentData();
}else{var modifyFailedContainer=self.m_$sidePanelContainer.find(".recom-o2-sp-err-msg");
if(modifyFailedContainer.hasClass("hidden")){var saveErrorHTML=MP_Core.generateUserMessageHTML("error",self.m_i18nStrings.SATISFY_FAILED_TEXT,"","recom-o2-modify-failure");
modifyFailedContainer.empty().html(saveErrorHTML);
modifyFailedContainer.removeClass("hidden");
}self.m_$sidePanelContainer.find("#saveRecomButton"+recomID+compID).removeClass("disabled");
}});
this.m_$sidePanelContainer.find("#saveRecomButton"+recomID+compID).addClass("disabled");
scriptRequest.performRequest();
};
RecommendationsO2Component.prototype.getRecommendationActionBlobIn=function(){var recomActionRequest=this.getScriptRequestStructure(966321);
var actionObject=this.getActionObject();
actionObject.MODIFIER_DT_TM.setHours(12);
actionObject.MODIFIER_DT_TM.setMinutes(0);
actionObject.MODIFIER_DT_TM.setSeconds(0);
delete actionObject.DUE_DATE_UTC;
delete actionObject.useFutureDate;
delete actionObject.CURRENT_STATUS_FLAG;
delete actionObject.LAST_SATISFIED_DATE;
delete actionObject.APPROX_NEXT_DUE_DATE;
recomActionRequest.REQUESTIN.QUAL.push(actionObject);
recomActionRequest.REQUESTIN.ALLOW_RECOMMENDATION_SERVER_IND=1;
return this.getCriterion().is_utc?MP_Util.enhancedStringify(recomActionRequest,0,0,1):MP_Util.enhancedStringify(recomActionRequest);
};
RecommendationsO2Component.prototype.addEventHandlersForClinicalNoteLinkInSidePanel=function(){var component=this;
this.m_$sidePanelContainer.on("click",".recom-o2-clinical-link",function(){var clinicalNoteObj=$(this);
var clinicalEventId=parseInt(clinicalNoteObj.attr("data-clinical-event-id"),10);
MPAGES_EVENT("CLINICALNOTE",component.getCriterion().person_id+"|"+component.getCriterion().encntr_id+"|["+clinicalEventId+"]|Clinical Notes|15||||");
});
};
RecommendationsO2Component.prototype.addEventHandlersForUndoActionInSidePanel=function(data){var component=this;
this.m_$sidePanelContainer.on("click",".recom-o2-history-item-undo-option",function(){var actionItemObj=$(this);
var modifierID=parseInt(actionItemObj.attr("data-modifier-id"),10);
var commentText=actionItemObj.attr("data-comment-text");
var reasonText=actionItemObj.attr("data-reason-text");
var providerName=actionItemObj.attr("data-providername-text");
var modifierTypeCd=parseInt(actionItemObj.attr("data-modifier-type-cd"),10);
var recommendationActionId=parseInt(actionItemObj.attr("data-action-id"),10);
var actionOrgId=parseInt(actionItemObj.attr("data-org-id"),10);
var currentStatusFlag=parseInt(actionItemObj.attr("data-status-flag"),10);
var approximateNextDueDate=actionItemObj.attr("data-next-due-date");
var lastSatisfiedDateString=actionItemObj.closest(".recom-o2-rp-history").attr("data-last-satisfied-date");
var manualActionObject={EXPECT_MOD_ID:modifierID,PERSON_ID:component.getCriterion().person_id,SERIES_ID:data.SERIES_ID,EXPECTATION_ID:0,STEP_ID:0,SAT_PRSNL_ID:component.getCriterion().provider_id,MODIFIER_TYPE_CD:modifierTypeCd,MODIFIER_REASON_CD:0,MODIFIER_DT_TM:new Date(),STATUS_IND:0,LONG_TEXT_ID:0,COMMENT:commentText,ORGANIZATION_ID:actionOrgId,EXPECT_SAT_ID:0,RECOMMENDATION_ID:data.RECOMMENDATION_ID,FORCE_INSERT_IND:0,RECOMMENDATION_ACTION_ID:recommendationActionId,CURRENT_STATUS_FLAG:currentStatusFlag,LAST_SATISFIED_DATE:lastSatisfiedDateString,APPROX_NEXT_DUE_DATE:approximateNextDueDate,REASON_TEXT:reasonText,PROVIDER_NAME:providerName};
component.setActionObject(manualActionObject);
component.setCurrentActionType(component.RECOMMENDATION_ACTION.UNDO);
component.handleUndoAction();
});
};
RecommendationsO2Component.prototype.handleUndoAction=function(){var component=this;
var isAddDataAvailable=true;
var isUndoDataAvailable=true;
var detailedDataParameter=0;
if(!component.getCurrentProviderName().length||!component.getReasonCodeSet().length||!component.getTimeUnitsCodeSet().length){isAddDataAvailable=false;
detailedDataParameter=detailedDataParameter|1;
}if(!component.getUndoReasonCodeSet().length){isUndoDataAvailable=false;
detailedDataParameter=detailedDataParameter|4;
}if(!isAddDataAvailable||!isUndoDataAvailable){component.m_sidePanel.setContents("<div class = 'recom-o2-modify-pre-loader'></div>");
component.m_isSidePanelLoading=true;
var recommendationsDataRequest=new ScriptRequest();
recommendationsDataRequest.setProgramName("mp_get_data_add_expectation");
recommendationsDataRequest.setParameterArray(["^MINE^",component.getCriterion().provider_id+".0",detailedDataParameter]);
recommendationsDataRequest.setResponseHandler(function(replyObj){if(!isAddDataAvailable){component.saveCodeSetData(replyObj);
}if(!isUndoDataAvailable){if(replyObj.getStatus()==="S"){var undoDataRequired=replyObj.getResponse();
component.setUndoReasonCodeSet(undoDataRequired.UNDO_REASONS);
}}component.renderUndoActionContentInSidePanel();
component.addEventHandlersForUndoFields();
component.m_sidePanel.expandSidePanel();
component.m_sidePanel.m_cornerCloseButton.hide();
component.m_isSidePanelLoading=false;
});
recommendationsDataRequest.performRequest();
}else{component.renderUndoActionContentInSidePanel();
component.addEventHandlersForUndoFields();
component.m_sidePanel.expandSidePanel();
component.m_sidePanel.m_cornerCloseButton.hide();
component.m_isSidePanelLoading=false;
}};
RecommendationsO2Component.prototype.renderUndoActionContentInSidePanel=function(){var componentID=this.m_componentId;
var recomID=this.getActionObject().RECOMMENDATION_ID;
var saveAndCancelButtonHTML="<div id='recommendationsSPUndoAction"+componentID+"' class='recom-o2-sp-actions'><div class='sp-button2 recom-o2-cancel-button' id='cancelButton"+recomID+componentID+"'>"+i18n.CANCEL+"</div><div class='sp-button2 recom-o2-save-button' id='saveRecomButton"+recomID+componentID+"'>"+i18n.SAVE+"</div></div>";
this.m_sidePanel.setContents(this.createUndoFormFieldsHtml(),"recom-o2"+componentID);
this.m_sidePanel.setActionsAsHTML(saveAndCancelButtonHTML);
this.adjustScrollBarPosition(false);
};
RecommendationsO2Component.prototype.createUndoFormFieldsHtml=function(){var componentId=this.m_componentId;
var recomi18n=i18n.discernabu.recommendations_o2;
var currentActionItem=this.getActionObject();
var recomID=currentActionItem.RECOMMENDATION_ID;
var undoFieldsContentHtml="";
var providerName=this.getCurrentProviderName()||"--";
var undoReasons=this.getUndoReasonCodeSet();
var undoLabel=this.m_i18nStrings.UNDO;
var statusFlag=this.getActionDescription(currentActionItem.CURRENT_STATUS_FLAG,false);
var nextDueDateLabel=this.m_i18nStrings.UNTIL+"&nbsp;"+currentActionItem.APPROX_NEXT_DUE_DATE;
var undoActionFailedHtml="<div class = 'recom-o2-sp-err-msg hidden'></div>";
var undoTitleLabelHtml="<div class = 'recom-o2-undo-title'>"+undoLabel+"</div><div class = 'recom-o2-satisfier-action-info'><div class = 'recom-o2-status-flag-display'>"+statusFlag+"</div><div class = 'recom-o2-history-item-reason-info secondary-text'>"+nextDueDateLabel+"&nbsp;("+currentActionItem.REASON_TEXT+")</div><div class = 'recom-o2-history-item-comment-info'><span class = 'secondary-text'>"+recomi18n.COMMENT+":&nbsp;</span>"+currentActionItem.COMMENT+"</div><div class = 'recom-o2-history-item-provider-info'><span class = 'secondary-text'>"+recomi18n.RECORDED_FOR+":&nbsp;</span>"+currentActionItem.PROVIDER_NAME+"</div></br></div>";
undoFieldsContentHtml=undoTitleLabelHtml+"<span class = 'secondary-text'>"+this.m_i18nStrings.REASON_FOR_UNDO+"</span></br><select class = 'recom-o2-undo-reasons recom-o2-common-style'><option value = '0'>&nbsp;--</option>";
for(var reasonIndex=0,reasonsLength=undoReasons.length;
reasonIndex<reasonsLength;
reasonIndex++){undoFieldsContentHtml+="<option value = '"+undoReasons[reasonIndex].REASON_CD+"'>"+undoReasons[reasonIndex].REASON_DISPLAY+"</option>";
}undoFieldsContentHtml+="</select>";
var recordedForHtml="<div class = 'recom-o2-action-recorded-for'><span class='secondary-text'>"+this.m_i18nStrings.RECORDED_FOR+"</span><br/><span class = 'recom-o2-undo-provider-name'>"+providerName+"</span></div>";
var commentHtml="<div class = 'recom-o2-comment-section'><span class = 'secondary-text'>"+i18n.COMMENTS+"</span><br/><textarea id='undoActionComment"+recomID+componentId+"' class='recom-o2-undo-comment-area' rows='3' maxlength='1000' placeholder='"+this.m_i18nStrings.ADD_A_COMMENT+"'></textarea></div>";
undoFieldsContentHtml+=recordedForHtml+commentHtml;
var undoFieldsHtml="<div id=sidePanelScrollContainer"+componentId+"><div id='undoActionContainer"+recomID+componentId+"' class='recom-o2-action-controls'>"+undoActionFailedHtml+undoFieldsContentHtml+"</div></div>";
return undoFieldsHtml;
};
RecommendationsO2Component.prototype.addEventHandlersForUndoFields=function(){var component=this;
var recomID=this.getActionObject().RECOMMENDATION_ID;
var componentID=this.m_componentId;
var undoActionContainer=this.m_$sidePanelContainer.find("#undoActionContainer"+recomID+componentID);
undoActionContainer.on("change",".recom-o2-undo-reasons",function(){var reasonSelected=$(this).find("option:selected").val();
component.getActionObject().MODIFIER_REASON_CD=parseInt(reasonSelected,10);
});
undoActionContainer.on("focusout","#undoActionComment"+recomID+componentID,function(){component.getActionObject().COMMENT=$(this).val();
});
undoActionContainer.on("paste keyup change","#undoActionComment"+recomID+componentID,function(){var maxLength=1000;
var currentCommentText=$(this).val();
if(currentCommentText.length>maxLength){$(this).val(currentCommentText.substring(0,maxLength));
}});
};
RecommendationsO2Component.prototype.undoExpectationAction=function(saveButtonObj){var component=this;
var recomID=component.getActionObject().RECOMMENDATION_ID;
var PCO_HM_ENS_RECOMMENDATION={APPLICATION:966300,TASK:966320,REQUEST:966321};
var scriptRequest=new ScriptRequest();
scriptRequest.setProgramName("MP_EXEC_STD_REQUEST");
scriptRequest.setParameterArray(["^MINE^","^^",PCO_HM_ENS_RECOMMENDATION.APPLICATION,PCO_HM_ENS_RECOMMENDATION.TASK,PCO_HM_ENS_RECOMMENDATION.REQUEST]);
scriptRequest.setDataBlob(component.getRecommendationActionBlobIn());
scriptRequest.setResponseHandler(function(scriptReply){if(scriptReply.getStatus()==="S"){component.m_$sidePanelContainer.find("#undoActionContainer"+recomID+component.m_componentId).off();
component.getActionObject().saveSuccessful=true;
component.retrieveComponentData();
}else{saveButtonObj.removeClass("disabled");
var undoFailedMessageContainer=component.m_$sidePanelContainer.find(".recom-o2-sp-err-msg");
if(undoFailedMessageContainer.hasClass("hidden")){var saveErrorHTML=MP_Core.generateUserMessageHTML("error",component.m_i18nStrings.UNDO_FAILED,"","recom-o2-modify-failure");
undoFailedMessageContainer.empty().html(saveErrorHTML);
undoFailedMessageContainer.removeClass("hidden");
}}});
saveButtonObj.addClass("disabled");
scriptRequest.performRequest();
};
RecommendationsO2Component.prototype.updateSelection=function(self){var modifiedRowId="";
var modifiedRowObject=null;
if(self.m_systemSatisfierAction&&self.m_systemSatisfierAction.modifiedRowId){modifiedRowId=self.m_systemSatisfierAction.modifiedRowId;
}modifiedRowObject=self.getModifiedRowObject(modifiedRowId);
self.m_systemSatisfierAction.componentId=null;
self.m_systemSatisfierAction.recommendationId=null;
self.m_systemSatisfierAction.modifiedRowId=null;
self.updateInfo(modifiedRowObject,self.m_recommendationsTable.getRowById(modifiedRowId).getResultData(),false,self.refTextResponse);
};
RecommendationsO2Component.prototype.systemSatisfierHandler=function(actionMeaning,dataObject,selectedSatisfierId){var criterion=this.getCriterion();
var personId=criterion.person_id;
var encounterId=criterion.encntr_id;
var venueType=null;
var self=this;
var addToScratchPad=function(componentId){var orderMnemonic=null;
var orderSynonymId=null;
for(var satisfierIndex=0;
satisfierIndex<dataObject.SATISFIERS.length;
satisfierIndex++){if(dataObject.SATISFIERS[satisfierIndex].EXPECT_SAT_ID===selectedSatisfierId){orderMnemonic=(dataObject.SATISFIERS[satisfierIndex].ORDER_MNEMONIC)?dataObject.SATISFIERS[satisfierIndex].ORDER_MNEMONIC:"";
orderSynonymId=(dataObject.SATISFIERS[satisfierIndex].ENTRY_ID)?dataObject.SATISFIERS[satisfierIndex].ENTRY_ID:0;
}}var scratchpadObj={};
scratchpadObj.componentId=componentId;
scratchpadObj.addedFrom="Recommendations";
scratchpadObj.favId=""+componentId+selectedSatisfierId;
scratchpadObj.favType=0;
scratchpadObj.favName=null;
scratchpadObj.favOrderSentDisp=null;
scratchpadObj.favParam=null;
scratchpadObj.favSynId=null;
scratchpadObj.favVenueType=venueType;
scratchpadObj.favSentId=null;
scratchpadObj.favPPEventType=null;
scratchpadObj.favName=orderMnemonic;
scratchpadObj.favOrderSentDisp="";
scratchpadObj.favSynId=orderSynonymId+".0";
scratchpadObj.favSentId="0.0";
scratchpadObj.favParam=scratchpadObj.favSynId+"|"+venueType+"|0.0";
scratchpadObj.favNomenIds='""';
var srObj=self.getScratchpadSharedResourceObject();
if(srObj){var dataObj=srObj.getResourceData();
if(!dataObj){return null;
}else{var scratchpadArr=dataObj.scratchpadObjArr;
if(scratchpadArr){scratchpadArr.push(scratchpadObj);
}dataObj.scratchpadObjArr=scratchpadArr;
MP_Resources.setSharedResourceData(srObj.getName(),dataObj);
srObj.notifyResourceConsumers(false,scratchpadObj);
return dataObj;
}}};
switch(actionMeaning){case"POWERFORM":var activityId=0;
var chartMode=0;
var powerformId=0;
for(var satisfierIndex=0;
satisfierIndex<dataObject.SATISFIERS.length;
satisfierIndex++){if(dataObject.SATISFIERS[satisfierIndex].EXPECT_SAT_ID===selectedSatisfierId){powerformId=(dataObject.SATISFIERS[satisfierIndex].ENTRY_ID)?dataObject.SATISFIERS[satisfierIndex].ENTRY_ID:0;
}}var mpagePowerFormObj=CERN_Platform.getDiscernObject("POWERFORM");
if(mpagePowerFormObj){mpagePowerFormObj.OpenForm(personId,encounterId,powerformId,activityId,chartMode);
this.m_systemSatisfierAction.componentId=this.getComponentId();
this.m_systemSatisfierAction.recommendationId=dataObject.RECOMMENDATION_ID;
this.retrieveComponentData();
}break;
case"ORDER":venueType=0;
addToScratchPad(this.getComponentId());
this.m_systemSatisfierAction.componentId=this.getComponentId();
this.m_systemSatisfierAction.recommendationId=dataObject.RECOMMENDATION_ID;
this.retrieveComponentData();
break;
case"PRESCRIPTION":venueType=1;
addToScratchPad(this.getComponentId());
this.m_systemSatisfierAction.componentId=this.getComponentId();
this.m_systemSatisfierAction.recommendationId=dataObject.RECOMMENDATION_ID;
this.retrieveComponentData();
break;
case"PROCEDURE":this.setCurrentActionType(this.RECOMMENDATION_ACTION.SYSTEM_SATISFY_PROCEDURE);
var addProcedureActionObject={PROVIDER_ID:this.getCriterion().provider_id,PROVIDER_NAME:"",COMMENTS:"",NOMENCLATURE_ID:this.m_nomenclatureId,FREE_TEXT_LOCATION:""};
addProcedureActionObject.RECOMMENDATION_ID=dataObject.RECOMMENDATION_ID;
this.setAddProcedureAction(addProcedureActionObject);
this.handleAddProcedureAction();
break;
}};
RecommendationsO2Component.prototype.getScratchpadSharedResourceObject=function(){var sharedResourceObj=null;
var sharedResourceName="scratchpadSR";
sharedResourceObj=MP_Resources.getSharedResource(sharedResourceName);
if(!sharedResourceObj){sharedResourceObj=this.initializeScratchpadSharedResource(sharedResourceName);
}return sharedResourceObj;
};
RecommendationsO2Component.prototype.initializeScratchpadSharedResource=function(sharedResourceName){var sharedResourceObj=null;
var dataObj={};
sharedResourceObj=new SharedResource(sharedResourceName);
dataObj.scratchpadObjArr=[];
sharedResourceObj.setIsAvailable(true);
sharedResourceObj.setResourceData(dataObj);
var object={};
sharedResourceObj.setEventListenerObject(object);
sharedResourceObj.setEventListenerFlag(EventListener.EVENT_SCRATCHPAD_COUNT_UPDATE);
MP_Resources.addSharedResource(sharedResourceObj.getName(),sharedResourceObj);
return sharedResourceObj;
};
RecommendationsO2Component.prototype.handleAddProcedureAction=function(){var component=this;
if(!component.getCurrentProviderName().length){component.m_sidePanel.setContents("<div class = 'recom-o2-modify-pre-loader'></div>");
component.m_isSidePanelLoading=true;
var recommendationsDataRequest=new ScriptRequest();
recommendationsDataRequest.setProgramName("mp_get_data_add_expectation");
recommendationsDataRequest.setParameterArray(["^MINE^",component.getCriterion().provider_id+".0",1]);
recommendationsDataRequest.setResponseHandler(function(replyObj){component.saveCodeSetData(replyObj);
component.createAddProcedureContentInSidePanel();
component.addEventHandlersForAddProdecureFields();
component.m_sidePanel.expandSidePanel();
component.m_sidePanel.m_cornerCloseButton.hide();
component.m_isSidePanelLoading=false;
});
recommendationsDataRequest.performRequest();
}else{component.createAddProcedureContentInSidePanel();
component.addEventHandlersForAddProdecureFields();
component.m_sidePanel.expandSidePanel();
component.m_sidePanel.m_cornerCloseButton.hide();
component.m_isSidePanelLoading=false;
}};
RecommendationsO2Component.prototype.createAddProcedureContentInSidePanel=function(){var componentID=this.m_componentId;
var recomID=this.getAddProcedureAction().RECOMMENDATION_ID;
var saveAndCancelButtonHTML="<div id='recommendationsSPAddProcedureAction"+componentID+"' class='recom-o2-sp-actions'><div class='sp-button2 recom-o2-cancel-button' id='cancelButton"+recomID+componentID+"'>"+i18n.CANCEL+"</div><div class='sp-button2 recom-o2-save-button disabled' id='saveRecomButton"+recomID+componentID+"'>"+i18n.SAVE+"</div></div>";
this.m_sidePanel.setContents(this.createAddProcedureFields(),"recom-o2"+componentID);
this.addFuzzyDateControlToSidePanel();
this.addPersonnelSearchToSidePanel();
this.m_sidePanel.setActionsAsHTML(saveAndCancelButtonHTML);
this.adjustScrollBarPosition(false);
};
RecommendationsO2Component.prototype.createAddProcedureFields=function(){var addProcedureHtml="";
var addProcedureFieldsContentHtml="";
var componentId=this.m_componentId;
var currentActionItem=this.getAddProcedureAction();
var recomID=currentActionItem.RECOMMENDATION_ID;
var addProcedureActionFailedHtml="<div class = 'recom-o2-sp-err-msg hidden'></div>";
addProcedureFieldsContentHtml+="<div id='procedureName"+recomID+"' class='recom-o2-procedure-name'><span class='secondary-text'>"+i18n.PROCEDURE+"</span></br><span>"+this.getAddProcedureName()+"</span></div>";
addProcedureFieldsContentHtml+="<span class='recom-o2-time-frame-label secondary-text'>"+this.m_i18nStrings.TIME_FRAME+"</span><div id='addProcedureDateSelector"+componentId+recomID+"' class='recom-o2-add-proc-date'></div>";
addProcedureFieldsContentHtml+="<div class='recom-o2-proc-provider-container'><span class='secondary-text'>"+this.m_i18nStrings.PHYSICIAN+"</span><div id='addProcedureProviderSelector"+componentId+recomID+"' class='recom-o2-add-proc-provider'></div></div>";
addProcedureFieldsContentHtml+="<div class='recom-o2-proc-location-container'><span class='secondary-text'>"+i18n.LOCATION+"</span><br/><input type='text' id='addProcedureLocationText"+componentId+recomID+"' class='recom-o2-add-proc-location'/></div>";
addProcedureFieldsContentHtml+="<div class='recom-o2-proc-comment-container'><span class='secondary-text'>"+this.m_i18nStrings.COMMENTS+"</span><br/><textarea id='addProcedureCommentText"+componentId+recomID+"' class='recom-o2-add-proc-comment' rows='3' placeholder='"+this.m_i18nStrings.ADD_A_COMMENT+"'></textarea></div>";
addProcedureHtml="<div id=sidePanelScrollContainer"+componentId+"><div id='addProcedureActionContainer"+recomID+componentId+"' class='recom-o2-action-controls'>"+addProcedureActionFailedHtml+addProcedureFieldsContentHtml+"</div></div>";
return addProcedureHtml;
};
RecommendationsO2Component.prototype.addFuzzyDateControlToSidePanel=function(){var self=this;
var compId=this.m_componentId;
var recomId=this.getAddProcedureAction().RECOMMENDATION_ID;
var dateSelectorHolder=$("#addProcedureDateSelector"+compId+recomId);
self.setProcedureDateSelector(new DateSelector());
self.m_addProcedureDateSelector.m_supportedDatePrecisions=["ABOUT","BEFORE","AFTER"];
self.m_addProcedureDateSelector.retrieveRequiredResources(function(){self.m_addProcedureDateSelector.setUniqueId("addProcedureSatisfier"+compId+recomId);
self.m_addProcedureDateSelector.setCriterion(self.getCriterion());
self.m_addProcedureDateSelector.setFuzzyFlag(true);
self.m_addProcedureDateSelector.setDateSupportOption(2);
var addProcedureDateControlHTML=self.m_addProcedureDateSelector.renderDateControl();
dateSelectorHolder.append(addProcedureDateControlHTML);
self.m_addProcedureDateSelector.finalizeActions();
self.m_addProcedureDateSelector.setSelectedDateFlag(0);
CERN_EventListener.addListener(self,"selectedDateAvailable"+self.m_addProcedureDateSelector.getUniqueId(),function(){self.validateSelectedDateToAddProc();
},self);
CERN_EventListener.addListener(self,"selectedPrecisionCodeAvailable"+self.m_addProcedureDateSelector.getUniqueId(),function(){self.validateSelectedDateToAddProc();
},self);
CERN_EventListener.addListener(self,"selectedDateFormatAvailable"+self.m_addProcedureDateSelector.getUniqueId(),function(){self.validateSelectedDateToAddProc();
},self);
});
};
RecommendationsO2Component.prototype.validateSelectedDateToAddProc=function(){if(this.m_addProcedureDateSelector.getSelectedDate()){this.enableAddProcSaveButton(true);
}else{this.enableAddProcSaveButton(false);
}};
RecommendationsO2Component.prototype.enableAddProcSaveButton=function(enableSaveFlag){if(typeof enableSaveFlag!=="boolean"){throw new Error("The parameter passed to enableAddProcSaveButton function is not a boolean value");
}var procedureSaveButton=this.m_$sidePanelContainer.find("#saveRecomButton"+this.getAddProcedureAction().RECOMMENDATION_ID+this.getComponentId());
if(procedureSaveButton){if(enableSaveFlag){procedureSaveButton.removeClass("disabled");
}else{procedureSaveButton.addClass("disabled");
}}};
RecommendationsO2Component.prototype.addPersonnelSearchToSidePanel=function(){var component=this;
var componentId=this.m_componentId;
var currentActionItem=this.getAddProcedureAction();
var recomID=currentActionItem.RECOMMENDATION_ID;
var providerSearchDiv=$("#addProcedureProviderSelector"+componentId+recomID);
var personnelSearch=new MPageControls.PersonnelSearch(providerSearchDiv);
personnelSearch.setUserId(component.getCriterion().provider_id);
var personnelList=personnelSearch.getList();
if(component.m_currentProviderName){personnelSearch.setValue(component.m_currentProviderName);
}personnelSearch.setSuggestions=function(items){this.setTemplateMaxHeight(component.calculateMaxHeightForSearchResults());
this.setItems(items);
if(this.getSynchSuggestionsWidth()){$("#control_"+this.getControlId()+"_content").css("min-width",this.getElement().width()+"px");
}this.getList().renderItems(items);
var detailDialog=this.getDetailDialog();
detailDialog.show();
detailDialog.updatePosition();
if(this.getHighlightEnabled()){var hl=new MPageControls.TextHighlighter(this.getList().getElement());
hl.highlight(this.getValue());
}var self=this;
var suggestionsContainer="#control_"+self.getControlId()+"_content .suggestions";
$(suggestionsContainer).attr("tabindex",0).on("blur",function(){setTimeout(function(){if(self.getElement()&&!self.getTextbox().is(":focus")){self.close();
}},300);
});
};
personnelSearch.handleSuccess=function(reqNumber,responseText){if(reqNumber!==this.getRequestCount()||!responseText){return;
}var jsonSearch=JSON.parse(responseText);
if(jsonSearch.RECORD_DATA.STATUS_DATA.STATUS==="F"){MP_Util.LogScriptCallError(null,responseText,"recommendations-o2.js","handleSuccess");
MP_Util.LogError(this.getProgramName()+" failed: "+responseText);
return;
}var context=this.makeContext(jsonSearch);
this.setSuggestions(context);
};
personnelSearch.setListTemplate(MPageControls.getDefaultTemplates().providerSuggestList);
personnelList.setOnSelect(function(){var selectedProvider=personnelList.getSelectedItem();
component.m_addProcedureAction.PROVIDER_ID=selectedProvider.PERSON_ID;
component.m_addProcedureAction.PROVIDER_NAME="";
var searchBox=providerSearchDiv.find(".search-box");
searchBox.val(selectedProvider.NAME_FULL_FORMATTED);
personnelSearch.close();
searchBox.focusout();
});
component.m_$sidePanelContainer.on("click","#newProviderAssignment",function(){var searchBox=providerSearchDiv.find(".search-box");
component.m_addProcedureAction.PROVIDER_NAME=searchBox.val();
component.m_addProcedureAction.PROVIDER_ID=0;
$(".suggestions").hide();
searchBox.focusout();
});
providerSearchDiv.on("focusout",".search-box",function(){var searchBox=providerSearchDiv.find(".search-box");
if(!searchBox.val()){component.m_addProcedureAction.PROVIDER_NAME="";
component.m_addProcedureAction.PROVIDER_ID=0;
}});
};
RecommendationsO2Component.prototype.calculateMaxHeightForSearchResults=function(){var sidePanelContainer=this.m_$sidePanelContainer.find(".side-panel");
var searchContainer=this.m_$sidePanelContainer.find(".recom-o2-proc-provider-container");
var sidePanelBottom=parseInt(sidePanelContainer.offset().top+sidePanelContainer.height(),10);
var searchContainerBottom=parseInt(searchContainer.offset().top+searchContainer.height(),10);
return sidePanelBottom-searchContainerBottom;
};
RecommendationsO2Component.prototype.addEventHandlersForAddProdecureFields=function(){var component=this;
var recomID=this.getAddProcedureAction().RECOMMENDATION_ID;
var componentID=this.m_componentId;
var addProcedureContainer=this.m_$sidePanelContainer.find("#addProcedureActionContainer"+recomID+componentID);
addProcedureContainer.on("focusout",".recom-o2-add-proc-location",function(){component.getAddProcedureAction().FREE_TEXT_LOCATION=$(this).val();
});
addProcedureContainer.on("focusout",".recom-o2-add-proc-comment",function(){component.getAddProcedureAction().COMMENTS=$(this).val();
});
};
RecommendationsO2Component.prototype.chartProcedureSatisfier=function(saveButtonObject){if(typeof saveButtonObject!=="object"){throw new Error("The parameter passed to chartProcedureSatisfier is not an Object");
}var component=this;
var recomID=component.getAddProcedureAction().RECOMMENDATION_ID;
var ACM_PROCEDURE={APPLICATION:600005,TASK:601028,REQUEST:115467};
var scriptRequest=new ScriptRequest();
scriptRequest.setProgramName("MP_EXEC_STD_REQUEST");
scriptRequest.setParameterArray(["^MINE^","^^",ACM_PROCEDURE.APPLICATION,ACM_PROCEDURE.TASK,ACM_PROCEDURE.REQUEST]);
scriptRequest.setDataBlob(component.getaddProcedureActionBlobIn());
scriptRequest.setResponseHandler(function(scriptReply){if(scriptReply.getStatus()==="S"){component.m_$sidePanelContainer.find("#addProcedureActionContainer"+recomID+component.m_componentId).off();
component.getAddProcedureAction().saveSuccessful=true;
component.setProcedureDateSelector(null);
component.setNomenclatureId(0);
component.retrieveComponentData();
}else{saveButtonObject.removeClass("disabled");
var addProcedureFailedMessageContainer=component.m_$sidePanelContainer.find(".recom-o2-sp-err-msg");
if(addProcedureFailedMessageContainer.hasClass("hidden")){var saveErrorHTML=MP_Core.generateUserMessageHTML("error",component.m_i18nStrings.SATISFY_FAILED_TEXT,"","recom-o2-modify-failure");
addProcedureFailedMessageContainer.empty().html(saveErrorHTML);
addProcedureFailedMessageContainer.removeClass("hidden");
}}});
saveButtonObject.addClass("disabled");
scriptRequest.performRequest();
};
RecommendationsO2Component.prototype.getaddProcedureActionBlobIn=function(){var addProcedureRequest=this.getScriptRequestStructure(115467);
var currentProcedureTobeAdded=this.getAddProcedureAction();
if(currentProcedureTobeAdded.PROVIDER_ID||currentProcedureTobeAdded.PROVIDER_NAME){if(this.m_$sidePanelContainer.find(".search-box").val()){var providerObject={PROVIDER_ID:currentProcedureTobeAdded.PROVIDER_ID,PROVIDER_NAME:currentProcedureTobeAdded.PROVIDER_NAME,PROCEDURE_RELTN_CD:0};
addProcedureRequest.REQUESTIN.PROCEDURES[0].PROVIDERS.push(providerObject);
}}if(currentProcedureTobeAdded.COMMENTS){var commentObject={COMMENT:currentProcedureTobeAdded.COMMENTS,PRSNL_ID:this.getCriterion().provider_id,COMMENT_DT_TM:new Date()};
addProcedureRequest.REQUESTIN.PROCEDURES[0].COMMENTS.push(commentObject);
}addProcedureRequest.REQUESTIN.PROCEDURES[0].NOMENCLATURE_ID=currentProcedureTobeAdded.NOMENCLATURE_ID;
addProcedureRequest.REQUESTIN.PROCEDURES[0].NOTE=this.getAddProcedureName();
addProcedureRequest.REQUESTIN.PROCEDURES[0].PERFORMED_DT_TM=this.getProcedureDateSelector().getSelectedDate();
addProcedureRequest.REQUESTIN.PROCEDURES[0].PERFORMED_DT_TM_PREC=this.getProcedureDateSelector().getSelectedDateFlag();
addProcedureRequest.REQUESTIN.PROCEDURES[0].PERFORMED_DT_TM_PREC_CD=this.getProcedureDateSelector().getSelectedDatePrecisionCode();
addProcedureRequest.REQUESTIN.PROCEDURES[0].FREE_TEXT_LOCATION=currentProcedureTobeAdded.FREE_TEXT_LOCATION;
return this.getCriterion().is_utc?MP_Util.enhancedStringify(addProcedureRequest,0,0,1):MP_Util.enhancedStringify(addProcedureRequest);
};
MP_Util.setObjectDefinitionMapping("WF_HEALTH_MAINT",RecommendationsO2Component);
