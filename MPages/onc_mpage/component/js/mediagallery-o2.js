var g_MediaGadgetO2XMLHttpRequestObj=new XMLHttpRequest();
function MediaGalleryO2ComponentStyle(){this.initByNamespace("mmfgal-o2");
}MediaGalleryO2ComponentStyle.inherits(ComponentStyle);
function MediaGalleryO2Component(criterion){this.m_baseServiceURL="";
this.m_sURLParams="";
this.m_mediaStash=null;
this.m_personId=0;
this.m_viewableImageIds=[];
this.setCriterion(criterion);
this.setLookBackDropDown(true);
this.setStyles(new MediaGalleryO2ComponentStyle());
this.clearTimeoutCount=750;
this.activelyHovering=false;
this.docTimeout=null;
this.m_MediaViewerURL="";
this.m_menuGroupBy=0;
this.m_thumbNailSize=100;
this.m_docData=[];
this.m_contentTypeFilterList=[];
this.compMenuReference={};
this.$rootNode={};
this.m_contentTypeJSON=null;
this.m_patientImages=[];
this.mmf2I18n=i18n.discernabu.mediaGallery_o2;
this.m_arrayofGrps=[];
this.m_docDataForSelectedMedias={};
this.m_selectedIdxOnReviewPane=0;
this.m_reviewPaneCurWidthOfLeftSec=0;
this.m_mineTypeList=["image/jpeg","image/jpg","image/bmp","image/png","image/pipeg","image/ipe","jpeg","jpg","bmp","png"];
this.m_fullCanonicalDomainName="";
this.m_imageIdSelectedList=[];
this.setComponentLoadTimerName("USR:MPG.MMF.GALLERY.02 _ load component");
this.setComponentRenderTimerName("ENG:MPG.MMF.GALLERY.02 _ render component");
this.setIncludeLineNumber(true);
this.setMineTypeList(this.m_mineTypeList);
this.ORIENTATION_TOOLS={ROTATE_LEFT:0,ROTATE_RIGHT:1,FLIP_VERTICAL:2,FLIP_HORIZONTAL:3};
MediaGalleryO2Component.method("openTab",function(){var criterion=this.getCriterion();
var sParms="/PERSONID="+criterion.person_id+" /ENCNTRID="+criterion.encntr_id+" /FIRSTTAB=^"+this.getLink()+"+^";
APPLINK(0,criterion.executable,sParms);
});
MediaGalleryO2Component.method("getPrefJson",function(){var json={GROUP_BY_PREF:this.m_menuGroupBy};
return json;
});
this.mediaGalleryo2PrefObj={MEDIA_GALLERY_PREFS:{}};
}MediaGalleryO2Component.prototype=new MPageComponent();
MediaGalleryO2Component.prototype.constructor=MPageComponent;
MediaGalleryO2Component.inherits(MPageComponent);
MediaGalleryO2Component.prototype.getPreferencesObj=function(){return MPageComponent.prototype.getPreferencesObj.call(this,null);
};
MediaGalleryO2Component.prototype.setURLParams=function(sURLParams){this.m_sURLParams=sURLParams;
};
MediaGalleryO2Component.prototype.getURLParams=function(){return this.m_sURLParams;
};
MediaGalleryO2Component.prototype.getBaseURL=function(){return this.m_baseServiceURL;
};
MediaGalleryO2Component.prototype.setMediaStash=function(media){this.m_mediaStash=media;
};
MediaGalleryO2Component.prototype.getMediaStash=function(){return this.m_mediaStash;
};
MediaGalleryO2Component.prototype.setPatientImages=function(media){this.m_patientImages=media;
};
MediaGalleryO2Component.prototype.getPatientImages=function(){return this.m_patientImages;
};
MediaGalleryO2Component.prototype.setContentTypesJSON=function(contentTypes){this.m_contentTypesJSON=contentTypes;
};
MediaGalleryO2Component.prototype.getContentTypesJSON=function(){return this.m_contentTypesJSON;
};
MediaGalleryO2Component.prototype.setPersonId=function(personId){this.m_personId=personId;
};
MediaGalleryO2Component.prototype.getPersonId=function(){return this.m_personId;
};
MediaGalleryO2Component.prototype.imageRecord=function(imageId,description,serviceDate,contentType,imageURL,mimeType,groupId,maintainPriv,version,size,contentTypeKey){return{imageId:imageId,description:description,serviceDate:serviceDate,contentType:contentType,imageURL:imageURL,mimeType:mimeType,groupId:groupId,maintainPriv:maintainPriv,versionNumber:version,size:size,contentTypeKey:contentTypeKey};
};
MediaGalleryO2Component.prototype.setContentTypes=function(contentTypes){this.m_contentTypes=contentTypes;
};
MediaGalleryO2Component.prototype.getContentTypes=function(){return this.m_contentTypes;
};
MediaGalleryO2Component.prototype.setContentTypeFilterList=function(contentTypeFilterList){this.m_contentTypeFilterList=contentTypeFilterList;
};
MediaGalleryO2Component.prototype.getContentTypeFilterList=function(){return this.m_contentTypeFilterList;
};
MediaGalleryO2Component.prototype.setDocDataForSelectedMedias=function(docDataForSelectedMedias){var docDataObj={};
var relateDocsArray=[];
var docsLen=docDataForSelectedMedias.length;
for(var i=0;
i<docsLen;
i++){var curDoc=docDataForSelectedMedias[i];
if(docDataObj[curDoc.IMAGE_ID]){relateDocsArray=docDataObj[curDoc.IMAGE_ID];
relateDocsArray.push(curDoc);
docDataObj[curDoc.IMAGE_ID]=relateDocsArray;
}else{relateDocsArray=[];
relateDocsArray.push(curDoc);
docDataObj[curDoc.IMAGE_ID]=relateDocsArray;
}}this.m_docDataForSelectedMedias=docDataObj;
};
MediaGalleryO2Component.prototype.getDocDataForSelectedMedias=function(){return this.m_docDataForSelectedMedias;
};
MediaGalleryO2Component.prototype.setMineTypeList=function(mineTypeList){this.m_mineTypeList=mineTypeList;
};
MediaGalleryO2Component.prototype.getMineTypeList=function(){return this.m_mineTypeList;
};
MediaGalleryO2Component.prototype.setSelectedIdxOnReviewPane=function(selectedIdxOnReviewPane){this.m_selectedIdxOnReviewPane=selectedIdxOnReviewPane;
};
MediaGalleryO2Component.prototype.getSelectedIdxOnReviewPane=function(){return this.m_selectedIdxOnReviewPane;
};
MediaGalleryO2Component.prototype.setReviewPaneCurWidthOfLeftSec=function(reviewPaneCurWidthOfLeftSec){this.m_reviewPaneCurWidthOfLeftSec=reviewPaneCurWidthOfLeftSec;
};
MediaGalleryO2Component.prototype.getReviewPaneCurWidthOfLeftSec=function(){return this.m_reviewPaneCurWidthOfLeftSec;
};
MediaGalleryO2Component.prototype.loadFilterMappings=function(){this.addFilterMappingObject("WF_MG_CONTENT_TYPE",{setFunction:this.setContentTypes,type:"ARRAY",field:"PARENT_ENTITY_ID"});
};
MediaGalleryO2Component.prototype.setSaveButton=function(enabled){var mmfgalO2compId="mmfgal-o2"+this.getComponentId();
if(!$("#"+mmfgalO2compId+"contentReadOnly").is(":visible")){var rpEditSaveBtn=document.getElementById(mmfgalO2compId+"rpEditSaveBtn");
if(rpEditSaveBtn!==null){rpEditSaveBtn.disabled=!enabled;
}}};
MediaGalleryO2Component.prototype.setCancelButton=function(enabled){var component=this;
var compId=component.getComponentId();
var rpEditResetBtn=_g("mmfgal-o2"+compId+"rpEditResetBtn");
var $activeSlide=$(component.$rootNode.find(".active-slide").children()[0]);
var activeImageId=$activeSlide.attr("id");
var sImageId="{"+activeImageId+"}";
var imgObj=component.getImageObjById(sImageId);
var imageTypeList=component.getMineTypeList();
var imageType=$.grep(imageTypeList,function(imgType){return imgType===imgObj.mimeType;
});
if(imageType.length>0){if(rpEditResetBtn!==null){rpEditResetBtn.disabled=!enabled;
}}};
MediaGalleryO2Component.prototype.resizeComponent=function(){var compId=this.getComponentId();
var component=this;
var NAV_BUTTONS_WDTH=46;
var IMAGE_WIDTH=58;
var SPACES=105;
var $rootNode=this.$rootNode;
var IMG_NAV_BUTTONS_WDTH=60;
var OTHER_SPACES=10;
var mmfgalO2compId="#mmfgal-o2"+compId;
var curActiveSlideIdx=component.getSelectedIdxOnReviewPane();
var RP_RIGHT_FIXED_W=300;
var RP_WIDTH_600=600;
var BORDER_2PX=2;
var OTHER_3PX=3;
MPageComponent.prototype.resizeComponent.call(this,null);
var bodyContentHeight=$rootNode.find(".mmf2-content-body").height();
$rootNode.find(".mmf2-nav-panel").css("height",bodyContentHeight);
var windowHeight=$(window).height();
var $mmf2contentReviewDiv=$("#mmf2contentReviewDiv"+compId);
$mmf2contentReviewDiv.css("height",windowHeight-SPACES);
var reviewPaneOuterHeight=$mmf2contentReviewDiv.outerHeight();
var rpLeftHeaderOuterHeight=$(mmfgalO2compId+"rpLeftHeader").outerHeight();
var $rpLeftFooterImageTray=$(mmfgalO2compId+"rpLeftFooterImageTray");
var rpLeftFooterOuterHeight=$rpLeftFooterImageTray.outerHeight();
$(mmfgalO2compId+"rpLeftBody").css("height",reviewPaneOuterHeight-rpLeftHeaderOuterHeight-rpLeftFooterOuterHeight-BORDER_2PX);
var rpOuterWidth=$mmf2contentReviewDiv.outerWidth();
var $rpLeft=$rootNode.find(".mmf2-review-pane-left");
var $rpRight=$(mmfgalO2compId+"reviewPaneRight");
var rpRigthOuterWidth=$rpRight.outerWidth();
$rpLeft.css("width",rpOuterWidth-rpRigthOuterWidth-OTHER_3PX-BORDER_2PX);
if(rpOuterWidth>=RP_WIDTH_600){$rpRight.css("width",RP_RIGHT_FIXED_W);
$rpLeft.css("width",rpOuterWidth-RP_RIGHT_FIXED_W-OTHER_3PX-BORDER_2PX);
}else{$rpRight.css("width",(rpOuterWidth*0.35));
$rpLeft.css("width",rpOuterWidth-$rpRight.width()-OTHER_3PX-BORDER_2PX);
}var rpLeftBodyHeight=$(mmfgalO2compId+"rpLeftBody").height();
$(mmfgalO2compId+"reviewImgNavContainer").css("height",rpLeftBodyHeight);
$rootNode.find(".mmf2-review-pane-img-content-container").css("height",rpLeftBodyHeight-10);
var oldrpLeftBodyWidth=component.getReviewPaneCurWidthOfLeftSec();
var rpLeftBodyWidth=$(mmfgalO2compId+"rpLeftBody").width();
component.setReviewPaneCurWidthOfLeftSec(rpLeftBodyWidth);
$(mmfgalO2compId+"reviewImgNavContainer").css("width",rpLeftBodyWidth);
$(mmfgalO2compId+"reviewPaneImgNavContent").css("width",rpLeftBodyWidth-IMG_NAV_BUTTONS_WDTH-OTHER_SPACES);
$rootNode.find(".mmf2-review-pane-img-content-container").css("width",rpLeftBodyWidth-IMG_NAV_BUTTONS_WDTH-OTHER_SPACES);
if(oldrpLeftBodyWidth>0){var imgContentContainerWidth=$rootNode.find(".mmf2-review-pane-img-content-container").width();
if(curActiveSlideIdx>0){if(rpLeftBodyWidth!==oldrpLeftBodyWidth){var imgSlideList=$rootNode.find("#mmfgal-o2"+compId+"reviewPaneImgNavContent")[0].children;
var totalWidthAllImgContainer=(imgContentContainerWidth*imgSlideList.length)+100+"px";
var positionActiveSlide=(imgContentContainerWidth+8)*curActiveSlideIdx+"px";
$(mmfgalO2compId+"reviewPaneImgNavContent").animate({scrollLeft:"-="+totalWidthAllImgContainer}).stop(true,true).animate({scrollLeft:"+="+positionActiveSlide}).stop(true,true);
}}}$rootNode.find(".mmf2-review-pane-img-nav-btns").css("top",(rpLeftBodyHeight/2-25));
var rpLeftFooterWidth=$rpLeftFooterImageTray.width();
$rootNode.find(".mmf2-review-pane-nav-container").css("width",rpLeftFooterWidth);
var $mmf2ReviewPaneNavContent=$("#mmf2ReviewPaneNavContent"+compId);
$mmf2ReviewPaneNavContent.css("width",rpLeftFooterWidth-NAV_BUTTONS_WDTH);
var rpNavContentWidth=$mmf2ReviewPaneNavContent.width();
var imgNodes=$rootNode.find(".mmf2-review-pane-img-contain .mmf2-thumb");
var imagesWidth=(imgNodes.length)*IMAGE_WIDTH;
var mgReviewPrevNavId=mmfgalO2compId+"reviewPrevNav";
var mgReviewNxtNavId=mmfgalO2compId+"reviewNxtNav";
var imageTrayNavBtns=mgReviewPrevNavId+", "+mgReviewNxtNavId;
if(imagesWidth<=rpNavContentWidth){$(imageTrayNavBtns).hide();
$mmf2ReviewPaneNavContent.css("left",0);
}else{$(imageTrayNavBtns).show();
$mmf2ReviewPaneNavContent.css("left",20);
}component.resizeEditTabContent();
component.resizeCanvasDisplay();
};
MediaGalleryO2Component.prototype.resizeEditTabContent=function(){var mmfgalO2compId="#mmfgal-o2"+this.getComponentId();
var TAB_OFFSET=45;
var EDIT_TAB_MARGIN_R=parseInt($(mmfgalO2compId+"tab1").css("margin-right"),10);
var TAB_HEIGHT=30;
var tabsWidth=$(".mmf2-review-pane-tabs").outerWidth();
var tabsMarginLeft=parseInt($(".mmf2-review-pane-tabs ul").css("margin-left"),10);
var tab1Width=$(mmfgalO2compId+"tab1").outerWidth()+EDIT_TAB_MARGIN_R;
var tab2Width=$(mmfgalO2compId+"tab2").outerWidth()+EDIT_TAB_MARGIN_R;
var totalWidthIcons=($(".mmf2-review-pane-edit-btn").width()+parseInt($(".mmf2-review-pane-edit-btn").css("margin-left"),10)+parseInt($(".mmf2-review-pane-edit-btn").css("margin-right"),10))*4;
var mmfgalO2CompIdContentReadOnly=mmfgalO2compId+"contentReadOnly";
var contentReadOnlyDisplay=$(mmfgalO2CompIdContentReadOnly).css("display");
if(tabsWidth-tabsMarginLeft<tab1Width+tab2Width){$(".mmf2-review-pane-tabs").css("height",TAB_HEIGHT*2);
}else{$(".mmf2-review-pane-tabs").css("height",TAB_HEIGHT);
}var rpRightHeight=$(".mmf2-review-pane-right").height();
var tabHeight=$(".mmf2-review-pane-tabs").height();
$(".mmf2-review-pane-tab-content").css("height",rpRightHeight-tabHeight-5);
var nEditTabContent=$(".mmf2-review-pane-tab-wrap").outerHeight()-$(".mmf2-review-pane-tabs").outerHeight();
$(mmfgalO2compId+"tabContent2").css("height",nEditTabContent);
$(".mmf2-review-pane-right-edit-body").css("height",$(mmfgalO2compId+"tabContent2").outerHeight());
if(contentReadOnlyDisplay==="block"){$(mmfgalO2compId+"tabContent2").css("min-height",245);
}else{$(mmfgalO2compId+"tabContent2").css("min-height",205);
}var editToolsWidth=$(".mmf2-review-pane-edit-tools").width();
if(editToolsWidth>0){if(editToolsWidth<totalWidthIcons){$(".mmf2-review-pane-edit-tools-fieldset").css("height",110);
}else{$(".mmf2-review-pane-edit-tools-fieldset").css("height",60);
}}var nEditImageNameOuterHeight=$(".mmf2-review-pane-edit-image-name").outerHeight();
var nEditImageNameHeight=$(".mmf2-review-pane-edit-image-name").height();
var contentReadOnlyHeight=$(mmfgalO2CompIdContentReadOnly).outerHeight();
if(nEditImageNameHeight===0){nEditImageNameOuterHeight+=18;
}var nMarginForEditBtnSec=$(".mmf2-review-pane-right-edit-body").outerHeight()-nEditImageNameOuterHeight-$(".mmf2-review-pane-edit-line-separator").outerHeight()-$(".mmf2-review-pane-edit-tools-fieldset").outerHeight();
if(contentReadOnlyDisplay==="block"){nMarginForEditBtnSec=nMarginForEditBtnSec-contentReadOnlyHeight-10;
}$(".mmf2-review-pane-edit-btn-sec").css("margin-top",nMarginForEditBtnSec-TAB_OFFSET);
};
MediaGalleryO2Component.prototype.resizeCanvasDisplay=function(){logger.logDebug("Entering resizeCanvasDisplay");
var component=this;
var nameSpace=component.getStyles().getNameSpace();
var mmfgalO2compId="#"+nameSpace+component.getComponentId();
var $activeSlide=$(component.$rootNode.find(".active-slide").children()[0]);
var activeImageId=$activeSlide.attr("id");
var fgCanvas=$(mmfgalO2compId+"mmf2Canvas"+activeImageId);
if(fgCanvas.length!==0){var $rpImgcontentContainer=$(mmfgalO2compId+"rpImgContentContainer.active-slide");
var displayCanvas=component.calculateMaxImageDisplay($rpImgcontentContainer,{width:fgCanvas.attr("width"),height:fgCanvas.attr("height")});
fgCanvas.css("width",displayCanvas.width+"px");
fgCanvas.css("height",displayCanvas.height+"px");
}else{logger.logDebug("canvas element not present");
}};
MediaGalleryO2Component.prototype.rotateImage=function(compId,direction){logger.logDebug("Entering rotateImage");
var component=MP_Util.GetCompObjById(compId);
var mmfgalO2compId="mmfgal-o2"+compId;
var $activeSlide=$(component.$rootNode.find(".active-slide").children()[0]);
var activeImageId=$activeSlide.attr("id");
if($("#"+mmfgalO2compId+"mmf2Canvas"+activeImageId).length){var canvas=document.getElementById(mmfgalO2compId+"mmf2Canvas"+activeImageId);
if(canvas&&typeof canvas!=="undefined"){var context=canvas.getContext("2d");
var dataURL=canvas.toDataURL();
var canvasWidth=canvas.width;
var canvasHeight=canvas.height;
var degrees=0;
canvas.width=canvasHeight;
canvas.height=canvasWidth;
context.save();
switch(direction){case component.ORIENTATION_TOOLS.ROTATE_LEFT:context.translate(0,canvas.height);
degrees=-90;
break;
case component.ORIENTATION_TOOLS.ROTATE_RIGHT:context.translate(canvas.width,0);
degrees=90;
break;
default:return;
}context.rotate(degrees*Math.PI/180);
var img=new Image();
img.onload=function(){context.drawImage(img,0,0);
context.restore();
component.resizeCanvasDisplay();
};
img.src=dataURL;
}}};
MediaGalleryO2Component.prototype.flipImage=function(compId,flipDirection){logger.logDebug("Entering flipImage");
var component=MP_Util.GetCompObjById(compId);
var mmfgalO2compId="mmfgal-o2"+compId;
var $activeSlide=$(component.$rootNode.find(".active-slide").children()[0]);
var activeImageId=$activeSlide.attr("id");
logger.logDebug("activeImageId: "+activeImageId);
var canvas=document.getElementById(mmfgalO2compId+"mmf2Canvas"+activeImageId);
if(canvas&&typeof canvas!=="undefined"){var context=canvas.getContext("2d");
var dataURL=canvas.toDataURL();
var scaleH=1;
var scaleV=1;
var posX=0;
var posY=0;
switch(flipDirection){case component.ORIENTATION_TOOLS.FLIP_VERTICAL:scaleH=1;
scaleV=-1;
posX=0;
posY=canvas.height*-1;
break;
case component.ORIENTATION_TOOLS.FLIP_HORIZONTAL:scaleH=-1;
scaleV=1;
posX=canvas.width*-1;
posY=0;
break;
default:return;
}context.save();
context.scale(scaleH,scaleV);
var img=new Image();
img.onload=function(){context.drawImage(img,posX,posY);
context.restore();
};
img.src=dataURL;
}};
MediaGalleryO2Component.prototype.removeCanvas=function(compId){var component=MP_Util.GetCompObjById(compId);
var mmfgalO2compId="mmfgal-o2"+compId;
var $activeSlide=$(component.$rootNode.find(".active-slide").children()[0]);
var activeImageId=$activeSlide.attr("id");
var $mmf2CanvasContainer=component.$rootNode.find("#"+mmfgalO2compId+"mmf2Canvas"+activeImageId);
if($mmf2CanvasContainer.length){$mmf2CanvasContainer.parent(".mmf2-canvas-container").remove();
component.$rootNode.find(".active-slide img").css("visibility","visible");
component.setCancelButton(false);
component.setSaveButton(false);
}};
MediaGalleryO2Component.prototype.generateCanvas=function(compId,img,width,height){logger.logDebug("Entering generateCanvas");
var component=MP_Util.GetCompObjById(compId);
if(component.isCanvasSupported()){var mmfgalO2compId="mmfgal-o2"+compId;
var $rootNode=component.$rootNode;
var $activeSlide=$($rootNode.find(".active-slide").children()[0]);
var activeImageId=$activeSlide.attr("id");
var cHTML="<div class='mmf2-canvas-container' name = '"+activeImageId+"'><canvas id ='"+mmfgalO2compId+"mmf2Canvas"+activeImageId+"' width='"+width+"' height='"+height+"' style='z-index:10;'></canvas></div>";
if($rootNode.find("#"+mmfgalO2compId+"mmf2Canvas"+activeImageId).size()===0){$rootNode.find("img#"+activeImageId+".mmf2-thumb").parent(".mmf2-review-pane-img-content-container").append(cHTML);
}var $rpImgcontentContainer=$("#"+mmfgalO2compId+"rpImgContentContainer.active-slide");
var displayCanvas=component.calculateMaxImageDisplay($rpImgcontentContainer,{width:width,height:height});
$("#"+mmfgalO2compId+"mmf2Canvas"+activeImageId).css("width",displayCanvas.width+"px");
$("#"+mmfgalO2compId+"mmf2Canvas"+activeImageId).css("height",displayCanvas.height+"px");
var fgCanvas=document.getElementById(mmfgalO2compId+"mmf2Canvas"+activeImageId);
var fgContext=fgCanvas.getContext("2d");
fgContext.drawImage(img,0,0);
$rootNode.find(".active-slide img").css("visibility","hidden");
}else{logger.logMessage("generateCanvas: isCanvasSupported: canvas is not supported");
}};
MediaGalleryO2Component.prototype.addCanvas=function(compId){logger.logDebug("Entering addCanvas");
var self=this;
var component=MP_Util.GetCompObjById(compId);
if(component.isCanvasSupported()){var mmfgalO2compId="mmfgal-o2"+compId;
var imageTypeList=[];
var imgObj=null;
var $activeSlide=$(component.$rootNode.find(".active-slide").children()[0]);
var activeImageId=$activeSlide.attr("id");
var sImageId="{"+activeImageId+"}";
imgObj=component.getImageObjById(sImageId);
imageTypeList=component.getMineTypeList();
var imageType=$.grep(imageTypeList,function(imgType){return imgType===imgObj.mimeType;
});
if(component.$rootNode.find("#"+mmfgalO2compId+"tab2").hasClass("active")&&imageType.length){var imgMaxSizeRequest="height=1200&width=1600";
var imageCanvasSrc=component.getBaseURL()+"asImage/{"+activeImageId+"}?"+imgMaxSizeRequest;
var receiver=document.getElementById(mmfgalO2compId+"iFrameReceiver").contentWindow;
logger.logMessage("Posting message to receiver: "+imageCanvasSrc);
receiver.postMessage({getDataURL:{imageSource:imageCanvasSrc}},component.getCAMMOrigin());
}}else{logger.logMessage("addCanvas: isCanvasSupported: canvas is not supported");
}};
MediaGalleryO2Component.prototype.preProcessing=function(){var compMenu,compId;
compMenu=this.getMenu();
compId=this.getComponentId();
var mediagalI18n=i18n.discernabu.mediaGallery_o2;
var component=this;
if(this.isDisplayable()===true){var compMenuGroupByContentType=new MenuSelection("compMenuGroupByContentType"+compId);
compMenuGroupByContentType.setLabel(mediagalI18n.GROUP_BY_CONTENT_TYPE);
compMenuGroupByContentType.setIsDisabled(false);
compMenuGroupByContentType.setIsSelected(component.m_menuGroupBy===1?true:false);
compMenuGroupByContentType.setClickFunction(function(){if(component.m_menuGroupBy===0){component.m_menuGroupBy=1;
compMenuGroupByContentType.setIsSelected(true);
}else{component.m_menuGroupBy=0;
compMenuGroupByContentType.setIsSelected(false);
}component.displayGroupByContentType();
});
compMenu.addMenuItem(compMenuGroupByContentType);
this.compMenuReference[compMenuGroupByContentType.getId()]=compMenuGroupByContentType;
var compMenuShowRelatedDoc=new MenuSelection("compMenuShowRelatedDoc"+compId);
compMenuShowRelatedDoc.setLabel(mediagalI18n.SHOW_RELATED_DOCUMENTS);
compMenuShowRelatedDoc.setIsDisabled(false);
compMenuShowRelatedDoc.setIsSelected(false);
compMenuShowRelatedDoc.setClickFunction(function(){if(component.getMenuShowRelatedDocsInd()===0){component.setMenuShowRelatedDocsInd(1);
compMenuShowRelatedDoc.setIsSelected(true);
component.getRelatedDocs();
}else{component.setMenuShowRelatedDocsInd(0);
compMenuShowRelatedDoc.setIsSelected(false);
component.removeShowRelatedDocsIcon();
}});
compMenu.addMenuItem(compMenuShowRelatedDoc);
this.compMenuReference[compMenuShowRelatedDoc.getId()]=compMenuShowRelatedDoc;
}};
MediaGalleryO2Component.prototype.retrieveComponentData=function(){var criterion=this.getCriterion();
var sendAr=null;
this.setPersonId(criterion.person_id);
var searchScope=this.getScope();
var lookBackUnits=this.getLookbackUnits();
var lookBackUnitType=this.getLookbackUnitTypeFlag();
var sUrlParam="";
if(searchScope===1){sUrlParam="media?personId="+criterion.person_id;
}else{sUrlParam="media?encounterId="+criterion.encntr_id;
}if(lookBackUnits>0){var searchDate=new Date();
switch(lookBackUnitType){case 1:searchDate.setHours(searchDate.getHours()-lookBackUnits);
break;
case 2:searchDate.setDate(searchDate.getDate()-lookBackUnits);
break;
case 3:searchDate.setDate(searchDate.getDate()-lookBackUnits*7);
break;
case 4:searchDate.setMonth(searchDate.getMonth()-lookBackUnits);
break;
case 5:searchDate.setFullYear(searchDate.getFullYear()-lookBackUnits);
break;
}var sUrlDateParam="&beginDate="+Math.round(searchDate.getTime()/1000);
sUrlParam=sUrlParam+sUrlDateParam;
}this.setURLParams(sUrlParam);
sendAr=["^MINE^",criterion.person_id+".0",MP_Util.CreateParamArray(this.getContentTypes(),1)];
MP_Core.XMLCclRequestWrapper(this,"MP_MEDIA_GALLERY",sendAr,true);
};
MediaGalleryO2Component.prototype.doSelect=function(compId){var tmp=this;
var component=MP_Util.GetCompObjById(compId);
if(tmp.getAttribute("class")==="mmf2-imgContain mmf2-selected"){tmp.setAttribute("class","mmf2-imgContain");
var itemSelectedCnt=component.$rootNode.find(".mmf2-imgContain.mmf2-selected").length;
if(itemSelectedCnt===0){MediaGalleryO2Component.prototype.disableActions.apply(this,[compId]);
}else{var inactivateBtn=_g("mgInactivateBtn"+compId);
var renameBtn=_g("mgRenameBtn"+compId);
if((inactivateBtn&&inactivateBtn.disabled===false)||(renameBtn&&renameBtn.disabled===false)){var imageListing=component.getPatientImages();
var disableInd=true;
$(".mmf2-imgContain.mmf2-selected").find(".mmf2-thumb").each(function(imgIndex,imgNode){var selectedItemId="{"+$(imgNode).attr("id")+"}";
var mediaArray=$.grep(imageListing,function(mediaObj){return mediaObj.imageId===selectedItemId;
});
if(mediaArray.length>0){if(mediaArray[0].maintainPriv==="true"){disableInd=false;
return false;
}}});
if(disableInd){if(inactivateBtn){inactivateBtn.disabled=true;
}if(renameBtn){renameBtn.disabled=true;
}}}}}else{tmp.setAttribute("class","mmf2-imgContain mmf2-selected");
var imageId=$(this).find(".mmf2-thumb").attr("id");
MediaGalleryO2Component.prototype.enableActions.apply(this,[imageId,compId]);
}};
MediaGalleryO2Component.prototype.launchMediaViewer=function(compId,viewerURL,subTimerName,imageId){var component=MP_Util.GetCompObjById(compId);
var mmfI18n=i18n.discernabu.mediaGallery_o2;
var viewMediaAuthenticated=false;
var slaTimer=MP_Util.CreateTimer("CAP:MPG_Media_Gallery_o2_Launch_Media_Viewer");
if(slaTimer){slaTimer.SubtimerName=subTimerName;
slaTimer.Stop();
}if(typeof(imageId)!=="undefined"){viewerURL=viewerURL+imageId;
}else{component.$rootNode.find(".mmf2-imgContain.mmf2-selected").find(".mmf2-thumb").each(function(i,obj){viewerURL=viewerURL+"&identifier={"+obj.getAttribute("id")+"}";
});
}MP_Util.LogInfo("mediagallery-o2.js: launchMediaViewer: viewerURL: "+viewerURL);
try{g_MediaGadgetO2XMLHttpRequestObj.open("GET",viewerURL,false);
if(CERN_Platform.inMillenniumContext()){window.location="javascript:MPAGES_SVC_AUTH(g_MediaGadgetO2XMLHttpRequestObj)";
}g_MediaGadgetO2XMLHttpRequestObj.withCredentials=true;
g_MediaGadgetO2XMLHttpRequestObj.send();
if(g_MediaGadgetO2XMLHttpRequestObj.status===200){viewMediaAuthenticated=true;
}else{MP_Util.LogInfo("mediagallery-o2.js: launchMediaViewer: Failed to get Media Viewer Authenticated:"+g_MediaGadgetO2XMLHttpRequestObj.status);
}}catch(err){MP_Util.LogJSError(this,err,"mediagallery-o2.js","launchMediaViewer");
throw (err);
}if(viewMediaAuthenticated===true){var modalId="MediaGalleryO2Component";
var mDialog=new ModalDialog(modalId);
mDialog.setHeaderCloseFunction(function(){MP_ModalDialog.closeModalDialog(modalId);
MP_ModalDialog.deleteModalDialogObject(modalId);
});
mDialog.setBodyDataFunction(function(modalObj){modalObj.setBodyHTML('<iframe class="mmf2-media-viewer-modal-dialog" src="'+viewerURL+'" ></iframe>');
});
mDialog.setHeaderTitle(mmfI18n.MEDIA_VIEWER);
MP_ModalDialog.addModalDialogObject(mDialog);
MP_ModalDialog.showModalDialog(modalId);
}};
MediaGalleryO2Component.prototype.clearMediaSelection=function(compId){var component=MP_Util.GetCompObjById(compId);
component.$rootNode.find(".mmf2-imgContain.mmf2-selected").removeClass("mmf2-selected");
MediaGalleryO2Component.prototype.disableActions.apply(this,[compId]);
};
MediaGalleryO2Component.prototype.findImages=function(){var patientImages=[];
var imageObject=null;
var tempMedia=this.getMediaStash();
var imageIdList=[];
var contentTypes=this.getContentTypesJSON();
var maintainPriv="false";
if(tempMedia){try{for(var i=0;
i<tempMedia.length;
i++){var obj=tempMedia[i];
if(typeof obj.name==="undefined"){obj.name="";
}if(typeof obj.contentTypeDisplay==="undefined"){obj.contentTypeDisplay="";
}var contentTypeObj=$.grep(contentTypes,function(ctObj){return ctObj.key===obj.contentTypeKey;
});
if(contentTypeObj.length>0){maintainPriv=contentTypeObj[0].maintainPrivilege;
}if(this.m_menuGroupBy===0){if((obj.groupIdentifier&&obj.groupIdentifier!==obj.identifier)||(obj.groupIdentifier===undefined)){imageObject=this.imageRecord(obj.identifier,obj.name,obj.serviceDate,obj.contentTypeDisplay,this.getBaseURL()+"thumbnail/"+obj.identifier+"?size=5&generic=1",obj.mimeType,obj.groupIdentifier,maintainPriv,obj.version,obj.size,obj.contentTypeKey);
patientImages.push(imageObject);
imageIdList.push('"'+obj.identifier+'"');
}}else{imageObject=this.imageRecord(obj.identifier,obj.name,obj.serviceDate,obj.contentTypeDisplay,this.getBaseURL()+"thumbnail/"+obj.identifier+"?size=5&generic=1",obj.mimeType,obj.groupIdentifier,maintainPriv,obj.version,obj.size,obj.contentTypeKey);
patientImages.push(imageObject);
imageIdList.push('"'+obj.identifier+'"');
}}}catch(err){throw (err);
}}this.m_viewableImageIds=imageIdList;
return patientImages;
};
MediaGalleryO2Component.prototype.generateNavPaneContent=function(imageGrpArr){this.$rootNode.find(".mmf2-nav-content").empty();
var imageGrpArrLen=imageGrpArr.length;
var compId=this.getComponentId();
var navPaneContentHtml="";
var grpByStr=this.mmf2I18n.GROUP_BY+" : ";
if(this.m_menuGroupBy===1){grpByStr+=this.mmf2I18n.CONTENT_TYPE;
}else{grpByStr+=this.mmf2I18n.DATE;
}navPaneContentHtml+='<div class = "mmf2-nav-header"><div class="mmf2-nav-header-title">'+grpByStr+'</div><div id="mmf2NavPanePin'+compId+'"class="mmf2-nav-pin"></div></div><div class= "mmf2-nav-row-content">';
for(var i=0;
i<imageGrpArrLen;
i++){var groupArr=[];
if(this.m_menuGroupBy===1){groupArr=imageGrpArr[i];
var contentType=groupArr[0].contentType;
var groupCnt=0;
for(var j=0;
j<groupArr.length;
j++){if(groupArr[j].groupId===undefined){groupCnt++;
}else{if(groupArr[j].hasOwnProperty("subImage")){groupCnt=groupCnt+groupArr[j].subImage.length;
}}}navPaneContentHtml+='<div class="mmf2-nav-row"><div class="mmf2-nav-row-title" title="'+contentType+'">'+contentType+'</div><div class="mmf2-nav-row-cnt">('+groupCnt+")</div></div>";
}else{groupArr=imageGrpArr[i];
var imageDateObj=new Date(groupArr[0].serviceDate*1000);
var options={weekday:"short",year:"numeric",month:"short",day:"numeric"};
var imageDate=imageDateObj.toLocaleDateString(options);
navPaneContentHtml+='<div class="mmf2-nav-row"><div class="mmf2-nav-row-title" title="'+imageDate+'">'+imageDate+'</div><div class="mmf2-nav-row-cnt">('+groupArr.length+")</div></div>";
}}navPaneContentHtml+="</div>";
return navPaneContentHtml;
};
MediaGalleryO2Component.prototype.imageGroup=function(displayImages){var component=this;
var sImageGrpListHTML=[];
var ordArray=[];
function imageDateSorter(a,b){var aDate=a.serviceDate;
var bDate=b.serviceDate;
if(aDate>bDate){return 1;
}else{if(aDate<bDate){return -1;
}else{return 0;
}}}function imageContentTypeSorter(a,b){var aContentTypeDisplay=a.contentType.toUpperCase();
var bContentTypeDisplay=b.contentType.toUpperCase();
if(aContentTypeDisplay>bContentTypeDisplay){return 1;
}else{if(aContentTypeDisplay<bContentTypeDisplay){return -1;
}else{return 0;
}}}function imageDescriptionSorter(a,b){var aName=a.description.toUpperCase();
var bName=b.description.toUpperCase();
if(aName>bName){return 1;
}else{if(aName<bName){return -1;
}else{return 0;
}}}function imageGroupIdSorter(a,b){var aGroupIdentifier=a.groupId;
var bGroupIdentifier=b.groupId;
if(aGroupIdentifier>bGroupIdentifier){return 1;
}else{if(aGroupIdentifier<bGroupIdentifier){return -1;
}else{return 0;
}}}function generateHTMLdisplayImage(tempImage){var ImageId=tempImage.imageId;
var imageIdStr=ImageId.substring(1,ImageId.length-1);
var sImageListHTML=[];
var serviceDateObj=new Date(tempImage.serviceDate*1000);
var sServiceDate=serviceDateObj.toLocaleDateString();
var sServiceTime=serviceDateObj.toLocaleTimeString();
sImageListHTML.push("<div class='mmf2-image' image-name = \"",tempImage.description,'">');
sImageListHTML.push("<div class='mmf2-imgContain'>");
sImageListHTML.push('<dl class ="mmfgal-o2-info result-info">');
sImageListHTML.push("<img class='mmf2-thumb' id=",imageIdStr," alt= '",tempImage.description,"' src= '",tempImage.imageURL,"'/>");
sImageListHTML.push("<div class='mmf2-iconHolder'></div>");
sImageListHTML.push("</dl>");
sImageListHTML.push("<h4 class='det-hd'>media detail hover</h4>");
sImageListHTML.push('<div class="hvr">');
sImageListHTML.push("<dl class=\"mmf2-det\"><dt><span class='mmf2-hvr-name'>",component.mmf2I18n.NAME,":</span></dt><dd><span class='mmf2-hvr-name'>",tempImage.description,"</span></dd><dt><span>",component.mmf2I18n.CONTENT_TYPE,":</span></dt><dd><span>",tempImage.contentType,"</span></dd><dt><span class='mmf2-hvr-image-container'><img class='mmf2-hvr-image' alt= '",tempImage.description,"' src= '",tempImage.imageURL,"'/></span></dt><dt><span>",component.mmf2I18n.SERVICE_DATE_TIME,":</span></dt><dd><span>",sServiceDate,"&nbsp;",sServiceTime,"</span></dd><dt><span>",component.mmf2I18n.MEDIA_TYPE,":</span></dt><dd><span>",tempImage.mimeType,"</span></dd><dt><span>",component.mmf2I18n.VERSION,":</span></dt><dd><span>",tempImage.versionNumber,"</span></dd></dl>");
sImageListHTML.push("</div>");
sImageListHTML.push("</div>");
if(tempImage.description){sImageListHTML.push("<div class='mmf2-media-name' ><span class='mmf2-imageLaunchViewer' name='&identifier=",tempImage.imageId,"' title=\"",tempImage.description,'" >',tempImage.description,"</span></div>");
}else{sImageListHTML.push("<div class='mmf2-media-name'><span class='mmf2-imageLaunchViewer' name='&identifier=",tempImage.imageId,"' >[",component.mmf2I18n.VIEW,"]</span></div>");
}sImageListHTML.push("</div>");
return sImageListHTML;
}function displayDateGroup(imagesGroup){var i=0;
var imageDateObj=new Date(imagesGroup[i].serviceDate*1000);
var sHyperLinkGroupId="";
var sSectionHeaderHTML=[];
var sImageListHTML=[];
var options={weekday:"short",year:"numeric",month:"short",day:"numeric"};
var imageDate=imageDateObj.toLocaleDateString(options);
for(i=0;
i<imagesGroup.length;
i++){var tempImage=imagesGroup[i];
sHyperLinkGroupId=sHyperLinkGroupId+"&identifier="+tempImage.imageId;
var sImageHTML=generateHTMLdisplayImage(tempImage);
sImageListHTML.push(sImageHTML.join(""));
}sSectionHeaderHTML.push("<div class='sub-sec'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl' title='","Collapse","'>-</span><span class='mmf2-dateLinkLaunchViewer' name='",sHyperLinkGroupId,"'><span class='sub-sec-title'><span class = 'mmf2-grp-hdr'>",imageDate,"</span> (<span class = 'mmf2-grp-cnt'>",imagesGroup.length,"</span>)","</span></span></h3>","<div class='sub-sec-content'>");
ordArray.push(sSectionHeaderHTML.join(""));
ordArray.push(sImageListHTML.join(""));
ordArray.push("</div></div>");
}function displaySubGroup(imagesGroup){var i=0;
var sHyperLinkGroupId="&identifier="+imagesGroup[0].groupId;
var sImageListHTML=[];
for(i=0;
i<imagesGroup.length;
i++){var tempImage=imagesGroup[i];
var arrayHTML=generateHTMLdisplayImage(tempImage);
sImageListHTML.push(arrayHTML.join(""));
}var arrayHTMLandLink=[];
arrayHTMLandLink.push(sImageListHTML,sHyperLinkGroupId);
return arrayHTMLandLink;
}function displayContentTypeGroup(imagesGroup){var i=0;
var imageDateObj=new Date(imagesGroup[i].serviceDate*1000);
var sHyperLinkGroupId="";
var sSectionHeaderHTML=[];
var sImageListHTML=[];
var imgCnt=0;
var sContentTypeDisplay=imagesGroup[0].contentType;
for(i=0;
i<imagesGroup.length;
i++){var tempImage=imagesGroup[i];
if(tempImage.groupId===undefined){sHyperLinkGroupId=sHyperLinkGroupId+"&identifier="+tempImage.imageId;
var arrayHTMLandLink=generateHTMLdisplayImage(tempImage);
sImageListHTML.push(arrayHTMLandLink.join(""));
imgCnt=imgCnt+1;
}else{var groupId=tempImage.groupId;
var groupIdStr=groupId.substring(1,groupId.length-1);
var sGroupHeaderHTML=[];
var subGroupLen=0;
var arrayHTMLandLink=[];
var sSubGroupHyperLinkId="";
var serviceDateObj=new Date(tempImage.serviceDate*1000);
var sServiceDate=serviceDateObj.toLocaleDateString();
var sServiceTime=serviceDateObj.toLocaleTimeString();
var imgInSubGroup=[];
if(tempImage.hasOwnProperty("subImage")){imgInSubGroup=tempImage.subImage;
subGroupLen=imgInSubGroup.length;
arrayHTMLandLink=displaySubGroup(imgInSubGroup);
imgCnt=imgCnt+subGroupLen;
}if(arrayHTMLandLink.length>0){sSubGroupHyperLinkId=arrayHTMLandLink[1];
sHyperLinkGroupId=sHyperLinkGroupId+sSubGroupHyperLinkId;
}sGroupHeaderHTML.push("<div class='sub-sec  mmf2-group'>");
sGroupHeaderHTML.push("<dl class ='mmfgal-o2-info result-info'>");
sGroupHeaderHTML.push("<h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl' title='","Collapse","'>-</span><span class='mmf2-dateLinkLaunchViewer' name='",sSubGroupHyperLinkId,"'><span class='sub-sec-title'><span class = 'mmf2-grp-hdr'>",tempImage.description,"</span> (<span class = 'mmf2-grp-cnt'>",subGroupLen,"</span>)","</span></span></h3>");
sGroupHeaderHTML.push("</dl>");
sGroupHeaderHTML.push("<h4 class='det-hd'>group detail hover</h4>");
sGroupHeaderHTML.push('<div class="hvr">');
sGroupHeaderHTML.push('<dl class="mmf2-det"><dt><span>',component.mmf2I18n.CONTENT_TYPE,":</span></dt><dd><span>",tempImage.contentType,"</span></dd><dt><span>",component.mmf2I18n.NAME,":</span></dt><dd><span>",tempImage.description,"</span></dd><dt><span>",component.mmf2I18n.SERVICE_DATE_TIME,":</span></dt><dd><span>",sServiceDate,"&nbsp;",sServiceTime,"</span></dd></dl>");
sGroupHeaderHTML.push("</div>");
sGroupHeaderHTML.push("<div class='sub-sec-content' id ='",groupIdStr,"'>");
sImageListHTML.push(sGroupHeaderHTML.join(""));
if(arrayHTMLandLink.length>0){sImageListHTML.push(arrayHTMLandLink[0].join(""));
}sImageListHTML.push("</div></div>");
}}sSectionHeaderHTML.push("<div class='sub-sec'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl' title='","Collapse","'>-</span><span class='mmf2-dateLinkLaunchViewer' name='",sHyperLinkGroupId,"'><span class='sub-sec-title'><span class = 'mmf2-grp-hdr'>",sContentTypeDisplay,"</span> (<span class = 'mmf2-grp-cnt'>",imgCnt,"</span>)","</span></span></h3>","<div class='sub-sec-content'>");
ordArray.push(sSectionHeaderHTML.join(""));
ordArray.push(sImageListHTML.join(""));
ordArray.push("</div></div>");
}function groupByContentType(displayImages){var i=0;
var imgGrouping=[];
var imgContentTypeDisplay="";
var arryImgSubGrouping=[];
var contentTypeArray=[];
var grpByContentTypeArray=[];
var contentTypeGroup=[];
component.m_arrayofGrps=[];
while(i<displayImages.length){imgContentTypeDisplay=displayImages[i].contentType;
for(i=i;
i<displayImages.length;
i++){var tempImage=displayImages[i];
var sCompContentTypeDisplay=tempImage.contentType;
if(imgContentTypeDisplay!==sCompContentTypeDisplay){break;
}imgGrouping.push(tempImage);
}var contentTypleList=[];
var imgObj=null;
var groupList=[];
for(var idx=0;
idx<imgGrouping.length;
idx++){imgObj=imgGrouping[idx];
if((imgObj.groupId&&imgObj.groupId===imgObj.imageId)||(imgObj.groupId===undefined)){contentTypleList.push(imgObj);
}else{groupList.push(imgObj);
}}contentTypleList.sort(imageDescriptionSorter);
if(groupList.length>1){groupList.sort(imageGroupIdSorter);
arryImgSubGrouping=groupBySubGroup(groupList);
}else{if(groupList.length===1){arryImgSubGrouping.push(groupList);
}}contentTypeArray=[];
for(var j=0;
j<contentTypleList.length;
j++){var groupId=contentTypleList[j].groupId;
if(groupId===undefined){contentTypeArray.push(contentTypleList[j]);
}else{var groupHeader={};
groupHeader=contentTypleList[j];
for(var y=0;
y<arryImgSubGrouping.length;
y++){var imgInSubGroup=[];
imgInSubGroup=arryImgSubGrouping[y];
if(groupId===imgInSubGroup[0].groupId){groupHeader.subImage=imgInSubGroup;
break;
}}contentTypeArray.push(groupHeader);
}}component.m_arrayofGrps.push(contentTypeArray);
displayContentTypeGroup(contentTypeArray);
imgGrouping.length=0;
}}function groupBySubGroup(groupList){var i=0;
var arryImgSubGrouping=[];
var groupListLen=groupList.length;
if(groupListLen>1){while(i<groupListLen){var imgSubGrouping=[];
var groupId=groupList[i].groupId;
for(i=i;
i<groupListLen;
i++){var tempImage=groupList[i];
if(groupId!==tempImage.groupId){break;
}imgSubGrouping.push(tempImage);
}if(imgSubGrouping.length>1){imgSubGrouping.sort(imageDescriptionSorter);
}arryImgSubGrouping.push(imgSubGrouping);
}}return arryImgSubGrouping;
}if(component.m_menuGroupBy===0){displayImages.sort(imageDateSorter);
var i=displayImages.length-1;
var imageDateObj=null;
var imageDate="";
var imgGrouping=[];
component.m_arrayofGrps=[];
while(i>-1){imageDateObj=new Date(displayImages[i].serviceDate*1000);
imageDate=imageDateObj.toLocaleDateString();
for(i=i;
i>=0;
i--){var tempImage=displayImages[i];
var compDate=new Date(tempImage.serviceDate*1000);
var sCompDate=compDate.toLocaleDateString();
if(imageDate!==sCompDate){break;
}imgGrouping.push(tempImage);
}displayDateGroup(imgGrouping);
component.m_arrayofGrps.push(imgGrouping);
imgGrouping=[];
}}else{displayImages.sort(imageContentTypeSorter);
groupByContentType(displayImages);
}return ordArray;
};
MediaGalleryO2Component.prototype.enableActions=function(imageId,compId){_g("mgViewBtn"+compId).disabled=false;
_g("mgClearBtn"+compId).disabled=false;
var inactivateBtn=_g("mgInactivateBtn"+compId);
var renameBtn=_g("mgRenameBtn"+compId);
if((inactivateBtn&&inactivateBtn.disabled===true)||(renameBtn&&renameBtn.disabled===true)){var component=MP_Util.GetCompObjById(compId);
var imageListing=component.getPatientImages();
var mediaId="{"+imageId+"}";
var mediaArray=$.grep(imageListing,function(mediaObj){return mediaObj.imageId===mediaId;
});
if(mediaArray.length>0){if(mediaArray[0].maintainPriv==="true"){if(inactivateBtn){inactivateBtn.disabled=false;
}if(renameBtn){renameBtn.disabled=false;
}}}}_g("mgReviewBtn"+compId).disabled=false;
};
MediaGalleryO2Component.prototype.disableActions=function(compId){_g("mgViewBtn"+compId).disabled=true;
_g("mgClearBtn"+compId).disabled=true;
var inactivateBtn=_g("mgInactivateBtn"+compId);
if(inactivateBtn){inactivateBtn.disabled=true;
}var renameBtn=_g("mgRenameBtn"+compId);
if(renameBtn){renameBtn.disabled=true;
}_g("mgReviewBtn"+compId).disabled=true;
};
MediaGalleryO2Component.prototype.getCAMMURL=function(url){var CAMM_URL="";
if(CERN_Platform.inMillenniumContext()){try{g_MediaGadgetO2XMLHttpRequestObj.open("GET",url,false);
window.location="javascript:MPAGES_SVC_AUTH(g_MediaGadgetO2XMLHttpRequestObj)";
g_MediaGadgetO2XMLHttpRequestObj.send();
if(g_MediaGadgetO2XMLHttpRequestObj.status===200){var Links=JSON.parse(g_MediaGadgetO2XMLHttpRequestObj.responseText);
CAMM_URL=Links.link;
MP_Util.LogInfo("MMF Media Gallery :getCAMMURL: "+CAMM_URL);
}else{MP_Util.LogInfo("mediagallery-o2.js: getCAMMURL: Failed to retrieve the CAMM URL from Service Directory:"+g_MediaGadgetO2XMLHttpRequestObj.status);
}}catch(err){MP_Util.LogJSError(this,err,"mediagallery-o2.js","getCAMMURL");
throw (err);
}}else{CAMM_URL="/camm-mpage/"+this.m_fullCanonicalDomainName+"/service/";
}return(CAMM_URL);
};
MediaGalleryO2Component.prototype.getCAMMOrigin=function(){var returnCammOrigin="";
if(CERN_Platform.inMillenniumContext()){var cammOrigin=this.getBaseURL().match("^http.?://[^/]*/").toString();
returnCammOrigin=cammOrigin.length>0?cammOrigin.substring(0,cammOrigin.length-1):"";
}else{returnCammOrigin=window.location.protocol+"//"+window.location.hostname;
}logger.logMessage("this.getCAMMOrigin(): "+returnCammOrigin);
return returnCammOrigin;
};
MediaGalleryO2Component.prototype.retrieveMedia=function(url){MP_Util.LogInfo("MMF Media Gallery O2:retrieveMedia:URL:"+url);
if(g_MediaGadgetO2XMLHttpRequestObj){try{g_MediaGadgetO2XMLHttpRequestObj.open("GET",url,false);
if(CERN_Platform.inMillenniumContext()){window.location="javascript:MPAGES_SVC_AUTH(g_MediaGadgetO2XMLHttpRequestObj)";
}g_MediaGadgetO2XMLHttpRequestObj.withCredentials=true;
g_MediaGadgetO2XMLHttpRequestObj.send();
}catch(err){MP_Util.LogJSError(this,err,"mediagallery-o2.js","retrieveMedia");
throw (err);
}if(g_MediaGadgetO2XMLHttpRequestObj.status===200){var vartest=g_MediaGadgetO2XMLHttpRequestObj.responseText;
try{this.setMediaStash(JSON.parse(vartest));
MP_Util.LogInfo("MMF Media Gallery O2:retrieveMedia:responseText:"+vartest);
}catch(err){MP_Util.LogJSError(this,err,"mediagallery-o2.js","retrieveMedia");
throw (err);
}}else{var errMgs="RetrieveMedia returned unsuccessful status: "+g_MediaGadgetO2XMLHttpRequestObj.status;
MP_Util.LogError(errMgs);
throw errMgs;
}}};
MediaGalleryO2Component.prototype.getAllContentTypes=function(url){var subTimerName=this.getCriterion().category_mean;
var slaTimer=MP_Util.CreateTimer("ENG:MPG.MMF.GALLERY.02 _ Get Content Types");
MP_Util.LogInfo("MMF Media Gallery O2:getAllContentTypes:URL:"+url);
if(g_MediaGadgetO2XMLHttpRequestObj){try{if(slaTimer){slaTimer.SubtimerName=subTimerName;
slaTimer.Start();
}g_MediaGadgetO2XMLHttpRequestObj.open("GET",url,false);
if(CERN_Platform.inMillenniumContext()){window.location="javascript:MPAGES_SVC_AUTH(g_MediaGadgetO2XMLHttpRequestObj)";
}g_MediaGadgetO2XMLHttpRequestObj.send();
}catch(err){if(slaTimer){slaTimer.Abort();
}MP_Util.LogJSError(this,err,"mediagallery-o2.js","getAllContentTypes");
throw (err);
}if(g_MediaGadgetO2XMLHttpRequestObj.status===200){var responseText=JSON.parse(g_MediaGadgetO2XMLHttpRequestObj.responseText);
if(slaTimer){slaTimer.Stop();
}var contentTypes=responseText.ContentType;
try{this.setContentTypesJSON(contentTypes);
MP_Util.LogInfo("MMF Media Gallery O2:getAllContentTypes:responseText:"+responseText);
}catch(err){if(slaTimer){slaTimer.Abort();
}MP_Util.LogJSError(this,err,"mediagallery-o2.js","getAllContentTypes");
throw (err);
}}else{if(slaTimer){slaTimer.Abort();
}var errMgs="getAllContentTypes returned unsuccessful status: "+g_MediaGadgetO2XMLHttpRequestObj.status;
MP_Util.LogError(errMgs);
throw (errMgs);
}}};
MediaGalleryO2Component.prototype.renderComponent=function(recordData){var compId=this.getComponentId();
var countText="";
var imageSum=0;
var ordArray=[];
var SERVICE_DIR_KEY="/keys/urn:cerner:api:mmf-camm-mpage-app-service-1.0.json";
var catName=this.getCriterion().category_mean;
var component=this;
var contentTypeKeys=[];
this.$rootNode=$(component.getRootComponentNode());
try{var url=recordData.SERVICE_DIRECTORY_URL+SERVICE_DIR_KEY;
this.m_fullCanonicalDomainName=recordData.FULLCANONICALDOMAINNAME;
var CAMMURL=this.getCAMMURL(url);
this.m_baseServiceURL=CAMMURL;
this.setMenuShowRelatedDocsInd(0);
this.m_MediaViewerURL=recordData.URL;
this.setContentTypeFilterList(recordData.CONTENT_TYPES);
var contentTypeFilterList=this.getContentTypeFilterList();
var contentTypeListLen=contentTypeFilterList.length;
if(contentTypeListLen>0){for(var idx=0;
idx<contentTypeListLen;
idx++){var filterObj=contentTypeFilterList[idx];
contentTypeKeys.push(filterObj.CONTENT_TYPE_KEY);
}contentTypeKeys.toString();
}if(CAMMURL){var sParams=this.getURLParams();
if(contentTypeKeys.length>0){sParams=sParams+"&contentType="+contentTypeKeys;
this.setURLParams(sParams);
}this.retrieveMedia(CAMMURL+sParams);
}var savedUserPrefs=this.getPreferencesObj();
if(savedUserPrefs!==null&&savedUserPrefs.media_gallery_prefs!==null){this.m_menuGroupBy=savedUserPrefs.media_gallery_prefs.GROUP_BY_PREF;
component.compMenuReference["compMenuGroupByContentType"+compId].setIsSelected(this.m_menuGroupBy===1?true:false);
}if(recordData.CONTENT_TYPES.length>0){this.displayFilterApplied();
}this.getAllContentTypes(CAMMURL+"contentTypes");
this.displayBodyContent();
MPageComponent.prototype.resizeComponent.call(this,null);
component.compMenuReference["compMenuShowRelatedDoc"+compId].setIsSelected(false);
}catch(err){MP_Util.LogJSError(this,err,"mediagallery-o2.js","renderComponent");
throw (err);
}};
MediaGalleryO2Component.prototype.displayBodyContent=function(){var compId=this.getComponentId();
var countText="";
var imageSum=0;
var ordArray=[];
var component=this;
var imageListing=[];
var imageListingLen=0;
var zoomBarHTML="";
var small="32";
var medium="116";
var large="200";
var checkInputRangeBrowserSupport=$("<input type=range>");
if(checkInputRangeBrowserSupport[0].type==="range"){zoomBarHTML='<div class = "mmf2-zoom-section"><div class = "mmf2-size-label">'+component.mmf2I18n.SIZE+':</div><div id = "mmf2ZoomContainer'+compId+'" class = "mmf2-zoom-container"><input type="range" min=32 max=200 value="'+this.m_thumbNailSize+'"id="mmf2ZoomBar'+compId+'" class ="mmf2-zoom-bar"  list="mmf2SizeSettings'+compId+'"/><datalist id="mmf2SizeSettings'+compId+'"><option>'+small+"</option><option>"+medium+"</option><option>"+large+"</option></datalist></div></div>";
}if(this.getMediaStash()!==null){imageListing=this.findImages();
imageListingLen=imageListing.length;
this.setPatientImages(imageListing);
}ordArray.push("<div id='mmf2contentMainDiv",compId,"'>");
ordArray.push("<div class='mmf2-viewselection-row' id='mgbuttonViewRow",compId,"'><div class= 'mmf2-btn-section'>");
ordArray.push("<button class='mmf2-header-btn' id='mgViewBtn",compId,"' disabled='true' title='",component.mmf2I18n.VIEW_SELECTION,"'>",component.mmf2I18n.VIEW_SELECTION,"</button>");
ordArray.push("<button class='mmf2-header-btn' id='mgClearBtn",compId,"' disabled='true' title='",component.mmf2I18n.CLEAR_SELECTION,"'>",component.mmf2I18n.CLEAR_SELECTION,"</button>");
ordArray.push("<button class='mmf2-header-btn' id='mgInactivateBtn",compId,"' disabled='true' title='",component.mmf2I18n.INACTIVATE,"'>",component.mmf2I18n.INACTIVATE,"</button>");
ordArray.push("<button class='mmf2-header-btn' id='mgRenameBtn",compId,"' disabled='true' title='",component.mmf2I18n.RENAME_BTN,"'>",component.mmf2I18n.RENAME_BTN,"</button>");
ordArray.push("<button class='mmf2-header-btn' id='mgReviewBtn",compId,"' disabled='true' title='",component.mmf2I18n.REVIEW_BTN,"'>",component.mmf2I18n.REVIEW_BTN,"</button></div>");
ordArray.push("<div class = 'mmf2-search-section'><div class='mmf2-search-box'>",MP_Util.CreateAutoSuggestBoxHtml(this),"</div></div>");
if(zoomBarHTML!==""){ordArray.push(zoomBarHTML);
}ordArray.push("</div>");
if(imageListingLen===0){ordArray.push("<div class='mmf2-content-body'> ");
ordArray.push("<div><span class = 'res-none'>",i18n.NO_RESULTS_FOUND,"</span></div>");
}else{for(var i=0;
i<imageListingLen;
i++){var obj=imageListing[i];
if((obj.groupId&&obj.groupId!==obj.imageId)||(obj.groupId===undefined)){imageSum=imageSum+1;
}}var imgGrpHTML=this.imageGroup(imageListing);
var navContent=this.generateNavPaneContent(this.m_arrayofGrps);
var navPane='<div id="mmf2NavPan'+compId+'" class="mmf2-nav-panel"><div class="mmf2-nav-button" id="mmf2NavBtn'+compId+'"><div class = "mmf2-nav-button-icon mmf2-nav-unselected-collapsed"></div></div><div class="mmf2-nav-content" id="mmf2NavContent'+compId+'">'+navContent+"</div></div>";
ordArray.push(navPane);
ordArray.push("<div class='content-body mmf2-content-body' oncontextmenu='return false;'>");
ordArray.push(imgGrpHTML.join(""));
}ordArray.push("</div>");
ordArray.push("</div><div class = 'mmf2-review-pane' id='mmf2contentReviewDiv",compId,"'></div>");
countText=MP_Util.CreateTitleText(this,imageSum);
this.applyTemplate("list-as-table");
MP_Util.Doc.FinalizeComponent(ordArray.join(""),this,countText);
this.$rootNode.off("click",".mmf2-imgContain");
this.$rootNode.on("click",".mmf2-imgContain",function(){MediaGalleryO2Component.prototype.doSelect.apply(this,[compId]);
});
var name=this.getCriterion().category_mean;
this.$rootNode.off("click","#mgViewBtn"+compId);
this.$rootNode.on("click","#mgViewBtn"+compId,function(){MediaGalleryO2Component.prototype.launchMediaViewer.apply(this,[compId,component.m_MediaViewerURL,name]);
});
this.$rootNode.off("click","#mgClearBtn"+compId);
this.$rootNode.on("click","#mgClearBtn"+compId,function(){MediaGalleryO2Component.prototype.clearMediaSelection.apply(this,[compId]);
});
this.$rootNode.off("click","#mgRenameBtn"+compId);
this.$rootNode.on("click","#mgRenameBtn"+compId,function(){MediaGalleryO2Component.prototype.renameMedia.apply(this,[compId]);
});
this.$rootNode.off("click","#mgReviewBtn"+compId);
this.$rootNode.on("click","#mgReviewBtn"+compId,function(){MediaGalleryO2Component.prototype.reviewMedia.apply(this,[compId]);
});
var searchBox=_g(this.getStyles().getNameSpace()+"ContentCtrl"+compId);
var searchBoxTimeOut=0;
searchBox.value=component.mmf2I18n.SEARCH;
searchBox.className+=" placeholder";
searchBox.onkeyup=function(event){var textBox=this;
event=event||window.event;
var iKeyCode=event.keyCode;
clearTimeout(searchBoxTimeOut);
searchBoxTimeOut=setTimeout(function(){if(iKeyCode===8||iKeyCode===46){component.searchImages(event,textBox,component);
}else{if(iKeyCode<32||(iKeyCode>=33&&iKeyCode<46)||(iKeyCode>=112&&iKeyCode<=123)){}else{component.searchImages(event,textBox,component);
}}},500);
};
searchBox.onblur=function(event){if(this.value===""){this.value=component.mmf2I18n.SEARCH;
$(this).addClass("placeholder");
}};
searchBox.onfocus=function(event){if(this.value===component.mmf2I18n.SEARCH){this.value="";
$(this).removeClass("placeholder");
}};
CERN_EventListener.fireEvent(this,this,EventListener.EVENT_COUNT_UPDATE,{count:imageSum});
};
MediaGalleryO2Component.prototype.searchImages=function(callback,textBox,component){var searchString=textBox.value.toUpperCase();
var rootNode=component.getRootComponentNode();
var imageMainNode=$(rootNode).find(".mmf2-content-body").children();
var imageCnt=-1;
var hiddenImageCnt=-1;
var subGrpImageCnt=-1;
var subGrpHiddenImageCnt=-1;
var subfolderSearchMatch=false;
var headerText="";
var imageName="";
$(imageMainNode).each(function(index,item){imageCnt=$(item).find(".mmf2-image").length;
$(item).find(".mmf2-image").each(function(imgIndex,imgNode){var imageName=$(imgNode).attr("image-name").toUpperCase();
if(imageName.indexOf(searchString)==-1){$(imgNode).addClass("mmf2-force-hidden");
}else{$(imgNode).removeClass("mmf2-force-hidden");
}});
$(item).find(".mmf2-group").each(function(imgIndex,subNode){headerText=$(subNode).find(".mmf2-grp-hdr").text().toUpperCase();
subfolderSearchMatch=(headerText.indexOf(searchString)==-1)?false:true;
if(subfolderSearchMatch){$(subNode).find(".mmf2-force-hidden").removeClass("mmf2-force-hidden");
}subGrpImageCnt=$(subNode).find(".mmf2-image").length;
subGrpHiddenImageCnt=$(subNode).find(".mmf2-image.mmf2-force-hidden").length;
if(subGrpImageCnt===subGrpHiddenImageCnt){$(subNode).addClass("mmf2-force-hidden");
}else{$(subNode).removeClass("mmf2-force-hidden");
$(subNode).find(".sub-sec-hd").find(".mmf2-grp-cnt").text(subGrpImageCnt-subGrpHiddenImageCnt);
}});
hiddenImageCnt=$(item).find(".mmf2-image.mmf2-force-hidden").length;
if(imageCnt===hiddenImageCnt&&imageCnt!==0){$(item).addClass("mmf2-force-hidden");
}else{if(imageCnt!==0){$(item).removeClass("mmf2-force-hidden");
$(item).children(".sub-sec-hd").find(".mmf2-grp-cnt").text(imageCnt-hiddenImageCnt);
}}});
if(searchString.length===0){$(imageMainNode).each(function(index,item){$(item).find(".mmf2-force-hidden").removeClass("mmf2-force-hidden");
});
}};
MediaGalleryO2Component.prototype.displayFilterApplied=function(){var namespace=this.getStyles().getId();
var lbContainer="lookbackContainer"+namespace;
var filterMsgHTML="";
var contentTypeDisplays=[];
var idx=0;
var mmfI18n=i18n.discernabu.mediaGallery_o2;
var contentTypeFilterList=this.getContentTypeFilterList();
var filterContentTypesLen=contentTypeFilterList.length;
if(filterContentTypesLen>0){for(idx=0;
idx<filterContentTypesLen;
idx++){var filterObj=contentTypeFilterList[idx];
contentTypeDisplays.push(filterObj.DISPLAY);
}var filterMegObj=document.getElementById("filterMessage"+namespace);
if(!filterMegObj){filterMsgHTML='<span id="filterMessage'+namespace+'" title="'+mmfI18n.CONTENT_TYPES+": "+contentTypeDisplays.join(", ")+'" class="mmf2-filter-applied-message"> '+mmfI18n.FILTER_APPLIED+"</span>";
$("#"+lbContainer).append(filterMsgHTML);
}}};
MediaGalleryO2Component.prototype.displayGroupByContentType=function(){this.displayBodyContent();
MPageComponent.prototype.resizeComponent.call(this,null);
this.postProcessing();
if(this.m_menuShowRelatedDocsInd===1){this.generateHTMLShowRelatedDocsIcon();
}this.mediaGalleryo2PrefObj.media_gallery_prefs=this.getPrefJson();
this.setPreferencesObj(this.mediaGalleryo2PrefObj);
this.savePreferences(true);
};
MediaGalleryO2Component.prototype.getMenuShowRelatedDocsInd=function(){return this.m_menuShowRelatedDocsInd;
};
MediaGalleryO2Component.prototype.setMenuShowRelatedDocsInd=function(menuShowRelatedDocsInd){this.m_menuShowRelatedDocsInd=menuShowRelatedDocsInd;
};
MediaGalleryO2Component.prototype.getRelatedDocs=function(imageIds){var criterion=this.getCriterion();
var request=null;
var self=this;
var encntrs=null;
var encntrStr="";
var aSyncIndicator=false;
var imageIdList="";
encntrs=criterion.getPersonnelInfo().getViewableEncounters();
if(CERN_Platform.inMillenniumContext()){encntrStr=(encntrs)?"value("+encntrs+")":"0";
}else{encntrStr=(encntrs)?"value("+encntrs+")":"value("+criterion.encntr_id+".0)";
}if(typeof(imageIds)!=="undefined"){imageIdList="value("+imageIds+")";
}else{imageIdList="value("+this.m_viewableImageIds+")";
aSyncIndicator=true;
}var sendAr=["^MINE^",criterion.person_id+".0",encntrStr,imageIdList,criterion.provider_id+".0",criterion.ppr_cd+".0"];
request=new MP_Core.ScriptRequest(this,"ENG:MPG.MMF.GALLERY.02 _ Get Related Docs");
request.setProgramName("MP_MEDIA_GALLERY_GET_DOCS");
request.setParameters(sendAr);
request.setAsync(aSyncIndicator);
MP_Core.XMLCCLRequestCallBack(this,request,function(reply){if(typeof(imageIds)!=="undefined"){self.loadRelatedDocs(reply);
}else{self.displayShowRelatedDocsIcon(reply);
}});
};
MediaGalleryO2Component.prototype.displayShowRelatedDocsIcon=function(reply){var component=this;
var replyData=null;
var replyStatus="";
replyStatus=reply.getStatus();
if(replyStatus!=="S"){if(replyStatus==="F"){var errMgs="getRelatedDocs returned unsuccessful status: "+replyStatus;
MP_Util.LogError(errMgs);
alert(i18n.ERROR_RETREIVING_DATA);
}else{MP_Util.LogInfo("MMF Media Gallery O2:getRelatedDocs:No results found");
}return;
}replyData=reply.getResponse();
this.m_docData=replyData.DOCS;
this.generateHTMLShowRelatedDocsIcon();
};
MediaGalleryO2Component.prototype.generateHTMLShowRelatedDocsIcon=function(){var component=this;
if(this.m_menuShowRelatedDocsInd===1&&component.m_docData){component.$rootNode.find(".mmf2-iconHolder").each(function(){var imgMenuId=$(this).prev().attr("id");
var docsObject=[];
var docCnt=0;
var docsLen=component.m_docData.length;
if(docsLen){for(var i=0;
i<docsLen;
i++){var curDoc=component.m_docData[i];
var thumbnailId=curDoc.IMAGE_ID;
var thumbnailIdStr=thumbnailId.substring(1,thumbnailId.length-1);
if(thumbnailIdStr===imgMenuId){docsObject[docCnt]=curDoc;
docCnt=docCnt+1;
}}}if(docCnt>0){$(this).addClass("mmf2-show-related-docs-icon");
$(this).click(function(){component.setEditMode(true);
component.displayDocumentsMenu(imgMenuId,docsObject);
$(".hvr.hover").hide();
});
$(this).mouseenter(function(){component.setEditMode(true);
this.activelyHovering=true;
});
$(this).mouseleave(function(){component.setEditMode(false);
this.activelyHovering=false;
});
}});
}};
MediaGalleryO2Component.prototype.removeShowRelatedDocsIcon=function(){if(this.m_menuShowRelatedDocsInd===0){this.$rootNode.find(".mmf2-show-related-docs-icon").removeClass("mmf2-show-related-docs-icon");
}};
MediaGalleryO2Component.prototype.displayDocumentsMenu=function(imgMenuId,objDocs){var component=this;
if(this.docTimeout!==null){this.hideDocumentMenu(this,true);
}this.setEditMode(true);
var docsHTML="";
var compId=this.getComponentId();
var docsLen=objDocs.length;
this.docTimeout=setTimeout(function(){component.hideDocumentMenu(component);
},this.clearTimeoutCount);
this.activelyHovering=true;
if(docsLen){for(var i=0;
i<docsLen;
i++){var curDoc=objDocs[i];
var patId=curDoc.PERSON_ID;
var enctrId=curDoc.ENCNTR_ID;
var evntId=curDoc.EVENT_ID;
var doc=curDoc.EVENT_CD_DISP;
var viewerType=curDoc.VIEWER_TYPE;
var parentEventId=curDoc.PARENT_EVENT_ID;
var docDt=null;
var dateTime=new Date();
if(curDoc.EFFECTIVE_DATE){dateTime.setISO8601(curDoc.EFFECTIVE_DATE);
docDt=MP_Util.DisplayDateByOption(component,dateTime);
}else{docDt=i18n.UNKNOWN;
}docsHTML+="<div class='mmf2-doc-item-opt'><span><span>"+docDt+"<span class ='mmf2-doc-item-name' title = '"+doc+"'><span><a href='#' onclick='ResultViewer.launchAdHocViewer("+evntId+")'>"+doc+"</a></span></span></span></span></div>";
}var docsMnu=Util.cep("div",{className:"mmf2-docs-menu",id:"docsMnu"+compId});
docsMnu.innerHTML=docsHTML;
$(docsMnu).bind("mouseenter",{self:this},function(event){var self=event.data.self;
self.setEditMode(true);
self.activelyHovering=true;
self.docTimeout=setTimeout(function(){self.hideDocumentMenu(self);
},self.clearTimeoutCount);
});
$(docsMnu).bind("mouseleave",{self:this},function(event){var self=event.data.self;
self.setEditMode(false);
self.activelyHovering=false;
event.stopPropagation();
});
$(".mmf2-show-related-docs-icon").bind("mouseleave",{self:this},function(event){var self=event.data.self;
self.activelyHovering=false;
self.setEditMode(false);
event.stopPropagation();
});
var imageMenuId=component.$rootNode.find("#"+imgMenuId).parent();
imageMenuId.append(docsMnu);
Util.cancelBubble();
}};
MediaGalleryO2Component.prototype.hideDocumentMenu=function(component,bypassCheck){if(this.activelyHovering===false||typeof(bypassCheck)!=="undefined"){this.docTimeout=null;
$(".mmf2-docs-menu").remove();
this.setEditMode(false);
}else{this.docTimeout=setTimeout(function(){component.hideDocumentMenu(component);
},this.clearTimeoutCount);
}};
MediaGalleryO2Component.prototype.displayInactivateMediaWarnBox=function(event){var self=(event)?event.data.self:this;
var imageSelCount=self.$rootNode.find(".mmf2-imgContain.mmf2-selected").length;
var mBodyContent="<div class='warning-container'><span class='message-info-text'>"+self.mmf2I18n.INACTIVATE_WARNING.replace(/\{0\}/,imageSelCount)+"</span></div>";
var modalId="MediaGalleryInactivate";
var modalTitle=self.mmf2I18n.INACTIVATE_WARNING_TITLE;
var mDialog=MP_ModalDialog.retrieveModalDialogObject(modalId);
var okButton={};
var cancelButton={};
if(!mDialog){mDialog=new ModalDialog(modalId);
mDialog.setHeaderTitle(modalTitle).setBodyElementId(modalId).setShowCloseIcon(true).setIsBodySizeFixed(false).setTopMarginPercentage(20).setBottomMarginPercentage(20).setLeftMarginPercentage(35).setRightMarginPercentage(35);
okButton=new ModalButton("OkButton");
okButton.setText(i18n.discernabu.CONFIRM_OK).setIsDithered(false).setOnClickFunction(function(){MP_ModalDialog.closeModalDialog(modalId);
self.inactivateMedia(self);
});
mDialog.addFooterButton(okButton);
cancelButton=new ModalButton("cancelButton");
cancelButton.setText(i18n.discernabu.CONFIRM_CANCEL).setIsDithered(false).setOnClickFunction(function(){MP_ModalDialog.closeModalDialog(modalId);
});
mDialog.addFooterButton(cancelButton);
mDialog.setHeaderCloseFunction(function(){MP_ModalDialog.closeModalDialog(modalId);
});
MP_ModalDialog.addModalDialogObject(mDialog);
}MP_ModalDialog.showModalDialog(modalId);
mDialog.setBodyHTML(mBodyContent);
};
MediaGalleryO2Component.prototype.inactivateMedia=function(component){var imageListing=component.getPatientImages();
var warningInd=false;
component.$rootNode.find(".mmf2-imgContain.mmf2-selected").find(".mmf2-thumb").each(function(i,obj){var mediaId="{"+obj.getAttribute("id")+"}";
var mediaArray=$.grep(imageListing,function(mediaObj){return mediaObj.imageId===mediaId;
});
if(mediaArray.length>0){if(mediaArray[0].maintainPriv==="true"){var inactivateURL=component.getBaseURL()+"inactivate/"+mediaId;
try{MP_Util.LogInfo("mediagallery-o2.js: inactivateMedia: inactivateURL:"+inactivateURL);
g_MediaGadgetO2XMLHttpRequestObj.open("POST",inactivateURL,false);
if(CERN_Platform.inMillenniumContext()){window.location="javascript:MPAGES_SVC_AUTH(g_MediaGadgetO2XMLHttpRequestObj)";
}g_MediaGadgetO2XMLHttpRequestObj.send();
if(g_MediaGadgetO2XMLHttpRequestObj.status===200){var responseText=g_MediaGadgetO2XMLHttpRequestObj.responseText;
if(responseText!=="[OK]"){alert(component.mmf2I18n.MSG_ERROR_SAVING_CHANGES+": "+responseText);
}}else{MP_Util.LogInfo("mediagallery-o2.js: inactivateMedia: Failed to inactivate the Media:"+g_MediaGadgetO2XMLHttpRequestObj.status);
}}catch(err){MP_Util.LogJSError(this,err,"mediagallery-o2.js","inactivateMedia");
throw (err);
}}else{MP_Util.LogInfo("mediagallery-o2.js: inactivateMedia: User doesn't have privilege to inactivate the media id:"+mediaId);
warningInd=true;
}}});
if(warningInd){alert(component.mmf2I18n.MSG_INACTIVATE_PRIV);
}component.retrieveMedia(component.getBaseURL()+component.getURLParams());
component.displayBodyContent();
MPageComponent.prototype.resizeComponent.call(component,null);
component.postProcessing();
if(component.m_menuShowRelatedDocsInd===1){component.generateHTMLShowRelatedDocsIcon();
}};
MediaGalleryO2Component.prototype.renameMedia=function(compId){var component=MP_Util.GetCompObjById(compId);
var okButton=null;
var cancelButton=null;
var sDialogHTML=[];
var itemSelectedCnt=component.$rootNode.find(".mmf2-imgContain.mmf2-selected").length;
var MARGIN_20=20;
var MARGIN_35=35;
var modalId="MediaGalleryO2Component_Rename";
var mDialog=new ModalDialog(modalId);
mDialog.setHeaderCloseFunction(function(){MP_ModalDialog.closeModalDialog(modalId);
MP_ModalDialog.deleteModalDialogObject(modalId);
});
mDialog.setHeaderTitle(component.mmf2I18n.RENAME_MEDIA);
okButton=new ModalButton("MediaGalleryO2OKButton");
okButton.setText(i18n.discernabu.CONFIRM_OK).setIsDithered(true).setOnClickFunction(function(){var value=$("#mgRenameTxt"+compId).val();
MP_ModalDialog.closeModalDialog(modalId);
MP_ModalDialog.deleteModalDialogObject(modalId);
component.saveRenameMedia(compId,value);
});
mDialog.addFooterButton(okButton);
cancelButton=new ModalButton("MediaGalleryO2CancelButton");
cancelButton.setText(i18n.discernabu.CONFIRM_CANCEL).setIsDithered(false).setOnClickFunction(function(){MP_ModalDialog.closeModalDialog(modalId);
MP_ModalDialog.deleteModalDialogObject(modalId);
});
mDialog.addFooterButton(cancelButton);
mDialog.setBodyDataFunction(function(modalObj){sDialogHTML.push("<div class='mmf2-rename-dialog-lbl'>",component.mmf2I18n.RENAME_TXT.replace("{0}",itemSelectedCnt),":</div>");
sDialogHTML.push("<div class='mmf2-rename-dialog-txt'><input type='text' id='mgRenameTxt",compId,"' name='newName' value=''></div>");
modalObj.setBodyHTML(sDialogHTML.join(""));
});
mDialog.setTopMarginPercentage(MARGIN_20).setRightMarginPercentage(MARGIN_35).setBottomMarginPercentage(MARGIN_20).setLeftMarginPercentage(MARGIN_35).setIsBodySizeFixed(false);
MP_ModalDialog.addModalDialogObject(mDialog);
MP_ModalDialog.showModalDialog(modalId);
$("#mgRenameTxt"+compId).focus();
var inputBox=$("#mgRenameTxt"+compId);
inputBox.on("keyup",function(event){if(this.value===""){mDialog.setFooterButtonDither("MediaGalleryO2OKButton",true);
}else{mDialog.setFooterButtonDither("MediaGalleryO2OKButton",false);
}});
$("#vwpModalDialogMediaGalleryO2Component_Rename").keydown(function(e){if(e.which===27){MP_ModalDialog.closeModalDialog(modalId);
MP_ModalDialog.deleteModalDialogObject(modalId);
}else{if(e.which===13){var value=$("#mgRenameTxt"+compId).val();
if(value!==undefined){MP_ModalDialog.closeModalDialog(modalId);
MP_ModalDialog.deleteModalDialogObject(modalId);
component.saveRenameMedia(compId,value);
Util.cancelBubble();
}return false;
}}Util.cancelBubble();
});
};
MediaGalleryO2Component.prototype.saveRenameMedia=function(compId,newName){var component=MP_Util.GetCompObjById(compId);
var imageListing=component.getPatientImages();
var warningInd=false;
component.$rootNode.find(".mmf2-imgContain.mmf2-selected").find(".mmf2-thumb").each(function(i,obj){var mediaId="{"+obj.getAttribute("id")+"}";
var mediaArray=$.grep(imageListing,function(mediaObj){return mediaObj.imageId===mediaId;
});
if(mediaArray.length>0){if(mediaArray[0].maintainPriv==="true"){var renameURL=component.getBaseURL()+"maintain/"+mediaId+"?name="+newName+"&version="+mediaArray[0].versionNumber;
try{MP_Util.LogInfo("mediagallery-o2.js: saveRenameMedia: renameURL:"+renameURL);
g_MediaGadgetO2XMLHttpRequestObj.open("POST",renameURL,false);
if(CERN_Platform.inMillenniumContext()){window.location="javascript:MPAGES_SVC_AUTH(g_MediaGadgetO2XMLHttpRequestObj)";
}g_MediaGadgetO2XMLHttpRequestObj.send();
var responseText=g_MediaGadgetO2XMLHttpRequestObj.responseText;
if(g_MediaGadgetO2XMLHttpRequestObj.status!==200){alert(component.mmf2I18n.MSG_ERROR_SAVING_CHANGES+": "+responseText);
MP_Util.LogInfo("mediagallery-o2.js: saveRenameMedia: Failed to rename the Media:"+g_MediaGadgetO2XMLHttpRequestObj.status);
}}catch(err){MP_Util.LogJSError(this,err,"mediagallery-o2.js","saveRenameMedia");
throw (err);
}}else{MP_Util.LogInfo("mediagallery-o2.js: saveRenameMedia: User doesn't have privilege to rename the media id:"+mediaId);
warningInd=true;
}}});
if(warningInd){alert(component.mmf2I18n.MSG_RENAME_PRIV);
}component.retrieveMedia(component.getBaseURL()+component.getURLParams());
component.displayBodyContent();
MPageComponent.prototype.resizeComponent.call(component,null);
component.postProcessing();
if(component.m_menuShowRelatedDocsInd===1){component.generateHTMLShowRelatedDocsIcon();
}};
MediaGalleryO2Component.prototype.reviewMedia=function(compId){var component=MP_Util.GetCompObjById(compId);
var itemSelectedCnt=component.$rootNode.find(".mmf2-imgContain.mmf2-selected").length;
var $mmf2ContentMainDiv=$("#mmf2contentMainDiv"+compId);
var $mmf2ReviewPaneDiv=$("#mmf2contentReviewDiv"+compId);
var imageIdSelectedList=[];
var firstSelectedImageId="";
var reviewPaneHTML="";
var LEFT_KEY=37;
var RIGHT_KEY=39;
var cammOrigin=component.getCAMMOrigin();
var iFrameHtmlPath="/mmf-iframe-messaging/html/mmf-iframe-messaging.html";
var subTimerName=component.getCriterion().category_mean;
var slaTimer=MP_Util.CreateTimer("CAP:MPG_Media_Gallery_o2_Launch_Review_Media",subTimerName);
if(slaTimer){slaTimer.Stop();
}component.$rootNode.find(".mmf2-imgContain.mmf2-selected .mmf2-thumb").each(function(i,obj){var mediaId="{"+obj.getAttribute("id")+"}";
imageIdSelectedList.push('"'+mediaId+'"');
if(i===0){firstSelectedImageId=mediaId;
}});
component.getRelatedDocs(imageIdSelectedList);
component.m_imageIdSelectedList=imageIdSelectedList;
var dv1Height=$mmf2ContentMainDiv.height();
$mmf2ReviewPaneDiv.height(dv1Height);
$mmf2ContentMainDiv.hide();
$("#lookbackContainermmfgal-o2"+compId).hide();
$("#filterMessagemmfgal-o2"+compId).hide();
$("#mainCompRefresh"+compId).hide();
$("#mainCompMenummfgal-o2"+compId).hide();
reviewPaneHTML+="<div class='mmf2-review-pane-left'>";
reviewPaneHTML+="<div class='mmf2-review-pane-left-header' id = 'mmfgal-o2"+compId+"rpLeftHeader'>";
reviewPaneHTML+="<button class='mmf2-review-pane-gallery-btn' id='mgGalleryBtn"+compId+"' title='"+component.mmf2I18n.MEDIA_GALLERY_BTN+"'>< "+component.mmf2I18n.MEDIA_GALLERY_BTN+"</button>";
reviewPaneHTML+="<div class = 'mmf2-review-pane-review-label'>"+component.mmf2I18n.REVIEW_TXT.replace("{0}","("+itemSelectedCnt+")")+"</div></div>";
reviewPaneHTML+=component.generateHTMLrpImageContentArea(itemSelectedCnt);
reviewPaneHTML+="<div class='mmf2-review-pane-left-footer' id = 'mmfgal-o2"+compId+"rpLeftFooterImageTray'>";
reviewPaneHTML+=component.generateHTMLrpFootViewSection();
reviewPaneHTML+="<div class='mmf2-review-pane-nav-container'>";
reviewPaneHTML+="<div class='mmf2-review-pane-nxt-nav-area' id='mmfgal-o2"+compId+"reviewNxtNavArea'>";
reviewPaneHTML+="<div class='mmf2-review-pane-nav-btns mmf2-review-pane-nxt-nav' id='mmfgal-o2"+compId+"reviewNxtNav'>&nbsp;</div>";
reviewPaneHTML+="</div>";
reviewPaneHTML+="<div class='mmf2-review-pane-prev-nav-area' id='mmfgal-o2"+compId+"reviewPrevNavArea'>";
reviewPaneHTML+="<div class='mmf2-review-pane-nav-btns' id='mmfgal-o2"+compId+"reviewPrevNav'>&nbsp;</div>";
reviewPaneHTML+="</div>";
reviewPaneHTML+="<div class='mmf2-review-pane-nav-content'  id='mmf2ReviewPaneNavContent"+compId+"'></div>";
reviewPaneHTML+="</div>";
reviewPaneHTML+="</div>";
reviewPaneHTML+="</div>";
reviewPaneHTML+="<div class='mmf2-review-pane-right' id = 'mmfgal-o2"+compId+"reviewPaneRight'>";
reviewPaneHTML+=component.generateHTMLrpRightBodySection(firstSelectedImageId);
reviewPaneHTML+="</div>";
if(component.isCanvasSupported()){window.addEventListener("message",function(e){logger.logDebug("Entering window message listener");
var img=new Image();
img.onload=function(){logger.logDebug("Entering img.onload");
component.generateCanvas(compId,this,this.width,this.height);
};
img.src=e.data;
});
logger.logMessage("creating iframe src : "+cammOrigin+"/mpage-content/"+component.m_fullCanonicalDomainName+iFrameHtmlPath);
reviewPaneHTML+='<iframe class = "mmf2-iframe-receiver" id="mmfgal-o2'+compId+'iFrameReceiver" src="'+cammOrigin+"/mpage-content/"+component.m_fullCanonicalDomainName+iFrameHtmlPath+'" height="0" width="0"></iframe>';
}$mmf2ReviewPaneDiv.append(reviewPaneHTML);
component.populateImagesOnReviewImageTray();
$mmf2ReviewPaneDiv.show();
component.resizeComponent();
component.populateImageContentOnReviewPane();
component.handleEventsForImgContentNav();
var $mgReviewNxtNavAreaId=$("#mmfgal-o2"+compId+"reviewNxtNavArea");
var $mgReviewPrevNavAreaId=$("#mmfgal-o2"+compId+"reviewPrevNavArea");
var $mgReviewPrevNavId=$("#mmfgal-o2"+compId+"reviewPrevNav");
var $mgReviewNxtNavId=$("#mmfgal-o2"+compId+"reviewNxtNav");
$mgReviewPrevNavAreaId.click(function(){$("#mmf2ReviewPaneNavContent"+compId).animate({scrollLeft:"-=115px"});
if($mgReviewNxtNavId.hasClass("mmf2-review-pane-nxt-nav")===false){$mgReviewNxtNavId.addClass("mmf2-review-pane-nxt-nav");
}});
$mgReviewNxtNavAreaId.click(function(){$("#mmf2ReviewPaneNavContent"+compId).animate({scrollLeft:"+=115px"});
if($mgReviewPrevNavId.hasClass("mmf2-review-pane-prev-nav")===false){$mgReviewPrevNavId.addClass("mmf2-review-pane-prev-nav");
}});
$mgReviewPrevNavAreaId.mouseover(function(){if($mgReviewPrevNavId.hasClass("mmf2-review-pane-prev-nav")){$mgReviewPrevNavId.removeClass("mmf2-review-pane-prev-nav").addClass("mmf2-review-pane-prev-nav-active");
}}).mouseout(function(){if($mgReviewPrevNavId.hasClass("mmf2-review-pane-prev-nav-active")){$mgReviewPrevNavId.removeClass("mmf2-review-pane-prev-nav-active").addClass("mmf2-review-pane-prev-nav");
}});
$mgReviewNxtNavAreaId.mouseover(function(){if($mgReviewNxtNavId.hasClass("mmf2-review-pane-nxt-nav")){$mgReviewNxtNavId.removeClass("mmf2-review-pane-nxt-nav").addClass("mmf2-review-pane-nxt-nav-active");
}}).mouseout(function(){if($mgReviewNxtNavId.hasClass("mmf2-review-pane-nxt-nav-active")){$mgReviewNxtNavId.removeClass("mmf2-review-pane-nxt-nav-active").addClass("mmf2-review-pane-nxt-nav");
}});
$mmf2ReviewPaneDiv[0].onkeydown=function(e){if(e.which===RIGHT_KEY){component.displayNextImageContentInReviewPane();
Util.cancelBubble();
}else{if(e.which===LEFT_KEY){component.displayPrevImageContentInReviewPane();
Util.cancelBubble();
}}};
};
MediaGalleryO2Component.prototype.displayComponentContent=function(compId){var component=MP_Util.GetCompObjById(compId);
var $mmf2contentReviewDiv=$("#mmf2contentReviewDiv"+compId);
var $mmf2contentMainDiv=$("#mmf2contentMainDiv"+compId);
$mmf2contentReviewDiv.hide();
$mmf2contentMainDiv.show();
component.resizeComponent();
$("#lookbackContainermmfgal-o2"+compId).show();
$("#filterMessagemmfgal-o2"+compId).show();
$("#mainCompRefresh"+compId).show();
$("#mainCompMenummfgal-o2"+compId).show();
$mmf2contentReviewDiv.html("");
};
MediaGalleryO2Component.prototype.getImageObjById=function(imageId){var imgObj=null;
var imageListing=this.getPatientImages();
var mediaArray=$.grep(imageListing,function(mediaObj){return mediaObj.imageId===imageId;
});
if(mediaArray.length>0){imgObj=mediaArray[0];
}return imgObj;
};
MediaGalleryO2Component.prototype.populateDetails=function(imageId){var component=this;
var compID=component.getComponentId();
var imageListing=component.getPatientImages();
var sImageDetailHTML="";
var imageIdList=[];
var docsHTML="";
docsHTML=component.generateRelatedDocsHTML(imageId);
var mediaArray=$.grep(imageListing,function(mediaObj){return mediaObj.imageId===imageId;
});
if(mediaArray.length>0){var tempImage=mediaArray[0];
var serviceDateObj=new Date(tempImage.serviceDate*1000);
var sServiceDate=serviceDateObj.toLocaleDateString();
var sServiceTime=serviceDateObj.toLocaleTimeString();
sImageDetailHTML+="<div class='mmf2-review-pane-detail-name'>"+tempImage.description+"</div>";
sImageDetailHTML+="<dl><div class='mmf2-review-pane-detail-label'>"+component.mmf2I18n.NAME+":</div><div class='mmf2-review-pane-detail-dat'>"+tempImage.description+"</div>";
sImageDetailHTML+="<div class='mmf2-review-pane-detail-label'>"+component.mmf2I18n.CONTENT_TYPE+":</div><div class='mmf2-review-pane-detail-dat'>"+tempImage.contentType+"</div>";
sImageDetailHTML+="<div class='mmf2-review-pane-detail-label'>"+component.mmf2I18n.SERVICE_DATE_TIME+":</div><div class='mmf2-review-pane-detail-dat'>"+sServiceDate+"&nbsp;"+sServiceTime+"</div>";
sImageDetailHTML+="<div class='mmf2-review-pane-detail-label'>"+component.mmf2I18n.CREATE_PERSON+":</div><div class='mmf2-review-pane-detail-dat'>--</div>";
sImageDetailHTML+="<div class='mmf2-review-pane-detail-label'>"+component.mmf2I18n.DATE_MODIFIED+":</div><div class='mmf2-review-pane-detail-dat'>--</div>";
sImageDetailHTML+="<div class='mmf2-review-pane-detail-label'>"+component.mmf2I18n.VERSION+":</div><div class='mmf2-review-pane-detail-dat'>"+tempImage.versionNumber+"</div> ";
sImageDetailHTML+="<div class='mmf2-review-pane-detail-label'>"+component.mmf2I18n.MEDIA_TYPE+":</div><div class='mmf2-review-pane-detail-dat'>"+tempImage.mimeType+"</div>";
sImageDetailHTML+="<div class='mmf2-review-pane-detail-label'>"+component.mmf2I18n.SIZE+":</div><div class='mmf2-review-pane-detail-dat'>"+tempImage.size+" KB</div></dl>";
sImageDetailHTML+=docsHTML;
}return sImageDetailHTML;
};
MediaGalleryO2Component.prototype.generateRelatedDocsHTML=function(imageId){var component=this;
var docsHTML="";
var sRelatedDocHeaderHTML="";
var docDataObj=component.getDocDataForSelectedMedias();
var relatedDocsArray=[];
var relatedDocCnt=0;
relatedDocsArray=docDataObj[imageId];
if(relatedDocsArray){relatedDocCnt=relatedDocsArray.length;
}if(relatedDocCnt>0){for(var i=0;
i<relatedDocCnt;
i++){var curDoc=relatedDocsArray[i];
var patId=curDoc.PERSON_ID;
var enctrId=curDoc.ENCNTR_ID;
var evntId=curDoc.EVENT_ID;
var doc=curDoc.EVENT_CD_DISP;
var viewerType=curDoc.VIEWER_TYPE;
var parentEventId=curDoc.PARENT_EVENT_ID;
var docDt=null;
var dateTime=new Date();
if(curDoc.EFFECTIVE_DATE){dateTime.setISO8601(curDoc.EFFECTIVE_DATE);
docDt=MP_Util.DisplayDateByOption(component,dateTime);
}else{docDt=i18n.UNKNOWN;
}docsHTML+="<div class='mmf2-review-pane-related-doc-item'><span><span class='mmf2-review-pane-related-doc-date'>"+docDt+"</span><span  class ='mmf2-doc-item-name' title = '"+doc+"'><span><a href='#' onclick='ResultViewer.launchAdHocViewer("+evntId+")'>"+doc+"</a></span></span></span></div>";
}sRelatedDocHeaderHTML="<fieldset class='mmf2-review-pane-related-doc-fieldset'><legend class='mmf2-review-pane-related-doc-legend'>"+component.mmf2I18n.RELATED_DOCUMENTS.replace("{0}",relatedDocCnt)+"</legend>";
docsHTML=sRelatedDocHeaderHTML+docsHTML+"</fieldset>";
}return docsHTML;
};
MediaGalleryO2Component.prototype.loadRelatedDocs=function(reply){var component=this;
var replyData=null;
var replyStatus="";
var docData=[];
var sMsg="";
var docsHTML="";
var errorModal=null;
replyStatus=reply.getStatus();
if(replyStatus==="F"){var i18nABU=i18n.discernabu;
var errorMessage=i18n.ERROR_RETREIVING_DATA;
MP_Util.LogError("mediagallery-o2.js: getRelatedDocs returned unsuccessful status: "+replyStatus);
errorModal=MP_ModalDialog.retrieveModalDialogObject("errorModal");
if(!errorModal){errorModal=MP_Util.generateModalDialogBody("errorModal","error",errorMessage,i18nABU.INFO_BUTTON_ERROR_ACTION);
errorModal.setHeaderTitle(component.mmf2I18n.RELATED_DOCUMENTS_TITLE);
var closeButton=new ModalButton("closeButton");
closeButton.setText(i18n.CLOSE).setCloseOnClick(true);
errorModal.addFooterButton(closeButton);
}MP_ModalDialog.updateModalDialogObject(errorModal);
MP_ModalDialog.showModalDialog("errorModal");
}else{replyData=reply.getResponse();
docData=replyData.DOCS;
component.setDocDataForSelectedMedias(docData);
}};
MediaGalleryO2Component.prototype.populateImagesOnReviewImageTray=function(){var component=this;
var compId=component.getComponentId();
var $reviewPaneImgContain="";
var imgNodes=component.$rootNode.find(".mmf2-imgContain.mmf2-selected .mmf2-thumb").clone();
for(var cnt=0;
cnt<imgNodes.length;
cnt++){$reviewPaneImgContain=$('<div class="mmf2-review-pane-img-contain">');
if(cnt===0){$reviewPaneImgContain=$('<div class="mmf2-review-pane-img-contain mmf2-review-pane-selected">');
}$reviewPaneImgContain.append(imgNodes[cnt]).appendTo("#mmf2ReviewPaneNavContent"+compId);
}component.$rootNode.on("click",".mmf2-review-pane-img-contain",function(){var button=this;
component.displayUnsavedModalDialog(compId,function(){component.selectImageOnReviewPane.apply(button,[compId]);
});
});
};
MediaGalleryO2Component.prototype.selectImageOnReviewPane=function(compId,directionInd){var self=this;
var component=MP_Util.GetCompObjById(compId);
var imageId="";
var $rootNode=component.$rootNode;
var imgList=$rootNode.find("#mmf2ReviewPaneNavContent"+compId)[0].children;
var prevSelectedIdx=0;
var newSelectedIdx=0;
var scrollLeftValue=0;
component.removeCanvas(compId);
if(typeof(directionInd)==="undefined"){var $currentSelectedItm=$rootNode.find(".mmf2-review-pane-img-contain.mmf2-review-pane-selected")[0];
for(var i=0;
i<imgList.length;
i++){if(imgList[i]===$currentSelectedItm){prevSelectedIdx=i;
break;
}}$rootNode.find(".mmf2-review-pane-img-contain.mmf2-review-pane-selected").removeClass("mmf2-review-pane-selected");
self.setAttribute("class","mmf2-review-pane-img-contain mmf2-review-pane-selected");
imageId="{"+$(self).find(".mmf2-thumb").attr("id")+"}";
imgList=$rootNode.find("#mmf2ReviewPaneNavContent"+compId)[0].children;
for(var i=0;
i<imgList.length;
i++){if(imgList[i]===self){newSelectedIdx=i;
break;
}}var imgSlideList=$rootNode.find("#mmfgal-o2"+compId+"reviewPaneImgNavContent")[0].children;
for(var i=0;
i<imgSlideList.length;
i++){if(i===newSelectedIdx){$rootNode.find(".active-slide").removeClass("active-slide");
$(imgSlideList[i]).addClass("active-slide");
component.setSelectedIdxOnReviewPane(newSelectedIdx);
break;
}}var scrollDirection=newSelectedIdx-prevSelectedIdx;
var imgContentScrollLeft=$("#mmfgal-o2"+compId+"rpImgContentContainer").width()+8;
var $mgReviewImgPrevNavId=$("#mmfgal-o2"+compId+"reviewImgPrevNav");
var $mgReviewImgNxtNavId=$("#mmfgal-o2"+compId+"reviewImgNxtNav");
if(scrollDirection<0){scrollLeftValue=(scrollDirection*(imgContentScrollLeft)*(-1))+"px";
$("#mmfgal-o2"+compId+"reviewPaneImgNavContent").animate({scrollLeft:"-="+scrollLeftValue});
var $prevSlide=$rootNode.find(".mmf2-review-pane-img-content-container.active-slide").prev();
if($prevSlide.length===0){$mgReviewImgPrevNavId.removeClass("mmf2-review-pane-img-prev-nav");
}if($mgReviewImgNxtNavId.hasClass("mmf2-review-pane-img-nxt-nav")===false){$mgReviewImgNxtNavId.addClass("mmf2-review-pane-img-nxt-nav");
}}else{if(scrollDirection>0){scrollLeftValue=(scrollDirection*(imgContentScrollLeft))+"px";
$("#mmfgal-o2"+compId+"reviewPaneImgNavContent").animate({scrollLeft:"+="+scrollLeftValue});
var $nextSlide=$rootNode.find(".mmf2-review-pane-img-content-container.active-slide").next();
if($nextSlide.length===0){$mgReviewImgNxtNavId.removeClass("mmf2-review-pane-img-nxt-nav");
}if($mgReviewImgPrevNavId.hasClass("mmf2-review-pane-img-prev-nav")===false){$mgReviewImgPrevNavId.addClass("mmf2-review-pane-img-prev-nav");
}}}}else{var $newSelected={};
var rpNavContentClientWidth=$rootNode.find("#mmf2ReviewPaneNavContent"+compId)[0].clientWidth;
var rpNavContentOffsetLeft=$rootNode.find("#mmf2ReviewPaneNavContent"+compId)[0].offsetLeft;
if(directionInd==="N"){$newSelected=$rootNode.find(".mmf2-review-pane-img-contain.mmf2-review-pane-selected").next();
}else{$newSelected=$rootNode.find(".mmf2-review-pane-img-contain.mmf2-review-pane-selected").prev();
}if($newSelected[0]){$rootNode.find(".mmf2-review-pane-img-contain.mmf2-review-pane-selected").removeClass("mmf2-review-pane-selected");
$newSelected.addClass("mmf2-review-pane-selected");
imageId="{"+$newSelected.find(".mmf2-thumb")[0].id+"}";
var offsetLeftOfSelected=$newSelected[0].offsetLeft;
var clientWidthOfSelected=$newSelected[0].clientWidth;
var $mgReviewPrevNavId=$("#mmfgal-o2"+compId+"reviewPrevNav");
var $mgReviewNxtNavId=$("#mmfgal-o2"+compId+"reviewNxtNav");
if(directionInd==="N"&&((offsetLeftOfSelected+clientWidthOfSelected)>rpNavContentClientWidth)){scrollLeftValue=(offsetLeftOfSelected+clientWidthOfSelected)-rpNavContentClientWidth+10+"px";
$("#mmf2ReviewPaneNavContent"+compId).animate({scrollLeft:"+="+scrollLeftValue});
var $nextImgThumb=$rootNode.find(".mmf2-review-pane-img-contain.mmf2-review-pane-selected").next();
if($nextImgThumb.length===0){$mgReviewNxtNavId.removeClass("mmf2-review-pane-nxt-nav-active mmf2-review-pane-nxt-nav");
}if($mgReviewPrevNavId.hasClass("mmf2-review-pane-prev-nav")===false){$mgReviewPrevNavId.addClass("mmf2-review-pane-prev-nav");
}}else{if(directionInd==="P"&&(offsetLeftOfSelected-clientWidthOfSelected<clientWidthOfSelected)){scrollLeftValue=clientWidthOfSelected-(offsetLeftOfSelected-clientWidthOfSelected)+50+"px";
$("#mmf2ReviewPaneNavContent"+compId).animate({scrollLeft:"-="+scrollLeftValue});
var $prevImgThumb=$rootNode.find(".mmf2-review-pane-img-contain.mmf2-review-pane-selected").prev();
if($prevImgThumb.length===0){$mgReviewPrevNavId.removeClass("mmf2-review-pane-prev-nav-active mmf2-review-pane-prev-nav");
}if($mgReviewNxtNavId.hasClass("mmf2-review-pane-nxt-nav")===false){$mgReviewNxtNavId.addClass("mmf2-review-pane-nxt-nav");
}}}}}var sImageDetailHTML=component.populateDetails(imageId);
var $detailsBody=$rootNode.find(".mmf2-review-pane-right-details-body");
$detailsBody.empty();
$(sImageDetailHTML).appendTo($detailsBody);
component.getImgNameOnRpEditTab(imageId);
component.displayReadOnlyMessage(imageId);
component.addCanvas(compId);
};
MediaGalleryO2Component.prototype.generateHTMLrpImageContentArea=function(itemSelectedCnt){var sHTMLrpImageContentArea="";
var component=this;
var compId=component.getComponentId();
sHTMLrpImageContentArea+="<div class='mmf2-review-pane-left-body' id = 'mmfgal-o2"+compId+"rpLeftBody'>";
sHTMLrpImageContentArea+="<div class='mmf2-review-pane-img-nav-container' id='mmfgal-o2"+compId+"reviewImgNavContainer'>";
sHTMLrpImageContentArea+="<div class='mmf2-review-pane-img-nxt-nav-area' id='mmfgal-o2"+compId+"reviewImgNxtNavArea'>";
if(itemSelectedCnt>1){sHTMLrpImageContentArea+="<div class='mmf2-review-pane-img-nav-btns  mmf2-review-pane-img-nxt-nav' id='mmfgal-o2"+compId+"reviewImgNxtNav'>&nbsp;</div>";
}else{sHTMLrpImageContentArea+="<div class='mmf2-review-pane-img-nav-btns' id='mmfgal-o2"+compId+"reviewImgNxtNav'>&nbsp;</div>";
}sHTMLrpImageContentArea+="</div>";
sHTMLrpImageContentArea+="<div class='mmf2-review-pane-img-prev-nav-area' id='mmfgal-o2"+compId+"reviewImgPrevNavArea'>";
sHTMLrpImageContentArea+="<div class='mmf2-review-pane-img-nav-btns' id='mmfgal-o2"+compId+"reviewImgPrevNav'>&nbsp;</div>";
sHTMLrpImageContentArea+="</div>";
sHTMLrpImageContentArea+="<div class='mmf2-review-pane-img-nav-content'  id='mmfgal-o2"+compId+"reviewPaneImgNavContent'></div>";
sHTMLrpImageContentArea+="</div>";
sHTMLrpImageContentArea+="</div>";
return sHTMLrpImageContentArea;
};
MediaGalleryO2Component.prototype.generateHTMLrpFootViewSection=function(){var component=this;
var sHTMLrpViewBtnSection="";
var mmfgalO2compId="mmfgal-o2"+component.getComponentId();
sHTMLrpViewBtnSection+="<div class='mmf2-review-pane-view-sec' id = '"+mmfgalO2compId+"rpViewSection'>";
sHTMLrpViewBtnSection+="<button class='mmf2-review-pane-view-btn' id = '"+mmfgalO2compId+"rpViewBtn' title='"+component.mmf2I18n.VIEW+"'>"+component.mmf2I18n.VIEW+"...</button>";
sHTMLrpViewBtnSection+="</div>";
return sHTMLrpViewBtnSection;
};
MediaGalleryO2Component.prototype.isCanvasSupported=function(){var elem=document.createElement("canvas");
return !!(elem.getContext&&elem.getContext("2d"));
};
MediaGalleryO2Component.prototype.generateHTMLrpRightBodySection=function(sSelectedImageId){var component=this;
var sHTMLrpRightBodySection="";
var sImageDetailHTML="";
var mmfgalO2compId="mmfgal-o2"+component.getComponentId();
sHTMLrpRightBodySection+="<div class='mmf2-review-pane-tab-wrap'>";
sHTMLrpRightBodySection+="<div class='mmf2-review-pane-tabs'>";
sHTMLrpRightBodySection+="<ul>";
sHTMLrpRightBodySection+="<li><a name='tab' id='"+mmfgalO2compId+"tab1' class='mmf2-review-pane-tab active'>";
sHTMLrpRightBodySection+="<span class='mmf2-tab-left-edge'>&nbsp;</span><span class='mmf2-tab-text'>"+i18n.DETAILS+"</span><span class='mmf2-tab-right-edge'>&nbsp;</span></a></li>";
sHTMLrpRightBodySection+="<li><a name='tab' id='"+mmfgalO2compId+"tab2' class='mmf2-review-pane-tab'>";
sHTMLrpRightBodySection+="<span class='mmf2-tab-left-edge'>&nbsp;</span><span class='mmf2-tab-text'>"+component.mmf2I18n.EDIT+"</span><span class='mmf2-tab-right-edge'>&nbsp;</span></a></li>";
sHTMLrpRightBodySection+="</ul>";
sHTMLrpRightBodySection+="</div>";
sHTMLrpRightBodySection+="<hr class='mmf2-review-pane-tab-wrap-hr'>";
sHTMLrpRightBodySection+="<div name='tab_content' id='"+mmfgalO2compId+"tabContent1' class='mmf2-review-pane-tab-content active'>";
sHTMLrpRightBodySection+="<div class='mmf2-review-pane-right-details-body'>";
sImageDetailHTML=component.populateDetails(sSelectedImageId);
sHTMLrpRightBodySection+=sImageDetailHTML;
sHTMLrpRightBodySection+="</div>";
sHTMLrpRightBodySection+="</div>";
sHTMLrpRightBodySection+="<div name='tab_content' id='"+mmfgalO2compId+"tabContent2' class='mmf2-review-pane-tab-content'>";
sHTMLrpRightBodySection+="<div class='mmf2-review-pane-right-edit-body'>";
sHTMLrpRightBodySection+=component.generateHtmlRpEditTab(sSelectedImageId);
sHTMLrpRightBodySection+="</div>";
sHTMLrpRightBodySection+="</div>";
sHTMLrpRightBodySection+="</div>";
return sHTMLrpRightBodySection;
};
MediaGalleryO2Component.prototype.generateHtmlRpEditTab=function(sSelectedImageId){var component=this;
var sHtmlRpEditTabContent="";
var mmfgalO2compId="mmfgal-o2"+component.getComponentId();
var imageName="";
var imgObj=null;
var contentIsReadOnly=component.isContentReadOnly(sSelectedImageId);
imgObj=component.getImageObjById(sSelectedImageId);
if(imgObj){imageName=imgObj.description;
}sHtmlRpEditTabContent+="<div class='mmf2-review-pane-edit-image-name'>"+imageName+"</div>";
sHtmlRpEditTabContent+="<hr class='mmf2-review-pane-edit-line-separator'>";
sHtmlRpEditTabContent+=component.generateHTMLContentReadOnly(contentIsReadOnly);
if(component.isCanvasSupported()){sHtmlRpEditTabContent+="<fieldset class='mmf2-review-pane-edit-tools-fieldset'>";
sHtmlRpEditTabContent+="<legend class='mmf2-review-pane-edit-tools-legend'>"+component.mmf2I18n.ORIENTATION_TOOLS+"</legend>";
sHtmlRpEditTabContent+="<div class='mmf2-review-pane-edit-tools-sec'>";
sHtmlRpEditTabContent+="<ul class='mmf2-review-pane-edit-tools'>";
sHtmlRpEditTabContent+="<li class='mmf2-review-pane-edit-btn mmf2-review-pane-rotate-left' title='"+component.mmf2I18n.ROTATE_COUNTERCLOCKWISE+"'></li>";
sHtmlRpEditTabContent+="<li class='mmf2-review-pane-edit-btn mmf2-review-pane-rotate-right' title='"+component.mmf2I18n.ROTATE_CLOCKWISE+"'></li>";
sHtmlRpEditTabContent+="<li class='mmf2-review-pane-edit-btn mmf2-review-pane-flip-horizontal' title='"+component.mmf2I18n.FLIP_HORIZONTALLY+"'></li>";
sHtmlRpEditTabContent+="<li class='mmf2-review-pane-edit-btn mmf2-review-pane-flip-vertical' title='"+component.mmf2I18n.FLIP_VERTICALLY+"'></li></ul></div>";
sHtmlRpEditTabContent+="</fieldset>";
}else{MP_Util.LogInfo("isCanvasSupported: canvas is not supported");
}sHtmlRpEditTabContent+="<div class='mmf2-review-pane-edit-btn-sec' id='"+mmfgalO2compId+"rpEditButtonSection'>";
sHtmlRpEditTabContent+="<button class='mmf2-review-pane-edit-reset-btn' id='"+mmfgalO2compId+"rpEditResetBtn' disabled='true' title ='"+component.mmf2I18n.RESET+"'>"+component.mmf2I18n.RESET+"</button>";
sHtmlRpEditTabContent+="<button class='mmf2-review-pane-edit-save-btn' id='"+mmfgalO2compId+"rpEditSaveBtn' disabled='true' title ='"+component.mmf2I18n.SAVE_CHANGES+"'>"+component.mmf2I18n.SAVE+"</button>";
sHtmlRpEditTabContent+="</div>";
return sHtmlRpEditTabContent;
};
MediaGalleryO2Component.prototype.getImgNameOnRpEditTab=function(sImageId){var component=this;
var imageName="";
var imgObj=null;
imgObj=component.getImageObjById(sImageId);
if(imgObj){imageName=imgObj.description;
}var $imgNameOnEditTab=component.$rootNode.find(".mmf2-review-pane-edit-image-name");
$imgNameOnEditTab.html(imageName);
};
MediaGalleryO2Component.prototype.populateImageContentOnReviewPane=function(){var component=this;
var compId=component.getComponentId();
var $reviewPaneImgContentContainer="";
var sHTMLrpImgContentContainer="";
var imageListing=component.getPatientImages();
var tempMediaObj={};
var imageTypeList=component.getMineTypeList();
var imageType={};
var rpImgNavContentWidth=$("#mmfgal-o2"+compId+"reviewPaneImgNavContent").width();
var rpImgNavContentHeight=$("#mmfgal-o2"+compId+"reviewPaneImgNavContent").height()-10;
var imgNodes=component.$rootNode.find(".mmf2-imgContain.mmf2-selected .mmf2-thumb").clone();
for(var cnt=0;
cnt<imgNodes.length;
cnt++){if(cnt>0){sHTMLrpImgContentContainer='<div class="mmf2-review-pane-img-content-container" id = "mmfgal-o2'+compId+'rpImgContentContainer" style ="height: '+rpImgNavContentHeight+"px; width:"+rpImgNavContentWidth+'px;">';
}else{sHTMLrpImgContentContainer='<div class="mmf2-review-pane-img-content-container active-slide" id = "mmfgal-o2'+compId+'rpImgContentContainer" style ="height: '+rpImgNavContentHeight+"px; width:"+rpImgNavContentWidth+'px;">';
component.setSelectedIdxOnReviewPane(0);
}$reviewPaneImgContentContainer=$(sHTMLrpImgContentContainer);
var imgId=imgNodes[cnt].id;
var mediaArray=$.grep(imageListing,function(mediaObj){return mediaObj.imageId==="{"+imgId+"}";
});
if(mediaArray.length>0){tempMediaObj=mediaArray[0];
imageType=$.grep(imageTypeList,function(imgType){return imgType===tempMediaObj.mimeType;
});
}var $imageContentNode=imgNodes[cnt];
if(imageType.length>0){var imageContentSrc=component.getBaseURL()+"asImage/{"+imgId+"}?height=768&width=1024";
var sHTML="<img class='mmf2-thumb' id='"+imgId+"' src='"+imageContentSrc+"'>";
$imageContentNode.src=imageContentSrc;
}$reviewPaneImgContentContainer.append($imageContentNode).appendTo("#mmfgal-o2"+compId+"reviewPaneImgNavContent");
}};
MediaGalleryO2Component.prototype.handleEventsForImgContentNav=function(){var component=this;
var compId=component.getComponentId();
var mmfgalO2compId="#mmfgal-o2"+compId;
var $mgReviewImgNxtNavAreaId=$(mmfgalO2compId+"reviewImgNxtNavArea");
var $mgReviewImgPrevNavAreaId=$(mmfgalO2compId+"reviewImgPrevNavArea");
var $mgReviewImgPrevNavId=$(mmfgalO2compId+"reviewImgPrevNav");
var $mgReviewImgNxtNavId=$(mmfgalO2compId+"reviewImgNxtNav");
$mgReviewImgPrevNavAreaId.click(function(){if($mgReviewImgPrevNavId.hasClass("mmf2-review-pane-img-prev-nav-hover")){component.displayUnsavedModalDialog(compId,function(){component.removeCanvas(compId);
component.displayPrevImageContentInReviewPane();
});
}});
$mgReviewImgNxtNavAreaId.click(function(){if($mgReviewImgNxtNavId.hasClass("mmf2-review-pane-img-nxt-nav-hover")){component.displayUnsavedModalDialog(compId,function(){component.removeCanvas(compId);
component.displayNextImageContentInReviewPane();
});
}});
$mgReviewImgPrevNavAreaId.mouseover(function(){if($mgReviewImgPrevNavId.hasClass("mmf2-review-pane-img-prev-nav")){$mgReviewImgPrevNavId.removeClass("mmf2-review-pane-img-prev-nav").addClass("mmf2-review-pane-img-prev-nav-hover");
}}).mouseout(function(){if($mgReviewImgPrevNavId.hasClass("mmf2-review-pane-img-prev-nav-hover")){$mgReviewImgPrevNavId.removeClass("mmf2-review-pane-img-prev-nav-hover").addClass("mmf2-review-pane-img-prev-nav");
}});
$mgReviewImgNxtNavAreaId.mouseover(function(){if($mgReviewImgNxtNavId.hasClass("mmf2-review-pane-img-nxt-nav")){$mgReviewImgNxtNavId.removeClass("mmf2-review-pane-img-nxt-nav").addClass("mmf2-review-pane-img-nxt-nav-hover");
}}).mouseout(function(){if($mgReviewImgNxtNavId.hasClass("mmf2-review-pane-img-nxt-nav-hover")){$mgReviewImgNxtNavId.removeClass("mmf2-review-pane-img-nxt-nav-hover").addClass("mmf2-review-pane-img-nxt-nav");
}});
};
MediaGalleryO2Component.prototype.displayNextImageContentInReviewPane=function(){var component=this;
var compId=component.getComponentId();
var mmfgalO2compId="#mmfgal-o2"+compId;
var $mgReviewImgNxtNavAreaId=$(mmfgalO2compId+"reviewImgNxtNavArea");
var $mgReviewImgPrevNavAreaId=$(mmfgalO2compId+"reviewImgPrevNavArea");
var $mgReviewImgPrevNavId=$(mmfgalO2compId+"reviewImgPrevNav");
var $mgReviewImgNxtNavId=$(mmfgalO2compId+"reviewImgNxtNav");
var imgContentScrollLeft=$(mmfgalO2compId+"rpImgContentContainer").width()+8+"px";
if($mgReviewImgNxtNavId.hasClass("mmf2-review-pane-img-nxt-nav-hover")||$mgReviewImgNxtNavId.hasClass("mmf2-review-pane-img-nxt-nav")){$(mmfgalO2compId+"reviewPaneImgNavContent").animate({scrollLeft:"+="+imgContentScrollLeft});
var $nextSlide=component.$rootNode.find(".mmf2-review-pane-img-content-container.active-slide").next();
if($nextSlide.length>0){component.$rootNode.find(".mmf2-review-pane-img-content-container.active-slide").removeClass("active-slide");
$nextSlide.addClass("active-slide");
component.setSelectedIdxOnReviewPane(component.getSelectedIdxOnReviewPane()+1);
component.selectImageOnReviewPane(compId,"N");
if($nextSlide.next().length===0){$mgReviewImgNxtNavId.removeClass("mmf2-review-pane-img-nxt-nav-hover");
$mgReviewImgNxtNavId.removeClass("mmf2-review-pane-img-nxt-nav");
}if(!$mgReviewImgPrevNavId.hasClass("mmf2-review-pane-img-prev-nav")){$mgReviewImgPrevNavId.addClass("mmf2-review-pane-img-prev-nav");
}}}};
MediaGalleryO2Component.prototype.displayPrevImageContentInReviewPane=function(){var component=this;
var compId=component.getComponentId();
var mmfgalO2compId="#mmfgal-o2"+compId;
var $mgReviewImgNxtNavAreaId=$(mmfgalO2compId+"reviewImgNxtNavArea");
var $mgReviewImgPrevNavAreaId=$(mmfgalO2compId+"reviewImgPrevNavArea");
var $mgReviewImgPrevNavId=$(mmfgalO2compId+"reviewImgPrevNav");
var $mgReviewImgNxtNavId=$(mmfgalO2compId+"reviewImgNxtNav");
var imgContentScrollLeft=$(mmfgalO2compId+"rpImgContentContainer").width()+8+"px";
if($mgReviewImgPrevNavId.hasClass("mmf2-review-pane-img-prev-nav-hover")||$mgReviewImgPrevNavId.hasClass("mmf2-review-pane-img-prev-nav")){$(mmfgalO2compId+"reviewPaneImgNavContent").animate({scrollLeft:"-="+imgContentScrollLeft});
var $prevSlide=component.$rootNode.find(".mmf2-review-pane-img-content-container.active-slide").prev();
if($prevSlide.length>0){component.$rootNode.find(".mmf2-review-pane-img-content-container.active-slide").removeClass("active-slide");
$prevSlide.addClass("active-slide");
component.setSelectedIdxOnReviewPane(component.getSelectedIdxOnReviewPane()-1);
component.selectImageOnReviewPane(compId,"P");
if($prevSlide.prev().length===0){$mgReviewImgPrevNavId.removeClass("mmf2-review-pane-img-prev-nav-hover");
$mgReviewImgPrevNavId.removeClass("mmf2-review-pane-img-prev-nav");
}if(!$mgReviewImgNxtNavId.hasClass("mmf2-review-pane-img-nxt-nav")){$mgReviewImgNxtNavId.addClass("mmf2-review-pane-img-nxt-nav");
}}}};
MediaGalleryO2Component.prototype.expandNavPanel=function(){var compId=this.getComponentId();
var $navPaneBtnIcon=this.$rootNode.find(".mmf2-nav-button-icon");
if(!$("#mmf2NavContent"+compId).is(":animated")){$("#mmf2NavContent"+compId).stop(true,true).animate({width:"200px"},700);
if($navPaneBtnIcon.hasClass("mmf2-nav-unselected-collapsed")){$navPaneBtnIcon.removeClass("mmf2-nav-unselected-collapsed").addClass("mmf2-nav-unselected-expanded");
}if($navPaneBtnIcon.hasClass("mmf2-nav-selected-collapsed")){$navPaneBtnIcon.removeClass("mmf2-nav-selected-collapsed").addClass("mmf2-nav-selected-expanded");
}}};
MediaGalleryO2Component.prototype.collapseNavPanel=function(){var compId=this.getComponentId();
var $navPaneBtnIcon=this.$rootNode.find(".mmf2-nav-button-icon");
if(!$("#mmf2NavContent"+compId).is(":animated")){$("#mmf2NavContent"+compId).stop(true,true).animate({width:"0px"},700);
if($navPaneBtnIcon.hasClass("mmf2-nav-unselected-expanded")){$navPaneBtnIcon.removeClass("mmf2-nav-unselected-expanded").addClass("mmf2-nav-unselected-collapsed");
}if($navPaneBtnIcon.hasClass("mmf2-nav-selected-expanded")){$navPaneBtnIcon.removeClass("mmf2-nav-selected-expanded").addClass("mmf2-nav-selected-collapsed");
}}};
MediaGalleryO2Component.prototype.navPanelPinned=function(){var compId=this.getComponentId();
var navPaneWidth=$("#mmf2NavPan"+compId).outerWidth()+2+"px";
this.$rootNode.find(".mmf2-content-body").css("padding-left",navPaneWidth);
$("#mmf2NavPanePin"+compId).addClass("mmf2-nav-pinned");
};
MediaGalleryO2Component.prototype.navPanelUnpinned=function(){var compId=this.getComponentId();
this.$rootNode.find(".mmf2-content-body").css("padding-left","20px");
$("#mmf2NavPanePin"+compId).removeClass("mmf2-nav-pinned");
this.collapseNavPanel();
};
MediaGalleryO2Component.prototype.rightClickHandler=function(event){var contextMenu=null;
var rgtClickEvent=event;
var self=this;
var viewMenuSelection=null;
var reviewMenuSelection=null;
var renameMenuSelection=null;
var inactivateMenuSelection=null;
var compId=self.getComponentId();
var catName=self.getCriterion().category_mean;
var imageId="";
var $currentTarget=$(rgtClickEvent.currentTarget);
var VIEW_MENU_IDX=0;
var REVIEW_MENU_IDX=1;
var RENAME_MENU_IDX=2;
var INACTIVATE_MENU_IDX=3;
try{if(rgtClickEvent.which===3||rgtClickEvent.button===2){if($currentTarget.is(".sub-sec-hd")){MediaGalleryO2Component.prototype.clearMediaSelection.apply(this,[compId]);
if($currentTarget.parent().is(".sub-sec")===true){$currentTarget.next().find(".mmf2-imgContain").each(function(){$(this).addClass("mmf2-selected");
imageId=$(this).find(".mmf2-thumb").attr("id");
MediaGalleryO2Component.prototype.enableActions.apply(this,[imageId,compId]);
});
}else{$currentTarget.parent().siblings(".sub-sec-content").find(".mmf2-imgContain").each(function(){$(this).addClass("mmf2-selected");
imageId=$(this).find(".mmf2-thumb").attr("id");
MediaGalleryO2Component.prototype.enableActions.apply(this,[imageId,compId]);
});
}}else{if($currentTarget.is(".mmf2-image")){if($(rgtClickEvent.target).closest(".mmf2-docs-menu",$currentTarget).length>0){return;
}if($currentTarget.children().hasClass("mmf2-selected")===false){MediaGalleryO2Component.prototype.clearMediaSelection.apply(this,[compId]);
$currentTarget.children(":first").addClass("mmf2-selected");
imageId=$currentTarget.find(".mmf2-thumb").attr("id");
MediaGalleryO2Component.prototype.enableActions.apply(this,[imageId,compId]);
}}else{return;
}}$(".hvr.hover").hide();
self.setEditMode(true);
contextMenu=MP_MenuManager.getMenuObject("MediaGalleryO2ContextMenu");
if(!contextMenu){contextMenu=new ContextMenu("MediaGalleryO2ContextMenu").setIsRootMenu(true).setAnchorElementId("MediaGalleryO2ContextMenuAnchor").setAnchorConnectionCorner(["bottom","left"]).setContentConnectionCorner(["top","left"]);
viewMenuSelection=new MenuSelection("viewMenuSelection").setLabel(self.mmf2I18n.VIEW).setIsSelected(true).setSelectedClass("");
contextMenu.addMenuItem(viewMenuSelection);
reviewMenuSelection=new MenuSelection("reviewMenuSelection").setLabel(self.mmf2I18n.REVIEW_BTN).setIsSelected(true).setSelectedClass("");
contextMenu.addMenuItem(reviewMenuSelection);
renameMenuSelection=new MenuSelection("renameMenuSelection").setLabel(self.mmf2I18n.RENAME_BTN);
contextMenu.addMenuItem(renameMenuSelection);
inactivateMenuSelection=new MenuSelection("inactivateMenuSelection").setLabel(self.mmf2I18n.INACTIVATE);
contextMenu.addMenuItem(inactivateMenuSelection);
contextMenu.setCloseFunction(function(){self.setEditMode(false);
});
MP_MenuManager.addMenuObject(contextMenu);
}viewMenuSelection=contextMenu.getMenuItemArray()[VIEW_MENU_IDX];
reviewMenuSelection=contextMenu.getMenuItemArray()[REVIEW_MENU_IDX];
renameMenuSelection=contextMenu.getMenuItemArray()[RENAME_MENU_IDX];
inactivateMenuSelection=contextMenu.getMenuItemArray()[INACTIVATE_MENU_IDX];
viewMenuSelection.setIsDisabled(_g("mgViewBtn"+compId).disabled);
reviewMenuSelection.setIsDisabled(_g("mgReviewBtn"+compId).disabled);
renameMenuSelection.setIsDisabled(_g("mgRenameBtn"+compId).disabled);
inactivateMenuSelection.setIsDisabled(_g("mgInactivateBtn"+compId).disabled);
viewMenuSelection.setClickFunction(function(){MediaGalleryO2Component.prototype.launchMediaViewer.apply(this,[compId,self.m_MediaViewerURL,catName]);
self.setEditMode(false);
});
renameMenuSelection.setClickFunction(function(){MediaGalleryO2Component.prototype.renameMedia.apply(this,[compId]);
self.setEditMode(false);
});
inactivateMenuSelection.setClickFunction(function(){self.displayInactivateMediaWarnBox();
self.setEditMode(false);
});
reviewMenuSelection.setClickFunction(function(){MediaGalleryO2Component.prototype.reviewMedia.apply(this,[compId]);
self.setEditMode(false);
});
contextMenu.setXOffset(event.pageX).setYOffset(event.pageY).setAnchorElement();
MP_MenuManager.showMenu("MediaGalleryO2ContextMenu");
contextMenu.removeAnchorElement();
}}catch(err){MP_Util.LogJSError(err,null,"mediagallery_o2.js","rightClickHandler");
}};
MediaGalleryO2Component.prototype.postProcessing=function(){var $self,$scopeObj,$allHyperLinkImages,$currentImageObj;
var catName=this.getCriterion().category_mean;
$self=this;
var compId=$self.getComponentId();
var collapseTimer=null;
var navPanePinned=false;
var mmfgalO2compId="#mmfgal-o2"+compId;
$scopeObj=$("#"+this.m_rootComponentNode.id);
$allHyperLinkImages=$scopeObj.find(".mmf2-imageLaunchViewer, .mmf2-dateLinkLaunchViewer");
for(var i=0;
i<$allHyperLinkImages.length;
i++){$currentImageObj=$allHyperLinkImages[i];
var currentImgAttr=$($currentImageObj).attr("name");
if(currentImgAttr!==null){$($currentImageObj).click({component:$self,imageIdStr:currentImgAttr},function(event){var eData=event.data;
eData.component.launchMediaViewer(compId,eData.component.m_MediaViewerURL,catName,eData.imageIdStr);
});
}}var $imageContainer=$scopeObj.find(".mmf2-imgContain");
var $imageName=$scopeObj.find(".mmf2-media-name");
$imageContainer.width($self.m_thumbNailSize).height($self.m_thumbNailSize);
$imageName.width($self.m_thumbNailSize);
$("#mmf2ZoomBar"+compId).change(function(event){var size=parseInt($(this).val(),10);
$self.m_thumbNailSize=size;
$imageContainer.width(size).height(size);
$imageName.width(size);
});
$self.$rootNode.off("click","#mgInactivateBtn"+compId);
$self.$rootNode.on("click","#mgInactivateBtn"+compId,{self:this},this.displayInactivateMediaWarnBox);
$self.$rootNode.off("click",".mmfgal-o2-info.result-info .sub-sec-hd-tgl");
$self.$rootNode.on("click",".mmfgal-o2-info.result-info .sub-sec-hd-tgl",function(event){$(event.target).closest(".sub-sec.mmf2-group").toggleClass("closed");
});
$scopeObj.keydown(function(e){if(e.which===113){if(_g("mgRenameBtn"+compId).disabled===false){$self.renameMedia(compId);
}Util.cancelBubble();
}});
$self.$rootNode.off("mousedown",".mmf2-image, .sub-sec-hd");
$self.$rootNode.on("mousedown",".mmf2-image, .sub-sec-hd",function(e,dataObj){$self.rightClickHandler(e,dataObj);
Util.cancelBubble();
});
$self.$rootNode.off("click",".mmf2-review-pane-rotate-left");
$self.$rootNode.on("click",".mmf2-review-pane-rotate-left",function(){$self.rotateImage(compId,$self.ORIENTATION_TOOLS.ROTATE_LEFT);
$self.setSaveButton(true);
$self.setCancelButton(true);
});
$self.$rootNode.off("click",".mmf2-review-pane-rotate-right");
$self.$rootNode.on("click",".mmf2-review-pane-rotate-right",function(){$self.rotateImage(compId,$self.ORIENTATION_TOOLS.ROTATE_RIGHT);
$self.setSaveButton(true);
$self.setCancelButton(true);
});
$self.$rootNode.off("click",".mmf2-review-pane-flip-vertical");
$self.$rootNode.on("click",".mmf2-review-pane-flip-vertical",function(){$self.flipImage(compId,$self.ORIENTATION_TOOLS.FLIP_VERTICAL);
$self.setSaveButton(true);
$self.setCancelButton(true);
});
$self.$rootNode.off("click",".mmf2-review-pane-flip-horizontal");
$self.$rootNode.on("click",".mmf2-review-pane-flip-horizontal",function(){$self.flipImage(compId,$self.ORIENTATION_TOOLS.FLIP_HORIZONTAL);
$self.setSaveButton(true);
$self.setCancelButton(true);
});
this.$rootNode.off("click",".mmf2-review-pane-gallery-btn");
this.$rootNode.on("click",".mmf2-review-pane-gallery-btn",function(){var button=this;
$self.displayUnsavedModalDialog(compId,function(){$self.displayComponentContent.apply(button,[compId]);
});
});
this.$rootNode.off("click","#mmfgal-o2"+compId+"rpViewBtn");
this.$rootNode.on("click","#mmfgal-o2"+compId+"rpViewBtn",function(){$self.viewFromReviewHandler();
});
this.$rootNode.off("click","#mmfgal-o2"+compId+"tab1");
this.$rootNode.on("click","#mmfgal-o2"+compId+"tab1",function(){$self.displayUnsavedModalDialog(compId,function(){$self.reviewPaneTabsHandler(1);
$self.removeCanvas(compId);
});
});
this.$rootNode.off("click","#mmfgal-o2"+compId+"tab2");
this.$rootNode.on("click","#mmfgal-o2"+compId+"tab2",function(){$self.reviewPaneTabsHandler(2);
$self.resizeEditTabContent();
$self.addCanvas(compId);
});
this.$rootNode.off("click",mmfgalO2compId+"rpEditSaveBtn");
this.$rootNode.on("click",mmfgalO2compId+"rpEditSaveBtn",function(){$self.saveEditImage();
});
this.$rootNode.off("click",mmfgalO2compId+"rpEditResetBtn");
this.$rootNode.on("click",mmfgalO2compId+"rpEditResetBtn",function(){$self.removeCanvas(compId);
$self.addCanvas(compId);
});
var $groups=$self.$rootNode.find(".content-body.mmf2-content-body").children(".sub-sec");
var $navPanelId=$("#mmf2NavPan"+compId);
var $navPanelPinId=$("#mmf2NavPanePin"+compId);
var $navPanelBtnId=$("#mmf2NavBtn"+compId);
var $navPanelContentId=$("#mmf2NavContent"+compId);
var $navPaneBtnIcon=$self.$rootNode.find(".mmf2-nav-button-icon");
var $mmf2ContentBody=$self.$rootNode.find(".mmf2-content-body");
$navPanelContentId.off("click",".mmf2-nav-row");
$navPanelContentId.on("click",".mmf2-nav-row",function(){var $navPanelHeader=$self.$rootNode.find(".mmf2-nav-header");
if($(this).hasClass("mmf2-nav-selected-row")){$groups.removeClass("mmf2-force-hidden");
$(this).removeClass("mmf2-nav-selected-row");
$navPanelHeader.removeClass("mmf2-nav-header-selected");
if($navPaneBtnIcon.hasClass("mmf2-nav-selected-expanded")){$navPaneBtnIcon.removeClass("mmf2-nav-selected-expanded").addClass("mmf2-nav-unselected-expanded");
}if(!navPanePinned){$mmf2ContentBody.css("padding-left","20px");
$navPanelPinId.removeClass("mmf2-nav-pinned");
}}else{var height=$(".mmf2-nav-panel").height();
$mmf2ContentBody.css("height",height);
$self.$rootNode.find(".mmf2-nav-selected-row").removeClass("mmf2-nav-selected-row");
if($navPaneBtnIcon.hasClass("mmf2-nav-unselected-expanded")){$navPaneBtnIcon.removeClass("mmf2-nav-unselected-expanded").addClass("mmf2-nav-selected-expanded");
}$navPanelHeader.addClass("mmf2-nav-header-selected");
$(this).toggleClass("mmf2-nav-selected-row");
var index=$(this).index();
$groups.removeClass("mmf2-force-hidden");
$groups.addClass("mmf2-force-hidden");
$groups.eq(index).removeClass("mmf2-force-hidden");
$self.navPanelPinned();
}});
var height=$mmf2ContentBody.height();
$navPanelId.css("height",height);
$navPanelBtnId.off("click");
$navPanelBtnId.on("click",function(){if(!$navPanelPinId.hasClass("mmf2-nav-pinned")){if($navPaneBtnIcon.hasClass("mmf2-nav-unselected-collapsed")||$navPaneBtnIcon.hasClass("mmf2-nav-selected-collapsed")){$self.expandNavPanel();
}else{$self.collapseNavPanel();
}}});
$navPanelPinId.off("click");
$navPanelPinId.on("click",function(){if(!$navPanelPinId.hasClass("mmf2-nav-pinned")){navPanePinned=true;
$self.navPanelPinned();
}else{navPanePinned=false;
$self.navPanelUnpinned();
}});
$navPanelId.off("mouseleave,mouseenter");
$navPanelId.mouseleave(function(){if(!$navPanelPinId.hasClass("mmf2-nav-pinned")){if($navPaneBtnIcon.hasClass("mmf2-nav-unselected-expanded")||$navPaneBtnIcon.hasClass("mmf2-nav-selected-expanded")){collapseTimer=setTimeout(function(){$self.collapseNavPanel();
},500);
}}}).mouseenter(function(){if(collapseTimer!==null){clearTimeout(collapseTimer);
}});
};
MediaGalleryO2Component.prototype.viewFromReviewHandler=function(){var component=this;
var catName=component.getCriterion().category_mean;
var compId=component.getComponentId();
var idList=component.m_imageIdSelectedList;
var idListLen=idList.length;
var imageIdStr="";
for(var i=0;
i<idListLen;
i++){var idStr=idList[i];
imageIdStr+="&identifier="+idStr.substring(1,idStr.length-1);
}component.launchMediaViewer(compId,component.m_MediaViewerURL,catName,imageIdStr);
};
MediaGalleryO2Component.prototype.reviewPaneTabsHandler=function(nSelectedTab){var component=this;
var compId=component.getComponentId();
var mmfgalO2compId="mmfgal-o2"+compId;
var x=0;
var sTabContent=mmfgalO2compId+"tabContent"+nSelectedTab;
var contents=component.$rootNode.find(".mmf2-review-pane-tab-content");
var contentsLen=contents.length;
for(x=0;
x<contentsLen;
x++){if(contents[x].id===sTabContent){$(contents[x]).css("display","block");
}else{$(contents[x]).css("display","none");
}}var sTab=mmfgalO2compId+"tab"+nSelectedTab;
var tabs=component.$rootNode.find(".mmf2-review-pane-tabs").find("a");
var tabLen=tabs.length;
for(x=0;
x<tabLen;
x++){if(tabs[x].id===sTab){$(tabs[x]).addClass("active");
}else{$(tabs[x]).removeClass("active");
}}};
MediaGalleryO2Component.prototype.isContentReadOnly=function(sImageId){var component=this;
var docDataObj=component.getDocDataForSelectedMedias();
var imageTypeList=[];
var imageType={};
var imgObj=null;
var isReadOnly=false;
imgObj=component.getImageObjById(sImageId);
if(imgObj.maintainPriv==="true"){imageTypeList=component.getMineTypeList();
imageType=$.grep(imageTypeList,function(imgType){return imgType===imgObj.mimeType;
});
if(imageType.length<=0||docDataObj[sImageId]){isReadOnly=true;
}else{isReadOnly=false;
}}else{isReadOnly=true;
}return isReadOnly;
};
MediaGalleryO2Component.prototype.generateHTMLContentReadOnly=function(contentIsReadOnly){var sHtml="";
var component=this;
var mmfgalO2compId="mmfgal-o2"+component.getComponentId();
var sStyleDisplay="";
if(contentIsReadOnly){sStyleDisplay="block";
}else{sStyleDisplay="none";
}sHtml="<div class='mmf2-review-pane-edit-msg-wrapper' id = '"+mmfgalO2compId+"contentReadOnly' style='display:"+sStyleDisplay+";'><div class='mmf2-review-pane-edit-msg-content'><div class='mmf2-review-pane-edit-msg-notify'><div class='mmf2-review-pane-edit-msg-icon'>&nbsp;</div><div class='mmf2-review-pane-edit-msg-text'><span class='mmf2-review-pane-edit-msg-notify-primary'>"+component.mmf2I18n.CONTENT_IS_READ_ONLY+"</span></div></div></div></div>";
return sHtml;
};
MediaGalleryO2Component.prototype.displayReadOnlyMessage=function(sImageId){var component=this;
var contentReadOnly=component.isContentReadOnly(sImageId);
var mmfgalO2CompIdContentReadOnly="#mmfgal-o2"+component.getComponentId()+"contentReadOnly";
if(contentReadOnly){$(mmfgalO2CompIdContentReadOnly).css("display","block");
}else{$(mmfgalO2CompIdContentReadOnly).css("display","none");
}};
MediaGalleryO2Component.prototype.displayUnsavedModalDialog=function(compId,unsavedModalCallback){var component=MP_Util.GetCompObjById(compId);
var mmfgalO2compId="mmfgal-o2"+compId;
var modalId=mmfgalO2compId+"-unsavedChanges";
var modalTitle="Unsaved Changes";
var imageName=$("#"+mmfgalO2compId+"tabContent1 > div > div.mmf2-review-pane-detail-name").text();
var modalString=component.mmf2I18n.UNSAVED_CHANGES.replace("{0}",imageName);
var mBodyContent="<div class='mmf2-dyn-modal-body-container'><div class='mmf2-icon-container mmf2-warning-icon'></div><div class='modal-text-container'><p>"+modalString+"</p></div></div>";
var mDialog=MP_ModalDialog.retrieveModalDialogObject(modalId);
var isEditTabActive=($("#"+mmfgalO2compId+"tab2").hasClass("active"))?true:false;
var unsavedChanges=!(document.getElementById(mmfgalO2compId+"rpEditResetBtn").disabled);
if(mDialog){MP_ModalDialog.closeModalDialog(modalId);
MP_ModalDialog.deleteModalDialogObject(modalId);
}var $mmfgalO2CompIdContentReadOnly=$("#mmfgal-o2"+compId+"contentReadOnly");
var contentReadOnlyDisplay=$mmfgalO2CompIdContentReadOnly.css("display");
var contentIsReadOnly=(contentReadOnlyDisplay==="block")?true:false;
if(isEditTabActive&&unsavedChanges&&!contentIsReadOnly){var closeButton={};
var applyButton={};
var discardButton={};
mDialog=new ModalDialog(modalId);
mDialog.setHeaderTitle(modalTitle).setHasGrayBackground(true).setBodyElementId(modalId).setShowCloseIcon(true).setIsBodySizeFixed(false).setTopMarginPercentage(20).setBottomMarginPercentage(20).setLeftMarginPercentage(30).setRightMarginPercentage(30).setIconHoverText(modalTitle).setIconClass("warning-icon").setIsIconActive(true);
applyButton=new ModalButton("save");
applyButton.setText(component.mmf2I18n.SAVE).setIsDithered(false).setOnClickFunction(function(){component.saveEditImage();
unsavedModalCallback();
});
discardButton=new ModalButton("doNotSave");
discardButton.setText(component.mmf2I18n.DO_NOT_SAVE).setIsDithered(false).setOnClickFunction(function(){unsavedModalCallback();
});
closeButton=new ModalButton("cancel");
closeButton.setText(component.mmf2I18n.CANCEL).setIsDithered(false).setOnClickFunction(function(){MP_ModalDialog.closeModalDialog(modalId);
});
mDialog.addFooterButton(applyButton);
mDialog.addFooterButton(discardButton);
mDialog.addFooterButton(closeButton);
mDialog.setHeaderCloseFunction(function(){MP_ModalDialog.closeModalDialog(modalId);
});
MP_ModalDialog.addModalDialogObject(mDialog);
MP_ModalDialog.showModalDialog(modalId);
mDialog.setBodyHTML(mBodyContent);
$(".dyn-modal-div").click(function(event){MP_ModalDialog.closeModalDialog(modalId);
});
}else{unsavedModalCallback();
}};
MediaGalleryO2Component.prototype.dataURItoBlob=function(dataURI,dataType){var binary=atob(dataURI.split(",")[1]),array=[];
for(var i=0;
i<binary.length;
i++){array.push(binary.charCodeAt(i));
}return new Blob([new Uint8Array(array)],{type:dataType});
};
MediaGalleryO2Component.prototype.saveEditImage=function(){var component=this;
var personId=component.getPersonId();
var mmfgalO2compId="mmfgal-o2"+component.getComponentId();
var $activeSlide=$(component.$rootNode.find(".active-slide").children()[0]);
var activeImageId=$activeSlide.attr("id");
var sImageId="{"+activeImageId+"}";
var imgObj=component.getImageObjById(sImageId);
var storeURL=component.getBaseURL()+imgObj.contentTypeKey+"/store?personId="+personId+"&identifier="+sImageId+"&version="+imgObj.versionNumber+"&mimeType="+imgObj.mimeType;
var fgCanvas=document.getElementById(mmfgalO2compId+"mmf2Canvas"+activeImageId);
var imgData=component.dataURItoBlob(fgCanvas.toDataURL(imgObj.mimeType),imgObj.mimeType);
try{logger.logMessage("mediagallery-o2.js: saveEditImage: url:"+storeURL);
g_MediaGadgetO2XMLHttpRequestObj.open("POST",storeURL,false);
if(CERN_Platform.inMillenniumContext()){window.location="javascript:MPAGES_SVC_AUTH(g_MediaGadgetO2XMLHttpRequestObj)";
}g_MediaGadgetO2XMLHttpRequestObj.send(imgData);
if(g_MediaGadgetO2XMLHttpRequestObj.status===200){component.setSaveButton(false);
component.setCancelButton(false);
}else{logger.logMessage("mediagallery-o2.js: saveEditImage: Failed to save changes:"+g_MediaGadgetO2XMLHttpRequestObj.status);
component.displayErrorMsg();
}}catch(err){logger.logJSError(err,component,"mediagallery-o2.js","saveEditImage");
throw (err);
}};
MediaGalleryO2Component.prototype.displayErrorMsg=function(){var component=this;
var mBodyContent="<div class='warning-container'><span class='message-info-text'>"+component.mmf2I18n.MSG_ERROR_SAVING_CHANGES+"</span></div>";
var modalId="MediaGalleryO2Error";
var modalTitle=component.mmf2I18n.SAVE_CHANGES;
var mDialog=MP_ModalDialog.retrieveModalDialogObject(modalId);
var okButton={};
if(!mDialog){mDialog=new ModalDialog(modalId);
mDialog.setHeaderTitle(modalTitle).setBodyElementId(modalId).setShowCloseIcon(true).setIsBodySizeFixed(false).setTopMarginPercentage(20).setBottomMarginPercentage(20).setLeftMarginPercentage(40).setRightMarginPercentage(40);
okButton=new ModalButton("OkButton");
okButton.setText(i18n.discernabu.CONFIRM_OK).setIsDithered(false).setOnClickFunction(function(){MP_ModalDialog.closeModalDialog(modalId);
});
mDialog.addFooterButton(okButton);
mDialog.setHeaderCloseFunction(function(){MP_ModalDialog.closeModalDialog(modalId);
});
MP_ModalDialog.addModalDialogObject(mDialog);
}MP_ModalDialog.showModalDialog(modalId);
mDialog.setBodyHTML(mBodyContent);
};
MediaGalleryO2Component.prototype.calculateMaxImageDisplay=function($imageContainer,image){var containerWidth=$imageContainer.width();
var containerHeight=$imageContainer.height();
var imageWidth=image.width;
var imageHeight=image.height;
if(imageHeight>containerHeight||imageWidth>containerWidth){imageHeight*=containerWidth/imageWidth;
imageWidth=containerWidth;
if(imageHeight>containerHeight){imageWidth*=containerHeight/imageHeight;
imageHeight=containerHeight;
}}return{width:Math.floor(imageWidth),height:Math.floor(imageHeight)};
};
MP_Util.setObjectDefinitionMapping("WF_MMF_MED_GAL",MediaGalleryO2Component);
