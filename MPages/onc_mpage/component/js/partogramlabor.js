function PartogramLaborComponentWFStyle(){this.initByNamespace("parto-labor-wf");
}PartogramLaborComponentWFStyle.prototype=new ComponentStyle();
PartogramLaborComponentWFStyle.prototype.constructor=ComponentStyle;
function PartogramLaborComponentWF(criterion){this.dataArr=[];
this.plot=null;
this.dataRange=null;
this.imageFolderPath=null;
this.fetalHeadEngagementMode=null;
this.alertActionLinesVisible=null;
this.alertActionLinesRate=null;
this.dilationUnit=null;
this.setCriterion(criterion);
this.setStyles(new PartogramLaborComponentWFStyle());
this.setComponentLoadTimerName("USR:MPG.PARTOGRAMLABOR.O2 - load component");
this.setComponentRenderTimerName("ENG:MPG.PARTOGRAMLABOR.O2 - render component");
this.setImageFolderPath(this.getCriterion().static_content+"/images/");
this.setRefreshEnabled(false);
this.fetalPositionDataArray=[];
this.fetalPosMisconfigured=false;
this.NOMEN_MAPPING={};
this.groupNameMap={};
this.setResourceRequired(true);
this.fetalPositionImageArray=[];
this.loadTimer=null;
}PartogramLaborComponentWF.prototype=new MPageComponent();
PartogramLaborComponentWF.prototype.constructor=MPageComponent;
PartogramLaborComponentWF.prototype.HOVER_KEY="LABOR";
PartogramLaborComponentWF.prototype.graphBackgroundColored=false;
MP_Util.setObjectDefinitionMapping("WF_PARTO_LABOR",PartogramLaborComponentWF);
PartogramLaborComponentWF.prototype.getDataArr=function(){return this.dataArr;
};
PartogramLaborComponentWF.prototype.setDataArr=function(data){this.dataArr=data;
};
PartogramLaborComponentWF.prototype.getImageFolderPath=function(){return this.imageFolderPath;
};
PartogramLaborComponentWF.prototype.setImageFolderPath=function(path){this.imageFolderPath=path;
};
PartogramLaborComponentWF.prototype.setPlot=function(plot){this.plot=plot;
};
PartogramLaborComponentWF.prototype.getPlot=function(){return this.plot;
};
PartogramLaborComponentWF.prototype.getGraphElement=function(){return this.graphElement;
};
PartogramLaborComponentWF.prototype.setGraphElement=function(el){this.graphElement=el;
};
PartogramLaborComponentWF.prototype.getFetalHeadEngagementMode=function(){return this.fetalHeadEngagementMode;
};
PartogramLaborComponentWF.prototype.setFetalHeadEngagementMode=function(isFifthsPalpableEnabled){this.fetalHeadEngagementMode=isFifthsPalpableEnabled?"FIFTHS_PALPABLE":"FETAL_STATION";
PARTO_GRAPH_BASE.setFetalHeadEngagementMode(this.fetalHeadEngagementMode);
};
PartogramLaborComponentWF.prototype.getAlertActionLinesRate=function(){return this.alertActionLinesRate;
};
PartogramLaborComponentWF.prototype.setAlertActionLinesRate=function(alertActionLinesRate){this.alertActionLinesRate=alertActionLinesRate?0.5:1;
};
PartogramLaborComponentWF.prototype.getAlertActionLinesVisible=function(){return this.alertActionLinesVisible;
};
PartogramLaborComponentWF.prototype.setAlertActionLinesVisible=function(isAlertActionLinesVisible){this.alertActionLinesVisible=isAlertActionLinesVisible;
};
PartogramLaborComponentWF.prototype.getDataRangeForGraph=function(){return this.dataRange;
};
PartogramLaborComponentWF.prototype.setDataRangeForGraph=function(dataRange){this.dataRange=dataRange;
};
PartogramLaborComponentWF.prototype.setOANomen=function(value){if(value.length>1||this.NOMEN_MAPPING[value[0]]){this.fetalPosMisconfigured=true;
}else{var fetalPosImage=new Image();
fetalPosImage.src=this.getImageFolderPath()+"partoLaborFetalPos-S.png";
this.NOMEN_MAPPING[value[0]]=["partoLaborSprite partoLaborFetalPos-S",fetalPosImage];
}};
PartogramLaborComponentWF.prototype.setLOANomen=function(value){if(value.length>1||this.NOMEN_MAPPING[value[0]]){this.fetalPosMisconfigured=true;
}else{var fetalPosImage=new Image();
fetalPosImage.src=this.getImageFolderPath()+"partoLaborFetalPos-SW.png";
this.NOMEN_MAPPING[value[0]]=["partoLaborSprite partoLaborFetalPos-SW",fetalPosImage];
}};
PartogramLaborComponentWF.prototype.setROANomen=function(value){if(value.length>1||this.NOMEN_MAPPING[value[0]]){this.fetalPosMisconfigured=true;
}else{var fetalPosImage=new Image();
fetalPosImage.src=this.getImageFolderPath()+"partoLaborFetalPos-SE.png";
this.NOMEN_MAPPING[value[0]]=["partoLaborSprite partoLaborFetalPos-SE",fetalPosImage];
}};
PartogramLaborComponentWF.prototype.setOPNomen=function(value){if(value.length>1||this.NOMEN_MAPPING[value[0]]){this.fetalPosMisconfigured=true;
}else{var fetalPosImage=new Image();
fetalPosImage.src=this.getImageFolderPath()+"partoLaborFetalPos-N.png";
this.NOMEN_MAPPING[value[0]]=["partoLaborSprite partoLaborFetalPos-N",fetalPosImage];
}};
PartogramLaborComponentWF.prototype.setLOPNomen=function(value){if(value.length>1||this.NOMEN_MAPPING[value[0]]){this.fetalPosMisconfigured=true;
}else{var fetalPosImage=new Image();
fetalPosImage.src=this.getImageFolderPath()+"partoLaborFetalPos-NW.png";
this.NOMEN_MAPPING[value[0]]=["partoLaborSprite partoLaborFetalPos-NW",fetalPosImage];
}};
PartogramLaborComponentWF.prototype.setROPNomen=function(value){if(value.length>1||this.NOMEN_MAPPING[value[0]]){this.fetalPosMisconfigured=true;
}else{var fetalPosImage=new Image();
fetalPosImage.src=this.getImageFolderPath()+"partoLaborFetalPos-NE.png";
this.NOMEN_MAPPING[value[0]]=["partoLaborSprite partoLaborFetalPos-NE",fetalPosImage];
}};
PartogramLaborComponentWF.prototype.setLOTNomen=function(value){if(value.length>1||this.NOMEN_MAPPING[value[0]]){this.fetalPosMisconfigured=true;
}else{var fetalPosImage=new Image();
fetalPosImage.src=this.getImageFolderPath()+"partoLaborFetalPos-W.png";
this.NOMEN_MAPPING[value[0]]=["partoLaborSprite partoLaborFetalPos-W",fetalPosImage];
}};
PartogramLaborComponentWF.prototype.setROTNomen=function(value){if(value.length>1||this.NOMEN_MAPPING[value[0]]){this.fetalPosMisconfigured=true;
}else{var fetalPosImage=new Image();
fetalPosImage.src=this.getImageFolderPath()+"partoLaborFetalPos-E.png";
this.NOMEN_MAPPING[value[0]]=["partoLaborSprite partoLaborFetalPos-E",fetalPosImage];
}};
PartogramLaborComponentWF.prototype.setGraphBackgroundFilter=function(val){this.graphBackgroundColored=val||false;
};
PartogramLaborComponentWF.prototype.RetrieveRequiredResources=function(){if(PartogramBaseComponent.prototype.getPartogramViewID()!==this.getCriterion().category_mean){var messageHTML="<span class='res-none'>"+i18n.discernabu.partogrambaseutil_o2.NOT_PARTOGRAM_VIEW+"</span>";
this.finalizeComponent(messageHTML,"");
return;
}var partogramInfoSR=MP_Resources.getSharedResource("partogramInfo");
if(partogramInfoSR&&partogramInfoSR.isResourceAvailable()&&!jQuery.isEmptyObject(partogramInfoSR.getResourceData())){this.retrieveComponentData();
}else{CERN_EventListener.addListener(this,"partogramInfoAvailable",this.retrieveComponentData,this);
}};
PartogramLaborComponentWF.prototype.loadFilterMappings=function(){var component=this;
function addPartoLaborCurveFilterMap(filterName,functionName,type,field){component.addFilterMappingObject(filterName,{setFunction:functionName,type:type,field:field});
}addPartoLaborCurveFilterMap("WF_PARTO_LABOR_FIFTHS_STATION",this.setFetalHeadEngagementMode,"BOOLEAN","FREETEXT_DESC");
addPartoLaborCurveFilterMap("WF_PARTO_LABOR_FETAL_POS_OA",this.setOANomen,"ARRAY","PARENT_ENTITY_ID");
addPartoLaborCurveFilterMap("WF_PARTO_LABOR_FETAL_POS_LOA",this.setLOANomen,"ARRAY","PARENT_ENTITY_ID");
addPartoLaborCurveFilterMap("WF_PARTO_LABOR_FETAL_POS_ROA",this.setROANomen,"ARRAY","PARENT_ENTITY_ID");
addPartoLaborCurveFilterMap("WF_PARTO_LABOR_FETAL_POS_OP",this.setOPNomen,"ARRAY","PARENT_ENTITY_ID");
addPartoLaborCurveFilterMap("WF_PARTO_LABOR_FETAL_POS_LOP",this.setLOPNomen,"ARRAY","PARENT_ENTITY_ID");
addPartoLaborCurveFilterMap("WF_PARTO_LABOR_FETAL_POS_ROP",this.setROPNomen,"ARRAY","PARENT_ENTITY_ID");
addPartoLaborCurveFilterMap("WF_PARTO_LABOR_FETAL_POS_LOT",this.setLOTNomen,"ARRAY","PARENT_ENTITY_ID");
addPartoLaborCurveFilterMap("WF_PARTO_LABOR_FETAL_POS_ROT",this.setROTNomen,"ARRAY","PARENT_ENTITY_ID");
addPartoLaborCurveFilterMap("WF_PARTO_LABOR_AA_LINES",this.setAlertActionLinesVisible,"BOOLEAN","FREETEXT_DESC");
addPartoLaborCurveFilterMap("WF_PARTO_LABOR_AA_LINES_RATE",this.setAlertActionLinesRate,"BOOLEAN","FREETEXT_DESC");
addPartoLaborCurveFilterMap("WF_PARTO_LABOR_GRAPH_BGCOLOR",this.setGraphBackgroundFilter,"BOOLEAN","FREETEXT_DESC");
};
PartogramLaborComponentWF.prototype.retrieveComponentData=function(){try{var criterion=this.getCriterion();
if(PartogramBaseComponent.prototype.getPartogramViewID()!==criterion.category_mean){var messageHTML="<span class='res-none'>"+i18n.discernabu.partogrambaseutil_o2.NOT_PARTOGRAM_VIEW+"</span>";
this.finalizeComponent(messageHTML,"");
return;
}this.loadTimer=new RTMSTimer(this.getComponentLoadTimerName());
var renderTimer=new RTMSTimer(this.getComponentRenderTimerName());
var groups=this.getGroups();
var groupsLength=groups.length;
if(groupsLength>0){var sendAr=[],i;
var groupNames=["WF_PARTO_LABOR_DILATION","WF_PARTO_LABOR_FIFTHS_PALPABLE","WF_PARTO_LABOR_STATION","WF_PARTO_LABOR_FETAL_POS"];
for(i=0;
i<groupNames.length;
i++){this.groupNameMap[groupNames[i]]=[0];
}var partogramInfoSR=MP_Resources.getSharedResource("partogramInfo");
var partogramStartDate=partogramInfoSR.getResourceData().getPartogramStartDate();
partogramStartDate=MP_Util.CreateDateParameter(partogramStartDate);
sendAr.push("^MINE^",criterion.person_id+".0",criterion.provider_id+".0",criterion.ppr_cd+".0",criterion.encntr_id+".0");
for(i=0;
i<groupsLength;
i++){var group=groups[i];
if(group instanceof MPageEventCodeGroup){this.groupNameMap[group.m_groupName]=group.getEventCodes();
}}for(i=0;
i<groupNames.length;
i++){sendAr.push(MP_Util.CreateParamArray(this.groupNameMap[groupNames[i]],1));
}sendAr.push("^"+partogramStartDate+"^");
var scriptRequest=new ComponentScriptRequest();
scriptRequest.setProgramName("MP_GET_PARTOGRAM_LABOR");
scriptRequest.setParameterArray(sendAr);
scriptRequest.setComponent(this);
scriptRequest.setLoadTimer(this.loadTimer);
scriptRequest.setRenderTimer(renderTimer);
scriptRequest.performRequest();
}else{var noEventCodeMappedMessage="<span class='res-none'>"+i18n.discernabu.partogrambaseutil_o2.NOT_CONFIGURED_BEDROCK_ERR+"</span>";
this.finalizeComponent(noEventCodeMappedMessage,"");
}}catch(err){MP_Util.LogJSError(err,this,"partogramlabor.js","retrieveComponentData");
}};
PartogramLaborComponentWF.prototype.renderComponent=function(recordData){var timerRenderComponent=MP_Util.CreateTimer(this.getComponentRenderTimerName(),this.getCriterion().category_mean);
var renderingCAPTimer=new CapabilityTimer("CAP:MPG.PARTOGRAMLABOR.O2 - rendering component",this.getCriterion().category_mean);
if(renderingCAPTimer){renderingCAPTimer.capture();
}try{var basei18n=i18n.discernabu.partogrambaseutil_o2;
var bodyHTML=[];
var noDataHTML="<span class='res-none'>"+basei18n.NO_RESULTS_FOUND+"</span>";
var dilationCount=recordData.DILATION_CNT;
var fetalPosCount=recordData.FETALPOS_CNT;
var fetalHeadEngModeDataStructureCnt=0;
if(this.getFetalHeadEngagementMode()){if(this.getFetalHeadEngagementMode()==="FIFTHS_PALPABLE"){fetalHeadEngModeDataStructureCnt=recordData.FIFPALPABLE_CNT;
}else{fetalHeadEngModeDataStructureCnt=recordData.STATION_CNT;
}}this.setDataArr(recordData);
var resultsCount=dilationCount+fetalPosCount+fetalHeadEngModeDataStructureCnt;
this.loadTimer.addMetaData("component.resultcount",resultsCount);
if(dilationCount===0&&fetalPosCount===0&&fetalHeadEngModeDataStructureCnt===0){this.finalizeComponent(noDataHTML,MP_Util.CreateTitleText(this,""));
}else{PARTO_GRAPH_BASE.addSubscriber(this);
var graphDiv="partogram-labor-graph-"+this.getStyles().getId();
recordData.DILATION_EVENT_CODE_NAME=PARTO_GRAPH_BASE.removeColonEndOfString(recordData.DILATION_EVENT_CODE_NAME);
recordData.STATION_EVENT_CODE_NAME=PARTO_GRAPH_BASE.removeColonEndOfString(recordData.STATION_EVENT_CODE_NAME);
recordData.FIFPALPABLE_EVENT_CODE_NAME=PARTO_GRAPH_BASE.removeColonEndOfString(recordData.FIFPALPABLE_EVENT_CODE_NAME);
bodyHTML.push('<div class="partogram-container">');
bodyHTML.push('<div class="partogram-container-col-1">');
bodyHTML.push(this.createLegend());
bodyHTML.push("</div>");
bodyHTML.push('<div class="partogram-container-col-2">');
bodyHTML.push(PARTO_GRAPH_BASE.createTopBar(this.getImageFolderPath(),"GRAPH"));
bodyHTML.push('<div id="'+graphDiv+'" class="partogramGraphDiv partoGraphDivLabor"></div>');
bodyHTML.push("</div>");
this.finalizeComponent(bodyHTML.join(""),MP_Util.CreateTitleText(this,""));
this.plotGraph();
PARTO_GRAPH_BASE.addTimeScaleButtons(this.getStyles().getId());
this.handleEventsOnLegend();
}$("#"+this.getStyles().getId()).css("margin-bottom",PARTO_GRAPH_BASE.getComponentBottomPadding());
}catch(err){MP_Util.LogJSError(err,this,"partogramlabor.js","RenderComponent");
if(timerRenderComponent){timerRenderComponent.Abort();
timerRenderComponent=null;
}}finally{if(timerRenderComponent){timerRenderComponent.Stop();
}}};
PartogramLaborComponentWF.prototype.getGraphBackgroundColor=function(){var backgroundColor="";
if(this.graphBackgroundColored){var partogramInfoSR=MP_Resources.getSharedResource("partogramInfo");
var partogramInfoObj=partogramInfoSR.getResourceData();
var pregDescState=partogramInfoObj.getPregnancyDescriptor();
switch(pregDescState){case 0:backgroundColor="rgba(255, 255, 0, 0.20)";
break;
case 1:backgroundColor="rgba(173, 226, 255, 0.20)";
break;
case 2:backgroundColor="rgba(255, 214, 235, 0.30)";
break;
default:backgroundColor="#FFFFFF";
}}else{backgroundColor="#FFFFFF";
}return backgroundColor;
};
PartogramLaborComponentWF.prototype.plotGraph=function(){var plot=this.getPlot();
var graphData=this.createGraphData();
var rootId=this.getStyles().getId();
var COLOR_DARK_BLUE="#0f59e3";
var COLOR_ORANGE="#FF3399";
var COLOR_GRAPE="#505050";
var graphDiv="partogram-labor-graph-"+rootId;
var DATA_RANGE=8;
this.setDataRangeForGraph(DATA_RANGE);
var endDt=PARTO_GRAPH_BASE.getEndDate();
var startDt=PARTO_GRAPH_BASE.getStartDate();
var fetalStationImage=new Image();
fetalStationImage.src=this.getImageFolderPath()+"partoLaborFS-Legend.png";
var canvasOverlayObjs=[];
var hourticks=PARTO_GRAPH_BASE.getHourTicks();
var quarterticks=PARTO_GRAPH_BASE.getQuarterTicks();
canvasOverlayObjs=canvasOverlayObjs.concat(PARTO_GRAPH_BASE.getMajorGridLines());
canvasOverlayObjs=canvasOverlayObjs.concat(PARTO_GRAPH_BASE.getOxytocinVerticalLines());
canvasOverlayObjs=canvasOverlayObjs.concat(PARTO_GRAPH_BASE.getEpiduralVerticalLines());
if(endDt>=PARTO_GRAPH_BASE.getPartogramLastLoadTime()){canvasOverlayObjs=canvasOverlayObjs.concat(PARTO_GRAPH_BASE.getTodayVerticalBar());
}var backgroundColor=this.getGraphBackgroundColor();
function y2axisTicksGenerator(mode){var axisticks=[];
if(mode){if(mode==="FIFTHS_PALPABLE"){axisticks.push(["-1",""],"0","1","2","3","4","5",["6",""]);
}else{axisticks.push(["6",""],["5","+5"],["4","+4"],["3","+3"],["2","+2"],["1","+1"],["0","0"],["-1","-1"],["-2","-2"],["-3","-3"],["-4","-4"],["-5","-5"],["-6",""]);
}}else{axisticks.push([]);
}return axisticks;
}var y2axisticks=y2axisTicksGenerator(this.fetalHeadEngagementMode);
var options={graphName:graphDiv,seriesDefaults:{hoverable:false,highlightMouseDown:true,showLine:true,showMark:true,showLabel:true,formatString:"%R",fontSize:"11px",textColor:"#505050",shadow:false},series:[{label:"laborCurve_dilation",markerOptions:{show:true,style:"filledCircle",size:10,shadow:false},xaxis:"x2axis",yaxis:"yaxis",lineWidth:1,color:COLOR_DARK_BLUE,highlighter:{tooltipContentEditor:this.graphToolTipContent(),showTooltip:true,tooltipLocation:"n"}},{label:"laborCurve_station",markerRenderer:$.jqplot.ImageMarkerRenderer,markerOptions:{show:true,imageElement:fetalStationImage,xOffset:-5.5,yOffset:-5,shadow:false},xaxis:"x2axis",yaxis:"y2axis",lineWidth:1,color:COLOR_ORANGE,highlighter:{tooltipContentEditor:this.graphToolTipContent(),showTooltip:true,tooltipLocation:"n"}},{label:"laborCurve_alertLine",linePattern:"dashed",showMarker:false,shadow:false,showLine:true,lineWidth:1.5,color:COLOR_GRAPE,showHighlight:false},{label:"laborCurve_actionLine",linePattern:"dashed",showMarker:false,shadow:false,showLine:true,lineWidth:1.5,color:COLOR_GRAPE,showHighlight:false},{label:"laborCurve_fetalpos",renderer:$.jqplot.LineRendererWithIndex,markerRenderer:$.jqplot.IndividualImageMarkerRenderer,markerOptions:{show:true,imageArray:this.fetalPositionImageArray,xOffset:-15,yOffset:-10,shadow:false},xaxis:"x2axis",yaxis:"yaxis",showLine:false,highlighter:{tooltipContentEditor:this.graphToolTipContent(),showTooltip:true,tooltipLocation:"n"}}],axesDefaults:{tickOptions:{textColor:PARTO_GRAPH_BASE.COLOR_DARK_GRAY,fontSize:"11px"}},axes:{xaxis:{renderer:$.jqplot.DateAxisRenderer,tickOptions:{show:true,showLabel:false,showMark:false},min:startDt,max:endDt,ticks:quarterticks},yaxis:{tickInterval:1,tickOptions:{showMark:false,showLabel:true},ticks:[[-1,""],[0,0],[1,"1"],[2,"2"],[3,"3"],[4,"4"],[5,"5"],[6,"6"],[7,"7"],[8,"8"],[9,"9"],[10,"10"],[11,""]]},x2axis:{renderer:$.jqplot.DateAxisRenderer,tickOptions:{showMark:false,showLabel:false,formatString:"%R"},min:startDt,max:endDt,ticks:hourticks},y2axis:{ticks:y2axisticks,drawMajorGridlines:false,tickOptions:{showMark:true,showLabel:true}}},legend:{show:false},canvasOverlay:{show:true,objects:canvasOverlayObjs},grid:{drawGridLines:true,hoverable:false,shadow:false,background:backgroundColor,gridLineWidth:1,gridLineColor:PARTO_GRAPH_BASE.MINOR_GRID_LINE_COLOR,drawBorder:false},cursor:{showTooltip:false,show:false}};
plot=$.jqplot(graphDiv,graphData,options);
this.setPlot(plot);
this.setGraphElement(document.getElementById(graphDiv));
PARTO_GRAPH_BASE.setGraphsCommonCSS();
if(!PARTO_GRAPH_BASE.topBarGraphHTML){PARTO_GRAPH_BASE.refreshTopbar(rootId);
}};
PartogramLaborComponentWF.prototype.graphToolTipContent=function(){var component=this;
var tooltipFunc=function(str,seriesIndex,pointIndex,plot){PARTO_GRAPH_BASE.setToolTipLocation(plot,seriesIndex,pointIndex);
var data=plot.data[seriesIndex][pointIndex];
var time=data[0];
var dataPopulated=PARTO_GRAPH_BASE.isHoverDataPopulated(component.HOVER_KEY);
if(!dataPopulated){component.populateHoverData();
}return PARTO_GRAPH_BASE.getHoverHTML(component.HOVER_KEY,time);
};
return tooltipFunc;
};
PartogramLaborComponentWF.prototype.populateHoverData=function(){var data=this.getDataArr();
var NO_UNIT="";
var i,timestamp,fetalPosDisplayVal,nomenID,display,displayArr;
var value="";
var buildValue=function(resultValue,normalcy,modifiedInd,unit){var normalcyClass=PARTO_GRAPH_BASE.getNormalcyClass(normalcy);
var valueHTML=PARTO_GRAPH_BASE.getResultIndHTML(resultValue,unit,normalcyClass,modifiedInd);
return valueHTML;
};
var DILATION_ICON_HTML='<div class="partoLaborSprite partoLaborDilation-legend"></div>';
var dilationEventCode=data.DILATION_EVENT_CODE_NAME;
var dilationCount=data.DILATION_CNT;
var dilationData=data.DILATION;
for(i=0;
i<dilationCount;
i++){var dilationPoint=dilationData[i];
value=buildValue(dilationPoint.RESULT_VALUE,dilationPoint.RESULT_NORMALCY,dilationPoint.RESULT_MODIFIED_IND,this.dilationUnit);
timestamp=PARTO_GRAPH_BASE.getLocalDateTime(dilationPoint.RESULT_DATE);
PARTO_GRAPH_BASE.insertSeriesIntoHoverMap(this.HOVER_KEY,timestamp,DILATION_ICON_HTML,dilationEventCode,value);
}var FETAL_POS_ICON_HTML="";
var fetalPosEventCode=data.FETALPOS_EVENT_CODE_NAME;
var fetalPosData=data.FETALPOS;
var fetalPosCount=data.FETALPOS_CNT;
if(!this.fetalPosMisconfigured){for(i=0;
i<fetalPosCount;
i++){var fetalPosPoint=fetalPosData[i];
FETAL_POS_ICON_HTML="";
display=fetalPosPoint.RESULT_DISPLAY;
displayArr=display.split(";");
if(displayArr.length<2){continue;
}nomenID=parseInt($.trim(displayArr[1]),10);
fetalPosDisplayVal=$.trim(displayArr[0]);
if(!this.NOMEN_MAPPING[nomenID]){continue;
}if(this.fetalPositionDataArray[i]&&this.fetalPositionDataArray[i][2]){FETAL_POS_ICON_HTML='<div class="'+this.fetalPositionDataArray[i][2]+'"></div>';
}value=buildValue(fetalPosDisplayVal,fetalPosPoint.RESULT_NORMALCY,fetalPosPoint.RESULT_MODIFIED_IND,NO_UNIT);
timestamp=PARTO_GRAPH_BASE.getLocalDateTime(fetalPosPoint.RESULT_DATE);
PARTO_GRAPH_BASE.insertSeriesIntoHoverMap(this.HOVER_KEY,timestamp,FETAL_POS_ICON_HTML,fetalPosEventCode,value);
}}var FETAL_HEAD_ICON_HTML='<div class="partoLaborSprite partoLaborFS-Legend"></div>';
if(this.getFetalHeadEngagementMode()==="FIFTHS_PALPABLE"){var fifthsPalpableCount=data.FIFPALPABLE_CNT;
var fifthsPalpableData=data.FIFPALPABLE;
for(i=0;
i<fifthsPalpableCount;
i++){var fifpalpablePoint=fifthsPalpableData[i];
value=buildValue(fifpalpablePoint.RESULT_DISPLAY,fifpalpablePoint.RESULT_NORMALCY,fifpalpablePoint.RESULT_MODIFIED_IND,NO_UNIT);
timestamp=PARTO_GRAPH_BASE.getLocalDateTime(fifpalpablePoint.RESULT_DATE);
PARTO_GRAPH_BASE.insertSeriesIntoHoverMap(this.HOVER_KEY,timestamp,FETAL_HEAD_ICON_HTML,data.FIFPALPABLE_EVENT_CODE_NAME,value);
}}else{var stationCount=data.STATION_CNT;
var stationData=data.STATION;
for(i=0;
i<stationCount;
i++){var stationPoint=stationData[i];
value=buildValue(stationPoint.RESULT_DISPLAY,stationPoint.RESULT_NORMALCY,stationPoint.RESULT_MODIFIED_IND,NO_UNIT);
timestamp=PARTO_GRAPH_BASE.getLocalDateTime(stationPoint.RESULT_DATE);
PARTO_GRAPH_BASE.insertSeriesIntoHoverMap(this.HOVER_KEY,timestamp,FETAL_HEAD_ICON_HTML,data.STATION_EVENT_CODE_NAME,value);
}}};
PartogramLaborComponentWF.prototype.createGraphData=function(){var data=this.getDataArr();
var dataPlots=[];
var stationPlots=[];
var dilationPlots=[];
var alertPlots=[];
var actionPlots=[];
var positionPlots=[];
var DEFAULT_ALERT_ACTION_LINE_RATE=1;
var DEFAULT_ALERT_ACTION_LINE_RATE_FOR_MULTIP=1.5;
var partogramInfoSR=MP_Resources.getSharedResource("partogramInfo");
var partogramInfoObj=partogramInfoSR.getResourceData();
var alertActionRate=this.getAlertActionLinesRate()||DEFAULT_ALERT_ACTION_LINE_RATE;
var ALERT_ACTION_VALUE_INCREMENTS=partogramInfoObj.useMultipRate()?DEFAULT_ALERT_ACTION_LINE_RATE_FOR_MULTIP:alertActionRate;
var DILATION_CRITERIA_FOR_ALERT_ACTION_LINES=4;
var displayAlertActionLines=this.getAlertActionLinesVisible()||false;
var dilationCount=data.DILATION_CNT;
var stationCount=data.STATION_CNT;
var fifthsPalpableCount=data.FIFPALPABLE_CNT;
var fetalPosCount=data.FETALPOS_CNT;
var dilationData=data.DILATION;
var stationData=data.STATION;
var fifthsPalData=data.FIFPALPABLE;
var fetalPosData=data.FETALPOS;
this.dilationUnit=data.DILATION_UNIT;
var startTimeForAALine;
var firstDilationValueTriggerForAA;
dilationData.sort(function(a,b){return new Date(a.RESULT_DATE)-new Date(b.RESULT_DATE);
});
stationData.sort(function(a,b){return new Date(a.RESULT_DATE)-new Date(b.RESULT_DATE);
});
fifthsPalData.sort(function(a,b){return new Date(a.RESULT_DATE)-new Date(b.RESULT_DATE);
});
fetalPosData.sort(function(a,b){return new Date(a.RESULT_DATE)-new Date(b.RESULT_DATE);
});
if(dilationCount){for(var dCnt=0;
dCnt<dilationCount;
dCnt++){var value=dilationData[dCnt].RESULT_VALUE;
var date=dilationData[dCnt].RESULT_DATE;
if(value>=DILATION_CRITERIA_FOR_ALERT_ACTION_LINES&&typeof startTimeForAALine==="undefined"){firstDilationValueTriggerForAA=value;
startTimeForAALine=PARTO_GRAPH_BASE.getLocalDateTime(date);
}dilationPlots.push([PARTO_GRAPH_BASE.getLocalDateTime(date),value]);
}}function getInitialTimeForAlertLine(dilationVal,time,rate,dilationCriteria){var ONE_HOUR_MS=3600000;
var time_in_hours=(dilationVal-dilationCriteria)/rate;
var dateTime=new Date(time-ONE_HOUR_MS*time_in_hours).getTime();
return dateTime;
}function resetPartogramFinalTime(){var hours,ONE_HOUR_MS=3600000;
var graphBase=PARTO_GRAPH_BASE;
switch(ALERT_ACTION_VALUE_INCREMENTS){case 0.5:hours=16;
break;
case 1:hours=10;
break;
case 1.5:hours=8;
break;
}var partogramEndTime=alertStartTime+hours*ONE_HOUR_MS;
if(graphBase.getFinalEndTime()<partogramEndTime){graphBase.setAlertActionEndTime(partogramEndTime);
graphBase.setFinalEndTime(partogramEndTime);
}}var alertStartTime=firstDilationValueTriggerForAA?getInitialTimeForAlertLine(firstDilationValueTriggerForAA,startTimeForAALine,ALERT_ACTION_VALUE_INCREMENTS,DILATION_CRITERIA_FOR_ALERT_ACTION_LINES):null;
if(displayAlertActionLines&&alertStartTime){resetPartogramFinalTime();
var initialAlertDate=new Date(alertStartTime);
var initialActionDate=new Date(initialAlertDate);
initialActionDate.setHours(initialActionDate.getHours()+4);
var initialAlertValue=DILATION_CRITERIA_FOR_ALERT_ACTION_LINES;
var finalAlertValue=(ALERT_ACTION_VALUE_INCREMENTS===1.5)?11:10;
while(initialAlertValue<=finalAlertValue){alertPlots.push([initialAlertDate.getTime(),initialAlertValue]);
actionPlots.push([initialActionDate.getTime(),initialAlertValue]);
initialAlertDate.setHours(initialAlertDate.getHours()+1);
initialActionDate.setHours(initialActionDate.getHours()+1);
initialAlertValue+=ALERT_ACTION_VALUE_INCREMENTS;
}}if(this.getFetalHeadEngagementMode()){if(this.getFetalHeadEngagementMode()==="FIFTHS_PALPABLE"){if(fifthsPalpableCount){for(var fCnt=0;
fCnt<fifthsPalpableCount;
fCnt++){stationPlots.push([PARTO_GRAPH_BASE.getLocalDateTime(fifthsPalData[fCnt].RESULT_DATE),fifthsPalData[fCnt].RESULT_DISPLAY]);
}}}else{if(stationCount){for(var sCnt=0;
sCnt<stationCount;
sCnt++){stationPlots.push([PARTO_GRAPH_BASE.getLocalDateTime(stationData[sCnt].RESULT_DATE),stationData[sCnt].RESULT_DISPLAY]);
}}}}var fetalPosYValue=10.6;
if(!this.fetalPosMisconfigured){for(var fpCnt=0;
fpCnt<fetalPosCount;
fpCnt++){var fetalPosUnit=fetalPosData[fpCnt];
var display=fetalPosUnit.RESULT_DISPLAY;
var displayArr=display.split(";");
if(displayArr.length<2){continue;
}var nomenID=parseInt($.trim(displayArr[1]),10);
var resultDisp=$.trim(displayArr[0]);
if(this.NOMEN_MAPPING[nomenID]){var resultDate=PARTO_GRAPH_BASE.getLocalDateTime(fetalPosUnit.RESULT_DATE);
this.fetalPositionDataArray.push([resultDate,resultDisp,this.NOMEN_MAPPING[nomenID][0]]);
this.fetalPositionImageArray.push(this.NOMEN_MAPPING[nomenID][1]);
positionPlots.push([resultDate,fetalPosYValue]);
}}}if(dilationPlots.length===0){dilationPlots.push([null]);
}dataPlots.push(dilationPlots,stationPlots);
dataPlots.push(alertPlots);
dataPlots.push(actionPlots);
dataPlots.push(positionPlots);
return dataPlots;
};
PartogramLaborComponentWF.prototype.createLegend=function(){var rfi18n=i18n.discernabu.partogramlabor_o2;
var layoutHTML=[];
var data=this.getDataArr();
var fetalHeadEngagementCodename="",fetalHeadEngagementGroupname="";
if(this.getFetalHeadEngagementMode()){if(this.getFetalHeadEngagementMode()==="FIFTHS_PALPABLE"){fetalHeadEngagementCodename=data.FIFPALPABLE_EVENT_CODE_NAME;
fetalHeadEngagementGroupname="WF_PARTO_LABOR_FIFTHS_PALPABLE";
}else{fetalHeadEngagementCodename=data.STATION_EVENT_CODE_NAME;
fetalHeadEngagementGroupname="WF_PARTO_LABOR_STATION";
}}var compId=this.getComponentId();
var dilation=data.DILATION_EVENT_CODE_NAME;
var fetalPosition=data.FETALPOS_EVENT_CODE_NAME;
var alertAction=rfi18n.alertAction;
var LABOR_CURVE_DILATION_ON_IMAGE_CLASS="partoLaborSprite partoLaborDilation-ON";
var LABOR_CURVE_FETAL_HEAD_MEASUREMENT_ON_IMAGE_CLASS="partoLaborSprite partoLaborFS-ON";
var LABOR_CURVE_ALERT_ACTION_ON_IMAGE_CLASS="partoLaborSprite partoLaborAAlines-ON";
var LABOR_CURVE_FETAL_POS_ON_IMAGE_CLASS="partoLaborSprite partoLaborFetalPos-ON";
var LABOR_CURVE_FETAL_POS_ERROR_IMAGE_CLASS="partoLaborSprite partoLaborFetalPos-Error";
var errorTextOnHover=rfi18n.FETAL_POS_FILTER_MISCONFIGURE_ERROR;
errorTextOnHover=errorTextOnHover.replace("{0}",fetalPosition);
var partogramInfoSR=MP_Resources.getSharedResource("partogramInfo");
var partogramInfoObj=partogramInfoSR.getResourceData();
var alertActionRate=this.getAlertActionLinesRate()||1;
var ALERT_ACTION_VALUE_INCREMENTS=partogramInfoObj.useMultipRate()?1.5:alertActionRate;
var alertActionRateUnit=rfi18n.ALERT_ACTION_LEGEND_UNIT;
var alertActionHTML="<div class='parto-graph-aa-unit'>"+ALERT_ACTION_VALUE_INCREMENTS+" "+alertActionRateUnit+" </div>";
layoutHTML.push('<div class="partogram-legend" id="partogram-legend-'+this.getComponentId()+'">');
if(this.groupNameMap.WF_PARTO_LABOR_DILATION[0]){layoutHTML.push('<div class="partogram-labor-legend-item"><div class="partogram-labor-legend-img"><div id="partogram-labor-cervix-dilation'+compId+'" class="'+LABOR_CURVE_DILATION_ON_IMAGE_CLASS+'"></div></div><div title="'+dilation+'" class="partogram-labor-legend-item-name"><span>'+dilation+"</span></div></div>");
}if(this.getFetalHeadEngagementMode()&&this.groupNameMap[fetalHeadEngagementGroupname][0]){layoutHTML.push('<div class="partogram-labor-legend-item"><div class="partogram-labor-legend-img"><div id="partogram-labor-fetal-station'+compId+'" class="'+LABOR_CURVE_FETAL_HEAD_MEASUREMENT_ON_IMAGE_CLASS+'"></div></div><div title="'+fetalHeadEngagementCodename+'" class="partogram-labor-legend-item-name"><span>'+fetalHeadEngagementCodename+"</span></div></div>");
}if(this.groupNameMap.WF_PARTO_LABOR_FETAL_POS[0]){layoutHTML.push('<div class="partogram-labor-legend-item">');
layoutHTML.push('<div class="partogram-labor-legend-img"><div id="partogram-labor-fetal-position'+compId+'" class="'+LABOR_CURVE_FETAL_POS_ON_IMAGE_CLASS+'"></div></div>');
layoutHTML.push('<div title="'+fetalPosition+'" class="partogram-labor-legend-item-name"><span>'+fetalPosition+"</span>");
if(this.fetalPosMisconfigured){layoutHTML.push('<div title="'+errorTextOnHover+'" class="'+LABOR_CURVE_FETAL_POS_ERROR_IMAGE_CLASS+'"></div>');
}layoutHTML.push("</div></div>");
}if(this.alertActionLinesVisible){layoutHTML.push('<div class="partogram-labor-legend-item"><div class="partogram-labor-legend-img"><div id="partogram-labor-alert-action-lines'+compId+'" class="'+LABOR_CURVE_ALERT_ACTION_ON_IMAGE_CLASS+'"></div></div><div title="'+alertAction+'" class="partogram-labor-legend-item-name"><span>'+alertAction+":"+alertActionHTML+"</span></div></div>");
}layoutHTML.push("</div>");
return layoutHTML.join("");
};
PartogramLaborComponentWF.prototype.handleEventsOnLegend=function(){var plot=this.getPlot();
var component=this;
function toggleLegendAndSeries(){return function(event){var componentId=component.getComponentId();
var PLOT_INDEX=[];
var DILATION_PLOT_INDEX=[0];
var FETAL_HEAD_ENGAGEMENT_PLOT_INDEX=[1];
var ALERTACTION_PLOT_INDICES=[2,3];
var FETALPOS_PLOT_INDICES=[4];
var imgDiv=event.target;
var toggledFrom="";
switch(event.target.id){case"partogram-labor-cervix-dilation"+componentId:PLOT_INDEX=DILATION_PLOT_INDEX;
toggledFrom="Dilation";
break;
case"partogram-labor-fetal-station"+componentId:PLOT_INDEX=FETAL_HEAD_ENGAGEMENT_PLOT_INDEX;
toggledFrom="Fetal Station";
break;
case"partogram-labor-alert-action-lines"+componentId:PLOT_INDEX=ALERTACTION_PLOT_INDICES;
toggledFrom="Alert Action lines";
break;
case"partogram-labor-fetal-position"+componentId:PLOT_INDEX=FETALPOS_PLOT_INDICES;
toggledFrom="Fetal Position";
break;
}var imageClass=$(imgDiv).attr("class");
if(imageClass.indexOf("-OFF")>-1){imageClass=imageClass.replace("-OFF","-ON");
}else{imageClass=imageClass.replace("-ON","-OFF");
}$(imgDiv).attr("class",imageClass);
for(var i=0;
i<PLOT_INDEX.length;
i++){plot.series[PLOT_INDEX[i]].show=!plot.series[PLOT_INDEX[i]].show;
}plot.redraw();
PARTO_GRAPH_BASE.setGraphsCommonCSS();
var legendToggleTimer=new CapabilityTimer("CAP:MPG.PARTOGRAMLABOR.O2 - legend toggle",component.criterion.category_mean);
if(legendToggleTimer){legendToggleTimer.addMetaData("rtms.legacy.metadata.1",toggledFrom);
legendToggleTimer.capture();
}};
}jQuery(".partogram-labor-legend-img div").click(toggleLegendAndSeries());
};
