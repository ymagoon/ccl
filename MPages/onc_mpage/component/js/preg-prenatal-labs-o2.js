function PrenatalLabComponentStyle(){this.initByNamespace("prenatal-labs");
}PrenatalLabComponentStyle.prototype=new ComponentStyle();
PrenatalLabComponentStyle.prototype.constructor=ComponentStyle;
function PrenatalLabComponent(criterion){this.setCriterion(criterion);
this.setStyles(new PrenatalLabComponentStyle());
this.setLookBackDropDown(true);
this.prenatalTable=null;
this.setComponentLoadTimerName("USR:MPG.PrenatalLabs.O2 - load component");
this.setComponentRenderTimerName("ENG:MPG.PrenatalLabs.O2 - render component");
this.setResourceRequired(true);
this.OVERLAPPED_INPUT="OVERLAPPED_INPUT";
this.INVALID_INPUT="INVALID_INPUT";
this.INCOMPLETE=1;
this.MODIFIED=1;
this.m_lastSelectedRow="";
this.m_lastSelectedGrp="";
this.m_sidePanelContainer=null;
this.m_sidePanel=null;
this.m_sidePanelVisible=false;
this.m_sidePanelMinHeight=251;
this.prevSelectedRowId="";
this.prevSelectedGroup="";
this.m_tableView=null;
this.reRenderSidePanel=false;
this.labsInitial="";
this.labsInitialSeq="";
this.labsInitialColl="";
this.labsInitialLabel="";
this.labsGroup1="";
this.labsGrp1_st_wk="";
this.labsGrp1_en_wk="";
this.labsGroup1Seq="";
this.labsGroup1Coll="";
this.labsGroup1Label="";
this.labsGroup2="";
this.labsGrp2_st_wk="";
this.labsGrp2_en_wk="";
this.labsGroup2Seq="";
this.labsGroup2Coll="";
this.labsGroup2Label="";
this.labsGroup3="";
this.labsGrp3_st_wk="";
this.labsGrp3_en_wk="";
this.labsGroup3Seq="";
this.labsGroup3Coll="";
this.labsGroup3Label="";
this.labsGroup4="";
this.labsGrp4_st_wk="";
this.labsGrp4_en_wk="";
this.labsGroup4Seq="";
this.labsGroup4Coll="";
this.labsGroup4Label="";
this.labsGroup5="";
this.labsGrp5_st_wk="";
this.labsGrp5_en_wk="";
this.labsGroup5Seq="";
this.labsGroup5Coll="";
this.labsGroup5Label="";
this.labsOptional="";
this.labsOptionalSeq="";
this.labsOptionalColl="";
this.labsOptionalLabel="";
this.pregnancyInfoObj=null;
this.labBinds=null;
this.currentOrderableData=[];
this.orderedData=[];
this.selectedEventId="";
this.selectedEventCode="";
this.selectedGroupId="";
this.selectedRowId="";
this.savedLabData=[];
this.declinedLabData=[];
this.actionPerformed=false;
this.labGroupIds={INITIAL_LAB:"initialLab",LAB_GROUP1:"labGrp1",LAB_GROUP2:"labGrp2",LAB_GROUP3:"labGrp3",LAB_GROUP4:"labGrp4",LAB_GROUP5:"labGrp5",OPTIONAL_LAB:"optionalLab"};
this.labGroupIndex=[];
var idx=0;
for(var key in this.labGroupIds){if(this.labGroupIds.hasOwnProperty(key)){this.labGroupIndex[this.labGroupIds[key]]=idx++;
}}this.currentGestAge=0;
CERN_EventListener.addListener(this,EventListener.EVENT_CLINICAL_EVENT,this.retrieveComponentData,this);
CERN_EventListener.addListener(this,"pregnancyInfoAvailable",this.retrieveComponentData,this);
}PrenatalLabComponent.prototype=new MPageComponent();
PrenatalLabComponent.prototype.constructor=MPageComponent;
MP_Util.setObjectDefinitionMapping("WF_PREG_PREN_LABS",PrenatalLabComponent);
PrenatalLabComponent.prototype.setLabsInitial=function(labsInitial){this.labsInitial=labsInitial;
};
PrenatalLabComponent.prototype.getLabsInitial=function(){return this.labsInitial;
};
PrenatalLabComponent.prototype.setLabsGroup1=function(labsGroup1){this.labsGroup1=labsGroup1;
};
PrenatalLabComponent.prototype.getLabsGroup1=function(){return this.labsGroup1;
};
PrenatalLabComponent.prototype.setLabsGroup1StartWeek=function(labsGrp1_st_wk){this.labsGrp1_st_wk=labsGrp1_st_wk;
};
PrenatalLabComponent.prototype.getLabsGroup1StartWeek=function(){return this.labsGrp1_st_wk;
};
PrenatalLabComponent.prototype.setLabsGroup1EndWeek=function(labsGrp1_en_wk){this.labsGrp1_en_wk=labsGrp1_en_wk;
};
PrenatalLabComponent.prototype.getLabsGroup1EndWeek=function(){return this.labsGrp1_en_wk;
};
PrenatalLabComponent.prototype.setLabsGroup2=function(labsGroup2){this.labsGroup2=labsGroup2;
};
PrenatalLabComponent.prototype.getLabsGroup2=function(){return this.labsGroup2;
};
PrenatalLabComponent.prototype.setLabsGroup2StartWeek=function(labsGrp2_st_wk){this.labsGrp2_st_wk=labsGrp2_st_wk;
};
PrenatalLabComponent.prototype.getLabsGroup2StartWeek=function(){return this.labsGrp2_st_wk;
};
PrenatalLabComponent.prototype.setLabsGroup2EndWeek=function(labsGrp2_en_wk){this.labsGrp2_en_wk=labsGrp2_en_wk;
};
PrenatalLabComponent.prototype.getLabsGroup2EndWeek=function(){return this.labsGrp2_en_wk;
};
PrenatalLabComponent.prototype.setLabsGroup3=function(labsGroup3){this.labsGroup3=labsGroup3;
};
PrenatalLabComponent.prototype.getLabsGroup3=function(){return this.labsGroup3;
};
PrenatalLabComponent.prototype.setLabsGroup3StartWeek=function(labsGrp3_st_wk){this.labsGrp3_st_wk=labsGrp3_st_wk;
};
PrenatalLabComponent.prototype.getLabsGroup3StartWeek=function(){return this.labsGrp3_st_wk;
};
PrenatalLabComponent.prototype.setLabsGroup3EndWeek=function(labsGrp3_en_wk){this.labsGrp3_en_wk=labsGrp3_en_wk;
};
PrenatalLabComponent.prototype.getLabsGroup3EndWeek=function(){return this.labsGrp3_en_wk;
};
PrenatalLabComponent.prototype.setLabsGroup4=function(labsGroup4){this.labsGroup4=labsGroup4;
};
PrenatalLabComponent.prototype.getLabsGroup4=function(){return this.labsGroup4;
};
PrenatalLabComponent.prototype.setLabsGroup4StartWeek=function(labsGrp4_st_wk){this.labsGrp4_st_wk=labsGrp4_st_wk;
};
PrenatalLabComponent.prototype.getLabsGroup4StartWeek=function(){return this.labsGrp4_st_wk;
};
PrenatalLabComponent.prototype.setLabsGroup4EndWeek=function(labsGrp4_en_wk){this.labsGrp4_en_wk=labsGrp4_en_wk;
};
PrenatalLabComponent.prototype.getLabsGroup4EndWeek=function(){return this.labsGrp4_en_wk;
};
PrenatalLabComponent.prototype.setLabsGroup5=function(labsGroup5){this.labsGroup5=labsGroup5;
};
PrenatalLabComponent.prototype.getLabsGroup5=function(){return this.labsGroup5;
};
PrenatalLabComponent.prototype.setLabsGroup5StartWeek=function(labsGrp5_st_wk){this.labsGrp5_st_wk=labsGrp5_st_wk;
};
PrenatalLabComponent.prototype.getLabsGroup5StartWeek=function(){return this.labsGrp5_st_wk;
};
PrenatalLabComponent.prototype.setLabsGroup5EndWeek=function(labsGrp5_en_wk){this.labsGrp5_en_wk=labsGrp5_en_wk;
};
PrenatalLabComponent.prototype.getLabsGroup5EndWeek=function(){return this.labsGrp5_en_wk;
};
PrenatalLabComponent.prototype.setOptionalLab=function(labsOptional){this.labsOptional=labsOptional;
};
PrenatalLabComponent.prototype.getOptionalLab=function(){return this.labsOptional;
};
PrenatalLabComponent.prototype.setInitialSeq=function(labsInitialSeq){this.labsInitialSeq=labsInitialSeq;
};
PrenatalLabComponent.prototype.getInitialSeq=function(){return this.labsInitialSeq;
};
PrenatalLabComponent.prototype.setInitialCollapseBool=function(labsInitialColl){this.labsInitialColl=labsInitialColl;
};
PrenatalLabComponent.prototype.getInitialCollapseBool=function(){return this.labsInitialColl;
};
PrenatalLabComponent.prototype.setLabsGroup1Seq=function(labsGroup1Seq){this.labsGroup1Seq=labsGroup1Seq;
};
PrenatalLabComponent.prototype.getLabsGroup1Seq=function(){return this.labsGroup1Seq;
};
PrenatalLabComponent.prototype.setLabsGroup1CollapseBool=function(labsGroup1Coll){this.labsGroup1Coll=labsGroup1Coll;
};
PrenatalLabComponent.prototype.getLabsGroup1CollapseBool=function(){return this.labsGroup1Coll;
};
PrenatalLabComponent.prototype.setLabsGroup2Seq=function(labsGroup2Seq){this.labsGroup2Seq=labsGroup2Seq;
};
PrenatalLabComponent.prototype.getLabsGroup2Seq=function(){return this.labsGroup2Seq;
};
PrenatalLabComponent.prototype.setLabsGroup2CollapseBool=function(labsGroup2Coll){this.labsGroup2Coll=labsGroup2Coll;
};
PrenatalLabComponent.prototype.getLabsGroup2CollapseBool=function(){return this.labsGroup2Coll;
};
PrenatalLabComponent.prototype.setLabsGroup3Seq=function(labsGroup3Seq){this.labsGroup3Seq=labsGroup3Seq;
};
PrenatalLabComponent.prototype.getLabsGroup3Seq=function(){return this.labsGroup3Seq;
};
PrenatalLabComponent.prototype.setLabsGroup3CollapseBool=function(labsGroup3Coll){this.labsGroup3Coll=labsGroup3Coll;
};
PrenatalLabComponent.prototype.getLabsGroup3CollapseBool=function(){return this.labsGroup3Coll;
};
PrenatalLabComponent.prototype.setLabsGroup4Seq=function(labsGroup4Seq){this.labsGroup4Seq=labsGroup4Seq;
};
PrenatalLabComponent.prototype.getLabsGroup4Seq=function(){return this.labsGroup4Seq;
};
PrenatalLabComponent.prototype.setLabsGroup4CollapseBool=function(labsGroup4Coll){this.labsGroup4Coll=labsGroup4Coll;
};
PrenatalLabComponent.prototype.getLabsGroup4CollapseBool=function(){return this.labsGroup4Coll;
};
PrenatalLabComponent.prototype.setLabsGroup5Seq=function(labsGroup5Seq){this.labsGroup5Seq=labsGroup5Seq;
};
PrenatalLabComponent.prototype.getLabsGroup5Seq=function(){return this.labsGroup5Seq;
};
PrenatalLabComponent.prototype.setLabsGroup5CollapseBool=function(labsGroup5Coll){this.labsGroup5Coll=labsGroup5Coll;
};
PrenatalLabComponent.prototype.getLabsGroup5CollapseBool=function(){return this.labsGroup5Coll;
};
PrenatalLabComponent.prototype.setOptionalLabSeq=function(labsOptionalSeq){this.labsOptionalSeq=labsOptionalSeq;
};
PrenatalLabComponent.prototype.getOptionalLabSeq=function(){return this.labsOptionalSeq;
};
PrenatalLabComponent.prototype.setOptionalLabCollapseBool=function(labsOptionalColl){this.labsOptionalColl=labsOptionalColl;
};
PrenatalLabComponent.prototype.getOptionalLabCollapseBool=function(){return this.labsOptionalColl;
};
PrenatalLabComponent.prototype.setInitialLabel=function(labsInitialLabel){this.labsInitialLabel=labsInitialLabel;
};
PrenatalLabComponent.prototype.getInitialLabel=function(){return this.labsInitialLabel;
};
PrenatalLabComponent.prototype.setLabsGroup1Label=function(labsGroup1Label){this.labsGroup1Label=labsGroup1Label;
};
PrenatalLabComponent.prototype.getLabsGroup1Label=function(){return this.labsGroup1Label;
};
PrenatalLabComponent.prototype.setLabsGroup2Label=function(labsGroup2Label){this.labsGroup2Label=labsGroup2Label;
};
PrenatalLabComponent.prototype.getLabsGroup2Label=function(){return this.labsGroup2Label;
};
PrenatalLabComponent.prototype.setLabsGroup3Label=function(labsGroup3Label){this.labsGroup3Label=labsGroup3Label;
};
PrenatalLabComponent.prototype.getLabsGroup3Label=function(){return this.labsGroup3Label;
};
PrenatalLabComponent.prototype.setLabsGroup4Label=function(labsGroup4Label){this.labsGroup4Label=labsGroup4Label;
};
PrenatalLabComponent.prototype.getLabsGroup4Label=function(){return this.labsGroup4Label;
};
PrenatalLabComponent.prototype.setLabsGroup5Label=function(labsGroup5Label){this.labsGroup5Label=labsGroup5Label;
};
PrenatalLabComponent.prototype.getLabsGroup5Label=function(){return this.labsGroup5Label;
};
PrenatalLabComponent.prototype.setOptionalLabLabel=function(labsOptionalLabel){this.labsOptionalLabel=labsOptionalLabel;
};
PrenatalLabComponent.prototype.getOptionalLabLabel=function(){return this.labsOptionalLabel;
};
PrenatalLabComponent.prototype.isValidString=function(inputString){if(!inputString){return false;
}return true;
};
PrenatalLabComponent.prototype.loadFilterMappings=function(){var component=this;
function addPrenataLabsFilterMap(filterName,functionName,type,field){component.addFilterMappingObject(filterName,{setFunction:functionName,type:type,field:field});
}addPrenataLabsFilterMap("WF_PREG_PREN_LABS_INITIAL",this.setLabsInitial,"DEFAULT_FILTER","ALL");
addPrenataLabsFilterMap("WF_PREG_PREN_LABS_GROUP1",this.setLabsGroup1,"DEFAULT_FILTER","ALL");
addPrenataLabsFilterMap("WF_PREG_PREN_LABS_GRP1_ST_WK",this.setLabsGroup1StartWeek,"NUMBER","FREETEXT_DESC");
addPrenataLabsFilterMap("WF_PREG_PREN_LABS_GRP1_EN_WK",this.setLabsGroup1EndWeek,"NUMBER","FREETEXT_DESC");
addPrenataLabsFilterMap("WF_PREG_PREN_LABS_GROUP2",this.setLabsGroup2,"DEFAULT_FILTER","ALL");
addPrenataLabsFilterMap("WF_PREG_PREN_LABS_GRP2_ST_WK",this.setLabsGroup2StartWeek,"NUMBER","FREETEXT_DESC");
addPrenataLabsFilterMap("WF_PREG_PREN_LABS_GRP2_EN_WK",this.setLabsGroup2EndWeek,"NUMBER","FREETEXT_DESC");
addPrenataLabsFilterMap("WF_PREG_PREN_LABS_GROUP3",this.setLabsGroup3,"DEFAULT_FILTER","ALL");
addPrenataLabsFilterMap("WF_PREG_PREN_LABS_GRP3_ST_WK",this.setLabsGroup3StartWeek,"NUMBER","FREETEXT_DESC");
addPrenataLabsFilterMap("WF_PREG_PREN_LABS_GRP3_EN_WK",this.setLabsGroup3EndWeek,"NUMBER","FREETEXT_DESC");
addPrenataLabsFilterMap("WF_PREG_PREN_LABS_GROUP4",this.setLabsGroup4,"DEFAULT_FILTER","ALL");
addPrenataLabsFilterMap("WF_PREG_PREN_LABS_GRP4_ST_WK",this.setLabsGroup4StartWeek,"NUMBER","FREETEXT_DESC");
addPrenataLabsFilterMap("WF_PREG_PREN_LABS_GRP4_EN_WK",this.setLabsGroup4EndWeek,"NUMBER","FREETEXT_DESC");
addPrenataLabsFilterMap("WF_PREG_PREN_LABS_GROUP5",this.setLabsGroup5,"DEFAULT_FILTER","ALL");
addPrenataLabsFilterMap("WF_PREG_PREN_LABS_GRP5_ST_WK",this.setLabsGroup5StartWeek,"NUMBER","FREETEXT_DESC");
addPrenataLabsFilterMap("WF_PREG_PREN_LABS_GRP5_EN_WK",this.setLabsGroup5EndWeek,"NUMBER","FREETEXT_DESC");
addPrenataLabsFilterMap("WF_PREG_PREN_LABS_OPTIONAL",this.setOptionalLab,"DEFAULT_FILTER","ALL");
addPrenataLabsFilterMap("WF_PREG_PREN_LABS_INIT_SEQ",this.setInitialSeq,"DEFAULT_FILTER","ALL");
addPrenataLabsFilterMap("WF_PREG_PREN_LABS_INIT_COLL",this.setInitialCollapseBool,"Boolean","FREETEXT_DESC");
addPrenataLabsFilterMap("WF_PREG_PREN_LABS_GRP1_SEQ",this.setLabsGroup1Seq,"DEFAULT_FILTER","ALL");
addPrenataLabsFilterMap("WF_PREG_PREN_LABS_GRP1_COLL",this.setLabsGroup1CollapseBool,"Boolean","FREETEXT_DESC");
addPrenataLabsFilterMap("WF_PREG_PREN_LABS_GRP2_SEQ",this.setLabsGroup2Seq,"DEFAULT_FILTER","ALL");
addPrenataLabsFilterMap("WF_PREG_PREN_LABS_GRP2_COLL",this.setLabsGroup2CollapseBool,"Boolean","FREETEXT_DESC");
addPrenataLabsFilterMap("WF_PREG_PREN_LABS_GRP3_SEQ",this.setLabsGroup3Seq,"DEFAULT_FILTER","ALL");
addPrenataLabsFilterMap("WF_PREG_PREN_LABS_GRP3_COLL",this.setLabsGroup3CollapseBool,"Boolean","FREETEXT_DESC");
addPrenataLabsFilterMap("WF_PREG_PREN_LABS_GRP4_SEQ",this.setLabsGroup4Seq,"DEFAULT_FILTER","ALL");
addPrenataLabsFilterMap("WF_PREG_PREN_LABS_GRP4_COLL",this.setLabsGroup4CollapseBool,"Boolean","FREETEXT_DESC");
addPrenataLabsFilterMap("WF_PREG_PREN_LABS_GRP5_SEQ",this.setLabsGroup5Seq,"DEFAULT_FILTER","ALL");
addPrenataLabsFilterMap("WF_PREG_PREN_LABS_GRP5_COLL",this.setLabsGroup5CollapseBool,"Boolean","FREETEXT_DESC");
addPrenataLabsFilterMap("WF_PREG_PREN_LABS_OPT_SEQ",this.setOptionalLabSeq,"DEFAULT_FILTER","ALL");
addPrenataLabsFilterMap("WF_PREG_PREN_LABS_OPT_COLL",this.setOptionalLabCollapseBool,"Boolean","FREETEXT_DESC");
addPrenataLabsFilterMap("WF_PREG_PREN_LABS_INIT_LABEL",this.setInitialLabel,"String","FREETEXT_DESC");
addPrenataLabsFilterMap("WF_PREG_PREN_LABS_GRP1_LABEL",this.setLabsGroup1Label,"String","FREETEXT_DESC");
addPrenataLabsFilterMap("WF_PREG_PREN_LABS_GRP2_LABEL",this.setLabsGroup2Label,"String","FREETEXT_DESC");
addPrenataLabsFilterMap("WF_PREG_PREN_LABS_GRP3_LABEL",this.setLabsGroup3Label,"String","FREETEXT_DESC");
addPrenataLabsFilterMap("WF_PREG_PREN_LABS_GRP4_LABEL",this.setLabsGroup4Label,"String","FREETEXT_DESC");
addPrenataLabsFilterMap("WF_PREG_PREN_LABS_GRP5_LABEL",this.setLabsGroup5Label,"String","FREETEXT_DESC");
addPrenataLabsFilterMap("WF_PREG_PREN_LABS_OPT_LABEL",this.setOptionalLabLabel,"String","FREETEXT_DESC");
};
PrenatalLabComponent.prototype.RetrieveRequiredResources=function(){var pregInfoSR=MP_Resources.getSharedResource("pregnancyInfo");
if(pregInfoSR&&pregInfoSR.isResourceAvailable()){this.retrieveComponentData();
}else{PREGNANCY_BASE_UTIL_O1.LoadPregnancyData(this.getCriterion());
}};
PrenatalLabComponent.prototype.isLabValid=function(groupIndex,labData,ega){var actualEgaIndex=-1;
if(groupIndex===6){return true;
}for(var key in this.labGroupIds){if(this.labGroupIds.hasOwnProperty(key)){startWeek=parseInt(this.getStartWeek(this.labGroupIds[key]),10);
endWeek=parseInt(this.getEndWeek(this.labGroupIds[key]),10);
if(ega>=startWeek&&ega<=endWeek){actualEgaIndex=this.labGroupIndex[this.labGroupIds[key]];
}}}if(groupIndex===actualEgaIndex){return true;
}else{if(actualEgaIndex>0&&actualEgaIndex<6){if(this.isInGroup(actualEgaIndex,this.labBinds,labData.EVENT_SET_CD)){return false;
}}}if(groupIndex===0){return true;
}return false;
};
PrenatalLabComponent.prototype.isValidRange=function(index,labs,labData){var savedLabResult=this.savedLabData[labData.EVENT_ID];
if(savedLabResult&&savedLabResult.SAVED_DATA){var savedLabIndex=this.getSavedLabDataRangeIndex(savedLabResult.SAVED_DATA);
if(index===savedLabIndex){return true;
}else{if(savedLabIndex>=0&&savedLabIndex<=6){if(this.isInGroup(savedLabIndex,this.labBinds,labs.EVENT_SET_CD)){return false;
}}}}var ega=labData.EGA;
if((index===1&&ega>=this.getLabsGroup1StartWeek()&&ega<=this.getLabsGroup1EndWeek())||(index===2&&ega>=this.getLabsGroup2StartWeek()&&ega<=this.getLabsGroup2EndWeek())||(index===3&&ega>=this.getLabsGroup3StartWeek()&&ega<=this.getLabsGroup3EndWeek())||(index===4&&ega>=this.getLabsGroup4StartWeek()&&ega<=this.getLabsGroup4EndWeek())||(index===5&&ega>=this.getLabsGroup5StartWeek()&&ega<=this.getLabsGroup5EndWeek())){return true;
}return false;
};
PrenatalLabComponent.prototype.getSavedLabDataRangeIndex=function(labResult){if(labResult){var jsonObj=JSON.parse(labResult);
var results=jsonObj.PLS_PARAMS.RESULTS;
var startWeek=0;
var endWeek=0;
for(var i=0;
i<results.length;
i++){var result=results[i];
for(var key in this.labGroupIds){if(this.labGroupIds.hasOwnProperty(key)){startWeek=parseInt(this.getStartWeek(this.labGroupIds[key]),10);
endWeek=parseInt(this.getEndWeek(this.labGroupIds[key]),10);
if(startWeek===result.Start_Week&&endWeek===result.End_Week){return this.labGroupIndex[this.labGroupIds[key]];
}}}}}return -1;
};
PrenatalLabComponent.prototype.setDeclinedLabResultStatus=function(groupIndex,declinedLabResult,dateTime){var isDeclinedLabValid=false;
var resultDate=new Date();
var resultDateTime=null;
var declinedDate=new Date();
var declinedDateTime=null;
var startWeek=0;
var endWeek=0;
var index=0;
if(declinedLabResult&&declinedLabResult.SAVED_DATA){for(var key in this.labGroupIds){if(this.labGroupIds.hasOwnProperty(key)){if(index===groupIndex){startWeek=parseInt(this.getStartWeek(this.labGroupIds[key]),10);
endWeek=parseInt(this.getEndWeek(this.labGroupIds[key]),10);
break;
}index++;
}}var labResult=declinedLabResult.SAVED_DATA;
var jsonObj=JSON.parse(labResult);
var results=jsonObj.PLS_PARAMS.RESULTS;
if(dateTime&&dateTime!=="--"){resultDate.setISO8601(dateTime);
resultDateTime=resultDate.getTime();
}for(var i=0;
i<results.length;
i++){var result=results[i];
if(startWeek===result.Start_Week&&endWeek===result.End_Week){if(dateTime&&dateTime!=="--"){declinedDate=new Date(result.Date_Time);
declinedDateTime=declinedDate.getTime();
if(declinedDateTime-resultDateTime>0){isDeclinedLabValid=true;
}}else{isDeclinedLabValid=true;
}}}}if(!isDeclinedLabValid){declinedLabResult.isInValid[""+groupIndex]=true;
}else{declinedLabResult.isInValid[""+groupIndex]=false;
}return isDeclinedLabValid;
};
PrenatalLabComponent.prototype.getLocalDateTime=function(UTCDateStr){var dateTime=new Date();
dateTime.setISO8601(UTCDateStr);
return dateTime.getTime();
};
PrenatalLabComponent.prototype.getDisplayDate=function(dateString){var dttmValString="--";
if(mp_formatter._validateFormatString(dateString)){var dateObject=new Date(this.getLocalDateTime(dateString));
dttmValString=dateObject.format("mediumDate");
}return dttmValString;
};
PrenatalLabComponent.prototype.processInitialOptionalMeasurements=function(ioLabs,ioMeasurements,totalLabs){var compNS=this.getStyles().getNameSpace();
var prenatali18n=i18n.discernabu.preg_prenatal_labs_o2;
var prenatalColClass=compNS+"-col-class";
var mdttmValString="--";
if(this.isValidString(ioMeasurements.DTTM)){mdttmValString=this.getDisplayDate(ioMeasurements.DTTM);
}ioLabs.NEWDTTM=ioMeasurements.DTTM;
ioLabs.DISPLAY_NAME="<span class='"+prenatalColClass+"'>"+ioMeasurements.DISPLAY_NAME+"</span>";
if(totalLabs>1&&ioResults.MEASUREMENTS.length>ioResults.DOCUMENTS.length&&ioResults.MEASUREMENTS.length>ioResults.UNCLASSIFIEDS.length){ioLabs.TOTAL_RESULTS="<span class='"+prenatalColClass+"'><span class='"+compNS+"-table-count'>"+ioResults.MEASUREMENTS.length+"</span></span>";
}ioLabs.STATUS=this.processResultIndicator(ioMeasurements.RESULT,ioMeasurements.NORMALCY,ioMeasurements.MODIFIED_IND,"table",ioMeasurements.EVENT_ID);
ioLabs.RESULT="<span class='"+prenatalColClass+"'>"+prenatali18n.COMPLETE+"</span>";
ioLabs.DTTM="<span class='"+prenatalColClass+"'>"+mdttmValString+"</span>";
if(ioMeasurements.EGA=="--"){ioLabs.EGA_DISPLAY="<span class='"+prenatalColClass+"'>"+ioMeasurements.EGA+"</span>";
}else{ioLabs.EGA_DISPLAY="<span class='"+prenatalColClass+"'>"+ioMeasurements.EGA+prenatali18n.WEEKS+" "+ioMeasurements.EGA_DAYS+prenatali18n.DAYS+"</span>";
}return(ioLabs);
};
PrenatalLabComponent.prototype.processInitialOptionalDocuments=function(ioLabs,ioDocuments,totalLabs){var compNS=this.getStyles().getNameSpace();
var prenatali18n=i18n.discernabu.preg_prenatal_labs_o2;
var prenatalColClass=compNS+"-col-class";
var ddttmValString="--";
if(this.isValidString(ioDocuments.EFFECTIVE_DATE)){ddttmValString=this.getDisplayDate(ioDocuments.EFFECTIVE_DATE);
}ioLabs.NEWDTTM=ioDocuments.EFFECTIVE_DATE;
ioLabs.DISPLAY_NAME="<span class='"+prenatalColClass+"'>"+ioDocuments.DISPLAY_NAME+"</span>";
if(totalLabs>1&&ioResults.DOCUMENTS.length>ioResults.MEASUREMENTS.length&&ioResults.DOCUMENTS.length>ioResults.UNCLASSIFIEDS.length){ioLabs.TOTAL_RESULTS="<span class='"+prenatalColClass+"'><span class='"+compNS+"-table-count'>"+ioResults.DOCUMENTS.length+"</span></span>";
}ioLabs.STATUS="<span class='"+prenatalColClass+"'><span class='"+compNS+"-document-pic'> </span></span>";
ioLabs.RESULT="<span class='"+prenatalColClass+"'>"+prenatali18n.COMPLETE+"</span>";
ioLabs.DTTM="<span class='"+prenatalColClass+"'>"+ddttmValString+"</span>";
if(ioDocuments.EGA=="--"){ioLabs.EGA_DISPLAY="<span class='"+prenatalColClass+"'>"+ioDocuments.EGA+"</span>";
}else{ioLabs.EGA_DISPLAY="<span class='"+prenatalColClass+"'>"+ioDocuments.EGA+prenatali18n.WEEKS+" "+ioDocuments.EGA_DAYS+prenatali18n.DAYS+"</span>";
}return ioLabs;
};
PrenatalLabComponent.prototype.processInitialOptionalUnclassified=function(ioLabs,ioUnclassifieds,totalLabs){var compNS=this.getStyles().getNameSpace();
var prenatali18n=i18n.discernabu.preg_prenatal_labs_o2;
var prenatalColClass=compNS+"-col-class";
var udttmValString="--";
if(this.isValidString(ioUnclassifieds.EFFECTIVE_DATE)){udttmValString=this.getDisplayDate(ioUnclassifieds.EFFECTIVE_DATE);
}ioLabs.NEWDTTM=ioUnclassifieds.EFFECTIVE_DATE;
ioLabs.DISPLAY_NAME="<span class='"+prenatalColClass+"'>"+ioUnclassifieds.DISPLAY_NAME+"</span>";
if(totalLabs>1&&ioResults.UNCLASSIFIEDS.length>ioResults.MEASUREMENTS.length&&ioResults.UNCLASSIFIEDS.length>ioResults.DOCUMENTS.length){ioLabs.TOTAL_RESULTS="<span class='"+prenatalColClass+"'><span class='"+compNS+"-table-count'>"+ioResults.UNCLASSIFIEDS.length+"</span></span>";
}ioLabs.STATUS=this.processResultIndicator(ioUnclassifieds.EVENT_TAG,ioUnclassifieds.NORMALCY_CD_MEAN,ioUnclassifieds.MODIFIED_IND,"table",ioUnclassifieds.EVENT_ID);
ioLabs.RESULT="<span class='"+prenatalColClass+"'>"+prenatali18n.COMPLETE+"</span>";
ioLabs.DTTM="<span class='"+prenatalColClass+"'>"+udttmValString+"</span>";
if(ioUnclassifieds.EGA==="--"){ioLabs.EGA_DISPLAY="<span class='"+prenatalColClass+"'>"+ioUnclassifieds.EGA+"</span>";
}else{ioLabs.EGA_DISPLAY="<span class='"+prenatalColClass+"'>"+ioUnclassifieds.EGA+prenatali18n.WEEKS+" "+ioUnclassifieds.EGA_DAYS+prenatali18n.DAYS+"</span>";
}return ioLabs;
};
PrenatalLabComponent.prototype.processResultsForInitialOptionalLabs=function(ioLabs,groupIndex){var component=this;
var compNS=this.getStyles().getNameSpace();
var prenatali18n=i18n.discernabu.preg_prenatal_labs_o2;
var prenatalColClass=compNS+"-col-class";
var ioResultIndex=0;
var ioResultLength=ioLabs.RESULTS.length;
var ioDocumentstIndex=0;
var ioMeasurementIndex=0;
var ioUnclassifiedsIndex=0;
var expectedIndex=0;
var measurementsLength=0;
var documentsLength=0;
var unclassifiedsLength=0;
var declinedLabResult=null;
var resultFound=false;
var highestEgaResultDate=null;
ioLabs.DISPLAY_NAME="<span class='"+prenatalColClass+"'><span class = '"+compNS+"-table-dispName'>"+ioLabs.EVENT_SET_DISPLAY+"</span></span>";
declinedLabResult=this.declinedLabData[ioLabs.EVENT_SET_CD];
var ensureLabDeclinedStatus=function labDeclinedStatus(resultDateTime,resultStatus){if(declinedLabResult&&component.setDeclinedLabResultStatus(groupIndex,declinedLabResult,resultDateTime)){component.setDeclinedLabData(ioLabs,resultStatus);
resultFound=true;
}};
if(ioLabs.COMPLETE_STATUS_IND==this.INCOMPLETE){var orderedDate=new Date();
orderedDate.setISO8601(ioLabs.COMPLETED_ORDER_DATA[0].UPDATED_DATE);
var orderedLabEgaWeek=Math.floor(this.getEgaAge(this.currentGestAge,orderedDate)/7);
if(this.isLabValid(groupIndex,ioLabs,orderedLabEgaWeek)){ioLabs=this.setIncompleteLabs(ioLabs);
highestEgaResultDate=ioLabs.COMPLETED_ORDER_DATA[0].UPDATED_DATE;
}else{ioLabs.COMPLETE_STATUS_IND=0;
}}for(ioResultIndex=0;
ioResultIndex<ioResultLength&&!resultFound;
ioResultIndex++){ioResults=ioLabs.RESULTS[ioResultIndex];
var minimumEGA=0;
var totalLabs=1;
measurementsLength=ioResults.MEASUREMENTS.length;
if(measurementsLength>0){totalLabs=totalLabs+measurementsLength;
for(ioMeasurementIndex=0;
ioMeasurementIndex<measurementsLength&&!resultFound;
ioMeasurementIndex++){var ioMeasurements=ioResults.MEASUREMENTS[ioMeasurementIndex];
if(this.isValidRange(groupIndex,ioLabs,ioMeasurements)){ioLabs=this.processInitialOptionalMeasurements(ioLabs,ioMeasurements,totalLabs);
highestEgaResultDate=ioLabs.NEWDTTM;
resultFound=true;
}else{expectedIndex=groupIndex===0?measurementsLength-1:0;
if(ioMeasurementIndex===expectedIndex&&ioMeasurements.EGA>minimumEGA){ioLabs=this.processInitialOptionalMeasurements(ioLabs,ioMeasurements,totalLabs);
minimumEGA=ioMeasurements.EGA;
highestEgaResultDate=ioLabs.NEWDTTM;
resultFound=true;
}}}}documentsLength=ioResults.DOCUMENTS.length;
if(documentsLength>0){totalLabs=totalLabs+ioResults.DOCUMENTS.length;
for(ioDocumentstIndex=0;
ioDocumentstIndex<documentsLength&&!resultFound;
ioDocumentstIndex++){var ioDocuments=ioResults.DOCUMENTS[ioDocumentstIndex];
if(this.isValidRange(groupIndex,ioLabs,ioDocuments)){ioLabs=this.processInitialOptionalDocuments(ioLabs,ioDocuments,totalLabs);
highestEgaResultDate=ioLabs.NEWDTTM;
resultFound=true;
}else{expectedIndex=groupIndex===0?documentsLength-1:0;
if(ioDocumentstIndex===expectedIndex&&ioDocuments.EGA>minimumEGA){ioLabs=this.processInitialOptionalDocuments(ioLabs,ioDocuments,totalLabs);
minimumEGA=ioDocuments.EGA;
highestEgaResultDate=ioLabs.NEWDTTM;
resultFound=true;
}}}}unclassifiedsLength=ioResults.UNCLASSIFIEDS.length;
if(unclassifiedsLength>0){totalLabs=totalLabs+ioResults.UNCLASSIFIEDS.length;
for(ioUnclassifiedsIndex=0;
ioUnclassifiedsIndex<unclassifiedsLength&&!resultFound;
ioUnclassifiedsIndex++){var ioUnclassifieds=ioResults.UNCLASSIFIEDS[ioUnclassifiedsIndex];
if(this.isValidRange(groupIndex,ioLabs,ioUnclassifieds)){ioLabs=this.processInitialOptionalUnclassified(ioLabs,ioUnclassifieds,totalLabs);
highestEgaResultDate=ioLabs.NEWDTTM;
resultFound=true;
}else{expectedIndex=groupIndex===0?unclassifiedsLength-1:0;
if(ioUnclassifiedsIndex===expectedIndex&&ioUnclassifieds.EGA>minimumEGA){ioLabs=this.processInitialOptionalUnclassified(ioLabs,ioUnclassifieds,totalLabs);
minimumEGA=ioUnclassifieds.EGA;
highestEgaResultDate=ioLabs.NEWDTTM;
resultFound=true;
}}}}ioLabs.RESULTS[ioResultIndex]=ioResults;
ioLabs.RESULTS.ORDERED=false;
}ensureLabDeclinedStatus(highestEgaResultDate,prenatali18n.COMPLETE);
if(ioResultLength===0&&!resultFound){ioLabs.RESULTS[0]=[];
ioLabs=this.notOrderedMeasurments(ioLabs);
ioLabs=this.notOrderedDocuments(ioLabs);
ioLabs=this.notOrderedUnclassifieds(ioLabs);
ioLabs.RESULTS.ORDERED=true;
if(declinedLabResult&&declinedLabResult.SAVED_DATA&&!declinedLabResult.isInValid[""+groupIndex]){this.setDeclinedLabData(ioLabs,prenatali18n.NOT_ORDERED_FOR_RANGE);
}}return ioLabs;
};
PrenatalLabComponent.prototype.processResultsForGroupLabs=function(labs,groupIndex){var component=this;
var compNS=this.getStyles().getNameSpace();
var prenatali18n=i18n.discernabu.preg_prenatal_labs_o2;
var prenatalColClass=compNS+"-col-class";
var dttmValueString="--";
var resultIndex=0;
var measurementIndex=0;
var declinedDataInfo="";
var declinedLabResult=null;
var isLabDeclined=false;
var highestEgaResultDate=null;
declinedLabResult=this.declinedLabData[labs.EVENT_SET_CD];
var ensureLabDeclinedStatus=function labDeclinedStatus(resultDateTime,resultStatus){if(declinedLabResult&&component.setDeclinedLabResultStatus(groupIndex,declinedLabResult,resultDateTime)){component.setDeclinedLabData(labs,resultStatus);
isLabDeclined=true;
}};
labs.DISPLAY_NAME="<span class='"+prenatalColClass+"'></span><span class = '"+compNS+"-table-dispName'>"+labs.EVENT_SET_DISPLAY+"</span></span>";
if(labs.EVENT_SET_DISPLAY!==this.INVALID_INPUT&&labs.EVENT_SET_DISPLAY!==this.OVERLAPPED_INPUT){if(labs.COMPLETE_STATUS_IND==this.INCOMPLETE){var orderedDate=new Date();
orderedDate.setISO8601(labs.COMPLETED_ORDER_DATA[0].UPDATED_DATE);
var orderedLabEgaWeek=Math.floor(this.getEgaAge(this.currentGestAge,orderedDate)/7);
if(this.isLabValid(groupIndex,labs,orderedLabEgaWeek)){labs=this.setIncompleteLabs(labs);
highestEgaResultDate=labs.COMPLETED_ORDER_DATA[0].UPDATED_DATE;
}else{labs.COMPLETE_STATUS_IND=0;
}}var resultLength=labs.RESULTS.length;
var resultedEvents=1;
if(resultLength>0){for(resultIndex=0;
resultIndex<resultLength;
resultIndex++){var results=labs.RESULTS[resultIndex];
var measureLength=results.MEASUREMENTS.length;
var docLength=results.DOCUMENTS.length;
var uclsLength=results.UNCLASSIFIEDS.length;
var notOrderedFlag=false;
var highestEGA=0;
for(measurementIndex=0;
measurementIndex<measureLength;
measurementIndex++){var measurements=results.MEASUREMENTS[measurementIndex];
labs.DISPLAY_NAME="<span class='"+prenatalColClass+"'></span><span class = '"+compNS+"-table-dispName'>"+measurements.DISPLAY_NAME+"</span></span>";
if(resultedEvents>0){labs.TOTAL_RESULTS="<span class='"+prenatalColClass+"'><span class='"+compNS+"-table-count'>"+resultedEvents+"</span></span>";
}if(this.isValidRange(groupIndex,labs,measurements)){if(measurements.EGA>highestEGA){if(this.isValidString(measurements.DTTM)){dttmValueString=this.getDisplayDate(measurements.DTTM);
}labs.NEWDTTM=measurements.DTTM;
highestEgaResultDate=labs.NEWDTTM;
labs.STATUS=this.processResultIndicator(measurements.RESULT,measurements.NORMALCY,measurements.MODIFIED_IND,"table",measurements.EVENT_ID);
labs.DTTM="<span class='"+prenatalColClass+"'>"+dttmValueString+"</span>";
labs.EGA_DISPLAY="<span class='"+prenatalColClass+"'>"+measurements.EGA+prenatali18n.WEEKS+" "+measurements.EGA_DAYS+prenatali18n.DAYS+"</span>";
labs.RESULT="<span class='"+prenatalColClass+"'>"+prenatali18n.COMPLETE+"</span>";
notOrderedFlag=true;
highestEGA=measurements.EGA;
}}else{if(notOrderedFlag===false){labs=this.setNotOrdered(groupIndex,labs);
}}resultedEvents++;
results.MEASUREMENTS[measurementIndex]=measurements;
}for(var uIndex=0;
uIndex<uclsLength;
uIndex++){var unclassifieds=results.UNCLASSIFIEDS[uIndex];
labs.DISPLAY_NAME="<span class='"+prenatalColClass+"'><span class='"+compNS+"-table-count'></span><span class = '"+compNS+"-table-dispName'>"+unclassifieds.DISPLAY_NAME+"</span></span>";
if(resultedEvents>0){labs.TOTAL_RESULTS="<span class='"+prenatalColClass+"'><span class='"+compNS+"-table-count'>"+resultedEvents+"</span></span>";
}if(this.isValidRange(groupIndex,labs,unclassifieds)){if(unclassifieds.EGA>highestEGA){if(this.isValidString(unclassifieds.EFFECTIVE_DATE)){dttmValueString=this.getDisplayDate(unclassifieds.EFFECTIVE_DATE);
}labs.NEWDTTM=unclassifieds.EFFECTIVE_DATE;
highestEgaResultDate=labs.NEWDTTM;
labs.STATUS=this.processResultIndicator(unclassifieds.EVENT_TAG,unclassifieds.NORMALCY_CD_MEAN,unclassifieds.MODIFIED_IND,"table",unclassifieds.EVENT_ID);
labs.RESULT="<span class='"+prenatalColClass+"'>"+prenatali18n.COMPLETE+"</span>";
labs.DTTM="<span class='"+prenatalColClass+"'>"+dttmValueString+"</span>";
labs.EGA_DISPLAY="<span class='"+prenatalColClass+"'>"+unclassifieds.EGA+prenatali18n.WEEKS+" "+unclassifieds.EGA_DAYS+prenatali18n.DAYS+"</span>";
notOrderedFlag=true;
highestEGA=unclassifieds.EGA;
}}else{if(notOrderedFlag===false){labs=this.setNotOrdered(groupIndex,labs);
}}resultedEvents++;
results.UNCLASSIFIEDS[uIndex]=unclassifieds;
}for(var docIndex=0;
docIndex<docLength;
docIndex++){var documents=results.DOCUMENTS[docIndex];
labs.DISPLAY_NAME="<span class='"+prenatalColClass+"'><span class = '"+compNS+"-table-dispName'>"+documents.DISPLAY_NAME+"</span></span>";
if(resultedEvents>0){labs.TOTAL_RESULTS="<span class='"+prenatalColClass+"'><span class='"+compNS+"-table-count'>"+resultedEvents+"</span></span>";
}if(this.isValidRange(groupIndex,labs,documents)){if(documents.EGA>highestEGA){if(this.isValidString(documents.EFFECTIVE_DATE)){dttmValueString=this.getDisplayDate(documents.EFFECTIVE_DATE);
}labs.NEWDTTM=documents.EFFECTIVE_DATE;
highestEgaResultDate=labs.NEWDTTM;
labs.STATUS="<span class='"+prenatalColClass+" "+compNS+"-status-col'><span class='prenatal-labs-document-pic'> </span></span>";
labs.RESULT="<span class='"+prenatalColClass+"'>"+prenatali18n.COMPLETE+"</span>";
labs.DTTM="<span class='"+prenatalColClass+"'>"+dttmValueString+"</span>";
labs.EGA_DISPLAY="<span class='"+prenatalColClass+"'>"+documents.EGA+prenatali18n.WEEKS+" "+documents.EGA_DAYS+prenatali18n.DAYS+"</span>";
notOrderedFlag=true;
highestEGA=documents.EGA;
}}else{if(notOrderedFlag===false){labs=this.setNotOrdered(groupIndex,labs);
}}resultedEvents++;
results.DOCUMENTS[docIndex]=documents;
}labs.RESULTS[resultIndex]=results;
}labs.RESULTS.ORDERED=false;
ensureLabDeclinedStatus(highestEgaResultDate,prenatali18n.COMPLETE);
}else{labs.RESULTS[0]=[];
labs=this.notOrderedMeasurments(labs);
labs=this.notOrderedDocuments(labs);
labs=this.notOrderedUnclassifieds(labs);
labs.RESULTS.ORDERED=true;
if(declinedLabResult&&declinedLabResult.SAVED_DATA){this.setDeclinedLabResultStatus(groupIndex,declinedLabResult,"");
if(!declinedLabResult.isInValid[""+groupIndex]){this.setDeclinedLabData(labs,prenatali18n.NOT_ORDERED_FOR_RANGE);
}}}}return labs;
};
PrenatalLabComponent.prototype.processResultsForRender=function(bindData){var compNS=this.getStyles().getNameSpace();
var prenatali18n=i18n.discernabu.preg_prenatal_labs_o2;
var prenatalColClass=compNS+"-col-class";
try{var bindLength=bindData.length;
for(var bIndex=0;
bIndex<bindLength;
bIndex++){var labsLength=0;
var records=bindData[bIndex];
labsLength=records.LABS.length;
if(bIndex===0||bIndex===6){if(labsLength>0){for(var ioLabIndex=0;
ioLabIndex<labsLength;
ioLabIndex++){var ioLabs=records.LABS[ioLabIndex];
ioLabs=this.processResultsForInitialOptionalLabs(ioLabs,bIndex);
bindData[bIndex].LABS[ioLabIndex]=ioLabs;
}}}if(bIndex>=1&&bIndex<=5){if(labsLength>0){for(var labIndex=0;
labIndex<labsLength;
labIndex++){var labs=bindData[bIndex].LABS[labIndex];
labs=this.processResultsForGroupLabs(labs,bIndex);
bindData[bIndex].LABS[labIndex]=labs;
}}}}}catch(err){MP_Util.LogJSError(err,this,"preg-prenatal-labs-o2.js","processResultsForRender");
}};
PrenatalLabComponent.prototype.setIncompleteLabs=function(labs){var compNS=this.getStyles().getNameSpace();
var prenatali18n=i18n.discernabu.preg_prenatal_labs_o2;
var prenatalColClass=compNS+"-col-class";
labs.STATUS="<span class='"+prenatalColClass+"'>"+prenatali18n.ORDERED+"</span>";
labs.DTTM="<span class='"+prenatalColClass+"'>--</span>";
labs.EGA_DISPLAY="<span class='"+prenatalColClass+"'>--</span>";
return labs;
};
PrenatalLabComponent.prototype.setNotOrdered=function(groupIndex,labs){var compNS=this.getStyles().getNameSpace();
var prenatali18n=i18n.discernabu.preg_prenatal_labs_o2;
var prenatalColClass=compNS+"-col-class";
var outsideRangeIndClass="prenatal-labs-result-indicator";
var emptyResultVal="--";
var declinedLabResult=this.declinedLabData[labs.EVENT_SET_CD];
if(declinedLabResult&&declinedLabResult.SAVED_DATA){this.setDeclinedLabResultStatus(groupIndex,declinedLabResult,"");
if(!declinedLabResult.isInValid[""+groupIndex]){return this.setDeclinedLabData(labs,prenatali18n.NOT_ORDERED_FOR_RANGE);
}}labs.DTTM="<span class='"+prenatalColClass+"'>"+emptyResultVal+"</span>";
labs.EGA_DISPLAY="<span class='"+prenatalColClass+"'>"+emptyResultVal+"</span>";
labs.STATUS="<div class='"+outsideRangeIndClass+"'></div>";
labs.RESULT="<span class='"+prenatalColClass+"'>"+prenatali18n.NOT_ORDERED_FOR_RANGE+"</span>";
return labs;
};
PrenatalLabComponent.prototype.setDeclinedLabData=function(labs,resultStaus){var compNS=this.getStyles().getNameSpace();
var prenatali18n=i18n.discernabu.preg_prenatal_labs_o2;
var prenatalColClass=compNS+"-col-class";
var emptyResultVal="";
labs.DTTM="<span class='"+prenatalColClass+"'>"+emptyResultVal+"</span>";
labs.EGA_DISPLAY="<span class='"+prenatalColClass+"'>"+emptyResultVal+"</span>";
labs.EFFECTIVE_DATE="<span class='"+prenatalColClass+"'>"+emptyResultVal+"</span>";
labs.STATUS="<span class='"+prenatalColClass+"'>"+prenatali18n.DECLINED+"</span>";
labs.RESULT="<span class='"+prenatalColClass+"'>"+prenatali18n.DECLINED+"</span>";
labs.TOTAL_RESULTS="<span class='"+compNS+"-table-count'></span>";
return labs;
};
PrenatalLabComponent.prototype.notOrderedMeasurments=function(labs){var compNS=this.getStyles().getNameSpace();
var prenatali18n=i18n.discernabu.preg_prenatal_labs_o2;
var prenatalColClass=compNS+"-col-class";
labs.RESULTS[0].MEASUREMENTS=[];
labs.RESULTS[0].MEASUREMENTS[0]=[];
var no_measurement=labs.RESULTS[0].MEASUREMENTS[0];
no_measurement.GROUP="--";
no_measurement.EGA="--";
no_measurement.DTTM="";
no_measurement.EVENT_ID="";
no_measurement.STATUS=prenatali18n.NOT_ORDERED;
labs.DTTM="<span class='"+prenatalColClass+"'>--</span>";
labs.EGA_DISPLAY="<span class='"+prenatalColClass+"'>--</span>";
labs.EFFECTIVE_DATE="<span class='"+prenatalColClass+"'>--</span>";
labs.STATUS="<span class='"+prenatalColClass+"'>"+prenatali18n.NOT_ORDERED+"</span>";
labs.RESULT="<span class='"+prenatalColClass+"'>"+prenatali18n.NOT_ORDERED_FOR_RANGE+"</span>";
labs.TOTAL_RESULTS="<span class='"+compNS+"-table-count'>0 </span>";
if(labs.COMPLETE_STATUS_IND==this.INCOMPLETE){labs.STATUS="<span class='"+prenatalColClass+"'>"+prenatali18n.ORDERED+"</span>";
labs.RESULT="<span class='"+prenatalColClass+"'>"+prenatali18n.ORDERED+"</span>";
no_measurement.STATUS=prenatali18n.ORDERED;
}labs.RESULTS[0].MEASUREMENTS[0]=no_measurement;
return labs;
};
PrenatalLabComponent.prototype.notOrderedDocuments=function(labs){var compNS=this.getStyles().getNameSpace();
var prenatali18n=i18n.discernabu.preg_prenatal_labs_o2;
var prenatalColClass=compNS+"-col-class";
labs.RESULTS[0].DOCUMENTS=[];
labs.RESULTS[0].DOCUMENTS[0]=[];
var no_documents=labs.RESULTS[0].DOCUMENTS[0];
no_documents.GROUP="--";
no_documents.EGA="--";
no_documents.EFFECTIVE_DATE="";
no_documents.TITLE=prenatali18n.NOT_ORDERED;
no_documents.EVENT_ID="";
labs.DTTM="<span class='"+prenatalColClass+"'>--</span>";
labs.EGA_DISPLAY="<span class='"+prenatalColClass+"'>--</span>";
labs.EFFECTIVE_DATE="<span class='"+prenatalColClass+"'>--</span>";
labs.STATUS="<span class='"+prenatalColClass+"'>"+prenatali18n.NOT_ORDERED+"</span>";
labs.RESULT="<span class='"+prenatalColClass+"'>"+prenatali18n.NOT_ORDERED_FOR_RANGE+"</span>";
labs.TOTAL_RESULTS="<span class='"+compNS+"-table-count'>0 </span>";
if(labs.COMPLETE_STATUS_IND==this.INCOMPLETE){labs.STATUS="<span class='"+prenatalColClass+"'>"+prenatali18n.ORDERED+"</span>";
labs.RESULT="<span class='"+prenatalColClass+"'>"+prenatali18n.ORDERED+"</span>";
no_documents.TITLE=prenatali18n.ORDERED;
}labs.RESULTS[0].DOCUMENTS[0]=no_documents;
return labs;
};
PrenatalLabComponent.prototype.notOrderedUnclassifieds=function(labs){var compNS=this.getStyles().getNameSpace();
var prenatali18n=i18n.discernabu.preg_prenatal_labs_o2;
var prenatalColClass=compNS+"-col-class";
labs.RESULTS[0].UNCLASSIFIEDS=[];
labs.RESULTS[0].UNCLASSIFIEDS[0]=[];
var no_unclassifieds=labs.RESULTS[0].UNCLASSIFIEDS[0];
no_unclassifieds.GROUP="--";
no_unclassifieds.EGA="--";
no_unclassifieds.EFFECTIVE_DATE="";
no_unclassifieds.EVENT_TAG=prenatali18n.NOT_ORDERED;
no_unclassifieds.EVENT_ID="";
labs.DTTM="<span class='"+prenatalColClass+"'>--</span>";
labs.EGA_DISPLAY="<span class='"+prenatalColClass+"'>--</span>";
labs.EFFECTIVE_DATE="<span class='"+prenatalColClass+"'>--</span>";
labs.STATUS="<span class='"+prenatalColClass+"'>"+prenatali18n.NOT_ORDERED+"</span>";
labs.RESULT="<span class='"+prenatalColClass+"'>"+prenatali18n.NOT_ORDERED_FOR_RANGE+"</span>";
labs.TOTAL_RESULTS="<span class='"+compNS+"-table-count'>0 </span>";
if(labs.COMPLETE_STATUS_IND==this.INCOMPLETE){labs.STATUS="<span class='"+prenatalColClass+"'>"+prenatali18n.ORDERED+"</span>";
labs.RESULT="<span class='"+prenatalColClass+"'>"+prenatali18n.ORDERED+"</span>";
no_unclassifieds.EVENT_TAG=prenatali18n.ORDERED;
}labs.RESULTS[0].UNCLASSIFIEDS[0]=no_unclassifieds;
return labs;
};
PrenatalLabComponent.prototype.processResultIndicator=function(result,normalcy_cd_mean,modified_ind,sender,eventId){var statusResultText="";
var compNS=this.getStyles().getNameSpace();
var classToUse="";
var modifiedString="";
if(sender==="table"){classToUse=compNS+"-status-col";
}else{classToUse=compNS+"-sp-hyperlink-col "+eventId;
}if(modified_ind==this.MODIFIED){modifiedString="<span class='res-modified'>&nbsp;</span>";
}switch(normalcy_cd_mean){case"CRITICAL":case"EXTREMEHIGH":case"PANICHIGH":case"EXTREMELOW":case"PANICLOW":case"VABNORMAL":case"POSITIVE":statusResultText="<span class='"+compNS+"-table-col "+classToUse+"'><span class='res-severe'><span class='res-ind'>&nbsp;</span>"+result+"</span>"+modifiedString+"</span>";
break;
case"HIGH":statusResultText="<span class='"+compNS+"-table-col "+classToUse+"'><span class='res-high'><span class='res-ind'>&nbsp;</span>"+result+"</span>"+modifiedString+"</span>";
break;
case"LOW":statusResultText="<span class='"+compNS+"-table-col "+classToUse+"'><span class='res-low'><span class='res-ind'>&nbsp;</span>"+result+"</span>"+modifiedString+"</span>";
break;
case"ABNORMAL":statusResultText="<span class='"+compNS+"-table-col "+classToUse+"'><span class='res-abnormal'><span class='res-ind'>&nbsp;</span>"+result+"</span>"+modifiedString+"</span>";
break;
default:statusResultText="<span class='"+compNS+"-table-col "+classToUse+"'><span class='res-normal'>"+result+"</span>"+modifiedString+"</span>";
break;
}return statusResultText;
};
PrenatalLabComponent.prototype.getEventIds=function(data){var eventArr=[];
if(data){for(var index=0;
index<data.VALS.length;
index++){eventArr[index]=data.VALS[index].PE_ID;
}}return eventArr;
};
PrenatalLabComponent.prototype.retrieveComponentData=function(){var criterion=this.getCriterion();
var prenatali18n=i18n.discernabu.preg_prenatal_labs_o2;
var patientGenderInfo=criterion.getPatientInfo().getSex();
var countText="";
var messageHTML="";
var pregInfoSR=MP_Resources.getSharedResource("pregnancyInfo");
var pregInfoObj=null;
var pregnancyId=0;
var sendAr=[];
if(patientGenderInfo===null||patientGenderInfo.meaning===null||patientGenderInfo.meaning!=="FEMALE"){messageHTML="<h3 class='info-hd'><span class='res-normal'>"+prenatali18n.NOT_FEMALE+"</span></h3><span class='res-none'>"+prenatali18n.NOT_FEMALE+"</span>";
this.finalizeComponent(messageHTML,countText);
return;
}else{if(pregInfoSR&&pregInfoSR.isResourceAvailable()){pregInfoObj=pregInfoSR.getResourceData();
this.pregnancyInfoObj=pregInfoObj;
pregnancyId=pregInfoObj.getPregnancyId();
if(pregnancyId===-1){messageHTML="<h3 class='info-hd'><span class='res-normal'>"+prenatali18n.PREG_DATA_ERROR+"</span></h3><span class='res-none'>"+prenatali18n.PREG_DATA_ERROR+"</span>";
this.finalizeComponent(messageHTML,countText);
return;
}else{if(!pregnancyId){messageHTML="<h3 class='info-hd'><span class='res-normal'>"+prenatali18n.NO_ACTIVE_PREG+"</span></h3><span class='res-none'>"+prenatali18n.NO_ACTIVE_PREG+"</span>";
this.finalizeComponent(messageHTML,countText);
return;
}else{try{var loadTimer=new RTMSTimer(this.getComponentLoadTimerName());
var renderTimer=new RTMSTimer(this.getComponentRenderTimerName());
sendAr.push("^MINE^",criterion.person_id+".0",criterion.provider_id+".0",criterion.encntr_id+".0",criterion.ppr_cd+".0",pregInfoObj.getLookBack());
sendAr.push(MP_Util.CreateParamArray(this.getEventIds(this.getInitialSeq()),1));
sendAr.push(MP_Util.CreateParamArray(this.getEventIds(this.getLabsGroup1Seq()),1));
sendAr.push(MP_Util.CreateParamArray(this.getEventIds(this.getLabsGroup2Seq()),1));
sendAr.push(MP_Util.CreateParamArray(this.getEventIds(this.getLabsGroup3Seq()),1));
sendAr.push(MP_Util.CreateParamArray(this.getEventIds(this.getLabsGroup4Seq()),1));
sendAr.push(MP_Util.CreateParamArray(this.getEventIds(this.getLabsGroup5Seq()),1));
sendAr.push(MP_Util.CreateParamArray(this.getEventIds(this.getOptionalLabSeq()),1));
var scriptRequest=new ComponentScriptRequest();
scriptRequest.setProgramName("MP_GET_PREG_PRENATAL_LABS");
scriptRequest.setParameterArray(sendAr);
scriptRequest.setComponent(this);
scriptRequest.setLoadTimer(loadTimer);
scriptRequest.setRenderTimer(renderTimer);
scriptRequest.performRequest();
}catch(err){MP_Util.LogJSError(err,this,"preg-prenatal-labs-o2.js","retrieveComponentData");
}}}}}};
PrenatalLabComponent.prototype.createColumn=function(colInfo){var column=new TableColumn();
column.setColumnId(colInfo.ID);
column.setCustomClass(colInfo.CLASS);
column.setColumnDisplay(colInfo.DISPLAY);
column.setRenderTemplate("${ "+colInfo.RENDER_TEMPLATE+"}");
return column;
};
PrenatalLabComponent.prototype.selectDefaultRow=function(flag){if(this.m_tableView&&this.m_tableView.length){var tableRowArr=this.m_tableView.find(".result-info");
var firstRow=tableRowArr[0];
var rowId=this.getRowId(firstRow);
this.m_lastSelectedRow="";
this.m_lastSelectedGrp="";
}};
PrenatalLabComponent.prototype.getEventIdForResultVeiwer=function(results,selectedGroup){var eventId="";
var resultLab=[results.MEASUREMENTS,results.DOCUMENTS,results.UNCLASSIFIEDS];
for(var i=0;
i<resultLab.length;
i++){if(resultLab[i].length>0){var typeLab=resultLab[i];
for(var j=0;
j<typeLab.length;
j++){if(typeLab[j].GROUP===selectedGroup){eventId=typeLab[j].EVENT_ID;
break;
}else{if(selectedGroup===this.getOptionalLabLabel()){eventId=typeLab[typeLab.length-1].EVENT_ID;
break;
}}}}}return eventId;
};
PrenatalLabComponent.prototype.getLabGroupsLabel=function(selectedGroup){var groupIds=this.labGroupIds;
switch(selectedGroup){case groupIds.INITIAL_LAB:return this.getInitialLabel();
case groupIds.LAB_GROUP1:return this.getLabsGroup1Label();
case groupIds.LAB_GROUP2:return this.getLabsGroup2Label();
case groupIds.LAB_GROUP3:return this.getLabsGroup3Label();
case groupIds.LAB_GROUP4:return this.getLabsGroup4Label();
case groupIds.LAB_GROUP5:return this.getLabsGroup5Label();
case groupIds.OPTIONAL_LAB:return this.getOptionalLabLabel();
}};
PrenatalLabComponent.prototype.getStartWeek=function(selectedGroup){var groupIds=this.labGroupIds;
switch(selectedGroup){case groupIds.INITIAL_LAB:return -1;
case groupIds.LAB_GROUP1:return this.getLabsGroup1StartWeek();
case groupIds.LAB_GROUP2:return this.getLabsGroup2StartWeek();
case groupIds.LAB_GROUP3:return this.getLabsGroup3StartWeek();
case groupIds.LAB_GROUP4:return this.getLabsGroup4StartWeek();
case groupIds.LAB_GROUP5:return this.getLabsGroup5StartWeek();
case groupIds.OPTIONAL_LAB:return -1;
}};
PrenatalLabComponent.prototype.getEndWeek=function(selectedGroup){var groupIds=this.labGroupIds;
switch(selectedGroup){case groupIds.INITIAL_LAB:return -1;
case groupIds.LAB_GROUP1:return this.getLabsGroup1EndWeek();
case groupIds.LAB_GROUP2:return this.getLabsGroup2EndWeek();
case groupIds.LAB_GROUP3:return this.getLabsGroup3EndWeek();
case groupIds.LAB_GROUP4:return this.getLabsGroup4EndWeek();
case groupIds.LAB_GROUP5:return this.getLabsGroup5EndWeek();
case groupIds.OPTIONAL_LAB:return -1;
}};
PrenatalLabComponent.prototype.onRowClick=function(event,data){try{var compNS=this.getStyles().getNameSpace();
var selRow=$(event.target).parents(".result-info");
this.selectedGroupId=this.getGroupId(selRow);
this.selectedRowId=this.getRowId(selRow);
if(!selRow.length||data.RESULT_DATA===null){return;
}if(event.target.className===compNS+"-table-dispName"||(event.target.id).split(":")[3]==="DISPLAY_NAME"){this.updateInfo(selRow,data.RESULT_DATA,false,true,true);
}else{this.updateInfo(selRow,data.RESULT_DATA,false,true,false);
}var mEventId="";
var dEventId="";
var uEventId="";
if($(event.target).hasClass("res-normal")||$(event.target).hasClass("res-severe")||$(event.target).hasClass("res-high")||$(event.target).hasClass("res-low")||$(event.target).hasClass("res-abnormal")||$(event.target).hasClass(compNS+"-document-pic")){var selectedGroup=this.getGroupId(selRow);
var rowId=this.getRowId(selRow);
var index=0;
selectedGroup=this.getLabGroupsLabel(selectedGroup);
var eventid=this.getEventIdForResultVeiwer(data.RESULT_DATA.RESULTS[0],selectedGroup);
if(eventid!==""){(new CapabilityTimer("CAP:MPG.PrenatalLabs.O2",this.getCriterion().category_mean)).capture();
ResultViewer.launchAdHocViewer(eventid);
}}}catch(err){MP_Util.LogJSError(err,this,"preg-prenatal-labs-o2.js","onRowClick");
}};
PrenatalLabComponent.prototype.updateInfo=function(selRow,data,isInitialLoad,triggerFromClick,fromDisplay){try{var compNS=this.getStyles().getNameSpace();
var compID=this.getComponentId();
var selectedGroup=this.getGroupId(selRow);
var rowId=this.getRowId(selRow);
if(triggerFromClick===true){if(this.m_lastSelectedRow===rowId&&this.m_lastSelectedGrp===selectedGroup&&!$(selRow).hasClass(this.getStyles().getNameSpace()+"-row-selected-init")){if(fromDisplay===true){if(this.m_sidePanelVisible===true){$("#"+compID+"sidePanelContainer").removeClass(""+compNS+"-sidepanel-container").addClass(""+compNS+"-sidepanel-container-hide");
$("#"+compID+"tableview").removeClass(""+compNS+"-table").addClass(""+compNS+"-table-expand");
this.m_sidePanelVisible=false;
}else{$("#"+compID+"tableview").removeClass(""+compNS+"-table-expand").addClass(""+compNS+"-table");
$("#"+compID+"sidePanelContainer").removeClass(""+compNS+"-sidepanel-container-hide").addClass(""+compNS+"-sidepanel-container");
this.m_sidePanelVisible=true;
this.addSidePanel();
this.updateInfo(selRow,data,false,false,false);
this.m_sidePanel.showPanel();
}}return;
}}this.updateSelRowBgColor(selRow,isInitialLoad);
if(isInitialLoad===true||selectedGroup==="initialLab"){if(isInitialLoad===true){this.renderReadingPane(this.getInitialLabel(),data.LABS[0]);
}else{this.renderReadingPane(this.getInitialLabel(),data);
}}else{this.renderReadingPane(this.getLabGroupsLabel(selectedGroup),data);
}this.m_lastSelectedRow=rowId;
this.m_lastSelectedGrp=selectedGroup;
}catch(err){MP_Util.LogJSError(err,this,"preg-prenatal-labs-o2.js","updateInfo");
}};
PrenatalLabComponent.prototype.getRowId=function(rowObj){var rowId="";
var selectedRow=$(rowObj).attr("id");
var identifiers=selectedRow.split(":");
rowId=identifiers[2];
return rowId;
};
PrenatalLabComponent.prototype.getGroupId=function(rowObj){var groupId="";
var selectedRow=$(rowObj).attr("id");
var identifiers=selectedRow.split(":");
groupId=identifiers[1];
return groupId;
};
PrenatalLabComponent.prototype.updateSelRowBgColor=function(selRowObj,isInitialLoad){var compNS=this.getStyles().getNameSpace();
var prevRow=this.m_tableView.find(".selected");
var rowId="";
var selectedGroup="";
if($(prevRow).attr("id")!==undefined){selectedGroup=this.getGroupId(prevRow);
rowId=this.getRowId(prevRow);
if(prevRow.length>0&&this.m_lastSelectedRow===rowId&&this.m_lastSelectedGrp===selectedGroup){prevRow.removeClass(compNS+"-row-selected");
prevRow.removeClass(compNS+"-row-selected-init");
prevRow.removeClass("selected");
prevRow.children("*").children("*").css("color","");
}}if(isInitialLoad){$(selRowObj).addClass(compNS+"-row-selected-init selected");
}else{$(selRowObj).addClass(compNS+"-row-selected selected");
}};
PrenatalLabComponent.prototype.initPendingSR=function(){var sharedResourceObj=null;
var dataObj={};
var pendingSR=MP_Resources.getSharedResource("pendingDataSR");
var pendingDataArrLength=0;
if(!pendingSR){sharedResourceObj=new SharedResource("pendingDataSR");
dataObj.pendingDataObj=window.external.DiscernObjectFactory("PVFRAMEWORKLINK");
dataObj.pendingDataCompArr=[];
sharedResourceObj.setIsAvailable(true);
sharedResourceObj.setResourceData(dataObj);
MP_Resources.addSharedResource("pendingDataSR",sharedResourceObj);
}else{dataObj=pendingSR.getResourceData();
pendingDataArrLength=dataObj.pendingDataCompArr.length;
while(pendingDataArrLength--){if(this.getComponentId()==dataObj.pendingDataCompArr[pendingDataArrLength]){dataObj.pendingDataCompArr.splice(pendingDataArrLength,1);
break;
}}MP_Resources.setSharedResourceData("pendingDataSR",dataObj);
}dataObj.pendingDataObj.SetPendingData(dataObj.pendingDataCompArr.length===0?0:1);
};
PrenatalLabComponent.prototype.checkPendingSharedResource=function(pendingInd){var compId=this.getComponentId();
var sharedResourceObj=null;
var dataObj={};
var pendingDataArrLength=0;
sharedResourceObj=MP_Resources.getSharedResource("pendingDataSR");
if(sharedResourceObj){dataObj=sharedResourceObj.getResourceData();
if(dataObj){var pendingArr=dataObj.pendingDataCompArr;
if(pendingInd){if(pendingArr.join("|").indexOf(compId)===-1){pendingArr.push(compId);
}}else{pendingDataArrLength=pendingArr.length;
while(pendingDataArrLength--){if(compId===pendingArr[pendingDataArrLength]){pendingArr.splice(pendingDataArrLength,1);
break;
}}}dataObj.pendingDataCompArr=pendingArr;
dataObj.pendingDataObj.SetPendingData(dataObj.pendingDataCompArr.length===0?0:1);
MP_Resources.setSharedResourceData("pendingDataSR",dataObj);
}}};
PrenatalLabComponent.prototype.addItemToScratchPad=function(){var compId=this.getComponentId();
var orderDetails=this.currentOrderableData[0];
var scratchpadObj={};
scratchpadObj.componentId=compId;
scratchpadObj.addedFrom="PrenatalLabs";
scratchpadObj.favId=scratchpadObj.addedFrom+"_"+compId+"_OrderSynId_"+orderDetails.SYNONYM_ID;
scratchpadObj.favType=0;
scratchpadObj.favName=orderDetails.SYNONYM_NAME;
scratchpadObj.favOrderSentDisp=orderDetails.DESCRIPTION;
scratchpadObj.favOrdSet=0;
scratchpadObj.favSynId=orderDetails.SYNONYM_ID+".0";
scratchpadObj.favSentId=orderDetails.SENT_ID+".0";
scratchpadObj.favParam=orderDetails.SYNONYM_ID+".0|"+orderDetails.SENT_ID+".0";
scratchpadObj.displayRxIcon=orderDetails.ACTIVITY_TYPE==="PHARMACY"?1:0;
scratchpadObj.favNomenIds='""';
var dataObj=this.addToOrRemoveFromScratchpadSR(scratchpadObj,false);
this.checkPendingSharedResource(true);
};
PrenatalLabComponent.prototype.addToOrRemoveFromScratchpadSR=function(scratchpadObj,isRemovingObj){var sharedResourceObj=this.getScratchpadSharedResourceObject();
if(sharedResourceObj){var dataObj=sharedResourceObj.getResourceData();
if(!dataObj){return null;
}else{var scratchpadArr=dataObj.scratchpadObjArr;
if(scratchpadArr){if(isRemovingObj){var scratchpadDataLength=scratchpadArr.length;
while(scratchpadDataLength--){if(scratchpadArr[scratchpadDataLength].favSynId==scratchpadObj.favSynId&&scratchpadArr[scratchpadDataLength].favSentId==scratchpadObj.favSentId){scratchpadArr.splice(scratchpadDataLength,1);
break;
}}}else{scratchpadArr.push(scratchpadObj);
}}dataObj.scratchpadObjArr=scratchpadArr;
MP_Resources.setSharedResourceData(sharedResourceObj.getName(),dataObj);
sharedResourceObj.notifyResourceConsumers();
return dataObj;
}}};
PrenatalLabComponent.prototype.getScratchpadSharedResourceObject=function(){var sharedResourceObj=null;
var sharedResourceName="scratchpadSR";
sharedResourceObj=MP_Resources.getSharedResource(sharedResourceName);
if(!sharedResourceObj){sharedResourceObj=this.initScratchpadSR(sharedResourceName);
}return sharedResourceObj;
};
PrenatalLabComponent.prototype.initScratchpadSR=function(sharedResourceName){var sharedResourceObj=null;
var dataObj={};
sharedResourceObj=new SharedResource(sharedResourceName);
dataObj.scratchpadObjArr=[];
sharedResourceObj.setIsAvailable(true);
sharedResourceObj.setResourceData(dataObj);
var object={};
sharedResourceObj.setEventListenerObject(object);
sharedResourceObj.setEventListenerFlag(EventListener.EVENT_SCRATCHPAD_COUNT_UPDATE);
MP_Resources.addSharedResource(sharedResourceObj.getName(),sharedResourceObj);
return sharedResourceObj;
};
PrenatalLabComponent.prototype.compare=function(value1,value2){return(value1.EGA<value2.EGA)?1:(value1.EGA<value2.EGA)?-1:0;
};
PrenatalLabComponent.prototype.renderReadingPane=function(groupName,data){var prenatali18n=i18n.discernabu.preg_prenatal_labs_o2;
var component=this;
var compID=this.getComponentId();
var compNS=this.getStyles().getNameSpace();
var sidePanelHtml="";
var sidePanelTable="";
var sidePanelTableHeader="";
var sidePanelTableRows="";
var fulfillRangeData="";
var dttmValue=new Date();
var pregInfoSR=MP_Resources.getSharedResource("pregnancyInfo");
var pregInfoObj=pregInfoSR.getResourceData();
var sender="sidePanel";
var noDataInfoHTML="";
var isResultAvailable=false;
var isFulfillRangeResultAvailable=false;
var isNonFulfillRangeResultAvailable=false;
var noDataValue="";
var tabelColHdrClass=compNS+"-sp-table-all-col-hdr ";
var selectTabelHdrColClass=compNS+"-sp-table-select-col-hdr ";
var actionButtonClass=compNS+"-sp-action-button ";
data.GESTATIONAL_RECOMMENDATION=prenatali18n.SELECT;
try{var resultDisplay="--";
var resultIndex=0;
var resultLength=data.RESULTS.length;
var eventId="";
this.selectedEventCode=data.EVENT_SET_CD;
var fulfillingGroup="";
var displayResult="";
var dttmValueString="";
var egaDisplayString="";
var fulfillRangeMessage="";
for(resultIndex=0;
resultIndex<resultLength;
resultIndex++){data.RESULTS[resultIndex].MEASUREMENTS.sort(this.compare);
data.RESULTS[resultIndex].DOCUMENTS.sort(this.compare);
data.RESULTS[resultIndex].UNCLASSIFIEDS.sort(this.compare);
}resultDisplay=data.RESULT;
var groupSelectionClass="";
var isLabOrderable=data.ORDER_DATA.length>0?true:false;
var isLabDeclinable=true;
var isLabDeclined=false;
var isLabSavable=false;
var orderBtnStatus=!isLabOrderable?"disabled ":"";
var declineBtnStatus=!isLabDeclinable?"disabled ":"";
var declinedLabResult=this.declinedLabData[this.selectedEventCode];
if(declinedLabResult&&declinedLabResult.SAVED_DATA){if(declinedLabResult.isInValid.length>0&&declinedLabResult.isInValid[""+this.labGroupIndex[this.selectedGroupId]]){isLabDeclinable=true;
}else{isLabDeclinable=false;
isLabDeclined=true;
}}sidePanelTableHeader="<div class='"+compNS+"-content-hdr'><dl class='result-info'><dd class='"+tabelColHdrClass+"'><span>"+prenatali18n.RESULT+"</span></dd><dd class='"+tabelColHdrClass+"'><span>"+prenatali18n.DATE+"</span></dd><dd class='"+tabelColHdrClass+"'><span>"+prenatali18n.EGA+"</span></dd><dd class='"+selectTabelHdrColClass+"'><span>"+prenatali18n.FULFILLS_RANGE+"</span> </dd></dl></div>";
var updateFulfillAndNonFulfillTable=function labResultRangeTable(renderingGroupName,dataLength){fulfillingGroup=renderingGroupName;
if(!isResultAvailable&&dataLength===1){displayResult=noDataValue;
dttmValueString=noDataValue;
egaDisplayString=noDataValue;
fulfillingGroup=noDataValue;
}if(renderingGroupName===prenatali18n.SELECT){groupSelectionClass=compNS+"-select";
isLabDeclinable=false;
isLabSavable=true;
}else{groupSelectionClass="";
}var physicianInfoHTML="";
if(component.savedLabData[eventId]){physicianInfoHTML="<div class='"+compNS+"-result-mark-fulfilled'>"+prenatali18n.MARKED_FULFILLED.replace("{0}",component.savedLabData[eventId].PRSNL_NAME)+"</div>";
}if(renderingGroupName.localeCompare(groupName)===0){if(isLabDeclined){fulfillRangeData=prenatali18n.DECLINED;
}else{fulfillRangeData+="<dl class='result-info "+compNS+"-side-panel-rows'><dd class='"+tabelColHdrClass+"'><span>"+displayResult+"</span></dd><dd class='"+tabelColHdrClass+"'><span>"+dttmValueString+"</span></dd><dd class='"+tabelColHdrClass+"'><span>"+egaDisplayString+"</span></dd><dd class='"+tabelColHdrClass+"'><span>&nbsp;</span></dd></dl>"+physicianInfoHTML;
}sidePanelTable="<div class='"+compNS+"-result-fulfill-notification'><div class='"+compNS+"-fulfill-range'>"+prenatali18n.RESULT_FULFILLING_RANGE+"</div><div id='resultFulfill_"+compID+"' class='"+compNS+"-result-fulfill-msg list-as-table'>"+fulfillRangeData+"</div></div>";
isFulfillRangeResultAvailable=true;
isLabDeclinable=false;
}else{sidePanelTableRows+="<dl class='result-info "+compNS+"-side-panel-rows'><dd class='"+tabelColHdrClass+"'><span>"+displayResult+"</span></dd><dd class='"+tabelColHdrClass+"'><span>"+dttmValueString+"</span></dd><dd class='"+tabelColHdrClass+"'><span>"+egaDisplayString+"</span></dd><dd class='"+selectTabelHdrColClass+"'><span id='eventId_"+eventId+"' class='"+groupSelectionClass+"'>"+fulfillingGroup+"</span></dd></dl>";
isNonFulfillRangeResultAvailable=true;
}};
for(resultIndex=0;
resultIndex<resultLength;
resultIndex++){dttmValueString="--";
var measurementLength=data.RESULTS[resultIndex].MEASUREMENTS.length;
for(var measrIndex=0;
measrIndex<measurementLength;
measrIndex++){var measurements=data.RESULTS[resultIndex].MEASUREMENTS[measrIndex];
eventId=measurements.EVENT_ID;
if(this.isValidString(measurements.DTTM)){dttmValueString=this.getDisplayDate(measurements.DTTM);
isResultAvailable=true;
}egaDisplayString=measurements.EGA;
if(measurements.EGA===undefined){egaDisplayString="--";
}else{egaDisplayString=measurements.EGA+prenatali18n.WEEKS+" "+measurements.EGA_DAYS+prenatali18n.DAYS;
}displayResult="";
if(!this.isValidString(measurements.RESULT)){displayResult="--";
}else{if(measurements.RESULT!=="--"){displayResult=this.processResultIndicator(measurements.RESULT,measurements.NORMALCY,measurements.MODIFIED_IND,sender,eventId);
}}updateFulfillAndNonFulfillTable(measurements.GROUP,measurementLength);
data.RESULTS[resultIndex].MEASUREMENTS[measrIndex]=measurements;
}if(data.RESULTS.ORDERED===false){var docLength=data.RESULTS[resultIndex].DOCUMENTS.length;
for(var docIndex=0;
docIndex<docLength;
docIndex++){var documents=data.RESULTS[resultIndex].DOCUMENTS[docIndex];
eventId=documents.EVENT_ID;
if(this.isValidString(documents.EFFECTIVE_DATE)){dttmValueString=this.getDisplayDate(documents.EFFECTIVE_DATE);
isResultAvailable=true;
}displayResult="";
if(!this.isValidString(documents.TITLE)){displayResult="--";
}else{if(documents.TITLE!=="--"){displayResult=this.processResultIndicator(documents.TITLE,documents.NORMALCY_CD_MEAN,documents.MODIFIED_IND,sender,eventId);
}}egaDisplayString=documents.EGA;
if(documents.EGA!=="--"){egaDisplayString=documents.EGA+prenatali18n.WEEKS+" "+documents.EGA_DAYS+prenatali18n.DAYS;
}updateFulfillAndNonFulfillTable(documents.GROUP,docLength);
data.RESULTS[resultIndex].DOCUMENTS[docIndex]=documents;
}var unclasLength=data.RESULTS[resultIndex].UNCLASSIFIEDS.length;
for(var uclIndex=0;
uclIndex<unclasLength;
uclIndex++){var unclassifieds=data.RESULTS[resultIndex].UNCLASSIFIEDS[uclIndex];
eventId=unclassifieds.EVENT_ID;
if(this.isValidString(unclassifieds.EFFECTIVE_DATE)){dttmValueString=this.getDisplayDate(unclassifieds.EFFECTIVE_DATE);
isResultAvailable=true;
}displayResult="";
if(!this.isValidString(unclassifieds.EVENT_TAG)){displayResult=this.processResultIndicator(data.EVENT_SET_DISPLAY,unclassifieds.NORMALCY_CD_MEAN,unclassifieds.MODIFIED_IND,sender,eventId);
}else{if(unclassifieds.EVENT_TAG!=="--"){displayResult=this.processResultIndicator(unclassifieds.EVENT_TAG,unclassifieds.NORMALCY_CD_MEAN,unclassifieds.MODIFIED_IND,sender,eventId);
}}egaDisplayString=unclassifieds.EGA;
if(unclassifieds.EGA!=="--"){egaDisplayString=unclassifieds.EGA+prenatali18n.WEEKS+" "+unclassifieds.EGA_DAYS+prenatali18n.DAYS;
}updateFulfillAndNonFulfillTable(unclassifieds.GROUP,unclasLength);
data.RESULTS[resultIndex].UNCLASSIFIEDS[uclIndex]=unclassifieds;
}}}if(!isResultAvailable){fulfillRangeMessage=isLabDeclined?prenatali18n.DECLINED:prenatali18n.NO_RESULTS_AVAILABLE;
sidePanelTable="<div class='"+compNS+"-result-fulfill-notification'><div class='"+compNS+"-fulfill-range'>"+prenatali18n.RESULT_FULFILLING_RANGE+"</div><div id='resultFulfill_"+compID+"' class='"+compNS+"-result-fulfill-msg "+compNS+"-result-fulfill-data'>"+fulfillRangeMessage+"</div></div>";
}else{if(!isFulfillRangeResultAvailable){fulfillRangeMessage=isLabDeclined?prenatali18n.DECLINED:prenatali18n.RESULT_EXISTS_OUTSIDE;
sidePanelTable="<div class='"+compNS+"-result-fulfill-notification'><div class='"+compNS+"-fulfill-range'>"+prenatali18n.RESULT_FULFILLING_RANGE+"</div><div id='resultFulfill_"+compID+"' class='"+compNS+"-result-fulfill-msg "+compNS+"-result-fulfill-data'>"+fulfillRangeMessage+"</div></div>";
}}sidePanelTable+="<div class='component-table list-as-table'>"+sidePanelTableHeader+"<div class='"+compNS+"-content-body'><div>"+sidePanelTableRows+"</div></div></div>";
if(!isResultAvailable){noDataInfoHTML="<div class='"+compNS+"-no-result'><div class='"+compNS+"-no-result-icon'></div>";
noDataInfoHTML+="<div class='"+compNS+"-no-result-text'>"+prenatali18n.NO_RESULTS_FOR_LAB+"</div></div>";
}else{if(isFulfillRangeResultAvailable&&isNonFulfillRangeResultAvailable===false){noDataInfoHTML="<div class='"+compNS+"-no-result'><div class='"+compNS+"-no-result-icon'></div>";
noDataInfoHTML+="<div class='"+compNS+"-no-additional-result-text'>"+prenatali18n.NO_ADDITIONAL_RESULTS_MESSAGE+"</div></div>";
}else{noDataInfoHTML="";
}}declineBtnStatus=!isLabDeclinable?"disabled ":"";
sidePanelHtml="<div id='sidePanelScrollContainer"+compID+"'>"+sidePanelTable+noDataInfoHTML+"</div>";
this.m_sidePanel.setActionsAsHTML("<div class ='"+compNS+"-action-buttons'><div class='"+actionButtonClass+"'><div id = 'order_"+compID+"' class='sp-button2 "+orderBtnStatus+"'>"+prenatali18n.ORDER+"</div></div><div class='"+actionButtonClass+"'><div id = 'decline_"+compID+"' class='sp-button2 "+declineBtnStatus+"'>"+prenatali18n.DECLINE+"</div></div><div class='"+actionButtonClass+"'><div id = 'saveChanges_"+compID+"' class='sp-button2 disabled'>"+prenatali18n.SAVE_CHANGES+"</div></div></div>");
scratchpadHTML="<div id='scratchPadMessage_"+compID+"' class='"+compNS+"-scratch-pad-message'><span class='"+compNS+"-scrtach-pad-icon'>&nbsp;</span><span class='"+compNS+"-scratch-pad-text'>"+prenatali18n.SCRATCH_PAD_NOTIFICATION+"</span></div>";
this.m_sidePanel.m_headerTitleObj.html(scratchpadHTML);
this.m_sidePanel.showCornerCloseButton();
$("#cornerCloseButton"+compID).click(function(){$("#"+compID+"sidePanelContainer").removeClass(""+compNS+"-sidepanel-container").addClass(""+compNS+"-sidepanel-container-hide");
$("#"+compID+"tableview").removeClass(""+compNS+"-table").addClass(""+compNS+"-table-expand");
this.m_sidePanelVisible=false;
});
this.m_sidePanel.setSubtitleAsHTML("<div class='"+compNS+"-title'><span>"+data.EVENT_SET_DISPLAY+" <span class='"+compNS+"-grp-class'>("+groupName+")</span> </span></div><div id='"+compID+"-sp-result-heading' class='"+compNS+"-rp-last-satisfied' > <span class='"+compNS+"-title-text'>"+resultDisplay+"</span></div>");
this.m_sidePanel.setContents(sidePanelHtml,compID+"_Content");
$("."+compNS+"-sp-hyperlink-col").data("Category",this.getCriterion().category_mean);
$("."+compNS+"-sp-hyperlink-col").click(function(){var identifier=this.className.split(" ");
var eventid=parseInt(identifier[identifier.length-1],10);
var categoryMean=$("."+compNS+"-sp-hyperlink-col").data("Category");
if(!(isNaN(eventid))){(new CapabilityTimer("CAP:MPG.PrenatalLabs.O2",categoryMean)).capture();
ResultViewer.launchAdHocViewer(eventid);
}});
if(isLabOrderable){this.currentOrderableData=data.ORDER_DATA;
var orderSynonymId=this.currentOrderableData[0].SYNONYM_ID;
$("#order_"+compID).click(function(){(new CapabilityTimer("CAP:MPG.PrenatalLabs.O2-ORDER",component.getCriterion().category_mean)).capture();
var slaTimer=MP_Util.CreateTimer("CAP:MPG.PrenatalLabs.O2-ORDER");
if(slaTimer){slaTimer.SubtimerName=component.criterion.category_mean;
slaTimer.Stop();
}if(!component.actionPerformed){logger.logMessage("Adding an Order to Shared Resource - Scratch Pad<br />Component Name: Prenatal Labs<br />Synonym Id: "+component.currentOrderableData[0].SYNONYM_ID+"<br />");
component.addItemToScratchPad();
component.addOrderScratchPadItems(component.currentOrderableData[0].SYNONYM_ID);
component.m_sidePanel.m_headerTitleObj.removeClass("hidden");
}});
if(component.orderedData[orderSynonymId]>=1){component.m_sidePanel.m_headerTitleObj.removeClass("hidden");
}else{component.m_sidePanel.m_headerTitleObj.addClass("hidden");
}}else{this.currentOrderableData=[];
component.m_sidePanel.m_headerTitleObj.addClass("hidden");
}if(isLabSavable){$("#sidePanelContents"+compID+" ."+compNS+"-select").off();
$("#sidePanelContents"+compID+" ."+compNS+"-select").on("click",function(){if(!component.actionPerformed){$(this).html("");
var selectedResultHTML=$(this).closest("dl").html();
var selectedResultClass=$(this).closest("dl").attr("class");
$("#sidePanelContents"+compID+" ."+compNS+"-select").off();
if(!isFulfillRangeResultAvailable){$("#resultFulfill_"+compID).removeClass(compNS+"-result-fulfill-data").html(selectedResultHTML);
}else{var fulFillRangeHTML="<dl class='"+selectedResultClass+"'>"+selectedResultHTML+"</dl>";
$("#resultFulfill_"+compID).append(fulFillRangeHTML);
}$("#saveChanges_"+compID).removeClass("disabled");
$("#sidePanelContents"+compID+" ."+compNS+"-select").removeClass(compNS+"-select");
component.selectedEventId=$(this).attr("id").split("_")[1];
$(this).closest("dl").html("");
$("#saveChanges_"+compID).off();
$("#saveChanges_"+compID).on("click",function(){(new CapabilityTimer("CAP:MPG.PrenatalLabs.O2-SAVE-CHANGES",component.getCriterion().category_mean)).capture();
var slaTimer=MP_Util.CreateTimer("CAP:MPG.PrenatalLabs.O2-SAVE-CHANGES");
if(slaTimer){slaTimer.SubtimerName=component.criterion.category_mean;
slaTimer.Stop();
}if($(this).attr("class").indexOf("prenatal-labs-btn-disabled")===-1){component.savePrenatalLabData(false);
}});
}});
}if(isLabDeclinable){$("#decline_"+compID).on("click",function(){(new CapabilityTimer("CAP:MPG.PrenatalLabs.O2-DECLINE",component.getCriterion().category_mean)).capture();
var slaTimer=MP_Util.CreateTimer("CAP:MPG.PrenatalLabs.O2-DECLINE");
if(slaTimer){slaTimer.SubtimerName=component.criterion.category_mean;
slaTimer.Stop();
}if(!component.actionPerformed){component.savePrenatalLabData(true);
}});
}}catch(err){MP_Util.LogJSError(err,this,"preg-prenatal-labs-o2.js","renderReadingPane");
}};
PrenatalLabComponent.prototype.savePrenatalLabData=function(isPrenatalLabDataToBeDeclined){try{var component=this;
this.actionPerformed=true;
var scriptRequest=new ComponentScriptRequest();
var prgName="mp_preg_add_prenatal_lab_data";
var sendAr=[];
var criterion=component.getCriterion();
var labData=[];
var isDataToBeSaved=isPrenatalLabDataToBeDeclined===true?0:1;
var eventId=component.selectedEventId?component.selectedEventId+".0":"^^";
var eventCode=component.selectedEventCode?component.selectedEventCode+".0":"^^";
var lookBackRange=this.pregnancyInfoObj?this.pregnancyInfoObj.getLookBack():0;
sendAr.push("^MINE^",criterion.person_id+".0",criterion.provider_id+".0",criterion.encntr_id+".0");
sendAr.push(eventId,eventCode,lookBackRange,isDataToBeSaved);
labData.push({GROUP_ID:component.selectedGroupId,START_WEEK:parseInt(component.getStartWeek(component.selectedGroupId),10),END_WEEK:parseInt(component.getEndWeek(component.selectedGroupId),10)});
var prenatalLabDataJSON=component.buildLabSaveDataJSON(labData,isPrenatalLabDataToBeDeclined);
scriptRequest.setProgramName(prgName);
scriptRequest.setParameterArray(sendAr);
scriptRequest.setAsyncIndicator(true);
scriptRequest.setDataBlob(prenatalLabDataJSON);
scriptRequest.setComponent(component);
scriptRequest.performRequest();
scriptRequest.setResponseHandler(function(scriptReply){if(scriptReply.getStatus()==="F"){var discernError=new Error("Unable to save or decline a lab.");
MP_Util.LogJSError(discernError,component,"preg-prenatal-labs-o2.js","savePrenatalLabData");
}else{component.retrieveComponentData();
}return;
});
}catch(err){this.actionPerformed=false;
MP_Util.LogJSError(err,this,"preg-prenatal-labs-o2.js","savePrenatalLabData");
}};
PrenatalLabComponent.prototype.buildLabSaveDataJSON=function(labData,toBeDeclined){var labJSON='{"PLS_PARAMS":{"RESULTS":[';
var groupJSON="";
var labDataLength=labData.length;
var labIndex=0;
var curDateUTC=new Date().toUTCString();
for(labIndex=0;
labIndex<labDataLength;
labIndex++){groupJSON+='{"Group_Id":"'+labData[labIndex].GROUP_ID+'","Start_Week":'+labData[labIndex].START_WEEK;
groupJSON+=',"End_Week":'+labData[labIndex].END_WEEK+',"Date_Time":"'+curDateUTC+'"}';
groupJSON=labIndex>labDataLength-1?groupJSON+",":groupJSON;
}var declinedLabResult=this.declinedLabData[this.selectedEventCode];
if(toBeDeclined&&declinedLabResult&&declinedLabResult.SAVED_DATA){var jsonObj=JSON.parse(declinedLabResult.SAVED_DATA);
var results=jsonObj.PLS_PARAMS.RESULTS;
var resultLength=results.length;
for(labIndex=0;
labIndex<resultLength;
labIndex++){var result=results[labIndex];
groupJSON+=',{"Group_Id":"'+result.Group_Id+'","Start_Week":'+result.Start_Week;
groupJSON+=',"End_Week":'+result.End_Week+',"Date_Time":"'+result.Date_Time+'"}';
}}if(labDataLength===0){labJSON="";
}else{labJSON+=groupJSON+"]}}";
}return labJSON;
};
PrenatalLabComponent.prototype.addOrderScratchPadItems=function(orderSynonymId){if(this.orderedData[orderSynonymId]>=1){this.orderedData[orderSynonymId]+=1;
}else{this.orderedData[orderSynonymId]=1;
}};
PrenatalLabComponent.prototype.resizeComponent=function(){try{MPageComponent.prototype.resizeComponent.call(this,null);
if(this.m_sidePanel){this.m_sidePanel.m_expandOption=this.m_sidePanel.expandOption.NONE;
this.m_sidePanel.m_fullPanelScrollOn=false;
this.m_sidePanel.resizePanel();
this.resetSidePanelHeight();
}}catch(err){MP_Util.LogJSError(err,this,"preg-prenatal-labs-o2.js","resizeComponent");
}};
PrenatalLabComponent.prototype.resetSidePanelHeight=function(){var component=this;
var componentId=component.getComponentId();
var sidePanelContentMinHeight=component.m_sidePanelMinHeight;
var sidePanelObj=component.m_sidePanel;
if(this.m_tableView&&this.m_tableView.length&&sidePanelObj){var minHeight=Math.max(this.m_tableView.height(),sidePanelContentMinHeight);
sidePanelObj.setMinHeight(minHeight+"px");
sidePanelObj.setHeight(minHeight+"px");
}};
PrenatalLabComponent.prototype.addSidePanel=function(){var compID=this.getComponentId();
var compNS=this.getStyles().getNameSpace();
try{if(this.m_sidePanelContainer&&this.m_sidePanelContainer.length){this.m_sidePanel=new CompSidePanel(compID,this.m_sidePanelContainer.attr("id"));
this.m_sidePanel.setExpandOption(this.m_sidePanel.expandOption.EXPAND_DOWN);
this.m_sidePanel.renderPreBuiltSidePanel();
$("#sidePanelHeaderText"+compID).addClass("hidden");
this.m_sidePanel.setCloseFunction(function(){$("#"+compID+"sidePanelContainer").removeClass(""+compNS+"-sidepanel-container").addClass(""+compNS+"-sidepanel-container-hide");
$("#"+compID+"tableview").removeClass(""+compNS+"-table").addClass(""+compNS+"-table-expand");
this.m_sidePanelVisible=false;
this.reRenderSidePanel=true;
});
if(this.reRenderSidePanel===false){this.selectDefaultRow(false);
this.reRenderSidePanel=true;
$("#"+compID+"sidePanelContainer").removeClass(""+compNS+"-sidepanel-container").addClass(""+compNS+"-sidepanel-container-hide");
$("#"+compID+"tableview").removeClass(""+compNS+"-table").addClass(""+compNS+"-table-expand");
this.m_sidePanelVisible=false;
this.reRenderSidePanel=true;
}this.resetSidePanelHeight();
}}catch(err){MP_Util.LogJSError(err,this,"preg-prenatal-labs-o2.js","addSidePanel");
}};
PrenatalLabComponent.prototype.addCellClickExtension=function(){var component=this;
var cellClickExtension=new TableCellClickCallbackExtension();
cellClickExtension.setCellClickCallback(function(event,data){component.onRowClick(event,data);
});
this.prenatalTable.addExtension(cellClickExtension);
};
PrenatalLabComponent.prototype.isInGroup=function(grpIndex,binds,event_set_cd){if(binds[grpIndex].LABS.length>0){var labsLength=binds[grpIndex].LABS.length;
for(var lIndex=0;
lIndex<labsLength;
lIndex++){if(binds[grpIndex].LABS[lIndex].EVENT_SET_CD==event_set_cd){return true;
}}}return false;
};
PrenatalLabComponent.prototype.setHeadersExpandCollapse=function(){if(!this.isValidString(this.getInitialCollapseBool())){this.setInitialCollapseBool(false);
}if(!this.isValidString(this.getLabsGroup1CollapseBool())){this.getLabsGroup1CollapseBool(false);
}if(!this.isValidString(this.getLabsGroup2CollapseBool())){this.getLabsGroup2CollapseBool(false);
}if(!this.isValidString(this.getLabsGroup3CollapseBool())){this.getLabsGroup3CollapseBool(false);
}if(!this.isValidString(this.getLabsGroup4CollapseBool())){this.getLabsGroup4CollapseBool(false);
}if(!this.isValidString(this.getLabsGroup5CollapseBool())){this.getLabsGroup5CollapseBool(false);
}if(!this.isValidString(this.getOptionalLabCollapseBool())){this.getOptionalLabCollapseBool(false);
}};
PrenatalLabComponent.prototype.validateGroups=function(binds){var isOverlap=[false];
var isGrpInvalid=[false];
var startWeeks=[""];
var endWeeks=[""];
startWeeks[1]=this.getLabsGroup1StartWeek();
startWeeks[2]=this.getLabsGroup2StartWeek();
startWeeks[3]=this.getLabsGroup3StartWeek();
startWeeks[4]=this.getLabsGroup4StartWeek();
startWeeks[5]=this.getLabsGroup5StartWeek();
endWeeks[1]=this.getLabsGroup1EndWeek();
endWeeks[2]=this.getLabsGroup2EndWeek();
endWeeks[3]=this.getLabsGroup3EndWeek();
endWeeks[4]=this.getLabsGroup4EndWeek();
endWeeks[5]=this.getLabsGroup5EndWeek();
for(var index=1;
index<=5;
index++){if((!this.isValidString(startWeeks[index])||!this.isValidString(endWeeks[index])||parseInt(endWeeks[index],10)<parseInt(startWeeks[index],10))&&binds[index].LABS.length>0){isGrpInvalid[index]=true;
}for(var endIndex=index+1;
endIndex<=5;
endIndex++){if((parseInt(endWeeks[index],10)>parseInt(startWeeks[endIndex],10))&&binds[index].LABS.length>0&&binds[endIndex].LABS.length>0){for(var overLapIndex=index;
overLapIndex<=endIndex;
overLapIndex++){isOverlap[overLapIndex]=true;
}}}if(isGrpInvalid[index]===true){binds[index].LABS=[];
binds[index].LABS[0]=[];
binds[index].LABS[0].RESULTS=[];
binds[index].LABS[0].EVENT_SET_DISPLAY=this.INVALID_INPUT;
}else{if(isOverlap[index]===true){binds[index].LABS=[];
binds[index].LABS[0]=[];
binds[index].LABS[0].RESULTS=[];
binds[index].LABS[0].EVENT_SET_DISPLAY=this.OVERLAPPED_INPUT;
}}}return binds;
};
PrenatalLabComponent.prototype.getEgaAge=function(currentGestAge,dateTime){var currentDate=new Date();
var numOfMilliSecsInADay=86400000;
return(currentGestAge-Math.floor((currentDate.getTime()-dateTime.getTime())/numOfMilliSecsInADay));
};
PrenatalLabComponent.prototype.assignGroup=function(binds){var dttmValue=new Date();
var pregInfoSR=MP_Resources.getSharedResource("pregnancyInfo");
var pregInfoObj=pregInfoSR.getResourceData();
var currentGestAge=pregInfoObj.getGesAge();
if(currentGestAge===0){currentGestAge=pregInfoObj.getDelGesAge();
}this.currentGestAge=currentGestAge;
var prenatalEGAweeks="--";
var prenatalEGDays="--";
var bindLength=binds.length;
for(var bIndex=0;
bIndex<bindLength;
bIndex++){var labsLength=binds[bIndex].LABS.length;
for(var lIndex=0;
lIndex<labsLength;
lIndex++){var lab=binds[bIndex].LABS[lIndex];
var resultLength=binds[bIndex].LABS[lIndex].RESULTS.length;
for(var rIndex=0;
rIndex<resultLength;
rIndex++){var measurLength=binds[bIndex].LABS[lIndex].RESULTS[rIndex].MEASUREMENTS.length;
for(var mIndex=0;
mIndex<measurLength;
mIndex++){var measurements=binds[bIndex].LABS[lIndex].RESULTS[rIndex].MEASUREMENTS[mIndex];
if(this.isValidString(measurements.DTTM)){dttmValue.setISO8601(measurements.DTTM);
if(currentGestAge>0){var mEgaAge=this.getEgaAge(currentGestAge,dttmValue);
if(mEgaAge>0){prenatalEGAweeks=Math.floor(mEgaAge/7);
prenatalEGDays=Math.floor(mEgaAge%7);
}measurements.EGA=prenatalEGAweeks;
measurements.EGA_DAYS=prenatalEGDays;
}}measurements.GROUP=this.provideGroupOnEGA(measurements,binds,lab.EVENT_SET_CD,bIndex,rIndex,mIndex,lIndex,measurLength);
binds[bIndex].LABS[lIndex].RESULTS[rIndex].MEASUREMENTS[mIndex]=measurements;
}var docLength=binds[bIndex].LABS[lIndex].RESULTS[rIndex].DOCUMENTS.length;
for(var dIndex=0;
dIndex<docLength;
dIndex++){var documents=binds[bIndex].LABS[lIndex].RESULTS[rIndex].DOCUMENTS[dIndex];
documents.DISPLAY_NAME=binds[bIndex].LABS[lIndex].EVENT_SET_DISPLAY;
if(this.isValidString(documents.EFFECTIVE_DATE)){dttmValue.setISO8601(documents.EFFECTIVE_DATE);
if(currentGestAge>0){var dEgaAge=this.getEgaAge(currentGestAge,dttmValue);
if(dEgaAge>0){prenatalEGAweeks=Math.floor(dEgaAge/7);
prenatalEGDays=Math.floor(dEgaAge%7);
}documents.EGA=prenatalEGAweeks;
documents.EGA_DAYS=prenatalEGDays;
}}documents.GROUP=this.provideGroupOnEGA(documents,binds,lab.EVENT_SET_CD,bIndex,rIndex,dIndex,lIndex,docLength);
binds[bIndex].LABS[lIndex].RESULTS[rIndex].DOCUMENTS[dIndex]=documents;
}var unclassLength=binds[bIndex].LABS[lIndex].RESULTS[rIndex].UNCLASSIFIEDS.length;
for(var uIndex=0;
uIndex<unclassLength;
uIndex++){var unclassifieds=binds[bIndex].LABS[lIndex].RESULTS[rIndex].UNCLASSIFIEDS[uIndex];
unclassifieds.DISPLAY_NAME=binds[bIndex].LABS[lIndex].EVENT_SET_DISPLAY;
if(this.isValidString(unclassifieds.EFFECTIVE_DATE)){dttmValue.setISO8601(unclassifieds.EFFECTIVE_DATE);
if(currentGestAge>0){var uEgaAge=this.getEgaAge(currentGestAge,dttmValue);
if(uEgaAge>0){prenatalEGAweeks=Math.floor(uEgaAge/7);
prenatalEGDays=Math.floor(uEgaAge%7);
}unclassifieds.EGA=prenatalEGAweeks;
unclassifieds.EGA_DAYS=prenatalEGDays;
}}unclassifieds.GROUP=this.provideGroupOnEGA(unclassifieds,binds,lab.EVENT_SET_CD,bIndex,rIndex,uIndex,lIndex,unclassLength);
binds[bIndex].LABS[lIndex].RESULTS[rIndex].UNCLASSIFIEDS[uIndex]=unclassifieds;
}}}}return binds;
};
PrenatalLabComponent.prototype.getLabsGroupLabel=function(groupIndex){switch(groupIndex){case 0:return this.getInitialLabel();
case 1:return this.getLabsGroup1Label();
case 2:return this.getLabsGroup2Label();
case 3:return this.getLabsGroup3Label();
case 4:return this.getLabsGroup4Label();
case 5:return this.getLabsGroup5Label();
case 6:return this.getOptionalLabLabel();
}};
PrenatalLabComponent.prototype.provideGroupOnEGA=function(labData,binds,event_set_cd,bIndex,rIndex,index,lIndex,length){var prenatali18n=i18n.discernabu.preg_prenatal_labs_o2;
var ega=labData.EGA;
var savedLabResult=this.savedLabData[labData.EVENT_ID];
var savedLabIndex=-1;
var savedLabGroup="";
if(savedLabResult){savedLabIndex=this.getSavedLabDataRangeIndex(savedLabResult.SAVED_DATA);
if(savedLabIndex!=-1&&this.isInGroup(savedLabIndex,binds,event_set_cd)){savedLabGroup=this.getLabsGroupLabel(savedLabIndex);
}}var group=prenatali18n.SELECT;
if(ega!==""){var groupAssigned=false;
if(this.isInGroup(1,binds,event_set_cd)){groupAssigned=true;
if(ega>=this.getLabsGroup1StartWeek()&&ega<=this.getLabsGroup1EndWeek()){group=this.getLabsGroup1Label();
}group=savedLabGroup?savedLabGroup:group;
}if(this.isInGroup(2,binds,event_set_cd)){groupAssigned=true;
if(ega>=this.getLabsGroup2StartWeek()&&ega<=this.getLabsGroup2EndWeek()){group=this.getLabsGroup2Label();
}group=savedLabGroup?savedLabGroup:group;
}if(this.isInGroup(3,binds,event_set_cd)){groupAssigned=true;
if(ega>=this.getLabsGroup3StartWeek()&&ega<=this.getLabsGroup3EndWeek()){group=this.getLabsGroup3Label();
}group=savedLabGroup?savedLabGroup:group;
}if(this.isInGroup(4,binds,event_set_cd)){groupAssigned=true;
if(ega>=this.getLabsGroup4StartWeek()&&ega<=this.getLabsGroup4EndWeek()){group=this.getLabsGroup4Label();
}group=savedLabGroup?savedLabGroup:group;
}if(this.isInGroup(5,binds,event_set_cd)){groupAssigned=true;
if(ega>=this.getLabsGroup5StartWeek()&&ega<=this.getLabsGroup5EndWeek()){group=this.getLabsGroup5Label();
}group=savedLabGroup?savedLabGroup:group;
}if(this.isInGroup(0,binds,event_set_cd)){if(rIndex===0&&index===(length-1)){if((bIndex===0&&(groupAssigned===false||group==prenatali18n.SELECT))){group=this.getInitialLabel();
}if(bIndex!==0&&group==prenatali18n.SELECT){group=this.getInitialLabel();
}}group=savedLabGroup?savedLabGroup:group;
}if(this.isInGroup(6,binds,event_set_cd)){group=this.getOptionalLabLabel();
}}return group;
};
PrenatalLabComponent.prototype.initializeSavedAndDclinedData=function(){this.savedLabData=[];
this.declinedLabData=[];
this.actionPerformed=false;
};
PrenatalLabComponent.prototype.getSavedAndDeclinedLabData=function(records){var dataLength=records.SAVED_LAB_DATA.EVENT_IDS.length;
var dataIndex=0;
this.initializeSavedAndDclinedData();
for(dataIndex=0;
dataIndex<dataLength;
dataIndex++){var eventIds=records.SAVED_LAB_DATA.EVENT_IDS[dataIndex];
this.savedLabData[eventIds.EVENT_ID]=eventIds;
}dataLength=records.SAVED_LAB_DATA.EVENT_CDS.length;
for(dataIndex=0;
dataIndex<dataLength;
dataIndex++){var eventCds=records.SAVED_LAB_DATA.EVENT_CDS[dataIndex];
this.declinedLabData[eventCds.EVENT_CD]=eventCds;
this.declinedLabData[eventCds.EVENT_CD].isInValid=[];
}};
PrenatalLabComponent.prototype.renderComponent=function(records){if(!CERN_BrowserDevInd){this.initPendingSR();
}var component=this;
var compID=component.getComponentId();
var compNS=component.getStyles().getNameSpace();
var prenatali18n=i18n.discernabu.preg_prenatal_labs_o2;
var prenatalHTML="";
var tableViewObj=null;
var compContainerObj=null;
var countText="";
var $sidePanelContainer=null;
this.m_sidePanelVisible=false;
(new CapabilityTimer("CAP:MPG.PrenatalLabs.O2",this.getCriterion().category_mean)).capture();
var slaTimer=MP_Util.CreateTimer("CAP:MPG.PrenatalLabs.O2");
if(slaTimer){slaTimer.SubtimerName=this.criterion.category_mean;
slaTimer.Stop();
}try{this.getSavedAndDeclinedLabData(records);
compContainerObj=$("<div></div>").attr("id",compID+"maincontainer").addClass(compNS+"-maincontainer");
tableViewObj=$("<div id='"+compID+"tableview' class='"+compNS+"-table'>");
component.prenatalTable=new ComponentTable();
component.prenatalTable.setNamespace(compNS+compID);
var labNameColInfo={ID:"DISPLAY_NAME",CLASS:compNS+"-table-hdrDisp-col",DISPLAY:prenatali18n.LAB_NAME,RENDER_TEMPLATE:"DISPLAY_NAME"};
var statusColInfo={ID:"STATUS",CLASS:compNS+"-table-hdrStatus-col",DISPLAY:prenatali18n.RESULT+"/"+prenatali18n.STATUS,RENDER_TEMPLATE:"STATUS"};
var dueColInfo={ID:"DTTM",CLASS:compNS+"-table-hdrDttm-col",DISPLAY:prenatali18n.DATE,RENDER_TEMPLATE:"DTTM"};
var gestAgeColInfo={ID:"EGA_DISPLAY",CLASS:compNS+"-table-hdrEga-col",DISPLAY:prenatali18n.GESTATIONAL_AGE,RENDER_TEMPLATE:"EGA_DISPLAY"};
var totalResColInfo={ID:"TOTAL_RESULTS",CLASS:compNS+"-table-hdrTotal-col",DISPLAY:prenatali18n.TOTAL_RESULTS,RENDER_TEMPLATE:"TOTAL_RESULTS"};
var labcol=component.createColumn(labNameColInfo);
var statcol=component.createColumn(statusColInfo);
component.prenatalTable.addColumn(labcol);
component.prenatalTable.addColumn(statcol);
component.prenatalTable.addColumn(component.createColumn(dueColInfo));
component.prenatalTable.addColumn(component.createColumn(gestAgeColInfo));
component.prenatalTable.addColumn(component.createColumn(totalResColInfo));
component.addCellClickExtension();
var binds=[];
binds[0]=records.INITIAL;
binds[1]=records.GROUP1;
binds[2]=records.GROUP2;
binds[3]=records.GROUP3;
binds[4]=records.GROUP4;
binds[5]=records.GROUP5;
binds[6]=records.OPTIONAL_LABS;
this.labBinds=binds;
binds=this.validateGroups(binds);
binds=this.assignGroup(binds);
component.setHeadersExpandCollapse();
component.processResultsForRender(binds);
var tableGrp=null;
var tableHeader="";
if(binds[0].LABS.length>0){tableGrp=new TableGroup();
tableHeader=this.getInitialLabel();
tableGrp.setDisplay(tableHeader).setGroupId("initialLab").setShowCount(false);
tableGrp.setDisplay(tableHeader).setIsExpanded(this.getInitialCollapseBool());
tableGrp.bindData(binds[0].LABS);
component.prenatalTable.addGroup(tableGrp);
}for(var grpIndex=1;
grpIndex<=5;
grpIndex++){var headerCollapse=false;
var label="";
switch(grpIndex){case 1:headerCollapse=this.getLabsGroup1CollapseBool();
label=this.getLabsGroup1Label();
break;
case 2:headerCollapse=this.getLabsGroup2CollapseBool();
label=this.getLabsGroup2Label();
break;
case 3:headerCollapse=this.getLabsGroup3CollapseBool();
label=this.getLabsGroup3Label();
break;
case 4:headerCollapse=this.getLabsGroup4CollapseBool();
label=this.getLabsGroup4Label();
break;
case 5:headerCollapse=this.getLabsGroup5CollapseBool();
label=this.getLabsGroup5Label();
break;
}if(binds[grpIndex].LABS.length>0){tableGrp=new TableGroup();
if(binds[grpIndex].LABS[0].EVENT_SET_DISPLAY===this.INVALID_INPUT){tableHeader=prenatali18n.GROUP+" "+grpIndex+" : "+prenatali18n.DATE_ERRORMSG;
tableGrp.setDisplay(tableHeader).setIsExpanded(false);
}else{if(binds[grpIndex].LABS[0].EVENT_SET_DISPLAY===this.OVERLAPPED_INPUT){tableHeader=prenatali18n.GROUP+" "+grpIndex+" : "+prenatali18n.OVERLAP_ERRORMSG;
tableGrp.setDisplay(tableHeader).setIsExpanded(false);
}else{tableHeader=label;
tableGrp.bindData(binds[grpIndex].LABS);
tableGrp.setDisplay(tableHeader).setIsExpanded(headerCollapse);
}}tableGrp.setDisplay(tableHeader).setGroupId("labGrp"+grpIndex).setShowCount(false);
component.prenatalTable.addGroup(tableGrp);
}}if(binds[6].LABS.length>0){tableGrp=new TableGroup();
tableHeader=this.getOptionalLabLabel();
tableGrp.setDisplay(tableHeader).setGroupId("optionalLab").setShowCount(false);
tableGrp.setDisplay(tableHeader).setIsExpanded(this.getOptionalLabCollapseBool());
tableGrp.bindData(binds[6].LABS);
component.prenatalTable.addGroup(tableGrp);
}var grpToggleExtension=new TableGroupToggleCallbackExtension();
grpToggleExtension.setGroupToggleCallback(function(event,data){component.resetSidePanelHeight();
});
component.prenatalTable.addExtension(grpToggleExtension);
component.prenatalTable.bindData(binds);
component.setComponentTable(component.prenatalTable);
tableViewObj.append($(component.prenatalTable.render()));
$sidePanelContainer=$("<div id='"+compID+"sidePanelContainer' class='"+compNS+"-sidepanel-container'/>");
compContainerObj.append(tableViewObj,$sidePanelContainer);
prenatalHTML+="<div class='prenatal-disclaimer'><span class = 'prenatal-labs-result-indicator'></span><span class = 'prenatal-labs-not-assigned-indicator-text'> "+prenatali18n.RESULT_INDICATOR+"</span></div>";
prenatalHTML+=compContainerObj[0].outerHTML;
countText=MP_Util.CreateTitleText(component,binds.length);
component.finalizeComponent(prenatalHTML,countText);
component.m_tableView=$("#"+compID+"tableview");
component.m_sidePanelContainer=$("#"+compID+"sidePanelContainer");
this.reRenderSidePanel=false;
component.addSidePanel();
component.resetSidePanelHeight();
}catch(err){MP_Util.LogJSError(err,this,"preg-prenatal-labs-o2.js","renderComponent");
}};
