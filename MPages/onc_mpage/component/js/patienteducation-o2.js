function PatientEducationO2ComponentStyle(){this.initByNamespace("pe-o2");
}PatientEducationO2ComponentStyle.prototype=new ComponentStyle();
PatientEducationO2ComponentStyle.prototype.constructor=ComponentStyle;
function PatientEducationO2Component(criterion){this.setCriterion(criterion);
this.setStyles(new PatientEducationO2ComponentStyle());
this.setComponentLoadTimerName("USR:MPG.PATIENTEDUCATION.O2 - load component");
this.setComponentRenderTimerName("ENG:MPG.PATIENTEDUCATION.O2 - render component");
this.m_instructionsArray=[];
this.m_selectedInstArray=[];
this.m_favoriteInstArray=[];
this.m_diagnosisArray=[];
this.m_contentDomainCd=0;
this.m_trackingGroupCd=0;
this.m_addTaskGranted=false;
this.m_removeTaskGranted=false;
this.m_contentTaskGranted=false;
this.m_customTaskGranted=false;
this.m_languageId=0;
this.m_timerId=0;
this.m_launchInd=false;
this.m_powerFormFilter=[];
this.m_IViewFilter=[];
this.m_resultCount=0;
this.m_currentTab=null;
this.m_currentPage=0;
this.pageIndex=0;
this.m_pagerInstance=null;
this.m_currInstArray=[];
this.m_popup=null;
}PatientEducationO2Component.prototype=new MPageComponent();
PatientEducationO2Component.prototype.constructor=MPageComponent;
PatientEducationO2Component.prototype.getPopupObject=function(){return this.m_popup;
};
PatientEducationO2Component.prototype.setPopupObject=function(obj){if(typeof obj!=="object"){throw new Error("Invalid parameter passed to setPopupObject function");
}this.m_popup=obj;
};
PatientEducationO2Component.prototype.setPlusAddEnabled=function(){this.m_isPlusAdd=true;
};
PatientEducationO2Component.prototype.openTab=function(dPatEdDocActivityId){var componentFileName="patienteducation-o2.js";
try{var criterion=this.getCriterion();
var objPatientEducation={};
objPatientEducation=window.external.DiscernObjectFactory("PATIENTEDUCATION");
MP_Util.LogDiscernInfo(this,"PATIENTEDUCATION",componentFileName,"openTab");
var personId=criterion.person_id;
var encntrId=criterion.encntr_id;
objPatientEducation.SetPatient(personId,encntrId);
objPatientEducation.SetDefaultTab(0);
if(dPatEdDocActivityId){objPatientEducation.SetSelectedInstruction(dPatEdDocActivityId);
}objPatientEducation.DoModal();
this.retrieveComponentData();
}catch(err){logger.logJSError(err,null,componentFileName,"openTab");
}};
PatientEducationO2Component.prototype.printPatEduSingleInstruction=function(dPatEdDocActivityId){try{var criterion=this.getCriterion();
var personId=criterion.person_id;
var encntrId=criterion.encntr_id;
var objPatientEducation=window.external.DiscernObjectFactory("PATIENTEDUCATION");
if(dPatEdDocActivityId){objPatientEducation.PrintSingleInstruction(personId,encntrId,dPatEdDocActivityId);
}}catch(err){logger.logJSError(err,null,"patienteducation-o2.js","printPatEduSingleInstruction");
}};
PatientEducationO2Component.prototype.getResultCount=function(){return this.m_resultCount;
};
PatientEducationO2Component.prototype.setResultCount=function(count){this.m_resultCount=count;
};
PatientEducationO2Component.prototype.setInstructionArray=function(instructionsArray){this.m_instructionsArray=instructionsArray;
};
PatientEducationO2Component.prototype.getInstructionArray=function(){return this.m_instructionsArray;
};
PatientEducationO2Component.prototype.setSelectedInstructionArray=function(selectedInstructionArray){this.m_selectedInstArray=selectedInstructionArray;
};
PatientEducationO2Component.prototype.getSelectedInstructionArray=function(){return this.m_selectedInstArray;
};
PatientEducationO2Component.prototype.setFavoriteInstructionArray=function(favoriteInstructionArray){this.m_favoriteInstArray=favoriteInstructionArray;
};
PatientEducationO2Component.prototype.getFavoriteInstructionArray=function(){return this.m_favoriteInstArray;
};
PatientEducationO2Component.prototype.setDiagnosisArray=function(diagnosisArray){this.m_diagnosisArray=diagnosisArray;
};
PatientEducationO2Component.prototype.getDiagnosisArray=function(){return this.m_diagnosisArray;
};
PatientEducationO2Component.prototype.setAddTaskGranted=function(addTaskInfo){this.m_addTaskGranted=addTaskInfo;
};
PatientEducationO2Component.prototype.getAddTaskGranted=function(){return this.m_addTaskGranted;
};
PatientEducationO2Component.prototype.setRemoveTaskGranted=function(removeTaskInfo){this.m_removeTaskGranted=removeTaskInfo;
};
PatientEducationO2Component.prototype.getRemoveTaskGranted=function(){return this.m_removeTaskGranted;
};
PatientEducationO2Component.prototype.setContentTaskGranted=function(contentTaskInfo){this.m_contentTaskGranted=contentTaskInfo;
};
PatientEducationO2Component.prototype.getContentTaskGranted=function(){return this.m_contentTaskGranted;
};
PatientEducationO2Component.prototype.setCustomTaskGranted=function(customTaskInfo){this.m_customTaskGranted=customTaskInfo;
};
PatientEducationO2Component.prototype.getCustomTaskGranted=function(){return this.m_customTaskGranted;
};
PatientEducationO2Component.prototype.setDomainCd=function(contentDomainCd){this.m_contentDomainCd=contentDomainCd;
};
PatientEducationO2Component.prototype.getDomainCd=function(){return this.m_contentDomainCd;
};
PatientEducationO2Component.prototype.setTrackingGroupCd=function(trackingGroupCd){this.m_trackingGroupCd=trackingGroupCd;
};
PatientEducationO2Component.prototype.getTrackingGroupCd=function(){return this.m_trackingGroupCd;
};
PatientEducationO2Component.prototype.setLanguageId=function(languageId){this.m_languageId=languageId;
};
PatientEducationO2Component.prototype.getLanguageId=function(){return this.m_languageId;
};
PatientEducationO2Component.prototype.setTimerId=function(timerId){this.m_timerId=timerId;
};
PatientEducationO2Component.prototype.getTimerId=function(){return this.m_timerId;
};
PatientEducationO2Component.prototype.mapObject=function(name,value){this.name=name;
this.value=value;
};
PatientEducationO2Component.prototype.setChartLaunchInd=function(value){this.m_launchInd=value;
};
PatientEducationO2Component.prototype.setPowerFormMapped=function(value){if(value){this.m_powerFormFilter.push(value);
}};
PatientEducationO2Component.prototype.getPowerFormMapped=function(){return this.m_powerFormFilter;
};
PatientEducationO2Component.prototype.getIViewMapped=function(){return this.m_IViewFilter;
};
PatientEducationO2Component.prototype.setIViewMapped=function(value){if(value){this.m_IViewFilter.push(value);
}};
PatientEducationO2Component.prototype.isPowerFormLaunch=function(){return this.m_launchInd;
};
PatientEducationO2Component.prototype.loadFilterMappings=function(){this.addFilterMappingObject("WF_PTED_ACK_CHT_LAUNCH_IND",{setFunction:this.setChartLaunchInd,type:"Boolean",field:"FTXT"});
this.addFilterMappingObject("PF_SINGLE_SELECT",{setFunction:this.setPowerFormMapped,type:"DEFAULT_FILTER",field:"ALL"});
this.addFilterMappingObject("IVIEW_SELECT",{setFunction:this.setIViewMapped,type:"DEFAULT_FILTER",field:"ALL"});
this.addFilterMappingObject("WF_PTED_REQD",{setFunction:this.setGapCheckRequiredInd,type:"Boolean",field:"FTXT"});
this.addFilterMappingObject("WF_PTED_REQ_OVR",{setFunction:this.setOverrideInd,type:"Boolean",field:"FTXT"});
this.addFilterMappingObject("WF_PTED_HELP_TXT",{setFunction:this.setRequiredCompDisclaimerText,type:"STRING",field:"FTXT"});
};
PatientEducationO2Component.prototype.displayEducationAssessLink=function(){var compID=this.getComponentId();
var component=this;
var i18nPatEdu=i18n.discernabu.patienteducation_o2;
var linkHtml="";
var powerFormArr=component.getPowerFormMapped();
var iViewArr=component.getIViewMapped();
if((component.isPowerFormLaunch()&&powerFormArr.length>0)||(!component.isPowerFormLaunch()&&iViewArr.length>0)){linkHtml="<a id='patEduAck"+compID+"'>"+i18nPatEdu.EDUCATION_ASSESSMENT+"</a>";
}return linkHtml;
};
PatientEducationO2Component.prototype.launchChartSelection=function(){var criterion=this.getCriterion();
var component=this;
var launchIViewApp=null;
try{if(component.isPowerFormLaunch()){var paramString="";
var powerFormArray=component.getPowerFormMapped();
var powerFormObj=powerFormArray[0];
var powerForm=powerFormObj.VALS[0];
var patEduAssessScriptrequest=new ComponentScriptRequest();
patEduAssessScriptrequest.setProgramName("INN_MP_GET_FORM_ACTIVITY_ID");
patEduAssessScriptrequest.setParameterArray(["^MINE^",criterion.person_id+".0",criterion.encntr_id+".0",powerForm.PE_ID+".0"]);
patEduAssessScriptrequest.setComponent(component);
patEduAssessScriptrequest.setResponseHandler(function(scriptReply){if(scriptReply.getStatus()==="S"){var recordData=scriptReply.getResponse();
paramString=criterion.person_id+".0|"+criterion.encntr_id+".0|"+powerForm.PE_ID+".0|"+recordData.FORM_ACTIVITY_ID+".0|0";
}else{paramString=criterion.person_id+"|"+criterion.encntr_id+"|"+powerForm.PE_ID+"|0|0";
}MPAGES_EVENT("POWERFORM",paramString);
MP_Util.LogMpagesEventInfo(null,"POWERFORM",paramString,"patienteducation-o2.js","launchChartSelection");
});
patEduAssessScriptrequest.performRequest();
}else{var iViewArray=component.getIViewMapped();
var iViewObj=iViewArray[0];
var iViewItemsLength=iViewObj.VALS.length;
for(var x=0,x1=iViewItemsLength;
x<x1;
x++){var iView=iViewObj.VALS[x];
var itemValTypeFlag=iView.V_TYP;
if(itemValTypeFlag===1){var sDisplayName="";
var sBandName="";
var sSectionName="";
var sItemName="";
sDisplayName=iView.FTXT;
sBandName=sDisplayName.toLowerCase();
sDisplayName=sDisplayName.replace(/'/g,"");
for(var y=0,yl=iViewItemsLength;
y<yl;
y++){var secItem=iViewObj.VALS[y];
if(secItem.V_SQ===iView.V_SQ){if(secItem.V_TYP===2){sSectionName=secItem.FTXT;
}else{if(secItem.V_TYP===3){sItemName=secItem.FTXT;
}}}}launchIViewApp=window.external.DiscernObjectFactory("TASKDOC");
launchIViewApp.LaunchIView(sBandName,sSectionName,sItemName,criterion.person_id,criterion.encntr_id);
}launchIViewApp=window.external.DiscernObjectFactory("TASKDOC");
launchIViewApp.LaunchIView(sBandName,sSectionName,sItemName,criterion.person_id,criterion.encntr_id);
}}}catch(err){logger.logJSError(err,null,"patienteducation-o2.js","launchChartSelection");
}};
PatientEducationO2Component.prototype.refreshComponent=function(){this.retrieveComponentData();
};
PatientEducationO2Component.prototype.retrieveComponentData=function(){var criterion=this.getCriterion();
var loadTimer=new RTMSTimer("ENG:MPG.PATIENTEDUCATION.O2 - load component");
var sendAr=["^MINE^",criterion.person_id+".0",criterion.encntr_id+".0",criterion.provider_id+".0"];
var scriptRequest=new ComponentScriptRequest();
scriptRequest.setParameterArray(sendAr);
scriptRequest.setComponent(this);
scriptRequest.setProgramName("MP_GET_PAT_EDU");
scriptRequest.setLoadTimer(loadTimer);
scriptRequest.setAsyncIndicator(true);
scriptRequest.performRequest();
};
PatientEducationO2Component.prototype.preProcessing=function(){var compMenu=this.getMenu();
var compID=this.getComponentId();
if(compMenu){var compMenuSequence=new Menu("compMenuSequence"+compID);
compMenuSequence.setLabel(i18n.discernabu.patienteducation_o2.CONTENTS);
compMenuSequence.setAnchorConnectionCorner(["top","left"]);
compMenuSequence.setContentConnectionCorner(["top","right"]);
compMenuSequence.setIsDisabled(true);
compMenu.addMenuItem(compMenuSequence);
}};
PatientEducationO2Component.prototype.addMenu=function(contentData,contentDomainCd){var compID=this.getComponentId();
var menuId="compMenuSequence"+compID;
var compMenu=this.getMenu();
var compMenuSequence=MP_MenuManager.getMenuObject(menuId);
if(compMenuSequence){if(this.getContentTaskGranted()){compMenuSequence.setIsDisabled(false);
}else{return;
}if(contentData.length>0){for(var contentIndex=0;
contentIndex<contentData.length;
contentIndex++){var contentObject=contentData[contentIndex];
var contentMenuId="contentDomain"+compID+contentObject.CONTENT_DOMAIN_CD;
if(!compMenuSequence.containsMenuItem(contentMenuId)){var contentItem=new MenuSelection(contentMenuId);
if(contentDomainCd===contentObject.CONTENT_DOMAIN_CD){contentItem.setIsSelected(true);
}contentItem.setLabel(contentObject.CONTENT_TYPE_DESC);
contentItem.setClickFunction(this.createFilterClickFunction(contentItem,contentObject.CONTENT_DOMAIN_CD));
compMenuSequence.addMenuItem(contentItem);
}else{var menuArray=compMenuSequence.getMenuItemArray();
var menuLength=menuArray.length;
for(var i=menuLength;
i--;
){var menuItem=menuArray[i];
menuItem.setIsSelected((menuItem.getId()==="contentDomain"+compID+contentDomainCd)?true:false);
}}}}else{compMenuSequence.setIsDisabled(true);
}MP_MenuManager.updateMenuObject(compMenu);
}};
PatientEducationO2Component.prototype.createFilterClickFunction=function(menuItem,contentDomainCd){var compID=this.getComponentId();
var menuId="compMenuSequence"+compID;
var compMenuSequence=MP_MenuManager.getMenuObject(menuId);
var criterion=this.getCriterion();
var self=this;
return function(){var compMenuArr=compMenuSequence.getMenuItemArray();
if(compMenuArr&&compMenuArr.length){for(var a=compMenuArr.length;
a--;
){var pos=compMenuArr[a].getId().indexOf("contentDomain"+compID);
if(pos>=0){compMenuArr[a].setIsSelected(false);
}}}menuItem.setIsSelected(true);
if(contentDomainCd>0){var sendAr=["^MINE^",contentDomainCd+".0",criterion.encntr_id+".0",criterion.provider_id+".0"];
var scriptRequest=new ComponentScriptRequest();
scriptRequest.setParameterArray(sendAr);
scriptRequest.setComponent(self);
scriptRequest.setProgramName("MP_GET_PAT_EDU_CONTENTTYPE");
scriptRequest.setAsyncIndicator(true);
scriptRequest.performRequest();
}};
};
PatientEducationO2Component.prototype.createDiagnosisList=function(reply){var diagnosisCount=reply.length;
var diagnosisArray=[];
for(var diagIndex=0;
diagIndex<diagnosisCount;
diagIndex++){var diagData=reply[diagIndex];
var diagInstCount=diagData.INSTRUCTS.length;
if(diagInstCount>0){var diagElement={};
diagElement.displayName=diagData.DIAGNOSIS_DISPLAY;
diagElement.INSTRUCTS=[];
for(var instIndex=0;
instIndex<diagInstCount;
instIndex++){var instData=diagData.INSTRUCTS[instIndex];
var InstObj={};
InstObj.id=instData.RELATION_ID;
InstObj.name=instData.NAME;
InstObj.langId=instData.DOC_LANG_ID;
InstObj.keyDocId=instData.KEY_DOC_IDENT;
InstObj.ReferTextId=instData.REFR_TEXT_ID;
InstObj.trackingGroupCd=instData.TRACKING_GROUP_CD;
InstObj.personId=instData.PERSON_ID;
var mapObj=new this.mapObject(InstObj.id,InstObj);
diagElement.INSTRUCTS.push(mapObj);
}diagnosisArray.push(diagElement);
}}this.setDiagnosisArray(diagnosisArray);
};
PatientEducationO2Component.prototype.renderComponent=function(reply){var compId=this.getComponentId();
var criterion=this.getCriterion();
var component=this;
var patientEduHTML="";
var jsPatEduHTML=[];
var instCount=reply.QUAL.length;
var i18nPatEdu=i18n.discernabu.patienteducation_o2;
var capTimer=MP_Util.CreateTimer("CAP:MPG.PATIENT_EDUCATION.O2 - Rendering component");
var timerRenderComponent=MP_Util.CreateTimer(this.getComponentRenderTimerName(),this.getCriterion().category_mean);
try{this.setDomainCd(reply.DOMAIN_CD);
if(reply.IS_ADD_TASK_GRANTED){this.setAddTaskGranted(true);
}if(reply.IS_REMOVE_TASK_GRANTED){this.setRemoveTaskGranted(true);
}if(reply.IS_CONTENT_TASK_GRANTED){this.setContentTaskGranted(true);
}if(reply.IS_CUSTOM_TASK_GRANTED){this.setCustomTaskGranted(true);
}if(typeof(reply.TRACKING_GROUP_CD)!=="undefined"){this.setTrackingGroupCd(reply.TRACKING_GROUP_CD);
}if(reply.TRACKING_GROUP_CD===0){var errorBannerHtml="<div id='errBannerContainer"+compId+"'>";
var errorBanner=new MPageUI.AlertBanner();
errorBanner.setType(MPageUI.ALERT_OPTIONS.TYPE.ERROR);
errorBanner.setPrimaryText(i18nPatEdu.INVALID_NURSEUNIT);
errorBanner.setSecondaryText(i18nPatEdu.BANNER_SECONDARY_TEXT);
errorBannerHtml=errorBannerHtml+errorBanner.render()+"</div>";
jsPatEduHTML.push(errorBannerHtml);
}if(typeof(reply.DEF_LANG_ID)!=="undefined"){this.setLanguageId(reply.DEF_LANG_ID);
}if(typeof(reply.CONTENTS)!=="undefined"){this.addMenu(reply.CONTENTS,reply.DOMAIN_CD);
}jsPatEduHTML.push("<div class='pe-o2-tab-container'><div class='pe-o2-tabs'><div class='pe-o2-tab active' id='Instructions"+compId+"' data-attr='pe-o2-inst-"+compId+"'>"+i18nPatEdu.EDUCATION+"</div></div><div class='pe-o2-lang-container'>"+this.createLanguageCombo(reply)+"</div></div><div id='pe-o2-inst-"+compId+"' class='pe-o2-tab-wrapper'><div class='pe-o2-search-bar'><span id='pe-o2-add-inst-icon"+compId+"' class='pe-o2-add-icon'></span><div class='pe-o2-inst-search'>"+MP_Util.CreateAutoSuggestBoxHtml(component,"searchInst")+"<span id='pe-o2-clear-text"+compId+"' class='pe-o2-clear-text'></span></div><div class='pe-o2-segment-tab' id='segmentContent"+compId+"'><div class='pe-o2-seg-tabs' id='segmentCntrlSugg"+compId+"' data-attr='suggestions'>"+i18nPatEdu.SUGGESTIONS+"</div> <div class='pe-o2-seg-tabs' id='segmentCntrlCust"+compId+"' data-attr='custom'>"+i18nPatEdu.CUSTOM_EDUCATION+"</div><div class='pe-o2-seg-tabs' id='segmentCntrlFav"+compId+"' data-attr='favorites'>"+i18nPatEdu.FAVORITES+"</div></div><span class='pe-o2-toggle pe-o2-collapse'></span></div><div class='pe-o2-content-wrapper' id='pe-o2-sugg-inst"+compId+"'></div></div></div>");
jsPatEduHTML.push("<div class='pe-o2-added-inst'><div id='pe-o2-added-inst"+compId+"' class='pe-o2-added-container'></div><div id='pe-o2-added-meds"+compId+"' class='pe-o2-added-meds-container'></div></div>");
patientEduHTML=jsPatEduHTML.join("");
this.setResultCount(instCount);
this.updateSatisfierRequirementIndicator();
this.finalizeComponent(patientEduHTML,"");
if(typeof(reply.FAVORITES)!=="undefined"){this.createFavoritesList(reply.FAVORITES);
}this.displayAddedMedicationLeaflets(reply);
this.displayAddedInstructions(reply);
this.attachListeners();
MP_Util.AddAutoSuggestControl(component,component.searchInstructions,null,null,"searchInst");
}catch(err){if(timerRenderComponent){timerRenderComponent.Abort();
timerRenderComponent=null;
}if(capTimer){capTimer.SubtimerName=criterion.category_mean;
capTimer.Stop();
}throw (err);
}finally{if(timerRenderComponent){timerRenderComponent.Stop();
}if(capTimer){capTimer.SubtimerName=criterion.category_mean;
capTimer.Stop();
}}};
PatientEducationO2Component.prototype.updateFavoritesList=function(){var component=this;
var criterion=component.getCriterion();
var scriptRequest=new ScriptRequest();
scriptRequest.setParameterArray(["^MINE^",criterion.provider_id+".0",component.getDomainCd()+".0",component.getTrackingGroupCd()+".0"]);
scriptRequest.setProgramName("MP_GET_PAT_EDU_FAVORITES");
scriptRequest.setAsyncIndicator(true);
scriptRequest.setResponseHandler(function(scriptReply){if(scriptReply.getStatus()==="S"){var recordData=scriptReply.getResponse();
var favoriteInstCount=recordData.QUAL.length;
var favoriteInstArray=[];
for(var favriteCount=0;
favriteCount<favoriteInstCount;
favriteCount++){var favoriteElement=recordData.QUAL[favriteCount];
var favoriteInstDetails=null;
if(favoriteInstArray){favoriteInstDetails=component.getValueFromArray(favoriteElement.PAT_ED_RELTN_ID,favoriteInstArray);
}if(favoriteInstDetails){if(favoriteElement.PERSON_ID>0){favoriteInstDetails.value.personId=favoriteElement.PERSON_ID;
}if(favoriteElement.TRACKING_GROUP_CD>0){favoriteInstDetails.value.trackingGroup=favoriteElement.TRACKING_GROUP_CD;
}}else{var InstObj={};
InstObj.id=favoriteElement.PAT_ED_RELTN_ID;
InstObj.personId=favoriteElement.PERSON_ID;
InstObj.langId=favoriteElement.DOC_LANG_ID;
InstObj.description=favoriteElement.PAT_ED_DESC;
InstObj.trackingGroup=favoriteElement.TRACKING_GROUP_CD;
var mapObj=new component.mapObject(InstObj.id,InstObj);
favoriteInstArray.push(mapObj);
}}component.setFavoriteInstructionArray(favoriteInstArray);
}});
scriptRequest.performRequest();
};
PatientEducationO2Component.prototype.createFavoritesList=function(reply){var favoriteInstCount=reply.length;
var favoriteInstArray=[];
for(var favoriteCount=0;
favoriteCount<favoriteInstCount;
favoriteCount++){var favoriteElement=reply[favoriteCount];
var favoriteInstDetails=null;
if(favoriteInstArray){favoriteInstDetails=this.getValueFromArray(favoriteElement.PAT_ED_RELTN_ID,favoriteInstArray);
}if(favoriteInstDetails){if(favoriteElement.PERSON_ID>0){favoriteInstDetails.value.personId=favoriteElement.PERSON_ID;
}if(favoriteElement.TRACKING_GROUP_CD>0){favoriteInstDetails.value.trackingGroup=favoriteElement.TRACKING_GROUP_CD;
}}else{var InstObj={};
InstObj.id=favoriteElement.PAT_ED_RELTN_ID;
InstObj.personId=favoriteElement.PERSON_ID;
InstObj.langId=favoriteElement.DOC_LANG_ID;
InstObj.description=favoriteElement.PAT_ED_DESC;
InstObj.trackingGroup=favoriteElement.TRACKING_GROUP_CD;
var mapObj=new this.mapObject(InstObj.id,InstObj);
favoriteInstArray.push(mapObj);
}}this.setFavoriteInstructionArray(favoriteInstArray);
};
PatientEducationO2Component.prototype.createLanguageCombo=function(reply){var languageHTML="";
var languageElement=null;
var defaultLanguage="";
var jsPatEduHTML=[];
var i18nPatEdu=i18n.discernabu.patienteducation_o2;
var compId=this.getComponentId();
var languageCount=reply.LANGUAGES.length;
jsPatEduHTML.push("<select id='pe-o2-lang-combobox-"+compId+"' class='pe-o2-combobox'><option value='0'>"+i18nPatEdu.ALL_LANGUAGES+"</option>");
var languageFound=false;
for(var languageId=0;
languageId<languageCount;
languageId++){languageElement=reply.LANGUAGES[languageId];
if(reply.DEF_LANG_ID===languageElement.DOC_LANG_ID_VALUE){defaultLanguage="selected";
languageFound=true;
}else{defaultLanguage="";
}if(languageElement.DISPLAY!==""){languageHTML=languageHTML+"<option value='"+languageElement.DOC_LANG_ID_VALUE+"' "+defaultLanguage+">"+languageElement.DISPLAY+"</option>";
}}jsPatEduHTML.push(languageHTML+"</select>");
if(!languageFound){this.setLanguageId(0);
}return jsPatEduHTML.join("");
};
PatientEducationO2Component.prototype.isRequirementSatisfied=function(){var count=this.getResultCount()||0;
return count>0;
};
PatientEducationO2Component.prototype.updateSatisfierRequirementIndicator=function(){if(this.getGapCheckRequiredInd()){var isReqSatisfied=this.isRequirementSatisfied();
this.setSatisfiedInd(isReqSatisfied);
CERN_EventListener.fireEvent(this,this,EventListener.EVENT_SATISFIER_UPDATE,{satisfied:isReqSatisfied});
this.updateComponentRequiredIndicator();
}};
PatientEducationO2Component.prototype.getSearchResultsForAllTab=function(searchVal){var self=this;
var scriptRequest=new ScriptRequest();
var rtmsTimer=new RTMSTimer("ENG:MPG.PATIENTEDUCATION.O2 - load Tab Content");
scriptRequest.setAsyncIndicator(false);
scriptRequest.setProgramName("MP_GET_PAT_EDU_INSTRUCTIONS");
searchVal=searchVal.replace(/\^/g,"&#94;");
scriptRequest.setParameterArray(["^MINE^",self.getDomainCd()+".0","^"+searchVal+"^",0,self.getLanguageId()+".0","0.0",0]);
scriptRequest.setResponseHandler(function(reply){if(rtmsTimer){rtmsTimer.stop();
}if(reply.getStatus()==="S"){var record_data=reply.getResponse();
self.displayAllTabContent(record_data);
}});
rtmsTimer.start();
scriptRequest.performRequest();
};
PatientEducationO2Component.prototype.searchInstructions=function(callback,textBox){var component=this.component;
var searchText=textBox.value.replace(/^\s+|\s+$/g,"");
if(searchText.length<3){return;
}clearTimeout(component.getTimerId());
var timerId=setTimeout(function(){component.getSearchResultsForAllTab(searchText);
},500);
component.setTimerId(timerId);
};
PatientEducationO2Component.prototype.displaySuggestedInstructions=function(){var self=this;
var compID=this.getComponentId();
var tabContent=$("#pe-o2-sugg-inst"+compID);
var i18nPatEdu=i18n.discernabu.patienteducation_o2;
var noResultFound=self.noSearchResultsHtml(i18nPatEdu.NO_SUGGESTED_EDUCATION);
var diagnosisArray=self.getDiagnosisArray();
var diagCount=diagnosisArray.length;
var folderElem=$("<ul class='pe-o2-folder-structure'></ul>");
var wrapperObj=$("<div class='pe-o2-items-cont-wrapper'></div>");
var diagnosisInstObj=null;
var navElem=null;
if(diagCount>0){for(var diagIndex=0;
diagIndex<diagCount;
diagIndex++){var diagData=diagnosisArray[diagIndex];
var diagInstCount=diagData.INSTRUCTS.length;
if(diagInstCount>0){navElem=$("<li class='pe-o2-folder-name pe-o2-white-hover' data-attr='"+diagData.displayName+compID+"'>"+diagData.displayName+"</li>");
folderElem.append(navElem);
diagnosisInstObj=$("<div class='pe-o2-items-cont' id='"+diagData.displayName+compID+"'></div>");
wrapperObj.append(diagnosisInstObj);
}}folderElem.prepend($("<li class='pe-o2-folder-name pe-o2-white-hover' data-attr='all-sug"+compID+"'>"+i18nPatEdu.ALL_SUGGESTIONS+"</li>"));
wrapperObj.prepend($("<div class='pe-o2-items-cont' id='all-sug"+compID+"'></div>"));
tabContent.empty().append(folderElem).append(wrapperObj);
}else{tabContent.html(noResultFound);
}};
PatientEducationO2Component.prototype.displayFavoriteInstructions=function(){var compID=this.getComponentId();
var tabContent=$("#pe-o2-sugg-inst"+compID);
var i18nPatEdu=i18n.discernabu.patienteducation_o2;
var folderElem=$("<ul class='pe-o2-folder-structure'><li class='pe-o2-folder-name pe-o2-white-hover' data-attr='all-fav"+compID+"'>"+i18nPatEdu.ALL_FAVORITES+"</li><li class='pe-o2-folder-name pe-o2-white-hover' data-attr='personal-fav"+compID+"'>"+i18nPatEdu.PERSONAL_FAVORITES+"</li><li class='pe-o2-folder-name pe-o2-white-hover' data-attr='dept-fav"+compID+"'>"+i18nPatEdu.DEPARTMENTAL_FAVORITES+"</li></ul>");
var wrapperObj=$("<div class='pe-o2-items-cont-wrapper'></div>");
wrapperObj.append("<div class='pe-o2-items-cont' id='all-fav"+compID+"'></div><div class='pe-o2-items-cont' id='personal-fav"+compID+"'></div><div class='pe-o2-items-cont' id='dept-fav"+compID+"'></div>");
tabContent.empty().append(folderElem).append(wrapperObj);
};
PatientEducationO2Component.prototype.displayCustomInstructions=function(){var compID=this.getComponentId();
var tabContent=$("#pe-o2-sugg-inst"+compID);
var i18nPatEdu=i18n.discernabu.patienteducation_o2;
var folderElem=$("<ul class='pe-o2-folder-structure'><li class='pe-o2-folder-name pe-o2-white-hover' data-attr='all-custom"+compID+"'>"+i18nPatEdu.ALL_CUSTOM_EDUCATION+"</li><li class='pe-o2-folder-name pe-o2-white-hover' data-attr='personal-custom"+compID+"'>"+i18nPatEdu.PERSONAL_CUSTOM_EDUCATION+"</li><li class='pe-o2-folder-name pe-o2-white-hover' data-attr='public-custom"+compID+"'>"+i18nPatEdu.PUBLIC_CUSTOM_EDUCATION+"</li></ul>");
var wrapperObj=$("<div class='pe-o2-items-cont-wrapper'></div>");
wrapperObj.append("<div class='pe-o2-items-cont' id='all-custom"+compID+"'></div><div class='pe-o2-items-cont' id='personal-custom"+compID+"'></div><div class='pe-o2-items-cont' id='public-custom"+compID+"'></div>");
tabContent.empty().append(folderElem).append(wrapperObj);
};
PatientEducationO2Component.prototype.getSuggestedInstructions=function(){var self=this;
var criterion=this.getCriterion();
var scriptRequest=new ScriptRequest();
var rtmsTimer=new RTMSTimer("ENG:MPG.PATIENTEDUCATION.O2 - Fetch Suggested Instructions");
scriptRequest.setAsyncIndicator(false);
scriptRequest.setProgramName("MP_GET_DIAGNOSIS_INST");
scriptRequest.setParameterArray(["^MINE^",criterion.encntr_id+".0",self.getLanguageId()+".0",self.getDomainCd()+".0"]);
scriptRequest.setResponseHandler(function(reply){if(rtmsTimer){rtmsTimer.stop();
}if(reply.getStatus()==="S"){var record_data=reply.getResponse();
self.createDiagnosisList(record_data.ITEM);
var instArray=[];
var replyCount=record_data.ITEM.length;
for(var diagIndex=0;
diagIndex<replyCount;
diagIndex++){var diagData=record_data.ITEM[diagIndex];
var diagInstCount=diagData.INSTRUCTS.length;
if(diagInstCount>0){for(var instIndex=0;
instIndex<diagInstCount;
instIndex++){var instData=diagData.INSTRUCTS[instIndex];
var InstObj={};
InstObj.id=instData.RELATION_ID;
InstObj.name=instData.NAME;
InstObj.langId=instData.DOC_LANG_ID;
InstObj.keyDocId=instData.KEY_DOC_IDENT;
InstObj.ReferTextId=instData.REFR_TEXT_ID;
InstObj.trackingGroupCd=instData.TRACKING_GROUP_CD;
InstObj.personId=instData.PERSON_ID;
var mapObj=new self.mapObject(InstObj.id,InstObj);
instArray.push(mapObj);
}}}self.setInstructionArray(instArray);
}});
rtmsTimer.start();
scriptRequest.performRequest();
};
PatientEducationO2Component.prototype.displayAllTabContent=function(recordData){var compID=this.getComponentId();
var tabContent=$("#pe-o2-sugg-inst"+compID);
var i18nPatEdu=i18n.discernabu.patienteducation_o2;
var noResultFound=this.noSearchResultsHtml(i18nPatEdu.NO_EDUCATION_TO_DISPLAY);
var replyLength=recordData.QUAL.length;
if(replyLength>0){tabContent.html("<div class='pe-o2-items-cont'><div class='pe-o2-all-inst' id='inst-all-search"+compID+"'></div><div id='pager-all-search"+compID+"'></div></div>");
this.m_currInstArray=[];
this.m_pagerInstance=null;
this.pageIndex=0;
this.m_currentPage=0;
this.m_currentFolder="all-search"+compID;
this.loadSelectiveAllTabContent(0,replyLength,recordData.QUAL,"all-search"+compID,replyLength);
}else{tabContent.html(noResultFound);
}};
PatientEducationO2Component.prototype.getAddedInstructions=function(){var self=this;
var criterion=self.getCriterion();
var cclParam=[];
var scriptRequest=new ScriptRequest();
cclParam.push("^MINE^",criterion.person_id+".0",criterion.encntr_id+".0",self.getDomainCd()+".0");
scriptRequest.setParameterArray(cclParam);
scriptRequest.setProgramName("MP_GET_SELECTED_INSTRUCTIONS");
scriptRequest.setAsyncIndicator(true);
scriptRequest.setResponseHandler(function(scriptReply){var report_data=scriptReply.getResponse();
if(report_data.STATUS_DATA.STATUS==="S"){self.displayAddedInstructions(report_data);
}});
scriptRequest.performRequest();
};
PatientEducationO2Component.prototype.noAddedInstructionHtml=function(){var noDataHtml=[];
var educationAssessLinkHtml=this.displayEducationAssessLink();
var i18nPatEdu=i18n.discernabu.patienteducation_o2;
noDataHtml.push("<div class='pe-o2-header-result'><span class='pe-o2-header-text'>"+i18nPatEdu.ADDED_EDUCATION+"</span></div><div class='pe-o2-no-result'>"+i18nPatEdu.NO_ADDED_EDUCATION+"</div><div class='pe-o2-edu-link'>"+educationAssessLinkHtml+"</div>");
return noDataHtml.join("");
};
PatientEducationO2Component.prototype.noSearchResultsHtml=function(text){var noDataHtml=[];
noDataHtml.push("<div class='pe-o2-empty-search-result'><span class='pe-o2-empty-search-image'></span><div class='pe-o2-empty-search-text'>"+text+"</div></div>");
return noDataHtml.join("");
};
PatientEducationO2Component.prototype.noAddedMedsHtml=function(){var noDataHtml=[];
var i18nPatEdu=i18n.discernabu.patienteducation_o2;
noDataHtml.push("<div class='pe-o2-header-result'><span class='pe-o2-header-text'>"+i18nPatEdu.ADDED_MEDICATIONS+"</span></div><div class='pe-o2-no-result'>"+i18nPatEdu.NO_ADDED_MEDICATIONS+"</div>");
return noDataHtml.join("");
};
PatientEducationO2Component.prototype.displayAddedMedicationLeaflets=function(report_data){var component=this;
var compID=this.getComponentId();
var medicationHtml=[];
var medsArray=[];
var replyLength=(report_data.QUAL_MEDS)?report_data.QUAL_MEDS.length:0;
var medsDiv=$("#pe-o2-added-meds"+compID);
var i18nPatEdu=i18n.discernabu.patienteducation_o2;
if(replyLength<=0){medsDiv.empty().append(component.noAddedMedsHtml());
component.setResultCount(0);
component.updateSatisfierRequirementIndicator();
}else{if(replyLength>=1){component.setResultCount(replyLength);
component.updateSatisfierRequirementIndicator();
}medicationHtml.push("<div class='pe-o2-header-result'><span class='pe-o2-header-text'>"+i18nPatEdu.ADDED_MEDICATIONS+"</span></div><div class='pe-o2-meds-leaflet-data-container' id='pe-o2-meds-leaflet-data-container"+compID+"'>");
for(var iCount=0;
iCount<replyLength;
iCount++){var medsElement=report_data.QUAL_MEDS[iCount];
var medsName=medsElement.LEAFLET_NAME.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;");
medicationHtml.push("<dl id = '"+medsElement.DOC_ACTIVITY_ID+"' class='pe-o2-meds-res'><span class='pe-o2-meds-data'>"+medsName+"</span><div class='pe-o2-meds-modify'></dl>");
var medsObj={};
medsObj.id=medsElement.DOC_ACTIVITY_ID;
medsObj.cki=medsElement.MED_LEAFLET_CKI;
medsObj.name=medsElement.LEAFLET_NAME;
var mapObj=new this.mapObject(medsObj.id,medsObj);
medsArray.push(mapObj);
}medicationHtml.push("</div>");
this.setSelectedInstructionArray(medsArray);
medsDiv.empty().append(medicationHtml.join(""));
}};
PatientEducationO2Component.prototype.displayAddedInstructions=function(report_data){var compID=this.getComponentId();
var instructionHtml=[];
var instArray=[];
var replyLength=(report_data.QUAL)?report_data.QUAL.length:0;
var instructionDiv=$("#pe-o2-added-inst"+compID);
var i18nPatEdu=i18n.discernabu.patienteducation_o2;
var component=this;
var educationAssessLinkHtml=component.displayEducationAssessLink();
var favoriteClass="";
var favoriteInstDetails=null;
component.setResultCount(replyLength);
if(replyLength<=0){instructionDiv.html(component.noAddedInstructionHtml());
component.updateSatisfierRequirementIndicator();
}else{component.updateSatisfierRequirementIndicator();
instructionHtml.push("<div class='pe-o2-header-result' id='pe-o2-header-result"+compID+"'><span class='pe-o2-header-text'>"+i18nPatEdu.ADDED_EDUCATION+"</span></div><div class='pe-o2-res-content' id='pe-o2-res-content"+compID+"'>");
for(var iCount=0;
iCount<replyLength;
iCount++){var instElement=report_data.QUAL[iCount];
favoriteClass="";
var instName=instElement.DESC.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;");
favoriteInstDetails=this.getValueFromArray(instElement.RELTN_ID,this.getFavoriteInstructionArray());
if(favoriteInstDetails){favoriteClass=" active";
}instructionHtml.push("<dl id = '"+instElement.PAT_ED_DOC_ACTIVITY_ID+"' class='pe-o2-inst-res' title='"+instName+"'><span class='pe-o2-inst-data'>"+instName+"</span><div class='pe-o2-inst-modify'><span id = '"+instElement.PAT_ED_DOC_ACTIVITY_ID+compID+"' data-attr='"+instElement.RELTN_ID+"' class='pe-o2-inst-favorite"+favoriteClass+"' title="+i18nPatEdu.FAVORITES+"></span><span class='pe-o2-print' title="+i18nPatEdu.PRINT+"></span><span class='pe-o2-remove' title="+i18nPatEdu.REMOVE+"></span></div></dl>");
var InstObj={};
InstObj.id=instElement.PAT_ED_DOC_ACTIVITY_ID;
InstObj.reltnid=instElement.RELTN_ID;
InstObj.name=instElement.DESC;
InstObj.langId=instElement.DOC_LANG_ID_VALUE;
InstObj.keyDocId=instElement.KEY_DOC_IDENT;
var mapObj=new this.mapObject(InstObj.id,InstObj);
instArray.push(mapObj);
}this.setSelectedInstructionArray(instArray);
instructionHtml.push("</div><div class='pe-o2-edu-link'>"+educationAssessLinkHtml+"</div>");
instructionDiv.html(instructionHtml.join(""));
$("#pe-o2-res-content"+compID).height("85px");
$("#pe-o2-header-result"+compID).append(component.createPrintAllLink());
}};
PatientEducationO2Component.prototype.getFavoriteInstructions=function(currentFolder){var component=this;
var criterion=component.getCriterion();
var compId=this.getComponentId();
var scriptRequest=new ScriptRequest();
var label="";
var arrayInfo=null;
var i18nPatEdu=i18n.discernabu.patienteducation_o2;
scriptRequest.setProgramName("MP_GET_PAT_EDU_FAVORITES");
scriptRequest.setParameterArray(["^MINE^",criterion.provider_id+".0",component.getDomainCd()+".0",component.getTrackingGroupCd()+".0"]);
scriptRequest.setResponseHandler(function(reply){var recordData=reply.getResponse();
var favoriteInstCount=recordData.QUAL.length;
var favoriteInstArray=[];
var personalFavoriteInst=[];
var departmentFavoriteInst=[];
var selectedInstLangId=parseInt(component.getLanguageId(),10);
var allLanguageId=0;
for(var favriteCount=0;
favriteCount<favoriteInstCount;
favriteCount++){var favoriteElement=recordData.QUAL[favriteCount];
var favoriteInstDetails=null;
if(favoriteInstArray.length>0){favoriteInstDetails=component.getValueFromArray(favoriteElement.PAT_ED_RELTN_ID,favoriteInstArray);
}if(favoriteInstDetails&&(selectedInstLangId===favoriteInstDetails.value.langId||selectedInstLangId===allLanguageId)){if(favoriteElement.PERSON_ID>0){favoriteInstDetails.value.personId=favoriteElement.PERSON_ID;
personalFavoriteInst.push(favoriteInstDetails);
}if(favoriteElement.TRACKING_GROUP_CD>0){favoriteInstDetails.value.trackingGroupCd=favoriteElement.TRACKING_GROUP_CD;
departmentFavoriteInst.push(favoriteInstDetails);
}}else{if(selectedInstLangId===favoriteElement.DOC_LANG_ID||selectedInstLangId===allLanguageId){var InstObj={};
InstObj.id=favoriteElement.PAT_ED_RELTN_ID;
InstObj.personId=favoriteElement.PERSON_ID;
InstObj.langId=favoriteElement.DOC_LANG_ID;
InstObj.name=favoriteElement.PAT_ED_DESC;
InstObj.trackingGroupCd=favoriteElement.TRACKING_GROUP_CD;
var mapObj=new component.mapObject(InstObj.id,InstObj);
favoriteInstArray.push(mapObj);
if(favoriteElement.PERSON_ID>0){personalFavoriteInst.push(mapObj);
}if(favoriteElement.TRACKING_GROUP_CD>0){departmentFavoriteInst.push(mapObj);
}}}}switch(currentFolder){case"personal-fav"+compId:label=i18nPatEdu.PERSONAL_FAVORITES;
arrayInfo=personalFavoriteInst;
break;
case"dept-fav"+compId:label=i18nPatEdu.DEPARTMENTAL_FAVORITES;
arrayInfo=departmentFavoriteInst;
break;
case"all-fav"+compId:label=i18nPatEdu.ALL_FAVORITES;
arrayInfo=favoriteInstArray;
break;
}var currInstObj=$("[id='"+currentFolder+"']");
currInstObj.html("<div class='pe-o2-items-label'>"+label+"</div><div id='inst-"+currentFolder+"'></div><div id='pager-"+currentFolder+"'></div>");
component.loadSelectiveInstructions(0,arrayInfo.length,arrayInfo,currentFolder,arrayInfo.length);
});
scriptRequest.performRequest();
};
PatientEducationO2Component.prototype.getCustomInstructions=function(currentFolder){var component=this;
var criterion=component.getCriterion();
var compId=this.getComponentId();
var scriptRequest=new ScriptRequest();
var label="";
var arrayInfo=null;
var self=this;
var i18nPatEdu=i18n.discernabu.patienteducation_o2;
scriptRequest.setProgramName("MP_GET_CUSTOM_INSTRUCTIONS");
scriptRequest.setParameterArray(["^MINE^",component.getDomainCd()+".0"]);
scriptRequest.setResponseHandler(function(reply){var recordData=reply.getResponse();
var customInstCount=recordData.QUAL.length;
var customInstArray=[];
var personalCustomInst=[];
var publicCustomInst=[];
var selectedInstLangId=parseInt(component.getLanguageId(),10);
var allLanguageId=0;
for(var instCount=0;
instCount<customInstCount;
instCount++){var instElement=recordData.QUAL[instCount];
var customInstDetails=null;
if(!self.getCustomTaskGranted()&&(instElement.PRSNL_ID!==criterion.provider_id)&&(instElement.PRSNL_ID>0)){continue;
}if(customInstArray.length>0){customInstDetails=component.getValueFromArray(instElement.RELATION_ID,customInstArray);
}if(customInstDetails&&(selectedInstLangId===customInstDetails.value.langId||selectedInstLangId===allLanguageId)){if(instElement.PRSNL_ID>0){customInstDetails.value.personId=instElement.PRSNL_ID;
personalCustomInst.push(customInstDetails);
}else{customInstDetails.value.trackingGroupCd=instElement.TRACKING_GROUP_CD;
publicCustomInst.push(customInstDetails);
}}else{if(selectedInstLangId===instElement.DOC_LANG_ID||selectedInstLangId===allLanguageId){var InstObj={};
InstObj.id=instElement.RELATION_ID;
InstObj.personId=instElement.PRSNL_ID;
InstObj.langId=instElement.DOC_LANG_ID;
InstObj.name=instElement.NAME;
InstObj.keyDocId=instElement.KEY_DOC_ID;
InstObj.trackingGroupCd=instElement.TRACKING_GROUP_CD;
var mapObj=new component.mapObject(InstObj.id,InstObj);
customInstArray.push(mapObj);
if(instElement.PRSNL_ID>0){personalCustomInst.push(mapObj);
}else{publicCustomInst.push(mapObj);
}}}}switch(currentFolder){case"personal-custom"+compId:label=i18nPatEdu.PERSONAL_CUSTOM_EDUCATION;
arrayInfo=personalCustomInst;
break;
case"public-custom"+compId:label=i18nPatEdu.PUBLIC_CUSTOM_EDUCATION;
arrayInfo=publicCustomInst;
break;
case"all-custom"+compId:label=i18nPatEdu.ALL_CUSTOM_EDUCATION;
arrayInfo=customInstArray;
break;
}var currInstObj=$("[id='"+currentFolder+"']");
currInstObj.html("<div class='pe-o2-items-label'>"+label+"</div><div id='inst-"+currentFolder+"'></div><div id='pager-"+currentFolder+"'></div>");
component.loadSelectiveInstructions(0,arrayInfo.length,arrayInfo,currentFolder,arrayInfo.length);
});
scriptRequest.performRequest();
};
PatientEducationO2Component.prototype.getValueFromArray=function(name,array){if(array!==null){for(var x=0,xi=array.length;
x<xi;
x++){if(array[x].name==name){return array[x];
}}}return null;
};
PatientEducationO2Component.prototype.getSuggInstArrayList=function(currentFolder){var self=this;
var instArray=[];
var diagnosisArray=self.getDiagnosisArray();
var compId=this.getComponentId();
var diagCount=diagnosisArray.length;
var diagInstCount=0;
var arrayCount=0;
var diagData="";
var label="";
var i18nPatEdu=i18n.discernabu.patienteducation_o2;
var currInstObj=$("[id='"+currentFolder+"']");
if(diagCount>0){for(var diagIndex=0;
diagIndex<diagCount;
diagIndex++){diagData=diagnosisArray[diagIndex];
diagInstCount=diagData.INSTRUCTS.length;
if(currentFolder==="all-sug"+compId){instArray=instArray.concat(diagData.INSTRUCTS);
}else{if(currentFolder===diagData.displayName+compId){instArray=diagData.INSTRUCTS;
break;
}}}}if(currentFolder==="all-sug"+compId){arrayCount=instArray.length;
label=i18nPatEdu.SUGGESTIONS_BASED_ON+" "+i18nPatEdu.ALL_THIS_VISIT_PROBLEM;
}else{arrayCount=diagInstCount;
label=i18nPatEdu.SUGGESTIONS_BASED_ON+" "+diagData.displayName;
}currInstObj.html("<div class='pe-o2-items-label'>"+label+"</div><div id='inst-"+currentFolder+"'></div><div id='pager-"+currentFolder+"'></div>");
self.loadSelectiveInstructions(0,arrayCount,instArray,currentFolder,arrayCount);
};
PatientEducationO2Component.prototype.loadSelectiveInstructions=function(startIndex,endIndex,instArray,currentFolder,totalCount){var suggInstObj=null;
var currInstArray=[];
var self=this;
var compId=this.getComponentId();
var currInstObj=$("[id='inst-"+currentFolder+"']").empty();
var pagerObj=$("[id='pager-"+currentFolder+"']");
var favoritesClass="";
var favoriteInstDetails=null;
var foldername=currentFolder.replace(/\s/gi,"_");
var i18nPatEdu=i18n.discernabu.patienteducation_o2;
if(instArray.length>0){for(var i=startIndex;
i<endIndex;
i++){if((i>=totalCount)||i%20===0&&suggInstObj!==null){break;
}if(i%10===0){if(suggInstObj!==null){currInstObj.append(suggInstObj);
}suggInstObj=$("<div class='pe-o2-add-items-col'></div>");
}favoriteInstDetails=self.getValueFromArray(instArray[i].value.id,self.getFavoriteInstructionArray());
favoritesClass="";
if(favoriteInstDetails){favoritesClass=" active";
}var instData=instArray[i].value;
suggInstObj.append("<dl id='"+instData.id+"' class='pe-o2-res' title='"+instData.name+"'><dt class='pe-o2-name'>"+instData.name+"</dt><dd id='"+foldername+instData.id+compId+"' class='pe-o2-favorite"+favoritesClass+"'>&nbsp;</dd></dl>");
var InstObj={};
InstObj.id=instData.id;
InstObj.name=instData.name;
InstObj.langId=instData.langId;
InstObj.keyDocId=instData.keyDocId;
InstObj.ReferTextId=instData.ReferTextId;
InstObj.trackingGroupCd=instData.trackingGroupCd;
InstObj.personId=instData.personId;
var mapObj=new self.mapObject(InstObj.id,InstObj);
currInstArray.push(mapObj);
}currInstObj.append(suggInstObj);
self.setInstructionArray(currInstArray);
self.m_totalResults=totalCount;
self.m_currInstArray=instArray;
if(totalCount>20&&self.m_pagerInstance===null){self.m_pagerInstance=self.createPagerHtml("Others");
pagerObj.append(self.m_pagerInstance.render());
pagerObj.addClass("pe-o2-pager");
self.m_pagerInstance.attachEvents();
}}else{currInstObj.append(self.noSearchResultsHtml(i18nPatEdu.NO_EDUCATION_TO_DISPLAY));
}};
PatientEducationO2Component.prototype.loadSelectiveAllTabContent=function(startIndex,endIndex,instArray,currentFolder,totalCount){var suggInstObj=null;
var currInstArray=[];
var self=this;
var compId=this.getComponentId();
var currInstObj=$("[id='inst-"+currentFolder+"']").empty();
var pagerObj=$("[id='pager-"+currentFolder+"']");
var favoritesClass="";
var favoriteInstDetails=null;
var i18nPatEdu=i18n.discernabu.patienteducation_o2;
if(instArray.length>0){for(var i=startIndex;
i<endIndex;
i++){if((i>=totalCount)||i%20===0&&suggInstObj!==null){break;
}if(i%10===0){if(suggInstObj!==null){currInstObj.append(suggInstObj);
}suggInstObj=$("<div class='pe-o2-add-items-col'></div>");
}favoriteInstDetails=self.getValueFromArray(instArray[i].RELATION_ID,self.getFavoriteInstructionArray());
favoritesClass="";
if(favoriteInstDetails){favoritesClass=" active";
}var instData=instArray[i];
suggInstObj.append("<dl id='"+instData.RELATION_ID+"' class='pe-o2-res' title='"+instData.NAME+"'><dt class='pe-o2-name'>"+instData.NAME+"</dt><dd id='"+instData.RELATION_ID+compId+"' class='pe-o2-favorite"+favoritesClass+"'>&nbsp;</dd></dl>");
var InstObj={};
InstObj.id=instData.RELATION_ID;
InstObj.name=instData.NAME;
InstObj.langId=instData.DOC_LANG_ID;
InstObj.keyDocId=instData.KEY_DOC_IDENT;
InstObj.ReferTextId=instData.REFR_TEXT_ID;
InstObj.trackingGroupCd=instData.TRACKING_GROUP_CD;
InstObj.personId=instData.PERSON_ID;
var mapObj=new self.mapObject(InstObj.id,InstObj);
currInstArray.push(mapObj);
}currInstObj.append(suggInstObj);
self.setInstructionArray(currInstArray);
self.m_totalResults=totalCount;
self.m_currInstArray=instArray;
if(totalCount>20&&self.m_pagerInstance===null){self.m_pagerInstance=self.createPagerHtml("AllInstSearch");
pagerObj.append(self.m_pagerInstance.render());
pagerObj.addClass("pe-o2-pager");
self.m_pagerInstance.attachEvents();
}}else{currInstObj.append(self.noSearchResultsHtml(i18nPatEdu.NO_EDUCATION_TO_DISPLAY));
}};
PatientEducationO2Component.prototype.createPagerHtml=function(tabInfo){var pager=null;
var i18nPatEdu=i18n.discernabu.patienteducation_o2;
var self=this;
var totalPages=Math.ceil((self.m_totalResults/20));
pager=new MPageUI.Pager();
pager.setCurrentPageLabelPattern("${currentPage} / ${numberPages}").setPreviousLabel(i18nPatEdu.PREV).setNextLabel(i18nPatEdu.NEXT).setNumberPages(totalPages).setOnPageChangeCallback(function(){self.handlePagerClick(arguments[0].currentPage,tabInfo);
});
return pager;
};
PatientEducationO2Component.prototype.handlePagerClick=function(currentPage,tabInfo){var pageCount=20;
if(this.m_currentPage<currentPage){this.pageIndex=this.pageIndex+pageCount;
}else{this.pageIndex=this.pageIndex-pageCount;
}if(this.pageIndex<0){return;
}this.m_currentPage=currentPage;
switch(tabInfo){case"AllInstSearch":this.loadSelectiveAllTabContent(this.pageIndex,this.pageIndex+pageCount,this.m_currInstArray,this.m_currentFolder,this.m_totalResults);
break;
default:this.loadSelectiveInstructions(this.pageIndex,this.pageIndex+pageCount,this.m_currInstArray,this.m_currentFolder,this.m_totalResults);
break;
}};
PatientEducationO2Component.prototype.createPrintAllLink=function(){var compId=this.getComponentId();
var self=this;
var i18nPatEdu=i18n.discernabu.patienteducation_o2;
var printAllLink=$("<a class='pe-o2-print-all' id='pe-o2-print-all"+compId+"'>"+i18nPatEdu.PRINT_ALL+"</a>");
var printAllHandler=function(){printAllLink.off("click");
printAllLink.click(printAllHandler);
try{var criterion=self.getCriterion();
var personId=criterion.person_id;
var encntrId=criterion.encntr_id;
var objPatientEducation=window.external.DiscernObjectFactory("PATIENTEDUCATION");
objPatientEducation.PrintCoverPageToPrinter(personId,encntrId,"");
}catch(err){logger.logJSError(err,null,"patienteducation-o2.js","createPrintAllLink");
}};
printAllLink.click(printAllHandler);
return printAllLink[0];
};
PatientEducationO2Component.prototype.attachPopupToFavoritesButton=function(clickElementId){var popup=new MPageUI.Popup();
var popupHtml=[];
var i18nPatEdu=i18n.discernabu.patienteducation_o2;
var relationId=clickElementId;
var compId=this.getComponentId();
var favoriteDetails=null;
var personalFavorite="";
var departmentFavorite="";
var folderName=(this.m_currentFolder!==undefined&&this.m_currentFolder!=="")?this.m_currentFolder.replace(/\s/gi,"_"):"";
var anchorId=folderName+clickElementId+compId;
var componentContent=$(this.getSectionContentNode());
this.setPopupObject(popup);
if($("#"+clickElementId).hasClass("pe-o2-inst-res")){relationId=$("#"+clickElementId+compId).attr("data-attr");
anchorId=clickElementId+compId;
}if(!componentContent.find(".pe-o2-seg-tabs").hasClass("active")){anchorId=clickElementId+compId;
}favoriteDetails=this.getValueFromArray(relationId,this.getFavoriteInstructionArray());
if(favoriteDetails){if(favoriteDetails.value.personId>0){personalFavorite="checked";
}if(favoriteDetails.value.trackingGroup>0){departmentFavorite="checked";
}}popupHtml.push("<div class='pe-o2-satisfier-list'><input type='checkbox' "+personalFavorite+" id='pe-o2-personal-"+compId+"' class='pe-o2-popup-checkbox' data-control='personal'><span data-control='personal'  class='pe-o2-popup-label'>"+i18nPatEdu.PERSONAL_FAVORITES+"</span></input></div><div class='pe-o2-satisfier-list'><input type='checkbox' class='pe-o2-popup-checkbox' id='pe-o2-dept-"+compId+"' data-control='department' "+departmentFavorite+"><span data-control='department'  class='pe-o2-popup-label'>"+i18nPatEdu.DEPARTMENTAL_FAVORITES+"</span></input></div>");
popup.setBodyContent(popupHtml.join(""));
popup.setAnchorId(anchorId);
popup.show();
this.attachPopupHandler(clickElementId,relationId);
if(!this.getRemoveTaskGranted()&&$("#pe-o2-dept-"+compId).prop("checked")){$("#pe-o2-dept-"+compId).attr("disabled",true);
}if(!this.getAddTaskGranted()&&!$("#pe-o2-dept-"+compId).prop("checked")){$("#pe-o2-dept-"+compId).attr("disabled",true);
}};
PatientEducationO2Component.prototype.attachPopupHandler=function(clickElementId,relationId){var self=this;
var compId=this.getComponentId();
var popupObj=this.getPopupObject();
if(popupObj.isOpen()){$("#"+popupObj.m_id).on("click",".pe-o2-popup-label,.pe-o2-popup-checkbox",function(){var selectedSatisfier=$(this);
if(selectedSatisfier.attr("data-control")==="department"){self.handleGrantPermission(selectedSatisfier,relationId);
}else{if(selectedSatisfier.hasClass("pe-o2-popup-label")&&!selectedSatisfier.siblings().prop("checked")){selectedSatisfier.siblings().prop("checked",true);
}else{selectedSatisfier.siblings().prop("checked",false);
}if($("#pe-o2-personal-"+compId).prop("checked")){self.addPersonalFavorite(relationId);
}else{self.removePersonalFavorite(relationId);
}}});
}else{$("#"+popupObj.m_id).off("click",".pe-o2-popup-label,.pe-o2-popup-checkbox");
}$("body").mouseup(function(event){if(popupObj.exists()&&popupObj.isOpen()){if(!$(event.target).hasClass("tooltipster-content")&&!$(event.target).parents().hasClass("tooltipster-content")){popupObj.destroy();
}}});
$(".wrkflw-views").scroll(function(){if(popupObj.exists()){popupObj.destroy();
}});
};
PatientEducationO2Component.prototype.handleGrantPermission=function(satisfierObj,relationId){var component=this;
var compId=this.getComponentId();
var deptCheckBoxObj=$("#pe-o2-dept-"+compId);
if(this.getPopupObject().isOpen()&&!deptCheckBoxObj.prop("disabled")){if(component.getRemoveTaskGranted()&&component.getAddTaskGranted()){if(satisfierObj.hasClass("pe-o2-popup-label")&&satisfierObj.siblings().prop("checked")){satisfierObj.siblings().prop("checked",false);
}else{satisfierObj.siblings().prop("checked",true);
}if(deptCheckBoxObj.prop("checked")){component.addDepartmentalFavorite(relationId);
}else{component.removeDepartmentalFavorite(relationId);
}}else{if(component.getRemoveTaskGranted()){if(satisfierObj.hasClass("pe-o2-popup-label")&&satisfierObj.siblings().prop("checked")){satisfierObj.siblings().prop("checked",false);
}if(!deptCheckBoxObj.prop("checked")){component.removeDepartmentalFavorite(relationId);
}if(!component.getAddTaskGranted()){deptCheckBoxObj.attr("disabled",true);
}}else{if(component.getAddTaskGranted()){if(satisfierObj.hasClass("pe-o2-popup-label")&&!satisfierObj.siblings().prop("checked")){satisfierObj.siblings().prop("checked",true);
}if(!deptCheckBoxObj.prop("disabled")&&deptCheckBoxObj.prop("checked")){component.addDepartmentalFavorite(relationId);
}if(!component.getRemoveTaskGranted()){deptCheckBoxObj.attr("disabled",true);
}}}}}};
PatientEducationO2Component.prototype.updateFavoriteStatus=function(instId){var component=this;
var componentContent=$(component.getSectionContentNode());
var compId=component.getComponentId();
var departmentCheckbox=$("#pe-o2-dept-"+compId);
var personalCheckbox=$("#pe-o2-personal-"+compId);
var instDetails=componentContent.find("[data-attr='"+instId+"']");
var folderName=(this.m_currentFolder!==undefined&&this.m_currentFolder!=="")?this.m_currentFolder.replace(/\s/gi,"_"):"";
var instObj=$("#"+folderName+instId+compId);
if(!componentContent.find(".pe-o2-seg-tabs").hasClass("active")){instObj=$("#"+instId+compId);
}if(!departmentCheckbox.prop("checked")&&!personalCheckbox.prop("checked")){instObj.removeClass("active");
if(instDetails){instDetails.each(function(){$(this).removeClass("active");
});
}}if((departmentCheckbox.prop("checked")||personalCheckbox.prop("checked"))&&!instObj.hasClass("active")){instObj.addClass("active");
if(instDetails){instDetails.each(function(){$(this).addClass("active");
});
}}};
PatientEducationO2Component.prototype.removePersonalFavorite=function(instructionId){var component=this;
var criterion=this.getCriterion();
var scriptRequest=new ScriptRequest();
var rtmsTimer=new RTMSTimer("ENG:MPG.PATIENTEDUCATION.O2 -  Remove from Personal Favorites");
scriptRequest.setProgramName("MP_ADD_PAT_EDU_FAVORITES");
scriptRequest.setParameterArray(["^MINE^",criterion.provider_id+".0",component.getDomainCd()+".0",instructionId+".0",1,"0.0","0.0"]);
scriptRequest.setResponseHandler(function(scriptReply){if(rtmsTimer){rtmsTimer.stop();
}if(scriptReply.getStatus()==="S"){component.updateFavoriteStatus(instructionId);
component.updateFavoritesList();
}});
rtmsTimer.start();
scriptRequest.performRequest();
};
PatientEducationO2Component.prototype.addPersonalFavorite=function(instructionId){var component=this;
var criterion=this.getCriterion();
var scriptRequest=new ScriptRequest();
var rtmsTimer=new RTMSTimer("ENG:MPG.PATIENTEDUCATION.O2 - Add to Personal Favorites");
scriptRequest.setProgramName("MP_ADD_PAT_EDU_FAVORITES");
scriptRequest.setParameterArray(["^MINE^",criterion.provider_id+".0",component.getDomainCd()+".0",instructionId+".0",0,"0.0","0.0"]);
scriptRequest.setResponseHandler(function(scriptReply){if(rtmsTimer){rtmsTimer.stop();
}if(scriptReply.getStatus()==="S"){component.updateFavoriteStatus(instructionId);
component.updateFavoritesList();
}});
rtmsTimer.start();
scriptRequest.performRequest();
};
PatientEducationO2Component.prototype.removeDepartmentalFavorite=function(instructionId){var component=this;
var scriptRequest=new ScriptRequest();
var rtmsTimer=new RTMSTimer("ENG:MPG.PATIENTEDUCATION.O2 - Remove Departmental Favorites");
scriptRequest.setProgramName("MP_ADD_PAT_EDU_FAVORITES");
scriptRequest.setParameterArray(["^MINE^","0.0",component.getDomainCd()+".0",instructionId+".0",1,component.getTrackingGroupCd()+".0","0.0"]);
scriptRequest.setResponseHandler(function(scriptReply){if(rtmsTimer){rtmsTimer.stop();
}if(scriptReply.getStatus()==="S"){component.updateFavoriteStatus(instructionId);
component.updateFavoritesList();
}});
rtmsTimer.start();
scriptRequest.performRequest();
};
PatientEducationO2Component.prototype.addDepartmentalFavorite=function(instructionId){var component=this;
var scriptRequest=new ScriptRequest();
var rtmsTimer=new RTMSTimer("ENG:MPG.PATIENTEDUCATION.O2 - Add to Departmental Favorites");
scriptRequest.setProgramName("MP_ADD_PAT_EDU_FAVORITES");
scriptRequest.setParameterArray(["^MINE^","0.0",component.getDomainCd()+".0",instructionId+".0",0,component.getTrackingGroupCd()+".0","0.0"]);
scriptRequest.setResponseHandler(function(scriptReply){if(rtmsTimer){rtmsTimer.stop();
}if(scriptReply.getStatus()==="S"){component.updateFavoriteStatus(instructionId);
component.updateFavoritesList();
}});
rtmsTimer.start();
scriptRequest.performRequest();
};
PatientEducationO2Component.prototype.attachListeners=function(){var compID=this.getComponentId();
var component=MP_Util.GetCompObjById(compID);
var criterion=component.getCriterion();
var self=this;
var componentContent=$(this.getSectionContentNode());
var autoSuggCtrlId=$("#pe-o2searchInst"+compID);
var clearSearchTxtId=$("#pe-o2-clear-text"+compID);
var plusIcon=$("#pe-o2-add-inst-icon"+compID);
var suggSegmentCntrl=$("#segmentCntrlSugg"+compID);
var instContent=$("#pe-o2-res-content"+compID);
var medsContent=$("#pe-o2-meds-leaflet-data-container"+compID);
clearTimeout(component.getTimerId());
var timerId=setTimeout(function(){suggSegmentCntrl.trigger("click");
},500);
component.setTimerId(timerId);
instContent.height("85px");
medsContent.height("85px");
autoSuggCtrlId.attr("placeholder",i18n.discernabu.patienteducation_o2.SEARCH_ALL_EDUCATION);
plusIcon.on("click",function(){autoSuggCtrlId.focus();
});
componentContent.off("click",".pe-o2-remove");
componentContent.on("click",".pe-o2-remove",function(){var clickedEle=this;
var instructionID=$(clickedEle).closest("dl").attr("id");
var addedInstructionObj=$("#pe-o2-added-inst"+compID);
var addedInstScrollObj=$("#pe-o2-res-content"+compID);
var personId=criterion.person_id;
var encntrId=criterion.encntr_id;
var scriptRequest=new ScriptRequest();
var cclParam=[];
cclParam.push("^MINE^",personId+".0",encntrId+".0",0,instructionID+".0","0.0",0,"^^","0.0","0.0","^^",1);
scriptRequest.setParameterArray(cclParam);
scriptRequest.setProgramName("MP_ADD_UPD_PAT_EDU");
scriptRequest.setAsyncIndicator(true);
scriptRequest.setResponseHandler(function(scriptReply){if(scriptReply.getStatus()==="S"){$(clickedEle).closest("dl").remove();
var instructionsCnt=addedInstScrollObj.children("dl").length;
if(instructionsCnt<=0){addedInstructionObj.html(component.noAddedInstructionHtml());
component.setResultCount(instructionsCnt);
component.updateSatisfierRequirementIndicator();
}}else{MP_Util.LogScriptCallInfo(null,this,"master-component.js","Failed to remove selected instruction.");
}});
scriptRequest.performRequest();
});
componentContent.off("click",".pe-o2-seg-tabs");
componentContent.on("click",".pe-o2-seg-tabs",function(){var clickEleObj=$(this);
var i18nPatEdu=i18n.discernabu.patienteducation_o2;
autoSuggCtrlId.val("");
clearSearchTxtId.hide();
if(clickEleObj.hasClass("active")){clickEleObj.removeClass("active");
var suggInstructionObj=$("#pe-o2-sugg-inst"+compID);
suggInstructionObj.html(component.noSearchResultsHtml(i18nPatEdu.NO_EDUCATION_TO_DISPLAY));
return false;
}var contentWrapperObj=componentContent.find(".pe-o2-content-wrapper");
var searchbarObj=componentContent.find(".pe-o2-search-bar");
var toggleObj=componentContent.find(".pe-o2-toggle");
if(toggleObj.hasClass("pe-o2-expand")){contentWrapperObj.slideDown(200);
searchbarObj.css("border-bottom","1px solid #D3D4D5");
toggleObj.removeClass("pe-o2-expand").addClass("pe-o2-collapse");
clearSearchTxtId.show();
instContent.height("85px");
medsContent.height("85px");
}clickEleObj.siblings(".active").removeClass("active");
clickEleObj.addClass("active");
var segControl=clickEleObj.attr("data-attr");
if(segControl==="suggestions"){component.getSuggestedInstructions();
}setTimeout(function(){switch(segControl){case"suggestions":component.displaySuggestedInstructions();
break;
case"custom":component.displayCustomInstructions();
break;
case"favorites":component.displayFavoriteInstructions();
break;
default:break;
}if(typeof(componentContent.find(".pe-o2-folder-name")[0])!=="undefined"){componentContent.find(".pe-o2-folder-name")[0].click();
}},400);
});
$("#pe-o2-lang-combobox-"+compID).off().change(function(){self.setLanguageId($(this).val());
var segControl="";
if(componentContent.find(".pe-o2-seg-tabs").hasClass("active")){segControl=componentContent.find(".pe-o2-seg-tabs").filter(".active").attr("data-attr");
}else{var searchVal=autoSuggCtrlId.val();
if(searchVal!==""&&searchVal!==i18n.discernabu.patienteducation_o2.SEARCH_ALL_EDUCATION){self.getSearchResultsForAllTab(searchVal);
}}if(segControl==="suggestions"){component.getSuggestedInstructions();
}if(segControl!==""){setTimeout(function(){switch(segControl){case"suggestions":component.displaySuggestedInstructions();
break;
case"custom":component.displayCustomInstructions();
break;
case"favorites":component.displayFavoriteInstructions();
break;
default:break;
}component.m_currInstArray=[];
component.m_pagerInstance=null;
component.pageIndex=0;
component.m_currentPage=0;
var currentFolder=component.m_currentFolder;
if(componentContent.find(".pe-o2-folder-name").filter('[data-attr*="'+currentFolder+'"]').length!==0){componentContent.find(".pe-o2-folder-name").filter('[data-attr~="'+currentFolder+'"]').click();
}else{if(typeof(componentContent.find(".pe-o2-folder-name")[0])!=="undefined"){componentContent.find(".pe-o2-folder-name")[0].click();
}}},400);
}});
autoSuggCtrlId.off();
autoSuggCtrlId.on("keypress",function(){var contentWrapperObj=componentContent.find(".pe-o2-content-wrapper");
var searchbarObj=componentContent.find(".pe-o2-search-bar");
var toggleObj=componentContent.find(".pe-o2-toggle");
if(toggleObj.hasClass("pe-o2-expand")){contentWrapperObj.slideDown(200);
searchbarObj.css("border-bottom","1px solid #D3D4D5");
toggleObj.removeClass("pe-o2-expand").addClass("pe-o2-collapse");
}if(componentContent.find(".pe-o2-seg-tabs").hasClass("active")){componentContent.find(".pe-o2-seg-tabs").removeClass("active");
}clearSearchTxtId.show();
});
clearSearchTxtId.on("click",function(){clearSearchTxtId.hide();
autoSuggCtrlId.val("");
suggSegmentCntrl.trigger("click");
});
componentContent.off("click",".pe-o2-folder-name");
componentContent.on("click",".pe-o2-folder-name",function(){var clickEleObj=$(this);
var contentWrapperObj=componentContent.find(".pe-o2-items-cont-wrapper");
var itemsObj=componentContent.find(".pe-o2-items-cont");
if(!clickEleObj.hasClass("pe-o2-active")){var currentFolder=clickEleObj.attr("data-attr");
clickEleObj.siblings(".pe-o2-active").removeClass("pe-o2-active").addClass("pe-o2-white-hover");
clickEleObj.addClass("pe-o2-active").removeClass("pe-o2-white-hover");
component.m_currInstArray=[];
component.m_pagerInstance=null;
component.pageIndex=0;
component.m_currentPage=0;
component.m_currentFolder=currentFolder;
var activeSeg=componentContent.find(".pe-o2-segment-tab").find(".active").attr("data-attr");
switch(activeSeg){case"suggestions":component.getSuggInstArrayList(currentFolder);
break;
case"favorites":component.getFavoriteInstructions(currentFolder);
break;
case"custom":component.getCustomInstructions(currentFolder);
break;
}contentWrapperObj.fadeTo(200,0.25,function(){setTimeout(function(){itemsObj.siblings(".pe-o2-items-cont").hide();
$("[id='"+currentFolder+"']").show();
contentWrapperObj.fadeTo(200,1);
},400);
});
}});
componentContent.off("click","span.pe-o2-print");
componentContent.on("click","span.pe-o2-print",function(){var instructionID=$(this).closest("dl").attr("id");
component.printPatEduSingleInstruction(instructionID);
});
componentContent.off("click","#patEduAck"+compID);
componentContent.on("click","#patEduAck"+compID,function(){try{component.launchChartSelection();
}catch(err){logger.logJSError(err,this,"patienteducation-o2.js","EducationAssessmentClick");
}});
componentContent.off("click",".pe-o2-tab");
componentContent.on("click",".pe-o2-tab",function(){var clickEleObj=$(this);
var contentWrapperObj=componentContent.find(".pe-o2-content-wrapper");
var searchbarObj=componentContent.find(".pe-o2-search-bar");
var toggleObj=componentContent.find(".pe-o2-toggle");
if(!clickEleObj.hasClass("active")){clickEleObj.siblings(".active").removeClass("active");
clickEleObj.addClass("active");
componentContent.find(".pe-o2-tab-wrapper").hide();
var tabId=clickEleObj.attr("data-attr");
$("#"+tabId).show();
}if(toggleObj.hasClass("pe-o2-expand")){contentWrapperObj.slideDown(200);
searchbarObj.css("border-bottom","1px solid #D3D4D5");
toggleObj.removeClass("pe-o2-expand").addClass("pe-o2-collapse");
suggSegmentCntrl.trigger("click");
instContent.height("85px");
medsContent.height("85px");
}});
componentContent.off("click",".pe-o2-name");
componentContent.on("click",".pe-o2-name",function(){var currentObj=$(this);
var instructionId=currentObj.closest("dl").attr("id");
var instDetails=self.getValueFromArray(instructionId,self.getInstructionArray()).value;
var scriptRequest=new ScriptRequest();
var cclParam=[];
cclParam.push("^MINE^",criterion.person_id+".0",criterion.encntr_id+".0",1,instructionId+".0",0+".0",0,"~"+instDetails.name+"~",component.getDomainCd()+".0",instDetails.langId+".0","^"+instDetails.keyDocId+"^",0);
scriptRequest.setParameterArray(cclParam);
scriptRequest.setProgramName("MP_ADD_UPD_PAT_EDU");
scriptRequest.setAsyncIndicator(true);
scriptRequest.setResponseHandler(function(scriptReply){if(scriptReply.getStatus()==="S"){component.getAddedInstructions();
}else{MP_Util.LogScriptCallInfo(null,this,"patienteducation-o2.js","Failed to add the instruction.");
}});
scriptRequest.performRequest();
});
componentContent.off("click",".pe-o2-favorite");
componentContent.on("click",".pe-o2-favorite",function(){var clickEleObj=$(this);
var instructionID=clickEleObj.closest("dl").attr("id");
component.attachPopupToFavoritesButton(instructionID);
});
componentContent.off("click",".pe-o2-inst-favorite");
componentContent.on("click",".pe-o2-inst-favorite",function(){var selfObj=$(this);
var instructionId=selfObj.closest("dl").attr("id");
component.attachPopupToFavoritesButton(instructionId);
});
componentContent.off("click",".pe-o2-inst-data");
componentContent.on("click",".pe-o2-inst-data",function(){var elemObj=this;
var instructionID=$(elemObj).closest("dl").attr("id");
component.openTab(instructionID);
});
componentContent.off("click",".pe-o2-toggle");
componentContent.on("click",".pe-o2-toggle",function(){var currentElemObj=$(this);
var contentWrapperObj=componentContent.find(".pe-o2-content-wrapper");
var searchbarObj=componentContent.find(".pe-o2-search-bar");
if(currentElemObj.hasClass("pe-o2-collapse")){contentWrapperObj.slideUp(200);
searchbarObj.css("border","none");
currentElemObj.removeClass("pe-o2-collapse").addClass("pe-o2-expand");
if(componentContent.find(".pe-o2-seg-tabs").hasClass("active")){componentContent.find(".pe-o2-seg-tabs").removeClass("active");
}$("#pe-o2-res-content"+compID).height("300px");
medsContent.height("300px");
}else{contentWrapperObj.slideDown(200);
searchbarObj.css("border-bottom","1px solid #D3D4D5");
currentElemObj.removeClass("pe-o2-expand").addClass("pe-o2-collapse");
suggSegmentCntrl.trigger("click");
$("#pe-o2-res-content"+compID).height("85px");
medsContent.height("85px");
}});
};
MP_Util.setObjectDefinitionMapping("WF_PTED",PatientEducationO2Component);
