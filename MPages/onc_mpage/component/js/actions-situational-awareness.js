function ActionsSitAwarenessComponentStyle(){this.initByNamespace("asa");
this.m_xEncInd=0;
}ActionsSitAwarenessComponentStyle.inherits(ComponentStyle);
function ActionsSitAwarenessComponent(criterion){this.setCriterion(criterion);
this.setStyles(new ActionsSitAwarenessComponentStyle());
this.m_renderTimer=null;
this.setComponentLoadTimerName("USR:MPG.ACTIONS_SIT_AWARENESS.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.ACTIONS_SIT_AWARENESS.O1 - render component");
this.setPregnancyLookbackInd(true);
}ActionsSitAwarenessComponent.prototype=new MPageComponent();
ActionsSitAwarenessComponent.prototype.constructor=MPageComponent;
ActionsSitAwarenessComponent.prototype.getSelectedCareTeamXEncInd=function(){return this.m_xEncInd;
};
ActionsSitAwarenessComponent.prototype.setSelectedCareTeamXEncInd=function(xEncInd){this.m_xEncInd=xEncInd;
};
ActionsSitAwarenessComponent.prototype.retrieveComponentData=function(){var errMsg=[];
try{this.initCareTeamSelector();
}catch(err){errMsg.push(err.message);
logger.logJSError(err,this,"actions-and-situational-awareness.js","retrieveComponentData");
this.finalizeComponent(MP_Util.HandleErrorResponse(this.getStyles().getNameSpace(),errMsg.join("<br />")),"");
}};
ActionsSitAwarenessComponent.prototype.initCareTeamSelector=function(){var compID=this.getComponentId();
var careTeamCount=0;
var selectedCareTeamId=0;
var self=this;
var errMsg=[];
try{this.componentContainer=$("<div id='actionsSitAware"+compID+"mainContainer' class='asa-main-container'></div>");
var careTeamSelectorContainer=$("<div id='actionsSitAware"+compID+"careTeamContainer' class='asa-selector'></div>");
this.componentContainer.append(careTeamSelectorContainer);
this.finalizeComponent(this.componentContainer);
this.careTeamSelectorObj=new CareTeamSelector();
this.careTeamSelectorObj.setUniqueId(compID);
this.careTeamSelectorObj.setCriterion(this.criterion);
this.careTeamSelectorObj.setOnCareteamLoadFunc(function(){var careTeamCount=self.careTeamSelectorObj.getCareteamCount();
var selectedCareTeamId=self.careTeamSelectorObj.getSelectedCareTeamId();
if(careTeamCount&&selectedCareTeamId==0){return;
}self.setSelectedCareTeamXEncInd(self.careTeamSelectorObj.getSelectedCareTeamXEncInd());
self.retrieveActionsComments(selectedCareTeamId,true);
});
this.careTeamSelectorObj.renderCareTeamSelector(careTeamSelectorContainer);
this.careTeamSelectorObj.setOnSelectorChangeFunc(function(){var mainContainerID="asaContent"+compID;
var careTeamId=self.careTeamSelectorObj.getSelectedCareTeamId();
var actionsCommentsWrapper=$("#actionsSitAware"+compID+"Wrapper");
if(actionsCommentsWrapper.length){actionsCommentsWrapper.remove();
}if(careTeamId==0){return;
}else{MP_Util.LoadSpinner(mainContainerID);
}self.setSelectedCareTeamXEncInd(self.careTeamSelectorObj.getSelectedCareTeamXEncInd());
self.retrieveActionsComments(careTeamId,false);
});
}catch(err){errMsg.push(err.message);
logger.logJSError(err,this,"actions-and-situational-awareness.js","initCareTeamSelector");
this.finalizeComponent(MP_Util.HandleErrorResponse(this.getStyles().getNameSpace(),errMsg.join("<br />")),"");
}};
ActionsSitAwarenessComponent.prototype.retrieveActionsComments=function(selectedCareTeamId,initialLoad){var patientID=this.criterion.person_id;
var encounterID=this.criterion.encntr_id;
var logicaldomainID=this.criterion.logical_domain_id;
var self=this;
var cclParam=[];
var errMsg=[];
this.selectedCareTeamId=selectedCareTeamId;
try{if(!patientID){throw new Error("Invalid patient ID. Patient ID must be greater than 0.");
}if(!encounterID){throw new Error("Invalid encounter ID. Encounter ID must be greater than 0.");
}var scriptRequest=new MP_Core.ScriptRequest(this,this.getComponentLoadTimerName());
cclParam.push("^MINE^",patientID+".0",encounterID+".0","0.0",MP_Util.CreateParamArray(['"ACTION"','"COMMENT"']),1,"0.0",selectedCareTeamId+".0",logicaldomainID+".0",this.getLookbackUnits(),this.getLookbackUnitTypeFlag());
scriptRequest.setParameters(cclParam);
scriptRequest.setProgramName("MP_RETRIEVE_IPASS_PERSON");
scriptRequest.setAsync(true);
MP_Core.XMLCCLRequestCallBack(this,scriptRequest,function(reply){if(!initialLoad){var compID=self.getComponentId();
var mainContainerID="asaContent"+compID;
$("#"+mainContainerID).find(".loading-screen").remove();
}if(reply.getStatus()==="S"||reply.getStatus()==="Z"){self.renderComponent(reply);
}if(reply.getStatus()==="F"){errMsg.push(reply.getError());
self.finalizeComponent(MP_Util.HandleErrorResponse(self.getStyles().getNameSpace(),errMsg.join("<br />")),"");
return;
}});
}catch(err){errMsg.push(err.message);
logger.logJSError(err,this,"actions-and-situational-awareness.js","retrieveActionsComments");
this.finalizeComponent(MP_Util.HandleErrorResponse(this.getStyles().getNameSpace(),errMsg.join("<br />")),"");
}};
ActionsSitAwarenessComponent.prototype.renderComponent=function(reply){var recordData=reply.getResponse();
try{this.m_renderTimer=MP_Util.CreateTimer(this.getComponentRenderTimerName(),this.criterion.category_mean);
var compID=this.getComponentId();
var iPassWrapper=$("<div id='actionsSitAware"+compID+"Wrapper' class='asa-wrapper'></div>");
this.componentContainer.append(iPassWrapper);
var actionsContainer=$("<div id='actionsSitAware"+compID+"actionsContainer' class='asa-actions'></div>");
iPassWrapper.append(actionsContainer);
var commentsContainer=$("<div id='actionsSitAware"+compID+"CommentsContainer' class='asa-comments'></div>");
iPassWrapper.append(commentsContainer);
var actionsObj=new IPASSActions();
actionsObj.setUniqueId(compID);
actionsObj.setCriterion(this.criterion);
actionsObj.setSelectedCareTeamId(this.selectedCareTeamId);
actionsObj.setLookbackVal(this.getLookbackUnits());
actionsObj.setCrossEncIndicatorVal(this.getSelectedCareTeamXEncInd());
actionsObj.renderActions(recordData,actionsContainer);
actionsObj.finalizeActions(actionsContainer);
var commentsObj=new IPASSComments();
commentsObj.setUniqueId(compID);
commentsObj.setCriterion(this.criterion);
commentsObj.setSelectedCareTeamId(this.selectedCareTeamId);
commentsObj.setLookbackVal(this.getLookbackUnits());
commentsObj.setCrossEncIndicatorVal(this.getSelectedCareTeamXEncInd());
commentsObj.renderComments(recordData,commentsContainer);
this.resizeComponent();
}catch(err){if(this.m_renderTimer){this.m_renderTimer.Abort();
this.m_renderTimer=null;
}logger.logJSError(err,this,"actions-and-situational-awareness.js","renderComponent");
throw (err);
}finally{if(this.m_renderTimer){this.m_renderTimer.Stop();
}}};
ActionsSitAwarenessComponent.prototype.resizeComponent=function(){var compID=this.getComponentId();
var iPassWrapperElement=$("#actionsSitAware"+compID+"Wrapper");
MPageComponent.prototype.resizeComponent.call(this,null);
var windowPadding=100;
var maxViewHeight=$("#vwpBody").height()-windowPadding;
iPassWrapperElement.css("max-height",maxViewHeight+"px");
};
MP_Util.setObjectDefinitionMapping("WF_ACTIONS_SIT_AWARENESS",ActionsSitAwarenessComponent);
