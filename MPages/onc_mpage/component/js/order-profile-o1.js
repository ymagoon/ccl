function OrderProfileComponentStyle(){this.initByNamespace("op");
}OrderProfileComponentStyle.prototype=new ComponentStyle();
OrderProfileComponentStyle.prototype.constructor=ComponentStyle;
function OrderProfileComponent(criterion){this.setCriterion(criterion);
this.setLookBackDropDown(true);
this.setScrollingEnabled(false);
this.setAlwaysExpanded(true);
this.setScope(2);
this.setStyles(new OrderProfileComponentStyle());
this.setComponentLoadTimerName("USR:MPG.ORDERPROFILE.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.ORDERPROFILE.O1 - render component");
this.setIncludeLineNumber(true);
this.markedOrders=[];
this.opOrdersArray=[];
this.opPendingOrders=[];
this.opCatArray=[];
this.opVenueArray=[];
this.opPendingCatArray=[];
this.opPendingStatuses=[];
this.opFiltersArray=[];
this.opOrderGrouping=1;
this.opSortField=4;
this.opSortDirection=0;
this.opFilterSets=null;
this.hasPriv=false;
this.hasException=false;
this.compTableArray=new Array(6);
this.compTableContainer=null;
this.sidePanel=null;
this.sidePanelObj=null;
this.showPanel=false;
this.currentFilter=null;
this.opPendingOrdObj=null;
this.opPrefObj={catSubSecs:{},venueSubSecs:{},groupByPref:0};
this.m_wasListenerAdded=false;
this.opAllowDailyReview=false;
this.opDailyReviewObj=null;
this.opReqOrdGrpArr=[];
this.m_opData=null;
}OrderProfileComponent.prototype=new MPageComponent();
OrderProfileComponent.prototype.constructor=MPageComponent;
OrderProfileComponent.prototype.setWasListenerAdded=function(value){this.m_wasListenerAdded=value;
};
OrderProfileComponent.prototype.getWasListenerAdded=function(){return this.m_wasListenerAdded;
};
OrderProfileComponent.prototype.setOPOrderGrouping=function(value){this.opOrderGrouping=value;
};
OrderProfileComponent.prototype.getOPOrderGrouping=function(){return this.opOrderGrouping;
};
OrderProfileComponent.prototype.setOPPendingOrderStatuses=function(value){this.opPendingStatuses=value;
};
OrderProfileComponent.prototype.getOPPendingOrderStatuses=function(){return this.opPendingStatuses;
};
OrderProfileComponent.prototype.setCurrentFilter=function(value){this.currentFilter=value;
};
OrderProfileComponent.prototype.getCurrentFilter=function(){return this.currentFilter;
};
OrderProfileComponent.prototype.setPendingOrderObj=function(value){this.opPendingOrdObj=value;
};
OrderProfileComponent.prototype.getPendingOrderObj=function(){return this.opPendingOrdObj;
};
OrderProfileComponent.prototype.getOPData=function(){return this.m_opData;
};
OrderProfileComponent.prototype.setOPData=function(value){this.m_opData=value;
};
OrderProfileComponent.prototype.setRequiredOrdGrpArr=function(value){this.opReqOrdGrpArr.push(value);
if(!this.getGapCheckRequiredInd()){this.setGapCheckRequiredInd(true);
}};
OrderProfileComponent.prototype.getRequiredOrdGrpArr=function(){return this.opReqOrdGrpArr;
};
OrderProfileComponent.prototype.setLocalPrefs=function(value){this.opPrefObj.catSubSecs=value.catSubSecs;
this.opPrefObj.venueSubSecs=value.venueSubSecs;
if(value.groupByPref){this.opPrefObj.groupByPref=value.groupByPref;
}else{this.opPrefObj.groupByPref=this.getOPOrderGrouping();
}};
OrderProfileComponent.prototype.setExpandCollapseStates=function(compTable,groupExpandStates){var groupIds=compTable.getGroupSequence();
var xl=groupIds.length;
for(var x=0;
x<xl;
x++){var thisGroup=compTable.getGroupById(groupIds[x]);
groupExpandStates[thisGroup.getGroupId()]=thisGroup.isExpanded();
}};
OrderProfileComponent.prototype.getGroupByPrefs=function(){var compId=this.getComponentId();
var groupByObj=$("#opGroupBy"+compId);
var choice=groupByObj.length>0?parseInt(groupByObj.val(),10):null;
if(!this.opPrefObj.groupByPref&&!choice){this.opPrefObj.groupByPref=this.getOPOrderGrouping();
}else{if(choice){this.opPrefObj.groupByPref=choice;
}}return this.opPrefObj;
};
OrderProfileComponent.prototype.getExpandCollapsePreferences=function(compTable){this.getGroupByPrefs();
if(this.opPrefObj.groupByPref===1){this.setExpandCollapseStates(compTable,this.opPrefObj.catSubSecs);
}else{if(this.opPrefObj.groupByPref===2){this.setExpandCollapseStates(compTable,this.opPrefObj.venueSubSecs);
}}return this.opPrefObj;
};
OrderProfileComponent.prototype.setDailyReviewObj=function(dailyReviewObj){this.opDailyReviewObj=dailyReviewObj;
};
OrderProfileComponent.prototype.getDailyReviewObj=function(){return(this.opDailyReviewObj);
};
OrderProfileComponent.prototype.setAllowDailyReview=function(dailyReviewFlag){this.opAllowDailyReview=dailyReviewFlag;
};
OrderProfileComponent.prototype.getAllowDailyReview=function(){return(this.opAllowDailyReview);
};
OrderProfileComponent.prototype.loadFilterMappings=function(){this.addFilterMappingObject("WF_ORDER_PROFILE_DLY_REV",{setFunction:this.setAllowDailyReview,type:"BOOLEAN",field:"FREETEXT_DESC"});
this.addFilterMappingObject("WF_ORDER_PROFILE_HELP_TXT",{setFunction:this.setRequiredCompDisclaimerText,type:"STRING",field:"FREETEXT_DESC"});
this.addFilterMappingObject("WF_ORDER_PROFILE_REQ_OVR",{setFunction:this.setOverrideInd,type:"Boolean",field:"FREETEXT_DESC"});
this.addFilterMappingObject("WF_ORDER_PROFILE_REQD_GRP1",{setFunction:this.setRequiredOrdGrpArr,type:"Array",field:"PARENT_ENTITY_ID"});
this.addFilterMappingObject("WF_ORDER_PROFILE_REQD_GRP2",{setFunction:this.setRequiredOrdGrpArr,type:"Array",field:"PARENT_ENTITY_ID"});
this.addFilterMappingObject("WF_ORDER_PROFILE_REQD_GRP3",{setFunction:this.setRequiredOrdGrpArr,type:"Array",field:"PARENT_ENTITY_ID"});
this.addFilterMappingObject("WF_ORDER_PROFILE_REQD_GRP4",{setFunction:this.setRequiredOrdGrpArr,type:"Array",field:"PARENT_ENTITY_ID"});
this.addFilterMappingObject("WF_ORDER_PROFILE_REQD_GRP5",{setFunction:this.setRequiredOrdGrpArr,type:"Array",field:"PARENT_ENTITY_ID"});
};
OrderProfileComponent.prototype.isSidePanelDisplayed=function(){return this.showPanel;
};
OrderProfileComponent.prototype.applyExpandCollapsePreferences=function(compTable){var userPrefs=this.getGroupByPrefs();
var groupIds=compTable.getGroupSequence();
var idLen=groupIds.length;
var subSecs=null;
switch(userPrefs.groupByPref){case 1:subSecs=this.opPrefObj.catSubSecs;
break;
case 2:subSecs=this.opPrefObj.venueSubSecs;
}for(var x=0;
x<idLen;
x++){var thisGroup=compTable.getGroupById(groupIds[x]);
var thisGroupVal=subSecs.hasOwnProperty(thisGroup.getGroupId())?subSecs[thisGroup.getGroupId()]:true;
thisGroup.setIsExpanded(thisGroupVal);
}};
OrderProfileComponent.prototype.compTableOverrides=function(compTable){var comp=this;
var textArray=["STATUS","STATUS_DT","ORDER","START_DT","PROVIDER","CATEGORY"];
compTable.toggleGroup=function(groupId){var group=this.getGroupById(groupId);
if(group.isExpanded()){this.collapseGroup(groupId);
}else{this.openGroup(groupId);
}var userPrefs=comp.getExpandCollapsePreferences(compTable);
comp.setPreferencesObj(userPrefs);
comp.savePreferences(true);
};
compTable.renderRows=function(rows,groupId){var rowsHtml="";
var browserClass=((navigator.msMaxTouchPoints>0)||(navigator.maxTouchPoints>0)||CERN_Platform.isTouchModeEnabled())?"browser-view ":"";
var columnSequence=this.getColumnSequence();
var numberColumns=columnSequence.length;
groupId=groupId?(":"+groupId):"";
var cellId="";
var srObj=comp.getScratchpadSharedResourceObject();
for(var i=0;
i<rows.length;
i++){var row=rows[i];
var selectedClass=row.resultData.SELECTED?"op-row-selected ":"";
var rowClass="result-info "+browserClass+selectedClass+this.getStripeClass(i);
var rowId=this.namespace+groupId+":"+row.getId();
var actionFound=false;
rowsHtml+="<"+this.getRowTag()+" id='"+rowId+"' class='"+rowClass+"'>";
if(srObj){var dataObj=srObj.getResourceData();
if(dataObj){var scratchpadArr=dataObj.scratchpadObjArr;
if(scratchpadArr){var arrLen=scratchpadArr.length;
for(var x=0;
x<arrLen;
x++){if(scratchpadArr[x].ordId==row.resultData.ORDER_ID){actionFound=true;
break;
}}}}}for(var j=0;
j<numberColumns;
j++){var column=this.getColumnMap()[columnSequence[j]];
var canceledClass="";
var style="style='{0}{1}'";
if(textArray.indexOf(column.columnId)!==-1){canceledClass=(row.resultData.CANCELED||actionFound)?"op-cancelled ":"";
}var tableCellClass="table-cell "+canceledClass+column.getCustomClass();
var columnID=column.getColumnId();
if(column.getWidth()){style=style.replace("{0}","width:"+column.getWidth()+"px;");
}if(comp.showPanel){switch(columnID){case"STATUS":case"STATUS_DT":case"PROVIDER":case"CATEGORY":style=style.replace("{1}","display:none;");
break;
}}style=style.replace("{0}","").replace("{1}","");
cellId=this.namespace+groupId+":"+row.getId()+":"+columnID;
rowsHtml+="<"+this.getColumnTag()+" id='"+cellId+"' class='"+tableCellClass+"'"+style+">";
rowsHtml+=column.getRenderTemplate().render(row.getResultData())||"<span>&nbsp;</span>";
rowsHtml+="</"+this.getColumnTag()+">";
}rowsHtml+="</"+this.getRowTag()+">";
}return rowsHtml;
};
};
OrderProfileComponent.prototype.resizeComponent=function(){MPageComponent.prototype.resizeComponent.call(this,null);
var compTableHeight=this.compTableContainer.css("height");
if(compTableHeight&&this.showPanel){var compId="#op"+this.getComponentId();
var columnMap=this.m_componentTable.getColumnMap();
var compTableBody=$(compId+"tableBody");
var venueClassCols=compTableBody.find(".op-venue");
var notificationsCol=compTableBody.find(".op-notifications");
var orderCol=compTableBody.find(".op-name");
var startCol=compTableBody.find(".op-orderdt");
this.sidePanel.setHeight(compTableHeight);
this.sidePanel.resizePanel();
venueClassCols.width($(compId+"columnHeaderMULTI_SELECT").width());
notificationsCol.width($(compId+"columnHeaderNOTIFICATIONS").width());
orderCol.width($(compId+"columnHeaderORDER").width());
startCol.width($(compId+"columnHeaderSTART_DT").width());
columnMap.MULTI_SELECT.setWidth(venueClassCols.outerWidth());
columnMap.NOTIFICATIONS.setWidth(notificationsCol.outerWidth());
columnMap.ORDER.setWidth(orderCol.outerWidth());
columnMap.START_DT.setWidth(startCol.outerWidth());
if(columnMap.VENUE){columnMap.VENUE.setWidth(venueClassCols.outerWidth());
}}};
OrderProfileComponent.prototype.retrieveComponentData=function(){var criterion=null;
var request=null;
var sendAr=null;
var statusBitMask=0;
var medCriteria=0;
var nonMedCriteria=0;
this.compTableArray=new Array(6);
if(this.getCurrentFilter()){(this.currentFilter).val("1");
}if(this.getPendingOrderObj()){(this.opPendingOrdObj).attr("checked",false);
}if(!statusBitMask){statusBitMask=63;
}if(!medCriteria){medCriteria=35;
}if(!nonMedCriteria){nonMedCriteria=2;
}criterion=this.getCriterion();
sendAr=["^MINE^",criterion.person_id+".0",criterion.encntr_id+".0",criterion.provider_id+".0",statusBitMask,medCriteria,nonMedCriteria,criterion.ppr_cd+".0"];
request=new MP_Core.ScriptRequest(this,this.getComponentLoadTimerName());
request.setProgramName("MP_GET_ORDER_PROFILE");
request.setParameters(sendAr);
request.setAsync(true);
MP_Core.XMLCCLRequestCallBack(this,request,this.handleFilteredResults);
};
OrderProfileComponent.prototype.postProcessing=function(){MPageComponent.prototype.postProcessing.call(this);
if(!this.getWasListenerAdded()){CERN_EventListener.addListener(this,EventListener.EVENT_ORDER_ACTION,this.getFilteredData,this);
CERN_EventListener.addListener(this,EventListener.EVENT_SCRATCHPAD_REMOVED_ORDER_ACTION,this.undoOrderAction,this);
CERN_EventListener.addListener(this,EventListener.EVENT_SCRATCHPAD_RECIEVED_ORDER_ACTION,this.updateComponentOrders,this);
this.setWasListenerAdded(true);
}};
OrderProfileComponent.prototype.renderSplitButton=function(){var component=this;
var opDORObject=component.getDailyReviewObj();
var compId=component.getComponentId();
var reviewButtonHTML=[];
var dailyReviewArray=opDORObject.getReviewOrders();
var totalPendingOrders=dailyReviewArray.length;
var reviewButtonClass="review-split-btn_"+compId;
var opi18n=i18n.discernabu.order_profile_o1;
var callbackLaunchOrderReview=function(){var filterSelection=$("#opAdvFilters"+compId).children("option:selected").text();
opDORObject.setSelectedFilter(filterSelection);
opDORObject.launchOrderReviewModal();
};
var ordersCountText=(totalPendingOrders!==0)?" ("+totalPendingOrders+")":"";
var splitButton=new MPageUI.SplitButton();
splitButton.setStyle(reviewButtonClass);
splitButton.setLabel(opi18n.OP_BUTTON_LABEL+ordersCountText);
splitButton.setLabelButtonClickCallback(function(){var filterSelection=$("#opAdvFilters"+compId).children("option:selected").text();
opDORObject.setSelectedFilter(filterSelection);
if(filterSelection&&filterSelection!==opi18n.ALL_ACTIVE){opDORObject.launchOrderReviewModal();
}else{opDORObject.markOrdersAsReviewed("","",reviewButtonClass);
}});
splitButton.addOptions([{label:opi18n.SPLIT_BUTTON_Option1,onSelect:callbackLaunchOrderReview}]);
reviewButtonHTML.push("<br/><br/>"+splitButton.render());
$("#reviewButton"+compId).html(reviewButtonHTML);
splitButton.attachEvents();
};
OrderProfileComponent.prototype.renderComponent=function(recordData,component){if(!component){component=this;
}if(CERN_Platform.inMillenniumContext()){this.initPendingSR(component);
}var compId=component.getComponentId();
var compNamespace=component.getStyles().getId();
var opi18n=i18n.discernabu.order_profile_o1;
var orderGrouping=component.getOPOrderGrouping();
var userPrefs=component.getPreferencesObj();
var headerCnt=$("#op"+compId).find(".sec-total");
var pendingCnt=$("#pendingCnt"+compId);
var pendingOrdObj=$("#opPendingOrders"+compId);
var pendingInd=pendingOrdObj.length>0?pendingOrdObj.is(":checked"):false;
var advFilterObj=$("#opAdvFilters"+compId);
component.setCurrentFilter(advFilterObj);
component.setPendingOrderObj(pendingOrdObj);
var compTable=null;
var sHTML=[];
var pendingOrderCount="()";
var contentDiv=$("#"+compNamespace+"table");
var hmDisclaimerType=MPageControls.AlertMessage.MessageTypes.INFORMATION;
var hmDisclaimerMessage="<span>"+opi18n.HM_DISCLAIMER+"</span>";
var template=MPageControls.getDefaultTemplates().messageBar;
if(userPrefs!==null){if(userPrefs.hasOwnProperty("catSubSecs")){component.setLocalPrefs(userPrefs);
orderGrouping=userPrefs.groupByPref;
}}component.buildOPOrdersArray(recordData);
pendingOrderCount=" ("+component.opPendingOrders.length+")";
switch(orderGrouping){case 2:compTable=component.getVenueTable(pendingInd);
break;
case 3:compTable=component.getDateTimeTable(pendingInd);
break;
default:compTable=component.getCategoryTable(pendingInd);
break;
}component.applyExpandCollapsePreferences(compTable);
component.compTableOverrides(compTable);
if(advFilterObj.length<1){sHTML.push("<div class='op-controls' id='ordProfControls",compId,"'>");
sHTML.push("<input type='checkbox' id='opPendingOrders",compId,"' value='pending' style='margin:0px 10px;'><span>",opi18n.PENDING_ORDERS,"</span><span id='pendingCnt",compId,"'>",pendingOrderCount,"</span>");
sHTML.push("<span class='op-filters'>",opi18n.GROUP_BY,"</span><select id='opGroupBy",compId,"'>");
if(orderGrouping===1){sHTML.push("<option value='1' selected='selected'>",opi18n.CLINICAL_CATEGORY,"</option>");
}else{sHTML.push("<option value='1'>",opi18n.CLINICAL_CATEGORY,"</option>");
}if(orderGrouping===2){sHTML.push("<option value='2' selected='selected'>",opi18n.ORDER_TYPE_DROP_DOWN,"</option>");
}else{sHTML.push("<option value='2'>",opi18n.ORDER_TYPE_DROP_DOWN,"</option>");
}if(orderGrouping===3){sHTML.push("<option value='3' selected='selected'>",opi18n.NONE,"</option>");
}else{sHTML.push("<option value='3'>",opi18n.NONE,"</option>");
}sHTML.push("</select></div>");
component.createHomeMedicationsDisclaimer(compId);
sHTML.push("<div id='",compNamespace,"tableWrapper' class='op-comp-table'>");
sHTML.push(compTable.render());
sHTML.push("</div>");
sHTML.push("<div id='op"+compId+"SidePanel' class='op-side-panel'></div>");
component.finalizeComponent(sHTML.join(""),MP_Util.CreateTitleText(component,component.opOrdersArray.length));
component.compTableContainer=$("#"+compNamespace+"tableWrapper");
component.sidePanelObj=$("#"+compNamespace+"SidePanel");
component.initSidePanel();
component.opFilterSets={FILTER_CNT:recordData.FILTER_CNT,PREF_GROUPS:recordData.PREF_GROUPS,CANCEL_ORDER_PRIV:recordData.CANCELORDERPRIV,HAS_EXCEPTION:recordData.HAS_EXCEPTION};
component.buildPrefSelector(component.opFilterSets);
var hmDisclaimerElement=$("#opHomeMedsDisclaimer"+compId);
var control=new MPageControls.AlertMessage(hmDisclaimerElement,template,hmDisclaimerType);
control.render(hmDisclaimerMessage);
}else{contentDiv[0].innerHTML=compTable.render();
compTable.finalize();
headerCnt.text("("+recordData.ORDERS.length+")");
pendingCnt.text("("+component.opPendingOrders.length+")");
}if(component.getAllowDailyReview()){$("#opContent"+compId).append("<div id='reviewButton"+compId+"'></div>");
component.renderSplitButton();
var opDORObject=component.getDailyReviewObj();
var reviewButtonClass="review-split-btn_"+compId;
var dailyReviewArray=opDORObject.getReviewOrders();
var totalPendingOrders=dailyReviewArray.length;
if(totalPendingOrders===0){$("."+reviewButtonClass).attr("disabled",true);
}}var eventArg={count:recordData.ORDERS.length};
CERN_EventListener.fireEvent(component,component,EventListener.EVENT_COUNT_UPDATE,eventArg);
};
OrderProfileComponent.prototype.getOrderGroupCheckSatisfier=function(ordProfile){var component=this;
var satisfiedGrpIndexArr=[];
var ordersCount=ordProfile.length;
var isReqSatisfied=false;
if(ordersCount){for(var x=0;
x<ordersCount;
x++){var ordDetailInfo=ordProfile[x];
satisfiedGrpIndexArr=satisfiedGrpIndexArr.concat(component.getOrderGroupSatisfiedIndexArr(ordDetailInfo));
}var distinctGrpIndexArr=[];
$.each(satisfiedGrpIndexArr,function(i,el){if($.inArray(el,distinctGrpIndexArr)===-1){distinctGrpIndexArr.push(el);
}});
if(distinctGrpIndexArr.length===component.getRequiredOrdGrpArr().length){isReqSatisfied=true;
}}return isReqSatisfied;
};
OrderProfileComponent.prototype.getOrderGroupSatisfiedIndexArr=function(ordDetailInfo){var ordGrpSatisfier=false;
var component=this;
var recordData=component.getOPData();
var codesArray=MP_Util.LoadCodeListJSON(recordData.CODES);
var activeStatuses=["ORDERED","INPROCESS","INCOMPLETE","FUTURE","SUSPENDED","MEDSTUDENT"];
var ordStatus=MP_Util.GetValueFromArray(ordDetailInfo.STATUS_CD,codesArray);
var reqOrdGrpArr=component.getRequiredOrdGrpArr();
var reqOrdGrpArrLen=reqOrdGrpArr.length;
var satisfiedGrpIndexArr=[];
var reqOrdGrp=null;
for(var x=0;
x<reqOrdGrpArrLen;
x++){reqOrdGrp=reqOrdGrpArr[x];
var reqOrdGrpSatisfierFlag=false;
if(reqOrdGrp.length){if((reqOrdGrp.indexOf(ordDetailInfo.ORDER_SYNONYM_ID)!==-1)&&(activeStatuses.indexOf(ordStatus.meaning)!==-1)){satisfiedGrpIndexArr.push(x);
}}}return satisfiedGrpIndexArr;
};
OrderProfileComponent.prototype.isGapCheckRequirementSatisfied=function(){var component=this;
var ordGrpCheckSatisfied=false;
var recordData=component.getOPData();
var ordProfile=recordData.ORDERS;
ordGrpCheckSatisfied=component.getOrderGroupCheckSatisfier(ordProfile);
return ordGrpCheckSatisfied;
};
OrderProfileComponent.prototype.updateSatisfierRequirementIndicator=function(){if(this.getGapCheckRequiredInd()){var component=this;
var isRequirementSatisfied=component.isGapCheckRequirementSatisfied();
this.setSatisfiedInd(isRequirementSatisfied);
CERN_EventListener.fireEvent(component,component,EventListener.EVENT_SATISFIER_UPDATE,{satisfied:isRequirementSatisfied});
component.updateComponentRequiredIndicator();
}};
OrderProfileComponent.prototype.getFilteredData=function(selection){var opi18n=i18n.discernabu.order_profile_o1;
var compId=this.getComponentId();
var compNamespace=this.getStyles().getId();
var medCriteria=0;
var nonMedCriteria=2;
var orderTypeFilter=0;
var statusBitMask=8191;
var lookbackDays=0;
var contentDiv=$("#"+compNamespace+"table");
var controlsDiv=$("#ordProfControls"+compId);
var disclaimerDiv=$("#opDisclaimer"+compId);
var refreshInd=false;
var totalOrderStatusBitMask=0;
var orderStatusIndicators=12;
if(disclaimerDiv.length>0){disclaimerDiv.remove();
}if(typeof selection!=="string"){this.markedOrders=[];
var advFilterObj=$("#opAdvFilters"+compId);
refreshInd=true;
selection=advFilterObj.children("option:selected").text();
}for(var z=0;
z<this.opFiltersArray.length;
z++){var thisEntry=this.opFiltersArray[z];
if(thisEntry.filterdisplayname===selection){orderTypeFilter=thisEntry.filterordertype;
lookbackDays=Math.max(thisEntry.activedays,thisEntry.inactivedays);
if(thisEntry.activedaysind==1&&thisEntry.inactivedaysind==1&&thisEntry.activedays!=thisEntry.inactivedays){var uniqueLookbackTimer=MP_Util.CreateTimer("CAP:MPG OP-o1_distinct_lookback_ranges");
if(uniqueLookbackTimer){uniqueLookbackTimer.Start();
uniqueLookbackTimer.Stop();
}var disclaimer=opi18n.LOOKBACK_DISCLAIMER.replace("{0}",lookbackDays);
controlsDiv.append("<div id='opDisclaimer"+compId+"'><span class='op-disclaimer'>"+disclaimer+"</span></div>");
}if(orderTypeFilter!=2){medCriteria+=thisEntry.inpatientordertypeind?parseInt(thisEntry.inpatientordertypeind,10):1;
medCriteria+=thisEntry.prescriptionordertypeind?parseInt(thisEntry.prescriptionordertypeind,10)*2:2;
medCriteria+=thisEntry.ambulatoryordertypeind?parseInt(thisEntry.ambulatoryordertypeind,10)*32:32;
if(thisEntry.inpatientordertypeind!=1){nonMedCriteria=0;
}if(orderTypeFilter==1){nonMedCriteria=0;
}}else{medCriteria=0;
}statusBitMask=thisEntry.checkmarkbitmask;
break;
}}for(var i=orderStatusIndicators;
i>=0;
i--){var orderStatusBit=Math.pow(2,i);
var orderStatusValue="";
if(orderStatusBit<=statusBitMask){statusBitMask=statusBitMask-orderStatusBit;
switch(orderStatusBit){case 2:orderStatusValue=4;
break;
case 4:orderStatusValue=2;
break;
case 8:orderStatusValue=32;
break;
case 32:orderStatusValue=8;
break;
case 64:orderStatusValue=128;
break;
case 128:orderStatusValue=64;
break;
case 1024:orderStatusValue=2048;
break;
case 2048:orderStatusValue=1024;
break;
default:orderStatusValue=orderStatusBit;
}totalOrderStatusBitMask=totalOrderStatusBitMask+orderStatusValue;
}}this.orderStatusBitMaskVal=totalOrderStatusBitMask;
this.compTableArray=new Array(6);
if(!refreshInd){$(contentDiv).html("<div class='op-preloader-icon'></div>");
}var sendAr=[];
var criterion=this.getCriterion();
sendAr.push("^MINE^",criterion.person_id+".0",criterion.encntr_id+".0",criterion.provider_id+".0",totalOrderStatusBitMask,medCriteria,nonMedCriteria,criterion.ppr_cd+".0",lookbackDays);
var request=new MP_Core.ScriptRequest(this,this.getComponentLoadTimerName());
request.setProgramName("MP_GET_ORDER_PROFILE");
request.setParameters(sendAr);
request.setAsync(true);
MP_Core.XMLCCLRequestCallBack(this,request,this.handleFilteredResults);
};
OrderProfileComponent.prototype.getCategoryTable=function(pendingInd){if(!pendingInd&&this.compTableArray[0]==undefined){return this.createCategoryTable();
}else{if(pendingInd&&this.compTableArray[1]==undefined){return this.createCategoryTable(pendingInd);
}else{if(!pendingInd){return this.compTableArray[0];
}else{return this.compTableArray[1];
}}}};
OrderProfileComponent.prototype.createCategoryTable=function(pendingInd){var clickExtension=new TableCellClickCallbackExtension();
var categoryTable=new ComponentTable();
var catLen=pendingInd?this.opPendingCatArray.length:this.opCatArray.length;
var groupSequence=categoryTable.getGroupSequence();
categoryTable.quickGroup=function(key,template,showCount){this.groupedBy=key;
this.groupTemplate=TemplateBuilder.buildTemplate(template);
this.showGroupCount=showCount;
var tableRows=this.getRows();
var numberOfRows=tableRows.length;
if(!numberOfRows){return;
}this.groupMap={};
for(var i=0;
i<numberOfRows;
i++){this.addRowToGroup(key,tableRows[i],showCount);
}};
categoryTable.addRowToGroup=function(groupKey,row,showCount){var rowData=row.getResultData();
var rowKey=(rowData[groupKey]||"UNKNOWN").replace(/[\s]/gi,"_").replace(/[\W]/gi,"").toUpperCase();
var gMap=this.getGroupMap();
if(!gMap[rowKey]){gMap[rowKey]=new TableGroup().setKey(groupKey).setValue(rowKey).setDisplay(this.groupTemplate.render(rowData)).setGroupId(rowKey).setShowCount(showCount);
}gMap[rowKey].addRow(row);
};
var comp=this;
categoryTable.setNamespace(this.getStyles().getId());
categoryTable.setZebraStripe(true);
categoryTable=this.createColumns(categoryTable,1);
if(pendingInd){categoryTable.bindData(this.opPendingOrders);
}else{categoryTable.bindData(this.opOrdersArray);
}for(var x=0;
x<catLen;
x++){if(pendingInd){groupSequence.push(this.opPendingCatArray[x].display.replace(/[\s]/gi,"_").replace(/[\W]/gi,"").toUpperCase());
}else{groupSequence.push(this.opCatArray[x].display.replace(/[\s]/gi,"_").replace(/[\W]/gi,"").toUpperCase());
}}categoryTable.quickGroup("DEPT","${DEPT}",true);
categoryTable.sortByColumnInDirection("ORDER",TableColumn.SORT.ASCENDING);
this.setComponentTable(categoryTable);
if(pendingInd){this.compTableArray[1]=categoryTable;
}else{this.compTableArray[0]=categoryTable;
}clickExtension.setCellClickCallback(function(event,data){comp.ordRowSel(event,data);
});
categoryTable.addExtension(clickExtension);
return categoryTable;
};
OrderProfileComponent.prototype.getVenueTable=function(pendingInd){if(!pendingInd&&this.compTableArray[2]==undefined){return this.createVenueTable();
}else{if(pendingInd&&this.compTableArray[3]==undefined){return this.createVenueTable(pendingInd);
}else{if(!pendingInd){return this.compTableArray[2];
}else{return this.compTableArray[3];
}}}};
OrderProfileComponent.prototype.createVenueTable=function(pendingInd){var clickExtension=new TableCellClickCallbackExtension();
var venueTable=new ComponentTable();
var comp=this;
venueTable.setNamespace(this.getStyles().getId());
venueTable.setCustomClass("op-comp-table");
venueTable.setZebraStripe(true);
venueTable=this.createColumns(venueTable,2);
if(pendingInd){venueTable.bindData(this.opPendingOrders);
}else{venueTable.bindData(this.opOrdersArray);
}venueTable.quickGroup("VENUE","${VENUE}",true);
venueTable.sortByColumnInDirection("ORDER",TableColumn.SORT.ASCENDING);
this.setComponentTable(venueTable);
if(pendingInd){this.compTableArray[3]=venueTable;
}else{this.compTableArray[2]=venueTable;
}clickExtension.setCellClickCallback(function(event,data){comp.ordRowSel(event,data);
});
venueTable.addExtension(clickExtension);
return venueTable;
};
OrderProfileComponent.prototype.getDateTimeTable=function(pendingInd){if(!pendingInd&&this.compTableArray[4]==undefined){return this.createDateTimeTable();
}else{if(pendingInd&&this.compTableArray[5]==undefined){return this.createDateTimeTable(pendingInd);
}else{if(!pendingInd){return this.compTableArray[4];
}else{return this.compTableArray[5];
}}}};
OrderProfileComponent.prototype.createDateTimeTable=function(pendingInd){var clickExtension=new TableCellClickCallbackExtension();
var dateTimeTable=new ComponentTable();
var comp=this;
dateTimeTable.setNamespace(this.getStyles().getId());
dateTimeTable.setCustomClass("op-comp-table");
dateTimeTable.setZebraStripe(true);
dateTimeTable=this.createColumns(dateTimeTable,3);
if(pendingInd){dateTimeTable.bindData(this.opPendingOrders);
}else{dateTimeTable.bindData(this.opOrdersArray);
}dateTimeTable.sortByColumnInDirection("START_DT",TableColumn.SORT.DESCENDING);
this.setComponentTable(dateTimeTable);
if(pendingInd){this.compTableArray[5]=dateTimeTable;
}else{this.compTableArray[4]=dateTimeTable;
}clickExtension.setCellClickCallback(function(event,data){comp.ordRowSel(event,data);
});
dateTimeTable.addExtension(clickExtension);
return dateTimeTable;
};
OrderProfileComponent.prototype.createColumns=function(compTable,type){var opi18n=i18n.discernabu.order_profile_o1;
var colArr=[];
var hoverExtension=new TableCellHoverExtension();
var groupedBy={CATEGORY:1,VENUE:2};
var columnNum={ORDER_ID:0,ORDER_SYN_ID:1,MULTI_SELECT:2,NOTIFICATIONS:3,VENUE:4,ORDER:5,START_DT:6,STATUS:7,STATUS_DT:8,PROVIDER:9,CATEGORY:10};
colArr=[{ID:"ORDER_ID",CLASS:"det-hd",DISPLAY:"",SORTABLE:false,RENDER_TEMPLATE:"${ORDER_ID}"},{ID:"ORDER_SYN_ID",CLASS:"det-hd",DISPLAY:"",SORTABLE:false,RENDER_TEMPLATE:"${SYNONYM_ID}"},{ID:"MULTI_SELECT",CLASS:"op-venue",DISPLAY:"&nbsp;",SORTABLE:false,RENDER_TEMPLATE:"${CHECKBOX_HTML}"},{ID:"NOTIFICATIONS",CLASS:"op-notifications",DISPLAY:"&nbsp;",SORTABLE:false,RENDER_TEMPLATE:"${NOTIFY_HTML}"},{ID:"VENUE",CLASS:"op-venue",DISPLAY:opi18n.ORDER_TYPE_HEADER,PRIMARY_SORT:"VENUE",SORTABLE:true,RENDER_TEMPLATE:"${VENUE_HTML}"},{ID:"ORDER",CLASS:"op-name",DISPLAY:opi18n.ORDER,PRIMARY_SORT:"ORDER",SORTABLE:true,RENDER_TEMPLATE:"<span class='op-ord-name'>${ORDER}</span> <span class='op-detail'>${ORD_DETAILS}</span>"},{ID:"START_DT",CLASS:"op-orderdt",DISPLAY:opi18n.START_DT_TM,PRIMARY_SORT:"START_DTTM_UTC",SORTABLE:true,RENDER_TEMPLATE:"${ORIG_DTTM}"},{ID:"STATUS",CLASS:"op-status",DISPLAY:opi18n.STATUS,PRIMARY_SORT:"STATUS",SORTABLE:true,RENDER_TEMPLATE:"${STATUS}"},{ID:"STATUS_DT",CLASS:"op-statusdt",DISPLAY:opi18n.STATUS_UPDATED,PRIMARY_SORT:"STATUS_UPDT_DTTM_UTC",SORTABLE:true,RENDER_TEMPLATE:"${STATUS_UPDT_DTTM}"},{ID:"PROVIDER",CLASS:"op-provider",DISPLAY:opi18n.ORDERING_PROVIDER,PRIMARY_SORT:"ORIGPROV",SORTABLE:true,RENDER_TEMPLATE:"${ORIGPROV}"},{ID:"CATEGORY",CLASS:"op-category",DISPLAY:opi18n.CLINICAL_CATEGORY,PRIMARY_SORT:"DEPT",SORTABLE:true,RENDER_TEMPLATE:"${DEPT}"}];
var colLen=colArr.length;
for(var x=0;
x<colLen;
x++){var curCol=colArr[x];
var column=new TableColumn();
column.setColumnId(curCol.ID);
column.setCustomClass(curCol.CLASS);
column.setColumnDisplay(curCol.DISPLAY);
if(curCol.SORTABLE){column.setPrimarySortField(curCol.PRIMARY_SORT);
column.setIsSortable(curCol.SORTABLE);
}column.setRenderTemplate(curCol.RENDER_TEMPLATE);
colArr[x]=column;
}for(var y=0;
y<colLen;
y++){if((y===columnNum.VENUE&&type===groupedBy.VENUE)||(y===columnNum.CATEGORY&&type===groupedBy.CATEGORY)){}else{compTable.addColumn(colArr[y]);
}}hoverExtension.addHoverForColumn(colArr[columnNum.NOTIFICATIONS],function(data){var thisThing=data.EVENT.target;
if(thisThing.className==="op-comments-icon"){return"<div class='hvr'><dl><dd>"+data.RESULT_DATA.ORDER_COMMENT+"</dd></dl></div>";
}});
hoverExtension.finalize=function(table){var thiz=this;
var tableBodyTag="#"+table.getNamespace()+"tableBody";
var elementMap={};
$(tableBodyTag).on("mouseover",this.getTarget(),function(event){var anchor=this;
var anchorId=$(this).attr("id");
if(!elementMap[anchorId]){elementMap[anchorId]={};
}thiz.onHover(event);
elementMap[anchorId].TIMEOUT=setTimeout(function(){thiz.showHover(event,table,anchor);
},500);
});
$(tableBodyTag).on("mouseout",this.getTarget(),function(event){clearTimeout(elementMap[$(this).attr("id")].TIMEOUT);
thiz.onLeave(event);
});
};
compTable.addExtension(hoverExtension);
return compTable;
};
OrderProfileComponent.prototype.initSidePanel=function(){var comp=this;
var compId=comp.getComponentId();
var compTableHeight=$("#op"+compId+"table").height();
comp.sidePanel=new CompSidePanel(compId,"op"+compId+"SidePanel");
comp.sidePanel.setExpandOption(comp.sidePanel.expandOption.EXPAND_DOWN);
comp.sidePanel.setFullPanelScrollOn(true);
comp.sidePanel.setHeight(compTableHeight+"px");
comp.sidePanel.renderSidePanel();
comp.sidePanel.showCloseButton();
comp.sidePanel.setCloseFunction(function(){return;
});
};
OrderProfileComponent.prototype.ordRowSel=function(e,data){var inMillennium=CERN_Platform.inMillenniumContext();
var opi18n=i18n.discernabu.order_profile_o1;
var clickedThing=e.target.nodeName;
var isCheckbox=(clickedThing==="INPUT");
var isChecked=false;
var orderInfo=data.RESULT_DATA;
var clickedRow=clickedThing=="SPAN"||isCheckbox?e.target.parentNode.parentNode:e.target.parentNode;
var orderId=orderInfo.ORDER_ID;
var opNamespace=this.getStyles().getId();
var tableBody=$("#"+opNamespace+"tableBody");
var compId=this.getComponentId();
var criterion=this.getCriterion();
var ipath=criterion.static_content;
var checked=$("#"+opNamespace+"tableBody :checked");
var checkedLen=checked.length;
var checkedCnt=checkedLen;
var selectedRows=tableBody.find(".op-row-selected");
var multiSelect=(isCheckbox||checked.length>0)?true:false;
var multiOrdersMsg="";
var cancelSelCnt=0;
var canceledRows=0;
var prevSelectedRow=null;
var resultData=null;
var spHTML=[];
if(isCheckbox){if(e.target.checked===false){checkedCnt++;
isChecked=true;
}else{checkedCnt--;
}if(checkedLen===0&&selectedRows.length>0){prevSelectedRow=selectedRows.find(".table-cell")[0];
resultData=ComponentTableDataRetriever.getResultFromTable(this.m_componentTable,prevSelectedRow);
selectedRows.removeClass("op-row-selected");
this.updateOrderArrays(resultData.ORDER_ID,"select");
}}var orderStatusType=orderInfo.STATUS_TYPE;
if(clickedThing!=="INPUT"&&multiSelect){return;
}else{if(($(clickedRow).hasClass("op-row-selected")&&isCheckbox&&e.target.checked)||($(clickedRow).hasClass("op-row-selected")&&!isCheckbox)){$(clickedRow).removeClass("op-row-selected");
if($(clickedRow).find(".op-cancelled").length>0){cancelSelCnt--;
}}else{if(selectedRows.length>0&&!multiSelect){prevSelectedRow=selectedRows.find(".table-cell")[0];
resultData=ComponentTableDataRetriever.getResultFromTable(this.m_componentTable,prevSelectedRow);
selectedRows.removeClass("op-row-selected");
if(selectedRows.find(".op-cancelled").length>0){cancelSelCnt--;
}this.updateOrderArrays(resultData.ORDER_ID,"select");
}$(clickedRow).addClass("op-row-selected");
if($(clickedRow).find(".op-cancelled").length>0){cancelSelCnt++;
}}spHTML.push("<div class='sp-action-holder'><span id='opResetBtn",compId,"' class='sp-button disabled'>",i18n.discernabu.CONFIRM_CLEAR,"</span><span id='opCancelBtn",compId,"' class='sp-button disabled'>",opi18n.CANCEL_DC,"</span></div>");
if(checkedCnt>1){multiOrdersMsg=opi18n.MULTIPLE_ORDERS_SELECTED.replace("{0}",checkedCnt);
spHTML.push("<div class='op-sp-centered secondary-text' align='center'>",multiOrdersMsg,"</div>");
}else{if($(clickedRow).hasClass("op-row-selected")===false&&checkedCnt===1){selectedRows=tableBody.find(".op-row-selected");
prevSelectedRow=selectedRows.find(".table-cell")[0];
resultData=ComponentTableDataRetriever.getResultFromTable(this.m_componentTable,prevSelectedRow);
spHTML.push(this.buildSidePanelHTML(resultData));
}else{spHTML.push(this.buildSidePanelHTML(orderInfo));
}}this.sidePanel.setContents(spHTML.join(""),"opContent"+compId);
var comp=this;
var closeBtnId="#closeButton"+comp.getComponentId();
var closeBtn=$(closeBtnId);
comp.sidePanel.m_sidePanelObj.off("click",closeBtnId);
closeBtn.off("click");
closeBtn.on("click",function(){comp.clearSelectedRows();
comp.hideSidePanel(comp);
});
if(!this.showPanel){this.showSidePanel();
}}selectedRows=tableBody.find(".op-row-selected");
var selectedLen=selectedRows.length;
selectedRows.each(function(){if($(this).find(".op-cancelled").length>0){canceledRows++;
}});
if(this.showPanel&&selectedLen<=0){this.hideSidePanel();
}if(inMillennium&&orderStatusType==="active"){var cancelBtn=$("#opCancelBtn"+compId);
var clearBtn=$("#opResetBtn"+compId);
if(selectedLen>0&&(cancelSelCnt>0||canceledRows>0)){clearBtn.removeClass("disabled");
if(selectedLen===canceledRows){cancelBtn.addClass("disabled");
}else{cancelBtn.removeClass("disabled");
}}else{if(selectedLen>0&&(cancelSelCnt===0||canceledRows===0)&&(this.hasPriv||this.hasException)){cancelBtn.removeClass("disabled");
if(cancelSelCnt<0){clearBtn.addClass("disabled");
}}else{clearBtn.addClass("disabled");
cancelBtn.addClass("disabled");
}}cancelBtn.on("click",this.markRow);
clearBtn.on("click",this.resetOrderMods);
}this.updateOrderArrays(orderId,"select",isChecked);
};
OrderProfileComponent.prototype.buildSidePanelHTML=function(orderData){var compId=this.getComponentId();
var opi18n=i18n.discernabu.order_profile_o1;
var tHTML=[];
tHTML.push("<div class='sp-header'>",orderData.ORDER,"</div><div class='op-sp-detail-line'>",orderData.ORD_DETAILS,"</div><div class='sp-separator'></div>");
tHTML.push("<div id='sidePanelScrollContainer"+compId+"' class='op-sp-content'>");
tHTML.push("<div class='op-sp-group'><div class='op-sp-detail-line'><span>",opi18n.DOSE,"</span><span>",opi18n.ROUTE,"</span><span>",opi18n.FREQUENCY,"</span></div>");
tHTML.push("<div class='op-sp-detail-value'><span>",orderData.DOSE,"</span><span>",orderData.ROUTE,"</span><span>",orderData.FREQUENCY,"</span></div></div>");
tHTML.push("<div class='op-sp-group'><div class='op-sp-detail-line'><span>",i18n.TYPE,"</span><span>",i18n.STATUS,"</span><span>",opi18n.LAST_STATUS_UPDATE,"</div>");
tHTML.push("<div class='op-sp-detail-value'><span>",orderData.VENUE,"</span><span>",orderData.STATUS,"</span><span>",orderData.STATUS_UPDT_DTTM,"</span></div>");
tHTML.push("</div>");
tHTML.push("<div class='op-sp-group'><div class='op-sp-detail-line'><span>",i18n.ORDERING_PHYSICIAN,"</span><span>",i18n.START,"</span><span>",i18n.STOP,"</span></div>");
tHTML.push("<div class='op-sp-detail-value'><span>",orderData.ORIGPROV,"</span><span>",orderData.ORIG_DTTM,"</span><span>",orderData.STOP_DT_TM,"</span></div></div>");
tHTML.push("<div class='op-sp-group'><div class='op-sp-detail-line'>",i18n.CATEGORY,"</div>");
tHTML.push("<div class='op-sp-detail-value'>",orderData.DEPT,"</div></div>");
tHTML.push("<div class='op-sp-group'><div class='op-sp-detail-line'>",i18n.COMMENTS,"</div>");
tHTML.push("<div class='op-sp-detail-value'>",orderData.ORDER_COMMENT,"</div></div></div>");
return tHTML.join("");
};
OrderProfileComponent.prototype.showSidePanel=function(){var comp=this;
var venueClassCols=comp.compTableContainer.find(".op-venue");
var notificationsCol=comp.compTableContainer.find(".op-notifications");
var orderCol=comp.compTableContainer.find(".op-name");
var startCol=comp.compTableContainer.find(".op-orderdt");
venueClassCols.width(venueClassCols.width());
notificationsCol.width(notificationsCol.width());
orderCol.width(orderCol.width());
startCol.width(startCol.width());
comp.compTableContainer.find(".op-status").hide();
comp.compTableContainer.find(".op-statusdt").hide();
comp.compTableContainer.find(".op-provider").hide();
comp.compTableContainer.find(".op-category").hide();
comp.showPanel=true;
comp.compTableContainer.animate({width:"60%"},125);
comp.sidePanelObj.show().animate({width:"40%"},150,function(){$(this).css("display","inline-block");
});
setTimeout(function(){var tableWidth=comp.compTableContainer.width();
var venueWidthPercentage=((venueClassCols.outerWidth()/tableWidth)*100)+"%";
var notificationsWidthPercentage=((notificationsCol.outerWidth()/tableWidth)*100)+1+"%";
var orderNameWidthPercentage=((orderCol.outerWidth()/tableWidth)*100)+1+"%";
var startDtWidthPercentage=((startCol.outerWidth()/tableWidth)*100)+1+"%";
venueClassCols.css({width:venueWidthPercentage});
notificationsCol.css({width:notificationsWidthPercentage});
orderCol.css({width:orderNameWidthPercentage});
startCol.css({width:startDtWidthPercentage});
comp.resizeComponent();
},150);
};
OrderProfileComponent.prototype.hideSidePanel=function(component){var comp=component?component:this;
var venueClassCols=comp.compTableContainer.find(".op-venue");
var notificationsCol=comp.compTableContainer.find(".op-notifications");
var orderCol=comp.compTableContainer.find(".op-name");
var startCol=comp.compTableContainer.find(".op-orderdt");
var columnMap=comp.m_componentTable.getColumnMap();
venueClassCols.width(venueClassCols.width());
notificationsCol.width(notificationsCol.width());
orderCol.width(orderCol.width());
startCol.width(startCol.width());
setTimeout(function(){venueClassCols.removeAttr("style");
notificationsCol.removeAttr("style");
orderCol.removeAttr("style");
startCol.removeAttr("style");
columnMap.MULTI_SELECT.setWidth(0);
columnMap.NOTIFICATIONS.setWidth(0);
columnMap.ORDER.setWidth(0);
columnMap.START_DT.setWidth(0);
if(columnMap.VENUE){columnMap.VENUE.setWidth(0);
}comp.compTableContainer.find(".op-status").show();
comp.compTableContainer.find(".op-statusdt").show();
comp.compTableContainer.find(".op-provider").show();
comp.compTableContainer.find(".op-category").show();
},150);
comp.showPanel=false;
comp.compTableContainer.animate({width:"100%"},150);
comp.sidePanelObj.animate({width:"0%"},150,function(){$(this).hide();
});
};
OrderProfileComponent.prototype.markRow=function(e){var compId=parseInt(this.id.replace(/[^\d]/g,""),10);
var component=MP_Util.GetCompObjById(compId);
var opNamespace=component.getStyles().getId();
var tableBody=$("#"+opNamespace+"tableBody");
var selectedRows=tableBody.find(".op-row-selected");
var selRowLen=selectedRows.length;
for(var x=0;
x<selRowLen;
x++){var curRow=selectedRows[x];
var curRowOrdId=curRow.children[0].innerHTML;
var curRowSynId=curRow.children[1].innerHTML;
var scratchpadObj={};
compId=compId.toString();
scratchpadObj.componentId=compId;
scratchpadObj.addedFrom="OrderProfile";
if($(curRow).find(".op-cancelled").length===0){var curRowName="";
var curRowDetails="";
var curRowId=curRow.id;
var reg=/\s|(&nbsp;)/g;
$(curRow).children().each(function(){if(this.className==="table-cell op-name"){curRowName=this.children[0].innerHTML;
curRowDetails=this.children[1].innerHTML;
}var content=this.innerText||this.textContent;
if(content){content=content.replace(reg,"");
if(content.length>0&&this.id.indexOf("ORDER_ID")===-1&&this.id.indexOf("ORDER_SYN_ID")===-1){$(this).addClass("op-cancelled");
}}});
scratchpadObj.favId=curRowId;
scratchpadObj.favName=curRowName;
scratchpadObj.favOrderSentDisp=curRowDetails;
scratchpadObj.favParam=curRowSynId+".0|0|0.0";
scratchpadObj.favSynId=curRowSynId+".0";
scratchpadObj.ordAction="cancel";
scratchpadObj.ordId=curRowOrdId;
$(curRow).attr("ORDID",curRowOrdId);
var dataObj=component.addRemoveFromScratchpad(scratchpadObj,false);
component.checkPendingSR(compId,1);
}$(curRow).removeClass("op-row-selected");
component.updateOrderArrays(curRowOrdId,"cancel");
}component.clearSelectedRows();
component.hideSidePanel();
};
OrderProfileComponent.prototype.resetOrderMods=function(e){var compId=parseInt(this.id.replace(/[^\d]/g,""),10);
var component=MP_Util.GetCompObjById(compId);
var opNamespace=component.getStyles().getId();
var dataObj=null;
var tableBody=$("#"+opNamespace+"tableBody");
var selectedRows=tableBody.find(".op-row-selected");
var selRowLen=selectedRows.length;
var scratchpadObj={};
compId=compId.toString();
scratchpadObj.componentId=compId;
scratchpadObj.addedFrom="OrderProfile";
for(var x=0;
x<selRowLen;
x++){var curRow=selectedRows[x];
var curRowName="";
var curRowId="";
var curRowOrdId=curRow.children[0].innerHTML;
if($(curRow).find(".op-cancelled").length>0){curRowId=curRow.id;
$(curRow).children().each(function(){if(this.className==="op-name"){curRowName=this.innerHTML.slice(0,this.innerHTML.indexOf(" <span"));
}if($(this).hasClass("op-cancelled")){$(this).removeClass("op-cancelled");
}});
scratchpadObj.favId=curRowId;
scratchpadObj.favName=curRowName;
scratchpadObj.favParam="0.0|0|0.0";
scratchpadObj.ordAction="clear";
scratchpadObj.ordId=curRowOrdId;
dataObj=component.addRemoveFromScratchpad(scratchpadObj,true);
}$(curRow).removeClass("op-row-selected");
if(dataObj){var componentIsDirty=false;
var scratchpadArr=dataObj.scratchpadObjArr;
if(scratchpadArr){var idx=scratchpadArr.length;
while(idx--){if(scratchpadArr[idx].componentId==compId){componentIsDirty=true;
break;
}}}if(!componentIsDirty){component.checkPendingSR(compId,0);
}}component.updateOrderArrays(curRowOrdId,"clear");
}component.clearSelectedRows();
component.hideSidePanel();
};
OrderProfileComponent.prototype.updateOrderArrays=function(orderId,action,checkedInd){var ordersArrLen=this.opOrdersArray.length;
for(var m=0;
m<ordersArrLen;
m++){var curOrder=this.opOrdersArray[m];
if(orderId==curOrder.ORDER_ID){if(action==="select"){if(curOrder.SELECTED&&!checkedInd){curOrder.SELECTED=!curOrder.SELECTED;
}else{curOrder.SELECTED=true;
}if(checkedInd){curOrder.CHECKBOX_HTML="<input type='checkbox' checked='true'>";
}else{curOrder.CHECKBOX_HTML="<input type='checkbox'>";
}break;
}else{if(action==="clear"){curOrder.SELECTED=false;
curOrder.CHECKBOX_HTML="<input type='checkbox'>";
if(curOrder.CANCELED){curOrder.CANCELED=!curOrder.CANCELED;
this.markedOrders.splice(this.markedOrders.indexOf(curOrder.ORDER_ID),1);
break;
}}else{curOrder.SELECTED=false;
curOrder.CHECKBOX_HTML="<input type='checkbox'>";
if(!curOrder.CANCELED){curOrder.CANCELED=true;
if(this.markedOrders.indexOf(curOrder.ORDER_ID)===-1){this.markedOrders.push(curOrder.ORDER_ID);
break;
}}}}}}};
OrderProfileComponent.prototype.clearSelectedRows=function(){var compId=this.getComponentId();
var contentBody=$("#opContent"+compId);
var selectedRows=contentBody.find(".op-row-selected");
var selRowLen=selectedRows.length;
for(var x=0;
x<selRowLen;
x++){var cur=selectedRows[x];
var curOrdId=cur.children[0].innerHTML;
$(cur).removeClass("op-row-selected");
this.updateOrderArrays(curOrdId,"select");
}this.compTableContainer.find("input:checkbox").attr("checked",false);
};
OrderProfileComponent.prototype.handleFilteredResults=function(reply){var component=reply.getComponent();
var compId=component.getComponentId();
var timerRenderComponent=MP_Util.CreateTimer(component.getComponentRenderTimerName());
var errMsg=[];
try{var IsAllowDailyRreview=component.getAllowDailyReview();
var criterion=component.getCriterion();
var userTimeZone=criterion.client_tz;
var person_id=criterion.person_id;
var encounter_id=criterion.encntr_id;
var provider_id=criterion.provider_id;
var opReviewObj=new OrderProfileOrderReview(compId);
component.setDailyReviewObj(opReviewObj);
opReviewObj.setScriptRequestParams({PERSON_ID:person_id,ENCOUNTER_ID:encounter_id,PRSNL_ID:provider_id});
opReviewObj.setTimeZone(userTimeZone);
component.setOPData(reply.getResponse());
component.updateSatisfierRequirementIndicator();
if(reply.getStatus()==="S"){if(IsAllowDailyRreview){opReviewObj.getQualifiedDailyOrders(function(){component.renderComponent(reply.getResponse(),component);
});
}else{component.renderComponent(reply.getResponse(),component);
}}else{var countText="(0)";
errMsg=[];
if(reply.getStatus()==="F"){errMsg.push(reply.getError());
MP_Util.Doc.FinalizeComponent(MP_Util.HandleErrorResponse(component.getStyles().getNameSpace(),errMsg.join("<br />")),component,countText);
}else{if(IsAllowDailyRreview){opReviewObj.getQualifiedDailyOrders(function(){component.renderComponent(reply.getResponse(),component);
});
}else{component.renderComponent(reply.getResponse(),component);
}}CERN_EventListener.fireEvent(component,component,EventListener.EVENT_COUNT_UPDATE,{count:0});
}}catch(err){if(timerRenderComponent){timerRenderComponent.Abort();
timerRenderComponent=null;
}errMsg=[];
if(err instanceof Error){errMsg.push("<b>",i18n.CONTACT_ADMINISTRATOR,"</b><br><ul><li>",i18n.MESSAGE,": ",err.message,"</li></ul>");
MP_Util.Doc.FinalizeComponent(MP_Util.HandleErrorResponse(component.getStyles().getNameSpace(),errMsg.join("")),component,"");
}MP_Util.LogJSError(err,null,"order-profile-o1.js","handleFilteredResults");
throw err;
}finally{if(timerRenderComponent){timerRenderComponent.Stop();
}}};
OrderProfileComponent.prototype.undoOrderAction=function(event,removeObject){this.scratchpadRemovedOrderAction(removeObject);
};
OrderProfileComponent.prototype.updateComponentOrders=function(event,orderAction){this.scratchpadReceivedOrderAction(orderAction);
};
OrderProfileComponent.prototype.initPendingSR=function(component){var srObj=null;
var dataObj={};
var pendingSR=MP_Resources.getSharedResource("pendingDataSR");
if(!pendingSR){srObj=new SharedResource("pendingDataSR");
dataObj.pendingDataObj=window.external.DiscernObjectFactory("PVFRAMEWORKLINK");
dataObj.pendingDataCompArr=[];
srObj.setIsAvailable(true);
srObj.setResourceData(dataObj);
MP_Resources.addSharedResource("pendingDataSR",srObj);
}else{dataObj=pendingSR.getResourceData();
var idx=dataObj.pendingDataCompArr.length;
while(idx--){if(component.getComponentId()==dataObj.pendingDataCompArr[idx]){dataObj.pendingDataCompArr.splice(idx,1);
break;
}}MP_Resources.setSharedResourceData("pendingDataSR",dataObj);
}dataObj.pendingDataObj.SetPendingData(dataObj.pendingDataCompArr.length===0?0:1);
};
OrderProfileComponent.prototype.initScratchpadSR=function(sharedResourceName){var srObj=null;
var dataObj={};
srObj=new SharedResource(sharedResourceName);
dataObj.scratchpadObjArr=[];
srObj.setIsAvailable(true);
srObj.setResourceData(dataObj);
var object={};
srObj.setEventListenerObject(object);
srObj.setEventListenerFlag(EventListener.EVENT_SCRATCHPAD_COUNT_UPDATE);
MP_Resources.addSharedResource(srObj.getName(),srObj);
return srObj;
};
OrderProfileComponent.prototype.scratchpadRemovedOrderAction=function(removeObject){var compId=this.getComponentId();
var contentBody=$("#opContent"+compId);
var canceledRows=contentBody.find(".op-cancelled");
var xl=canceledRows.length;
var cnclOrder=null;
for(var x=0;
x<xl;
x++){var curCell=canceledRows[x];
if(curCell.parentNode.children[0].innerHTML===removeObject.favSynId){cnclOrder=curCell.parentNode;
break;
}}if(cnclOrder){var cnclOrdId=cnclOrder.children[0].innerHTML;
$(cnclOrder).children().each(function(){if($(this).hasClass("op-cancelled")){$(this).removeClass("op-cancelled");
}});
if($(cnclOrder).hasClass("op-row-selected")){$(cnclOrder).removeClass("op-row-selected");
$("#opResetBtn"+compId).addClass("disabled");
}this.updateOrderArrays(cnclOrdId,removeObject.ordAction);
}};
OrderProfileComponent.prototype.scratchpadReceivedOrderAction=function(orderAction){var compId=this.getComponentId();
var contentBody=$("#opContent"+compId);
var ordersArr=contentBody.find(".result-info");
var ordersArrLen=ordersArr.length;
var orderCompId=parseInt(orderAction.favId.match(/\d+/),10);
var canceledRow=0;
var clearBtn=$("#opResetBtn"+compId);
var cancelBtn=$("#opCancelBtn"+compId);
var selectedRows=contentBody.find(".op-row-selected");
var selectedRowsLength=selectedRows.length;
if(compId!==orderCompId){for(var x=0;
x<ordersArrLen;
x++){var curOrd=ordersArr[x];
var curOrdId=curOrd.children[0].innerHTML;
if(curOrdId===orderAction.ordId){if(!$(curOrd).attr("ORDID")){$(curOrd).attr("ORDID",curOrdId);
}$(curOrd).children().each(function(){if(this.innerText.length>1&&this.id.indexOf("ORDER_ID")===-1&&this.id.indexOf("ORDER_SYN_ID")===-1){if($(this).hasClass("op-cancelled")){$(this).removeClass("op-cancelled");
}else{$(this).addClass("op-cancelled");
}}});
this.updateOrderArrays(curOrdId,orderAction.ordAction);
break;
}}selectedRows.each(function(){if($(this).find(".op-cancelled").length>0){canceledRow++;
}});
if(canceledRow>0&&canceledRow<selectedRowsLength){clearBtn.removeClass("disabled");
cancelBtn.removeClass("disabled");
}else{if(canceledRow>0&&canceledRow===selectedRowsLength){clearBtn.removeClass("disabled");
cancelBtn.addClass("disabled");
}else{if(canceledRow===0&&selectedRowsLength>0){clearBtn.addClass("disabled");
cancelBtn.removeClass("disabled");
}}}}};
OrderProfileComponent.prototype.checkPendingSR=function(compId,pendingInd){var srObj=null;
var dataObj={};
srObj=MP_Resources.getSharedResource("pendingDataSR");
if(srObj){dataObj=srObj.getResourceData();
if(dataObj){var pendingArr=dataObj.pendingDataCompArr;
if(pendingInd){if(pendingArr.join("|").indexOf(compId)===-1){pendingArr.push(compId);
}}else{var idx=pendingArr.length;
while(idx--){if(pendingArr[idx].indexOf(compId)!==-1){pendingArr.splice(idx,1);
break;
}}}dataObj.pendingDataCompArr=pendingArr;
dataObj.pendingDataObj.SetPendingData(dataObj.pendingDataCompArr.length===0?0:1);
MP_Resources.setSharedResourceData("pendingDataSR",dataObj);
}}};
OrderProfileComponent.prototype.addRemoveFromScratchpad=function(scratchpadObj,isRemovingObj){var srObj=this.getScratchpadSharedResourceObject();
var isFromOtherInstance=false;
var otherInstanceCompId=null;
if(srObj){var dataObj=srObj.getResourceData();
if(!dataObj){return null;
}else{var scratchpadArr=dataObj.scratchpadObjArr;
var isCompDirty=false;
if(scratchpadArr){if(isRemovingObj){var idx=scratchpadArr.length;
while(idx--){if(isFromOtherInstance){if(scratchpadArr[idx].componentId==otherInstanceCompId){isCompDirty=true;
break;
}}if(scratchpadArr[idx].ordId==scratchpadObj.ordId){if(scratchpadArr[idx].componentId!=this.getComponentId()){otherInstanceCompId=scratchpadArr[idx].componentId;
isFromOtherInstance=true;
}scratchpadArr.splice(idx,1);
}}if(!isCompDirty){this.checkPendingSR(otherInstanceCompId,0);
}}else{scratchpadArr.push(scratchpadObj);
}}dataObj.scratchpadObjArr=scratchpadArr;
MP_Resources.setSharedResourceData(srObj.getName(),dataObj);
srObj.notifyResourceConsumers(isRemovingObj,scratchpadObj);
return dataObj;
}}};
OrderProfileComponent.prototype.getScratchpadSharedResourceObject=function(){var srObj=null;
var sharedResourceName="scratchpadSR";
srObj=MP_Resources.getSharedResource(sharedResourceName);
if(!srObj){srObj=this.initScratchpadSR(sharedResourceName);
}return srObj;
};
OrderProfileComponent.prototype.buildPrefSelector=function(prefRec){var compId=this.getComponentId();
var opi18n=i18n.discernabu.order_profile_o1;
var filterPrefs=null;
var controlsDiv=$("#ordProfControls"+compId);
var selectHTML=[];
var prefArr=[];
var thisGroupPref=null;
var idx=2;
if(prefRec){filterPrefs=prefRec.PREF_GROUPS;
this.hasPriv=prefRec.CANCEL_ORDER_PRIV;
this.hasException=prefRec.HAS_EXCEPTION;
}thisGroupPref={activeallind:"1",activedays:"0",activedaysind:"0",ambulatoryordertypeind:"1",checkmarkbitmask:"63",documentedmedsordertypeind:"1",filterdisplayname:opi18n.ALL_ACTIVE,filterordertype:"0",inactiveallind:"1",inactivedays:"0",inactivedaysind:"0",inpatientordertypeind:"1",prescriptionordertypeind:"1"};
prefArr.push(thisGroupPref);
selectHTML.push("<span class='op-filters'>",opi18n.SHOW,"</span><select id='opAdvFilters",compId,"'><option value='1'>",opi18n.ALL_ACTIVE,"</option>");
if(filterPrefs){var groupLen=filterPrefs.length;
for(var x=0;
x<groupLen;
x++){var entryLen=filterPrefs[x].ENTRIES.length;
thisGroupPref={};
for(var y=0;
y<entryLen;
y++){var curEntry=filterPrefs[x].ENTRIES[y];
thisGroupPref[curEntry.ENTRY_NAME]=curEntry.VAL;
}if((thisGroupPref.checkmarkbitmask==63||thisGroupPref.checkmarkbitmask==8128)&&thisGroupPref.activeallind==1&&thisGroupPref.inactiveallind==1&&thisGroupPref.filterordertype==0){if(thisGroupPref.ambulatoryordertypeind==1||thisGroupPref.documentedmedsordertypeind==1||thisGroupPref.inpatientordertypeind==1||thisGroupPref.prescriptionordertypeind==1){if(!(thisGroupPref.ambulatoryordertypeind==1&&thisGroupPref.documentedmedsordertypeind==1&&thisGroupPref.inpatientordertypeind==1&&thisGroupPref.prescriptionordertypeind==1)){selectHTML.push("<option value='",idx,"'>",thisGroupPref.filterdisplayname,"</option>");
idx++;
}}}else{if(thisGroupPref.ambulatoryordertypeind==0&&thisGroupPref.documentedmedsordertypeind==0&&thisGroupPref.inpatientordertypeind==0&&thisGroupPref.prescriptionordertypeind==0){thisGroupPref.ambulatoryordertypeind=1;
thisGroupPref.documentedmedsordertypeind=1;
thisGroupPref.inpatientordertypeind=1;
thisGroupPref.prescriptionordertypeind=1;
}selectHTML.push("<option value='",idx,"'>",thisGroupPref.filterdisplayname,"</option>");
idx++;
}prefArr.push(thisGroupPref);
}}thisGroupPref={activeallind:"1",activedays:"0",activedaysind:"0",ambulatoryordertypeind:"1",checkmarkbitmask:"8128",documentedmedsordertypeind:"1",filterdisplayname:opi18n.ALL_INACTIVE,filterordertype:"0",inactiveallind:"1",inactivedays:"0",inactivedaysind:"0",inpatientordertypeind:"1",prescriptionordertypeind:"1"};
prefArr.push(thisGroupPref);
selectHTML.push("<option value='",idx,"'>",opi18n.ALL_INACTIVE,"</option></select>");
this.opFiltersArray=prefArr;
controlsDiv.append(selectHTML.join(""));
this.addHdrEvents(compId);
};
OrderProfileComponent.prototype.addHdrEvents=function(compId){var component=this;
var grouperObj=$("#opGroupBy"+compId);
var pendingOrdObj=$("#opPendingOrders"+compId);
var pendingInd=pendingOrdObj.is(":checked");
var advFilterObj=$("#opAdvFilters"+compId);
var headerDiv=$("#ordProfileHdr"+compId);
var hdrColArr=headerDiv.find(".sort-option");
var cancelBtn=$("#opCancelBtn"+compId);
var resetBtn=$("#opResetBtn"+compId);
var compTable=null;
var contentDiv=component.compTableContainer;
pendingOrdObj.click(function(){var pendingOrdTimer=MP_Util.CreateTimer("CAP:MPG OP-o1_pending_orders");
if(pendingOrdTimer){pendingOrdTimer.Start();
pendingOrdTimer.Stop();
}component.clearSelectedRows();
if(component.showPanel){component.hideSidePanel();
}cancelBtn.addClass("disabled");
resetBtn.addClass("disabled");
var groupByVal=parseInt(grouperObj.val(),10);
pendingInd=pendingOrdObj.is(":checked");
switch(groupByVal){case 2:compTable=component.getVenueTable(pendingInd);
break;
case 3:compTable=component.getDateTimeTable(pendingInd);
break;
default:compTable=component.getCategoryTable(pendingInd);
break;
}component.applyExpandCollapsePreferences(compTable);
component.compTableOverrides(compTable);
component.setComponentTable(compTable);
contentDiv.html(compTable.render());
compTable.finalize();
component.resizeComponent();
});
grouperObj.change(function(){var groupTimer=MP_Util.CreateTimer("CAP:MPG OP-o1_group_filter");
if(groupTimer){groupTimer.Start();
groupTimer.Stop();
}component.clearSelectedRows();
if(component.showPanel){component.hideSidePanel();
}var userPrefs=component.getGroupByPrefs();
component.setPreferencesObj(userPrefs);
component.savePreferences(true);
cancelBtn.addClass("disabled");
resetBtn.addClass("disabled");
var choice=parseInt($(this).val(),10);
pendingInd=pendingOrdObj.is(":checked");
switch(choice){case 2:compTable=component.getVenueTable(pendingInd);
break;
case 3:compTable=component.getDateTimeTable(pendingInd);
break;
default:compTable=component.getCategoryTable(pendingInd);
break;
}component.applyExpandCollapsePreferences(compTable);
component.compTableOverrides(compTable);
component.setComponentTable(compTable);
contentDiv.html(compTable.render());
compTable.finalize();
component.resizeComponent();
});
advFilterObj.change(function(){var filterTimer=MP_Util.CreateTimer("CAP:MPG OP-o1_filter_results");
if(filterTimer){filterTimer.Start();
filterTimer.Stop();
}var selection=advFilterObj.children("option:selected").text();
cancelBtn.addClass("disabled");
resetBtn.addClass("disabled");
if(component.showPanel){component.hideSidePanel();
}component.getFilteredData(selection);
});
};
OrderProfileComponent.prototype.createHomeMedicationsDisclaimer=function(compId){var hmDisclaimerDiv=_g("opHomeMedsDisclaimer"+compId);
if(hmDisclaimerDiv){return;
}hmDisclaimerDiv=Util.cep("div",{className:"message-container",id:"opHomeMedsDisclaimer"+compId});
var m_contentNode=this.getRootComponentNode();
if(m_contentNode){var m_contentNodeHd=_gbt("H2",m_contentNode)[0];
Util.ia(hmDisclaimerDiv,m_contentNodeHd);
}};
OrderProfileComponent.prototype.pullObjFromArray=function(name,array){if(array!==null){for(var x=0,xi=array.length;
x<xi;
x++){if(array[x].value.meaning==name){return(array[x].value);
}}}return null;
};
OrderProfileComponent.prototype.getFullStatusDisplay=function(order,orderStatus){var statusDisplay=this.getOrderStatusDisplay(order,orderStatus);
if(order.DEPT_STATUS_DISPLAY){statusDisplay+=" ("+order.DEPT_STATUS_DISPLAY+")";
}return statusDisplay;
};
OrderProfileComponent.prototype.getOrderStatusDisplay=function(order,orderStatus){var statusDisplay="";
if(order.VENUE.RX_MEDS_IND&&orderStatus.meaning==="ORDERED"){statusDisplay+=i18n.PRESCRIBED;
}else{statusDisplay+=orderStatus.display;
}return statusDisplay;
};
OrderProfileComponent.prototype.addToCategoryArray=function(pendingInd,categoryArr,pendingCategoryArr,orderCategory){function checkForCategoryInArray(catArray,searchCat){var len=catArray.length;
var x=0;
for(x=0;
x<len;
x++){if(catArray[x].display===searchCat.display){return true;
}}return false;
}if(pendingInd&&!checkForCategoryInArray(pendingCategoryArr,orderCategory)){pendingCategoryArr.push(orderCategory);
}if(!checkForCategoryInArray(categoryArr,orderCategory)){categoryArr.push(orderCategory);
}};
OrderProfileComponent.prototype.buildOPOrdersArray=function(recordData){var opi18n=i18n.discernabu.order_profile_o1;
var df=MP_Util.GetDateFormatter();
var ordProfile=recordData.ORDERS;
var prsnlArray=MP_Util.LoadPersonelListJSON(recordData.PRSNL);
var codesArray=MP_Util.LoadCodeListJSON(recordData.CODES);
var arrLen=ordProfile.length;
var pendingStatusesArr=this.getOPPendingOrderStatuses();
var tempCatArr=[];
var tempVenueArr=[];
var tempPendingCatArr=[];
var markedInd=false;
var idx=-1;
var provName="";
var provNameFull="";
var ordStatus="";
var ordDept="";
var ordVenue="";
var medType="";
var deptStatus="";
var statusType="";
var frequency="";
var thisOrderAct=null;
var x=0;
var IVtype=false;
var tempOrd=this.pullObjFromArray("IVSOLUTIONS",codesArray);
var inactiveStatuses=["DISCONTINUED","CANCELED","COMPLETED","PENDING","DELETED","VOIDEDWRSLT","TRANS/CANCEL"];
var notifyHtml=[];
var venueHtml=[];
var fullDateTimeTwoYear=mp_formatter.DateTimeFormatter.FULL_DATE_TIME_2YEAR;
var noResult="--";
var pendingInd=false;
var orderCategory=null;
this.opOrdersArray=[];
this.opPendingOrders=[];
for(x=0;
x<arrLen;
x++){notifyHtml=[];
venueHtml=[];
provName=MP_Util.GetValueFromArray(ordProfile[x].PROVIDER_ID,prsnlArray);
ordStatus=MP_Util.GetValueFromArray(ordProfile[x].STATUS_CD,codesArray);
ordDept=MP_Util.GetValueFromArray(ordProfile[x].DEPT_CD,codesArray);
medType=MP_Util.GetValueFromArray(ordProfile[x].MED_ORD_TYPE_CD,codesArray);
deptStatus=MP_Util.GetValueFromArray(ordProfile[x].DEPT_STATUS_CD,codesArray);
frequency=MP_Util.GetValueFromArray(ordProfile[x].FREQUENCY_CD,codesArray);
pendingInd=jQuery.inArray(deptStatus.codeValue,pendingStatusesArr)!==-1;
idx=this.markedOrders.indexOf(ordProfile[x].ORDER_ID);
if(idx!==-1){markedInd=true;
}else{markedInd=false;
}if(ordDept===null){ordDept=this.pullObjFromArray("NONCAT",codesArray);
}if($.inArray(ordStatus.meaning,inactiveStatuses)>-1){statusType="inactive";
}else{statusType="active";
}if(medType&&medType.display==="IV"){IVtype=true;
}else{IVtype=false;
}if(ordProfile[x].PHYS_COSIGN_STATUS_REQ_IND){notifyHtml.push("<span class='opSprite op-cosign' title='",opi18n.COSIGN_HOVER,"'></span>");
}if(ordProfile[x].CARE_PLAN_NAME){notifyHtml.push("<span class='opSprite op-powerplan' title='",ordProfile[x].CARE_PLAN_NAME,"'></span>");
}if(ordProfile[x].ORDER_COMMENT){notifyHtml.push("<span class='op-comments-icon'></span>");
}if(ordProfile[x].VENUE.DOCUMENTED_IND){if(ordStatus.meaning==="ORDERED"){ordStatus.display=i18n.DOCUMENTED;
}ordVenue=opi18n.DOCUMENTED;
venueHtml.push("<span class='op-doc-icon' title='",opi18n.DOCUMENTED,"'>&nbsp;</span>");
}else{if(ordProfile[x].VENUE.ACUTE_IND){ordVenue=opi18n.INPATIENT;
venueHtml.push("<span class='op-inpat-icon' title='",opi18n.INPATIENT,"'>&nbsp;</span>");
}else{if(ordProfile[x].VENUE.AMBULATORY_IND){ordVenue=opi18n.AMBULATORY;
venueHtml.push("<span class='op-amb-icon' title='",opi18n.AMBULATORY,"'>&nbsp;</span>");
}else{if(ordProfile[x].VENUE.RX_MEDS_IND){ordVenue=opi18n.PRESCRIPTION;
venueHtml.push("<span class='op-rx-icon' title='",opi18n.PRESCRIPTION,"'>&nbsp;</span>");
}else{ordVenue=opi18n.UNSPECIFIED;
venueHtml.push("<span>&nbsp</span>");
}}}}orderCategory=IVtype?tempOrd:ordDept;
this.addToCategoryArray(pendingInd,tempCatArr,tempPendingCatArr,orderCategory);
if($.inArray(ordVenue,tempVenueArr)===-1){tempVenueArr.push(ordVenue);
}provNameFull=noResult;
if(provName!==null&&provName.fullName){provNameFull=provName.fullName;
}thisOrderAct={ORDER:ordProfile[x].ORDER_NAME,ORDER_ID:ordProfile[x].ORDER_ID,ORDER_COMMENT:ordProfile[x].ORDER_COMMENT?ordProfile[x].ORDER_COMMENT:noResult,SYNONYM_ID:ordProfile[x].ORDER_SYNONYM_ID,STATUS:this.getFullStatusDisplay(ordProfile[x],ordStatus),STATUS_MEANING:ordStatus.meaning,STATUS_TYPE:statusType,ORIGPROV:provNameFull,ORD_DETAILS:ordProfile[x].MED_ORD_TYPE_CD!==0?ordProfile[x].SIMPLIFIED_DISPLAY_LINE:ordProfile[x].CLINICAL_DISPLAY_LINE,DOSE:ordProfile[x].DOSE?ordProfile[x].DOSE:noResult,ROUTE:ordProfile[x].ROUTE?ordProfile[x].ROUTE:noResult,FREQUENCY:frequency?frequency.display:noResult,START_DTTM_UTC:ordProfile[x].CURRENT_START_DT_TM,ORIG_DTTM:df.formatISO8601(ordProfile[x].CURRENT_START_DT_TM,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_2YEAR),STOP_DT_TM:ordProfile[x].CURRENT_STOP_DT_TM?df.formatISO8601(ordProfile[x].CURRENT_STOP_DT_TM,fullDateTimeTwoYear):noResult,STATUS_UPDT_DTTM_UTC:ordProfile[x].ACTION_DT_TM,STATUS_UPDT_DTTM:df.formatISO8601(ordProfile[x].ACTION_DT_TM,fullDateTimeTwoYear),DEPT:IVtype?tempOrd.display:ordDept.display,VENUE:ordVenue,DEPT_STATUS:deptStatus.codeValue,SELECTED:false,CANCELED:markedInd,NOTIFY_HTML:"",VENUE_HTML:"",CHECKBOX_HTML:"<input type='checkbox'>"};
thisOrderAct.NOTIFY_HTML=notifyHtml.join("");
thisOrderAct.VENUE_HTML=venueHtml.join("");
this.opOrdersArray.push(thisOrderAct);
if(pendingInd){this.opPendingOrders.push(thisOrderAct);
}}function sortCatArray(a,b){if(a.sequence<b.sequence){return -1;
}if(a.sequence>b.sequence){return 1;
}return 0;
}tempCatArr.sort(sortCatArray);
tempPendingCatArr.sort(sortCatArray);
function sortVenueArray(a,b){if(a.toLowerCase()<b.toLowerCase()){return -1;
}if(a.toLowerCase()>b.toLowerCase()){return 1;
}return 0;
}tempVenueArr.sort(sortVenueArray);
this.opCatArray=tempCatArr;
this.opVenueArray=tempVenueArr;
this.opPendingCatArray=tempPendingCatArr;
};
MP_Util.setObjectDefinitionMapping("WF_ORDER_PROFILE",OrderProfileComponent);
