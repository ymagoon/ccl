function EducationAndCounselingComponentStyle(){this.initByNamespace("edu");
}EducationAndCounselingComponentStyle.inherits(ComponentStyle);
function EducationAndCounselingComponent(criterion){this.setCriterion(criterion);
this.setStyles(new EducationAndCounselingComponentStyle());
this.setComponentLoadTimerName("USR:MPG.EducationAndCounseling.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.EducationAndCounseling.O1 - render component");
this.setIncludeLineNumber(true);
this.eddCounselingPFId=0;
this.setPregnancyLookbackInd(true);
this.setResourceRequired(true);
EducationAndCounselingComponent.method("InsertData",function(){CERN_EDUCATIONANDCOUNSELING_O1.GetEducationAndCounseling(this);
});
EducationAndCounselingComponent.method("HandleSuccess",function(recordData){CERN_EDUCATIONANDCOUNSELING_O1.RenderComponent(this,recordData);
});
EducationAndCounselingComponent.method("RetrieveRequiredResources",function(){var patientGenderInfo=criterion.getPatientInfo().getSex();
var eci18n=i18n.discernabu.educationandcounseling_o1;
if(patientGenderInfo===null){messageHTML="<h3 class='info-hd'><span class='res-normal'>"+eci18n.GENDER_UNDEFINED+"</span></h3><span class='res-none'>"+eci18n.GENDER_UNDEFINED+"</span>";
MP_Util.Doc.FinalizeComponent(messageHTML,this,"(0)");
return;
}var pregInfoObj=null;
pregInfoObj=MP_Resources.getSharedResource("pregnancyInfo");
if(pregInfoObj&&pregInfoObj.isResourceAvailable()){this.InsertData();
}else{PREGNANCY_BASE_UTIL_O1.LoadPregnancyData(this.getCriterion());
}});
EducationAndCounselingComponent.method("getEdCounselingPF",function(powerFormId){return this.eddCounselingPFId;
});
EducationAndCounselingComponent.method("setEdCounselingPF",function(powerFormId){this.eddCounselingPFId=powerFormId;
});
EducationAndCounselingComponent.method("openTab",function(){var pfId=(this.eddCounselingPFId)?this.eddCounselingPFId:0;
var paramString=criterion.person_id+"|"+criterion.encntr_id+"|"+pfId+"|0|0";
MPAGES_EVENT("POWERFORM",paramString);
CERN_EventListener.fireEvent(null,this,EventListener.EVENT_CLINICAL_EVENT);
});
CERN_EventListener.addListener(this,EventListener.EVENT_CLINICAL_EVENT,this.InsertData,this);
CERN_EventListener.addListener(this,"pregnancyInfoAvailable",this.InsertData,this);
}EducationAndCounselingComponent.inherits(MPageComponent);
var CERN_EDUCATIONANDCOUNSELING_O1=function(){function formatDate(dateThatNeedsFormating){var dateFormat=new mp_formatter.DateTimeFormatter(MPAGE_LOCALE);
var dateTime=new Date();
dateTime.setISO8601(dateThatNeedsFormating);
return dateFormat.format(dateTime,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_2YEAR);
}function buildTrimesterAndHoverHTML(i18n,recommendedArray,index,subSecContent,includeSubSecContentFlag){var subSecHTML=[];
var recommendedEventCount=0;
var secCollapse="";
if(includeSubSecContentFlag!==1){secCollapse="closed";
}subSecHTML.push("<div class='sub-sec ",secCollapse,"'><div class='sub-sec-hd'><span class='sub-sec-hd-tgl' title='",i18n.HIDE_SECTION,"'>-</span><div class='sub-sec-title edu-sub-sec-title'><dl class='edu-info'><span>");
if(index+1==1){subSecHTML.push(i18n.FIRST_TRIMESTER);
}else{if(index+1==2){subSecHTML.push(i18n.SECOND_TRIMESTER);
}else{if(index+1==3){subSecHTML.push(i18n.THIRD_TRIMESTER);
}}}subSecHTML.push("</span></dl>");
recommendedEventCount=recommendedArray.LEVENTCNT;
if(recommendedEventCount!==0){subSecHTML.push("<h4 class='det-hd'><span>",i18n.EDUCATION_DETAILS,"</span></h4><div class='hvr'><ul class='edu-list'>");
for(var rec=0;
rec<recommendedEventCount;
rec++){subSecHTML.push("<li><span>",recommendedArray.CATEGORYRESULTS[rec].SEVENTDISPLAY,"</span></li>");
}if(includeSubSecContentFlag===1){subSecHTML.push("</ul></div></div></div><div class='sub-sec-content'>",subSecContent,"</div></div></div>");
}else{subSecHTML.push("</ul></div></div></div></div>");
}}else{subSecHTML.push("</div></div></div>");
}subSecHTML=subSecHTML.join("");
return subSecHTML;
}return{GetEducationAndCounseling:function(component){var sendAr=[];
var criterion=component.getCriterion();
var eci18n=i18n.discernabu.educationandcounseling_o1;
var prsnlInfo=criterion.getPersonnelInfo();
var encntrs=prsnlInfo.getViewableEncounters();
var encntrVal=(encntrs)?"value("+encntrs+")":"0.0";
var firstTrimesterES="0.0";
var groups=null;
var secondTrimesterES="0.0";
var thirdTrimesterES="0.0";
var x=0;
var x1=0;
var pregInfoObj=null;
var pregInfoSR=MP_Resources.getSharedResource("pregnancyInfo");
var pregnancyId=0;
if(criterion.getPatientInfo().getSex().meaning!=="FEMALE"){messageHTML="<h3 class='info-hd'><span class='res-normal'>"+eci18n.NOT_FEMALE+"</span></h3><span class='res-none'>"+eci18n.NOT_FEMALE+"</span>";
MP_Util.Doc.FinalizeComponent(messageHTML,component,"(0)");
return;
}else{if(pregInfoSR&&pregInfoSR.isResourceAvailable()){pregInfoObj=pregInfoSR.getResourceData();
pregnancyId=pregInfoObj.getPregnancyId();
if(pregnancyId===-1){messageHTML="<h3 class='info-hd'><span class='res-normal'>"+eci18n.PREG_DATA_ERROR+"</span></h3><span class='res-none'>"+eci18n.PREG_DATA_ERROR+"</span>";
MP_Util.Doc.FinalizeComponent(messageHTML,component,"(0)");
return;
}else{if(!pregnancyId){messageHTML="<h3 class='info-hd'><span class='res-normal'>"+eci18n.NO_ACTIVE_PREG+"</span></h3><span class='res-none'>"+eci18n.NO_ACTIVE_PREG+"</span>";
MP_Util.Doc.FinalizeComponent(messageHTML,component,"(0)");
return;
}else{groups=component.getGroups();
xl=(groups!==null)?groups.length:0;
for(x=0;
x<xl;
x++){if(x===0){firstTrimesterES=MP_Util.CreateParamArray(groups[0].getEventSets(),1);
}else{if(x===1){secondTrimesterES=MP_Util.CreateParamArray(groups[1].getEventSets(),1);
}else{thirdTrimesterES=MP_Util.CreateParamArray(groups[2].getEventSets(),1);
}}}sendAr.push("^MINE^",criterion.person_id+".0",criterion.provider_id+".0",encntrVal,firstTrimesterES,secondTrimesterES,thirdTrimesterES,criterion.ppr_cd+".0",pregInfoObj.getLookBack());
MP_Core.XMLCclRequestWrapper(component,"MP_PREG_ED_COUNSELINGS",sendAr,true);
}}}}},RenderComponent:function(component,recordData){var countText="";
var educationAndCounselingi18n=i18n.discernabu.educationandcounseling_o1;
var eduCounselingCompletedArrayLength=recordData.COMPLETED.length;
var eduCounselingRecommendedArrayLength=recordData.RECOMMENDED.length;
var jsEduHTML=[];
var jsEduSubSecHTML=[];
var subsec="";
var i;
var completedArray=null;
for(i=0;
i<eduCounselingCompletedArrayLength;
i++){jsEduHTML=[];
subsec="";
completedArray=recordData.COMPLETED[i];
if(completedArray.LEVENTCNT!==0){jsEduSubSecHTML.push("<div class='",MP_Util.GetContentClass(component,completedArray.LEVENTCNT),"'>");
var completedEventCount=completedArray.LEVENTCNT;
for(var j=0;
j<completedEventCount;
j++){var categoryResultsArray=completedArray.CATEGORYRESULTS[j];
var onsetDate=formatDate(categoryResultsArray.SEVENTDATE);
jsEduHTML.push("<dl><dt class='edu-det-hd'>",educationAndCounselingi18n.PATIENT_INFORMATION,"</dt><dd class='edu-name'>",categoryResultsArray.SEVENTDISPLAY,"</dd><dd class='edu-result'>",categoryResultsArray.SEVENTRESULT,"</dd><dd class='edu-date'><span class='date-time'>",onsetDate,"</span></dd></dl>");
}subsec=jsEduHTML.join("");
jsEduSubSecHTML.push(buildTrimesterAndHoverHTML(educationAndCounselingi18n,recordData.RECOMMENDED[i],i,subsec,1));
}else{jsEduSubSecHTML.push(buildTrimesterAndHoverHTML(educationAndCounselingi18n,recordData.RECOMMENDED[i],i,subsec,0));
}}eduHTML=jsEduSubSecHTML.join("");
MP_Util.Doc.FinalizeComponent(eduHTML,component,countText);
}};
}();
