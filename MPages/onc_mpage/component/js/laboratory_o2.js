function LaboratoryComponentWFStyle(){this.initByNamespace("WF_LAB");
}LaboratoryComponentWFStyle.prototype=new ComponentStyle();
function LaboratoryComponentWF(criterion){this.setCriterion(criterion);
this.setStyles(new LaboratoryComponentWFStyle());
this.setComponentLoadTimerName("USR:MPG.LABORATORY.WF - load component");
this.setComponentRenderTimerName("ENG:MPG.LABORATORY.WF - render component");
this.setIncludeLineNumber(false);
this.setPregnancyLookbackInd(true);
this.m_primaryLabel=i18n.discernabu.laboratory_o2.PRIMARY_RESULTS;
this.m_tableReferencesSet=false;
this.m_tableContainer=null;
this.m_labelTable=null;
this.m_labelTableContainer=null;
this.m_labelTableBody=null;
this.m_contentTableContainer=null;
this.m_contentTableBody=null;
this.m_contentTableContents=null;
this.m_scrollController=null;
this.m_recordData=null;
this.m_sidePanel=null;
this.m_sidePanelMinHeight="187px";
this.m_graphData=null;
this.m_plot=null;
this.m_showPanel=false;
this.m_sidePanelContainer=null;
this.m_clickedLabel=null;
this.m_flowsheetResultCap=4000;
this.m_latestColumnCap=0;
this.m_showingLatestResults=false;
this.SIDE_PANEL_AVAILABLE=CERN_Browser.isCanvasAvailable();
this.m_ambulatoryColumnCount=7;
this.m_componentHeaderHeight=34;
this.m_labelColumnWidth=204;
this.m_minColumnWidth=71;
this.m_pixelBuffer=2;
this.m_contentTableWidth=0;
this.m_contentTableBodyHeight=0;
this.m_contentTableContentsHeight=0;
this.m_resultRangeSelectionDisplayString=i18n.LATEST+"*";
this.setLookbackUnits(10);
this.setLookbackUnitTypeFlag(ResultRangeSelectionUtility.CustomType);
this.m_panelElementData={};
this.m_grouper_arr=[];
this.m_selectedResultDataObjectList=[];
}LaboratoryComponentWF.prototype=new MPageComponent();
LaboratoryComponentWF.prototype.constructor=MPageComponent;
LaboratoryComponentWF.prototype.getDiscernObject=function(objectName){if(typeof objectName!=="string"){throw new Error("In LaboratoryComponentWF.prototype.getDiscernObject, invalid parameter objectName");
}return window.external.DiscernObjectFactory(objectName);
};
LaboratoryComponentWF.prototype.handleHeaderToggleClick=function(index){var compId=this.getComponentId();
this.setShowAmbulatoryView(index);
MP_Util.LoadSpinner("WF_LABContent"+compId);
this.retrieveComponentData();
};
LaboratoryComponentWF.prototype.toggleButtonHover=function(){this.onmouseover=function(event){var objectClass=$(event.target).attr("class");
if(objectClass=="hdr-toggle table_active"||objectClass=="hdr-toggle table_inactive"){$(event.target).attr("title",i18n.discernabu.laboratory_o2.FLOWSHEET_VIEW);
}else{if(objectClass=="hdr-toggle viewer_active"||objectClass=="hdr-toggle viewer_inactive"){$(event.target).attr("title",i18n.discernabu.laboratory_o2.AMBULATORY_VIEW);
}}};
};
LaboratoryComponentWF.prototype.setPrimaryLabel=function(primaryLabel){this.m_primaryLabel=primaryLabel;
};
LaboratoryComponentWF.prototype.getPrimaryLabel=function(){return this.m_primaryLabel;
};
LaboratoryComponentWF.prototype.openTab=function(){var criterion=this.getCriterion();
var sParms="/PERSONID="+criterion.person_id+" /ENCNTRID="+criterion.encntr_id+" /FIRSTTAB=^"+this.getLink()+"+^";
APPLINK(0,criterion.executable,sParms);
this.retrieveComponentData();
};
LaboratoryComponentWF.prototype.setShowAmbulatoryView=function(showAmbulatoryView){this.m_showAmbulatoryView=showAmbulatoryView;
};
LaboratoryComponentWF.prototype.getShowAmbulatoryView=function(){return this.m_showAmbulatoryView;
};
LaboratoryComponentWF.prototype.setShowTodayValue=function(showTodayValue){this.m_showTodayValue=showTodayValue;
};
LaboratoryComponentWF.prototype.getShowTodayValue=function(){return this.m_showTodayValue;
};
LaboratoryComponentWF.prototype.setRecordData=function(recordData){this.m_recordData=recordData;
};
LaboratoryComponentWF.prototype.getRecordData=function(){return this.m_recordData;
};
LaboratoryComponentWF.prototype.setLabelTable=function(labelTable){this.m_labelTable=labelTable;
};
LaboratoryComponentWF.prototype.getLabelTable=function(){return this.m_labelTable;
};
LaboratoryComponentWF.prototype.setSelectedDataObjsList=function(selectedDataObjsList){this.m_selectedResultDataObjectList=selectedDataObjsList;
};
LaboratoryComponentWF.prototype.getSelectedDataObjsList=function(){return this.m_selectedResultDataObjectList;
};
LaboratoryComponentWF.prototype.toggleLabelTableExtension=function(event,data){var labelTable=this.getLabelTable();
if(data.GROUP_DATA.EXPANDED){labelTable.openGroup(data.GROUP_DATA.GROUP_ID);
}else{labelTable.collapseGroup(data.GROUP_DATA.GROUP_ID);
}this.resizeComponent();
};
LaboratoryComponentWF.prototype.clearSelectedResults=function(){var selectedDataObjsList=this.getSelectedDataObjsList();
$.each(selectedDataObjsList,function(i,elem){$(elem.selectedElem).removeClass("lab-selected-res-tagging");
});
selectedDataObjsList=[];
this.setSelectedDataObjsList(selectedDataObjsList);
};
LaboratoryComponentWF.prototype.selectTargetResultCell=function(selectedResElem,resultData){var selectedList=[];
var selectedResCell={selectedElem:selectedResElem,selectedResObj:resultData};
var selectedDataObjsList=this.getSelectedDataObjsList();
selectedDataObjsList.push(selectedResCell);
$(selectedResElem).addClass("lab-selected-res-tagging");
$.each(selectedDataObjsList,function(index,result){if($.inArray(result,selectedList)==-1){selectedList.push(result);
}});
this.setSelectedDataObjsList(selectedList);
};
LaboratoryComponentWF.prototype.deselectTargetResultCell=function(selectedResElem){var selectedList=[];
$(selectedResElem).removeClass("lab-selected-res-tagging");
var selectedDataObjsList=this.getSelectedDataObjsList();
$.each(selectedDataObjsList,function(index,e){var resElem=e.selectedElem;
if($(resElem).hasClass("lab-selected-res-tagging")&&$.inArray(e,selectedList)==-1){selectedList.push(e);
}else{delete selectedList[index];
}});
this.setSelectedDataObjsList(selectedList);
};
LaboratoryComponentWF.prototype.multipleResultSelection=function(labTable,firstSelectedRes,lastSelectedRes){var compId=this.getStyles().getId();
var selectedDataObjsList=[];
var resultCell=null;
var temp;
var firstSelectedResDataObj=firstSelectedRes.selectedResObj;
var firstSelectedResElem=firstSelectedRes.selectedElem;
var lastSelectedResDataObj=lastSelectedRes.selectedResObj;
var lastSelectedResElem=lastSelectedRes.selectedElem;
var firstSelectedResColumnId=firstSelectedResDataObj.COLUMN_ID;
var lastSelectedResColumnId=lastSelectedResDataObj.COLUMN_ID;
var firstSelectedResElemRowIndex=parseInt($(firstSelectedResElem).attr("rowIndex"),10);
var lastSelectedResElemRowIndex=parseInt($(lastSelectedResElem).attr("rowIndex"),10);
var firstSelectedResElemColIndex=parseInt($(firstSelectedResElem).attr("colIndex"),10);
var lastSelectedResElemColIndex=parseInt($(lastSelectedResElem).attr("colIndex"),10);
if(firstSelectedResColumnId===lastSelectedResColumnId){if(firstSelectedResElemRowIndex>=lastSelectedResElemRowIndex){temp=firstSelectedResElemRowIndex;
firstSelectedResElemRowIndex=lastSelectedResElemRowIndex;
lastSelectedResElemRowIndex=temp;
}resultCell=$(".colIndex"+compId+firstSelectedResElemColIndex);
resultCell.each(function(index){var nextElemRowIndex=$(this).attr("rowIndex");
if(nextElemRowIndex!==undefined&&nextElemRowIndex>=firstSelectedResElemRowIndex&&nextElemRowIndex<=lastSelectedResElemRowIndex){var resultData=ComponentTableDataRetriever.getResultFromTable(labTable,this);
if(resultData.TIME_BUCKETS[firstSelectedResColumnId].DISPLAY!=="--"){var resultObj={COLUMN_ID:firstSelectedResColumnId,RESULT_DATA:resultData};
var selectedResCell={selectedElem:this,selectedResObj:resultObj};
selectedDataObjsList.push(selectedResCell);
$(this).addClass("lab-selected-res-tagging");
}}});
}else{if(firstSelectedResElemRowIndex===lastSelectedResElemRowIndex){if(firstSelectedResElemColIndex>=lastSelectedResElemColIndex){temp=firstSelectedResElemColIndex;
firstSelectedResElemColIndex=lastSelectedResElemColIndex;
lastSelectedResElemColIndex=temp;
}resultCell=$(".rowIndex"+compId+firstSelectedResElemRowIndex);
resultCell.each(function(){var nextElemcolIndex=$(this).attr("colIndex");
if((nextElemcolIndex!==undefined)&&(nextElemcolIndex>=firstSelectedResElemColIndex&&nextElemcolIndex<=lastSelectedResElemColIndex)){var resultData=ComponentTableDataRetriever.getResultFromTable(labTable,this);
var columnId=ComponentTableDataRetriever.getColumnIdFromElement(labTable,this);
if(resultData.TIME_BUCKETS[columnId].DISPLAY!=="--"){var resultObj={COLUMN_ID:columnId,RESULT_DATA:resultData};
var selectedResCell={selectedElem:this,selectedResObj:resultObj};
selectedDataObjsList.push(selectedResCell);
$(this).addClass("lab-selected-res-tagging");
}}});
}}this.setSelectedDataObjsList(selectedDataObjsList);
};
LaboratoryComponentWF.prototype.tagResult=function(selectedResultList){var criterion=this.getCriterion();
var category_mean=criterion.category_mean;
var capTimer=null;
var resultTagList=[];
var selectedResLen=selectedResultList.length;
for(var i=selectedResLen;
i--;
){var result=selectedResultList[i].selectedResObj;
var columnId=result.COLUMN_ID;
var results=result.RESULT_DATA.TIME_BUCKETS[columnId].OBJECT_ARR;
var resultTag=new TaggedResult();
if(results.length){var resultObj=results[0];
resultTag.setTagEntityId(resultObj.EVENT_ID);
resultTag.setTagDateTime(new Date());
resultTag.setCategorizationArray(["Laboratory"]);
resultTag.setEMRType("LABS");
resultTagList.push(resultTag);
}}MP_TaggingHandler.saveTaggedResults(resultTagList);
capTimer=new CapabilityTimer("CAP:MPG Labs O2 Result Tagging",category_mean);
if(capTimer){capTimer.addMetaData("rtms.legacy.metadata.1","Result Tagging");
capTimer.capture();
}};
LaboratoryComponentWF.prototype.loadFilterMappings=function(){this.addFilterMappingObject("WF_LAB_PRIMARY_LABEL",{setFunction:this.setPrimaryLabel,type:"STRING",field:"FREETEXT_DESC"});
this.addFilterMappingObject("WF_LAB_SPECIALTY_GRP1_ES",{setFunction:this.setGrp1Criteria,type:"ARRAY",field:"PARENT_ENTITY_ID"});
this.addFilterMappingObject("WF_LAB_SPECIALTY_GRP1_LABEL",{setFunction:this.setGrp1Label,type:"STRING",field:"FREETEXT_DESC"});
this.addFilterMappingObject("WF_LAB_SPECIALTY_GRP2_ES",{setFunction:this.setGrp2Criteria,type:"ARRAY",field:"PARENT_ENTITY_ID"});
this.addFilterMappingObject("WF_LAB_SPECIALTY_GRP2_LABEL",{setFunction:this.setGrp2Label,type:"STRING",field:"FREETEXT_DESC"});
this.addFilterMappingObject("WF_LAB_SPECIALTY_GRP3_ES",{setFunction:this.setGrp3Criteria,type:"ARRAY",field:"PARENT_ENTITY_ID"});
this.addFilterMappingObject("WF_LAB_SPECIALTY_GRP3_LABEL",{setFunction:this.setGrp3Label,type:"STRING",field:"FREETEXT_DESC"});
this.addFilterMappingObject("WF_LAB_SPECIALTY_GRP4_ES",{setFunction:this.setGrp4Criteria,type:"ARRAY",field:"PARENT_ENTITY_ID"});
this.addFilterMappingObject("WF_LAB_SPECIALTY_GRP4_LABEL",{setFunction:this.setGrp4Label,type:"STRING",field:"FREETEXT_DESC"});
this.addFilterMappingObject("WF_LAB_SPECIALTY_GRP5_ES",{setFunction:this.setGrp5Criteria,type:"ARRAY",field:"PARENT_ENTITY_ID"});
this.addFilterMappingObject("WF_LAB_SPECIALTY_GRP5_LABEL",{setFunction:this.setGrp5Label,type:"STRING",field:"FREETEXT_DESC"});
this.addFilterMappingObject("WF_LAB_SPECIALTY_GRP6_ES",{setFunction:this.setGrp6Criteria,type:"ARRAY",field:"PARENT_ENTITY_ID"});
this.addFilterMappingObject("WF_LAB_SPECIALTY_GRP6_LABEL",{setFunction:this.setGrp6Label,type:"STRING",field:"FREETEXT_DESC"});
this.addFilterMappingObject("WF_LAB_SPECIALTY_GRP7_ES",{setFunction:this.setGrp7Criteria,type:"ARRAY",field:"PARENT_ENTITY_ID"});
this.addFilterMappingObject("WF_LAB_SPECIALTY_GRP7_LABEL",{setFunction:this.setGrp7Label,type:"STRING",field:"FREETEXT_DESC"});
this.addFilterMappingObject("WF_LAB_SPECIALTY_GRP8_ES",{setFunction:this.setGrp8Criteria,type:"ARRAY",field:"PARENT_ENTITY_ID"});
this.addFilterMappingObject("WF_LAB_SPECIALTY_GRP8_LABEL",{setFunction:this.setGrp8Label,type:"STRING",field:"FREETEXT_DESC"});
this.addFilterMappingObject("WF_LAB_SPECIALTY_GRP9_ES",{setFunction:this.setGrp9Criteria,type:"ARRAY",field:"PARENT_ENTITY_ID"});
this.addFilterMappingObject("WF_LAB_SPECIALTY_GRP9_LABEL",{setFunction:this.setGrp9Label,type:"STRING",field:"FREETEXT_DESC"});
this.addFilterMappingObject("WF_LAB_SPECIALTY_GRP10_ES",{setFunction:this.setGrp10Criteria,type:"ARRAY",field:"PARENT_ENTITY_ID"});
this.addFilterMappingObject("WF_LAB_SPECIALTY_GRP10_LABEL",{setFunction:this.setGrp10Label,type:"STRING",field:"FREETEXT_DESC"});
this.addFilterMappingObject("WF_LAB_INFO_BUTTON_IND",{setFunction:this.setHasInfoButton,type:"BOOLEAN",field:"FREETEXT_DESC"});
this.addFilterMappingObject("WF_LAB_DISPLAY",{setFunction:this.setShowAmbulatoryView,type:"BOOLEAN",field:"FREETEXT_DESC"});
this.addFilterMappingObject("WF_LAB_RESULTS_IND",{setFunction:this.setShowTodayValue,type:"BOOLEAN",field:"FREETEXT_DESC"});
};
LaboratoryComponentWF.prototype.resizeComponent=function(){var columnWidth=this.m_minColumnWidth;
var compDOMObj=null;
var compId=this.getStyles().getId();
var componentHeight=0;
var contentTable=null;
var contentTableContainerHeight=0;
var contentTableWidth=0;
var headerHeight=this.m_componentHeaderHeight;
var labelTableContainerWidth=this.m_labelColumnWidth;
var maxHeight=0;
var miscHeight=10;
var pixelBuffer=this.m_pixelBuffer;
var scrollerWidth=18;
var secContentWidth=0;
var tableHeight=0;
var timeBucketCnt=0;
var viewContainer=null;
var viewContainerHeight=0;
this.resetSizingCalculations();
if(!this.m_tableReferencesSet){return;
}contentTable=$("#"+compId+"Contenttable");
if(!this.isDisplayable()){return;
}viewContainer=$("#vwpBody");
if(!viewContainer.length){return;
}compDOMObj=$("#"+compId);
if(!compDOMObj.length){return;
}secContentWidth=$(this.getSectionContentNode()).width();
if(this.SIDE_PANEL_AVAILABLE&&this.m_showPanel){var panelWidth=$("#"+compId+"sidePanelContainer");
if(panelWidth.length){panelWidth=panelWidth.outerWidth();
secContentWidth-=panelWidth;
}}componentHeight=compDOMObj.height();
contentTableContainerHeight=this.m_contentTableContainer.height();
viewContainerHeight=viewContainer.height();
this.m_contentTableBody.children("div").each(function(){tableHeight+=$(this).height();
});
maxHeight=viewContainerHeight-(componentHeight-contentTableContainerHeight+miscHeight);
if((tableHeight+headerHeight+scrollerWidth)>maxHeight){this.m_scrollController.css("max-height",maxHeight-headerHeight-scrollerWidth).addClass("labs-wf-scroll-controller-visible");
this.m_scrollController.find(".labs-wf-scroller-content").height(tableHeight+scrollerWidth);
this.m_contentTableContainer.width(secContentWidth-labelTableContainerWidth-scrollerWidth);
this.m_labelTableContainer.css("max-height",maxHeight-scrollerWidth+pixelBuffer+"px");
this.m_contentTableContainer.css("max-height",maxHeight+"px");
this.m_labelTableBody.css("max-height",maxHeight-headerHeight-scrollerWidth+"px");
this.m_contentTableBody.css("max-height",maxHeight-headerHeight-scrollerWidth+"px");
contentTableContainerHeight=this.m_contentTableContainer.height();
if((contentTableContainerHeight-contentTable.height())>20){this.m_contentTableContainer.css("max-height",(maxHeight-scrollerWidth)+"px");
}else{this.m_contentTableContainer.css("max-height",maxHeight+"px");
}}else{if(this.m_scrollController.hasClass("labs-wf-scroll-controller-visible")){this.m_scrollController.removeClass("labs-wf-scroll-controller-visible").addClass("labs-wf-scroll-controller-hidden");
this.m_contentTableContainer.width(secContentWidth-labelTableContainerWidth);
}this.m_labelTableContainer.css("max-height","");
this.m_contentTableContainer.css("max-height","");
this.m_labelTableBody.css("max-height","");
this.m_contentTableBody.css("max-height","");
}if(this.m_scrollController.hasClass("labs-wf-scroll-controller-visible")){this.m_contentTableContainer.width(secContentWidth-labelTableContainerWidth-scrollerWidth);
contentTableWidth=secContentWidth-labelTableContainerWidth-scrollerWidth-pixelBuffer;
}else{this.m_contentTableContainer.width(secContentWidth-labelTableContainerWidth);
contentTableWidth=secContentWidth-labelTableContainerWidth-pixelBuffer;
}timeBucketCnt=contentTable.find(".header-item").length;
if(timeBucketCnt>0){if(contentTableWidth>(timeBucketCnt*columnWidth)){columnWidth=Math.floor(contentTableWidth/timeBucketCnt);
}contentTable.width(timeBucketCnt*columnWidth+pixelBuffer);
contentTable.find(".labs-wf-content-col").css("width",columnWidth);
if(this.getShowAmbulatoryView()){contentTableWidth=contentTable.width();
var previousColumnHeaderWidth=(contentTableWidth-columnWidth)/2;
$("#WF_LAB"+this.getComponentId()+"ContentcolumnHeaderResultColumn1").width(previousColumnHeaderWidth+"px");
if(this.getShowTodayValue()&&this.getDateFormat()!=4){contentTable.find(".table-cell.labs-wf-ambulatory-latest-col").addClass("labs-wf-first-column-result");
}}if(this.m_sidePanel){tableHeight=$("#WF_LAB"+this.getComponentId()+"TableContainer").css("height");
this.m_sidePanel.setHeight(tableHeight);
if(this.m_showPanel){this.m_sidePanel.resizePanel();
var labPlot=this.getLabPlot();
if(labPlot){labPlot.replot();
}}}}};
LaboratoryComponentWF.prototype.scrollTables=function(event){var compId=this.getStyles().getId();
var scrollerTop=0;
if(this.m_tableReferencesSet&&this.m_scrollController.hasClass("labs-wf-scroll-controller-visible")){scrollerTop=this.m_scrollController.scrollTop();
if(event.type==="mousewheel"){var delta=event.originalEvent.wheelDeltaY||event.originalEvent.wheelDelta;
scrollerTop-=delta;
this.m_scrollController.scrollTop(scrollerTop);
}this.m_labelTableBody.scrollTop(scrollerTop);
this.m_contentTableBody.scrollTop(scrollerTop);
return(scrollerTop<=0||(scrollerTop+this.getContentTableBodyHeight()>=this.getContentTableContentsHeight()));
}};
LaboratoryComponentWF.prototype.createDisclaimerMessage=function(){var lookbackDisplay="";
switch(this.getBrLookbackUnitTypeFlag()){case 1:lookbackDisplay=i18n.discernabu.LAST_N_HOURS_LOWER.replace("{0}",this.getBrLookbackUnits());
break;
case 2:lookbackDisplay=i18n.discernabu.LAST_N_DAYS_LOWER.replace("{0}",this.getBrLookbackUnits());
break;
case 3:lookbackDisplay=i18n.discernabu.LAST_N_WEEKS_LOWER.replace("{0}",this.getBrLookbackUnits());
break;
case 4:lookbackDisplay=i18n.discernabu.LAST_N_MONTHS_LOWER.replace("{0}",this.getBrLookbackUnits());
break;
case 5:lookbackDisplay=i18n.discernabu.LAST_N_YEARS_LOWER.replace("{0}",this.getBrLookbackUnits());
break;
default:lookbackDisplay=(this.getScope()===2)?i18n.discernabu.SELECTED_VISIT_LOWER:i18n.discernabu.All_VISITS_LOWER;
}return"* "+i18n.discernabu.FLOWSHEET_DISCLAIMER.replace("{0}",this.m_latestColumnCap).replace("{1}",lookbackDisplay);
};
LaboratoryComponentWF.prototype.preProcessing=function(){var advFiltMenu=null;
var compId=this.getStyles().getId();
var compMenu=this.getMenu();
var facilityDefinedDisplay=i18n.discernabu.FACILITY_DEFINED_VIEW;
var groupLength=this.m_grouper_arr.length;
var labI18n=i18n.discernabu.laboratory_o2;
var self=this;
if(!this.isDisplayable()||!compMenu){return;
}var customMenuItem=new ResultRangeSelection();
customMenuItem.setType(ResultRangeSelectionUtility.CustomType);
customMenuItem.setDirection(ResultRangeSelectionUtility.direction.BACKWARD);
customMenuItem.setUnits(0);
customMenuItem.setScope(this.getScope());
customMenuItem.setDisplay(this.m_resultRangeSelectionDisplayString);
ResultRangeSelectionUtility.addCustomResultRangeSelectionItem(this,customMenuItem);
var labsFiltItem=new MenuSelection("compFilters"+compId);
labsFiltItem.setLabel(labI18n.FILTERS).setClickFunction(function(){if(!advFiltMenu){advFiltMenu=new AdvancedFilterMenu("advancedFilterMenu"+compId).setIsRootMenu(true).setIsPersistent(true).setLabel(labI18n.FILTERS);
advFiltMenu.setWidth(300);
advFiltMenu.setAnchorElementId(compMenu.getAnchorElementId());
advFiltMenu.setContentParentId(compId);
advFiltMenu.setAnchorConnectionCorner(["bottom","right"]);
advFiltMenu.setContentConnectionCorner(["top","right"]);
advFiltMenu.setSaveButtonLabel(labI18n.APPLY);
advFiltMenu.setIsSaveButtonEnabled(true);
advFiltMenu.setCancelButtonLabel(i18n.CANCEL);
advFiltMenu.setIsCancelButtonEnabled(true);
advFiltMenu.setIsActionLinkEnabled(true);
advFiltMenu.setActionLinkLabel(i18n.discernabu.RESET_ALL);
advFiltMenu.setActionLinkFunction(function(){var advFiltMenuContents=$("#advFiltMenu"+compId);
advFiltMenuContents.find(":checked").removeAttr("checked");
advFiltMenuContents.find(":first-child").find("input").attr("checked","checked");
});
advFiltMenu.setSaveFunction(function(){MP_Util.LoadSpinner(compId+"TableContainer");
var advFiltMenuContents=$("#advFiltMenu"+compId);
var filters=[];
advFiltMenuContents.find(":checked").next().each(function(indx,element){filters.push(element.innerHTML);
});
self.setGrouperFilterCriteria(filters);
MP_MenuManager.closeMenuStack(true);
self.retrieveComponentData();
MP_Core.AppUserPreferenceManager.UpdateSingleCompPreferences(self,true);
});
advFiltMenu.setCancelFunction(function(){MP_MenuManager.closeMenuStack(true);
});
advFiltMenu.setAdvancedFilterCreationFunction(function(){var container=null;
var filterChecked="";
var filterCnt=0;
var group=null;
var groupCnt=0;
var groupSelection=null;
var grouperFilterCriteria=self.getGrouperFilterCriteria();
var selectedFilters={};
var x=0;
creatFilterClickFunc=function(filter){return function(){var checkbox=filter.find(":checkbox");
if(typeof checkbox.attr("checked")!="undefined"){checkbox.removeAttr("checked");
}else{checkbox.attr("checked","checked");
}};
};
if(grouperFilterCriteria){filterCnt=grouperFilterCriteria.length;
for(x=filterCnt;
x--;
){selectedFilters[grouperFilterCriteria[x]]=true;
}}container=$("<div id='advFiltMenu"+compId+"'></div>");
filterChecked=(filterCnt===0||typeof selectedFilters[facilityDefinedDisplay]!=="undefined")?"checked='checked'":"";
groupSelection=$("<div class='labs-wf-filter'><input type=checkbox "+filterChecked+" onclick='event.cancelBubble=true;' class='labs-wf-filter-checkbox' /><span class='labs-wf-filter-label'>"+facilityDefinedDisplay+"</span></div>");
groupSelection.click(creatFilterClickFunc(groupSelection));
container.append(groupSelection);
if(self.m_grouper_arr&&self.m_grouper_arr.length){groupCnt=self.m_grouper_arr.length;
for(x=0;
x<groupCnt;
x++){group=self.m_grouper_arr[x];
if(group&&group.label&&group.criteria&&group.criteria.length){filterChecked=(typeof selectedFilters[group.label]!=="undefined")?"checked='checked'":"";
groupSelection=$("<div class='labs-wf-filter'><input type=checkbox onclick='event.cancelBubble=true;' "+filterChecked+" class='labs-wf-filter-checkbox' /><span title='"+group.label+"' class='labs-wf-filter-label'>"+group.label+"</span></div>");
groupSelection.click(creatFilterClickFunc(groupSelection));
container.append(groupSelection);
}}}return container;
});
MP_MenuManager.addMenuObject(advFiltMenu);
}MP_MenuManager.showMenu("advancedFilterMenu"+compId);
});
compMenu.addMenuItem(labsFiltItem);
if(this.hasInfoButton()){compMenu.addMenuItem(new MenuSeparator());
var infoButtonSelection=new MenuSelection(compId+"InfoButton").setIsSelected(this.isInfoButtonEnabled());
infoButtonSelection.setLabel(i18n.discernabu.INFO_BUTTON);
infoButtonSelection.setCloseOnClick(false);
infoButtonSelection.setClickFunction(function(clickEvent){if(infoButtonSelection.isSelected()){if(self.m_tableReferencesSet){self.m_labelTableContainer.addClass("labs-wf-info-button-active");
}self.setIsInfoButtonEnabled(1);
}else{if(self.m_tableReferencesSet){self.m_labelTableContainer.removeClass("labs-wf-info-button-active");
}self.setIsInfoButtonEnabled(0);
}MP_Core.AppUserPreferenceManager.UpdateSingleCompPreferences(self,true);
});
compMenu.addMenuItem(infoButtonSelection);
}if(this.getShowAmbulatoryView()){this.setActiveHeaderToggleIndex(1);
}else{this.setActiveHeaderToggleIndex(0);
}this.setHeaderToggleStyles([{active:"table_active",inactive:"table_inactive"},{active:"viewer_active",inactive:"viewer_inactive"}]);
};
LaboratoryComponentWF.prototype.resetSizingCalculations=function(){this.m_latestColumnCap=0;
this.m_contentTableWidth=0;
this.m_contentTableBodyHeight=0;
this.m_contentTableContentsHeight=0;
};
LaboratoryComponentWF.prototype.calculateLatestColumnCap=function(){var columnWidth=this.m_minColumnWidth;
var contentTableWidth=0;
if(this.m_latestColumnCap===0){contentTableWidth=this.calculateContentTableWidth();
this.m_latestColumnCap=Math.floor(contentTableWidth/columnWidth)-1;
}return this.m_latestColumnCap;
};
LaboratoryComponentWF.prototype.calculateContentTableWidth=function(){var labelColumnWidth=this.m_labelColumnWidth;
var pixelBuffer=this.m_pixelBuffer;
var compId=this.getStyles().getId();
if(this.m_contentTableWidth===0){this.m_contentTableWidth=$(this.getSectionContentNode()).width()-labelColumnWidth-pixelBuffer;
if(this.SIDE_PANEL_AVAILABLE&&this.m_showPanel){var panelWidth=$("#"+compId+"sidePanelContainer");
if(panelWidth.length){panelWidth=panelWidth.outerWidth();
this.m_contentTableWidth-=panelWidth;
}}}return this.m_contentTableWidth;
};
LaboratoryComponentWF.prototype.getContentTableBodyHeight=function(){if(this.m_contentTableBodyHeight===0){this.m_contentTableBodyHeight=this.m_contentTableBody.height();
}return this.m_contentTableBodyHeight;
};
LaboratoryComponentWF.prototype.getContentTableContentsHeight=function(){if(this.m_contentTableContentsHeight===0){this.m_contentTableContentsHeight=this.m_contentTableContents.height();
}return this.m_contentTableContentsHeight;
};
LaboratoryComponentWF.prototype.retrieveComponentData=function(){var columnCap=0;
var component=this;
var viewCategoryMean=this.getCriterion().category_mean;
var loadTimer=new RTMSTimer(this.getComponentLoadTimerName(),viewCategoryMean);
var renderTimer=new RTMSTimer(this.getComponentRenderTimerName(),viewCategoryMean);
var criterion=this.getCriterion();
var encntrSelection="";
var eventSetArrCnt=0;
var eventSet=0;
var eventSets=null;
var eventSetString="";
var eventSetCnt=0;
var facilityDefinedDisplay=i18n.discernabu.FACILITY_DEFINED_VIEW;
var filterMap={};
var uniqueEventSets={SORT_ARRAY:[]};
var group=null;
var groups=this.getGroups();
var grouperFilterCriteria="";
var loadDefaults=false;
var loadLatestResults=false;
var lookbackItems=this.getLookbackMenuItems()||[];
var lookbackUnits=0;
var lookbackType=0;
var primaryEventSets=0;
var resultCap=0;
var sendAr=[];
var secondaryEventSets=[];
var userPrefs=null;
var userLookbackPrefs=null;
var x=0;
var y=0;
this.m_showPanel=false;
this.m_clickedLabel=null;
if(this.m_grouper_arr&&this.m_grouper_arr.length){for(x=this.m_grouper_arr.length;
x--;
){group=this.m_grouper_arr[x];
if(group){filterMap[group.label]=group;
}}}grouperFilterCriteria=this.getGrouperFilterCriteria();
if(grouperFilterCriteria&&grouperFilterCriteria.length){for(x=grouperFilterCriteria.length;
x--;
){group=grouperFilterCriteria[x];
if(facilityDefinedDisplay===group){loadDefaults=true;
filterMap[group]={label:facilityDefinedDisplay,criteria:[]};
}else{if(typeof filterMap[group]!=="undefined"){uniqueEventSets.SORT_ARRAY[x+1]=filterMap[group].criteria;
}}}}else{filterMap[facilityDefinedDisplay]={label:facilityDefinedDisplay,criteria:[]};
loadDefaults=true;
}if(loadDefaults&&groups&&groups.length){for(x=groups.length;
x--;
){group=groups[x];
switch(group.getGroupName()){case"WF_LAB_PRIMARY_CE":case"WF_LAB_PRIMARY_CE_SEQ":primaryEventSets=MP_Util.CreateParamArray(group.getEventSets(),1);
break;
case"WF_LAB_SECONDARY_ES":filterMap[facilityDefinedDisplay].criteria=group.getEventSets();
uniqueEventSets.SORT_ARRAY[0]=filterMap[facilityDefinedDisplay].criteria;
break;
default:break;
}}}eventSetArrCnt=uniqueEventSets.SORT_ARRAY.length;
for(x=0;
x<eventSetArrCnt;
x++){eventSets=uniqueEventSets.SORT_ARRAY[x];
if(eventSets){eventSetCnt=eventSets.length;
for(y=0;
y<eventSetCnt;
y++){eventSet=eventSets[y];
eventSetString=eventSet.toString();
if(typeof uniqueEventSets[eventSetString]=="undefined"){uniqueEventSets[eventSetString]=true;
secondaryEventSets.push(eventSet);
}}}}lookbackUnits=this.getLookbackUnits();
lookbackType=this.getLookbackUnitTypeFlag();
if(lookbackType===ResultRangeSelectionUtility.CustomType){lookbackUnits=this.getBrLookbackUnits();
lookbackType=this.getBrLookbackUnitTypeFlag();
columnCap=this.calculateLatestColumnCap();
this.m_flowsheetResultCap=columnCap+5;
this.m_showingLatestResults=true;
}else{this.m_showingLatestResults=false;
this.m_flowsheetResultCap=4000;
}if(this.getShowAmbulatoryView()){if(this.SIDE_PANEL_AVAILABLE){resultCap=10;
}else{resultCap=this.m_ambulatoryColumnCount;
}}else{resultCap=this.m_flowsheetResultCap;
}encntrSelection=(this.getScope()===2)?criterion.encntr_id+".0":"0.0";
sendAr.push("^MINE^",criterion.person_id+".0",encntrSelection,criterion.provider_id+".0",criterion.ppr_cd+".0",lookbackUnits,lookbackType,"^^","^^",primaryEventSets,MP_Util.CreateParamArray(secondaryEventSets,1),resultCap);
var scriptRequest=new ComponentScriptRequest();
scriptRequest.setProgramName("MP_RETRIEVE_LABS_GROUP_DATA");
scriptRequest.setParameterArray(sendAr);
scriptRequest.setComponent(component);
scriptRequest.setLoadTimer(loadTimer);
scriptRequest.setRenderTimer(renderTimer);
scriptRequest.performRequest();
};
LaboratoryComponentWF.prototype.formatResult=function(result){var numberFormatter=MP_Util.GetNumericFormatter();
if(mp_formatter._isNumber(result.RESULT)){result.RESULT=numberFormatter.format(result.RESULT,"^."+MP_Util.CalculatePrecision(result.RESULT));
}else{if(result.RES_TYPE===3&&(typeof result.DATE_FORMATTED=="undefined")){dateResult=new Date();
dateResult.setISO8601(result.RESULT);
result.RESULT=dateResult.format("longDateTime3");
result.DATE_FORMATTED=true;
}}};
LaboratoryComponentWF.prototype.formatDate=function(dateTime){var date=new Date();
date.setISO8601(dateTime);
return date.format("longDateTime3");
};
LaboratoryComponentWF.prototype.getNormalcy=function(normalcyValue,resultIndex,hoverNormalcyClass){var normalcyClassObj={NORMALCY:"res-normal",HOVERNORMALCY:hoverNormalcyClass,CRITICAL_IND:null};
switch(normalcyValue){case"CRITICAL":case"EXTREMEHIGH":case"PANICHIGH":case"EXTREMELOW":case"PANICLOW":case"VABNORMAL":case"POSITIVE":normalcyClassObj.CRITICAL_IND=true;
normalcyClassObj.NORMALCY="res-severe";
if(resultIndex>0){normalcyClassObj.HOVERNORMALCY="res-severe";
}break;
case"HIGH":normalcyClassObj.NORMALCY="res-high";
if(resultIndex>0&&!(hoverNormalcyClass==="res-severe")){normalcyClassObj.HOVERNORMALCY="res-high";
}break;
case"LOW":normalcyClassObj.NORMALCY="res-low";
if(resultIndex>0&&!("res-high|res-severe".indexOf(hoverNormalcyClass)>=0)){normalcyClassObj.HOVERNORMALCY="res-low";
}break;
case"ABNORMAL":normalcyClassObj.NORMALCY="res-abnormal";
if(resultIndex>0&&!("res-high|res-severe|res-low".indexOf(hoverNormalcyClass)>=0)){normalcyClassObj.HOVERNORMALCY="res-abnormal";
}break;
}return normalcyClassObj;
};
LaboratoryComponentWF.prototype.processData=function(recordData){var self=this;
var criticalResultInd=null;
var curDate=new Date(9999,1,1);
var dateTime=null;
var formattedTimeBucketRef="";
var lastMeasDisplayed=null;
var meas=null;
var measCnt=0;
var measDisplayedCnt=0;
var nextDate=null;
var primaryGroup=null;
var primaryGroupInd=false;
var primaryGroupCnt=0;
var resultGroup=null;
var resultGroupCnt=0;
var timeBucket=null;
var timeBucketCnt=0;
var timeBucketRef="";
var ambulatoryColumnRef="";
var x=0;
var y=0;
var z=0;
var todaysDate=new Date();
var todaysYearValue=todaysDate.getFullYear();
var todaysMonthValue=todaysDate.getMonth();
var todaysDateValue=todaysDate.getDate();
this.setRecordData(recordData);
function timeBucketObjConstructor(timeGroups){var timeBucketObj={};
for(var i=timeGroups.length;
i--;
){timeBucketObj[timeGroups[i].TIME_DISP_FORMATTED]={DISPLAY:"--",OBJECT_ARR:[],TIME_BUCKET_ISO8601:timeGroups[i].TIME_DISP};
}return timeBucketObj;
}function ambulatoryColumnConstructor(columnCount){var ambulatoryColumnObject={};
var ambulatoryColumnHeader="";
var ambulatoryColumnObjectIndexZero={};
for(var i=columnCount;
i--;
){ambulatoryColumnObject["ResultColumn"+i]={DISPLAY:"--",OBJECT_ARR:[],COLUMN_DISPLAY:"",NEW_DAY_CLASS:""};
}if(columnCount>0){ambulatoryColumnObjectIndexZero=ambulatoryColumnObject.ResultColumn0;
if(self.getShowTodayValue()){ambulatoryColumnObjectIndexZero.COLUMN_DISPLAY="<span>"+i18n.discernabu.laboratory_o2.TODAY+"</span>";
}else{ambulatoryColumnObjectIndexZero.COLUMN_DISPLAY="<span>"+i18n.discernabu.laboratory_o2.LATEST+"</span>";
}ambulatoryColumnObjectIndexZero.NEW_DAY_CLASS="labs-wf-ambulatory-latest-col labs-wf-first-content-col";
}if(columnCount>1){ambulatoryColumnObject.ResultColumn1.COLUMN_DISPLAY="<span>"+i18n.discernabu.laboratory_o2.PREVIOUS+"</span>";
}return ambulatoryColumnObject;
}function createResultDisplay(timeBucketObjs){var eventArr=[];
var dateResult=null;
var result=null;
var resultCnt=timeBucketObjs.length;
var resultDisplay="";
var dateTimeDisplay="";
var normalcyClassObj;
var hoverNormalcyClass="res-normal";
var i=0;
var formattedTimeBucketRef="";
timeBucketObjs[0].COMMENTS_IND="";
timeBucketObjs[0].SHOW_UOM="";
for(i=0;
i<resultCnt;
i++){normalcyClassObj=self.getNormalcy(timeBucketObjs[i].NORMALCY,i,hoverNormalcyClass);
timeBucketObjs[i].NORMALCY_CLASS=normalcyClassObj.NORMALCY;
hoverNormalcyClass=normalcyClassObj.HOVERNORMALCY;
if(timeBucketObjs[i].HAS_COMMENTS_IND){timeBucketObjs[0].COMMENTS_IND="<span class='labs-wf-comments-ind'></span>";
}if(!criticalResultInd){criticalResultInd=normalcyClassObj.CRITICAL_IND;
}}timeBucketObjs[0].MODIFIED_IND=(timeBucketObjs[0].STATUS_MEAN==="MODIFIED"||timeBucketObjs[0].STATUS_MEAN==="ALTERED")?"<span class='res-modified'>&nbsp</span>":"";
if(timeBucketObjs[0].DIFF_UOM&&timeBucketObjs[0].DIFF_UOM!=="--"){timeBucketObjs[0].SHOW_UOM=" "+timeBucketObjs[0].DIFF_UOM;
}self.formatResult(timeBucketObjs[0]);
result=timeBucketObjs[0].RESULT;
resultDisplay=timeBucketObjs[0].RES_MOD_DISPLAY+result+timeBucketObjs[0].SHOW_UOM+timeBucketObjs[0].COMMENTS_IND+timeBucketObjs[0].MODIFIED_IND+" "+((resultCnt>1)?"<span class='labs-wf-bracket'>[<span class='"+hoverNormalcyClass+"'>"+resultCnt+"</span>]</span>":"");
if(self.getShowAmbulatoryView()){var dateFormat=self.getDateFormat();
var resultDate=new Date();
resultDate.setISO8601(timeBucketObjs[0].DTTM);
var dateTime=MP_Util.DisplayDateByOption(self,resultDate);
dateTimeDisplay='<span class="labs-wf-time-within"> '+dateTime+" </span>";
if(dateFormat===4){return'<span class="'+timeBucketObjs[0].NORMALCY_CLASS+'"><span class="res-ind">&nbsp;</span><span class="res-val">'+resultDisplay+"</span></span>";
}return'<span class="'+timeBucketObjs[0].NORMALCY_CLASS+'"><span class="res-ind">&nbsp;</span><span class="res-val">'+resultDisplay+"</span></span>"+dateTimeDisplay;
}else{return'<span class="'+timeBucketObjs[0].NORMALCY_CLASS+'"><span class="res-ind">&nbsp;</span><span class="res-val">'+resultDisplay+"</span></span>";
}}if(!this.getShowAmbulatoryView()){timeBucketCnt=recordData.TG.length;
if(this.m_showingLatestResults&&timeBucketCnt>this.m_latestColumnCap){recordData.TG=recordData.TG.splice(0,this.m_latestColumnCap);
timeBucketCnt=recordData.TG.length;
}for(x=0;
x<timeBucketCnt;
x++){timeBucket=recordData.TG[x];
dateTime=new Date();
dateTime.setISO8601(timeBucket.TIME_DISP);
timeBucket.TIME_DISP_FORMATTED=this.formatDate(timeBucket.TIME_DISP);
nextDate=new Date();
nextDate.setISO8601(timeBucket.TIME_DISP);
if((nextDate.getDate()!==curDate.getDate())||(nextDate.getMonth()!==curDate.getMonth())||(nextDate.getFullYear()!==curDate.getFullYear())){timeBucket.NEW_DAY_CLASS="labs-wf-content-col-hdr-new-day";
timeBucket.COLUMN_DISPLAY="<span class='"+timeBucket.NEW_DAY_CLASS+"'>"+dateTime.format("mediumDate")+"<br />"+dateTime.format("militaryTime")+"</span>";
curDate=nextDate;
if(x===0){timeBucket.NEW_DAY_CLASS="labs-wf-first-content-col";
if((dateTime.getDate()===todaysDateValue)&&(dateTime.getMonth()===todaysMonthValue)&&(dateTime.getFullYear()===todaysYearValue)){timeBucket.COLUMN_DISPLAY="<span>"+i18n.discernabu.laboratory_o2.TODAY+"<br />"+dateTime.format("militaryTime")+"</span>";
}}}else{timeBucket.NEW_DAY_CLASS="";
timeBucket.COLUMN_DISPLAY="<span>&nbsp<br />"+dateTime.format("militaryTime")+"</span>";
}}}primaryGroupCnt=recordData.PG.length;
for(x=primaryGroupCnt;
x--;
){primaryGroup=recordData.PG[x];
resultGroupCnt=primaryGroup.RG.length;
if(primaryGroup.SUBSEC_NAME==="PRIMARY"){primaryGroupInd=true;
primaryGroup.SUBSEC_LABEL=this.getPrimaryLabel();
}else{primaryGroup.SUBSEC_LABEL=(typeof primaryGroup.RG[0]!="undefined"&&primaryGroup.RG[0].GROUP_NAME)?primaryGroup.RG[0].GROUP_NAME:primaryGroup.SUBSEC_NAME;
primaryGroupInd=false;
}for(y=resultGroupCnt;
y--;
){resultGroup=primaryGroup.RG[y];
measCnt=resultGroup.MEASUREMENTS.length;
if(!measCnt){primaryGroup.RG.splice(y,1);
continue;
}if(!this.getShowAmbulatoryView()){resultGroup.TIME_BUCKETS=timeBucketObjConstructor(recordData.TG);
}else{resultGroup.TIME_BUCKETS=ambulatoryColumnConstructor(this.m_ambulatoryColumnCount);
}resultGroup.SECONDARY_GROUP_NAME=((primaryGroupInd)?resultGroup.MEASUREMENTS[0].DISPLAY_NAME:resultGroup.MEASUREMENTS[0].RESULT_NAME)||"&nbsp;";
resultGroup.FIRST_RES_UOM=resultGroup.MEASUREMENTS[0].UOM;
var isResultZeroToday=false;
if(this.getShowAmbulatoryView()){measCnt=Math.min(measCnt,this.m_ambulatoryColumnCount);
if(this.getShowTodayValue()){var indexZeroResultDateTime=resultGroup.MEASUREMENTS[0].DTTM.replace(/:[0-9][0-9]Z/,":00Z");
var indexZeroNewDateTime=new Date();
indexZeroNewDateTime.setISO8601(indexZeroResultDateTime);
if(todaysDateValue===indexZeroNewDateTime.getDate()&&todaysMonthValue===indexZeroNewDateTime.getMonth()&&todaysYearValue===indexZeroNewDateTime.getFullYear()){isResultZeroToday=true;
}else{if(measCnt===7){measCnt=measCnt-1;
}}}}measDisplayedCnt=0;
lastMeasDisplayed=null;
for(z=measCnt;
z--;
){meas=resultGroup.MEASUREMENTS[z];
if(meas.UOM===resultGroup.FIRST_RES_UOM){meas.DIFF_UOM="";
}else{if(meas.UOM){meas.DIFF_UOM=meas.UOM;
}else{meas.DIFF_UOM="--";
}}timeBucketRef=meas.DTTM.replace(/:[0-9][0-9]Z/,":00Z");
if(!this.getShowAmbulatoryView()){formattedTimeBucketRef=this.formatDate(timeBucketRef);
if(typeof resultGroup.TIME_BUCKETS[formattedTimeBucketRef]!=="undefined"){resultGroup.TIME_BUCKETS[formattedTimeBucketRef].OBJECT_ARR.push(meas);
resultGroup.TIME_BUCKETS[formattedTimeBucketRef].DISPLAY=createResultDisplay(resultGroup.TIME_BUCKETS[formattedTimeBucketRef].OBJECT_ARR);
measDisplayedCnt++;
if(measDisplayedCnt===1){lastMeasDisplayed=meas;
}resultGroup.LATEST_RESULT_COUNT=measDisplayedCnt;
}}else{ambulatoryColumnRef=resultGroup.TIME_BUCKETS["ResultColumn"+z];
if(!this.getShowTodayValue()){ambulatoryColumnRef.OBJECT_ARR.push(meas);
ambulatoryColumnRef.DISPLAY=createResultDisplay(ambulatoryColumnRef.OBJECT_ARR);
}else{dateTime=new Date();
dateTime.setISO8601(timeBucketRef);
if(isResultZeroToday){ambulatoryColumnRef.OBJECT_ARR.push(meas);
ambulatoryColumnRef.DISPLAY=createResultDisplay(ambulatoryColumnRef.OBJECT_ARR);
}else{ambulatoryColumnRef=resultGroup.TIME_BUCKETS["ResultColumn"+(z+1)];
if(ambulatoryColumnRef){ambulatoryColumnRef.OBJECT_ARR.push(meas);
ambulatoryColumnRef.DISPLAY=createResultDisplay(ambulatoryColumnRef.OBJECT_ARR);
}}}}}if(!this.getShowAmbulatoryView()){if(measDisplayedCnt===0){primaryGroup.RG.splice(y,1);
}else{if(measDisplayedCnt>=this.m_flowsheetResultCap){timeBucketRef=lastMeasDisplayed.DTTM.replace(/:[0-9][0-9]Z/,":00Z");
for(timeBucket in resultGroup.TIME_BUCKETS){if(resultGroup.TIME_BUCKETS.hasOwnProperty(timeBucket)){if(timeBucketRef>resultGroup.TIME_BUCKETS[timeBucket].TIME_BUCKET_ISO8601){resultGroup.TIME_BUCKETS[timeBucket].DISPLAY="<span class='labs-wf-results-unknown'>&nbsp;</span>";
}}}}}}}if(!primaryGroup.RG.length){recordData.PG.splice(x,1);
}}CERN_EventListener.fireEvent(this,this,EventListener.EVENT_CRITICAL_UPDATE,{critical:criticalResultInd});
};
LaboratoryComponentWF.prototype.createTableColumn=function(timeBucketObj){return new TableColumn().setColumnId(timeBucketObj.TIME_DISP_FORMATTED).setColumnDisplay(timeBucketObj.COLUMN_DISPLAY).setCustomClass("labs-wf-content-col "+timeBucketObj.NEW_DAY_CLASS).setRenderTemplate("${TIME_BUCKETS['"+timeBucketObj.TIME_DISP_FORMATTED+"'].DISPLAY}");
};
LaboratoryComponentWF.prototype.createAmbulatoryViewColumn=function(index,ambulatoryColumnObject){return new TableColumn().setColumnId("ResultColumn"+index).setColumnDisplay(ambulatoryColumnObject["ResultColumn"+index].COLUMN_DISPLAY).setCustomClass("labs-wf-content-col "+ambulatoryColumnObject["ResultColumn"+index].NEW_DAY_CLASS).setRenderTemplate("${TIME_BUCKETS['ResultColumn"+index+"'].DISPLAY}");
};
LaboratoryComponentWF.prototype.createTableGroup=function(groupObj,addNameInd){return new TableGroup().setGroupId("ESCode"+groupObj.EVENT_SET_CD).bindData(groupObj.RG).setDisplay((addNameInd)?"<span title='"+groupObj.SUBSEC_LABEL+"'>"+groupObj.SUBSEC_LABEL+"</span>":"&nbsp;");
};
LaboratoryComponentWF.prototype.handleGetMeasurementEventClassInfo=function(reply,measurement){var eventClassInfo=reply.EVENT_CLASS_INFO;
measurement.EVENT_CLASS_CD=eventClassInfo.EVENT_CLASS_CD;
measurement.PRIMARY_CRITERIA_CD=eventClassInfo.PRIMARY_CRITERIA_CD;
};
LaboratoryComponentWF.prototype.retrieveMeasurementEventClassInfo=function(measurement){var self=this;
var errorRetrievingEventClassInfo=false;
var eventClassData=null;
var measurementEventClassRequest=new MP_Core.ScriptRequest();
measurementEventClassRequest.setProgramName("MP_GET_EVENT_CLASS_INFO");
measurementEventClassRequest.setParameters(["^MINE^",measurement.EVENT_ID+".0",measurement.EVENT_CD+".0"]);
measurementEventClassRequest.setAsync(false);
measurementEventClassRequest.setExecCallback(true);
MP_Core.XMLCCLRequestCallBack(null,measurementEventClassRequest,function(reply){if(reply.getStatus()!=="S"){errorRetrievingEventClassInfo=true;
}eventClassData=reply.getResponse();
});
if(errorRetrievingEventClassInfo){throw new Error("There was an error retrieving the event class info for the measurement");
}self.handleGetMeasurementEventClassInfo(eventClassData,measurement);
};
LaboratoryComponentWF.prototype.launchInfoButtonForMeasurement=function(infoButtonApp,measurement){var criterion=this.getCriterion();
infoButtonApp.SetInfoButtonData(criterion.person_id,criterion.encntr_id,measurement.PRIMARY_CRITERIA_CD,1,2);
infoButtonApp.AddResult(measurement.EVENT_ID,measurement.EVENT_CD,measurement.EVENT_CLASS_CD,measurement.RESULT,measurement.EVENT_CD,(measurement.QUANTITY_VALUE.length)?measurement.QUANTITY_VALUE[0].UNIT_CD:0);
infoButtonApp.LaunchInfoButton();
};
LaboratoryComponentWF.prototype.labelTableCellClickHandler=function(event,data){var target=event.target;
var targetClass="";
var meas=null;
if(!target){return;
}targetClass=target.className;
if(targetClass==="labs-wf-info-button"){try{meas=data.RESULT_DATA.MEASUREMENTS[0];
var launchInfoBtnApp=CERN_Platform.getDiscernObject("INFOBUTTONLINK");
if(launchInfoBtnApp){if(!meas.PRIMARY_CRITERIA_CD||!meas.EVENT_CLASS_CD){this.retrieveMeasurementEventClassInfo(meas);
}this.launchInfoButtonForMeasurement(launchInfoBtnApp,meas);
}}catch(error){var errorName=error.name;
var errorMessage=error.message||i18n.discernabu.INFO_BUTTON_ERROR_MSG;
logger.logError(errorName+":"+errorMessage);
var errorModal=MP_ModalDialog.retrieveModalDialogObject("infoButtonErrorModal");
if(!errorModal){errorModal=MP_Util.generateModalDialogBody("infoButtonErrorModal","error",errorMessage,i18n.discernabu.INFO_BUTTON_ERROR_ACTION);
errorModal.setHeaderTitle(i18n.ERROR_OCCURED);
var closeButton=new ModalButton("closeButton");
closeButton.setText(i18n.CLOSE).setCloseOnClick(true);
errorModal.addFooterButton(closeButton);
}MP_ModalDialog.updateModalDialogObject(errorModal);
MP_ModalDialog.showModalDialog("infoButtonErrorModal");
return;
}}else{if(targetClass==="labs-wf-sub-sec-name"||targetClass==="table-cell labs-wf-label-col"||targetClass==="table-cell labs-wf-uom-col"||targetClass==="labs-wf-result-uom"){if(this.SIDE_PANEL_AVAILABLE){this.setPanelContentsToClickedRow(event,data);
}}}};
LaboratoryComponentWF.prototype.getLabPlot=function(){return this.m_plot;
};
LaboratoryComponentWF.prototype.setLabPlot=function(plot){this.m_plot=plot;
};
LaboratoryComponentWF.prototype.getGraphData=function(){return this.m_graphData;
};
LaboratoryComponentWF.prototype.setGraphData=function(data){this.m_graphData=data;
};
LaboratoryComponentWF.prototype.plotLabGraph=function(){var graphArray=this.getGraphData();
var graphDivId="WF_LAB"+this.getComponentId()+"graphHolder";
var graphHolder=$(graphDivId);
var labPlot=this.getLabPlot();
$("#WF_LAB"+this.getComponentId()+"graphHolder").bind("jqplotMouseMove",function(ev,gridpos,datapos,neighbor,plot){var x=gridpos.x;
var y=gridpos.y;
var plotWidth=plot._width;
var limitWidth=plotWidth-x;
var leftMargin=190;
var tooltip="#"+graphDivId+" .jqplot-highlighter-tooltip";
if(limitWidth<leftMargin){if(x>leftMargin){$(tooltip).css("margin-left","-195px");
}else{if(x<limitWidth){$(tooltip).css("margin-left","-85px");
}else{$(tooltip).css("margin-left","-150px");
}}}else{$(tooltip).css("margin-left","0");
}if(y<$(tooltip).height()){$(tooltip).css("top","0px");
}});
function tooltipEditor(str,seriesIndex,pointIndex,plot){var data=plot.data[seriesIndex][pointIndex];
return"<div class ='labs-graph-tooltip'>"+data[3]+" : <span class='"+data[2]+"'><span>"+data[1]+"&nbsp;"+data[4]+"&nbsp;"+data[5]+"</span></span><br><span>"+i18n.discernabu.laboratory_o2.DATE_TIME+" : "+data[0].format("mediumDate")+"&nbsp;"+data[0].format("militaryTime")+"</span></div>";
}var chartOptions={axes:{axesDefaults:{pad:2},xaxis:{renderer:$.jqplot.DateAxisRenderer,tickOptions:{formatString:"%m/%d/%Y",showGridline:false,showMark:false,fontSize:"8pt",show:false},max:graphArray[graphArray.length-1][0],min:graphArray[0][0],numberTicks:2,useDST:true},yaxis:{pad:2,tickOptions:{show:false},rendererOptions:{drawBaseline:false}}},highlighter:{show:true,tooltipContentEditor:tooltipEditor,tooltipLocation:"ne",sizeAdjust:7},cursor:{show:false},series:[{lineWidth:2,shadow:false,color:"#505050",markerOptions:{show:true,size:8,color:"#505050",shadow:false}}],grid:{background:"#FFFFFF",borderColor:"#DDDDDD",borderWidth:2,shadow:false,showBorder:true}};
labPlot=$.jqplot("WF_LAB"+this.getComponentId()+"graphHolder",[graphArray],chartOptions);
this.setLabPlot(labPlot);
};
LaboratoryComponentWF.prototype.setPanelContentsToClickedRow=function(event,dataObj){var componentId=this.getComponentId();
var labsI18N=i18n.discernabu.laboratory_o2;
var criterion=this.getCriterion();
var firstResultUOM=dataObj.RESULT_DATA.FIRST_RES_UOM;
if(this.m_clickedLabel&&dataObj.RESULT_DATA.SECONDARY_GROUP_NAME==this.m_clickedLabel){this.m_sidePanel.m_cornerCloseButton.trigger("click");
this.m_clickedLabel=null;
return;
}if(!this.m_showPanel){this.m_tableContainer.addClass("labs-wf-side-panel-addition");
this.m_contentTableContainer.css("width",this.m_tableContainer.outerWidth()-200-this.m_scrollController.outerWidth()+"px");
this.m_sidePanelContainer.css("display","inline-block");
this.m_showPanel=true;
this.m_sidePanel.showPanel();
}var numberOfMostRecentResults=10;
if(event){var currentRowLabelSelected=event.currentTarget.parentNode;
var currentRowResultsSelectedId=currentRowLabelSelected.id.replace("Labels","Content");
var currentRowResultsSelected=document.getElementById(currentRowResultsSelectedId);
this.highlightSelectedRow(currentRowLabelSelected,currentRowResultsSelected,false);
}this.m_sidePanel.setActionsAsHTML("");
this.m_sidePanel.setTitleText(dataObj.RESULT_DATA.SECONDARY_GROUP_NAME);
this.m_sidePanel.setSubtitleText(firstResultUOM);
var sidePanelHTML="<div id='WF_LAB"+componentId+"sidePanelResultsContainer'><br/><div id = 'WF_LAB"+componentId+"testResult' class = 'labs-flex-text'></div><div id='WF_LAB"+componentId+"graphHolder' class='labs-canvas-height'></div><div id='WF_LAB"+componentId+"dateRange' class = 'labs-date-range'></div></div><div id='sidePanelScrollContainer"+componentId+"'><div id='WF_LAB"+componentId+"sidePanelResultList' class='labs-wf-side-panel-result-list'>";
var measurementLength=0;
var resultHTML="";
var todaysDate=new Date();
var resultDiffUOM="";
var measurement=null;
var dateTime=null;
var elementId="";
var resultObjInfo=null;
var lastMeasInTableIdx=3;
var differentUOM=false;
var graphArray=[];
if(this.m_showAmbulatoryView){measurementLength=Math.min(dataObj.RESULT_DATA.MEASUREMENTS.length,numberOfMostRecentResults);
}else{measurementLength=dataObj.RESULT_DATA.LATEST_RESULT_COUNT;
}for(var measIdx=0;
measIdx<measurementLength;
measIdx++){measurement=dataObj.RESULT_DATA.MEASUREMENTS[measIdx];
dateTime=new Date();
dateTime.setISO8601(measurement.DTTM);
measurement.MODIFIED_IND=(measurement.STATUS_MEAN==="MODIFIED"||measurement.STATUS_MEAN==="ALTERED")?"<span class='res-modified'>&nbsp;</span>":"";
if(!measurement.NORMALCY_CLASS){measurement.NORMALCY_CLASS=this.getNormalcy(measurement.NORMALCY,0).NORMALCY;
}this.formatResult(measurement);
if(!isNaN(measurement.RESULT)){measurement.RESULT=parseFloat(measurement.RESULT,10);
}if(measurement.UOM===dataObj.RESULT_DATA.FIRST_RES_UOM){if(measurement.RES_MOD_DISPLAY===""){graphArray.push([dateTime,measurement.RESULT,measurement.NORMALCY_CLASS,measurement.RESULT_NAME,measurement.UOM,measurement.MODIFIED_IND]);
}}else{if(measurement.UOM){measurement.DIFF_UOM=measurement.UOM;
differentUOM=true;
}else{measurement.DIFF_UOM="--";
}}resultDiffUOM="";
if(measurement.DIFF_UOM){resultDiffUOM=" "+measurement.DIFF_UOM;
}elementId="WF_LAB"+componentId+"result"+measIdx;
resultObjInfo={EVENT_ID:measurement.EVENT_ID,NAME:dataObj.RESULT_DATA.SECONDARY_GROUP_NAME};
this.m_panelElementData[elementId]=resultObjInfo;
resultHTML+="<dl><dd class='labs-result-value'><span class="+measurement.NORMALCY_CLASS+"><span class='res-ind'></span>";
resultHTML+="<span class='res-val' id='"+elementId+"'>"+measurement.RES_MOD_DISPLAY+measurement.RESULT+resultDiffUOM;
if(measurement.HAS_COMMENTS_IND){resultHTML+="<span class='labs-wf-comments-ind'></span>";
}resultHTML+=measurement.MODIFIED_IND+"</span></span></dd><dd class='secondary-text labs-result-date'>";
if(dateTime.getDate()===todaysDate.getDate()&&dateTime.getMonth()===todaysDate.getMonth()&&dateTime.getFullYear()===todaysDate.getFullYear()){resultHTML+=labsI18N.TODAY;
}else{resultHTML+=dateTime.format("mediumDate");
}resultHTML+="<span class='labs-wf-side-panel-result-item'>"+dateTime.format("militaryTime")+"</span></dd></dl>";
}sidePanelHTML+=resultHTML+"</div></div></div>";
this.m_sidePanel.setContents(sidePanelHTML,"WF_LABContent"+componentId);
this.addClickToResults();
var graphHeight=$("#WF_LAB"+componentId+"sidePanelResultsContainer").height();
this.addClickExpandCollapse(graphHeight);
var graphDivId="#WF_LAB"+this.getComponentId()+"graphHolder";
var graphHolder=$(graphDivId);
var testResult=$("#WF_LAB"+this.getComponentId()+"testResult");
var graphDateRange=$("#WF_LAB"+this.getComponentId()+"dateRange");
var minDate=null;
var maxDate=null;
var testResultHTML="";
var graphDateHTML="";
testResult.empty();
graphDateRange.empty();
if(graphArray.length>0){minDate=graphArray[graphArray.length-1][0].format("mediumDate");
maxDate=graphArray[0][0].format("mediumDate");
}graphDateHTML+="<div><span class = 'graph-date-left'>"+minDate+"</span><span class='graph-date-right'>"+maxDate+"</span></div>";
if(graphArray.length===0||isNaN(graphArray[0][1])){testResultHTML+="<div class = 'labs-no-graph-results'><span class='labs-warning-image'>&nbsp;</span>"+labsI18N.NODATA+"</div>";
graphHolder.hide();
graphDateRange.hide();
}else{if(differentUOM){testResultHTML+="<div class = 'labs-not-all-results'><span class='labs-warning-image'>&nbsp;</span>"+labsI18N.NOTALLDATA+"</div>";
}else{if(graphArray.length==1){testResultHTML+="<div class = 'labs-no-graph-results'><span class='labs-warning-image'>&nbsp;</span>"+labsI18N.SINGLEDATAPOINT+"</div>";
graphHolder.hide();
graphDateRange.hide();
}}}testResult.append(testResultHTML);
graphDateRange.append(graphDateHTML);
graphArray.reverse();
if(graphArray.length>0){this.setGraphData(graphArray);
this.plotLabGraph();
}else{this.setGraphData(null);
this.setLabPlot(null);
}this.m_clickedLabel=dataObj.RESULT_DATA.SECONDARY_GROUP_NAME;
};
LaboratoryComponentWF.prototype.queryTaggedResultsCallback=function(scriptReply,dataObj){var self=this;
var replyData=scriptReply.getResponse();
var individualResultSelector=".ddemrcontentitem";
var taggedResultsObject=$.parseHTML(replyData.XHTML_TEXT);
var selectedDataObjsList=self.getSelectedDataObjsList();
var selectedResultsLen=selectedDataObjsList.length;
$(taggedResultsObject).find(individualResultSelector).each(function(index,element){element=$(element);
var entityId=Number(element.attr("dd:entityid"));
for(var i=selectedResultsLen;
i--;
){var columnId=selectedDataObjsList[i].selectedResObj.COLUMN_ID;
var results=selectedDataObjsList[i].selectedResObj.RESULT_DATA.TIME_BUCKETS[columnId].OBJECT_ARR;
if(results.length){var resultObj=results[0];
if(entityId===resultObj.EVENT_ID){selectedDataObjsList[i].taggedStatus=true;
}}}});
var componentId=this.getComponentId();
var labsI18N=i18n.discernabu.laboratory_o2;
var criterion=this.getCriterion();
var resultObject=null;
var group=null;
var result=null;
var eventID=null;
var timeBucketResults=[];
var sidePanelHTML="";
var resultDetailsHTML="";
var resultValueHTML="";
var addResultValueHTML=[];
var resultCount=0;
var elementId=null;
if(!this.m_showPanel){this.m_tableContainer.addClass("labs-wf-side-panel-addition");
this.m_contentTableContainer.css("width",this.m_tableContainer.outerWidth()-200-this.m_scrollController.outerWidth()+"px");
this.m_sidePanelContainer.css("display","inline-block");
this.m_showPanel=true;
this.m_sidePanel.showPanel();
}if(selectedResultsLen===0){this.m_sidePanel.m_cornerCloseButton.trigger("click");
}else{if(selectedResultsLen===1){var results=dataObj.RESULT_DATA.TIME_BUCKETS[dataObj.COLUMN_ID].OBJECT_ARR;
resultCount=results.length;
if(resultCount===0&&dataObj.RESULT_DATA.TIME_BUCKETS[dataObj.COLUMN_ID].DISPLAY!=="--"){this.m_sidePanel.setActionsAsHTML("");
this.m_sidePanel.setTitleText("");
this.m_sidePanel.setSubtitleAsHTML("<div class='labs-wf-results-unknown labs-wf-results-unknown-icon'></div><div class='secondary-text labs-wf-results-unknown-text'>"+i18n.discernabu.LIMITED_RESULTS+"</div>");
sidePanelHTML=" ";
}else{resultObject=selectedDataObjsList[0].selectedResObj;
var taggedStatus=selectedDataObjsList[0].taggedStatus;
group=resultObject.RESULT_DATA;
timeBucketResults=group.TIME_BUCKETS[resultObject.COLUMN_ID].OBJECT_ARR;
var resultCnt=timeBucketResults.length;
addResultValueHTML.push("<div class = 'sp-separator2'>&nbsp;</div><dl><dd><div class='secondary-text'>"+labsI18N.ADDITIONAL_RESULTS+"</div>");
for(var x=0;
x<resultCnt;
x++){result=timeBucketResults[x];
eventID=result.EVENT_ID;
resultObjInfo={EVENT_ID:eventID,NAME:resultObject.RESULT_DATA.SECONDARY_GROUP_NAME};
elementId="WF_LAB"+componentId+"result"+result.RESULT;
this.m_panelElementData[elementId]=resultObjInfo;
if(x===0){resultValueHTML="<div id = 'WF_LAB"+componentId+"sidePanelResultList'><span class="+result.NORMALCY_CLASS+"><span class='res-ind'></span>";
resultValueHTML+="<span class='res-val lab-res-val-selectable' id='"+elementId+"'>"+result.RES_MOD_DISPLAY+result.RESULT+"&nbsp;"+result.UOM;
if(result.HAS_COMMENTS_IND){resultValueHTML+=result.COMMENTS_IND;
}resultValueHTML+=result.MODIFIED_IND+"</div>";
var status=result.STATUS||"--";
var normalLow=result.NLOW||"--";
var normalHigh=result.NHIGH||"--";
var criticalLow=result.CLOW||"--";
var criticalHigh=result.CHIGH||"--";
resultDetailsHTML+="<dl><dd class='lab-res-add-info'><div class='secondary-text'>"+labsI18N.DATE_TIME+"</div><div>"+this.formatDate(result.DTTM)+"</div></dd>";
resultDetailsHTML+="<dd class='lab-res-add-info'><div class='secondary-text'>"+labsI18N.STATUS+"</div><div>"+status+"</div></dd>";
resultDetailsHTML+="<dd class='lab-res-add-info'><div class='secondary-text'>"+labsI18N.NORMAL_LOW+"</div><div>"+normalLow+"</div></dd>";
resultDetailsHTML+="<dd class='lab-res-add-info'><div class='secondary-text'>"+labsI18N.NORMAL_HIGH+"</div><div>"+normalHigh+"</div></dd>";
resultDetailsHTML+="<dd class='lab-res-add-info'><div class='secondary-text'>"+labsI18N.CRITICAL_LOW+"</div><div>"+criticalLow+"</div></dd>";
resultDetailsHTML+="<dd class='lab-res-add-info'><div class='secondary-text'>"+labsI18N.CRITICAL_HIGH+"</div><div>"+criticalHigh+"</div></dd></dl>";
}else{var modifiedDisplay=(result.STATUS_MEAN==="MODIFIED"||result.STATUS_MEAN==="ALTERED")?"<span class='res-modified'>&nbsp</span>":"";
addResultValueHTML.push("<dl><dd><span class='",result.NORMALCY_CLASS,"'><span class='res-ind'>&nbsp;</span>",result.RES_MOD_DISPLAY,result.RESULT," ",result.UOM,"</span>");
if(result.HAS_COMMENTS_IND){addResultValueHTML.push(result.COMMENTS_IND);
}addResultValueHTML.push(modifiedDisplay,"</dd></dl>");
}}var sidePanelContentHtml=resultDetailsHTML;
if(addResultValueHTML.length>1){addResultValueHTML.push("</dd></dl>");
sidePanelContentHtml+=addResultValueHTML.join("");
}sidePanelHTML="<div id='sidePanelScrollContainer"+componentId+"' class='lab-wf-side-panel-result-list'>"+sidePanelContentHtml+"</div>";
if(MP_TaggingHandler.isTaggingAvailable()){if(taggedStatus){$(this).removeClass("add-results-to-tagged-list");
this.m_sidePanel.setActionsAsHTML("<div id='WF_LAB"+componentId+"tagButton' class='sp-button2 add-results-to-tagged-list'>"+labsI18N.REMOVE_TAG+"</div>");
}else{this.m_sidePanel.setActionsAsHTML("<div id='WF_LAB"+componentId+"tagButton' class='sp-button2'>"+labsI18N.TAG+"</div>");
}}this.m_sidePanel.setTitleText(resultObject.RESULT_DATA.SECONDARY_GROUP_NAME);
this.m_sidePanel.setSubtitleAsHTML(resultValueHTML);
}}else{resultDetailsHTML+="<dl><dd class='lab-mul-res-info'><div class='lab-mul-res-label-title secondary-text'>"+labsI18N.RESULTS_NAME+"</div><div class='lab-mul-res-text-title secondary-text'>"+labsI18N.RESULTS_VALUE+"</div><div class='lab-mul-res-text-title secondary-text'>"+labsI18N.DATE_TIME+"</div></dd>";
var countItemsSelected=0;
for(var i=0;
i<selectedResultsLen;
i++){resultObject=selectedDataObjsList[i].selectedResObj;
group=resultObject.RESULT_DATA;
var groupName=group.SECONDARY_GROUP_NAME;
timeBucketResults=group.TIME_BUCKETS[resultObject.COLUMN_ID].OBJECT_ARR;
resultCount=timeBucketResults.length;
if(resultCount===0){var resultElem=selectedDataObjsList[i].selectedElem;
$(resultElem).removeClass("lab-selected-res-tagging");
}else{countItemsSelected++;
result=timeBucketResults[0];
eventID=result.EVENT_ID;
resultObjInfo={EVENT_ID:eventID,NAME:resultObject.RESULT_DATA.SECONDARY_GROUP_NAME};
elementId="WF_LAB"+componentId+"result"+result.RESULT;
this.m_panelElementData[elementId]=resultObjInfo;
resultValueHTML="<div id = 'WF_LAB"+componentId+"sidePanelResultList'><span class="+result.NORMALCY_CLASS+"><span class='res-ind'></span>";
resultValueHTML+="<span class='res-val lab-res-val-selectable' id='"+elementId+"'>"+result.RES_MOD_DISPLAY+result.RESULT+"&nbsp;"+result.UOM;
if(result.HAS_COMMENTS_IND){resultValueHTML+=result.COMMENTS_IND;
}resultValueHTML+=result.MODIFIED_IND+"</div>";
resultDetailsHTML+="<dd class='lab-mul-res-info'><div class='lab-mul-res-label'>"+groupName+"</div><div class='lab-mul-res-text'>"+resultValueHTML+"</div><div class='lab-mul-res-text'>"+this.formatDate(result.DTTM)+"</div></dd>";
}}resultDetailsHTML+="<dl>";
sidePanelHTML+="<div id='sidePanelScrollContainer"+componentId+"' class='lab-wf-side-panel-result-list'>"+resultDetailsHTML+"</div>";
var tagButtonLabel=labsI18N.REMOVE_TAG;
var tagButtonClass="sp-button2 add-results-to-tagged-list";
$.each(selectedDataObjsList,function(index){if(!selectedDataObjsList[index].hasOwnProperty("taggedStatus")){tagButtonLabel=labsI18N.TAG;
tagButtonClass="sp-button2";
return false;
}});
if(MP_TaggingHandler.isTaggingAvailable()){this.m_sidePanel.setActionsAsHTML("<div id='WF_LAB"+componentId+"tagButton' class='sp-button2'>"+tagButtonLabel+"</div>");
}this.m_sidePanel.setTitleText(countItemsSelected+" "+labsI18N.ITEMS_SELECTED);
this.m_sidePanel.setSubtitleText("");
}}this.m_sidePanel.setContents(sidePanelHTML,"WF_LABContentRes"+componentId);
this.addClickToSidePanelResults(dataObj);
this.addClickExpandCollapse();
this.addClickToTagButton();
};
LaboratoryComponentWF.prototype.setPanelContentsToSelectedResultCell=function(dataObj){try{var self=this;
var criterion=this.getCriterion();
var userId=criterion.provider_id;
var patientId=criterion.person_id;
var encounterId=criterion.encntr_id;
var pprCode=criterion.ppr_cd;
var params=["^MINE^",userId+".0",patientId+".0",encounterId+".0",pprCode+".0"];
var tagRequest=new ScriptRequest();
tagRequest.setProgramName("MP_QUERY_TAGGED_RESULTS");
tagRequest.setParameterArray(params);
tagRequest.setResponseHandler(function(scriptReply){self.queryTaggedResultsCallback(scriptReply,dataObj);
});
tagRequest.performRequest();
}catch(error){logger.logJSError(error,null,"laboratory_o2.js","setPanelContentsToSelectedResultCell");
}};
LaboratoryComponentWF.prototype.addClickToSidePanelResults=function(dataObj){var compID=this.getComponentId();
var criterion=this.getCriterion();
var category_mean=criterion.category_mean;
var capTimer=null;
$("#WF_LAB"+compID+"sidePanelResultList").on("click",".res-val",function(event){try{results=dataObj.RESULT_DATA.TIME_BUCKETS[dataObj.COLUMN_ID].OBJECT_ARR;
resultCnt=results.length;
var resultName=results[0].DISPLAY_NAME;
var eventIdArray=[];
for(var y=0;
y<resultCnt;
y++){eventIdArray[y]=results[y].EVENT_ID;
}var formatResName=resultName?(resultName).replace(/'/g,"&#39"):"";
ResultViewer.launchAdHocViewer(eventIdArray,formatResName);
capTimer=new CapabilityTimer("CAP:MPG Labs O2 View Result",category_mean);
if(capTimer){capTimer.addMetaData("rtms.legacy.metadata.1",viewName);
capTimer.capture();
}}catch(err){logger.logJSError(err,null,"labs_o2.js","addClickToSidePanelResults");
}});
};
LaboratoryComponentWF.prototype.addClickToResults=function(){var self=this;
var compID=this.getComponentId();
var criterion=this.getCriterion();
var personId=criterion.person_id;
var category_mean=criterion.category_mean;
var capTimer=null;
$("#WF_LAB"+compID+"sidePanelResultList").on("click",".res-val",function(event){var results={};
var target_id=event.target.id;
try{results=self.m_panelElementData[target_id];
if(results){ResultViewer.launchAdHocViewer(results.EVENT_ID,results.NAME);
capTimer=new CapabilityTimer("CAP:MPG Labs O2 View Result",category_mean);
capTimer.addMetaData("rtms.legacy.metadata.1","Ambulatory Side Panel");
capTimer.capture();
}}catch(err){logger.logJSError(err,null,"labs_o2.js","addClickToResults");
}});
};
LaboratoryComponentWF.prototype.addClickExpandCollapse=function(graphHeight){var self=this;
self.m_sidePanel.expandSidePanel=function(){if(!this.m_sidePanelObj.hasClass("sp-focusin")){this.m_expCollapseBarObj.removeClass("hidden");
this.m_parentContainer.css({position:"absolute"});
this.m_sidePanelObj.addClass("sp-focusin");
this.m_expCollapseIconObj.addClass("sp-collapse").removeClass("sp-expand");
}this.m_previousMinHeight=this.m_minHeight;
var heightVal=parseInt(this.m_height,10);
var minHeightVal=parseInt(this.m_minHeight,10);
if(heightVal>minHeightVal){this.setMinHeight(this.m_height);
}this.m_scrollContainer.css("max-height","");
var titleHeight=null;
var bodyContentHeight=this.m_sidePanelBodyContents[0].offsetHeight;
titleHeight=this.m_sidePanelContents.height()-bodyContentHeight;
this.m_sidePanelObj.css({height:"auto"});
var scrollMaxHeight=(this.m_sidePanelObj.height()-titleHeight)+1;
if(graphHeight&&graphHeight!==null&&graphHeight!==undefined){scrollMaxHeight=scrollMaxHeight-graphHeight;
}this.m_scrollContainer.css("max-height",scrollMaxHeight+"px");
if(scrollMaxHeight===this.m_scrollContainer.height()){this.m_scrollContainer.addClass("sp-add-scroll");
}if(this.m_onExpandFunc){this.m_onExpandFunc();
}};
};
LaboratoryComponentWF.prototype.addClickToTagButton=function(){var self=this;
var compID=self.getComponentId();
var selectedDataObjsList=self.getSelectedDataObjsList();
var selectedResLen=selectedDataObjsList.length;
$("#WF_LAB"+compID+"tagButton").on("click",function(event){if($(this).hasClass("add-results-to-tagged-list")){$(this).removeClass("add-results-to-tagged-list");
var deleteList={DELETE_TAG:{TAG_LIST:[]}};
for(var i=selectedResLen;
i--;
){var result=selectedDataObjsList[i].selectedResObj;
var columnId=result.COLUMN_ID;
var results=result.RESULT_DATA.TIME_BUCKETS[columnId].OBJECT_ARR;
if(results.length){var resultObj=results[0];
deleteList.DELETE_TAG.TAG_LIST.push({contentType:"LABS",entityId:resultObj.EVENT_ID+".0"});
}}MP_TaggingHandler.deleteTaggedResults(deleteList);
$(this).html(i18n.discernabu.laboratory_o2.TAG);
}else{$(this).addClass("add-results-to-tagged-list");
self.tagResult(selectedDataObjsList);
$(this).html(i18n.discernabu.laboratory_o2.REMOVE_TAG);
}});
};
LaboratoryComponentWF.prototype.contentTableCellClickHandler=function(event,dataObj){var criterion=this.getCriterion();
var compID=this.getComponentId();
var contextMenu=null;
var results=[];
var resultCnt=0;
var self=this;
var tagResultSelection=null;
var x=0;
var category_mean=criterion.category_mean;
var capTimer=null;
var viewName=this.m_showAmbulatoryView?"Ambulatory View":"Flowsheet View";
try{results=dataObj.RESULT_DATA.TIME_BUCKETS[dataObj.COLUMN_ID].OBJECT_ARR;
resultCnt=results.length;
if(resultCnt===0&&dataObj.RESULT_DATA.TIME_BUCKETS[dataObj.COLUMN_ID].DISPLAY==="--"){return;
}var targetElem=event.target;
if(!targetElem){return;
}targetElem=$(targetElem).closest($(".labs-wf-content-col"));
if(event.which===3||event.button===2){self.selectTargetResultCell(targetElem,dataObj);
if(MP_TaggingHandler.isTaggingAvailable()&&!CERN_BrowserDevInd){$("body .mpage-tooltip").remove();
contextMenu=MP_MenuManager.getMenuObject("LabsWFContextMenu");
if(!contextMenu){contextMenu=new ContextMenu("LabsWFContextMenu").setIsRootMenu(true).setAnchorElementId("LabsWFContextMenuAnchor").setAnchorConnectionCorner(["bottom","left"]).setContentConnectionCorner(["top","left"]);
tagResultSelection=new MenuSelection("tagResult").setLabel(i18n.discernabu.laboratory_o2.TAG).setIsSelected(true).setSelectedClass("labs-wf-tag-icon");
contextMenu.addMenuItem(tagResultSelection);
MP_MenuManager.addMenuObject(contextMenu);
}tagResultSelection=contextMenu.getMenuItemArray()[0];
tagResultSelection.setClickFunction(function(){var selectedDataObjsList=self.getSelectedDataObjsList();
self.tagResult(selectedDataObjsList);
var tagButtonElement=$("#WF_LAB"+compID+"tagButton");
if(tagButtonElement.hasClass("add-results-to-tagged-list")){tagButtonElement.html(i18n.discernabu.laboratory_o2.REMOVE_TAG);
}else{tagButtonElement.addClass("add-results-to-tagged-list");
tagButtonElement.html(i18n.discernabu.laboratory_o2.REMOVE_TAG);
}});
contextMenu.setXOffset(event.pageX).setYOffset(event.pageY).setAnchorElement();
MP_MenuManager.showMenu("LabsWFContextMenu");
contextMenu.removeAnchorElement();
}}else{if(event.target.nodeName.toUpperCase()==="SPAN"&&!self.SIDE_PANEL_AVAILABLE){targetElem=event.target;
var encntrId=criterion.encntr_id;
var personId=criterion.person_id;
var resultName=results[0].DISPLAY_NAME;
var eventIdArray=[];
for(var y=0;
y<resultCnt;
y++){eventIdArray[y]=results[y].EVENT_ID;
}var formatResName=resultName?(resultName).replace(/'/g,"&#39"):"";
ResultViewer.launchAdHocViewer(eventIdArray,formatResName);
capTimer=new CapabilityTimer("CAP:MPG Labs O2 View Result",category_mean);
capTimer.addMetaData("rtms.legacy.metadata.1",viewName);
capTimer.capture();
}else{self.m_tableContainer.disableSelection();
if(event.shiftKey){self.selectTargetResultCell(targetElem,dataObj);
var selectedDataObjsList=self.getSelectedDataObjsList();
var firstSelectedRes=selectedDataObjsList[0];
var lastSelectedRes=selectedDataObjsList[selectedDataObjsList.length-1];
self.highlightSelectedRow(false,false,false);
self.multipleResultSelection(self.m_componentTable,firstSelectedRes,lastSelectedRes);
}else{if(event.ctrlKey){if($(targetElem).hasClass("lab-selected-res-tagging")){self.deselectTargetResultCell(targetElem);
}else{self.selectTargetResultCell(targetElem,dataObj);
}}else{self.highlightSelectedRow(false,false,false);
self.selectTargetResultCell(targetElem,dataObj);
}}if(self.SIDE_PANEL_AVAILABLE){self.setPanelContentsToSelectedResultCell(dataObj);
}}}}catch(err){logger.logJSError(err,null,"laboratory_o2.js","contentTableCellClickHandler");
}};
LaboratoryComponentWF.prototype.createResultHover=function(dataObj){var additionalClass="";
var dateResult=null;
var group=null;
var hoverHTML=[];
var labsI18N=i18n.discernabu.laboratory_o2;
var moreHoverHTML=[];
var result=null;
var resultCnt=0;
var timeBucketResults=[];
var x=0;
group=dataObj.RESULT_DATA;
timeBucketResults=group.TIME_BUCKETS[dataObj.COLUMN_ID].OBJECT_ARR;
resultCnt=timeBucketResults.length;
if(resultCnt===0){if(group.TIME_BUCKETS[dataObj.COLUMN_ID].DISPLAY.indexOf("labs-wf-results-unknown")>=0){return"<div class='hvr labs-wf-hover'>"+i18n.discernabu.LIMITED_RESULTS+"</div>";
}return null;
}hoverHTML.push("<div class='hvr labs-wf-hover'>");
moreHoverHTML.push("<div class='labs-wf-hover-additional'><div>"+labsI18N.ADDITIONAL_RESULTS+"</div><dl>");
additionalClass=(resultCnt>1)?"labs-wf-hover-seperator":"";
for(x=0;
x<resultCnt;
x++){result=timeBucketResults[x];
if(x===0){hoverHTML.push("<div class='labs-wf-hover-main ",additionalClass,"'><dl><dt><span>",result.RESULT_NAME,":</span></dt><dd><span class='",result.NORMALCY_CLASS,"'>",result.RES_MOD_DISPLAY,result.RESULT," ",result.UOM,"</span>",result.MODIFIED_IND,"</dd><dt><span>",labsI18N.DATE_TIME,":</span></dt><dd><span>",this.formatDate(result.DTTM),"</span></dd><dt><span>",labsI18N.STATUS,":</span></dt><dd><span>",result.STATUS||"--","</span></dd><dt><span>",labsI18N.NORMAL_LOW,":</span></dt><dd><span>",result.NLOW||"--","</span></dd><dt><span>",labsI18N.NORMAL_HIGH,":</span></dt><dd><span>",result.NHIGH||"--","</span></dd><dt><span>",labsI18N.CRITICAL_LOW,":</span></dt><dd><span>",result.CLOW||"--","</span></dd><dt><span>",labsI18N.CRITICAL_HIGH,":</span></dt><dd><span>",result.CHIGH||"--","</span></dd></dl></div>");
}else{this.formatResult(result);
modifiedDisplay=(result.STATUS_MEAN==="MODIFIED"||result.STATUS_MEAN==="ALTERED")?"<span class='res-modified'>&nbsp</span>":"";
moreHoverHTML.push("<dd><span class='",result.NORMALCY_CLASS,"'><span class='res-ind'>&nbsp;</span>",result.RES_MOD_DISPLAY,result.RESULT," ",result.UOM,"</span>",modifiedDisplay,"</dd>");
}}if(moreHoverHTML.length>1){moreHoverHTML.push("</div>");
hoverHTML.push(moreHoverHTML.join(""));
}hoverHTML.push("</dl></div>");
return hoverHTML.join("");
};
LaboratoryComponentWF.prototype.renderComponent=function(recordData){var column=null;
var columnWidth=this.m_minColumnWidth;
var compId=this.getStyles().getId();
var contentTable=null;
var contentTableContainer=null;
var contentTableWidth=this.calculateContentTableWidth();
var contextMenuControl="";
var disclaimerMessage="";
var sidePanelHTML="";
var labelTableHTML="";
var contentTableHTML="";
var wholeCompHTML="";
var groupCnt=null;
var hoverExtension=null;
var infoButtonActiveClass=this.isInfoButtonEnabled()?"labs-wf-info-button-active":"";
var labelTable=null;
var labelTableContainer=null;
var pixelBuffer=this.m_pixelBuffer;
var scrollController=null;
var showAmbulatoryView=this.getShowAmbulatoryView();
var self=this;
var timeBucketCnt=0;
var x=0;
var resultViewerTimer=null;
try{if(!recordData.PG.length){this.finalizeComponent(MP_Util.HandleNoDataResponse(this.getStyles().getNameSpace()));
return;
}this.processData(recordData);
labelTable=new ComponentTable().setNamespace(this.getStyles().getId()+"Labels").setCustomClass("labs-wf-table");
if(!showAmbulatoryView){labelTable.addColumn(new TableColumn().setColumnId("labelCol").setColumnDisplay("&nbsp;<br />&nbsp;").setCustomClass("labs-wf-label-col").setRenderTemplate('<span class="labs-wf-info-button">&nbsp;</span><span class="labs-wf-sub-sec-name" title="${SECONDARY_GROUP_NAME}">${SECONDARY_GROUP_NAME}</span>'));
labelTable.addColumn(new TableColumn().setColumnId("uomCol").setColumnDisplay("&nbsp;<br />&nbsp;").setCustomClass("labs-wf-uom-col").setRenderTemplate('<span title="${FIRST_RES_UOM}" class="labs-wf-result-uom">${FIRST_RES_UOM}</span>'));
}else{labelTable.addColumn(new TableColumn().setColumnId("labelCol").setColumnDisplay("&nbsp;").setCustomClass("labs-wf-label-col").setRenderTemplate('<span class="labs-wf-info-button">&nbsp;</span><span title="${SECONDARY_GROUP_NAME}"'+(self.getDateFormat()!==4?' class="labs-wf-sub-sec-name"':"")+'>${SECONDARY_GROUP_NAME}</span><br /><span class="labs-wf-result-uom">${FIRST_RES_UOM}</span>'));
}labelTable.addExtension(new TableGroupToggleCallbackExtension().setGroupToggleCallback(function(event,data){if(data.GROUP_DATA.EXPANDED){contentTable.openGroup(data.GROUP_DATA.GROUP_ID);
}else{contentTable.collapseGroup(data.GROUP_DATA.GROUP_ID);
}self.resizeComponent();
}));
labelTable.addExtension(new TableCellClickCallbackExtension().setCellClickCallback(function(event,data){self.labelTableCellClickHandler(event,data);
}));
this.setLabelTable(labelTable);
contentTable=new ComponentTable().setNamespace(this.getStyles().getId()+"Content").setCustomClass("labs-wf-table");
contentTable.addExtension(new TableGroupToggleCallbackExtension().setGroupToggleCallback(function(event,data){self.toggleLabelTableExtension(event,data);
}));
hoverExtension=new TableCellHoverExtension();
contentTable.addExtension(hoverExtension);
contentTable.addExtension(new TableCellClickCallbackExtension().setCellClickCallback(function(event,data){self.contentTableCellClickHandler(event,data);
}));
timeBucketCnt=recordData.TG.length;
if(contentTableWidth>(timeBucketCnt*columnWidth)){columnWidth=Math.floor(contentTableWidth/timeBucketCnt);
}if(!showAmbulatoryView){for(x=0;
x<timeBucketCnt;
x++){column=this.createTableColumn(recordData.TG[x]).setWidth(columnWidth);
if(!this.SIDE_PANEL_AVAILABLE){hoverExtension.addHoverForColumn(column,function(dataObj){return self.createResultHover(dataObj);
});
}contentTable.addColumn(column);
}}else{var resultTimeBucket=recordData.PG[0].RG[0].TIME_BUCKETS;
if(resultTimeBucket){for(x=0;
x<this.m_ambulatoryColumnCount;
x++){column=this.createAmbulatoryViewColumn(x,resultTimeBucket).setWidth(columnWidth);
if(!this.SIDE_PANEL_AVAILABLE){hoverExtension.addHoverForColumn(column,function(dataObj){return self.createResultHover(dataObj);
});
}contentTable.addColumn(column);
}}}groupCnt=recordData.PG.length;
for(x=0;
x<groupCnt;
x++){labelTable.addGroup(this.createTableGroup(recordData.PG[x],true));
contentTable.addGroup(this.createTableGroup(recordData.PG[x],false));
}contextMenuControl=(MP_TaggingHandler.isTaggingAvailable())?"oncontextmenu='return false;'":"";
var tableContainerClass="labs-wf-table-container";
if(this.m_showingLatestResults&&!showAmbulatoryView){disclaimerMessage="<div class='labs-wf-disclaimer'>"+this.createDisclaimerMessage()+"</div>";
}if(this.SIDE_PANEL_AVAILABLE){sidePanelHTML+="<div id ='"+compId+"sidePanelContainer' class='labs-wf-side-panel'>&nbsp;</div>";
}if(showAmbulatoryView){tableContainerClass+=" labs-wf-ambulatory-table";
}labelTableHTML=labelTable.render();
this.m_componentTable=contentTable;
contentTableHTML=contentTable.render();
wholeCompHTML="<div id='"+compId+"TableContainer' class='"+tableContainerClass+"'><div id='"+compId+"LabelTableContainer' class='labs-wf-label-table "+infoButtonActiveClass+"'>"+labelTableHTML+"</div><div id='"+compId+"ContentTableContainer' class='labs-wf-content-table' "+contextMenuControl+">"+contentTableHTML+"</div><div id='"+compId+"ScrollController' class='labs-wf-scroll-controller-hidden'><span class='labs-wf-scroller-content'>&nbsp;</span></div></div>"+sidePanelHTML+disclaimerMessage;
this.finalizeComponent(wholeCompHTML);
contentTableContainer=$("#"+compId+"ContentTableContainer");
this.m_contentTableWidth=0;
contentTableWidth=this.calculateContentTableWidth();
contentTableContainer.width(contentTableWidth);
contentTableContainer.find("#"+compId+"Contenttable").width(timeBucketCnt*columnWidth+pixelBuffer);
contentTableContainer.find(".sub-sec-hd-tgl").addClass("labs-wf-content-sub-sec-tgl");
contentTableContainer.find(".labs-wf-first-content-col").css("padding-left",6);
contentTableContainer.find(".result-info").each(function(index){$(this).children().attr("rowIndex",index).addClass("rowIndex"+compId+index);
$(this).find(".table-cell").each(function(colInd){$(this).attr("colIndex",colInd).addClass("colIndex"+compId+colInd);
});
});
labelTable.finalize();
this.m_tableContainer=$("#"+compId+"TableContainer");
this.m_labelTableContainer=$("#"+compId+"LabelTableContainer");
this.m_labelTableBody=this.m_labelTableContainer.find(".content-body");
this.m_contentTableContainer=contentTableContainer;
this.m_contentTableBody=this.m_contentTableContainer.find(".content-body");
this.m_contentTableContents=this.m_contentTableBody.find(":first-child");
this.m_scrollController=$("#"+compId+"ScrollController");
this.m_tableReferencesSet=true;
this.m_contentTableContainer.find(".labs-wf-results-unknown").parent().addClass("labs-wf-unknown-parent");
this.m_tableContainer.on("mousewheel",function(event){return self.scrollTables(event);
});
this.m_scrollController.scroll(function(event){self.scrollTables(event);
});
this.toggleButtonHover.call();
if(this.SIDE_PANEL_AVAILABLE){this.initializeSidePanel();
var firstRowResultObject=recordData.PG[0].RG[0];
firstRowResultObject.RESULT_DATA=firstRowResultObject;
}else{$(".labs-wf-content-col span").hover(function(){$(this).addClass("labs-wf-content-col-ie-low-version");
});
}resultViewerTimer=new CapabilityTimer("CAP:MPG Laboratory O2 View Type",this.criterion.category_mean);
if(resultViewerTimer){if(showAmbulatoryView===true){resultViewerTimer.addMetaData("rtms.legacy.metadata.1","Ambulatory View");
}else{resultViewerTimer.addMetaData("rtms.legacy.metadata.1","Flowsheet View");
}resultViewerTimer.capture();
}}catch(err){logger.logJSError(err,this,"laboratory_o2.js","renderComponent");
throw (err);
}finally{}};
LaboratoryComponentWF.prototype.postProcessing=function(){MPageComponent.prototype.postProcessing.call(this);
CERN_EventListener.addListener(this,EventListener.EVENT_CLINICAL_EVENT,this.retrieveComponentData,this);
};
LaboratoryComponentWF.prototype.highlightSelectedRow=function(selRowLabelObj,selRowResultsObj,isInitialLoad){try{this.clearSelectedResults();
var compID=this.getComponentId();
var rowLabelID="";
var rowResultID="";
if(selRowLabelObj){var labelParts=selRowLabelObj.id.split(":");
for(var i=0;
i<labelParts.length;
i++){rowLabelID+=labelParts[i];
if((i+1)!==labelParts.length){rowLabelID+="\\:";
}}var resultParts=selRowResultsObj.id.split(":");
for(i=0;
i<resultParts.length;
i++){rowResultID+=resultParts[i];
if((i+1)!==resultParts.length){rowResultID+="\\:";
}}}var tableViewObj=$("#WF_LAB"+compID+"TableContainer");
var prevRow=tableViewObj.find(".selected");
if(prevRow.length){if(prevRow.hasClass("labs-wf-selected-row selected")){prevRow.removeClass("labs-wf-selected-row selected");
}if(prevRow.hasClass("labs-wf-selected-row-init selected")){prevRow.removeClass("labs-wf-selected-row-init selected");
}}var newClass="labs-wf"+(isInitialLoad?"-selected-row-init":"-selected-row")+" selected";
$("#"+rowLabelID).addClass(newClass);
$("#"+rowResultID).addClass(newClass);
}catch(err){logger.logJSError(err,this,"laboratory_o2.js","highlightSelectedRow");
}};
LaboratoryComponentWF.prototype.initializeSidePanel=function(){var self=this;
var compID=this.getComponentId();
var sidePanelContId="WF_LAB"+compID+"sidePanelContainer";
this.m_sidePanelContainer=$("#"+sidePanelContId);
var tableHeight=$("#WF_LAB"+compID+"TableContainer").css("height");
var sidePanelHTML="<div id='WF_LAB"+compID+"sidePanelResultsContainer'><div id='WF_LAB"+compID+"sidePanelGroupName' class='labs-wf-side-panel-groupname'>&nbsp;</div><div id='sidePanelScrollContainer"+compID+"'><div class='labs-wf-section-separator'><div class='labs-wf-title-text'>"+i18n.discernabu.laboratory_o2.RESULTS+"</div><div class='sp-separator'>&nbsp;</div></div><div id='WF_LAB"+compID+"sidePanelResultList' class='labs-wf-side-panel-result-list'>&nbsp;</div></div></div>";
if(this.m_sidePanelContainer.length){this.m_sidePanel=new CompSidePanel(compID,sidePanelContId);
this.m_sidePanel.setExpandOption(this.m_sidePanel.expandOption.EXPAND_DOWN);
this.m_sidePanel.setHeight(tableHeight);
this.m_sidePanel.setMinHeight(this.m_sidePanelMinHeight);
this.m_sidePanel.renderPreBuiltSidePanel();
this.m_sidePanel.showCornerCloseButton();
this.m_sidePanel.setCornerCloseFunction(function(){self.m_tableContainer.removeClass("labs-wf-side-panel-addition");
self.highlightSelectedRow(false,false);
self.m_showPanel=false;
self.m_clickedLabel=null;
self.m_sidePanelContainer.removeAttr("style");
self.resizeComponent();
});
}};
MP_Util.setObjectDefinitionMapping("WF_LAB",LaboratoryComponentWF);
