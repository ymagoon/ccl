function RadiationOncologyStyle(){this.initByNamespace("onc-rad");
}RadiationOncologyStyle.inherits(ComponentStyle);
function RadiationOncology(a){this.setCriterion(a);
this.setStyles(new RadiationOncologyStyle);
this.setComponentLoadTimerName("USR:MPG.RADIATION_ONCOLOGY.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.RADIATION_ONCOLOGY.O1 - render component");
this.setScope(1);
this.m_docImagesInd=!0;
this.recordData=null;
this.setLookBackDropDown(!0);
this.m_docBedrockFilter=this.m_resBedrockFilter=!1;
}RadiationOncology.prototype=new MPageComponent;
RadiationOncology.prototype.constructor=MPageComponent;
RadiationOncology.inherits(MPageComponent);
RadiationOncology.prototype.loadFilterMappings=function(){MPageComponent.prototype.loadFilterMappings.call(this);
this.addFilterMappingObject("ONC_RAD_IMG_IND",{setFunction:this.setDocImagesInd,type:"BOOLEAN",field:"FREETEXT_DESC"});
};
RadiationOncology.prototype.getDocImagesInd=function(){return this.m_docImagesInd;
};
RadiationOncology.prototype.setDocImagesInd=function(a){this.m_docImagesInd=1==a?!0:!1;
};
RadiationOncology.prototype.setAllData=function(a){this.recordData=a;
};
RadiationOncology.prototype.getAllData=function(){return this.recordData;
};
RadiationOncology.prototype.setResBedrcokFltrStatus=function(a){this.m_resBedrockFilter=a;
};
RadiationOncology.prototype.getResBedrcokFltrStatus=function(){return this.m_resBedrockFilter;
};
RadiationOncology.prototype.setDocBedrcokFltrStatus=function(a){this.m_docBedrockFilter=a;
};
RadiationOncology.prototype.getDocBedrcokFltrStatus=function(){return this.m_docBedrockFilter;
};
RadiationOncology.prototype.retrieveComponentData=function(){for(var a=[],h=this.getCriterion(),d="0.0",b="0.0",i=2===this.getScope()?h.encntr_id+".0":"0.0",c=this.getGroups(),f=c?c.length:0;
f--;
){var j=c[f];
switch(j.getGroupName()){case"ONC_RAD_RES_DOC":this.setResBedrcokFltrStatus(!0);
d=MP_Util.CreateParamArray(j.getEventSets(),1);
break;
case"ONC_RAD_CLIN_DOC":this.setDocBedrcokFltrStatus(!0),b=MP_Util.CreateParamArray(j.getEventSets(),1);
}}a.push("^MINE^",h.person_id+".0",i,h.provider_id+".0",h.ppr_cd+".0","100",d,b,this.getLookbackUnits(),this.getLookbackUnitTypeFlag());
a.push(this.getDocImagesInd()?1:0);
MP_Core.XMLCclRequestWrapper(this,"ONC_RAD_GET_RESULTS_DOCUMENTS",a,!0);
};
RadiationOncology.prototype.renderComponent=function(a){var h=i18n.oncology.onc_rad_results_documents,d=this.getCriterion(),b=this.getComponentId(),i=this.getStyles().getNameSpace(),c=new mp_formatter.DateTimeFormatter(MPAGE_LOCALE);
this.setAllData(a);
this.DocActiveList=[];
var f=MP_Util.CreateTimer("CAP:MPG.RADIATION_ONCOLOGY.O1 - render component");
f&&(f.SubtimerName=d.category_mean,f.Stop());
try{if(MP_Util.CreateTimer(this.getComponentRenderTimerName()),!1==this.getResBedrcokFltrStatus()&&!1==this.getDocBedrcokFltrStatus()){a=[],a.push("<div><h6><span class='res-none'>"+i18n.oncology.onc_rad_results_documents.SECTIONS_NOT_DEFINED+"</span></h6></div>"),MP_Util.Doc.FinalizeComponent(a.join(""),this,""),this.resizeComponent();
}else{var j=a.DOCS.length;
a.DOCS.sort(function(a,b){var e=new Date;
e.setISO8601(a.EFFECTIVE_DATE);
var c=new Date;
c.setISO8601(b.EFFECTIVE_DATE);
return e>c?-1:e<c?1:0;
});
for(d=0;
d<j;
d++){var g=f="",p=h.UNKNOWN,e=a.DOCS[d],k=e.PERSON_ID+".0",l=e.ENCNTR_ID+".0",m=e.EVENT_ID+".0",n=e.RESULT_STATUS_CD_MEAN,o=e.RESULT_STATUS_CD_DISP,q=e.EVENT_CD_DISP,s=e.PARENT_EVENT_ID+".0",w=e.VIEWER_TYPE,x=e.SUBJECT,A=e.IMAGE_URL,t=null,u=null,y=new Date;
e.EFFECTIVE_DT_TM?(y.setISO8601(e.EFFECTIVE_DATE),t=MP_Util.DisplayDateByOption(this,y),u=MP_Util.CalcWithinTime(y)):u=t=h.UNKNOWN;
for(var r,v=null,B=e.ACTION_PROVIDERS.length;
B--;
){var C=e.ACTION_PROVIDERS[B];
if(!v||C.DATE>v.DATE){v=C;
}}r=v;
for(var D,E=v=null,F=null,z=null,G=e.ACTION_PROVIDERS.length;
G--;
){if(z=e.ACTION_PROVIDERS[G],E=z.TYPE_CD_MEANING,F=z.STATUS_CD_MEANING,"PERFORM"===E&&"COMPLETED"===F){v=z;
break;
}}if(D=v){p=D.PRSNL_NAME;
}if(r&&""!==r.PRSNL_NAME){var f=r.PRSNL_NAME,H=new Date;
""!==r.DATE?(H.setISO8601(r.DATE),g=c.format(H,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_4YEAR)):g=h.UNKNOWN;
}else{f=h.UNKNOWN;
}var J=this.singleRowDocumentHTML({patId:k,enctrId:l,evntId:m,doc:q,viewerType:w,parentEventId:s,docStatusDisp:o,author:p,withinDateDos:u,dateOfService:t,lastPrsnlby:f,lastPrsnl:g,docSubject:x,docStatus:n,docImageUrl:A},b);
this.DocActiveList.push({CREATION_DATE:t,NOTE_TYPE:q,AUTHOR:p,HTML:J});
}this.filterRadDoc(b,0,0,a);
this.DisplaySortIndicator(b,32,i);
}}catch(I){throw MP_Util.LogJSError(I,this,"radiology-oncology.js","RenderComponent"),I;
}finally{}};
RadiationOncology.prototype.singleRowDocumentHTML=function(a,h){var d=MP_Util.GetCompObjById(h),b=d.getStyles().getNameSpace(),i=i18n.oncology.onc_rad_results_documents,c="",c=[];
c.push("<div>");
c.push("<dl class='"+b+"-info'><dd id='"+b+"-doc-cat-id' class='"+b+"-doc-cat'><span>",MP_Util.CreateClinNoteLink(a.patId,a.enctrId,a.evntId,a.doc,a.viewerType,a.parentEventId),"</span>");
("MODIFIED"===a.docStatus||"ALTERED"===a.docStatus)&&c.push("<span class='res-modified'>&nbsp;</span>");
c.push("</dd>");
c.push("<dd class='"+b+"-doc-auth'><span>",a.author,"</span></dd>");
3==d.getDateFormat()?c.push("<dd class='"+b+"-doc-dt'><span class='date-time'>",a.withinDateDos,"</span></dd>"):c.push("<dd class='"+b+"-doc-dt'><span class='date-time'>",a.dateOfService,"</span></dd>");
c.push("<dd class='"+b+"-image'>");
""!==a.docImageUrl?c.push("<a class='"+b+"-image-found' href='",'javascript:MPAGES_SVC_EVENT("'+a.docImageUrl+'",^MINE,'+a.patId+"^)","'>&nbsp;</a>","</dd></dl>"):c.push("&nbsp;","</dd></dl>");
c.push("<h4 class='det-hd'><span>",i.DOCUMENTATION_DETAILS,"</span></h4><div class='hvr hover'><dl><dt><span>",i.NAME,":</span></dt><dd><span>",a.doc,"</span></dd><dt><span>",i.SUBJECT,":</span></dt><dd><span>",a.docSubject,"</span></dd><dt><span>",i.STATUS,":</span></dt><dd><span>",a.docStatusDisp,"</span></dd><dt><span>",i.LAST_UPDATED,":</span></dt><dd><span>",a.lastPrsnl,"</span></dd><dt><span>",i.LAST_UPDATED_BY,":</span></dt><dd><span>",a.lastPrsnlby,"</span></dd></dl></div>");
c.push("</div>");
return c=c.join("");
};
RadiationOncology.prototype.filterRadDoc=function(a,h,d,b){var i=MP_Util.GetCompObjById(a),c=i18n.oncology.onc_rad_results_documents,f=[],j=[],g=[],p=[],e=i.getStyles().getNameSpace(),k=i.DocActiveList.length;
f.push(this.generateResultsHTML(a,h,d,b));
f.push("<div><span><h2 class='"+e+"-hdr-line'><span class='"+e+"-hdr-name'>"+c.DOCUMENTS+"</span></h2></span></div>");
if(i.getDocBedrcokFltrStatus()){if(0!=k){f.push("<div class='content-hdr'><dl id='"+e+"-doc-info-hdr"+a+"' class='"+e+"-doc-info-hdr hdr'><dd class='"+e+"-info-hdr-sortIcon "+e+"-doc-cat'><span>"+c.NOTE_TYPE+"</span></dd>","<dd class='"+e+"-info-hdr-sortIcon "+e+"-doc-auth' ><span>"+c.AUTHOR+"</span></dd><dd class='"+e+"-info-hdr-sortIcon "+e+"-doc-dt'><span>"+c.DATE+"</span></dd>");
3==i.getDateFormat()&&f.push("<dd class='"+e+"-doc-cat'><span>&nbsp;</span></dd><dd class='"+e+"-doc-auth'><span>&nbsp;</span></dd><dd class='"+e+"-doc-dt'><span>",c.WITHIN,"</span></dd>");
f.push("<dd class='"+e+"-image'><span>&nbsp;</span></dd></dl></div>");
f.push("<div class='",MP_Util.GetContentClass(i,k),"'>");
for(var l=0;
l<k;
l++){j=this.AddZebraStripeClass(i.DocActiveList[l].HTML,l),10>l&&g.push(j),p.push(j);
}d?(p.push("<a class='"+e+"-showlnk' href='#' onclick='RadiationOncology.prototype.ShowMoreClick("+a+","+h+", 0 );'>"+c.SHOW_LESS+"</a>"),f=f.concat(p)):(10<k&&g.push("<a class='"+e+"-showlnk' href='#' onclick='RadiationOncology.prototype.ShowMoreClick("+a+","+h+", 1 );'>"+c.SHOW_ALL+" ("+k+")</a>"),f=f.concat(g));
f.push("</div>");
}else{f.push("<div><h6><span class='res-none'>"+c.NO_RESULTS_FOUND+"</span></h6></div>");
}}else{f.push("<div><h6><span class='res-none'>"+c.SECTION_NOT_DEFINED+"</span></h6></div>");
}f.push("<br/>");
c=MP_Util.CreateTitleText(i,k);
MP_Util.Doc.FinalizeComponent(f.join(""),i,c);
i.resizeComponent();
CERN_EventListener.fireEvent(i,i,EventListener.EVENT_COUNT_UPDATE,{count:k});
this.AttachListeners(a,h,d,e,b);
};
RadiationOncology.prototype.AddZebraStripeClass=function(a,h){var d=a,b=$(a);
null!==b&&($(b[0]).addClass(h%2?"even":"odd"),d=b[0].outerHTML);
return d;
};
RadiationOncology.prototype.AttachListeners=function(a,h,d,b,i){var c=[];
c.push("#",b,"Content",a," ."+b+"-info-hdr-sortIcon");
b=c.join("");
$(b).each(function(b,c){$(c).click(function(){RadiationOncology.prototype.sortRadDocs(b,a,h,d,i);
return !1;
});
});
};
RadiationOncology.prototype.DisplaySortIndicator=function(a,h,d){a=_g(d+"-doc-info-hdr"+a);
d=Util.Style.g(d+"-info-hdr-sortIcon",a,"DD");
0===h||null===a||Util.Style.acss(d[Math.floor(h/10)-1],1===h%2?"ascend":"descend");
};
RadiationOncology.prototype.generateResultsHTML=function(a,h,d,b){function i(a,b){return a.getDateTime()>b.getDateTime()?-1:a.getDateTime()<b.getDateTime()?1:0;
}function c(a){if(a=(a=a.getNormalcy())?a.meaning:null){switch(a){case"CRITICAL":case"PANICHIGH":case"PANICLOW":case"EXTREMEHIGH":case"EXTREMELOW":return 1;
}}return 0;
}var f=MP_Util.GetCompObjById(a),j=f.getStyles().getNameSpace(),g=i18n.oncology.onc_rad_results_documents,p=new mp_formatter.DateTimeFormatter(MPAGE_LOCALE),e=[],k=[],l=[],m=MP_Util.LoadCodeListJSON(b.CODES),n=function(a,b){var e=c(a),d=c(b);
return e>d?-1:e<d?1:i(a,b);
},o=MP_Util.LoadPersonelListJSON(b.PRSNL),q=m,m=[];
q||(q=MP_Util.LoadCodeListJSON(b.CODES));
o||MP_Util.LoadPersonelListJSON(b.PRSNL);
for(var b=b.RESULTS,o=0,s=b.length;
o<s;
o++){var w=b[o];
if(0<w.CLINICAL_EVENTS.length){for(var x=0,A=w.CLINICAL_EVENTS.length;
x<A;
x++){for(var t=w.CLINICAL_EVENTS[x],u=0,y=t.MEASUREMENTS.length;
u<y;
u++){var r=new MP_Core.Measurement;
r.initFromRec(t.MEASUREMENTS[u],q);
m.push(r);
}}}}0<m.length&&(n?m.sort(n):m.sort(i));
n=m.length;
e.push("<div><span><h2 class='"+j+"-hdr-line'><span class='"+j+"-hdr-name'>"+g.RESULTS+"</span></h2></span></div>");
if(f.getResBedrcokFltrStatus()){if(0!=n){e.push("<div class='content-hdr'><dl class='"+j+"-rslt-info-hdr hdr'><dd class='"+j+"-rslt-name'><span>"+g.DETAILS+"</span></dd>","<dd class='"+j+"-rslt-res' ><span>"+g.RESULT+"</span></dd><dd class='"+j+"-rslt-dt'><span>"+g.DATE_TIME+"</span></dd></div>");
e.push("<div class='",MP_Util.GetContentClass(f,n),"'>");
for(f=0;
f<n;
f++){q=f%2?"even":"odd",b=m[f],o=b.getEventCode().display,s=(s=b.getDateTime())?p.format(s,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_2YEAR):"",6>f&&(k.push("<dl class='"+j+"-info ",q,"'><dd class='"+j+"-rslt-name'>",o,"</dd><dd class='"+j+"-rslt-res'>"),k.push(MP_Util.Measurement.GetNormalcyResultDisplay(b)),k.push("</dd><dd class='"+j+"-rslt-dt'><span class='date-time'>",s,"</span></dd></dl>")),l.push("<dl class='"+j+"-info ",q,"'><dd class='"+j+"-rslt-name'>",o,"</dd><dd class='"+j+"-rslt-res'>"),l.push(MP_Util.Measurement.GetNormalcyResultDisplay(b)),l.push("</dd><dd class='"+j+"-rslt-dt'><span class='date-time'>",s,"</span></dd></dl>");
}h?(l.push("<a class='"+j+"-showlnk' href='#' onclick='RadiationOncology.prototype.ShowMoreClick("+a+",0,"+d+");'>"+g.SHOW_LESS+"</a>"),e=e.concat(l)):(6<n&&k.push("<a class='"+j+"-showlnk' href='#' onclick='RadiationOncology.prototype.ShowMoreClick("+a+",1,"+d+");'>"+g.SHOW_ALL+" ("+n+")</a>"),e=e.concat(k));
e.push("</div>");
}else{e.push("<div><h6><span class='res-none'>"+g.NO_RESULTS_FOUND+"</span></h6></div>");
}}else{e.push("<div><h6><span class='res-none'>"+g.SECTION_NOT_DEFINED+"</span></h6></div>");
}e.push("<br/>");
return e.join("");
};
RadiationOncology.prototype.ShowMoreClick=function(a,h,d){var b=MP_Util.GetCompObjById(a).getAllData();
this.filterRadDoc(a,h,d,b);
};
RadiationOncology.prototype.sortRadDocs=function(a,h,d,b,i){var c=0,f=MP_Util.GetCompObjById(h),j=f.getStyles().getNameSpace(),c=this.checkSortingOrder(h,a,j),g=0;
switch(a){case 0:f.DocActiveList.sort(function(a,b){var d=a.NOTE_TYPE.toUpperCase(),f=b.NOTE_TYPE.toUpperCase();
return d<f?(g=1,1==c&&(g*=-1),g):d>f?(g=-1,1==c&&(g*=-1),g):0;
});
break;
case 1:f.DocActiveList.sort(function(a,b){var d=a.AUTHOR.toUpperCase(),f=b.AUTHOR.toUpperCase();
return d<f?(g=1,1==c&&(g*=-1),g):d>f?(g=-1,1==c&&(g*=-1),g):0;
});
break;
case 2:f.DocActiveList.sort(function(a,b){var d=a.CREATION_DATE,f=b.CREATION_DATE;
return d<f?(g=1,1==c&&(g*=-1),g):d>f?(g=-1,1==c&&(g*=-1),g):0;
});
}this.filterRadDoc(h,d,b,i);
h=_g(j+"-doc-info-hdr"+h);
j=Util.Style.g(j+"-info-hdr-sortIcon",h,"DD");
h=j.length;
for(d=0;
d<h;
d++){b=j[d],d==a?0===c?(Util.Style.acss(b,"descend"),Util.Style.ccss(b,"ascend")||Util.Style.rcss(b,"ascend")):(Util.Style.acss(b,"ascend"),Util.Style.ccss(b,"descend")||Util.Style.rcss(b,"descend")):(Util.Style.ccss(b,"descend")&&Util.Style.rcss(b,"descend"),Util.Style.ccss(b,"ascend")&&Util.Style.rcss(b,"ascend"));
}};
RadiationOncology.prototype.checkSortingOrder=function(a,h,d){for(var b=0,a=_g(d+"-doc-info-hdr"+a),d=Util.Style.g(d+"-info-hdr-sortIcon",a,"DD"),a=d.length,i=0;
i<a;
i++){var c=d[i];
i==h&&(b=Util.Style.ccss(c,"ascend")?0:1);
}return b;
};
MP_Util.setObjectDefinitionMapping("ONCOLOGY_RADIATION",RadiationOncology);
