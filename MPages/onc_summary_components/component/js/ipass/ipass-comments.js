IPASSComments=function(){this.m_uniqueId=null;
this.m_criterion=null;
this.m_personId=0;
this.m_encntrId=0;
this.saveComm=[];
this.htmlSave=[];
this.dispShowAll=0;
this.deleteInProgress=false;
this.m_selectedCareTeamId=0;
};
IPASSComments.prototype.getUniqueId=function(){return this.m_uniqueId;
};
IPASSComments.prototype.setUniqueId=function(uniqueId){if(!uniqueId||(typeof uniqueId!=="string"&&typeof uniqueId!=="number")){throw new Error("Error setting unique ID. Parameter Unique Id must either be a number or a string for the comments control.");
}this.m_uniqueId=uniqueId;
return this;
};
IPASSComments.prototype.getCriterion=function(){return this.m_criterion;
};
IPASSComments.prototype.setCriterion=function(criterion){if(!criterion){throw new Error("Error setting criterion. Parameter criterion must be specified.");
}this.m_criterion=criterion;
this.m_personId=criterion.person_id||criterion.PERSON_ID||"";
this.m_encntrId=criterion.encntr_id||criterion.ENCNTR_ID||"";
return this;
};
IPASSComments.prototype.getSelectedCareTeamId=function(){return this.m_selectedCareTeamId;
};
IPASSComments.prototype.setSelectedCareTeamId=function(careTeamId){this.m_selectedCareTeamId=careTeamId;
};
IPASSComments.prototype.getSubTimerName=function(){if(this.m_criterion.category_mean){return this.m_criterion.category_mean;
}if(this.viewpointNameKey){return this.viewpointNameKey;
}try{this.viewpointNameKey=JSON.parse(m_viewpointJSON).VP_INFO.VIEWPOINT_NAME_KEY;
return this.viewpointNameKey;
}catch(error){MP_Util.LogJSError(error,null,"ipass-comments.js","getSubTimerName");
return"IPASS Comments Artifact";
}};
IPASSComments.prototype.renderComments=function(response,commentsTarget){var timerSitAwareRender=null;
try{var encounterInfo=response;
this.commentsTarget=commentsTarget;
var dateFormat=new mp_formatter.DateTimeFormatter(MPAGE_LOCALE);
var commentsArray=encounterInfo.COMMENTS;
var provider=null;
var origProvider=null;
var providerName="";
var origProviderName="";
this.saveComm=[];
this.htmlSave=[];
timerSitAwareRender=MP_Util.CreateTimer("ENG:MPG.IPASS_SIT_AWARE - render",this.getSubTimerName());
this.personnelArray=MP_Util.LoadPersonelListJSON(response.PRSNL);
for(var i=0,il=commentsArray.length;
i<il;
i++){provider=MP_Util.GetValueFromArray(commentsArray[i].UPDT_BY_ID,this.personnelArray);
origProvider=MP_Util.GetValueFromArray(commentsArray[i].ORIG_UPDT_BY_ID,this.personnelArray);
providerName=(provider===null)?"":provider.fullName;
origProviderName=(origProvider===null)?"":origProvider.fullName;
var tempData=new this.newComment(commentsArray[i].PCT_IPASS_ID,unescape(commentsArray[i].TEXT),providerName,dateFormat.formatISO8601(commentsArray[i].UPDT_DATE,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_2YEAR),providerName,dateFormat.formatISO8601(commentsArray[i].UPDT_DATE,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_2YEAR),commentsArray[i].UPDT_BY_ID,commentsArray[i].UPDT_CNT);
this.saveComm.push(tempData);
}this.buildCommData();
commentsTarget.append(this.buildHTML());
this.addDelegates(commentsTarget);
}catch(err){MP_Util.LogJSError(error,null,"ipass-comments.js","renderComments");
if(timerSitAwareRender){timerSitAwareRender.Abort();
timerSitAwareRender=null;
}throw error;
}finally{if(timerSitAwareRender){timerSitAwareRender.Stop();
}}};
IPASSComments.prototype.newComment=function(stickyId,comment,author,dtTm,origAuthor,origDtTm,origAuthId,updCnt){this.stickyId=stickyId;
this.comment=comment;
this.author=author;
this.dtTm=dtTm;
this.origAuthor=origAuthor;
this.origDtTm=origDtTm;
this.origAuthId=origAuthId;
this.updCnt=updCnt;
};
IPASSComments.prototype.buildCommData=function(){var uniqueId=this.m_uniqueId;
var saveCommSize=this.saveComm.length;
var commEditClass="";
var critInfo=this.getCriterion();
var personnelId=critInfo.provider_id?critInfo.provider_id:0;
for(i=0;
i<saveCommSize;
i++){if(personnelId===this.saveComm[i].origAuthId){commEditClass="commEditable";
}else{commEditClass="";
}var zebraStriping=i%2===0?"ipass-sitaware-odd":"ipass-sitaware-even";
var commentWrapper="<div class='"+zebraStriping+" "+commEditClass+"' id='commCurComm"+i+uniqueId+"'>";
var commentData="<dd class='ipass-sitaware-full'><span class='ipass-sitaware-itm' data-sitaware-update-count='"+this.saveComm[i].updCnt+"' data-sitaware-id='"+this.saveComm[i].stickyId+"'><span class='ipass-sitaware-text'>"+this.saveComm[i].comment+"</span><span class='ipass-sitaware-edit' id ='commEdit"+i+uniqueId+"' data-index-val="+i+" data-ipass-sitaware-auth-id='"+this.saveComm[i].origAuthId+"'>&nbsp;</span><span class='ipass-sitaware-del' data-index-val="+i+" id ='commDel"+i+uniqueId+"'>&nbsp;</span></span><span class='ipass-sitaware-prsnl-dt'>"+this.saveComm[i].author+" "+this.saveComm[i].dtTm+"</span></dd></div>";
var commentHTML=commentWrapper+commentData;
this.htmlSave.push(commentHTML);
}};
IPASSComments.prototype.buildHTML=function(){var saveSize=this.htmlSave.length;
var numberCommentsToShow=0;
var situationalAwarenessI18n=i18n.discernabu.ipass_sit_aware;
var uniqueId=this.m_uniqueId;
var sitAwareContent="";
var iPassI18N=i18n.discernabu.ipass;
var filteredByHtml="";
sitAwareContent+="<div id='ipassSitError"+uniqueId+"' class='ipass-pad ipass-sit-aware-err-msg hidden'></div>";
sitAwareContent+=this.textArea();
if(!saveSize){sitAwareContent+="<div id='commCurComm"+uniqueId+"'><ul><li class='ipass-sitaware-det'><span class='ipass-sitaware-none ipass-sitaware-text'>"+situationalAwarenessI18n.NO_COMMENTS_DOCUMENTED+"</span></li></ul></div>";
return sitAwareContent;
}numberCommentsToShow=this.dispShowAll?saveSize:4;
numberCommentsToShow=Math.min(numberCommentsToShow,saveSize);
sitAwareContent+="<div id='commList"+uniqueId+"' class='ipass-sitaware-scroll'>";
for(var i=0;
i<numberCommentsToShow;
i++){if(this.htmlSave[i]){sitAwareContent+=this.htmlSave[i];
}}sitAwareContent+="</div>";
if(saveSize<=4){return sitAwareContent;
}if(!this.dispShowAll){sitAwareContent+="<a id='commShowAll"+uniqueId+"' class='ipass-sitaware-btn' href='#'>"+situationalAwarenessI18n.SHOWALLTEXT+" ("+saveSize+")</a>";
}else{sitAwareContent+="<a id='commShowThree"+uniqueId+"' class='ipass-sitaware-btn' href='#'>"+situationalAwarenessI18n.SHOWLESSTEXT+"</a>";
}return sitAwareContent;
};
IPASSComments.prototype.textArea=function(){var situationalAwarenessI18n=i18n.discernabu.ipass_sit_aware;
var iPassI18n=i18n.discernabu.ipass;
var saveText=[];
var uniqueId=this.m_uniqueId;
var self=this;
saveText.push("<div id='commTextArea"+uniqueId+"' class='ipass-sitaware-text-area'><textarea id='commText"+uniqueId+"' class='ipass-sitaware-new ipass-sitaware-text' rows='5' name='textarea' value='",situationalAwarenessI18n.ADD_NEW_COMMENT,"' maxlength='255'>",situationalAwarenessI18n.ADD_NEW_COMMENT,"</textarea><div id='commSaveText"+uniqueId+"' class='ipass-sitaware-savcan  hidden'><span id='iPassSitAwareFieldMax"+uniqueId+"' class='ipass-sitaware-field-max'>255 ",iPassI18n.CHARACTERS_LEFT,"</span><span class='comm-save ipass-sitaware-save'><input id='iPassSitAwareSaveButton"+uniqueId+"' class='ipass-sitaware-savebutton' type='submit' name='sitawaresave' disabled value='",iPassI18n.SAVE,"'></input></span><span class='ipass-sitaware-savecancel'><input id='iPassSitAwareCancelButton"+uniqueId+"' class='ipass-sitaware-cansavebutton' type='submit' name='sitawaresavecancel'  value='",iPassI18n.CANCEL,"'></input></span></div></div>");
return saveText.join("");
};
IPASSComments.prototype.editTextArea=function(inputText){var iPassI18n=i18n.discernabu.ipass;
var saveText=[];
var charsLeft=(255-inputText.length);
var textFull="";
var uniqueId=this.m_uniqueId;
if(charsLeft<=0){textFull="ipass-sitaware-field-textfull";
}saveText.push("<div id='commTextArea"+uniqueId+"' class='ipass-sitaware-edit-text-area-container'><textarea id='commEditText"+uniqueId+"' class='ipass-sitaware-edit-text-area ipass-sitaware-text' rows='4' name='textarea' maxlength='255'>"+inputText+"</textarea><span class=' ipass-sitaware-separator-top'>&nbsp;</span><span class=' ipass-sitaware-separator-bottom'>&nbsp;</span><div id='commEditSaveFooter"+uniqueId+"' class='ipass-sitaware-edit-footer'><span id='iPassSitAwareEditFieldMax"+uniqueId+"' class='ipass-sitaware-field-max "+textFull+"'>",charsLeft," ",iPassI18n.CHARACTERS_LEFT,"</span><span class='comm-save ipass-sitaware-save'><input id='iPassSitAwareEditSaveButton"+uniqueId+"' class='ipass-sitaware-savebutton' type='submit' name='sitawaresave' disabled value='",iPassI18n.SAVE,"'></input></span><span class='ipass-sitaware-savecancel'><input id='iPassSitAwareEditCancelButton"+uniqueId+"' class='ipass-sitaware-cansavebutton' type='submit' name='sitawaresavecancel'  value='",iPassI18n.CANCEL,"'></input></span></div></div>");
return saveText.join("");
};
IPASSComments.prototype.addDelegates=function(commentsTarget){var uniqueId=this.m_uniqueId;
var self=this;
$("#commText"+uniqueId).on("click",function(){self.onTextBoxClick();
});
$("#commText"+uniqueId).on("keyup",function(event){self.commNewKeyUp(event,this);
});
$("#commText"+uniqueId).on("focusout",function(event){self.onLostFocus(event,this);
});
$("#iPassSitAwareSaveButton"+uniqueId).on("click",function(){self.saveComment($(this).parent());
});
$("#iPassSitAwareCancelButton"+uniqueId).on("click",function(event){self.onCancelComment(event,this);
});
$("#commShowAll"+uniqueId).on("click",function(event){self.setShowAllClicked(true);
});
$("#commShowThree"+uniqueId).on("click",function(event){self.setLastThreeClicked(true);
});
$(commentsTarget).on("mouseenter",".ipass-sitaware-full",function(event){$(event.currentTarget).find(".ipass-sitaware-del").addClass("ipass-sitaware-del-btn");
});
$(commentsTarget).on("mouseleave",".ipass-sitaware-full",function(event){$(event.currentTarget).find(".ipass-sitaware-del").removeClass("ipass-sitaware-del-btn");
});
$(commentsTarget).find(".commEditable").on("mouseenter",function(event){$(event.currentTarget).find(".ipass-sitaware-edit").addClass("ipass-sitaware-edit-btn");
});
$(commentsTarget).find(".commEditable").on("mouseleave",function(event){$(event.currentTarget).find(".ipass-sitaware-edit").removeClass("ipass-sitaware-edit-btn");
});
$(commentsTarget).on("click",".ipass-sitaware-del",function(event){var commentIndex=$(event.currentTarget).attr("data-index-val");
self.deleteComment(commentIndex);
});
$(commentsTarget).on("click",".ipass-sitaware-edit",function(event){var commentIndex=$(event.currentTarget).attr("data-index-val");
self.editComment(commentIndex,this);
});
};
IPASSComments.prototype.onTextBoxClick=function(){var uniqueId=this.m_uniqueId;
var situationalAwarenessI18n=i18n.discernabu.ipass_sit_aware;
var textArea=$("#commText"+uniqueId);
if(textArea.val()===situationalAwarenessI18n.ADD_NEW_COMMENT){textArea.val("").css({color:"#000000"});
$("#commSaveText"+uniqueId).removeClass("hidden");
}};
IPASSComments.prototype.commNewKeyUp=function(event,commNewObj){var uniqueId=this.m_uniqueId;
var iPassI18n=i18n.discernabu.ipass;
var situationalAwarenessI18n=i18n.discernabu.ipass_sit_aware;
var errorElement=$("#ipassSitError"+uniqueId);
errorElement.addClass("hidden");
errorElement.removeClass("ipass-err-adj");
var commentBox=$(commNewObj);
var fieldMax=null;
var saveButton=null;
if(commentBox.hasClass("ipass-sitaware-edit-text-area")){fieldMax=$("#iPassSitAwareEditFieldMax"+uniqueId);
saveButton=$("#iPassSitAwareEditSaveButton"+uniqueId);
}else{fieldMax=$("#iPassSitAwareFieldMax"+uniqueId);
saveButton=$("#iPassSitAwareSaveButton"+uniqueId);
}var text=$.trim(commentBox.val());
var numberCharacters=text.length;
if(numberCharacters>255){commentBox.val(text.substr(0,255));
}if(numberCharacters<=0){saveButton.prop("disabled",true);
}else{saveButton.prop("disabled",false);
}var charactersRemaining=Math.max(255-numberCharacters,0);
fieldMax.html(charactersRemaining+" "+iPassI18n.CHARACTERS_LEFT);
if(!charactersRemaining){fieldMax.addClass("ipass-sitaware-field-textfull");
}else{fieldMax.removeClass("ipass-sitaware-field-textfull");
}saveButton.prop("value",iPassI18n.SAVE);
if(!text){saveButton.prop("disabled",true);
return;
}saveButton.prop("disabled",false);
if(event.keyCode==13&&text!==situationalAwarenessI18n.ADD_NEW_COMMENT){commentBox.val(text.replace("\n",""));
this.saveComment(saveButton.parent());
}};
IPASSComments.prototype.editComment=function(commIndexVal,objThis){var uniqueId=this.m_uniqueId;
var self=this;
if(!$("#commCurComm"+commIndexVal+uniqueId).hasClass("commEditable")){return;
}var prevEdit=$("#commList"+uniqueId).find(".ipass-sitaware-edit-action");
if(prevEdit.length){prevEdit.removeClass("ipass-sitaware-edit-action");
prevEdit.find(".ipass-sitaware-text").removeClass("hidden");
prevEdit.find(".ipass-sitaware-prsnl-dt").removeClass("hidden");
prevEdit.find("#commTextArea"+uniqueId).remove();
}var sitAwareText=$(objThis).siblings(".ipass-sitaware-text");
var commentText=sitAwareText.text();
sitAwareText.addClass("hidden");
$(objThis).parent().siblings(".ipass-sitaware-prsnl-dt").addClass("hidden");
$("#commCurComm"+commIndexVal+uniqueId).addClass("ipass-sitaware-edit-action");
var commentTextArea=this.editTextArea(commentText);
$(objThis).parent().append(commentTextArea);
$("#commEditText"+uniqueId).on("keyup",function(event){self.commNewKeyUp(event,this);
});
$("#iPassSitAwareEditSaveButton"+uniqueId).on("click",function(){self.saveComment($(this).parent());
});
$("#iPassSitAwareEditCancelButton"+uniqueId).on("click",function(){self.onCancelEditComment();
});
};
IPASSComments.prototype.saveComment=function(buttonRef){var uniqueId=this.m_uniqueId;
var criterion=this.m_criterion;
var self=this;
var situationalAwarenessI18n=i18n.discernabu.ipass_sit_aware;
var commentBox=null;
var commentControls=null;
var saveType="";
var updCnt=0;
var sitAwareId=0;
var updateInd=0;
var sitAwareItm=null;
var buttonId=$(buttonRef).children(".ipass-sitaware-savebutton");
if(buttonId.attr("id")=="iPassSitAwareEditSaveButton"+uniqueId){commentBox=$("#commEditText"+uniqueId);
commentControls=$("#commEditSaveFooter"+uniqueId);
saveType="MODIFY";
sitAwareItm=commentBox.parent().parent();
updCnt=parseInt(sitAwareItm.attr("data-sitaware-update-count"),10);
sitAwareId=sitAwareItm.attr("data-sitaware-id");
updateInd=1;
}else{commentBox=$("#commText"+uniqueId);
commentControls=$("#commSaveText"+uniqueId);
saveType="ADD";
}var commentText=$.trim(commentBox.val());
if(!commentText||commentText===""||commentText===situationalAwarenessI18n.ADD_NEW_COMMENT){return;
}commentBox.prop("disabled",true);
commentBox.parent().find(".ipass-sitaware-savebutton").prop("value"," ").prop("disabled",true).addClass("ipass-save-image");
var text=commentText.substr(0,255);
var encntrId=criterion.encntr_id;
var personId=criterion.person_id?criterion.person_id:0;
var refreshSaveComment=function(response){var df=new mp_formatter.DateTimeFormatter(MPAGE_LOCALE);
var providerName="";
if(response.getStatus()==="S"){var recordData=response.getResponse();
var parentSitAware=$("#commList"+uniqueId).find(".ipass-sitaware-edit-action");
var parentId=parentSitAware.attr("id");
var sitAwareItm=parentSitAware.find(".ipass-sitaware-itm");
sitAwareItm.attr("data-sitaware-update-count",recordData.RECORDS[0].UPDT_CNT);
sitAwareItm.children(".ipass-sitaware-text").text(unescape(recordData.RECORDS[0].TEXT)).removeClass("hidden");
sitAwareItm.siblings(".ipass-sitaware-prsnl-dt").removeClass("hidden");
sitAwareItm.children(".ipass-sitaware-edit-text-area-container").remove();
$("#"+parentId).removeClass("ipass-sitaware-edit-action");
}else{MP_Util.LogScriptCallError(null,this,"ipass.js","saveComment");
self.alertConfirm(3);
}};
var ar=CERN_IPASS_O1.createJSONRequest(personId+".0",encntrId+".0","0.0","0.0",sitAwareId,"0.0","COMMENT",saveType,"0.0",text,updCnt,"",0,0,this.getSelectedCareTeamId()+".0");
if(updateInd===1){CERN_IPASS_O1.loadWithCBParameters("mp_upd_pct_ipass",["^MINE^"],ar,refreshSaveComment,false);
}else{CERN_IPASS_O1.loadWithCBParameters("mp_upd_pct_ipass",["^MINE^"],ar,function(response){self.updateSaveComment(response);
},false);
}commentBox.prop("disabled",true);
commentControls.prop("disabled",true);
};
IPASSComments.prototype.updateSaveComment=function(response){var self=this;
var df=new mp_formatter.DateTimeFormatter(MPAGE_LOCALE);
var providerName="";
var uniqueId=this.m_uniqueId;
var commentBox=$("#commText"+uniqueId);
var commentControls=$("#commSaveText"+uniqueId);
if(response.getStatus()==="S"){var recordData=response.getResponse();
self.htmlSave=[];
var providerData=response.getResponse().PRSNL[0];
providerName=(providerData===null)?"":providerData.PROVIDER_NAME.NAME_FULL;
var tempData=new self.newComment(recordData.RECORDS[0].PCT_IPASS_ID,unescape(recordData.RECORDS[0].TEXT),providerName,df.formatISO8601(recordData.RECORDS[0].UPDT_DATE,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_2YEAR),providerName,df.formatISO8601(recordData.RECORDS[0].UPDT_DATE,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_2YEAR),recordData.RECORDS[0].UPDT_BY_ID,recordData.RECORDS[0].UPDT_CNT);
self.saveComm.unshift(tempData);
self.buildCommData();
this.commentsTarget.html(this.buildHTML());
}else{MP_Util.LogScriptCallError(null,this,"ipass-comments.js","saveComment");
this.alertConfirm(3);
}commentBox.prop("disabled",false);
commentControls.prop("disabled",false);
this.addDelegates(this.commentsTarget);
};
IPASSComments.prototype.onLostFocus=function(){var uniqueId=this.m_uniqueId;
if($("#commText"+uniqueId).val()===""){var iPassI18n=i18n.discernabu.ipass;
var saveTextContainer=$("#commSaveText"+uniqueId);
saveTextContainer.find(".error-icon-component").remove();
saveTextContainer.addClass("hidden");
saveTextContainer.find(".ipass-sitaware-field-max").removeClass("hidden");
saveTextContainer.find(".ipass-sitaware-savebutton").attr("value",iPassI18n.SAVE);
this.clearTextArea();
}};
IPASSComments.prototype.clearTextArea=function(){var uniqueId=this.m_uniqueId;
var situationalAwarenessI18n=i18n.discernabu.ipass_sit_aware;
$("#commText"+uniqueId).val(situationalAwarenessI18n.ADD_NEW_COMMENT).css({color:"#7c7c7c"});
};
IPASSComments.prototype.onCancelComment=function(){var uniqueId=this.m_uniqueId;
var iPassI18n=i18n.discernabu.ipass;
var saveTextContainer=$("#commSaveText"+uniqueId);
saveTextContainer.find(".error-icon-component").remove();
saveTextContainer.addClass("hidden");
$("#iPassSitAwareFieldMax"+uniqueId).html("255 "+iPassI18n.CHARACTERS_LEFT).removeClass("hidden");
$("#iPassSitAwareSaveButton"+uniqueId).attr("value",iPassI18n.SAVE).attr("disabled","disabled");
this.clearTextArea();
var errorDivElement=$("#ipassSitError"+uniqueId);
errorDivElement.addClass("hidden");
errorDivElement.removeClass("ipass-err-adj");
};
IPASSComments.prototype.onCancelEditComment=function(){var uniqueId=this.m_uniqueId;
var openEdit=$("#commList"+uniqueId).find(".ipass-sitaware-edit-action");
openEdit.removeClass("ipass-sitaware-edit-action");
openEdit.find(".ipass-sitaware-text").removeClass("hidden");
openEdit.find(".ipass-sitaware-prsnl-dt").removeClass("hidden");
openEdit.find("#commTextArea"+uniqueId).remove();
};
IPASSComments.prototype.setShowAllClicked=function(val){if(val){this.dispShowAll=1;
this.commentsTarget.html(this.buildHTML());
this.addDelegates(this.commentsTarget);
}else{this.dispShowAll=0;
}};
IPASSComments.prototype.setLastThreeClicked=function(val){if(val){this.dispShowAll=0;
this.commentsTarget.html(this.buildHTML());
this.addDelegates(this.commentsTarget);
}else{this.dispShowAll=1;
}};
IPASSComments.prototype.deleteComment=function(commIndexVal){var iPassI18n=i18n.discernabu.ipass;
var uniqueId=this.m_uniqueId;
var situationalAwarenessI18n=i18n.discernabu.ipass_sit_aware;
var self=this;
var commentList=$("#commList"+uniqueId);
var existingDeleteComment=commentList.find(".ipass-sitaware-delete");
if(existingDeleteComment.length){existingDeleteComment.find(".ipass-sitaware-confirm-icon").remove();
existingDeleteComment.find(".ipass-sitaware-delete-separator").remove();
existingDeleteComment.removeClass("ipass-sitaware-delete");
}var commentObject=$("#commCurComm"+commIndexVal+uniqueId);
var commentItem=commentObject.find(".ipass-sitaware-itm");
if(commentObject.hasClass("ipass-sitaware-delete")){return;
}commentObject.addClass("ipass-sitaware-delete");
var separatorContainer=$("<div class = 'ipass-sitaware-delete-separator'><span class=' ipass-sitaware-separator-top'>&nbsp;</span><span class=' ipass-sitaware-separator-bottom'>&nbsp;</span></div>");
var deleteConfirmationContainer=$("<div class='ipass-sitaware-confirm-icon' style='display: inline-block;'><span class='ipass-sitaware-del-confirm'>"+situationalAwarenessI18n.DELETECONFIRMTEXT+"</span></div>");
var parentContainer=$("<div id='ipassSitBtnsContainer"+uniqueId+"' class='ipass-sitaware-btns-container'></div>");
var confirmDeleteButton=$("<span class='ipass-sitaware-deletepad'><input class='ipass-sitaware-delbutton' type='submit' name='sitwaredel' value='"+iPassI18n.DELETE+"'></input></span>");
var cancelDeleteButton=$("<span class='ipass-sitawarecancel'><input class='ipass-sitaware-cansavebutton' type='submit' name='ipass-sitaware-cancel' value='"+iPassI18n.CANCEL+"'></input></span>");
confirmDeleteButton.click(function(event){self.commentDeleteFunction(commIndexVal,commentItem);
});
cancelDeleteButton.click(function(){separatorContainer.remove();
deleteConfirmationContainer.remove();
commentObject.removeClass("ipass-sitaware-delete");
var errorDivElement=$("#ipassSitError"+uniqueId);
errorDivElement.addClass("hidden");
errorDivElement.removeClass("ipass-err-adj");
});
parentContainer.append(confirmDeleteButton);
parentContainer.append(cancelDeleteButton);
deleteConfirmationContainer.append(parentContainer);
commentObject.append(separatorContainer);
commentObject.append(deleteConfirmationContainer);
};
IPASSComments.prototype.commentDeleteFunction=function(commIndexVal,commObj){var uniqueId=this.m_uniqueId;
var self=this;
if(this.deleteInProgress){return;
}this.deleteInProgress=true;
var iPassI18n=i18n.discernabu.ipass;
var updateCount=commObj.attr("data-sitaware-update-count");
this.commIndexVal=commIndexVal;
var stickyId=self.saveComm[commIndexVal].stickyId;
var commentTxt=self.saveComm[commIndexVal].comment;
var ar=CERN_IPASS_O1.createJSONRequest(this.m_personId+".0",this.m_encntrId+".0","0.0","0.0",stickyId,"0.0","COMMENT","DELETE","0.0",commentTxt,updateCount,"",0,0,"0.0");
CERN_IPASS_O1.loadWithCBParameters("mp_upd_pct_ipass",["^MINE^"],ar,function(response){self.updateDelComment(response);
},false);
};
IPASSComments.prototype.updateDelComment=function(response){var recordData=response.getResponse();
if(response.getStatus()==="S"){this.saveComm.splice(this.commIndexVal,1);
this.htmlSave=[];
this.buildCommData();
this.commentsTarget.html(this.buildHTML());
this.addDelegates(this.commentsTarget);
}else{MP_Util.LogScriptCallError(null,this,"ipass-comments.js","updateDelComment");
this.alertConfirm(4,this.commIndexVal);
}this.deleteInProgress=false;
};
IPASSComments.prototype.alertConfirm=function(commAlertFlag,control){var iPassI18n=i18n.discernabu.ipass;
var situationalAwarenessI18n=i18n.discernabu.ipass_sit_aware;
var situationalAssessmentErrorModal=null;
var uniqueId=this.m_uniqueId;
var errorMsg="";
var errorDivElement=$("#ipassSitError"+uniqueId);
errorDivElement.removeClass("hidden");
errorDivElement.addClass("ipass-err-adj");
if(commAlertFlag===3){var saveButton=$("#iPassSitAwareSaveButton"+uniqueId);
saveButton.attr("value",iPassI18n.RETRY);
saveButton.prop("disabled",false);
$("#saveCommentsLoading"+uniqueId).removeAttr("src");
errorMsg=iPassI18n.UNABLE_TO_SAVE;
errorHTML=MP_Core.generateUserMessageHTML("error",errorMsg," "+CERN_IPASS_O1.iPassI18n.NETWORK_FAIL,"inline-message");
errorDivElement.html(errorHTML);
}else{if(commAlertFlag===4){errorMsg=situationalAwarenessI18n.UNABLEDELTEXT;
errorHTML=MP_Core.generateUserMessageHTML("error",errorMsg," "+CERN_IPASS_O1.iPassI18n.NETWORK_FAIL,"inline-message");
errorDivElement.html(errorHTML);
}else{}}};
