IPASSActions=function(){this.m_uniqueId=null;
this.m_criterion=null;
this.m_iPassActionsRef=null;
this.m_personId=0;
this.m_selectedCareTeamId=0;
};
IPASSActions.prototype.getUniqueId=function(){return this.m_uniqueId;
};
IPASSActions.prototype.setUniqueId=function(uniqueId){if(!uniqueId||(typeof uniqueId!=="string"&&typeof uniqueId!=="number")){throw new Error("Error setting unique ID. Parameter Unique Id must either be a number or a string for the actions control.");
}this.m_uniqueId=uniqueId;
return this;
};
IPASSActions.prototype.getCriterion=function(){return this.m_criterion;
};
IPASSActions.prototype.setCriterion=function(criterion){if(!criterion){throw new Error("Error setting criterion. Parameter criterion must be specified.");
}this.m_criterion=criterion;
if(this.m_criterion.person_id){this.m_personId=this.m_criterion.person_id;
}else{if(this.m_criterion.PERSON_ID){this.m_personId=this.m_criterion.PERSON_ID;
}}return this;
};
IPASSActions.prototype.getSelectedCareTeamId=function(){return this.m_selectedCareTeamId;
};
IPASSActions.prototype.setSelectedCareTeamId=function(careTeamId){this.m_selectedCareTeamId=careTeamId;
};
IPASSActions.prototype.getSubTimerName=function(){if(this.m_criterion.category_mean){return this.m_criterion.category_mean;
}if(this.viewpointNameKey){return this.viewpointNameKey;
}try{this.viewpointNameKey=JSON.parse(m_viewpointJSON).VP_INFO.VIEWPOINT_NAME_KEY;
return this.viewpointNameKey;
}catch(error){MP_Util.LogJSError(error,null,"ipass-actions.js","getSubTimerName");
return"IPASS Actions Artifact";
}};
IPASSActions.prototype.renderActions=function(recordData,actionsTarget){var activeHTML=[];
var activeCnt=0;
var doneHTML=[];
var doneCnt=0;
var parentEntityId=0;
var activeActions=null;
var completedActions=null;
var action=null;
var actionCnt=0;
var activeActionCnt=0;
var actionId=0;
var actionUpdCnt=0;
var actionText="";
var uniqueId=this.m_uniqueId;
var x=0;
var timerActionsRender=null;
var provider=null;
var actionAuthor="";
var critInfo=this.getCriterion();
var personnelId=critInfo.provider_id;
var editableClass="";
var actionCreateDtTm="";
var actionUpdateDtTm="";
var origProvider=null;
var origActionAuthor="";
var origActionUpdateDtTm="";
var df=new mp_formatter.DateTimeFormatter(MPAGE_LOCALE);
var dateFormatter=mp_formatter.DateTimeFormatter.FULL_DATE_TIME_2YEAR;
var response=recordData;
try{timerActionsRender=MP_Util.CreateTimer("ENG:MPG.IPASS-ACTIONS.O1 - render component",this.getSubTimerName());
if(response){this.personnelArray=MP_Util.LoadPersonelListJSON(recordData.PRSNL);
activeActions=response.ACTIVE_ACTIONS;
completedActions=response.COMPLETED_ACTIONS;
actionCnt=completedActions.length;
parentEntityId=response.SELECTED_ENCOUNTER_ID;
activeActionCnt=activeActions.length;
}for(x=0;
x<actionCnt;
x++){action=completedActions[x];
actionId=action.PCT_IPASS_ID;
actionText=unescape(action.TEXT);
actionUpdCnt=action.UPDT_CNT;
provider=MP_Util.GetValueFromArray(action.UPDT_BY_ID,this.personnelArray);
actionAuthor=$.trim(provider.fullName);
actionUpdateDtTm=df.formatISO8601(action.UPDT_DATE,dateFormatter);
origProvider=MP_Util.GetValueFromArray(action.ORIG_UPDT_BY_ID,this.personnelArray);
origActionAuthor=$.trim(origProvider.fullName);
origActionUpdateDtTm=df.formatISO8601(action.ORIG_BEGIN_DATE,dateFormatter);
doneCnt++;
doneHTML.push("<dd class='ipass-actions-txt ipass-actions-done-txt-color' id='action"+actionId+uniqueId+"' data-enc-id='"+parentEntityId+"' data-action-id='"+actionId+"' data-upd-cnt='"+actionUpdCnt+"'><span class='ipass-actions-itm'><span class = 'ipass-actions-chk'><input type='checkbox' checked='checked'></input></span><span class='ipass-actions-data ipass-actions-strike'> "+actionText+"</span></span>");
doneHTML.push("<span class='ipass-actions-edit'>&nbsp;</span><span class='ipass-actions-del ipass-actions-active-item'><span class='hidden'>&nbsp;</span></span>");
doneHTML.push("<span class='ipass-actions-author-container'><span class='ipass-actions-author-timestamp' data-ipass-actions-orig-auth-id='"+action.ORIG_UPDT_BY_ID+"' data-ipass-actions-orig-author-dt-tm='"+origActionAuthor+" "+origActionUpdateDtTm+"'>"+actionAuthor+" "+actionUpdateDtTm+"</span></span></dd>");
}for(x=0;
x<activeActionCnt;
x++){action=activeActions[x];
actionId=action.PCT_IPASS_ID;
actionText=unescape(action.TEXT);
actionUpdCnt=action.UPDT_CNT;
provider=MP_Util.GetValueFromArray(action.ORIG_UPDT_BY_ID,this.personnelArray);
actionAuthor=$.trim(provider.fullName);
actionCreateDtTm=df.formatISO8601(action.ORIG_BEGIN_DATE,dateFormatter);
if(action.ORIG_UPDT_BY_ID===personnelId){editableClass="ipass-actions-edit-active";
}else{editableClass="";
}activeCnt++;
activeHTML.push("<dd class='ipass-actions-txt ipass-actions-active-txt-color' id='action"+actionId+uniqueId+"'  data-enc-id='"+parentEntityId+"' data-action-id='"+actionId+"' data-upd-cnt='"+actionUpdCnt+"'><span class='ipass-actions-itm'><span class = 'ipass-actions-chk'><input type='checkbox' /></span><span class= 'ipass-actions-data'>"+actionText+"</span></span>");
activeHTML.push("<span class='ipass-actions-edit "+editableClass+"'>&nbsp;</span><span class='ipass-actions-del ipass-actions-done-item'><span class='hidden'>&nbsp;</span></span>");
activeHTML.push("<span class='ipass-actions-author-container'><span class='ipass-actions-author-timestamp' data-ipass-actions-orig-auth-id='"+action.ORIG_UPDT_BY_ID+"'>"+actionAuthor+" "+actionCreateDtTm+"</span></span></dd>");
}var iPassI18N=CERN_IPASS_ACTIONS_O1.iPassI18N;
var actionsI18N=CERN_IPASS_ACTIONS_O1.actionsI18N;
var actionsHtml="";
actionsHtml+="<div id='ipass-action-err"+uniqueId+"' class='ipass-pad ipass-action-err-msg hidden'></div>";
actionsHtml+="<div id='ipassActionsWrapper"+uniqueId+"'>";
actionsHtml+="<div class='ipass-actions-div' data-enc-id='"+parentEntityId+"'>";
actionsHtml+="<textarea id='iPassActionsTextBox"+uniqueId+"' class='ipass-actions-new' maxlength='255' rows='5' value='"+actionsI18N.ADD_NEW_ACTION+"'>"+actionsI18N.ADD_NEW_ACTION+"</textarea>";
actionsHtml+="<div id='iPassActionsID"+uniqueId+"' class='ipass-actions-savcan hidden'>";
actionsHtml+="<span class='ipass-actions-field-max'></span>";
actionsHtml+="<span class='ipass-actions-save' data-enc-id='"+parentEntityId+"'>";
actionsHtml+="<input class='ipass-actions-savebutton' type='button' disabled value='"+iPassI18N.SAVE+"'>";
actionsHtml+="</span>";
actionsHtml+="<span class='ipass-actions-savecancel'>";
actionsHtml+="<input class='ipass-actions-cansavebutton' type='button' name='actioncancel' value='"+iPassI18N.CANCEL+"'>";
actionsHtml+="</span>";
actionsHtml+="</div>";
actionsHtml+="</div>";
actionsHtml+="<div id='ipassActiNoDataId"+uniqueId+"' class='ipass-actions-nodata "+((activeCnt||doneCnt)?"hidden":"")+"'>"+actionsI18N.NO_ACTIONS_DOCUMENTED+"</div>";
actionsHtml+="<div id='ipassActiNoActiveDataId"+uniqueId+"' class='ipass-actions-nodata "+((activeCnt||(activeCnt===0&&doneCnt===0))?"hidden":"")+"'>"+actionsI18N.NO_ACTIVE_ACTIONS_DOCUMENTED+"</div>";
actionsHtml+="<div id='iPassActionsList"+uniqueId+"' class='ipass-actions-itms-div'>";
actionsHtml+="<dl id='iPassActionsActiveItems"+uniqueId+"' class='ipass-actions-current' data-enc-id="+parentEntityId+"'>"+activeHTML.join("")+"</dl>";
actionsHtml+="<dl id='iPassActionsDoneItems"+uniqueId+"' class='ipass-actions-done'>"+doneHTML.join("")+"</dl>";
actionsHtml+="</div>";
actionsHtml+="<div id='iPassActionsShowCompleted"+uniqueId+"' class='ipass-actions-done-hd "+((doneCnt)?"":"hidden")+"'>";
actionsHtml+="<span class='ipass-actions-done-hd-txt'>"+actionsI18N.COMPLETED+"</span>";
actionsHtml+="<span id='iPassActionsDoneCnt"+uniqueId+"' class='ipass-actions-done-cnt'> ("+doneCnt+") </span>";
actionsHtml+="</div>";
actionsHtml+="</div>";
actionsTarget.append(actionsHtml);
}catch(error){MP_Util.LogJSError(error,null,"ipass-actions.js","renderActions");
if(timerActionsRender){timerActionsRender.Abort();
timerActionsRender=null;
}throw error;
}finally{if(timerActionsRender){timerActionsRender.Stop();
}}};
IPASSActions.prototype.finalizeActions=function(actionsTarget){var uniqueId=this.m_uniqueId;
var self=this;
var actionsObj=$(actionsTarget);
actionsObj.on("mouseenter",".ipass-actions-txt",function(){if(!$(this).hasClass("ipass-actions-delete-action")){$(this).addClass("ipass-actions-hover");
}});
actionsObj.on("mouseleave",".ipass-actions-txt",function(){$(this).removeClass("ipass-actions-hover");
});
actionsObj.on("click","#iPassActionsShowCompleted"+uniqueId+"",function(){self.actionShowCompleteToggle($(this));
});
actionsObj.on("click",".ipass-actions-chk",function(){self.actionChk($(this));
});
actionsObj.on("click",".ipass-actions-del",function(){self.actionDeleteConfirmation($(this));
});
actionsObj.on("click",".ipass-actions-save",function(){self.actionSave($(this));
});
actionsObj.on("click",".ipass-actions-savecancel",function(){self.actionCancel($(this));
});
actionsObj.on("click",".ipass-actionsdelbutton",function(){self.actionDeletion($(this).closest(".ipass-actions-confirmicon").siblings(".ipass-actions-del"));
});
actionsObj.on("click",".ipass-actionscanbutton",function(){self.actionCancel($(this));
});
actionsObj.on("focusin",".ipass-actions-new",function(){var textArea=$(this);
if(textArea.val()===CERN_IPASS_ACTIONS_O1.actionsI18N.ADD_NEW_ACTION){textArea.val("").css({color:"#000000"});
$("#iPassActionsID"+uniqueId+"").removeClass("hidden").find(".ipass-actions-field-max").html("255 "+CERN_IPASS_ACTIONS_O1.iPassI18N.CHARACTERS_LEFT);
}});
actionsObj.on("click",".ipass-actions-edit",function(){self.actionEdit($(this));
});
actionsObj.on("focusout",".ipass-actions-new",function(){var textArea=$(this);
if(textArea.attr("id")==="iPassActionsEditTextBox"){return;
}var value=textArea.val();
if(!value||!$.trim(value)){textArea.val(CERN_IPASS_ACTIONS_O1.actionsI18N.ADD_NEW_ACTION).css({color:"#7c7c7c"});
$("#iPassActionsID"+uniqueId+"").addClass("hidden").find(".ipass-actions-field-max").html("255 "+CERN_IPASS_ACTIONS_O1.iPassI18N.CHARACTERS_LEFT).find(".ipass-actions-savebutton").attr("disabled","disabled");
}});
actionsObj.on("keyup",".ipass-actions-new",function(event){var textArea=$(this);
var errorDivElement=$("#ipass-action-err"+uniqueId);
errorDivElement.addClass("hidden");
errorDivElement.removeClass("ipass-err-adj");
var value=$.trim(textArea.val());
var buttonsContainer=null;
var saveContainer=null;
if($(this).attr("id")==="iPassActionsEditTextBox"){buttonsContainer=$("#iPassEditActionsID"+uniqueId);
saveContainer=$(this).parent().parent();
}else{buttonsContainer=$("#iPassActionsID"+uniqueId);
saveContainer=$(this).parent();
}var saveButton=buttonsContainer.find(".ipass-actions-savebutton");
var maxCharEle=buttonsContainer.find(".ipass-actions-field-max");
if(event.keyCode==13){if(value){textArea.val(value.replace("\n",""));
textArea.blur();
self.actionSave(saveContainer);
}else{textArea.val("");
}return;
}var charLimit=255;
if(value){saveButton.removeAttr("disabled");
saveButton.attr("value",CERN_IPASS_ACTIONS_O1.iPassI18N.SAVE);
var errorObj=buttonsContainer.find(".error-icon-component");
if(errorObj.length){buttonsContainer.find(".ipass-actions-field-max").removeClass("hidden");
saveButton.attr("value",CERN_IPASS_ACTIONS_O1.iPassI18N.SAVE);
$(errorObj).remove();
}var chars=value.length;
var charsCount=charLimit-chars;
if(chars>=charLimit){textArea.val(value.substr(0,charLimit));
maxCharEle.html("0 "+CERN_IPASS_ACTIONS_O1.iPassI18N.CHARACTERS_LEFT).addClass("ipass-actions-field-textfull");
}else{maxCharEle.html(charsCount+" "+CERN_IPASS_ACTIONS_O1.iPassI18N.CHARACTERS_LEFT).removeClass("ipass-actions-field-textfull");
}}else{saveButton.attr("disabled","disabled");
maxCharEle.html(charLimit+" "+CERN_IPASS_ACTIONS_O1.iPassI18N.CHARACTERS_LEFT);
}});
actionsObj.on("click",".ipass-actions-edit-action",function(event){var eventButton=event.target;
if(eventButton.id==="idActionsEditSaveButton"+uniqueId&&!eventButton.disabled){self.actionSave(this);
}else{if(eventButton.id==="idActionsEditCancelButton"+uniqueId){var actionsEditDd=$(this);
actionsEditDd.find(".ipass-actions-chk :checkbox").removeClass("hidden");
actionsEditDd.find(".ipass-actions-data").removeClass("hidden");
actionsEditDd.find(".ipass-actions-author-timestamp").removeClass("hidden");
actionsEditDd.removeClass("ipass-actions-edit-action");
actionsEditDd.find(".ipass-actions-textarea-buttons").remove();
$("#iPassActionsEditTextBox").remove();
}}});
};
IPASSActions.prototype.actionShowCompleteToggle=function(completeToggle){var uniqueId=this.m_uniqueId;
var doneItems=$("#iPassActionsDoneItems"+uniqueId);
if(doneItems.hasClass("ipass-actions-exp")){doneItems.removeClass("ipass-actions-exp");
$(completeToggle).find(".ipass-actions-done-hd-txt").text(CERN_IPASS_ACTIONS_O1.actionsI18N.COMPLETED+" ");
}else{doneItems.addClass("ipass-actions-exp");
$(completeToggle).find(".ipass-actions-done-hd-txt").text(CERN_IPASS_ACTIONS_O1.actionsI18N.HIDE_COMPLETED+" ");
}};
IPASSActions.prototype.actionCancel=function(cancelButton){var uniqueId=this.m_uniqueId;
if(cancelButton.hasClass("ipass-actions-savecancel")){var textArea=$("#iPassActionsTextBox"+uniqueId);
var buttonsContainer=$("#iPassActionsID"+uniqueId);
var errorDivElement=$("#ipass-action-err"+uniqueId);
errorDivElement.addClass("hidden");
errorDivElement.removeClass("ipass-err-adj");
textArea.val(CERN_IPASS_ACTIONS_O1.actionsI18N.ADD_NEW_ACTION).css({color:"#aaa"});
buttonsContainer.addClass("hidden");
buttonsContainer.find(".ipass-actions-savebutton").prop("disabled",true).attr("value",CERN_IPASS_ACTIONS_O1.iPassI18N.SAVE);
buttonsContainer.find(".ipass-actions-field-max").removeClass("ipass-actions-field-textfull").html("");
var errorObj=buttonsContainer.find(".error-icon-component");
if(errorObj.length){errorObj.remove();
buttonsContainer.find(".ipass-actions-field-max").removeClass("hidden");
}}else{var actionContainer=$(cancelButton).closest(".ipass-actions-txt");
actionContainer.find("input").prop("disabled",false).css("cursor","pointer");
actionContainer.removeClass("ipass-actions-delete-action");
actionContainer.find(".ipass-actions-confirmicon").remove();
}};
IPASSActions.prototype.actionChk=function(actionChkObj){var self=this;
var uniqueId=this.m_uniqueId;
var checkedItem=$(actionChkObj).closest("dd");
var encounterId=checkedItem.attr("data-enc-id");
var actionID=checkedItem.attr("data-action-id");
var actionUpdCnt=checkedItem.attr("data-upd-cnt");
var actionText=checkedItem.find(".ipass-actions-data").text();
var actionType="";
var errorDivElement=$("#ipass-action-err"+uniqueId);
errorDivElement.addClass("hidden");
errorDivElement.removeClass("ipass-err-adj");
if(actionText&&encounterId){if($(actionChkObj).find("input").is(":checked")){actionType="COMPLETE";
}else{actionType="PENDING";
}var UPD_CNT=actionUpdCnt;
var cclParam=CERN_IPASS_O1.createJSONRequest(this.m_personId+".0",encounterId+".0","0.0","0.0",actionID,"0.0","ACTION","MODIFY","0.0",actionText,UPD_CNT,actionType,0,0,this.getSelectedCareTeamId()+".0");
this.m_iPassActionsRef=$(actionChkObj);
CERN_IPASS_O1.loadWithCBParameters("mp_upd_pct_ipass",["^MINE^"],cclParam,function(response){self.updateAction(response);
},false);
}};
IPASSActions.prototype.actionSave=function(actionSaveObj){var uniqueId=this.m_uniqueId;
var self=this;
var criterion=this.getCriterion();
var personId=criterion.person_id||0;
var buttonsContainer=$("#iPassActionsID"+uniqueId);
var saveContainer=$(actionSaveObj);
var encounterId=$(saveContainer).attr("data-enc-id");
var textArea=$("#iPassActionsTextBox"+uniqueId);
var errorDivElement=$("#ipass-action-err"+uniqueId);
errorDivElement.addClass("hidden");
errorDivElement.removeClass("ipass-err-adj");
if(saveContainer.hasClass("ipass-actions-edit-action")){var editTextBox=$("#iPassActionsEditTextBox");
var saveButton=$("#idActionsEditSaveButton"+uniqueId);
saveButton.prop("value"," ").prop("disabled",true);
saveButton.addClass("ipass-save-image");
editTextBox.prop("disabled",true);
var actionText=editTextBox.val();
if(actionText){var cclParam=CERN_IPASS_O1.createJSONRequest(personId+".0",saveContainer.attr("data-enc-id")+".0","0.0","0.0",saveContainer.attr("data-action-id"),"0.0","ACTION","MODIFY","0.0",actionText,saveContainer.attr("data-upd-cnt"),"",0,0,"0.0");
self.m_iPassActionsRef=saveContainer.children(".ipass-actions-edit");
CERN_IPASS_O1.loadWithCBParameters("mp_upd_pct_ipass",["^MINE^"],cclParam,function(response){self.updateAction(response);
},false);
}}else{buttonsContainer=$("#ipassActionsWrapper"+uniqueId).children(".ipass-actions-div");
textArea=$("#iPassActionsTextBox"+uniqueId);
encounterId=buttonsContainer.attr("data-enc-id");
saveButton=saveContainer.find(".ipass-actions-savebutton");
var actionText=textArea.val();
if(actionText===CERN_IPASS_ACTIONS_O1.actionsI18N.ADD_NEW_ACTION){return 1;
}saveButton.prop("value","       ").prop("disabled",true);
saveButton.addClass("ipass-save-image");
textArea.prop("disabled",true);
var errorObj=buttonsContainer.find(".error-icon-component");
if(errorObj.length){errorObj.remove();
buttonsContainer.find(".ipass-actions-field-max").removeClass("hidden");
}if(actionText.length>255){textArea.val(actionText.substr(0,255));
buttonsContainer.find(".ipass-actions-field-max").html(actionText.length+" "+CERN_IPASS_ACTIONS_O1.iPassI18N.CHARACTERS_LEFT).addClass("ipass-actions-field-textfull");
}if(actionText&&encounterId){var cclParam=CERN_IPASS_O1.createJSONRequest(this.m_personId+".0",encounterId+".0","0.0","0.0","0.0","0.0","ACTION","ADD","0.0",actionText,0,"",0,0,this.getSelectedCareTeamId()+".0");
self.m_iPassActionsRef=saveButton.parent();
CERN_IPASS_O1.loadWithCBParameters("mp_upd_pct_ipass",["^MINE^"],cclParam,function(response){self.updateAction(response);
},false);
}}};
IPASSActions.prototype.actionDeleteConfirmation=function(actionDeleteSource){var uniqueId=this.m_uniqueId;
var self=this;
var errorDivElement=$("#ipass-action-err"+uniqueId);
errorDivElement.addClass("hidden");
errorDivElement.removeClass("ipass-err-adj");
var actionDelObj=$(actionDeleteSource).parent();
var previousDelete=$("#iPassActionsList"+uniqueId).find(".ipass-actions-delete-action");
if(previousDelete.length){previousDelete.find("input").removeAttr("disabled").css("cursor","pointer");
previousDelete.removeClass("ipass-actions-delete-action");
previousDelete.find(".ipass-actions-confirmicon").remove();
previousDelete.find(".ipass-actions-separator-container").remove();
}var encounterId=actionDelObj.attr("data-enc-id");
var actionText=actionDelObj.find(".ipass-actions-data").html();
var parentDL=actionDelObj.closest("dl");
if(actionText&&encounterId){if(parentDL.hasClass("ipass-actions-current")){actionDelObj.removeClass("ipass-actions-hover ipass-actions-del-hover").addClass("ipass-actions-delete-action");
actionDelObj.find("input").attr("disabled","disabled").css("cursor","default");
var deleteButton=("<input class='ipass-actionsdelbutton' id='idActionsDelButton"+uniqueId+"' type='button' name='actiondel' value='"+CERN_IPASS_ACTIONS_O1.iPassI18N.DELETE+"'></input>");
var cancelButton=("<input class='ipass-actionscanbutton' id='idActionsCanButton"+uniqueId+"' type='button' name='ipass-actionscancel' value='"+CERN_IPASS_ACTIONS_O1.iPassI18N.CANCEL+"'></input>");
var confirmContainer=$("<div class='ipass-actions-confirmicon'><span class='del-confirm'>"+CERN_IPASS_ACTIONS_O1.actionsI18N.CONFIRM_MSG+"</span><span class='ipass-delete-confirm-buttons'>"+deleteButton+cancelButton+"</span></div>");
actionDeleteSource.siblings(".ipass-actions-author-container").after(confirmContainer);
}else{self.actionDeletion(actionDeleteSource);
}}};
IPASSActions.prototype.actionDeletion=function(actionDelete){var self=this;
var actionDelObj=$(actionDelete).closest(".ipass-actions-txt");
var encounterId=actionDelObj.attr("data-enc-id");
var actionID=actionDelObj.attr("data-action-id")+".00";
var actionText=actionDelObj.find(".ipass-actions-data").html();
var actionUpdCnt=actionDelObj.attr("data-upd-cnt");
var cclParam=CERN_IPASS_O1.createJSONRequest(this.m_personId+".0",encounterId+".0","0.0","0.0",actionID,"0.0","ACTION","DELETE","0.0",actionText,actionUpdCnt,"",0,0,"0.0");
self.m_iPassActionsRef=$(actionDelete);
CERN_IPASS_O1.loadWithCBParameters("mp_upd_pct_ipass",["^MINE^"],cclParam,function(response){self.updateAction(response);
},false);
};
IPASSActions.prototype.actionEdit=function(actionEditSource){var uniqueId=this.m_uniqueId;
if(!actionEditSource.hasClass("ipass-actions-edit-active")){return;
}var actionEditObj=actionEditSource.closest(".ipass-actions-txt");
var ipassActionsData=actionEditObj.children(".ipass-actions-itm").children(".ipass-actions-data");
var charsLeft=(255-ipassActionsData.text().length);
var charsFull="";
var previousEdit=$("#iPassActionsActiveItems"+uniqueId).find(".ipass-actions-edit-action");
if(previousEdit.length){previousEdit.find("input").removeClass("hidden");
previousEdit.find(".ipass-actions-data").removeClass("hidden");
previousEdit.find(".ipass-actions-author-timestamp").removeClass("hidden");
previousEdit.removeClass("ipass-actions-edit-action");
$("#iPassEditActionsID"+uniqueId).remove();
previousEdit.find(".ipass-actions-new").remove();
}actionEditObj.removeClass("ipass-actions-hover ipass-actions-del-hover").addClass("ipass-actions-edit-action");
actionEditObj.find("input").addClass("hidden");
if(charsLeft<=0){charsFull="ipass-actions-field-textfull";
}ipassActionsData.after("<textarea id='iPassActionsEditTextBox' class='ipass-actions-new' maxlength='255' rows='4' >"+$.trim(ipassActionsData.text())+"</textarea>");
ipassActionsData.addClass("hidden");
actionEditObj.children(".ipass-actions-author-container").children(".ipass-actions-author-timestamp").addClass("hidden");
var saveButton=("<input class='ipass-actions-savebutton' id='idActionsEditSaveButton"+uniqueId+"' type='button' name='ipass-actionssave' value='"+CERN_IPASS_ACTIONS_O1.iPassI18N.SAVE+"' disabled></input>");
var cancelButton=("<input class='ipass-actions-cansavebutton' id='idActionsEditCancelButton"+uniqueId+"' type='button' name='ipass-actionscancel' value='"+CERN_IPASS_ACTIONS_O1.iPassI18N.CANCEL+"'></input>");
var editTextareaButtons=$("<div id='iPassEditActionsID"+uniqueId+"' class='ipass-actions-textarea-buttons'><span class='ipass-actions-field-max "+charsFull+"'>"+charsLeft+" "+CERN_IPASS_ACTIONS_O1.iPassI18N.CHARACTERS_LEFT+"</span><span class='ipass-edit-confirm-buttons'>"+saveButton+cancelButton+"</span></div>");
actionEditObj.append(editTextareaButtons);
};
IPASSActions.prototype.updateAction=function(response){var sourceObj=this.m_iPassActionsRef;
var uniqueId=this.m_uniqueId;
if(response){var jsReply=response.getResponse();
if(response.getStatus()!=="S"){MP_Util.LogScriptCallError(null,this,"ipass-actions.js","updateAction");
this.sytemFailureMessage(sourceObj);
return;
}var encounterId=sourceObj.attr("data-enc-id");
var actionId=jsReply.RECORDS[0].PCT_IPASS_ID;
var actionText=unescape(jsReply.RECORDS[0].TEXT);
var actionUpdCnt=jsReply.RECORDS[0].UPDT_CNT;
var actionUpdById=jsReply.RECORDS[0].UPDT_BY_ID;
var personnelArray=MP_Util.LoadPersonelListJSON(jsReply.PRSNL);
var actionProvider=MP_Util.GetValueFromArray(actionUpdById,personnelArray);
var actionAuthor=$.trim(actionProvider.fullName);
var df=new mp_formatter.DateTimeFormatter(MPAGE_LOCALE);
var actionUpdateDtTm=df.formatISO8601(jsReply.RECORDS[0].UPDT_DATE,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_2YEAR);
var personnelId=this.getCriterion().provider_id;
var actionHTML="";
var actionEditable="";
if(sourceObj.hasClass("ipass-actions-save")){if(actionUpdById===personnelId){actionEditable="ipass-actions-edit-active";
}actionHTML+="<dd class='ipass-actions-txt ipass-actions-active-txt-color' id='action"+actionId+uniqueId+"' data-enc-id='"+encounterId+"' data-action-id='"+actionId+"' data-upd-cnt='"+actionUpdCnt+"'><span  class='ipass-actions-itm'><span class='ipass-actions-chk'><input type='checkbox' /></span><span class= 'ipass-actions-data'>"+actionText+"</span></span><span class='ipass-actions-edit "+actionEditable+"'>&nbsp;</span><span class='ipass-actions-del ipass-actions-active-item'><span class='hidden'>&nbsp;</span></span>";
actionHTML+="<span class='ipass-actions-author-container'><span class='ipass-actions-author-timestamp' data-ipass-actions-orig-auth-id='"+actionUpdById+"' data-ipass-actions-orig-author-dt-tm='"+actionAuthor+" "+actionUpdateDtTm+"'>"+actionAuthor+" "+actionUpdateDtTm+"</span></span></dd>";
$("#iPassActionsList"+uniqueId).find(".ipass-actions-current").prepend(actionHTML);
$("#iPassActionsTextBox"+uniqueId).val(CERN_IPASS_ACTIONS_O1.actionsI18N.ADD_NEW_ACTION).removeAttr("disabled").css({color:"#AAA",background:"#FFF"});
var addTodoControls=$("#iPassActionsID"+uniqueId);
addTodoControls.find(".error-icon-component").remove();
addTodoControls.find(".ipass-actions-savebutton").attr("value",CERN_IPASS_ACTIONS_O1.iPassI18N.SAVE).attr("disabled","disabled").removeClass("ipass-save-image");
addTodoControls.find(".ipass-actions-field-max").removeClass("ipass-actions-field-textfull");
addTodoControls.find(".ipass-loading").remove();
addTodoControls.addClass("hidden");
}else{if(sourceObj.hasClass("ipass-actions-del")){$("#action"+actionId+uniqueId).remove();
}else{if(sourceObj.hasClass("ipass-actions-chk")){var checkedToDo=$("#action"+actionId+uniqueId);
var tempAuthorText="";
var ipassOrigAuthorDtTm=checkedToDo.children(".ipass-actions-author-container").children(".ipass-actions-author-timestamp");
checkedToDo.removeClass("ipass-actions-hover");
if(sourceObj.find("input").is(":checked")){checkedToDo.find(".ipass-actions-data").addClass("ipass-actions-strike");
checkedToDo.removeClass("ipass-actions-active-txt-color").addClass("ipass-actions-done-txt-color");
checkedToDo.attr("data-upd-cnt",actionUpdCnt);
tempAuthorText=ipassOrigAuthorDtTm.text();
ipassOrigAuthorDtTm.attr("data-ipass-actions-orig-author-dt-tm",tempAuthorText);
ipassOrigAuthorDtTm.text(actionAuthor+" "+actionUpdateDtTm);
checkedToDo.children(".ipass-actions-edit").removeClass("ipass-actions-edit-active");
$("#iPassActionsDoneItems"+uniqueId).prepend(checkedToDo);
}else{checkedToDo.find(".ipass-actions-data").removeClass("ipass-actions-strike");
checkedToDo.removeClass("ipass-actions-done-txt-color").addClass("ipass-actions-active-txt-color");
checkedToDo.attr("data-upd-cnt",actionUpdCnt);
ipassOrigAuthorDtTm.text(ipassOrigAuthorDtTm.attr("data-ipass-actions-orig-author-dt-tm"));
if(parseInt(ipassOrigAuthorDtTm.attr("data-ipass-actions-orig-auth-id"),10)===personnelId){checkedToDo.children(".ipass-actions-edit").addClass("ipass-actions-edit-active");
}$("#iPassActionsActiveItems"+uniqueId).prepend(checkedToDo);
}}else{if(sourceObj.hasClass("ipass-actions-edit-active")){var actionsItem=sourceObj.siblings(".ipass-actions-itm");
actionsItem.children("#iPassActionsEditTextBox").remove();
actionsItem.children(".ipass-actions-data").removeClass("hidden").text(actionText);
actionsItem.find("input").prop("disabled",false).css("cursor","pointer");
actionsItem.closest(".ipass-actions-txt").removeClass("ipass-actions-edit-action").attr("data-upd-cnt",actionUpdCnt);
$(".ipass-actions-textarea-buttons").remove();
actionsItem.find("input").removeClass("hidden");
sourceObj.siblings(".ipass-actions-author-container").children(".ipass-actions-author-timestamp").removeClass("hidden");
}}}}var activeCnt=$("#iPassActionsActiveItems"+uniqueId).find("dd").length;
var doneCnt=$("#iPassActionsDoneItems"+uniqueId).find("dd").length;
var ipassActionNoDataID=$("#ipassActiNoDataId"+uniqueId);
var ipassActiNoActiveDataId=$("#ipassActiNoActiveDataId"+uniqueId);
var iPassActionsShowCompleted=$("#iPassActionsShowCompleted"+uniqueId);
var iPassActionsDoneCnt=$("#iPassActionsDoneCnt"+uniqueId);
if(!activeCnt&&!doneCnt){ipassActionNoDataID.removeClass("hidden");
ipassActiNoActiveDataId.addClass("hidden");
iPassActionsShowCompleted.addClass("hidden");
iPassActionsDoneCnt.html("("+doneCnt+")");
}else{ipassActionNoDataID.addClass("hidden");
if(activeCnt){ipassActiNoActiveDataId.addClass("hidden");
}else{ipassActiNoActiveDataId.removeClass("hidden");
}if(doneCnt){iPassActionsShowCompleted.removeClass("hidden");
}else{iPassActionsShowCompleted.addClass("hidden");
}iPassActionsDoneCnt.html("("+doneCnt+")");
}}};
IPASSActions.prototype.sytemFailureMessage=function(sourceElement){var uniqueId=this.m_uniqueId;
var sourceObj=$(sourceElement);
var errorMsg="";
var errorHTML="";
var actionsControl=$("#iPassActionsID"+uniqueId);
var errorDivElement=$("#ipass-action-err"+uniqueId);
if(sourceObj.hasClass("ipass-actions-save")){errorMsg=CERN_IPASS_ACTIONS_O1.actionsI18N.UNABLE_ADD_ACTION;
errorHTML=MP_Core.generateUserMessageHTML("error",errorMsg," "+CERN_IPASS_O1.iPassI18n.NETWORK_FAIL,"inline-message");
errorDivElement.html(errorHTML);
actionsControl.find(".ipass-actions-savebutton").attr("value",CERN_IPASS_ACTIONS_O1.iPassI18N.RETRY).removeAttr("disabled");
actionsControl.prev().removeAttr("disabled");
actionsControl.find("img").remove();
errorDivElement.removeClass("hidden");
errorDivElement.addClass("ipass-err-adj");
return;
}if(sourceObj.hasClass("ipass-actions-chk")){if(sourceElement.find("input").is(":checked")){errorMsg=CERN_IPASS_ACTIONS_O1.actionsI18N.UNABLE_ACTION_COMPLETE.replace("{0}",'"'+CERN_IPASS_ACTIONS_O1.actionsI18N.COMPLETE+'."');
errorHTML=MP_Core.generateUserMessageHTML("error",errorMsg," "+CERN_IPASS_O1.iPassI18n.NETWORK_FAIL,"inline-message");
errorDivElement.html(errorHTML);
errorDivElement.removeClass("hidden");
errorDivElement.addClass("ipass-err-adj");
sourceElement.find("input").attr("checked",false);
}else{errorMsg=CERN_IPASS_ACTIONS_O1.actionsI18N.UNABLE_ACTION_ACTIVE.replace("{0}",'"'+CERN_IPASS_ACTIONS_O1.actionsI18N.ACTIVE+'."');
errorHTML=MP_Core.generateUserMessageHTML("error",errorMsg," "+CERN_IPASS_O1.iPassI18n.NETWORK_FAIL,"inline-message");
errorDivElement.html(errorHTML);
sourceElement.attr("checked",true);
errorDivElement.removeClass("hidden");
errorDivElement.addClass("ipass-err-adj");
}return;
}if(sourceObj.hasClass("ipass-actions-del")){errorMsg=CERN_IPASS_ACTIONS_O1.actionsI18N.UNABLE_ACTION_DELETE;
errorHTML=MP_Core.generateUserMessageHTML("error",errorMsg," "+CERN_IPASS_O1.iPassI18n.NETWORK_FAIL,"inline-message");
errorDivElement.html(errorHTML);
errorDivElement.removeClass("hidden");
errorDivElement.addClass("ipass-err-adj");
return;
}};
