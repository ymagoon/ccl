function PregnancyRiskFactorComponentStyle(){this.initByNamespace("prf");
}PregnancyRiskFactorComponentStyle.inherits(ComponentStyle);
function PregnancyRiskFactorComponent(criterion){this.setCriterion(criterion);
this.setStyles(new PregnancyRiskFactorComponentStyle());
this.setComponentLoadTimerName("USR:MPG.PREGRISKFACTOR.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.PREGRISKFACTOR.O1 - render component");
this.setIncludeLineNumber(true);
this.setScope(1);
PregnancyRiskFactorComponent.inherits(MPageComponent);
this.setPregnancyLookbackInd(true);
this.setResourceRequired(true);
CERN_EventListener.addListener(this,EventListener.EVENT_CLINICAL_EVENT,this.retrieveComponentData,this);
CERN_EventListener.addListener(this,"pregnancyInfoAvailable",this.retrieveComponentData,this);
}PregnancyRiskFactorComponent.prototype=new MPageComponent();
PregnancyRiskFactorComponent.prototype.constructor=MPageComponent;
MP_Util.setObjectDefinitionMapping("PREG_RISK_FACTORS",PregnancyRiskFactorComponent);
PregnancyRiskFactorComponent.prototype.RetrieveRequiredResources=function(){var pregInfoSR=MP_Resources.getSharedResource("pregnancyInfo");
if(pregInfoSR&&pregInfoSR.isResourceAvailable()){this.retrieveComponentData();
}else{PREGNANCY_BASE_UTIL_O1.LoadPregnancyData(this.getCriterion());
}};
PregnancyRiskFactorComponent.prototype.retrieveComponentData=function(){try{var rfi18n=i18n.discernabu.pregnancy_risk_factor_o1;
var component=this;
var criterion=this.getCriterion();
var encntrs=criterion.getPersonnelInfo().getViewableEncounters();
var encntrVal=(encntrs)?"value("+encntrs+")":"0.0";
var groups=this.getGroups();
var componentHTML="";
var pregInfoObj=null;
var pregInfoSR=MP_Resources.getSharedResource("pregnancyInfo");
var pregnancyId=0;
var sendAr=[];
var countText="";
var patientGenderInfo=criterion.getPatientInfo().getSex();
if(patientGenderInfo===null||patientGenderInfo.meaning===null||patientGenderInfo.meaning!=="FEMALE"){componentHTML="<h3 class='info-hd'><span class='res-normal'>"+rfi18n.NOT_FEMALE+"</span></h3><span class='res-none'>"+rfi18n.NOT_FEMALE+"</span>";
this.finalizeComponent(componentHTML,countText);
return;
}else{if(pregInfoSR&&pregInfoSR.isResourceAvailable()){pregInfoObj=pregInfoSR.getResourceData();
pregnancyId=pregInfoObj.getPregnancyId();
if(pregnancyId===-1){componentHTML="<h3 class='info-hd'><span class='res-normal'>"+rfi18n.PREG_DATA_ERROR+"</span></h3><span class='res-none'>"+rfi18n.PREG_DATA_ERROR+"</span>";
this.finalizeComponent(componentHTML,countText);
return;
}else{if(!pregnancyId){componentHTML="<h3 class='info-hd'><span class='res-normal'>"+rfi18n.PREGNANCY_NOT_FOUND+"</span></h3><span class='res-none'>"+rfi18n.PREGNANCY_NOT_FOUND+"</span>";
this.finalizeComponent(componentHTML,countText);
return;
}else{var rfEventSetCodes="^^";
var groupLength=groups.length;
if(groups&&groupLength>0){var group=groups[0];
if(group.getGroupName()=="PREG_RISK_FACTORS_CE"){rfEventSetCodes=MP_Util.CreateParamArray(group.getEventCodes(),1);
}}sendAr.push("^MINE^",criterion.person_id+".0",criterion.provider_id+".0",encntrVal,rfEventSetCodes,criterion.ppr_cd+".0",pregInfoObj.getLookBack());
var request=new MP_Core.ScriptRequest(this,this.getComponentLoadTimerName());
request.setProgramName("MP_GET_RISK_FACTORS");
request.setParameters(sendAr);
request.setAsync(true);
MP_Core.XMLCCLRequestCallBack(this,request,function(reply){component.renderComponent(reply.getResponse());
return;
});
}}}}}catch(err){MP_Util.LogJSError(err,this,"pregnancy-risk-factors.js","retrieveComponentData");
throw (err);
}};
PregnancyRiskFactorComponent.prototype.renderComponent=function(recordData){var timerRenderComponent=MP_Util.CreateTimer(this.getComponentRenderTimerName(),this.getCriterion().category_mean);
try{var rfi18n=i18n.discernabu.pregnancy_risk_factor_o1;
var componentResultCount=0;
var compId=this.getComponentId();
var criterion=this.getCriterion();
var jsPregnancyRiskFactorHTML=[];
var pregnancyRiskFactorHTML="";
var df=MP_Util.GetDateFormatter();
var slaTimer=MP_Util.CreateTimer("CAP:MPG.PREGRISKFACTOR.O1 - rendering component");
if(slaTimer){slaTimer.SubtimerName=criterion.category_mean;
slaTimer.Stop();
}var pregnancyRiskFactorsData=recordData.RISKFACTORLIST;
var rfDataLength=pregnancyRiskFactorsData.length;
var i=0;
if(rfDataLength>0){var colonSpace=": ";
var colon=":";
var commaSpace=", ";
var arrRiskFactors=[];
var arrOtherRiskFactors=[];
var strOther="";
var strOtherResults="";
var strOtherLength=0;
var riskFactorKeys=[];
for(i=0;
i<rfDataLength;
i++){var allRiskFactorResults=pregnancyRiskFactorsData[i].RISK_FACTOR_RESULT;
var rfFreeTextData=pregnancyRiskFactorsData[i].FREE_TEXT_RISK_FACTOR_RESULT.split(":");
var rfFreeTextResult="";
if(rfFreeTextData.length>0){strOther=rfFreeTextData[0]+colonSpace;
strOtherResults=commaSpace+rfFreeTextData[0]+colon;
if(rfFreeTextData.length>1){strOtherLength=strOther.length;
rfFreeTextResult=pregnancyRiskFactorsData[i].FREE_TEXT_RISK_FACTOR_RESULT.substr(strOtherLength);
}}var pregnancyRiskFactorDTAResults="";
var rfDTAResults="";
var rfDataSeparator=recordData.RISK_FACTOR_SEPARATOR;
if(strOther){pregnancyRiskFactorDTAResults=allRiskFactorResults.indexOf(strOther)===0?"":allRiskFactorResults.split(strOtherResults)[0];
rfDTAResults=pregnancyRiskFactorDTAResults.split(rfDataSeparator);
}else{pregnancyRiskFactorDTAResults=allRiskFactorResults;
rfDTAResults=pregnancyRiskFactorDTAResults.split(rfDataSeparator);
}var dateTimeObj=new Date();
dateTimeObj.setISO8601(pregnancyRiskFactorsData[i].RISK_FACTOR_START_DT_TM);
var rfDateTimeValue=dateFormat(dateTimeObj,dateFormat.masks.longDate);
var rfAddedBy=pregnancyRiskFactorsData[i].RISK_FACTOR_ADDED_BY;
if(rfFreeTextResult){arrOtherRiskFactors.push({RiskFactor:rfFreeTextResult,AddedBy:rfAddedBy,DateAdded:rfDateTimeValue});
}var rfDTAResultsLength=rfDTAResults.length;
if(pregnancyRiskFactorDTAResults){for(var j=0;
j<rfDTAResultsLength;
j++){if(!riskFactorKeys[rfDTAResults[j]]){riskFactorKeys[rfDTAResults[j]]=[{AddedBy:rfAddedBy,FullDate:rfDateTimeValue,DateObject:dateTimeObj}];
}}}}var key=[];
for(key in riskFactorKeys){if(riskFactorKeys.hasOwnProperty(key)){pregnancyRiskFactorData=riskFactorKeys[key][0];
if(pregnancyRiskFactorData&&key!==strOther){arrRiskFactors.push({RiskFactor:key,AddedBy:pregnancyRiskFactorData.AddedBy,DateAdded:pregnancyRiskFactorData.FullDate,ISODateAdded:pregnancyRiskFactorData.DateObject});
}}}arrRiskFactors.sort(this.riskFactorDateSort);
arrOtherRiskFactors.reverse();
var riskFactorTable=new ComponentTable();
riskFactorTable.setNamespace(this.getStyles().getNameSpace());
riskFactorTable.setZebraStripe(true);
var resultColumn=new TableColumn();
resultColumn.setColumnId("RiskFactor"+compId);
resultColumn.setCustomClass("prf-table-header-column");
resultColumn.setColumnDisplay(rfi18n.RISK_FACTOR);
resultColumn.setPrimarySortField("RiskFactor");
resultColumn.setRenderTemplate("${RiskFactor}");
var addedByColumn=new TableColumn();
addedByColumn.setColumnId("AddedBy"+compId);
addedByColumn.setCustomClass("prf-table-header-column");
addedByColumn.setColumnDisplay(rfi18n.ADDED_BY);
addedByColumn.setPrimarySortField("AddedBy");
addedByColumn.setRenderTemplate("${AddedBy}");
var dateColumn=new TableColumn();
dateColumn.setColumnId("DateAdded"+compId);
dateColumn.setCustomClass("prf-table-header-column");
dateColumn.setColumnDisplay(rfi18n.DATE_ADDED);
dateColumn.setPrimarySortField("DateAdded");
dateColumn.setRenderTemplate("${DateAdded}");
riskFactorTable.addColumn(resultColumn);
riskFactorTable.addColumn(addedByColumn);
riskFactorTable.addColumn(dateColumn);
var riskFactorsLength=arrRiskFactors.length;
var otherRiskFactorsLength=arrOtherRiskFactors.length;
var hoverExtension=new TableCellHoverExtension();
hoverExtension.addHoverForColumn(resultColumn,function(dataObj){return"<span class='prf-table-data-hover'>"+dataObj.RESULT_DATA.RiskFactor+"</span>";
});
hoverExtension.addHoverForColumn(addedByColumn,function(dataObj){return"<span class='prf-table-data-hover'>"+dataObj.RESULT_DATA.AddedBy+"</span>";
});
hoverExtension.addHoverForColumn(dateColumn,function(dataObj){return"<span class='prf-table-data-hover'>"+dataObj.RESULT_DATA.DateAdded+"</span>";
});
riskFactorTable.addExtension(hoverExtension);
if(riskFactorsLength>0){var riskFactorsGrp=new TableGroup();
var riskFactorHdr=rfi18n.RISK_FACTOR;
riskFactorsGrp.setDisplay(riskFactorHdr).setGroupId("RISK_FACTORS"+compId).setShowCount(false);
riskFactorsGrp.bindData(arrRiskFactors);
riskFactorTable.addGroup(riskFactorsGrp);
}if(otherRiskFactorsLength>0){var otherRiskFactorsGrp=new TableGroup();
var otherRiskFactorsHdr=rfi18n.OTHER;
otherRiskFactorsGrp.setDisplay(otherRiskFactorsHdr).setGroupId("OTHERS"+compId).setShowCount(false);
otherRiskFactorsGrp.bindData(arrOtherRiskFactors);
riskFactorTable.addGroup(otherRiskFactorsGrp);
}this.setComponentTable(riskFactorTable);
jsPregnancyRiskFactorHTML.push(riskFactorTable.render());
pregnancyRiskFactorHTML=jsPregnancyRiskFactorHTML.join("");
componentResultCount=riskFactorsLength+otherRiskFactorsLength;
this.finalizeComponent(pregnancyRiskFactorHTML,MP_Util.CreateTitleText(this,componentResultCount));
riskFactorTable.updateAfterResize=function(){ComponentTable.prototype.updateAfterResize.call(this);
$("#prf\\:RISK_FACTORS"+compId+"\\:header").addClass("prf-table-section-header");
};
}else{pregnancyRiskFactorHTML="<span class='res-none'>"+rfi18n.NO_RISK_FACTOR_DATA+"</span>";
this.finalizeComponent(pregnancyRiskFactorHTML,MP_Util.CreateTitleText(this,componentResultCount));
}CERN_EventListener.fireEvent(this,this,EventListener.EVENT_COUNT_UPDATE,{count:componentResultCount});
}catch(err){MP_Util.LogJSError(err,this,"pregnancy-risk-factor.js","RenderComponent");
if(timerRenderComponent){timerRenderComponent.Abort();
timerRenderComponent=null;
}throw (err);
}finally{if(timerRenderComponent){timerRenderComponent.Stop();
}}};
PregnancyRiskFactorComponent.prototype.riskFactorDateSort=function(row1,row2){return(row1.ISODateAdded<row2.ISODateAdded)?1:-1;
};
