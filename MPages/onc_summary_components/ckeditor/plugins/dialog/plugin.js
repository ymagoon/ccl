CKEDITOR.DIALOG_RESIZE_NONE=0;
CKEDITOR.DIALOG_RESIZE_WIDTH=1;
CKEDITOR.DIALOG_RESIZE_HEIGHT=2;
CKEDITOR.DIALOG_RESIZE_BOTH=3;
(function(){var cssLength=CKEDITOR.tools.cssLength;
function isTabVisible(tabId){return !!this._.tabs[tabId][0].$.offsetHeight;
}function getPreviousVisibleTab(){var tabId=this._.currentTabId,length=this._.tabIdList.length,tabIndex=CKEDITOR.tools.indexOf(this._.tabIdList,tabId)+length;
for(var i=tabIndex-1;
i>tabIndex-length;
i--){if(isTabVisible.call(this,this._.tabIdList[i%length])){return this._.tabIdList[i%length];
}}return null;
}function getNextVisibleTab(){var tabId=this._.currentTabId,length=this._.tabIdList.length,tabIndex=CKEDITOR.tools.indexOf(this._.tabIdList,tabId);
for(var i=tabIndex+1;
i<tabIndex+length;
i++){if(isTabVisible.call(this,this._.tabIdList[i%length])){return this._.tabIdList[i%length];
}}return null;
}function clearOrRecoverTextInputValue(container,isRecover){var inputs=container.$.getElementsByTagName("input");
for(var i=0,length=inputs.length;
i<length;
i++){var item=new CKEDITOR.dom.element(inputs[i]);
if(item.getAttribute("type").toLowerCase()=="text"){if(isRecover){item.setAttribute("value",item.getCustomData("fake_value")||"");
item.removeCustomData("fake_value");
}else{item.setCustomData("fake_value",item.getAttribute("value"));
item.setAttribute("value","");
}}}}function handleFieldValidated(isValid,msg){var input=this.getInputElement();
if(input){isValid?input.removeAttribute("aria-invalid"):input.setAttribute("aria-invalid",true);
}if(!isValid){if(this.select){this.select();
}else{this.focus();
}}msg&&alert(msg);
this.fire("validated",{valid:isValid,msg:msg});
}function resetField(){var input=this.getInputElement();
input&&input.removeAttribute("aria-invalid");
}var templateSource='<div class="cke_reset_all {editorId} {editorDialogClass} {hidpi}" dir="{langDir}" lang="{langCode}" role="dialog" aria-labelledby="cke_dialog_title_{id}"><table class="cke_dialog '+CKEDITOR.env.cssClass+' cke_{langDir}" style="position:absolute" role="presentation"><tr><td role="presentation"><div class="cke_dialog_body" role="presentation"><div id="cke_dialog_title_{id}" class="cke_dialog_title" role="presentation"></div><a id="cke_dialog_close_button_{id}" class="cke_dialog_close_button" href="javascript:void(0)" title="{closeTitle}" role="button"><span class="cke_label">X</span></a><div id="cke_dialog_tabs_{id}" class="cke_dialog_tabs" role="tablist"></div><table class="cke_dialog_contents" role="presentation"><tr><td id="cke_dialog_contents_{id}" class="cke_dialog_contents_body" role="presentation"></td></tr><tr><td id="cke_dialog_footer_{id}" class="cke_dialog_footer" role="presentation"></td></tr></table></div></td></tr></table></div>';
function buildDialog(editor){var element=CKEDITOR.dom.element.createFromHtml(CKEDITOR.addTemplate("dialog",templateSource).output({id:CKEDITOR.tools.getNextNumber(),editorId:editor.id,langDir:editor.lang.dir,langCode:editor.langCode,editorDialogClass:"cke_editor_"+editor.name.replace(/\./g,"\\.")+"_dialog",closeTitle:editor.lang.common.close,hidpi:CKEDITOR.env.hidpi?"cke_hidpi":""}));
var body=element.getChild([0,0,0,0,0]),title=body.getChild(0),close=body.getChild(1);
if(CKEDITOR.env.ie&&!CKEDITOR.env.ie6Compat){var src="javascript:void(function(){"+encodeURIComponent("document.open();("+CKEDITOR.tools.fixDomain+")();document.close();")+"}())",iframe=CKEDITOR.dom.element.createFromHtml('<iframe frameBorder="0" class="cke_iframe_shim" src="'+src+'" tabIndex="-1"></iframe>');
iframe.appendTo(body.getParent());
}title.unselectable();
close.unselectable();
return{element:element,parts:{dialog:element.getChild(0),title:title,close:close,tabs:body.getChild(2),contents:body.getChild([3,0,0,0]),footer:body.getChild([3,0,1,0])}};
}CKEDITOR.dialog=function(editor,dialogName){var definition=CKEDITOR.dialog._.dialogDefinitions[dialogName],defaultDefinition=CKEDITOR.tools.clone(defaultDialogDefinition),buttonsOrder=editor.config.dialog_buttonsOrder||"OS",dir=editor.lang.dir,tabsToRemove={},i,processed,stopPropagation;
if((buttonsOrder=="OS"&&CKEDITOR.env.mac)||(buttonsOrder=="rtl"&&dir=="ltr")||(buttonsOrder=="ltr"&&dir=="rtl")){defaultDefinition.buttons.reverse();
}definition=CKEDITOR.tools.extend(definition(editor),defaultDefinition);
definition=CKEDITOR.tools.clone(definition);
definition=new definitionObject(this,definition);
var doc=CKEDITOR.document;
var themeBuilt=buildDialog(editor);
this._={editor:editor,element:themeBuilt.element,name:dialogName,contentSize:{width:0,height:0},size:{width:0,height:0},contents:{},buttons:{},accessKeyMap:{},tabs:{},tabIdList:[],currentTabId:null,currentTabIndex:null,pageCount:0,lastTab:null,tabBarMode:false,focusList:[],currentFocusIndex:0,hasFocus:false};
this.parts=themeBuilt.parts;
CKEDITOR.tools.setTimeout(function(){editor.fire("ariaWidget",this.parts.contents);
},0,this);
var startStyles={position:CKEDITOR.env.ie6Compat?"absolute":"fixed",top:0,visibility:"hidden"};
startStyles[dir=="rtl"?"right":"left"]=0;
this.parts.dialog.setStyles(startStyles);
CKEDITOR.event.call(this);
this.definition=definition=CKEDITOR.fire("dialogDefinition",{name:dialogName,definition:definition},editor).definition;
if(!("removeDialogTabs" in editor._)&&editor.config.removeDialogTabs){var removeContents=editor.config.removeDialogTabs.split(";");
for(i=0;
i<removeContents.length;
i++){var parts=removeContents[i].split(":");
if(parts.length==2){var removeDialogName=parts[0];
if(!tabsToRemove[removeDialogName]){tabsToRemove[removeDialogName]=[];
}tabsToRemove[removeDialogName].push(parts[1]);
}}editor._.removeDialogTabs=tabsToRemove;
}if(editor._.removeDialogTabs&&(tabsToRemove=editor._.removeDialogTabs[dialogName])){for(i=0;
i<tabsToRemove.length;
i++){definition.removeContents(tabsToRemove[i]);
}}if(definition.onLoad){this.on("load",definition.onLoad);
}if(definition.onShow){this.on("show",definition.onShow);
}if(definition.onHide){this.on("hide",definition.onHide);
}if(definition.onOk){this.on("ok",function(evt){editor.fire("saveSnapshot");
setTimeout(function(){editor.fire("saveSnapshot");
},0);
if(definition.onOk.call(this,evt)===false){evt.data.hide=false;
}});
}if(definition.onCancel){this.on("cancel",function(evt){if(definition.onCancel.call(this,evt)===false){evt.data.hide=false;
}});
}var me=this;
var iterContents=function(func){var contents=me._.contents,stop=false;
for(var i in contents){for(var j in contents[i]){stop=func.call(this,contents[i][j]);
if(stop){return;
}}}};
this.on("ok",function(evt){iterContents(function(item){if(item.validate){var retval=item.validate(this),invalid=typeof(retval)=="string"||retval===false;
if(invalid){evt.data.hide=false;
evt.stop();
}handleFieldValidated.call(item,!invalid,typeof retval=="string"?retval:undefined);
return invalid;
}});
},this,null,0);
this.on("cancel",function(evt){iterContents(function(item){if(item.isChanged()){if(!confirm(editor.lang.common.confirmCancel)){evt.data.hide=false;
}return true;
}});
},this,null,0);
this.parts.close.on("click",function(evt){if(this.fire("cancel",{hide:true}).hide!==false){this.hide();
}evt.data.preventDefault();
},this);
function setupFocus(){var focusList=me._.focusList;
focusList.sort(function(a,b){if(a.tabIndex!=b.tabIndex){return b.tabIndex-a.tabIndex;
}else{return a.focusIndex-b.focusIndex;
}});
var size=focusList.length;
for(var i=0;
i<size;
i++){focusList[i].focusIndex=i;
}}function changeFocus(offset){var focusList=me._.focusList;
offset=offset||0;
if(focusList.length<1){return;
}var current=me._.currentFocusIndex;
try{focusList[current].getInputElement().$.blur();
}catch(e){}var startIndex=(current+offset+focusList.length)%focusList.length,currentIndex=startIndex;
while(offset&&!focusList[currentIndex].isFocusable()){currentIndex=(currentIndex+offset+focusList.length)%focusList.length;
if(currentIndex==startIndex){break;
}}focusList[currentIndex].focus();
if(focusList[currentIndex].type=="text"){focusList[currentIndex].select();
}}this.changeFocus=changeFocus;
function keydownHandler(evt){if(me!=CKEDITOR.dialog._.currentTop){return;
}var keystroke=evt.data.getKeystroke(),rtl=editor.lang.dir=="rtl",button;
processed=stopPropagation=0;
if(keystroke==9||keystroke==CKEDITOR.SHIFT+9){var shiftPressed=(keystroke==CKEDITOR.SHIFT+9);
if(me._.tabBarMode){var nextId=shiftPressed?getPreviousVisibleTab.call(me):getNextVisibleTab.call(me);
me.selectPage(nextId);
me._.tabs[nextId][0].focus();
}else{changeFocus(shiftPressed?-1:1);
}processed=1;
}else{if(keystroke==CKEDITOR.ALT+121&&!me._.tabBarMode&&me.getPageCount()>1){me._.tabBarMode=true;
me._.tabs[me._.currentTabId][0].focus();
processed=1;
}else{if((keystroke==37||keystroke==39)&&me._.tabBarMode){nextId=(keystroke==(rtl?39:37)?getPreviousVisibleTab.call(me):getNextVisibleTab.call(me));
me.selectPage(nextId);
me._.tabs[nextId][0].focus();
processed=1;
}else{if((keystroke==13||keystroke==32)&&me._.tabBarMode){this.selectPage(this._.currentTabId);
this._.tabBarMode=false;
this._.currentFocusIndex=-1;
changeFocus(1);
processed=1;
}else{if(keystroke==13){var target=evt.data.getTarget();
if(!target.is("a","button","select","textarea")&&(!target.is("input")||target.$.type!="button")){button=this.getButton("ok");
button&&CKEDITOR.tools.setTimeout(button.click,0,button);
processed=1;
}stopPropagation=1;
}else{if(keystroke==27){button=this.getButton("cancel");
if(button){CKEDITOR.tools.setTimeout(button.click,0,button);
}else{if(this.fire("cancel",{hide:true}).hide!==false){this.hide();
}}stopPropagation=1;
}else{return;
}}}}}}keypressHandler(evt);
}function keypressHandler(evt){if(processed){evt.data.preventDefault(1);
}else{if(stopPropagation){evt.data.stopPropagation();
}}}var dialogElement=this._.element;
editor.focusManager.add(dialogElement,1);
this.on("show",function(){dialogElement.on("keydown",keydownHandler,this);
if(CKEDITOR.env.opera||CKEDITOR.env.gecko){dialogElement.on("keypress",keypressHandler,this);
}});
this.on("hide",function(){dialogElement.removeListener("keydown",keydownHandler);
if(CKEDITOR.env.opera||CKEDITOR.env.gecko){dialogElement.removeListener("keypress",keypressHandler);
}iterContents(function(item){resetField.apply(item);
});
});
this.on("iframeAdded",function(evt){var doc=new CKEDITOR.dom.document(evt.data.iframe.$.contentWindow.document);
doc.on("keydown",keydownHandler,this,null,0);
});
this.on("show",function(){setupFocus();
if(editor.config.dialog_startupFocusTab&&me._.pageCount>1){me._.tabBarMode=true;
me._.tabs[me._.currentTabId][0].focus();
}else{if(!this._.hasFocus){this._.currentFocusIndex=-1;
if(definition.onFocus){var initialFocus=definition.onFocus.call(this);
initialFocus&&initialFocus.focus();
}else{changeFocus(1);
}}}},this,null,4294967295);
if(CKEDITOR.env.ie6Compat){this.on("load",function(evt){var outer=this.getElement(),inner=outer.getFirst();
inner.remove();
inner.appendTo(outer);
},this);
}initDragAndDrop(this);
initResizeHandles(this);
(new CKEDITOR.dom.text(definition.title,CKEDITOR.document)).appendTo(this.parts.title);
for(i=0;
i<definition.contents.length;
i++){var page=definition.contents[i];
page&&this.addPage(page);
}this.parts.tabs.on("click",function(evt){var target=evt.data.getTarget();
if(target.hasClass("cke_dialog_tab")){var id=target.$.id;
this.selectPage(id.substring(4,id.lastIndexOf("_")));
if(this._.tabBarMode){this._.tabBarMode=false;
this._.currentFocusIndex=-1;
changeFocus(1);
}evt.data.preventDefault();
}},this);
var buttonsHtml=[],buttons=CKEDITOR.dialog._.uiElementBuilders.hbox.build(this,{type:"hbox",className:"cke_dialog_footer_buttons",widths:[],children:definition.buttons},buttonsHtml).getChild();
this.parts.footer.setHtml(buttonsHtml.join(""));
for(i=0;
i<buttons.length;
i++){this._.buttons[buttons[i].id]=buttons[i];
}};
function Focusable(dialog,element,index){this.element=element;
this.focusIndex=index;
this.tabIndex=0;
this.isFocusable=function(){return !element.getAttribute("disabled")&&element.isVisible();
};
this.focus=function(){dialog._.currentFocusIndex=this.focusIndex;
this.element.focus();
};
element.on("keydown",function(e){if(e.data.getKeystroke() in {32:1,13:1}){this.fire("click");
}});
element.on("focus",function(){this.fire("mouseover");
});
element.on("blur",function(){this.fire("mouseout");
});
}function resizeWithWindow(dialog){var win=CKEDITOR.document.getWindow();
function resizeHandler(){dialog.layout();
}win.on("resize",resizeHandler);
dialog.on("hide",function(){win.removeListener("resize",resizeHandler);
});
}CKEDITOR.dialog.prototype={destroy:function(){this.hide();
this._.element.remove();
},resize:(function(){return function(width,height){if(this._.contentSize&&this._.contentSize.width==width&&this._.contentSize.height==height){return;
}CKEDITOR.dialog.fire("resize",{dialog:this,width:width,height:height},this._.editor);
this.fire("resize",{width:width,height:height},this._.editor);
var contents=this.parts.contents;
contents.setStyles({width:width+"px",height:height+"px"});
if(this._.editor.lang.dir=="rtl"&&this._.position){this._.position.x=CKEDITOR.document.getWindow().getViewPaneSize().width-this._.contentSize.width-parseInt(this._.element.getFirst().getStyle("right"),10);
}this._.contentSize={width:width,height:height};
};
})(),getSize:function(){var element=this._.element.getFirst();
return{width:element.$.offsetWidth||0,height:element.$.offsetHeight||0};
},move:function(x,y,save){var element=this._.element.getFirst(),rtl=this._.editor.lang.dir=="rtl";
var isFixed=element.getComputedStyle("position")=="fixed";
if(CKEDITOR.env.ie){element.setStyle("zoom","100%");
}if(isFixed&&this._.position&&this._.position.x==x&&this._.position.y==y){return;
}this._.position={x:x,y:y};
if(!isFixed){var scrollPosition=CKEDITOR.document.getWindow().getScrollPosition();
x+=scrollPosition.x;
y+=scrollPosition.y;
}if(rtl){var dialogSize=this.getSize(),viewPaneSize=CKEDITOR.document.getWindow().getViewPaneSize();
x=viewPaneSize.width-dialogSize.width-x;
}var styles={top:(y>0?y:0)+"px"};
styles[rtl?"right":"left"]=(x>0?x:0)+"px";
element.setStyles(styles);
save&&(this._.moved=1);
},getPosition:function(){return CKEDITOR.tools.extend({},this._.position);
},show:function(){var element=this._.element;
var definition=this.definition;
if(!(element.getParent()&&element.getParent().equals(CKEDITOR.document.getBody()))){element.appendTo(CKEDITOR.document.getBody());
}else{element.setStyle("display","block");
}if(CKEDITOR.env.gecko&&CKEDITOR.env.version<10900){var dialogElement=this.parts.dialog;
dialogElement.setStyle("position","absolute");
setTimeout(function(){dialogElement.setStyle("position","fixed");
},0);
}this.resize(this._.contentSize&&this._.contentSize.width||definition.width||definition.minWidth,this._.contentSize&&this._.contentSize.height||definition.height||definition.minHeight);
this.reset();
this.selectPage(this.definition.contents[0].id);
if(CKEDITOR.dialog._.currentZIndex===null){CKEDITOR.dialog._.currentZIndex=this._.editor.config.baseFloatZIndex;
}this._.element.getFirst().setStyle("z-index",CKEDITOR.dialog._.currentZIndex+=10);
if(CKEDITOR.dialog._.currentTop===null){CKEDITOR.dialog._.currentTop=this;
this._.parentDialog=null;
showCover(this._.editor);
}else{this._.parentDialog=CKEDITOR.dialog._.currentTop;
var parentElement=this._.parentDialog.getElement().getFirst();
parentElement.$.style.zIndex-=Math.floor(this._.editor.config.baseFloatZIndex/2);
CKEDITOR.dialog._.currentTop=this;
}element.on("keydown",accessKeyDownHandler);
element.on(CKEDITOR.env.opera?"keypress":"keyup",accessKeyUpHandler);
this._.hasFocus=false;
CKEDITOR.tools.setTimeout(function(){this.layout();
resizeWithWindow(this);
this.parts.dialog.setStyle("visibility","");
this.fireOnce("load",{});
CKEDITOR.ui.fire("ready",this);
this.fire("show",{});
this._.editor.fire("dialogShow",this);
if(!this._.parentDialog){this._.editor.focusManager.lock();
}this.foreach(function(contentObj){contentObj.setInitValue&&contentObj.setInitValue();
});
},100,this);
},layout:function(){var el=this.parts.dialog;
var dialogSize=this.getSize();
var win=CKEDITOR.document.getWindow(),viewSize=win.getViewPaneSize();
var posX=(viewSize.width-dialogSize.width)/2,posY=(viewSize.height-dialogSize.height)/2;
if(!CKEDITOR.env.ie6Compat){if(dialogSize.height+(posY>0?posY:0)>viewSize.height||dialogSize.width+(posX>0?posX:0)>viewSize.width){el.setStyle("position","absolute");
}else{el.setStyle("position","fixed");
}}this.move(this._.moved?this._.position.x:posX,this._.moved?this._.position.y:posY);
},foreach:function(fn){for(var i in this._.contents){for(var j in this._.contents[i]){fn.call(this,this._.contents[i][j]);
}}return this;
},reset:(function(){var fn=function(widget){if(widget.reset){widget.reset(1);
}};
return function(){this.foreach(fn);
return this;
};
})(),setupContent:function(){var args=arguments;
this.foreach(function(widget){if(widget.setup){widget.setup.apply(widget,args);
}});
},commitContent:function(){var args=arguments;
this.foreach(function(widget){if(CKEDITOR.env.ie&&this._.currentFocusIndex==widget.focusIndex){widget.getInputElement().$.blur();
}if(widget.commit){widget.commit.apply(widget,args);
}});
},hide:function(){if(!this.parts.dialog.isVisible()){return;
}this.fire("hide",{});
this._.editor.fire("dialogHide",this);
this.selectPage(this._.tabIdList[0]);
var element=this._.element;
element.setStyle("display","none");
this.parts.dialog.setStyle("visibility","hidden");
unregisterAccessKey(this);
while(CKEDITOR.dialog._.currentTop!=this){CKEDITOR.dialog._.currentTop.hide();
}if(!this._.parentDialog){hideCover(this._.editor);
}else{var parentElement=this._.parentDialog.getElement().getFirst();
parentElement.setStyle("z-index",parseInt(parentElement.$.style.zIndex,10)+Math.floor(this._.editor.config.baseFloatZIndex/2));
}CKEDITOR.dialog._.currentTop=this._.parentDialog;
if(!this._.parentDialog){CKEDITOR.dialog._.currentZIndex=null;
element.removeListener("keydown",accessKeyDownHandler);
element.removeListener(CKEDITOR.env.opera?"keypress":"keyup",accessKeyUpHandler);
var editor=this._.editor;
editor.focus();
setTimeout(function(){editor.focusManager.unlock();
},0);
}else{CKEDITOR.dialog._.currentZIndex-=10;
}delete this._.parentDialog;
this.foreach(function(contentObj){contentObj.resetInitValue&&contentObj.resetInitValue();
});
},addPage:function(contents){if(contents.requiredContent&&!this._.editor.filter.check(contents.requiredContent)){return;
}var pageHtml=[],titleHtml=contents.label?' title="'+CKEDITOR.tools.htmlEncode(contents.label)+'"':"",elements=contents.elements,vbox=CKEDITOR.dialog._.uiElementBuilders.vbox.build(this,{type:"vbox",className:"cke_dialog_page_contents",children:contents.elements,expand:!!contents.expand,padding:contents.padding,style:contents.style||"width: 100%;"},pageHtml);
var contentMap=this._.contents[contents.id]={},cursor,children=vbox.getChild(),enabledFields=0;
while((cursor=children.shift())){if(!cursor.notAllowed&&cursor.type!="hbox"&&cursor.type!="vbox"){enabledFields++;
}contentMap[cursor.id]=cursor;
if(typeof(cursor.getChild)=="function"){children.push.apply(children,cursor.getChild());
}}if(!enabledFields){contents.hidden=true;
}var page=CKEDITOR.dom.element.createFromHtml(pageHtml.join(""));
page.setAttribute("role","tabpanel");
var env=CKEDITOR.env;
var tabId="cke_"+contents.id+"_"+CKEDITOR.tools.getNextNumber(),tab=CKEDITOR.dom.element.createFromHtml(['<a class="cke_dialog_tab"',(this._.pageCount>0?" cke_last":"cke_first"),titleHtml,(!!contents.hidden?' style="display:none"':""),' id="',tabId,'"',env.gecko&&env.version>=10900&&!env.hc?"":' href="javascript:void(0)"',' tabIndex="-1"',' hidefocus="true"',' role="tab">',contents.label,"</a>"].join(""));
page.setAttribute("aria-labelledby",tabId);
this._.tabs[contents.id]=[tab,page];
this._.tabIdList.push(contents.id);
!contents.hidden&&this._.pageCount++;
this._.lastTab=tab;
this.updateStyle();
page.setAttribute("name",contents.id);
page.appendTo(this.parts.contents);
tab.unselectable();
this.parts.tabs.append(tab);
if(contents.accessKey){registerAccessKey(this,this,"CTRL+"+contents.accessKey,tabAccessKeyDown,tabAccessKeyUp);
this._.accessKeyMap["CTRL+"+contents.accessKey]=contents.id;
}},selectPage:function(id){if(this._.currentTabId==id){return;
}if(this.fire("selectPage",{page:id,currentPage:this._.currentTabId})===true){return;
}for(var i in this._.tabs){var tab=this._.tabs[i][0],page=this._.tabs[i][1];
if(i!=id){tab.removeClass("cke_dialog_tab_selected");
page.hide();
}page.setAttribute("aria-hidden",i!=id);
}var selected=this._.tabs[id];
selected[0].addClass("cke_dialog_tab_selected");
if(CKEDITOR.env.ie6Compat||CKEDITOR.env.ie7Compat){clearOrRecoverTextInputValue(selected[1]);
selected[1].show();
setTimeout(function(){clearOrRecoverTextInputValue(selected[1],1);
},0);
}else{selected[1].show();
}this._.currentTabId=id;
this._.currentTabIndex=CKEDITOR.tools.indexOf(this._.tabIdList,id);
},updateStyle:function(){this.parts.dialog[(this._.pageCount===1?"add":"remove")+"Class"]("cke_single_page");
},hidePage:function(id){var tab=this._.tabs[id]&&this._.tabs[id][0];
if(!tab||this._.pageCount==1||!tab.isVisible()){return;
}else{if(id==this._.currentTabId){this.selectPage(getPreviousVisibleTab.call(this));
}}tab.hide();
this._.pageCount--;
this.updateStyle();
},showPage:function(id){var tab=this._.tabs[id]&&this._.tabs[id][0];
if(!tab){return;
}tab.show();
this._.pageCount++;
this.updateStyle();
},getElement:function(){return this._.element;
},getName:function(){return this._.name;
},getContentElement:function(pageId,elementId){var page=this._.contents[pageId];
return page&&page[elementId];
},getValueOf:function(pageId,elementId){return this.getContentElement(pageId,elementId).getValue();
},setValueOf:function(pageId,elementId,value){return this.getContentElement(pageId,elementId).setValue(value);
},getButton:function(id){return this._.buttons[id];
},click:function(id){return this._.buttons[id].click();
},disableButton:function(id){return this._.buttons[id].disable();
},enableButton:function(id){return this._.buttons[id].enable();
},getPageCount:function(){return this._.pageCount;
},getParentEditor:function(){return this._.editor;
},getSelectedElement:function(){return this.getParentEditor().getSelection().getSelectedElement();
},addFocusable:function(element,index){if(typeof index=="undefined"){index=this._.focusList.length;
this._.focusList.push(new Focusable(this,element,index));
}else{this._.focusList.splice(index,0,new Focusable(this,element,index));
for(var i=index+1;
i<this._.focusList.length;
i++){this._.focusList[i].focusIndex++;
}}}};
CKEDITOR.tools.extend(CKEDITOR.dialog,{add:function(name,dialogDefinition){if(!this._.dialogDefinitions[name]||typeof dialogDefinition=="function"){this._.dialogDefinitions[name]=dialogDefinition;
}},exists:function(name){return !!this._.dialogDefinitions[name];
},getCurrent:function(){return CKEDITOR.dialog._.currentTop;
},isTabEnabled:function(editor,dialogName,tabName){var cfg=editor.config.removeDialogTabs;
return !(cfg&&cfg.match(new RegExp("(?:^|;)"+dialogName+":"+tabName+"(?:$|;)","i")));
},okButton:(function(){var retval=function(editor,override){override=override||{};
return CKEDITOR.tools.extend({id:"ok",type:"button",label:editor.lang.common.ok,"class":"cke_dialog_ui_button_ok",onClick:function(evt){var dialog=evt.data.dialog;
if(dialog.fire("ok",{hide:true}).hide!==false){dialog.hide();
}}},override,true);
};
retval.type="button";
retval.override=function(override){return CKEDITOR.tools.extend(function(editor){return retval(editor,override);
},{type:"button"},true);
};
return retval;
})(),cancelButton:(function(){var retval=function(editor,override){override=override||{};
return CKEDITOR.tools.extend({id:"cancel",type:"button",label:editor.lang.common.cancel,"class":"cke_dialog_ui_button_cancel",onClick:function(evt){var dialog=evt.data.dialog;
if(dialog.fire("cancel",{hide:true}).hide!==false){dialog.hide();
}}},override,true);
};
retval.type="button";
retval.override=function(override){return CKEDITOR.tools.extend(function(editor){return retval(editor,override);
},{type:"button"},true);
};
return retval;
})(),addUIElement:function(typeName,builder){this._.uiElementBuilders[typeName]=builder;
}});
CKEDITOR.dialog._={uiElementBuilders:{},dialogDefinitions:{},currentTop:null,currentZIndex:null};
CKEDITOR.event.implementOn(CKEDITOR.dialog);
CKEDITOR.event.implementOn(CKEDITOR.dialog.prototype);
var defaultDialogDefinition={resizable:CKEDITOR.DIALOG_RESIZE_BOTH,minWidth:600,minHeight:400,buttons:[CKEDITOR.dialog.okButton,CKEDITOR.dialog.cancelButton]};
var getById=function(array,id,recurse){for(var i=0,item;
(item=array[i]);
i++){if(item.id==id){return item;
}if(recurse&&item[recurse]){var retval=getById(item[recurse],id,recurse);
if(retval){return retval;
}}}return null;
};
var addById=function(array,newItem,nextSiblingId,recurse,nullIfNotFound){if(nextSiblingId){for(var i=0,item;
(item=array[i]);
i++){if(item.id==nextSiblingId){array.splice(i,0,newItem);
return newItem;
}if(recurse&&item[recurse]){var retval=addById(item[recurse],newItem,nextSiblingId,recurse,true);
if(retval){return retval;
}}}if(nullIfNotFound){return null;
}}array.push(newItem);
return newItem;
};
var removeById=function(array,id,recurse){for(var i=0,item;
(item=array[i]);
i++){if(item.id==id){return array.splice(i,1);
}if(recurse&&item[recurse]){var retval=removeById(item[recurse],id,recurse);
if(retval){return retval;
}}}return null;
};
var definitionObject=function(dialog,dialogDefinition){this.dialog=dialog;
var contents=dialogDefinition.contents;
for(var i=0,content;
(content=contents[i]);
i++){contents[i]=content&&new contentObject(dialog,content);
}CKEDITOR.tools.extend(this,dialogDefinition);
};
definitionObject.prototype={getContents:function(id){return getById(this.contents,id);
},getButton:function(id){return getById(this.buttons,id);
},addContents:function(contentDefinition,nextSiblingId){return addById(this.contents,contentDefinition,nextSiblingId);
},addButton:function(buttonDefinition,nextSiblingId){return addById(this.buttons,buttonDefinition,nextSiblingId);
},removeContents:function(id){removeById(this.contents,id);
},removeButton:function(id){removeById(this.buttons,id);
}};
function contentObject(dialog,contentDefinition){this._={dialog:dialog};
CKEDITOR.tools.extend(this,contentDefinition);
}contentObject.prototype={get:function(id){return getById(this.elements,id,"children");
},add:function(elementDefinition,nextSiblingId){return addById(this.elements,elementDefinition,nextSiblingId,"children");
},remove:function(id){removeById(this.elements,id,"children");
}};
function initDragAndDrop(dialog){var lastCoords=null,abstractDialogCoords=null,element=dialog.getElement().getFirst(),editor=dialog.getParentEditor(),magnetDistance=editor.config.dialog_magnetDistance,margins=CKEDITOR.skin.margins||[0,0,0,0];
if(typeof magnetDistance=="undefined"){magnetDistance=20;
}function mouseMoveHandler(evt){var dialogSize=dialog.getSize(),viewPaneSize=CKEDITOR.document.getWindow().getViewPaneSize(),x=evt.data.$.screenX,y=evt.data.$.screenY,dx=x-lastCoords.x,dy=y-lastCoords.y,realX,realY;
lastCoords={x:x,y:y};
abstractDialogCoords.x+=dx;
abstractDialogCoords.y+=dy;
if(abstractDialogCoords.x+margins[3]<magnetDistance){realX=-margins[3];
}else{if(abstractDialogCoords.x-margins[1]>viewPaneSize.width-dialogSize.width-magnetDistance){realX=viewPaneSize.width-dialogSize.width+(editor.lang.dir=="rtl"?0:margins[1]);
}else{realX=abstractDialogCoords.x;
}}if(abstractDialogCoords.y+margins[0]<magnetDistance){realY=-margins[0];
}else{if(abstractDialogCoords.y-margins[2]>viewPaneSize.height-dialogSize.height-magnetDistance){realY=viewPaneSize.height-dialogSize.height+margins[2];
}else{realY=abstractDialogCoords.y;
}}dialog.move(realX,realY,1);
evt.data.preventDefault();
}function mouseUpHandler(evt){CKEDITOR.document.removeListener("mousemove",mouseMoveHandler);
CKEDITOR.document.removeListener("mouseup",mouseUpHandler);
if(CKEDITOR.env.ie6Compat){var coverDoc=currentCover.getChild(0).getFrameDocument();
coverDoc.removeListener("mousemove",mouseMoveHandler);
coverDoc.removeListener("mouseup",mouseUpHandler);
}}dialog.parts.title.on("mousedown",function(evt){lastCoords={x:evt.data.$.screenX,y:evt.data.$.screenY};
CKEDITOR.document.on("mousemove",mouseMoveHandler);
CKEDITOR.document.on("mouseup",mouseUpHandler);
abstractDialogCoords=dialog.getPosition();
if(CKEDITOR.env.ie6Compat){var coverDoc=currentCover.getChild(0).getFrameDocument();
coverDoc.on("mousemove",mouseMoveHandler);
coverDoc.on("mouseup",mouseUpHandler);
}evt.data.preventDefault();
},dialog);
}function initResizeHandles(dialog){var def=dialog.definition,resizable=def.resizable;
if(resizable==CKEDITOR.DIALOG_RESIZE_NONE){return;
}var editor=dialog.getParentEditor();
var wrapperWidth,wrapperHeight,viewSize,origin,startSize,dialogCover;
var mouseDownFn=CKEDITOR.tools.addFunction(function($event){startSize=dialog.getSize();
var content=dialog.parts.contents,iframeDialog=content.$.getElementsByTagName("iframe").length;
if(iframeDialog){dialogCover=CKEDITOR.dom.element.createFromHtml('<div class="cke_dialog_resize_cover" style="height: 100%; position: absolute; width: 100%;"></div>');
content.append(dialogCover);
}wrapperHeight=startSize.height-dialog.parts.contents.getSize("height",!(CKEDITOR.env.gecko||CKEDITOR.env.opera||CKEDITOR.env.ie&&CKEDITOR.env.quirks));
wrapperWidth=startSize.width-dialog.parts.contents.getSize("width",1);
origin={x:$event.screenX,y:$event.screenY};
viewSize=CKEDITOR.document.getWindow().getViewPaneSize();
CKEDITOR.document.on("mousemove",mouseMoveHandler);
CKEDITOR.document.on("mouseup",mouseUpHandler);
if(CKEDITOR.env.ie6Compat){var coverDoc=currentCover.getChild(0).getFrameDocument();
coverDoc.on("mousemove",mouseMoveHandler);
coverDoc.on("mouseup",mouseUpHandler);
}$event.preventDefault&&$event.preventDefault();
});
dialog.on("load",function(){var direction="";
if(resizable==CKEDITOR.DIALOG_RESIZE_WIDTH){direction=" cke_resizer_horizontal";
}else{if(resizable==CKEDITOR.DIALOG_RESIZE_HEIGHT){direction=" cke_resizer_vertical";
}}var resizer=CKEDITOR.dom.element.createFromHtml('<div class="cke_resizer'+direction+" cke_resizer_"+editor.lang.dir+'" title="'+CKEDITOR.tools.htmlEncode(editor.lang.common.resize)+'" onmousedown="CKEDITOR.tools.callFunction('+mouseDownFn+', event )">'+(editor.lang.dir=="ltr"?"\u25E2":"\u25E3")+"</div>");
dialog.parts.footer.append(resizer,1);
});
editor.on("destroy",function(){CKEDITOR.tools.removeFunction(mouseDownFn);
});
function mouseMoveHandler(evt){var rtl=editor.lang.dir=="rtl",dx=(evt.data.$.screenX-origin.x)*(rtl?-1:1),dy=evt.data.$.screenY-origin.y,width=startSize.width,height=startSize.height,internalWidth=width+dx*(dialog._.moved?1:2),internalHeight=height+dy*(dialog._.moved?1:2),element=dialog._.element.getFirst(),right=rtl&&element.getComputedStyle("right"),position=dialog.getPosition();
if(position.y+internalHeight>viewSize.height){internalHeight=viewSize.height-position.y;
}if((rtl?right:position.x)+internalWidth>viewSize.width){internalWidth=viewSize.width-(rtl?right:position.x);
}if((resizable==CKEDITOR.DIALOG_RESIZE_WIDTH||resizable==CKEDITOR.DIALOG_RESIZE_BOTH)){width=Math.max(def.minWidth||0,internalWidth-wrapperWidth);
}if(resizable==CKEDITOR.DIALOG_RESIZE_HEIGHT||resizable==CKEDITOR.DIALOG_RESIZE_BOTH){height=Math.max(def.minHeight||0,internalHeight-wrapperHeight);
}dialog.resize(width,height);
if(!dialog._.moved){dialog.layout();
}evt.data.preventDefault();
}function mouseUpHandler(){CKEDITOR.document.removeListener("mouseup",mouseUpHandler);
CKEDITOR.document.removeListener("mousemove",mouseMoveHandler);
if(dialogCover){dialogCover.remove();
dialogCover=null;
}if(CKEDITOR.env.ie6Compat){var coverDoc=currentCover.getChild(0).getFrameDocument();
coverDoc.removeListener("mouseup",mouseUpHandler);
coverDoc.removeListener("mousemove",mouseMoveHandler);
}}}var resizeCover;
var covers={},currentCover;
function cancelEvent(ev){ev.data.preventDefault(1);
}function showCover(editor){var win=CKEDITOR.document.getWindow();
var config=editor.config,backgroundColorStyle=config.dialog_backgroundCoverColor||"white",backgroundCoverOpacity=config.dialog_backgroundCoverOpacity,baseFloatZIndex=config.baseFloatZIndex,coverKey=CKEDITOR.tools.genKey(backgroundColorStyle,backgroundCoverOpacity,baseFloatZIndex),coverElement=covers[coverKey];
if(!coverElement){var html=['<div tabIndex="-1" style="position: ',(CKEDITOR.env.ie6Compat?"absolute":"fixed"),"; z-index: ",baseFloatZIndex,"; top: 0px; left: 0px; ",(!CKEDITOR.env.ie6Compat?"background-color: "+backgroundColorStyle:""),'" class="cke_dialog_background_cover">'];
if(CKEDITOR.env.ie6Compat){var iframeHtml="<html><body style=\\'background-color:"+backgroundColorStyle+";\\'></body></html>";
html.push('<iframe hidefocus="true" frameborder="0" id="cke_dialog_background_iframe" src="javascript:');
html.push("void((function(){"+encodeURIComponent("document.open();("+CKEDITOR.tools.fixDomain+")();document.write( '"+iframeHtml+"' );document.close();")+"})())");
html.push('" style="position:absolute;left:0;top:0;width:100%;height: 100%;filter: progid:DXImageTransform.Microsoft.Alpha(opacity=0)"></iframe>');
}html.push("</div>");
coverElement=CKEDITOR.dom.element.createFromHtml(html.join(""));
coverElement.setOpacity(backgroundCoverOpacity!=undefined?backgroundCoverOpacity:0.5);
coverElement.on("keydown",cancelEvent);
coverElement.on("keypress",cancelEvent);
coverElement.on("keyup",cancelEvent);
coverElement.appendTo(CKEDITOR.document.getBody());
covers[coverKey]=coverElement;
}else{coverElement.show();
}editor.focusManager.add(coverElement);
currentCover=coverElement;
var resizeFunc=function(){var size=win.getViewPaneSize();
coverElement.setStyles({width:size.width+"px",height:size.height+"px"});
};
var scrollFunc=function(){var pos=win.getScrollPosition(),cursor=CKEDITOR.dialog._.currentTop;
coverElement.setStyles({left:pos.x+"px",top:pos.y+"px"});
if(cursor){do{var dialogPos=cursor.getPosition();
cursor.move(dialogPos.x,dialogPos.y);
}while((cursor=cursor._.parentDialog));
}};
resizeCover=resizeFunc;
win.on("resize",resizeFunc);
resizeFunc();
if(!(CKEDITOR.env.mac&&CKEDITOR.env.webkit)){coverElement.focus();
}if(CKEDITOR.env.ie6Compat){var myScrollHandler=function(){scrollFunc();
arguments.callee.prevScrollHandler.apply(this,arguments);
};
win.$.setTimeout(function(){myScrollHandler.prevScrollHandler=window.onscroll||function(){};
window.onscroll=myScrollHandler;
},0);
scrollFunc();
}}function hideCover(editor){if(!currentCover){return;
}editor.focusManager.remove(currentCover);
var win=CKEDITOR.document.getWindow();
currentCover.hide();
win.removeListener("resize",resizeCover);
if(CKEDITOR.env.ie6Compat){win.$.setTimeout(function(){var prevScrollHandler=window.onscroll&&window.onscroll.prevScrollHandler;
window.onscroll=prevScrollHandler||null;
},0);
}resizeCover=null;
}function removeCovers(){for(var coverId in covers){covers[coverId].remove();
}covers={};
}var accessKeyProcessors={};
var accessKeyDownHandler=function(evt){var ctrl=evt.data.$.ctrlKey||evt.data.$.metaKey,alt=evt.data.$.altKey,shift=evt.data.$.shiftKey,key=String.fromCharCode(evt.data.$.keyCode),keyProcessor=accessKeyProcessors[(ctrl?"CTRL+":"")+(alt?"ALT+":"")+(shift?"SHIFT+":"")+key];
if(!keyProcessor||!keyProcessor.length){return;
}keyProcessor=keyProcessor[keyProcessor.length-1];
keyProcessor.keydown&&keyProcessor.keydown.call(keyProcessor.uiElement,keyProcessor.dialog,keyProcessor.key);
evt.data.preventDefault();
};
var accessKeyUpHandler=function(evt){var ctrl=evt.data.$.ctrlKey||evt.data.$.metaKey,alt=evt.data.$.altKey,shift=evt.data.$.shiftKey,key=String.fromCharCode(evt.data.$.keyCode),keyProcessor=accessKeyProcessors[(ctrl?"CTRL+":"")+(alt?"ALT+":"")+(shift?"SHIFT+":"")+key];
if(!keyProcessor||!keyProcessor.length){return;
}keyProcessor=keyProcessor[keyProcessor.length-1];
if(keyProcessor.keyup){keyProcessor.keyup.call(keyProcessor.uiElement,keyProcessor.dialog,keyProcessor.key);
evt.data.preventDefault();
}};
var registerAccessKey=function(uiElement,dialog,key,downFunc,upFunc){var procList=accessKeyProcessors[key]||(accessKeyProcessors[key]=[]);
procList.push({uiElement:uiElement,dialog:dialog,key:key,keyup:upFunc||uiElement.accessKeyUp,keydown:downFunc||uiElement.accessKeyDown});
};
var unregisterAccessKey=function(obj){for(var i in accessKeyProcessors){var list=accessKeyProcessors[i];
for(var j=list.length-1;
j>=0;
j--){if(list[j].dialog==obj||list[j].uiElement==obj){list.splice(j,1);
}}if(list.length===0){delete accessKeyProcessors[i];
}}};
var tabAccessKeyUp=function(dialog,key){if(dialog._.accessKeyMap[key]){dialog.selectPage(dialog._.accessKeyMap[key]);
}};
var tabAccessKeyDown=function(dialog,key){};
(function(){CKEDITOR.ui.dialog={uiElement:function(dialog,elementDefinition,htmlList,nodeNameArg,stylesArg,attributesArg,contentsArg){if(arguments.length<4){return;
}var nodeName=(nodeNameArg.call?nodeNameArg(elementDefinition):nodeNameArg)||"div",html=["<",nodeName," "],styles=(stylesArg&&stylesArg.call?stylesArg(elementDefinition):stylesArg)||{},attributes=(attributesArg&&attributesArg.call?attributesArg(elementDefinition):attributesArg)||{},innerHTML=(contentsArg&&contentsArg.call?contentsArg.call(this,dialog,elementDefinition):contentsArg)||"",domId=this.domId=attributes.id||CKEDITOR.tools.getNextId()+"_uiElement",id=this.id=elementDefinition.id,i;
if(elementDefinition.requiredContent&&!dialog.getParentEditor().filter.check(elementDefinition.requiredContent)){styles.display="none";
this.notAllowed=true;
}attributes.id=domId;
var classes={};
if(elementDefinition.type){classes["cke_dialog_ui_"+elementDefinition.type]=1;
}if(elementDefinition.className){classes[elementDefinition.className]=1;
}if(elementDefinition.disabled){classes.cke_disabled=1;
}var attributeClasses=(attributes["class"]&&attributes["class"].split)?attributes["class"].split(" "):[];
for(i=0;
i<attributeClasses.length;
i++){if(attributeClasses[i]){classes[attributeClasses[i]]=1;
}}var finalClasses=[];
for(i in classes){finalClasses.push(i);
}attributes["class"]=finalClasses.join(" ");
if(elementDefinition.title){attributes.title=elementDefinition.title;
}var styleStr=(elementDefinition.style||"").split(";");
if(elementDefinition.align){var align=elementDefinition.align;
styles["margin-left"]=align=="left"?0:"auto";
styles["margin-right"]=align=="right"?0:"auto";
}for(i in styles){styleStr.push(i+":"+styles[i]);
}if(elementDefinition.hidden){styleStr.push("display:none");
}for(i=styleStr.length-1;
i>=0;
i--){if(styleStr[i]===""){styleStr.splice(i,1);
}}if(styleStr.length>0){attributes.style=(attributes.style?(attributes.style+"; "):"")+styleStr.join("; ");
}for(i in attributes){html.push(i+'="'+CKEDITOR.tools.htmlEncode(attributes[i])+'" ');
}html.push(">",innerHTML,"</",nodeName,">");
htmlList.push(html.join(""));
(this._||(this._={})).dialog=dialog;
if(typeof(elementDefinition.isChanged)=="boolean"){this.isChanged=function(){return elementDefinition.isChanged;
};
}if(typeof(elementDefinition.isChanged)=="function"){this.isChanged=elementDefinition.isChanged;
}if(typeof(elementDefinition.setValue)=="function"){this.setValue=CKEDITOR.tools.override(this.setValue,function(org){return function(val){org.call(this,elementDefinition.setValue.call(this,val));
};
});
}if(typeof(elementDefinition.getValue)=="function"){this.getValue=CKEDITOR.tools.override(this.getValue,function(org){return function(){return elementDefinition.getValue.call(this,org.call(this));
};
});
}CKEDITOR.event.implementOn(this);
this.registerEvents(elementDefinition);
if(this.accessKeyUp&&this.accessKeyDown&&elementDefinition.accessKey){registerAccessKey(this,dialog,"CTRL+"+elementDefinition.accessKey);
}var me=this;
dialog.on("load",function(){var input=me.getInputElement();
if(input){var focusClass=me.type in {checkbox:1,ratio:1}&&CKEDITOR.env.ie&&CKEDITOR.env.version<8?"cke_dialog_ui_focused":"";
input.on("focus",function(){dialog._.tabBarMode=false;
dialog._.hasFocus=true;
me.fire("focus");
focusClass&&this.addClass(focusClass);
});
input.on("blur",function(){me.fire("blur");
focusClass&&this.removeClass(focusClass);
});
}});
if(this.keyboardFocusable){this.tabIndex=elementDefinition.tabIndex||0;
this.focusIndex=dialog._.focusList.push(this)-1;
this.on("focus",function(){dialog._.currentFocusIndex=me.focusIndex;
});
}CKEDITOR.tools.extend(this,elementDefinition);
},hbox:function(dialog,childObjList,childHtmlList,htmlList,elementDefinition){if(arguments.length<4){return;
}this._||(this._={});
var children=this._.children=childObjList,widths=elementDefinition&&elementDefinition.widths||null,height=elementDefinition&&elementDefinition.height||null,styles={},i;
var innerHTML=function(){var html=['<tbody><tr class="cke_dialog_ui_hbox">'];
for(i=0;
i<childHtmlList.length;
i++){var className="cke_dialog_ui_hbox_child",styles=[];
if(i===0){className="cke_dialog_ui_hbox_first";
}if(i==childHtmlList.length-1){className="cke_dialog_ui_hbox_last";
}html.push('<td class="',className,'" role="presentation" ');
if(widths){if(widths[i]){styles.push("width:"+cssLength(widths[i]));
}}else{styles.push("width:"+Math.floor(100/childHtmlList.length)+"%");
}if(height){styles.push("height:"+cssLength(height));
}if(elementDefinition&&elementDefinition.padding!=undefined){styles.push("padding:"+cssLength(elementDefinition.padding));
}if(CKEDITOR.env.ie&&CKEDITOR.env.quirks&&children[i].align){styles.push("text-align:"+children[i].align);
}if(styles.length>0){html.push('style="'+styles.join("; ")+'" ');
}html.push(">",childHtmlList[i],"</td>");
}html.push("</tr></tbody>");
return html.join("");
};
var attribs={role:"presentation"};
elementDefinition&&elementDefinition.align&&(attribs.align=elementDefinition.align);
CKEDITOR.ui.dialog.uiElement.call(this,dialog,elementDefinition||{type:"hbox"},htmlList,"table",styles,attribs,innerHTML);
},vbox:function(dialog,childObjList,childHtmlList,htmlList,elementDefinition){if(arguments.length<3){return;
}this._||(this._={});
var children=this._.children=childObjList,width=elementDefinition&&elementDefinition.width||null,heights=elementDefinition&&elementDefinition.heights||null;
var innerHTML=function(){var html=['<table role="presentation" cellspacing="0" border="0" '];
html.push('style="');
if(elementDefinition&&elementDefinition.expand){html.push("height:100%;");
}html.push("width:"+cssLength(width||"100%"),";");
if(CKEDITOR.env.webkit){html.push("float:none;");
}html.push('"');
html.push('align="',CKEDITOR.tools.htmlEncode((elementDefinition&&elementDefinition.align)||(dialog.getParentEditor().lang.dir=="ltr"?"left":"right")),'" ');
html.push("><tbody>");
for(var i=0;
i<childHtmlList.length;
i++){var styles=[];
html.push('<tr><td role="presentation" ');
if(width){styles.push("width:"+cssLength(width||"100%"));
}if(heights){styles.push("height:"+cssLength(heights[i]));
}else{if(elementDefinition&&elementDefinition.expand){styles.push("height:"+Math.floor(100/childHtmlList.length)+"%");
}}if(elementDefinition&&elementDefinition.padding!=undefined){styles.push("padding:"+cssLength(elementDefinition.padding));
}if(CKEDITOR.env.ie&&CKEDITOR.env.quirks&&children[i].align){styles.push("text-align:"+children[i].align);
}if(styles.length>0){html.push('style="',styles.join("; "),'" ');
}html.push(' class="cke_dialog_ui_vbox_child">',childHtmlList[i],"</td></tr>");
}html.push("</tbody></table>");
return html.join("");
};
CKEDITOR.ui.dialog.uiElement.call(this,dialog,elementDefinition||{type:"vbox"},htmlList,"div",null,{role:"presentation"},innerHTML);
}};
})();
CKEDITOR.ui.dialog.uiElement.prototype={getElement:function(){return CKEDITOR.document.getById(this.domId);
},getInputElement:function(){return this.getElement();
},getDialog:function(){return this._.dialog;
},setValue:function(value,noChangeEvent){this.getInputElement().setValue(value);
!noChangeEvent&&this.fire("change",{value:value});
return this;
},getValue:function(){return this.getInputElement().getValue();
},isChanged:function(){return false;
},selectParentTab:function(){var element=this.getInputElement(),cursor=element,tabId;
while((cursor=cursor.getParent())&&cursor.$.className.search("cke_dialog_page_contents")==-1){}if(!cursor){return this;
}tabId=cursor.getAttribute("name");
if(this._.dialog._.currentTabId!=tabId){this._.dialog.selectPage(tabId);
}return this;
},focus:function(){this.selectParentTab().getInputElement().focus();
return this;
},registerEvents:function(definition){var regex=/^on([A-Z]\w+)/,match;
var registerDomEvent=function(uiElement,dialog,eventName,func){dialog.on("load",function(){uiElement.getInputElement().on(eventName,func,uiElement);
});
};
for(var i in definition){if(!(match=i.match(regex))){continue;
}if(this.eventProcessors[i]){this.eventProcessors[i].call(this,this._.dialog,definition[i]);
}else{registerDomEvent(this,this._.dialog,match[1].toLowerCase(),definition[i]);
}}return this;
},eventProcessors:{onLoad:function(dialog,func){dialog.on("load",func,this);
},onShow:function(dialog,func){dialog.on("show",func,this);
},onHide:function(dialog,func){dialog.on("hide",func,this);
}},accessKeyDown:function(dialog,key){this.focus();
},accessKeyUp:function(dialog,key){},disable:function(){var element=this.getElement(),input=this.getInputElement();
input.setAttribute("disabled","true");
element.addClass("cke_disabled");
},enable:function(){var element=this.getElement(),input=this.getInputElement();
input.removeAttribute("disabled");
element.removeClass("cke_disabled");
},isEnabled:function(){return !this.getElement().hasClass("cke_disabled");
},isVisible:function(){return this.getInputElement().isVisible();
},isFocusable:function(){if(!this.isEnabled()||!this.isVisible()){return false;
}return true;
}};
CKEDITOR.ui.dialog.hbox.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.uiElement,{getChild:function(indices){if(arguments.length<1){return this._.children.concat();
}if(!indices.splice){indices=[indices];
}if(indices.length<2){return this._.children[indices[0]];
}else{return(this._.children[indices[0]]&&this._.children[indices[0]].getChild)?this._.children[indices[0]].getChild(indices.slice(1,indices.length)):null;
}}},true);
CKEDITOR.ui.dialog.vbox.prototype=new CKEDITOR.ui.dialog.hbox();
(function(){var commonBuilder={build:function(dialog,elementDefinition,output){var children=elementDefinition.children,child,childHtmlList=[],childObjList=[];
for(var i=0;
(i<children.length&&(child=children[i]));
i++){var childHtml=[];
childHtmlList.push(childHtml);
childObjList.push(CKEDITOR.dialog._.uiElementBuilders[child.type].build(dialog,child,childHtml));
}return new CKEDITOR.ui.dialog[elementDefinition.type](dialog,childObjList,childHtmlList,output,elementDefinition);
}};
CKEDITOR.dialog.addUIElement("hbox",commonBuilder);
CKEDITOR.dialog.addUIElement("vbox",commonBuilder);
})();
CKEDITOR.dialogCommand=function(dialogName,ext){this.dialogName=dialogName;
CKEDITOR.tools.extend(this,ext,true);
};
CKEDITOR.dialogCommand.prototype={exec:function(editor){CKEDITOR.env.opera?CKEDITOR.tools.setTimeout(function(){editor.openDialog(this.dialogName);
},0,this):editor.openDialog(this.dialogName);
},canUndo:false,editorFocus:1};
(function(){var notEmptyRegex=/^([a]|[^a])+$/,integerRegex=/^\d*$/,numberRegex=/^\d*(?:\.\d+)?$/,htmlLengthRegex=/^(((\d*(\.\d+))|(\d*))(px|\%)?)?$/,cssLengthRegex=/^(((\d*(\.\d+))|(\d*))(px|em|ex|in|cm|mm|pt|pc|\%)?)?$/i,inlineStyleRegex=/^(\s*[\w-]+\s*:\s*[^:;]+(?:;|$))*$/;
CKEDITOR.VALIDATE_OR=1;
CKEDITOR.VALIDATE_AND=2;
CKEDITOR.dialog.validate={functions:function(){var args=arguments;
return function(){var value=this&&this.getValue?this.getValue():args[0];
var msg=undefined,relation=CKEDITOR.VALIDATE_AND,functions=[],i;
for(i=0;
i<args.length;
i++){if(typeof(args[i])=="function"){functions.push(args[i]);
}else{break;
}}if(i<args.length&&typeof(args[i])=="string"){msg=args[i];
i++;
}if(i<args.length&&typeof(args[i])=="number"){relation=args[i];
}var passed=(relation==CKEDITOR.VALIDATE_AND?true:false);
for(i=0;
i<functions.length;
i++){if(relation==CKEDITOR.VALIDATE_AND){passed=passed&&functions[i](value);
}else{passed=passed||functions[i](value);
}}return !passed?msg:true;
};
},regex:function(regex,msg){return function(){var value=this&&this.getValue?this.getValue():arguments[0];
return !regex.test(value)?msg:true;
};
},notEmpty:function(msg){return this.regex(notEmptyRegex,msg);
},integer:function(msg){return this.regex(integerRegex,msg);
},number:function(msg){return this.regex(numberRegex,msg);
},cssLength:function(msg){return this.functions(function(val){return cssLengthRegex.test(CKEDITOR.tools.trim(val));
},msg);
},htmlLength:function(msg){return this.functions(function(val){return htmlLengthRegex.test(CKEDITOR.tools.trim(val));
},msg);
},inlineStyle:function(msg){return this.functions(function(val){return inlineStyleRegex.test(CKEDITOR.tools.trim(val));
},msg);
},equals:function(value,msg){return this.functions(function(val){return val==value;
},msg);
},notEqual:function(value,msg){return this.functions(function(val){return val!=value;
},msg);
}};
CKEDITOR.on("instanceDestroyed",function(evt){if(CKEDITOR.tools.isEmpty(CKEDITOR.instances)){var currentTopDialog;
while((currentTopDialog=CKEDITOR.dialog._.currentTop)){currentTopDialog.hide();
}removeCovers();
}var dialogs=evt.editor._.storedDialogs;
for(var name in dialogs){dialogs[name].destroy();
}});
})();
CKEDITOR.tools.extend(CKEDITOR.editor.prototype,{openDialog:function(dialogName,callback){var dialog=null,dialogDefinitions=CKEDITOR.dialog._.dialogDefinitions[dialogName];
if(CKEDITOR.dialog._.currentTop===null){showCover(this);
}if(typeof dialogDefinitions=="function"){var storedDialogs=this._.storedDialogs||(this._.storedDialogs={});
dialog=storedDialogs[dialogName]||(storedDialogs[dialogName]=new CKEDITOR.dialog(this,dialogName));
callback&&callback.call(dialog,dialog);
dialog.show();
}else{if(dialogDefinitions=="failed"){hideCover(this);
throw new Error('[CKEDITOR.dialog.openDialog] Dialog "'+dialogName+'" failed when loading definition.');
}else{if(typeof dialogDefinitions=="string"){CKEDITOR.scriptLoader.load(CKEDITOR.getUrl(dialogDefinitions),function(){var dialogDefinition=CKEDITOR.dialog._.dialogDefinitions[dialogName];
if(typeof dialogDefinition!="function"){CKEDITOR.dialog._.dialogDefinitions[dialogName]="failed";
}this.openDialog(dialogName,callback);
},this,0,1);
}}}CKEDITOR.skin.loadPart("dialog");
return dialog;
}});
})();
CKEDITOR.plugins.add("dialog",{requires:"dialogui",init:function(editor){editor.on("contentDom",function(){var editable=editor.editable();
editable.attachListener(editable,"dblclick",function(evt){if(editor.readOnly){return false;
}var data={element:evt.data.getTarget()};
editor.fire("doubleclick",data);
data.dialog&&editor.openDialog(data.dialog);
return 1;
});
});
}});
