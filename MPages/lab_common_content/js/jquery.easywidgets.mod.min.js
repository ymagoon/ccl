(function($){$.fn.EasyWidgets=function(settings){InitializeWidgets(settings,false);return true};$.fn.AddEasyWidget=function(html,placeId,settings){var canAdd=true;var widget=$(html);var s=$.extend(true,$.fn.EasyWidgets.defaults,settings);if($.isFunction(s.callbacks.onAddQuery)){canAdd=s.callbacks.onAddQuery(widget,placeId)}if(canAdd){$("#"+placeId).append(html);if($.isFunction(s.callbacks.onAdd)){s.callbacks.onAdd(widget,placeId)}InitializeWidgets(s,true);return true}else{return false}};$.fn.EasyWidgets.defaults={behaviour:{dragDelay:100,dragRevert:100,dragOpacity:0.8,useCookies:false},effects:{effectDuration:0,widgetShow:"none",widgetHide:"none",widgetClose:"none",widgetExtend:"none",widgetCollapse:"none",widgetOpenEdit:"none",widgetCloseEdit:"none",widgetCancelEdit:"none"},cookies:{path:"",domain:"",expires:90,secure:false,closeName:"ew-close",disableName:"ew-disable",positionName:"ew-position",collapseName:"ew-collapse"},options:{movable:"movable",editable:"editable",collapse:"collapse",removable:"removable",collapsable:"collapsable",closeConfirm:"closeconfirm"},callbacks:{onAdd:null,onEdit:null,onShow:null,onHide:null,onClose:null,onEnable:null,onExtend:null,onDisable:null,onDragStop:null,onCollapse:null,onAddQuery:null,onEditQuery:null,onShowQuery:null,onHideQuery:null,onCloseQuery:null,onCancelEdit:null,onEnableQuery:null,onExtendQuery:null,onDisableQuery:null,onCollapseQuery:null,onCancelEditQuery:null,onChangePositions:null,onRefreshPositions:null},selectors:{container:"div",widget:".widget",places:".widget-place",header:".widget-header",widgetMenu:".widget-menu",editbox:".widget-editbox",content:".widget-content",closeEdit:".widget-close-editbox",editLink:".widget-editlink",closeLink:".widget-closelink",placeHolder:"widget-placeholder",collapseLink:".widget-collapselink"},i18n:{editText:"Edit",closeText:"Close",extendText:"Extend",collapseText:"Collapse",cancelEditText:"Cancel",editTitle:"Edit this widget",closeTitle:"Close this widget",confirmMsg:"Remove this widget?",cancelEditTitle:"Cancel edition",extendTitle:"Extend this widget",collapseTitle:"Collapse this widget"}};function InitializeWidgets(settings,widgetOnDemand){var b=widgetOnDemand;var d=$.fn.EasyWidgets.defaults;var s=$.extend(true,d,settings);$(s.selectors.widget).each(function(){PrepareWidgetBehaviour($(this),b,s)});RepositionedWidgets(s);MakeWidgetsSortables(s);return true}function PrepareWidgetBehaviour(widget,widgetOnDemand,settings){var s=settings;var widgetMenu=widget.find(s.selectors.widgetMenu);if(widgetMenu.html()==null){var widgetId=widget.attr("id");var haveId=($.trim(widgetId)!="");widget.find(s.selectors.editbox).hide();var menuWrap='<span class="'+s.selectors.widgetMenu.replace(/\./,"")+'"></span>';widget.find(s.selectors.header).prepend(menuWrap);widgetMenu=widget.find(s.selectors.widgetMenu);AddWidgetEditLink(widget,widgetMenu,s);AddWidgetCollapseLink(widget,widgetMenu,s);AddWidgetRemoveLink(widget,widgetMenu,s);return true}else{return false}}function RepositionedWidgets(settings){var s=settings;var positions="";if($.isFunction(s.callbacks.onRefreshPositions)){positions=s.callbacks.onRefreshPositions()}if(($.trim(positions)=="")&&s.behaviour.useCookies&&GetCookie(s.cookies.positionName)!=null){positions=GetCookie(s.cookies.positionName)}if($.trim(positions)!=""){var places=positions.split("|");var totalPlaces=places.length;for(var i=0;i<totalPlaces;i++){var place=places[i].split("=");if(place.length==2){var placeSel="#"+place[0];var widgets=place[1].split(",");var totalWidgets=widgets.length;for(var j=0;j<totalWidgets;j++){if($.trim(widgets[j])!=""){var widgetSel="#"+widgets[j];$(widgetSel).appendTo(placeSel)}}}}}return true}function MakeWidgetsSortables(settings){var sortables=GetSortableItems(settings);PrepareSortableHeaders(sortables,settings);PrepareSortablePlaces(sortables,settings);return true}function GetSortableItems(settings){var fixesSel="";var s=settings;$(s.selectors.widget).each(function(count){if(!$(this).hasClass(s.options.movable)){if(!this.id){this.id="fixed-widget-id-"+count}if(fixesSel==""){fixesSel+="#"+this.id}else{fixesSel+=",#"+this.id}}});var notFixes="";if($.trim(fixesSel)==""){notFixes="> "+s.selectors.container}else{notFixes="> "+s.selectors.container+":not("+fixesSel+")"}return $(notFixes,s.selectors.places)}function PrepareSortableHeaders(sortableItems,settings){var s=settings;sortableItems.find(s.selectors.header).css({cursor:"move"}).mousedown(function(e){var header=$(this);var widget=header.parent();sortableItems.css({width:""});widget.css({width:widget.width()+"px"})}).mouseup(function(){var header=$(this);var widget=header.parent();if(!widget.hasClass("dragging")){widget.css({width:""})}else{$(s.selectors.places).sortable("disable")}});return true}function PrepareSortablePlaces(sortableItems,settings){var s=settings;$(s.selectors.places).sortable("destroy");$(s.selectors.places).sortable({items:sortableItems,containment:"document",forcePlaceholderSize:true,handle:s.selectors.header,delay:s.behaviour.dragDelay,revert:s.behaviour.dragRevert,opacity:s.behaviour.dragOpacity,connectWith:$(s.selectors.places),placeholder:s.selectors.placeHolder,start:function(e,ui){$(ui.helper).addClass("dragging");return true},stop:function(e,ui){WidgetsPositionsChange(s);$(ui.item).css({width:""});$(ui.item).removeClass("dragging");$(s.selectors.places).sortable("enable");if($.isFunction(s.callbacks.onDragStop)){s.callbacks.onDragStop(e,ui)}return true}});if(s.behaviour.useCookies&&(GetCookie(s.cookies.disableName)==1)){$.fn.DisableEasyWidgets(s)}return true}function WidgetsPositionsChange(settings){var s=settings;var positions="";$(s.selectors.places).each(function(){var widgets="";var place=$(this);var places=place.attr("id")+"=";place.children(s.selectors.widget).each(function(){var widget=this;var widgetId=widget.id;var haveId=($.trim(widgetId)!="");if(haveId){if(widgets==""){widgets+=widgetId}else{widgets+=","+widgetId}}});places+=widgets;if(positions==""){positions+=places}else{positions+="|"+places}});if($.isFunction(s.callbacks.onChangePositions)){s.callbacks.onChangePositions(positions)}return true}function AddWidgetCollapseLink(widget,widgetMenu,settings){var s=settings;var link="";var widgetId=widget.attr("id");var haveId=$.trim(widgetId)!="";var content=widget.find(s.selectors.content);if(widget.hasClass(s.options.collapsable)){if(widget.hasClass(s.options.collapse)){link=MenuLink(s.i18n.extendText,s.i18n.extendTitle,s.selectors.collapseLink);content.hide()}else{link=MenuLink(s.i18n.collapseText,s.i18n.collapseTitle,s.selectors.collapseLink)}$(link).mousedown(function(e){e.stopPropagation()}).click(function(){var canExtend=true;var canCollapse=true;var link=$(this);var widget=link.parents(s.selectors.widget);var widgetId=widget.attr("id");var haveId=$.trim(widgetId)!="";var content=widget.find(s.selectors.content);var contentVisible=content.css("display")!="none";link.blur();if(contentVisible){if($.isFunction(s.callbacks.onCollapseQuery)){canCollapse=s.callbacks.onCollapseQuery(link,widget)}if(canCollapse){ApplyEffect(content,s.effects.widgetCollapse,s.effects.effectDuration,false);link.html(s.i18n.extendText);link.attr("title",s.i18n.extendTitle);if($.isFunction(s.callbacks.onCollapse)){s.callbacks.onCollapse(link,widget)}}}else{if($.isFunction(s.callbacks.onExtendQuery)){canExtend=s.callbacks.onExtendQuery(link,widget)}if(canExtend){link.html(s.i18n.collapseText);link.attr("title",s.i18n.collapseTitle);ApplyEffect(content,s.effects.widgetExtend,s.effects.effectDuration,true);if($.isFunction(s.callbacks.onExtend)){s.callbacks.onExtend(link,widget)}}}return false}).appendTo(widgetMenu)}return true}function AddWidgetEditLink(widget,widgetMenu,settings){var s=settings;var link="";if(widget.hasClass(s.options.editable)){link=MenuLink(s.i18n.editText,s.i18n.editTitle,s.selectors.editLink);widget.find(s.selectors.closeEdit).click(function(e){var link=$(this);var widget=link.parents(s.selectors.widget);var editbox=widget.find(s.selectors.editbox);var editLink=widget.find(s.selectors.editLink);link.blur();ApplyEffect(editbox,s.effects.widgetCloseEdit,s.effects.effectDuration,false);editLink.html(s.i18n.editText);editLink.attr("title",s.i18n.editTitle);return false});$(link).mousedown(function(e){e.stopPropagation()}).click(function(){var link=$(this);var canShow=canHide=true;var widget=link.parents(s.selectors.widget);var editbox=widget.find(s.selectors.editbox);var editboxVisible=editbox.css("display")!="none";link.blur();if(editboxVisible){if($.isFunction(s.callbacks.onCancelEditQuery)){canHide=s.callbacks.onCancelEditQuery(link,widget)}if(canHide){ApplyEffect(editbox,s.effects.widgetCancelEdit,s.effects.effectDuration,false);link.html(s.i18n.editText);link.attr("title",s.i18n.editTitle);if($.isFunction(s.callbacks.onCancelEdit)){s.callbacks.onCancelEdit(link,widget)}}}else{if($.isFunction(s.callbacks.onEditQuery)){canShow=s.callbacks.onEditQuery(link,widget)}if(canShow){link.html(s.i18n.cancelEditText);link.attr("title",s.i18n.cancelEditTitle);ApplyEffect(editbox,s.effects.widgetOpenEdit,s.effects.effectDuration,true);if($.isFunction(s.callbacks.onEdit)){s.callbacks.onEdit(link,widget)}}}return false}).appendTo(widgetMenu)}return true}function AddWidgetRemoveLink(widget,widgetMenu,settings){var s=settings;var link="";if(widget.hasClass(s.options.removable)){link=MenuLink(s.i18n.closeText,s.i18n.closeTitle,s.selectors.closeLink);$(link).mousedown(function(e){e.stopPropagation()}).click(function(){var link=$(this);var canRemove=true;var widget=link.parents(s.selectors.widget);var widgetId=widget.attr("id");var haveId=($.trim(widgetId)!="");link.blur();if($.isFunction(s.callbacks.onCloseQuery)){canRemove=s.callbacks.onCloseQuery(link,widget)}if(canRemove){if(!widget.hasClass(s.options.closeConfirm)||confirm(s.i18n.confirmMsg)){ApplyEffect(widget,s.effects.widgetClose,s.effects.effectDuration,false);if($.isFunction(s.callbacks.onClose)){s.callbacks.onClose(link,widget)}}}return false}).appendTo(widgetMenu)}return true}function MenuLink(text,title,aClass){var l='<a href="#" title="TITLE" class="CLASS">TEXT</a>';l=l.replace(/TEXT/g,text);l=l.replace(/TITLE/g,title);l=l.replace(/CLASS/g,aClass.replace(/\./,""));return l}function ApplyEffect(jqObj,effect,duration,show){var n="none",f="fade",s="slide";if(!show){if(effect==n){jqObj.hide()}else{if(effect==f){jqObj.fadeOut(duration)}else{if(effect==s){jqObj.slideUp(duration)}}}}else{if(effect==n){jqObj.show()}else{if(effect==f){jqObj.fadeIn(duration)}else{if(effect==s){jqObj.slideDown(duration)}}}}return true}})(jQuery);