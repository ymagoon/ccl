function DocumentBaseComponent(){this.m_resultStatusCodes=null;
this.m_resultStatusMeanings=null;
this.m_includeHover=true;
this.m_pcnFavorites=true;
this.setIncludeLineNumber(true);
DocumentBaseComponent.method("InsertData",function(){CERN_DOCUMENT_BASE_O1.GetDocumentsTable(this);
});
DocumentBaseComponent.method("setResultStatusCodes",function(value){this.m_resultStatusCodes=value;
});
DocumentBaseComponent.method("addResultStatusCode",function(value){if(!this.m_resultStatusCodes){this.m_resultStatusCodes=[];
}this.m_resultStatusCodes.push(value);
});
DocumentBaseComponent.method("getResultStatusCodes",function(){if(this.m_resultStatusCodes){return this.m_resultStatusCodes;
}else{if(this.m_resultStatusMeanings){var resStatusCodeSet=MP_Util.GetCodeSet(8,false);
if(this.m_resultStatusMeanings&&this.m_resultStatusMeanings.length>0){for(var x=this.m_resultStatusMeanings.length;
x--;
){var code=MP_Util.GetCodeByMeaning(resStatusCodeSet,this.m_resultStatusMeanings[x]);
if(code){this.addResultStatusCode(code.codeValue);
}}}}}return this.m_resultStatusCodes;
});
DocumentBaseComponent.method("addResultStatusMeaning",function(value){if(!this.m_resultStatusMeanings){this.m_resultStatusMeanings=[];
}this.m_resultStatusMeanings.push(value);
});
DocumentBaseComponent.method("setResultStatusMeanings",function(value){this.m_resultStatusMeanings=value;
});
DocumentBaseComponent.method("isHoverEnabled",function(){return this.m_includeHover;
});
DocumentBaseComponent.method("setHoverEnabled",function(value){this.m_includeHover=value;
});
DocumentBaseComponent.method("isPcnFavEnabled",function(){return this.m_pcnFavorites;
});
DocumentBaseComponent.method("setPcnFavEnabled",function(value){this.m_pcnFavorites=value;
});
DocumentBaseComponent.method("HandleSuccess",function(recordData){CERN_DOCUMENT_BASE_O1.RenderComponent(this,recordData);
});
}DocumentBaseComponent.inherits(MPageComponent);
var CERN_DOCUMENT_BASE_O1=function(){return{GetDocumentsTable:function(component){var mgr=new MP_Core.XMLCCLRequestThreadManager(CERN_DOCUMENT_BASE_O1.RenderReply,component,false);
var sendAr=[];
var request=null;
var thread=null;
var criterion=component.getCriterion();
var groups=component.getGroups();
var codes=component.getResultStatusCodes();
var events=(groups!=null&&groups.length>0)?groups[0].getEventSets():null;
var results=(codes!=null&&codes.length>0)?codes:null;
var encntrOption=(component.getScope()==2)?(criterion.encntr_id+".0"):"0.0";
sendAr.push("^MINE^",criterion.person_id+".0",encntrOption,criterion.provider_id+".0",component.getLookbackUnits());
if(events){sendAr.push("value("+events.join(",")+")");
}else{sendAr.push("0.0");
}if(results){sendAr.push("value("+results.join(",")+")");
}else{sendAr.push("0.0");
}var unitType=component.getLookbackUnitTypeFlag();
sendAr.push(criterion.ppr_cd+".0",unitType);
request=new MP_Core.ScriptRequest(component,"ENG:MPG.DOC.O1 - load documents");
request.setProgramName("MP_RETRIEVE_DOCUMENTS_JSON");
request.setParameters(sendAr);
request.setAsync(true);
thread=new MP_Core.XMLCCLRequestThread("GetDocumentData",component,request);
mgr.addThread(thread);
if(component.isPlusAddEnabled()){sendAr=[];
sendAr.push("^MINE^",criterion.provider_id);
request=new MP_Core.ScriptRequest(component,"ENG:MPG.DOC.O1 - load PCN Favs");
request.setProgramName("MP_GET_DOCUMENT_FAVORITES");
request.setParameters(sendAr);
request.setAsync(true);
thread=new MP_Core.XMLCCLRequestThread("GetPcnFavorites",component,request);
mgr.addThread(thread);
}mgr.begin();
},RenderReply:function(replyAr,component){var timerRenderComponent=MP_Util.CreateTimer(component.getComponentRenderTimerName());
var countText="";
var compNS=component.getStyles().getNameSpace();
var errMsg=[];
try{for(var repCnt=replyAr.length;
repCnt--;
){var reply=replyAr[repCnt];
var repStatus=reply.getStatus();
switch(reply.getName()){case"GetPcnFavorites":var favData=reply.getResponse();
appendDropDown(compNS,component,favData,component.getCriterion().static_content);
break;
case"GetDocumentData":if(repStatus=="F"){errMsg.push(reply.getError());
MP_Util.Doc.FinalizeComponent(MP_Util.HandleErrorResponse(component.getStyles().getNameSpace(),errMsg.join("<br />")),component,"");
}else{if(repStatus=="S"){var recordData=reply.getResponse();
var sHTML="";
sHTML=CERN_DOCUMENT_BASE_O1.RenderComponent(component,recordData);
countText=MP_Util.CreateTitleText(component,recordData.DOCS.length);
MP_Util.Doc.FinalizeComponent(sHTML,component,countText);
if(component.isScrollingEnabled()&&(recordData.DOCS.length>=component.getScrollNumber())){var xNode=Util.Style.g(compNS+"-info-hdr",document.body,"DL");
if(xNode[0]){Util.Style.acss(xNode[0],"hdr-scroll");
}}}else{countText=(component.isLineNumberIncluded()?"(0)":"");
MP_Util.Doc.FinalizeComponent(MP_Util.HandleNoDataResponse(component.getStyles().getNameSpace()),component,countText);
}}break;
}}}catch(err){if(timerRenderComponent){timerRenderComponent.Abort();
timerRenderComponent=null;
}throw (err);
}finally{if(timerRenderComponent){timerRenderComponent.Stop();
}}},RenderComponent:function(component,recordData){var compNS=component.getStyles().getNameSpace();
var DocI18n=i18n.discernabu.documents_base_o1;
var codeArray=MP_Util.LoadCodeListJSON(recordData.CODES);
var personnelArray=MP_Util.LoadPersonelListJSON(recordData.PRSNL);
var df=new mp_formatter.DateTimeFormatter(MPAGE_LOCALE);
var sHTML="";
var countText="";
var jsHTML=[];
jsHTML.push("<div class='content-hdr'><dl class='",compNS,"-info-hdr hdr'><dd class='",compNS+"-cat-hd'><span></span></dd>");
jsHTML.push("<dd class='",compNS,"-auth-hd'><span>",DocI18n.AUTHOR,"</span></dd>");
if(PathologyComponent&&(component instanceof PathologyComponent)){jsHTML.push("<dd class='",compNS,"-dt-hd'><span>",DocI18n.DATE,"</span></dd>");
}else{jsHTML.push("<dd class='",compNS,"-dt-hd'><span>",DocI18n.DATE_TIME,"</span></dd>");
}if(component.getDateFormat()==3){jsHTML.push("<dd class='",compNS+"-cat-hd'><span></span></dd><dd class='",compNS,"-auth-hd'><span></span></dd><dd class='",compNS,"-dt-hd'><span>",DocI18n.WITHIN,"</span></dd>");
}jsHTML.push("</dl></div>");
recordData.DOCS.sort(DocumentSorter);
jsHTML.push("<div class='",MP_Util.GetContentClass(component,recordData.DOCS.length),"'>");
for(var x=0,xl=recordData.DOCS.length;
x<xl;
x++){var dtHvr="",lastPrsnl="";
var author=DocI18n.UNKNOWN;
var docObj=recordData.DOCS[x];
var patId=docObj.PERSON_ID+".0";
var enctrId=docObj.ENCNTR_ID+".0";
var evntId=docObj.EVENT_ID+".0";
var docStatus=MP_Util.GetValueFromArray(docObj.RESULT_STATUS_CD,codeArray);
var doc=MP_Util.GetValueFromArray(docObj.EVENT_CD,codeArray);
var parentEventId=docObj.PARENT_EVENT_ID+".0";
var viewerType=docObj.VIEWER_TYPE;
var dateOfService=null;
var withinDateDos=null;
var dateTime=new Date();
if(docObj.EFFECTIVE_DT_TM!=""){dateTime.setISO8601(docObj.EFFECTIVE_DT_TM);
dateOfService=MP_Util.DisplayDateByOption(component,dateTime);
withinDateDos=MP_Util.CalcWithinTime(dateTime);
}else{dateOfService=DocI18n.UNKNOWN;
withinDateDos=DocI18n.UNKNOWN;
}var recentPart=GetLatestParticipation(docObj);
var authorPart=GetAuthorParticipant(docObj,codeArray);
if(authorPart){author=MP_Util.GetValueFromArray(authorPart.PRSNL_ID,personnelArray).fullName;
}if(recentPart&&recentPart.PRSNL_ID>0){lastPrsnl=MP_Util.GetValueFromArray(recentPart.PRSNL_ID,personnelArray).fullName;
var dtTm=new Date();
if(recentPart.DATE!==""){dtTm.setISO8601(recentPart.DATE);
dtHvr=df.format(dtTm,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_4YEAR);
}else{dtHvr=DocI18n.UNKNOWN;
}}else{lastPrsnl=DocI18n.UNKNOWN;
dtHvr=DocI18n.UNKNOWN;
}jsHTML.push("<dl class='",compNS,"-info'><dd class='",compNS+"-cat'><span>",MP_Util.CreateClinNoteLink(patId,enctrId,evntId,doc.display,viewerType,parentEventId),"</span>");
if(docStatus.meaning=="MODIFIED"||docStatus.meaning=="ALTERED"){jsHTML.push("<span class='res-modified'>&nbsp;</span>");
}jsHTML.push("</dd>");
jsHTML.push("<dd class='",compNS,"-auth'><span>",author,"</span></dd>");
if(component.getDateFormat()==3){jsHTML.push("<dd class='",compNS,"-dt'><span class='date-time'>",withinDateDos,"</span></dd>");
}else{jsHTML.push("<dd class='",compNS,"-dt'><span class='date-time'>",dateOfService,"</span></dd>");
}jsHTML.push("<dd class='",compNS,"-image'>");
if(docObj.IMAGE_URL!==""){var urlParam='javascript:MPAGES_SVC_EVENT("'+docObj.IMAGE_URL+'",^MINE,$PAT_PersonId$^)';
jsHTML.push("<a class='",compNS,"-image-found' href='",urlParam,"'>&nbsp;</a>");
}else{jsHTML.push("&nbsp;");
}jsHTML.push("</dd></dl>");
if(component.isHoverEnabled()){jsHTML.push("<h4 class='det-hd'><span>",DocI18n.DOCUMENTATION_DETAILS,"</span></h4><div class='hvr'><dl class='",compNS,"-det'><dt><span>",DocI18n.NAME,":</span></dt><dd class='",compNS,"-det-name'><span>",doc.display,"</span></dd><dt><span>",DocI18n.SUBJECT,":</span></dt><dd class='",compNS,"-det-subj'><span>",docObj.SUBJECT,"</span></dd><dt><span>",DocI18n.STATUS,":</span></dt><dd class='",compNS,"-det-status'><span>",MP_Util.GetValueFromArray(docObj.RESULT_STATUS_CD,codeArray).display,"</span></dd><dt><span>",DocI18n.LAST_UPDATED,":</span></dt><dd class='",compNS,"-det-dt'><span>",dtHvr,"</span></dd><dt><span>",DocI18n.LAST_UPDATED_BY,":</span></dt><dd class='",compNS,"-det-dt'><span>",lastPrsnl,"</span></dd></dl></div>");
}}jsHTML.push("</div>");
sHTML=jsHTML.join("");
return sHTML;
}};
function GetLatestParticipation(doc){var returnPart=null;
for(var x=doc.ACTION_PROVIDERS.length;
x--;
){var part=doc.ACTION_PROVIDERS[x];
if(!returnPart||part.DATE>returnPart.DATE){returnPart=part;
}}return(returnPart);
}function DocumentSorter(a,b){var aPart=GetLatestParticipation(a);
var bPart=GetLatestParticipation(b);
var aDate="";
var bDate="";
if(aPart){aDate=aPart.EFFECTIVE_DT_TM;
}if(bPart){bDate=bPart.EFFECTIVE_DT_TM;
}if(aDate>bDate){return -1;
}else{if(aDate<bDate){return 1;
}else{return 0;
}}}function GetAuthorParticipant(doc,codeArray){var returnPart=null,type_cd=null,status_cd=null,part=null,strPerform="PERFORM",strCompleted="COMPLETED";
for(var y=doc.ACTION_PROVIDERS.length;
y--;
){part=doc.ACTION_PROVIDERS[y];
type_cd=MP_Util.GetValueFromArray(part.TYPE_CD,codeArray);
status_cd=MP_Util.GetValueFromArray(part.STATUS_CD,codeArray);
if((type_cd&&type_cd.meaning===strPerform)&&(status_cd&&status_cd.meaning===strCompleted)){returnPart=part;
break;
}}return(returnPart);
}function appendDropDown(preSec,component,pcnFav,contentPath){if(preSec!="doc"){return;
}pre=component.getStyles().getId();
if((_g(pre+"Drop")!=null)&&_g(pre+"Menu")!=null){return;
}var img=Util.cep("img",{src:contentPath+"\\images\\3943_16.gif"});
var link=Util.cep("a",{className:"drop-Down",id:pre+"Drop"});
var menu=Util.cep("div",{id:pre+"Menu",className:"form-menu menu-hide"});
Util.ac(img,link);
var sec=_g(component.getStyles().getId());
var secCL=Util.Style.g("sec-title",sec,"span");
var secSpan=secCL[0];
Util.ac(link,secSpan);
Util.ac(menu,secSpan);
pcnFavLoad(pcnFav,component);
}function pcnFavLoad(pcnFav,component){var jsonPcnFav=pcnFav;
var docDropId=component.getStyles().getId()+"Drop";
var docDrop=_g(docDropId);
var htmlPcnFav=[];
var numId=0;
var pcn=jsonPcnFav.PRE_COMPLETED;
pcn.sort(function(obj1,obj2){function checkStrings(s1,s2){return(s1===s2)?0:((s1>s2)?1:-1);
}return checkStrings(obj1.DISPLAY.toUpperCase(),obj2.DISPLAY.toUpperCase());
});
if(!pcn[0]){htmlPcnFav.push("<div>",i18n.discernabu.documents_base_o1.DOCUMENT_FAVS,'<span class="favHidden" id="docCKI',numId,'">',i18n.DOCUMENT_FAVS,"</span></div>");
}else{var crit=component.getCriterion();
for(var j=0,l=pcn.length;
j<l;
j++){var pcNote=pcn[j];
numId=numId+1;
htmlPcnFav.push('<div><a id="doc',numId,'" href="#">',pcNote.DISPLAY,"</a>",'<span class="favHidden" id="docCKI',numId,'">',pcNote.SOURCE_IDENTIFIER,"</span>",'<span class="favHidden" id="docStyleID',numId,'">',component.getStyles().getId(),"</span>","</div>");
}}var pcnArray=htmlPcnFav.join("");
var newSpan=Util.cep("span");
newSpan.innerHTML=pcnArray;
var docMenuId=component.getStyles().getId()+"Menu";
var docMenu=_g(docMenuId);
Util.ac(newSpan,docMenu);
var docMenuList=_gbt("a",docMenu);
var dmLen=docMenuList.length;
for(var i=dmLen;
i--;
){Util.addEvent(docMenuList[i],"click",addDocDet);
}closeMenuInit(docMenu,component.getStyles().getId());
Util.addEvent(docDrop,"click",function(){if(Util.Style.ccss(Util.gns(this),"menu-hide")){_g(component.getStyles().getId()).style.zIndex=2;
Util.preventDefault();
Util.Style.rcss(Util.gns(this),"menu-hide");
}else{_g(component.getStyles().getId()).style.zIndex=1;
Util.Style.acss(Util.gns(this),"menu-hide");
}});
}function addDocDet(){try{var PowerNoteMPageUtils=window.external.DiscernObjectFactory("POWERNOTE");
var comp={};
if(PowerNoteMPageUtils){var menuVal=Util.gns(this);
var cki=menuVal.firstChild.data;
var spanDocStyleID=Util.gns(menuVal);
for(var x=0,xl=CERN_MPageComponents.length;
x<xl;
x++){comp=CERN_MPageComponents[x];
var styles=comp.getStyles();
if(styles.getId()==spanDocStyleID.firstChild.data){break;
}}var crit=comp.getCriterion();
PowerNoteMPageUtils.BeginNoteFromPrecompletedNote(crit.person_id+".0",crit.encntr_id+".0",cki+".0");
CERN_DOCUMENT_BASE_O1.GetDocumentsTable(comp);
}}catch(err){alert('An error has occured calling DiscernObjectFactory("POWERNOTE"): '+err.name+" "+err.message);
return;
}}function closeMenuInit(inMenu,compId){var menuId;
var docMenuId=compId+"Menu";
if(inMenu.id==docMenuId){menuId=compId;
}if(!e){var e=window.event;
}if(window.attachEvent){Util.addEvent(inMenu,"mouseleave",function(){Util.Style.acss(inMenu,"menu-hide");
_g(menuId).style.zIndex=1;
});
}else{Util.addEvent(inMenu,"mouseout",menuLeave);
}function menuLeave(e){if(!e){var e=window.event;
}var relTarg=e.relatedTarget||e.toElement;
if(e.relatedTarget.id==inMenu.id){Util.Style.acss(inMenu,"menu-hide");
_g(menuId).style.zIndex=1;
}e.stopPropagation();
Util.cancelBubble(e);
}}}();

function AllergyComponentStyle(){this.initByNamespace("al");
}AllergyComponentStyle.inherits(ComponentStyle);
function AllergyComponent(criterion){this.setCriterion(criterion);
this.setStyles(new AllergyComponentStyle());
this.setComponentLoadTimerName("USR:MPG.ALLERGY.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.ALLERGY.O1 - render component");
this.setIncludeLineNumber(true);
this.setScope(1);
AllergyComponent.method("InsertData",function(){CERN_ALLERGY_O1.GetAllergyTable(this);
});
AllergyComponent.method("HandleSuccess",function(recordData){CERN_ALLERGY_O1.RenderComponent(this,recordData);
});
AllergyComponent.method("openTab",function(){var criterion=this.getCriterion();
var sParms="/PERSONID="+criterion.person_id+" /ENCNTRID="+criterion.encntr_id+" /FIRSTTAB=^"+this.getLink()+"+^";
APPLINK(0,criterion.executable,sParms);
this.InsertData();
});
}AllergyComponent.inherits(MPageComponent);
var CERN_ALLERGY_O1=function(){return{GetAllergyTable:function(component){var sendAr=[];
var criterion=component.getCriterion();
sendAr.push("^MINE^",criterion.person_id+".0","0.0",0,criterion.provider_id+".0",criterion.ppr_cd+".0");
MP_Core.XMLCclRequestWrapper(component,"MP_GET_ALLERGIES",sendAr,true);
},RenderComponent:function(component,recordData){var timerRenderComponent=MP_Util.CreateTimer(component.getComponentRenderTimerName());
var countText="";
try{var jsAlHTML=[];
var alHTML="";
var j=0;
var severityCodeObj,jsSeverity,jsSeverityDisp="",statusCodeObj;
var onsetPrecisionObj,onsetPrecision="";
var dateTime=new Date();
var onsetDate="";
var datetimeFlag=0;
var codeArray=MP_Util.LoadCodeListJSON(recordData.CODES);
var personnelArray=MP_Util.LoadPersonelListJSON(recordData.PRSNL);
jsAlHTML.push("<div class='",MP_Util.GetContentClass(component,recordData.ALLERGY.length),"'>");
var df=new mp_formatter.DateTimeFormatter(MPAGE_LOCALE);
var allergyArray=recordData.ALLERGY;
for(var i=0,il=allergyArray.length;
i<il;
i++){jsSeverityDisp="";
if(recordData.ALLERGY[i].ONSET_DT_TM&&recordData.ALLERGY[i].ONSET_DT_TM!==""){onsetDate=recordData.ALLERGY[i].ONSET_DT_TM;
dateTime.setISO8601(onsetDate);
}if(recordData.ALLERGY[i].ONSET_PRECISION_CD){onsetPrecisionObj=MP_Util.GetValueFromArray(recordData.ALLERGY[i].ONSET_PRECISION_CD,codeArray);
onsetPrecision=onsetPrecisionObj.display;
}else{onsetPrecision="";
}datetimeFlag=recordData.ALLERGY[i].ONSETDATE_FLAG;
switch(datetimeFlag){case 20:case 30:onsetDate=df.format(dateTime,mp_formatter.DateTimeFormatter.FULL_DATE_4YEAR);
break;
case 40:onsetDate=df.format(dateTime,mp_formatter.DateTimeFormatter.FULL_MONTH_4YEAR_NO_DATE);
break;
case 50:onsetDate=df.format(dateTime,mp_formatter.DateTimeFormatter.FULL_4YEAR);
break;
case 0:onsetDate="";
break;
default:onsetDate=df.format(dateTime,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_4YEAR);
break;
}if(recordData.ALLERGY[i].STATUS_CD){statusCodeObj=MP_Util.GetValueFromArray(recordData.ALLERGY[i].STATUS_CD,codeArray);
}if(recordData.ALLERGY[i].SEVERITY_CD){severityCodeObj=MP_Util.GetValueFromArray(recordData.ALLERGY[i].SEVERITY_CD,codeArray);
jsSeverity=severityCodeObj.meaning;
jsSeverityDisp=severityCodeObj.display;
}if(jsSeverity=="SEVERE"||jsSeverityDisp.toUpperCase()=="ANAPHYLLAXIS"){jsSeverity="res-severe";
}else{jsSeverity="res-normal";
}jsAlHTML.push("<h3 class='info-hd'><span class='",jsSeverity,"'>",recordData.ALLERGY[i].NAME,"</span></h3><dl class='al-info'><dt><span>"+i18n.ALLERGY+":</span></dt><dd class='al-name'><span class='",jsSeverity,"'>",recordData.ALLERGY[i].NAME,"</span></dd><dt><span>"+i18n.REACTION+":</span></dt><dd class='al-reac'><span class='",jsSeverity,"'>");
for(j=0,m=recordData.ALLERGY[i].REACTIONS.length;
j<m;
j++){if(j>0){jsAlHTML.push(", ");
}jsAlHTML.push(recordData.ALLERGY[i].REACTIONS[j].REACTION_NAME);
}jsAlHTML.push("</span></dd></dl><h4><span class='det-hd'>"+i18n.DETAILS+":</span></h4><div class='hvr'><dl class='al-det'><dt><span>"+i18n.ALLERGY_NAME+":</span></dt><dd class='al-det-name'><span class='",jsSeverity,"'>",recordData.ALLERGY[i].NAME,"</span></dd><dt><span>"+i18n.REACTION+":</span></dt><dd class='al-det-reac'><span class='",jsSeverity,"'>");
for(j=0,m=recordData.ALLERGY[i].REACTIONS.length;
j<m;
j++){if(j>0){jsAlHTML.push(", ");
}jsAlHTML.push(recordData.ALLERGY[i].REACTIONS[j].REACTION_NAME);
}jsAlHTML.push("</span></dd><dt><span>",i18n.SEVERITY,":</span></dt><dd class='al-det-sev'><span class='",jsSeverity,"'>",jsSeverityDisp,"</span></dd><dt><span>",i18n.STATUS,":</span></dt><dd class='al-det-status'><span>",statusCodeObj.display,"</span></dd><dt><span>",i18n.ONSET_DATE,":</span></dt><dd class='al-det-dt'><span>");
if(onsetPrecision&&onsetPrecision!==""){jsAlHTML.push(onsetPrecision,"&nbsp;",onsetDate);
}else{jsAlHTML.push(onsetDate);
}jsAlHTML.push("</span></dd><dt><span>",i18n.COMMENTS,":</span></dt><dd class='al-det-comment'><span>",MP_Util.Doc.GetComments(allergyArray[i],personnelArray),"</span></dd></dl></div>");
}jsAlHTML.push("</div>");
alHTML=jsAlHTML.join("");
countText=MP_Util.CreateTitleText(component,recordData.ALLERGY.length);
MP_Util.Doc.FinalizeComponent(alHTML,component,countText);
}catch(err){var errMsg=[];
errMsg.push("<b>",i18n.JS_ERROR,"</b><br><ul><li>",i18n.MESSAGE,": ",err.message,"</li><li>",i18n.NAME,": ",err.name,"</li><li>",i18n.NUMBER,": ",(err.number&65535),"</li><li>",i18n.DESCRIPTION,": ",err.description,"</li></ul>");
MP_Util.Doc.FinalizeComponent(MP_Util.HandleErrorResponse(component.getStyles().getNameSpace(),errMsg.join("")),component,countText);
if(timerRenderComponent){timerRenderComponent.Abort();
timerRenderComponent=null;
}throw (err);
}finally{if(timerRenderComponent){timerRenderComponent.Stop();
}}}};
}();

var CERN_DEMO_BANNER_O1=function(){return{GetPatientDemographics:function(demoBanner,criterion){timerPatDemLoad=MP_Util.CreateTimer("USR:MPG.DEMO_BANNER.O1 - load component");
if(timerPatDemLoad){timerPatDemLoad.Start();
}var info=new XMLCclRequest();
info.onreadystatechange=function(){if(this.readyState==4&&this.status==200){var timer=MP_Util.CreateTimer("ENG:MPG.DEMO_BANNER.O1 – render component");
try{var jsHTML=[];
var sHTML="",birthDate="",visitReason="",mrnNbr,finNbr="",age="",isolation="";
var jsonText=JSON.parse(this.responseText);
var codeArray=MP_Util.LoadCodeListJSON(jsonText.RECORD_DATA.CODES);
var patInfo=jsonText.RECORD_DATA.DEMOGRAPHICS.PATIENT_INFO;
var nameFull=patInfo.PATIENT_NAME.NAME_FULL;
var enCodeArray=[];
var ptCodeArray=[];
var formattedAliasArray=[];
var dateTime=new Date();
if(patInfo.BIRTH_DT_TM!==""){dateTime.setISO8601(patInfo.BIRTH_DT_TM);
birthDate=dateTime.format("shortDate2");
age=MP_Util.CalcAge(dateTime);
}var oSex=MP_Util.GetValueFromArray(patInfo.SEX_CD,codeArray);
var encntrInfo=jsonText.RECORD_DATA.DEMOGRAPHICS.ENCOUNTER_INFO;
for(var j=0,e=encntrInfo.length;
j<e;
j++){visitReason=encntrInfo[j].REASON_VISIT;
for(var i=0,l=encntrInfo[j].ALIAS.length;
i<l;
i++){enCodeArray[i]=MP_Util.GetValueFromArray(encntrInfo[j].ALIAS[i].ALIAS_TYPE_CD,codeArray);
if(enCodeArray[i].meaning=="FIN NBR"){finNbr=encntrInfo[j].ALIAS[i].FORMATTED_ALIAS;
}if(enCodeArray[i].meaning=="MRN"){mrnNbr=encntrInfo[j].ALIAS[i].FORMATTED_ALIAS;
}}if(encntrInfo[j].ISOLATION_CD>0){var isoObj=MP_Util.GetValueFromArray(encntrInfo[j].ISOLATION_CD,codeArray);
isolation=isoObj.display;
}}aliasArry=jsonText.RECORD_DATA.DEMOGRAPHICS.PATIENT_INFO.ALIAS;
if(mrnNbr==""){for(var i=0,l=aliasArry.length;
i<l;
i++){ptCodeArray[i]=MP_Util.GetValueFromArray(aliasArry[i].ALIAS_TYPE_CD,codeArray);
if(ptCodeArray[i].meaning=="MRN"){mrnNbr=aliasArry[i].FORMATTED_ALIAS;
}}}var sexAbb=(oSex&&oSex!==null)?oSex.display:i18n.UNKNOWN;
jsHTML.push("<dl class='dmg-info'><dt class='dmg-pt-name-lbl'><span>",i18n.NAME,"</span></dt><dd class='dmg-pt-name'><span>",nameFull,"</span></dd><dt class='dmg-sex-age-lbl'><span>",i18n.SEX," ",i18n.AGE,"</span></dt><dd class='dmg-sex-age'><span>",sexAbb," ",age,"</span></dd><dt><span>",i18n.DOB,":</span></dt><dd class='dmg-dob'><span>",birthDate,"</span></dd><dt><span>",i18n.MRN,":</span></dt><dd class='dmg-mrn'><span>",mrnNbr,"</span></dd><dt><span>",i18n.FIN,":</span></dt><dd class='dmg-fin'><span>",finNbr,"</span></dd><dt><span>",i18n.ISOLATION,":</span></dt><dd class='dmg-isolation'><span>",isolation,"</span></dd><dt><span>",i18n.VISIT_REASON,":</span></dt><dd class='dmg-rfv'><span>",visitReason,"</span></dd></dl>");
demoBanner.innerHTML=jsHTML.join("");
}finally{if(timer){timer.Stop();
}if(timerPatDemLoad){timerPatDemLoad.Stop();
}}}if(this.readyState==4){MP_Util.ReleaseRequestReference(this);
}};
info.open("GET","MP_GET_PATIENT_DEMO",0);
var sendAr=[];
sendAr.push("^MINE^",criterion.person_id+".0",criterion.encntr_id+".0");
info.send(sendAr.join(","));
}};
}();

function DiagnosesComponentStyle(){this.initByNamespace("dx");
}DiagnosesComponentStyle.inherits(ComponentStyle);
function DiagnosesComponent(criterion){this.m_searchTypeFlag=null;
this.m_suggestionLimit=null;
this.curSearchCounter=0;
this.nextSearchCounter=0;
this.replySearchCounter=0;
this.setCriterion(criterion);
this.setStyles(new DiagnosesComponentStyle());
this.setComponentLoadTimerName("USR:MPG.DIAGNOSES.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.DIAGNOSES.O1 - render component");
this.setIncludeLineNumber(true);
this.setScope(2);
DiagnosesComponent.method("InsertData",function(){this.setEditMode(true);
CERN_DIAGNOSES_O1.GetDiagnosisTable(this);
});
DiagnosesComponent.method("HandleSuccess",function(recordData){CERN_DIAGNOSES_O1.RenderComponent(this,recordData);
});
DiagnosesComponent.method("setDiagnosisType",function(value){this.m_diagnosisType=value;
});
DiagnosesComponent.method("getDiagnosisType",function(){if(this.m_diagnosisType!==null){return this.m_diagnosisType;
}});
DiagnosesComponent.method("getSearchTypeFlag",function(){return this.m_searchTypeFlag;
});
DiagnosesComponent.method("setSearchTypeFlag",function(value){this.m_searchTypeFlag=value;
});
DiagnosesComponent.method("getSuggestionLimit",function(){return this.m_suggestionLimit;
});
DiagnosesComponent.method("setSuggestionLimit",function(value){this.m_suggestionLimit=value;
});
DiagnosesComponent.method("getCurSearchCounter",function(){return this.curSearchCounter;
});
DiagnosesComponent.method("setCurSearchCounter",function(value){this.curSearchCounter=value;
});
DiagnosesComponent.method("incCurSearchCounter",function(){this.curSearchCounter++;
});
DiagnosesComponent.method("getNextSearchCounter",function(){return this.nextSearchCounter;
});
DiagnosesComponent.method("setNextSearchCounter",function(value){this.nextSearchCounter=value;
});
DiagnosesComponent.method("incNextSearchCounter",function(){this.nextSearchCounter++;
});
DiagnosesComponent.method("getReplySearchCounter",function(){return this.replySearchCounter;
});
DiagnosesComponent.method("setReplySearchCounter",function(value){this.replySearchCounter=value;
});
DiagnosesComponent.method("incReplySearchCounter",function(){this.replySearchCounter++;
});
}DiagnosesComponent.inherits(MPageComponent);
var CERN_DIAGNOSES_O1=function(){return{GetDiagnosisTable:function(component){var sendAr=[];
var criterion=component.getCriterion();
var encntrOption=(component.getScope()==2)?(criterion.encntr_id+".0"):"0.0";
sendAr.push("^MINE^",criterion.person_id+".0",encntrOption,0);
var types=component.getDiagnosisType();
var diagnosisType=(types&&types!==null&&types.length>0)?"value("+types.join(",")+")":"0.0";
sendAr.push(diagnosisType);
sendAr.push(criterion.provider_id+".0",criterion.ppr_cd+".0",criterion.position_cd+".0");
var request=new MP_Core.ScriptRequest(component,component.getComponentLoadTimerName());
request.setProgramName("MP_GET_DIAGNOSES");
request.setParameters(sendAr);
request.setAsync(true);
MP_Core.XMLCCLRequestCallBack(component,request,CERN_DIAGNOSES_O1.RenderComponent);
},RenderComponent:function(reply){var recordData=reply.getResponse();
var component=reply.getComponent();
var timerRenderComponent=MP_Util.CreateTimer(component.getComponentRenderTimerName());
try{var dxI18n=i18n.discernabu.diagnoses_o1;
var jsDxHTML=[];
var dxHTML="",countText="";
if(reply.getStatus()!=="F"){if(recordData.DX_CAN_ADD===1){jsDxHTML.push(MP_Util.CreateAutoSuggestBoxHtml(component));
component.setAutoSuggestAddScript("mp_add_diagnosis");
component.setAutoSuggestAddTimerName("USR:MPG.DIAGNOSES.O1 - add diagnosis from auto suggest");
component.setSuggestionLimit(10);
}if(reply.getStatus()==="S"){var diagDate=dxCode=dxTypeCode=dxAnnot=dxName=dxFaceUp=comm=responProvider="";
var dateTime=new Date();
var personnelArray=[];
var df=new mp_formatter.DateTimeFormatter(MPAGE_LOCALE);
personnelArray=MP_Util.LoadPersonelListJSON(recordData.PRSNL);
codeArray=MP_Util.LoadCodeListJSON(recordData.CODES);
var diagnosisArray=recordData.DIAGNOSIS;
diagnosisArray.sort(SortByDiagnosesName);
jsDxHTML.push("<div class ='",MP_Util.GetContentClass(component,diagnosisArray.length),"'>");
for(var i=0,l=diagnosisArray.length;
i<l;
i++){var diagnose=diagnosisArray[i];
dxName=dxFaceUp=diagnose.NAME;
if(diagnose.DISPLAY_AS!=""){dxAnnot=dxFaceUp=diagnose.DISPLAY_AS;
}else{dxAnnot="";
}if(diagnose.CODE!=""&&diagnose.CODE!="()"){dxCode=diagnose.CODE;
}else{dxCode="()";
}if(diagnose.DIAG_DT_TM!=""){diagDate=df.formatISO8601(diagnose.DIAG_DT_TM,mp_formatter.DateTimeFormatter.FULL_DATE_4YEAR);
}else{diagDate="";
}if(diagnose.COMMENTS!=""){var comm=diagnose.COMMENTS;
}else{comm="";
}if(diagnose.PRSNL_ID>0){responProvider=MP_Util.GetValueFromArray(diagnose.PRSNL_ID,personnelArray).fullName;
}else{responProvider="";
}if(diagnose.DIAG_TYPE_CD>0){dxTypeCode=MP_Util.GetValueFromArray(diagnose.DIAG_TYPE_CD,codeArray).display;
}else{dxTypeCode="";
}jsDxHTML.push("<h3 class='info-hd'><span>",dxName,"</span></h3><dl class='dx-info'><dt><span>",dxI18n.DIAGNOSES,":</span></dt><dd class='dx-name'><span>",dxFaceUp,"</span></dd><dt><span>",dxI18n.CODE,":</span></dt><dd class='dx-code'><span class='code'>",dxCode,"</span></dd></dl><h4 class='det-hd'><span>",dxI18n.DETAILS,":</span></h4><div class='hvr'><dl class='dx-det'><dt><span>",dxI18n.DIAGNOSES_NAME,":</span></dt><dd><span>",dxName,"</span></dd><dt><span>",dxI18n.ANNOTATED_DISPLAY,":</span></dt><dd><span>",dxAnnot,"</span></dd><dt><span>",dxI18n.DIAGNOSES_DATE,":</span></dt><dd><span>",diagDate,"</span></dd><dt><span>",dxI18n.RESPONSIBLE_PROVIDER_NAME,":</span></dt><dd><span>",responProvider,"</span></dd><dt><span>",dxI18n.DIAG_TYPE,":</span></dt><dd><span>",dxTypeCode,"</span></dd><dt><span>",dxI18n.COMMENTS,":</span></dt><dd><span>",comm,"</span></dd></dl></div>");
}jsDxHTML.push("</div>");
dxHTML=jsDxHTML.join("");
countText=MP_Util.CreateTitleText(component,l);
}else{if((reply.getStatus()==="Z")){dxHTML=jsDxHTML.join("");
dxHTML+=MP_Util.HandleNoDataResponse(component.getStyles().getNameSpace());
}}MP_Util.Doc.FinalizeComponent(dxHTML,component,countText);
if(recordData.DX_CAN_ADD===1){MP_Util.AddAutoSuggestControl(component,CERN_DIAGNOSES_O1.SearchNomenclature,CERN_DIAGNOSES_O1.HandleSelection,CERN_DIAGNOSES_O1.CreateSuggestionLine);
component.setSearchTypeFlag(recordData.DX_SEARCH_TYPE);
}}else{countText=MP_Util.CreateTitleText(component,0);
MP_Util.Doc.FinalizeComponent(MP_Util.HandleErrorResponse(component.getStyles().getNameSpace(),reply.getError()),component,countText);
}}catch(err){if(timerRenderComponent){timerRenderComponent.Abort();
timerRenderComponent=null;
}throw (err);
}finally{if(timerRenderComponent){timerRenderComponent.Stop();
}component.setEditMode(false);
}},SearchNomenclature:function(callback,textBox,component){var xhr=new XMLCclRequest();
var returnData;
component.incCurSearchCounter();
xhr.onreadystatechange=function(){if(xhr.readyState==4&&xhr.status==200){var msg=xhr.responseText;
var jsonMsg="";
if(msg){jsonMsg=JSON.parse(msg);
}if(jsonMsg){var nextSearchCounter=component.getNextSearchCounter();
var replySearchCounter=jsonMsg.RECORD_DATA.SEARCHINDEX;
component.setReplySearchCounter(replySearchCounter);
if(replySearchCounter>nextSearchCounter&&textBox.value!=""){component.setNextSearchCounter(replySearchCounter);
returnData=jsonMsg.RECORD_DATA.NOMENCLATURE;
callback.autosuggest(returnData);
}}}};
xhr.open("GET","mp_search_nomenclatures");
xhr.send("^MINE^, ^"+textBox.value+"^,"+component.getSuggestionLimit()+","+component.getCurSearchCounter()+","+component.getSearchTypeFlag());
},HandleSelection:function(suggestionObj,textBox,component){var criterion=component.getCriterion();
var sendAr=[];
sendAr.push("^MINE^",criterion.person_id+".0",criterion.provider_id+".0",criterion.encntr_id+".0",criterion.ppr_cd+".0",suggestionObj.VALUE+".0",criterion.position_cd+".0","0.0");
var request=new MP_Core.ScriptRequest(component,component.getAutoSuggestAddTimerName());
request.setProgramName(component.getAutoSuggestAddScript());
request.setParameters(sendAr);
request.setAsync(true);
MP_Core.XMLCCLRequestCallBack(component,request,CERN_DIAGNOSES_O1.AddDiagnosisToList);
},AddDiagnosisToList:function(reply){var alertMsg="";
var jsonReply=reply.getResponse();
var component=reply.getComponent();
var componentName="";
var textBox=MP_Util.RetrieveAutoSuggestSearchBox(component);
componentName=i18n.discernabu.DIAGNOSIS;
if(jsonReply&&jsonReply.PRIVILEGE_IND==0){alertMsg=i18n.discernabu.NO_PRIVS;
alertMsg=alertMsg.replace("{name}",componentName);
alert(alertMsg);
textBox.value="";
}else{if(jsonReply&&jsonReply.DUPLICATE_IND==1){alertMsg=i18n.discernabu.DUPLICATE;
alertMsg=alertMsg.replace(/{name}/gi,componentName);
alert(alertMsg);
textBox.value="";
}else{MP_Util.Doc.HideHovers();
component.InsertData();
}}},CreateSuggestionLine:function(suggestionObj,searchVal){return CERN_DIAGNOSES_O1.HighlightValue(suggestionObj.NAME,searchVal);
},HighlightValue:function(inString,term){return"<strong class='highlight'>"+inString.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+term.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1").split(" ").join("|")+")(?![^<>]*>)(?![^&;]+;)","gi"),"</strong>$1<strong class='highlight'>")+"</strong>";
}};
function SortByDiagnosesName(a,b){var aName=(a.DISPLAY_AS!=""&&a.DISPLAY_AS!=null&&a.DISPLAY_AS!=a.NAME)?a.DISPLAY_AS.toUpperCase():a.NAME.toUpperCase();
var bName=(b.DISPLAY_AS!=""&&b.DISPLAY_AS!=null&&b.DISPLAY_AS!=a.NAME)?b.DISPLAY_AS.toUpperCase():b.NAME.toUpperCase();
if(aName<bName){return -1;
}else{if(aName>bName){return 1;
}else{return 0;
}}}}();

function DiagnosticsComponentStyle(){this.initByNamespace("dg");
}DiagnosticsComponentStyle.inherits(ComponentStyle);
function DiagnosticsComponent(criterion){this.setCriterion(criterion);
this.setStyles(new DiagnosticsComponentStyle());
this.setComponentLoadTimerName("USR:MPG.DIAGNOSTICS.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.DIAGNOSTICS.O1 - render component");
this.setIncludeLineNumber(true);
DiagnosticsComponent.method("InsertData",function(){var nameSpace=new CERN_DIAGNOSTICS_O1();
nameSpace.GetDiagnostics(this);
});
DiagnosticsComponent.method("setResultStatusCodes",function(value){this.m_resultStatusCodes=value;
});
DiagnosticsComponent.method("addResultStatusCode",function(value){if(this.m_resultStatusCodes==null){this.m_resultStatusCodes=[];
}this.m_resultStatusCodes.push(value);
});
DiagnosticsComponent.method("getResultStatusCodes",function(){if(this.m_resultStatusCodes!=null){return this.m_resultStatusCodes;
}else{if(this.m_resultStatusMeanings!=null){var resStatusCodeSet=MP_Util.GetCodeSet(8,false);
if(this.m_resultStatusMeanings&&this.m_resultStatusMeanings.length>0){for(var x=this.m_resultStatusMeanings.length;
x--;
){var code=MP_Util.GetCodeByMeaning(resStatusCodeSet,this.m_resultStatusMeanings[x]);
if(code!=null){this.addResultStatusCode(code.codeValue);
}}}}}return this.m_resultStatusCodes;
});
DiagnosticsComponent.method("addResultStatusMeaning",function(value){if(this.m_resultStatusMeanings==null){this.m_resultStatusMeanings=[];
}this.m_resultStatusMeanings.push(value);
});
DiagnosticsComponent.method("setResultStatusMeanings",function(value){this.m_resultStatusMeanings=value;
});
}DiagnosticsComponent.inherits(MPageComponent);
var CERN_DIAGNOSTICS_O1=function(){var isErrorLoadingData=false;
var isDataFound=false;
var totalResultCount=0;
var m_comp=null;
var m_contentNode=null;
var m_rootComponentNode=null;
var m_threadCount=0;
return{GetDiagnostics:function(component){m_comp=component;
var styles=component.getStyles();
m_rootComponentNode=component.getRootComponentNode();
m_contentNode=component.getSectionContentNode();
var groups=component.getGroups();
var xl=(groups!=null)?groups.length:0;
m_threadCount=xl;
CreateInfoHeader(m_contentNode);
if(component.getDateFormat()==3){CreateWithinHeader(m_contentNode);
}for(var x=0;
x<xl;
x++){var group=groups[x];
var subSection=CreateSubHeader(group.getGroupName());
GetVariousAssessment(group,subSection);
}if(m_threadCount===0){FinalizeComponent();
}}};
function CreateWithinHeader(contentNode){var dl=Util.cep("dl",{className:"dg-info-hdr hdr"});
var dd=Util.cep("dd",{className:"dg-name-hd"});
Util.ac(dd,dl);
var span=Util.cep("span");
Util.ac(span,dd);
var txtNbsp=document.createTextNode(String.fromCharCode(160));
Util.ac(txtNbsp,span);
var ddWithin=Util.cep("dd",{className:"dg-within-hd"});
Util.ac(ddWithin,dl);
var spanWithin=Util.cep("span");
Util.ac(spanWithin,ddWithin);
var txtWithin=document.createTextNode(i18n.WITHIN);
Util.ac(txtWithin,spanWithin);
Util.ac(dl,contentNode);
}function CreateInfoHeader(contentNode){var dl=Util.cep("dl",{className:"dg-info-hdr hdr"});
var dd=Util.cep("dd",{className:"dg-name-hd"});
Util.ac(dd,dl);
var span=Util.cep("span");
Util.ac(span,dd);
var txtNbsp=document.createTextNode(String.fromCharCode(160));
Util.ac(txtNbsp,span);
var ddWithin=Util.cep("dd",{className:"dg-within-hd"});
Util.ac(ddWithin,dl);
var spanWithin=Util.cep("span");
Util.ac(spanWithin,ddWithin);
var txtWithin=document.createTextNode(i18n.DATE_TIME);
Util.ac(txtWithin,spanWithin);
var ddStat=Util.cep("dd",{className:"dg-stat-hd"});
Util.ac(ddStat,dl);
var spanStat=Util.cep("span");
Util.ac(spanStat,ddStat);
var txtStat=document.createTextNode(i18n.STATUS);
Util.ac(txtStat,spanStat);
Util.ac(dl,contentNode);
}function CreateSubHeader(label){var subSec=Util.cep("div",{className:"sub-sec"});
var h3=Util.cep("h3",{className:"sub-sec-hd"});
subSec.appendChild(h3);
var spanTgl=Util.cep("span",{className:"sub-sec-hd-tgl",title:i18n.HIDE_SECTION});
h3.appendChild(spanTgl);
var TgltxtNode=document.createTextNode("-");
spanTgl.appendChild(TgltxtNode);
var spanTitle=Util.cep("span",{className:"sub-sec-title"});
h3.appendChild(spanTitle);
var labelTextNode=document.createTextNode(label);
spanTitle.appendChild(labelTextNode);
m_contentNode.appendChild(subSec);
return(subSec);
}function GetDocResults(group,subSection,subSecTitle,events){var ar=[];
var info=new XMLCclRequest();
info.onreadystatechange=function(){if(this.readyState==4&&this.status==200){m_threadCount--;
var strHTML="",sDate="",sDateHvr="",sDisplay="",sResult="",sStatus="";
var jsonEval=JSON.parse(this.responseText);
var subCnt=0;
if(jsonEval.RECORD_DATA.STATUS_DATA.STATUS=="S"){isDataFound=true;
var codeArray=MP_Util.LoadCodeListJSON(jsonEval.RECORD_DATA.CODES);
ar.push("<div class='content-body'>");
var docs=jsonEval.RECORD_DATA.DOCS;
docs.sort(SortByEffectiveDate);
for(var i=0,l=docs.length;
i<l;
i++){var ce=docs[i];
var link="";
if(ce.EVENT_CD!==""){var eventObj=MP_Util.GetValueFromArray(ce.EVENT_CD,codeArray);
sDisplay=eventObj.display;
link=MP_Util.CreateClinNoteLink(ce.PERSON_ID+".0",ce.ENCNTR_ID+".0",ce.EVENT_ID+".0",sDisplay,ce.VIEWER_TYPE,ce.PARENT_EVENT_ID+".0");
}if(ce.EFFECTIVE_DATE!==""){var dateTime=new Date();
dateTime.setISO8601(ce.EFFECTIVE_DATE);
sDate=MP_Util.DisplayDateByOption(m_comp,dateTime);
sDateHvr=dateTime.format("longDateTime3");
}if(ce.RESULT_STATUS_CD>0){var statusObj=MP_Util.GetValueFromArray(ce.RESULT_STATUS_CD,codeArray);
sStatus=statusObj.display;
}ar.push("<h3 class='info-hd'>",sDisplay,"</h3><dl class ='dg-info'><dt><span>"+i18n.DIAGNOSTIC+":</span></dt><dd class ='dg-name'><span>",link,"</span>");
if(statusObj.meaning=="MODIFIED"||statusObj.meaning=="ALTERED"){ar.push("<span class='res-modified'>&nbsp;</span>");
}ar.push("</dd><dt><span>",i18n.DATE_TIME,"</span></dt><dd class ='dg-within'>",sDate,"</dd><dt><span>",i18n.STATUS,":</span></dt><dd class='dg-stat'><span>",sStatus,"</span></dd><dd class='dg-image'>");
if(ce.IMAGE_URL!==""){var urlParam='javascript:MPAGES_SVC_EVENT("'+ce.IMAGE_URL+'",^MINE,$PAT_PersonId$^)';
ar.push("<a class='dg-image-found' href='",urlParam,"'>&nbsp;</a>");
}else{ar.push("&nbsp;");
}ar.push("</dd></dl>");
ar.push("<h4 class='det-hd'><span>",i18n.DIAGNOSTIC_DETAILS,"</span></h4><div class='hvr'><dl class='dg-det'><dt><span>",i18n.STUDY,":</span></dt><dd><span>",sDisplay,"</span></dd><dt><span>",i18n.DATE_TIME,":</span></dt><dd><span>",sDateHvr,"</span></dd></dl></div>");
subCnt++;
}ar.push("</div>");
strHTML=ar.join("");
subSecTitle[0].innerHTML=group.getGroupName()+" ("+subCnt+")";
totalResultCount+=subCnt;
var subContent=Util.cep("div",{className:"sub-sec-content"});
subSection.appendChild(subContent);
var contentBody=Util.cep("div",{className:"content-body"});
subContent.appendChild(contentBody);
contentBody.innerHTML=strHTML;
}else{if(jsonEval.RECORD_DATA.STATUS_DATA.STATUS=="Z"){subSecTitle[0].innerHTML=group.getGroupName()+" (0)";
var subContent1=Util.cep("div",{className:"sub-sec-content"});
subSection.appendChild(subContent1);
var contentBody1=Util.cep("div",{className:"content-body"});
subContent1.appendChild(contentBody1);
contentBody1.innerHTML="<div ><span class='res-none'>"+i18n.NO_RESULTS_FOUND+"</span> </div>";
}else{if(jsonEval.RECORD_DATA.STATUS_DATA.STATUS!="Z"){isErrorLoadingData=true;
}}}if(m_threadCount===0){FinalizeComponent();
}}if(this.readyState==4){MP_Util.ReleaseRequestReference(this);
}};
var criterion=m_comp.getCriterion();
info.open("GET","MP_RETRIEVE_DOCUMENTS_JSON");
var encntrOption=(m_comp.getScope()==2)?(criterion.encntr_id+".0"):"0.0";
var codes=m_comp.getResultStatusCodes();
var statusCodes=(codes!=null&&codes.length>0)?"value("+codes.join(",")+")":"0.0";
var eventCodes=(events!=null&&events.length>0)?"value("+events.join(",")+")":"0.0";
var sendAr=[];
sendAr.push("^MINE^",criterion.person_id+".0",encntrOption,criterion.provider_id+".0",m_comp.getLookbackUnits(),eventCodes,statusCodes,criterion.ppr_cd+".0",m_comp.getLookbackUnitTypeFlag());
info.send(sendAr.join(","));
return;
}function GetVariousAssessment(group,subSection){var events=(group.getEventSets()!=null&&group.getEventSets().length>0)?group.getEventSets():null;
var subSecTitle=Util.Style.g("sub-sec-title",subSection,"SPAN");
if(events==null){subSecTitle[0].innerHTML=group.getGroupName()+" (0)";
m_threadCount--;
return;
}GetDocResults(group,subSection,subSecTitle,events);
}function SortByEffectiveDate(a,b){if(a.EFFECTIVE_DATE>b.EFFECTIVE_DATE){return -1;
}else{if(a.EFFECTIVE_DATE<b.EFFECTIVE_DATE){return 1;
}else{return 0;
}}}function FinalizeComponent(){var styles=m_comp.getStyles();
var totalCount=Util.Style.g("sec-total",m_rootComponentNode,"span");
var sResultText="";
if(isErrorLoadingData){m_contentNode.innerHTML=MP_Util.HandleErrorResponse(styles.getNameSpace());
}else{if(totalResultCount===0){sResultText=MP_Util.CreateTitleText(m_comp,totalResultCount);
m_contentNode.innerHTML=MP_Util.HandleNoDataResponse(styles.getNameSpace());
}else{sResultText=MP_Util.CreateTitleText(m_comp,totalResultCount);
var contentHtml=[];
contentHtml.push("<div class ='",MP_Util.GetContentClass(m_comp,totalResultCount),"'>");
contentHtml.push(m_contentNode.innerHTML);
contentHtml.push("</div>");
m_contentNode.innerHTML=contentHtml.join("");
MP_Util.Doc.InitHovers(styles.getInfo(),m_contentNode);
MP_Util.Doc.InitSubToggles(m_contentNode,"sub-sec-hd-tgl");
MP_Util.Doc.InitScrolling(Util.Style.g("scrollable",m_contentNode,"div"),m_comp.getScrollNumber(),1.6);
}}totalCount[0].innerHTML=sResultText;
}};

function DocumentComponentStyle(){this.initByNamespace("doc");
}DocumentComponentStyle.inherits(ComponentStyle);
function DocumentComponent(criterion){this.setCriterion(criterion);
this.setStyles(new DocumentComponentStyle());
this.setComponentLoadTimerName("USR:MPG.DOCUMENTS.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.DOCUMENTS.O1 - render component");
DocumentComponent.method("openTab",function(){var criterion=this.getCriterion();
var sParms="/PERSONID="+criterion.person_id+" /ENCNTRID="+criterion.encntr_id+" /FIRSTTAB=^"+this.getLink()+"+^";
APPLINK(0,criterion.executable,sParms);
this.InsertData();
});
}DocumentComponent.inherits(DocumentBaseComponent);

function LaboratoryComponentStyle(){this.initByNamespace("lab");
}LaboratoryComponentStyle.inherits(ComponentStyle);
function LaboratoryComponent(criterion){this.setCriterion(criterion);
this.setStyles(new LaboratoryComponentStyle());
this.setIncludeLineNumber(false);
this.m_graphLink=1;
this.m_primaryLabel=i18n.discernabu.laboratory_o1.PRIMARY_RESULTS;
LaboratoryComponent.method("InsertData",function(){var nameSpace=new CERN_LABORATORY_O1();
nameSpace.GetLaboratoryTable(this);
});
LaboratoryComponent.method("setGraphFlag",function(value){this.m_graphLink=value;
});
LaboratoryComponent.method("getGraphFlag",function(){return(this.m_graphLink);
});
LaboratoryComponent.method("setPrimaryLabel",function(value){this.m_primaryLabel=value;
});
LaboratoryComponent.method("getPrimaryLabel",function(){return(this.m_primaryLabel);
});
LaboratoryComponent.method("refresh",function(event,args){if(args!="GrowthChart"){var contentNode=this.getSectionContentNode();
contentNode.innerHTML="";
this.InsertData();
}});
CERN_EventListener.addListener(this,EventListener.EVENT_CLINICAL_EVENT,this.refresh,this);
}LaboratoryComponent.inherits(MPageComponent);
var CERN_LABORATORY_O1=function(){var isErrorLoadingData=false;
var isDataFound=false;
var totalResultCount=0;
var m_comp=null;
var m_contentNode=null;
var m_contentSecNode=null;
var m_rootComponentNode=null;
var m_threadCount=0;
return{GetLaboratoryTable:function(component){m_comp=component;
var styles=component.getStyles();
m_rootComponentNode=component.getRootComponentNode();
m_contentNode=component.getSectionContentNode();
var groups=component.getGroups();
var xl=(groups!=null)?groups.length:0;
m_threadCount=xl;
CreateInfoHeader(m_contentNode);
for(var x=0;
x<xl;
x++){var group=groups[x];
var subSection=CreateSubHeader(group.getGroupName(),false);
GetResultsByGroup(group,subSection);
}if(m_threadCount==0){FinalizeComponent();
}}};
function CreateInfoHeader(secContentNode){var labI18n=i18n.discernabu.laboratory_o1;
var contentHdr=Util.cep("div",{className:"content-hdr"});
Util.ac(contentHdr,secContentNode);
var ar=[];
var withinTH="";
if(m_comp.getDateFormat()==3){withinTH="<br /><span>"+labI18n.WITHIN+"</span>";
}ar.push("<table class='lab-table'><tr class='hdr'><th class='lab-lbl'><span>&nbsp;</span></th><th class='lab-res0'><span>",labI18n.LATEST,"</span>",withinTH,"</th><th class='lab-res1'><span>",labI18n.PREVIOUS,"</span>",withinTH,"</th></tr></table>");
contentHdr.innerHTML=ar.join("");
m_contentSecNode=Util.cep("div",{className:"content-body"});
Util.ac(m_contentSecNode,secContentNode);
}function FinalizeComponent(){var styles=m_comp.getStyles();
var totalCount=Util.Style.g("sec-total",m_rootComponentNode,"span");
var sResultText="";
if(isErrorLoadingData){m_contentNode.innerHTML=MP_Util.HandleErrorResponse(styles.getNameSpace());
}else{if(totalResultCount==0){sResultText=MP_Util.CreateTitleText(m_comp,totalResultCount);
m_contentNode.innerHTML=MP_Util.HandleNoDataResponse();
}else{sResultText=MP_Util.CreateTitleText(m_comp,totalResultCount);
if(totalResultCount>m_comp.getScrollNumber()&&m_comp.isScrollingEnabled()){Util.Style.acss(m_contentSecNode,"scrollable ");
var contentHdr=Util.Style.g("content-hdr",m_rootComponentNode,"div");
Util.Style.acss(contentHdr[0],"lab-scrl-tbl-hd");
}MP_Util.Doc.InitHovers(styles.getInfo(),m_contentSecNode);
MP_Util.Doc.InitSubToggles(m_contentSecNode,"sub-sec-hd-tgl");
if(m_comp.isScrollingEnabled()){MP_Util.Doc.InitScrolling(Util.Style.g("scrollable",m_rootComponentNode,"div"),m_comp.getScrollNumber(),"2.8");
}}}totalCount[0].innerHTML=sResultText;
}function CreateSubHeader(label,includeContentBody){var subSec=Util.cep("div",{className:"sub-sec"});
var h3=Util.cep("h3",{className:"sub-sec-hd lab-sub-scrl-hd"});
subSec.appendChild(h3);
var spanTgl=Util.cep("span",{className:"sub-sec-hd-tgl",title:i18n.discernabu.laboratory_o1.COLLAPSE});
h3.appendChild(spanTgl);
var TgltxtNode=document.createTextNode("-");
spanTgl.appendChild(TgltxtNode);
var spanTitle=Util.cep("span",{className:"sub-sec-title"});
h3.appendChild(spanTitle);
var labelTextNode=document.createTextNode(label);
spanTitle.appendChild(labelTextNode);
if(includeContentBody){var subContent=Util.cep("div",{className:"sub-sec-content"});
subSec.appendChild(subContent);
var contentBody=Util.cep("div",{className:"content-body"});
subContent.appendChild(contentBody);
}m_contentSecNode.appendChild(subSec);
return(subSec);
}function GetResultsByGroup(group,subSection){var sEC="0.0",sES="0.0";
var es=group.getEventSets();
if(es!=null&&es.length>0){sES="value("+es.join(",")+")";
}var info=new XMLCclRequest();
info.onreadystatechange=function(){if(this.readyState==4&&this.status==200){m_threadCount--;
var sHTML="",countText="";
var subCnt=0;
var jsonEval=JSON.parse(this.responseText);
var recordData=jsonEval.RECORD_DATA;
var subSecTitle=Util.Style.g("sub-sec-title",subSection,"SPAN");
if(recordData.STATUS_DATA.STATUS=="S"){var ar=[];
var codeArray=MP_Util.LoadCodeListJSON(jsonEval.RECORD_DATA.CODES);
var personnelArray=MP_Util.LoadPersonelListJSON(jsonEval.RECORD_DATA.PRSNL);
var mapObjects=CERN_LABORATORY_O1_UTIL.LoadMeasurementData(jsonEval,personnelArray,codeArray);
if(group.getGroupName()==i18n.discernabu.laboratory_o1.PRIMARY_RESULTS){var subContent=Util.cep("div",{className:"sub-sec-content"});
subSection.appendChild(subContent);
var secContentBody=Util.cep("div",{className:"content-body"});
subContent.appendChild(secContentBody);
subCnt=mapObjects.length;
var measAr=[];
for(var x=0,xl=mapObjects.length;
x<xl;
x++){measAr.push(mapObjects[x].value);
}AssociateResultsToGroup(subSection,m_comp.getPrimaryLabel(),measAr,subSecTitle[0],secContentBody);
}else{var sGroupName="";
var sub=null,measAr=[];
if(mapObjects.length==0){subSecTitle[0].innerHTML=group.getGroupName()+" (0)";
}else{m_contentSecNode.removeChild(subSection);
var secContentBody=null;
for(var x=0,xl=mapObjects.length;
x<xl;
x++){if(sGroupName!=mapObjects[x].name){sGroupName=mapObjects[x].name;
sub=CreateSubHeader(sGroupName);
measAr=[];
var subContent=Util.cep("div",{className:"sub-sec-content"});
sub.appendChild(subContent);
secContentBody=Util.cep("div",{className:"content-body"});
subContent.appendChild(secContentBody);
subSecTitle=Util.Style.g("sub-sec-title",sub,"SPAN");
}measAr.push(mapObjects[x].value);
subCnt=measAr.length;
if((x==(xl-1))||(x!=(xl-1)&&mapObjects[x+1].name!=sGroupName)){AssociateResultsToGroup(sub,sGroupName,measAr,subSecTitle[0],secContentBody);
}}}}}else{if(recordData.STATUS_DATA.STATUS=="Z"){subSecTitle[0].innerHTML=group.getGroupName()+" (0)";
}else{isErrorLoadingData=true;
}}if(m_threadCount==0){FinalizeComponent();
}}if(this.readyState==4){MP_Util.ReleaseRequestReference(this);
}};
var criterion=m_comp.getCriterion();
info.open("GET","MP_RETRIEVE_N_RESULTS_JSON");
var sEncntr=(m_comp.getScope()==2)?criterion.encntr_id+".0":"0.0";
var sendAr=[];
sendAr.push("^MINE^",criterion.person_id+".0",sEncntr,criterion.provider_id+".0",criterion.ppr_cd+".0",3,"^^",sES,sEC,m_comp.getLookbackUnits(),m_comp.getLookbackUnitTypeFlag());
info.send(sendAr.join(","));
}function AssociateResultsToGroup(subSection,subGroupName,measurements,subSecTitle,secContentBody){var subCnt=measurements.length;
var criterion=m_comp.getCriterion();
var encntrOption;
if(m_comp.getScope()==1){var prsnlInfo=criterion.getPersonnelInfo();
var encntrs=prsnlInfo.getViewableEncounters();
encntrOption=(encntrs)?'"value('+encntrs+')"':"0";
}else{encntrOption=criterion.encntr_id;
}var lookBackUnits=(m_comp.getLookbackUnits()!=null)?m_comp.getLookbackUnits():"365";
var lookBackType=(m_comp.getLookbackUnitTypeFlag()!=null)?m_comp.getLookbackUnitTypeFlag():"0";
var staticContent='"'+escape(criterion.static_content)+'"';
var ar=[];
ar.push("<table class='lab-table'>");
for(var x=0,xl=measurements.length;
x<xl;
x++){var meas=measurements[x];
var rowClass=(x%2)?"even":"odd";
var m1=meas[0];
ar.push("<tr class='",rowClass,"'>");
if(m_comp.getGraphFlag()==1){ar.push("<td class='lab-lbl'><span class='row-label'><a onClick='MP_Util.GraphResults(",m1.getPersonId(),",",encntrOption,",",m1.getEventCode().codeValue,",",staticContent,",","0,",criterion.provider_id,",",criterion.position_cd,",",criterion.ppr_cd,",",lookBackUnits,",",lookBackType,");'>",m1.getEventCode().display,"</a></span></td>");
}else{ar.push("<td class='lab-lbl'><span class='row-label'>",m1.getEventCode().display,"</span></td>");
}ar.push(CERN_LABORATORY_O1_UTIL.CreateResultCell(meas[0],0,m_comp));
ar.push(CERN_LABORATORY_O1_UTIL.CreateResultCell(meas[1],1,m_comp));
ar.push(CERN_LABORATORY_O1_UTIL.CreateResultCell(meas[2],2,m_comp));
ar.push("</tr>");
}ar.push("</table>");
secContentBody.innerHTML=ar.join("");
subSecTitle.innerHTML=subGroupName+" ("+subCnt+")";
totalResultCount+=subCnt;
}};
var CERN_LABORATORY_O1_UTIL=function(){var m_df=null;
return{LoadMeasurementData:function(jsonEval,personnelArray,codeArray){var mapObjects=[];
var results=jsonEval.RECORD_DATA.RESULTS;
for(var i=0,il=results.length;
i<il;
i++){if(results[i].CLINICAL_EVENTS.length>0){for(var j=0,jl=results[i].CLINICAL_EVENTS.length;
j<jl;
j++){var measureArray=[];
var mapObject=null;
if(results[i].EVENT_CD>0){mapObject=new MP_Core.MapObject(results[i].EVENT_CD,measureArray);
}else{mapObject=new MP_Core.MapObject(results[i].EVENT_SET_NAME,measureArray);
}var meas=results[i].CLINICAL_EVENTS[j];
for(var k=0,kl=meas.MEASUREMENTS.length;
k<kl;
k++){var measurement=new MP_Core.Measurement();
measurement.initFromRec(meas.MEASUREMENTS[k],codeArray);
measureArray.push(measurement);
}measureArray.sort(SortByEffectiveDate);
if(measureArray.length>0){mapObjects.push(mapObject);
}}}}return mapObjects;
},CreateResultCell:function(result,idx,component){var ar=[];
var labI18n=i18n.discernabu.laboratory_o1;
if(result==null){ar.push("<td class='lab-res",idx,"'><dl class='lab-info'><dt><span>",labI18n.VALUE,"</span></dt><dd class='lab-res'><span>--</span></dd></dl></td>");
}else{var obj=result.getResult();
var resStr=GetStringResult(obj,false);
var resHvrStr=GetStringResult(obj,true);
var display=result.getEventCode().display;
var dateTime=result.getDateTime();
var labNormalcy=CalculateNormalcy(result);
var within=MP_Util.CalcWithinTime(dateTime);
var resStatus=result.getStatus().display;
var sCritHigh="",sCritLow="",sNormHigh="",sNormLow="";
if(obj instanceof MP_Core.QuantityValue){var refRange=obj.getRefRange();
if(refRange!=null){if(refRange.getCriticalHigh()!=0||refRange.getCriticalLow()!=0){sCritHigh=refRange.getCriticalHigh();
sCritLow=refRange.getCriticalLow();
}if(refRange.getNormalHigh()!=0||refRange.getNormalLow()!=0){sNormHigh=refRange.getNormalHigh();
sNormLow=refRange.getNormalLow();
}}}var df=GetDateFormatter();
ar.push("<td class='lab-res",idx,"'><dl class='lab-info'><dt><span>",labI18n.VALUE,"</span></dt><dd class='lab-res'><span class='",labNormalcy,"'><span class='res-ind'>&nbsp;</span><span class='res-value'>",GetEventViewerLink(result,resStr),"</span>",MP_Util.Measurement.GetModifiedIcon(result),"</span>");
if(component.getDateFormat()!=4){ar.push("<br /><span class='within'>",MP_Util.DisplayDateByOption(component,dateTime),"</span>");
}ar.push("</dd></dl><h4 class='det-hd'><span>",labI18n.LABORATORY_DETAILS,"</span></h4><div class='hvr'><dl class='lab-det'><dt class='lab-det-type'><span>",display,":</span></dt><dd class='result'><span class='",labNormalcy,"'>",resHvrStr,"</span></dd><dt class='lab-det-type'><span>",labI18n.DATE_TIME,":</span></dt><dd class='result'><span>",df.format(dateTime,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_4YEAR),"</span></dd><dt class='lab-det-type'><span>",labI18n.NORMAL_LOW,":</span></dt><dd class='result'><span>",sNormLow,"</span></dd><dt class='lab-det-type'><span>",labI18n.NORMAL_HIGH,":</span></dt><dd class='result'><span>",sNormHigh,"</span></dd><dt class='lab-det-type'><span>",labI18n.CRITICAL_LOW,":</span></dt><dd class='result'><span>",sCritLow,"</span></dd><dt class='lab-det-type'><span>",labI18n.CRITICAL_HIGH,":</span></dt><dd class='result'><span>",sCritHigh,"</span></dd><dt class='lab-det-type'><span>",labI18n.STATUS,":</span></dt><dd class='result'><span>",resStatus,"</span></dd></dl></div></td>");
}return ar.join("");
}};
function GetDateFormatter(){if(m_df==null){m_df=new mp_formatter.DateTimeFormatter(MPAGE_LOCALE);
}return m_df;
}function SortByEffectiveDate(a,b){if(a.getDateTime()>b.getDateTime()){return -1;
}else{if(a.getDateTime()<b.getDateTime()){return 1;
}else{return 0;
}}}function CreateHoverForMeasurement(measurement){var ar=[];
var labI18n=i18n.discernabu.laboratory_o1;
var obj=measurement.getResult();
var resStr=GetStringResult(obj,false);
var resHvrStr=GetStringResult(obj,true);
var display=measurement.getEventCode().display;
var dateTime=measurement.getDateTime();
var labNormalcy=CalculateNormalcy(measurement);
var sCritHigh="",sCritLow="",sNormHigh="",sNormLow="";
if(obj instanceof MP_Core.QuantityValue){var refRange=obj.getRefRange();
if(refRange!=null){if(refRange.getCriticalHigh()!=0||refRange.getCriticalLow()!=0){sCritHigh=refRange.getCriticalHigh();
sCritLow=refRange.getCriticalLow();
}if(refRange.getNormalHigh()!=0||refRange.getNormalLow()!=0){sNormHigh=refRange.getNormalHigh();
sNormLow=refRange.getNormalLow();
}}}var df=GetDateFormatter();
ar.push("<dt class='lab-res'><span>",display,":</span></dt><dd class='lab-det-type'><span class='",labNormalcy,"'>",resHvrStr,"</span></dd><dt class='lab-res'><span>",labI18n.DATE_TIME,":</span></dt><dd class='lab-det-type'><span>",df.format(dateTime,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_4YEAR),"</span></dd><dt class='lab-res'><span>",labI18n.NORMAL_LOW,":</span></dt><dd class='lab-det-type'><span>",sNormLow,"</span></dd><dt class='lab-res'><span>",labI18n.NORMAL_HIGH,":</span></dt><dd class='lab-det-type'><span>",sNormHigh,"</span></dd><dt class='lab-res'><span>",labI18n.CRITICAL_LOW,":</span></dt><dd class='lab-det-type'><span>",sCritLow,"</span></dd><dt class='lab-res'><span>",labI18n.CRITICAL_HIGH,":</span></dt><dd class='lab-det-type'><span>",sCritHigh,"</span></dd>");
return(ar.join(""));
}function GetStringResult(result,includeUOM){var value="";
var df=GetDateFormatter();
if(result instanceof MP_Core.QuantityValue){if(includeUOM){value=result.toString();
}else{value=result.getValue();
}}else{if(result instanceof Date){value=df.format(result,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_4YEAR);
}else{value=result;
}}return value;
}function CalculateCriticalRange(result){var rv="";
if(result instanceof MP_Core.QuantityValue){var rr=result.getRefRange();
if(rr!=null){rv=rr.toCriticalInlineString();
}}return rv;
}function CalculateNormalRange(result){var rv="";
if(result instanceof MP_Core.QuantityValue){var rr=result.getRefRange();
if(rr!=null){rv=rr.toNormalInlineString();
}}return rv;
}function CalculateNormalcy(result){var normalcy="res-normal";
var nc=result.getNormalcy();
if(nc!=null){var normalcyMeaning=nc.meaning;
if(normalcyMeaning!=null){if(normalcyMeaning==="LOW"){normalcy="res-low";
}else{if(normalcyMeaning==="HIGH"){normalcy="res-high";
}else{if(normalcyMeaning==="CRITICAL"||normalcyMeaning==="EXTREMEHIGH"||normalcyMeaning==="PANICHIGH"||normalcyMeaning==="EXTREMELOW"||normalcyMeaning==="PANICLOW"||normalcyMeaning==="VABNORMAL"){normalcy="res-severe";
}else{if(normalcyMeaning==="ABNORMAL"||normalcyMeaning==="POSITIVE"){normalcy="res-abnormal";
}}}}}}return normalcy;
}function GetEventViewerLink(measObject,res){var ar=[];
var params=[measObject.getPersonId(),measObject.getEncntrId(),measObject.getEventId(),'"EVENT"'];
ar.push("<a onclick='MP_Util.LaunchClinNoteViewer(",params.join(","),"); return false;' href='#'>",res,"</a>");
return ar.join("");
}}();

function MedicationsComponentStyle(){this.initByNamespace("med");
}MedicationsComponentStyle.inherits(ComponentStyle);
function MedicationsComponent(criterion){this.setCriterion(criterion);
this.setStyles(new MedicationsComponentStyle());
this.setComponentLoadTimerName("USR:MPG.MEDS.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.MEDS.O1 - render component");
this.m_prnLookback=0;
this.setIncludeLineNumber(false);
this.setScope(2);
this.m_scheduled=false;
this.m_continuous=false;
this.m_prn=false;
this.m_admin=false;
this.m_susp=false;
this.m_discont=false;
this.m_scheduledSort=0;
this.m_prnAdminSort=0;
this.m_prnUnschedAvailSort=0;
this.m_continuousSort=0;
this.m_faceUpDtSched=false;
this.m_faceUpDtPRN=false;
this.m_lookBkHrsForAdm=24;
this.m_lookBkHrsForDisCont=24;
this.m_schedLookAhead=0;
MedicationsComponent.method("InsertData",function(){CERN_MEDS_O1.GetMedicationData(this);
});
MedicationsComponent.method("setPRNLookbackDays",function(value){this.m_prnLookback=value;
});
MedicationsComponent.method("getPRNLookbackDays",function(){return(this.m_prnLookback);
});
MedicationsComponent.method("setScheduled",function(value){this.m_scheduled=value;
});
MedicationsComponent.method("isScheduled",function(){return this.m_scheduled;
});
MedicationsComponent.method("setContinuous",function(value){this.m_continuous=value;
});
MedicationsComponent.method("isContinuous",function(){return(this.m_continuous);
});
MedicationsComponent.method("setPRN",function(value){this.m_prn=value;
});
MedicationsComponent.method("isPRN",function(){return(this.m_prn);
});
MedicationsComponent.method("setAdministered",function(value){this.m_admin=value;
});
MedicationsComponent.method("isAdministered",function(){return this.m_admin;
});
MedicationsComponent.method("setSuspended",function(value){this.m_susp=value;
});
MedicationsComponent.method("isSuspended",function(){return this.m_susp;
});
MedicationsComponent.method("setDiscontinued",function(value){this.m_discont=value;
});
MedicationsComponent.method("isDiscontinued",function(){return this.m_discont;
});
MedicationsComponent.method("setAdministeredLookBkHrs",function(value){this.m_lookBkHrsForAdm=value;
});
MedicationsComponent.method("getAdministeredLookBkHrs",function(){return this.m_lookBkHrsForAdm;
});
MedicationsComponent.method("setDiscontinuedLookBkHr",function(value){this.m_lookBkHrsForDisCont=value;
});
MedicationsComponent.method("getDiscontinuedLookBkHr",function(){return this.m_lookBkHrsForDisCont;
});
MedicationsComponent.method("setSchedLookaheadHrs",function(value){this.m_schedLookAhead=value;
});
MedicationsComponent.method("getSchedLookaheadHrs",function(){return(this.m_schedLookAhead);
});
MedicationsComponent.method("setScheduledSort",function(value){this.m_scheduledSort=value;
});
MedicationsComponent.method("getScheduledSort",function(){return(this.m_scheduledSort);
});
MedicationsComponent.method("setPRNAdminSort",function(value){this.m_prnAdminSort=value;
});
MedicationsComponent.method("getPRNAdminSort",function(){return(this.m_prnAdminSort);
});
MedicationsComponent.method("setPRNUnschedAvailSort",function(value){this.m_prnUnschedAvailSort=value;
});
MedicationsComponent.method("getPRNUnschedAvailSort",function(){return(this.m_prnUnschedAvailSort);
});
MedicationsComponent.method("setContinuousSort",function(value){this.m_continuousSort=value;
});
MedicationsComponent.method("getContinuousSort",function(){return(this.m_continuousSort);
});
MedicationsComponent.method("setDisplayScheduleFaceUpDt",function(value){this.m_faceUpDtSched=value;
});
MedicationsComponent.method("getDisplayScheduleFaceUpDt",function(){return(this.m_faceUpDtSched);
});
MedicationsComponent.method("setDisplayPRNFaceUpDt",function(value){this.m_faceUpDtPRN=value;
});
MedicationsComponent.method("getDisplayPRNFaceUpDt",function(){return(this.m_faceUpDtPRN);
});
MedicationsComponent.method("openTab",function(){var criterion=this.getCriterion();
var sParms="/PERSONID="+criterion.person_id+" /ENCNTRID="+criterion.encntr_id+" /FIRSTTAB=^"+this.getLink()+"+^";
APPLINK(0,criterion.executable,sParms);
this.InsertData();
});
CERN_EventListener.addListener(this,EventListener.EVENT_ORDER_ACTION,this.InsertData,this);
}MedicationsComponent.inherits(MPageComponent);
var CERN_MEDS_O1=function(){return{GetMedicationData:function(component){var mgr=new MP_Core.XMLCCLRequestThreadManager(CERN_MEDS_O1.RenderReply,component,true);
var criterion=component.getCriterion();
var medsProgramName="MP_GET_ORDERS";
var sendAr=null;
var request=null;
var thread=null;
if(component.isScheduled()||component.isContinuous()||component.isPRN()){sendAr=[];
sendAr.push("^MINE^",criterion.person_id+".0",criterion.encntr_id+".0",criterion.provider_id+".0",0,47,57,0,1,0,0,0,0,2);
sendAr.push("0,0",criterion.ppr_cd+".0");
request=new MP_Core.ScriptRequest(component,"ENG:MPG.MEDS.O1 - load sch, cont, prn data");
request.setProgramName(medsProgramName);
request.setParameters(sendAr);
request.setAsync(true);
thread=new MP_Core.XMLCCLRequestThread("GetMostMedData",component,request);
mgr.addThread(thread);
}if(component.isAdministered()){sendAr=[];
sendAr.push("^MINE^",criterion.person_id+".0",criterion.encntr_id+".0",criterion.provider_id+".0",component.getAdministeredLookBkHrs(),8191,57,0,1,0,0,0,0,2);
sendAr.push("0,0",criterion.ppr_cd+".0");
request=new MP_Core.ScriptRequest(component,"ENG:MPG.MEDS.O1 - load administered data");
request.setProgramName(medsProgramName);
request.setParameters(sendAr);
request.setAsync(true);
thread=new MP_Core.XMLCCLRequestThread("GetAdministeredData",component,request);
mgr.addThread(thread);
}if(component.isSuspended()){sendAr=[];
sendAr.push("^MINE^",criterion.person_id+".0",criterion.encntr_id+".0",criterion.provider_id+".0",0,16,57,0,1,4,0,0,0,2);
sendAr.push("0,0",criterion.ppr_cd+".0");
request=new MP_Core.ScriptRequest(component,"ENG:MPG.MEDS.O1 - load suspended data");
request.setProgramName(medsProgramName);
request.setParameters(sendAr);
request.setAsync(true);
thread=new MP_Core.XMLCCLRequestThread("GetSuspendedData",component,request);
mgr.addThread(thread);
}if(component.isDiscontinued()){sendAr=[];
sendAr.push("^MINE^",criterion.person_id+".0",criterion.encntr_id+".0",criterion.provider_id+".0",component.getDiscontinuedLookBkHr(),192,57,0,1,4,0,0,0,1);
sendAr.push("0,0",criterion.ppr_cd+".0");
request=new MP_Core.ScriptRequest(component,"ENG:MPG.MEDS.O1 - load discontinued data");
request.setProgramName(medsProgramName);
request.setParameters(sendAr);
request.setAsync(true);
thread=new MP_Core.XMLCCLRequestThread("GetDiscontinuedData",component,request);
mgr.addThread(thread);
}mgr.begin();
},RenderReply:function(replyAr,component){var timerRenderComponent=MP_Util.CreateTimer(component.getComponentRenderTimerName());
try{var medsI18n=i18n.discernabu.medications_o1;
var df=new mp_formatter.DateTimeFormatter(MPAGE_LOCALE);
var dateTime=new Date();
var sHTML="",countText="",jsHTML=[];
var codeAr=[];
var prsnlAr=[];
var jsScheduled=[];
var jsContinous=[];
var jsPRNAdmin=[];
var jsPRNUnschedAvail=[];
var jsAdministered=[];
var jsSuspended=[];
var jsDiscontinued=[];
var prnLast48Orders=[];
var prnCount=0;
var prnUnschedAvailCount=0;
var continousCount=0;
var scheduledCount=0;
var AdministeredCount=0;
var SuspendedCount=0;
var DiscontinuedCount=0;
for(var x=replyAr.length;
x--;
){var reply=replyAr[x];
if(reply.getStatus()=="S"){switch(reply.getName()){case"GetMostMedData":var recordData=reply.getResponse();
var codeArray=MP_Util.LoadCodeListJSON(recordData.CODES);
var personnelArray=MP_Util.LoadPersonelListJSON(recordData.PRSNL);
recordData.ORDERS.sort(SortByMedicationName);
var prnLookbackDays=component.getPRNLookbackDays();
var prnLookbackDate=new Date();
var hrs=prnLookbackDate.getHours()-(24*prnLookbackDays);
prnLookbackDate.setHours(hrs);
var schedLookaheadHrs=component.getSchedLookaheadHrs();
var schedLookaheadDate=new Date();
var schedHrs=schedLookaheadDate.getHours()+schedLookaheadHrs;
schedLookaheadDate.setHours(schedHrs);
var orderPrnAdmin=[];
var orderScheduled=[];
var orderPRNUnschedAvail=[];
var orderContinuous=[];
for(var y=0,yl=recordData.ORDERS.length;
y<yl;
y++){dateTime=new Date();
var order=recordData.ORDERS[y];
var orderStatus=MP_Util.GetValueFromArray(order.CORE.STATUS_CD,codeArray);
if(orderStatus){var item=null;
switch(orderStatus.meaning){case"ORDERED":case"INPROCESS":case"FUTURE":case"INCOMPLETE":case"MEDSTUDENT":if(order.SCHEDULE.PRN_IND==1||order.SCHEDULE.FREQUENCY.UNSCHEDULED_IND==1){if(prnLookbackDays>0){var sDate=GetHeadsUpMedicationDate(order);
if(sDate!=""){dateTime.setISO8601(sDate);
if(dateTime>=prnLookbackDate){orderPrnAdmin.push(order);
prnCount++;
}orderPRNUnschedAvail.push(order);
prnUnschedAvailCount++;
}else{orderPRNUnschedAvail.push(order);
prnUnschedAvailCount++;
}}else{orderPRNUnschedAvail.push(order);
prnUnschedAvailCount++;
}}else{if(order.SCHEDULE.CONSTANT_IND==1){orderContinuous.push(order);
continousCount++;
}else{if(order.SCHEDULE.SUSPENDED_DT_TM==""){if(schedLookaheadHrs>0){var sDate=GetHeadsUpMedicationDate(order);
if(sDate!=""){dateTime.setISO8601(sDate);
if(dateTime<=schedLookaheadDate){orderScheduled.push(order);
scheduledCount++;
}}}else{orderScheduled.push(order);
scheduledCount++;
}}}}break;
}}}var prnSort=component.getPRNAdminSort();
SortMedications(orderPrnAdmin,prnSort);
jsPRNAdmin=CreateMedicationItemFromArray(orderPrnAdmin,codeArray,personnelArray,true);
var schedSort=component.getScheduledSort();
SortMedications(orderScheduled,schedSort);
jsScheduled=CreateMedicationItemFromArray(orderScheduled,codeArray,personnelArray,component.getDisplayScheduleFaceUpDt(),schedSort);
var prnUnschedAvailSort=component.getPRNUnschedAvailSort();
SortMedications(orderPRNUnschedAvail,prnUnschedAvailSort);
jsPRNUnschedAvail=CreateMedicationItemFromArray(orderPRNUnschedAvail,codeArray,personnelArray,component.getDisplayPRNFaceUpDt());
var continuousSort=component.getContinuousSort();
SortMedications(orderContinuous,continuousSort);
jsContinous=CreateMedicationItemFromArray(orderContinuous,codeArray,personnelArray);
break;
case"GetAdministeredData":var adminLookback=new Date();
adminLookback.setHours(adminLookback.getHours()-component.getAdministeredLookBkHrs());
var recordData=reply.getResponse();
var codeArray=MP_Util.LoadCodeListJSON(recordData.CODES);
var personnelArray=MP_Util.LoadPersonelListJSON(recordData.PRSNL);
recordData.ORDERS.sort(SortByMedicationName);
for(var z=0,zl=recordData.ORDERS.length;
z<zl;
z++){var order=recordData.ORDERS[z];
if(order.DETAILS.LAST_DOSE_DT_TM!=""){dateTime=new Date();
dateTime.setISO8601(order.DETAILS.LAST_DOSE_DT_TM);
if(dateTime>=adminLookback){jsAdministered.push(CreateMedicationItem(order,codeArray,personnelArray));
AdministeredCount++;
}}}break;
case"GetSuspendedData":var recordData=reply.getResponse();
var codeArray=MP_Util.LoadCodeListJSON(recordData.CODES);
var personnelArray=MP_Util.LoadPersonelListJSON(recordData.PRSNL);
recordData.ORDERS.sort(SortByMedicationName);
for(var z=0,zl=recordData.ORDERS.length;
z<zl;
z++){var order=recordData.ORDERS[z];
var item=CreateMedicationItem(order,codeArray,personnelArray);
jsSuspended.push(item);
SuspendedCount++;
}break;
case"GetDiscontinuedData":var recordData=reply.getResponse();
var codeArray=MP_Util.LoadCodeListJSON(recordData.CODES);
var personnelArray=MP_Util.LoadPersonelListJSON(recordData.PRSNL);
recordData.ORDERS.sort(SortByMedicationName);
for(var z=0,zl=recordData.ORDERS.length;
z<zl;
z++){var order=recordData.ORDERS[z];
var item=CreateMedicationItem(order,codeArray,personnelArray);
jsDiscontinued.push(item);
DiscontinuedCount++;
}break;
}}}if(component.isScheduled()){var lookFwdText="";
if(schedLookaheadHrs>0){lookFwdText=" "+medsI18n.NEXT_N_HOURS.replace("{0}",component.getSchedLookaheadHrs());
}jsHTML.push("<div class='sub-sec'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl' title='",medsI18n.HIDE_SECTION,"'>-</span><span class='sub-sec-title'>",medsI18n.SCHEDULED," (",scheduledCount,")",lookFwdText," </span></h3>");
if((schedLookaheadHrs>0)&&(scheduledCount>0)&&(component.getDisplayScheduleFaceUpDt())){jsHTML.push("<div class='sub-sec-content'><div class='content-hdr'><dl class='med-info-hdr hdr'><dd class='med-name'></dd><dd class='med-date'>",medsI18n.NEXT_DOSE,"</dd></dl></div><div class='content-body'",">",jsScheduled.join(""),"</div></div>");
}else{if(scheduledCount>0){jsHTML.push("<div class='sub-sec-content'><div class='content-body'",">",jsScheduled.join(""),"</div></div>");
}}jsHTML.push("</div>");
}if(component.isContinuous()){jsHTML.push("<div class='sub-sec'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl' title='",medsI18n.HIDE_SECTION,"'>-</span><span class='sub-sec-title'>",medsI18n.CONTINOUS," (",continousCount,")</span></h3>");
if(continousCount>0){jsHTML.push("<div class='sub-sec-content'><div class='content-body'",">",jsContinous.join(""),"</div></div>");
}jsHTML.push("</div>");
}if(component.getPRNLookbackDays()>0){jsHTML.push("<div class='sub-sec'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl' title='",medsI18n.HIDE_SECTION,"'>-</span><span class='sub-sec-title'>",medsI18n.PRN,"/",medsI18n.UNSCHEDULED," (",prnCount,")");
jsHTML.push(" ",medsI18n.ADMIN_LAST_N_HOURS.replace("{0}",component.getPRNLookbackDays()*24));
jsHTML.push("</span></h3>");
if(prnCount>0){jsHTML.push("<div class='sub-sec-content'><div class='content-hdr'><dl class='med-info-hdr hdr'><dd class='med-name'></dd><dd class='med-date'>",medsI18n.LAST_GIVEN,"</dd></dl></div><div class='content-body'",">",jsPRNAdmin.join(""),"</div></div>");
}jsHTML.push("</div>");
}if(component.isPRN()){jsHTML.push("<div class='sub-sec'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl' title='",medsI18n.HIDE_SECTION,"'>-</span><span class='sub-sec-title'>",medsI18n.PRN_UNSCHEDULED," (",prnUnschedAvailCount,")");
jsHTML.push("</span></h3>");
if(prnUnschedAvailCount>0){if(component.getDisplayPRNFaceUpDt()){jsHTML.push("<div class='sub-sec-content'><div class='content-hdr'><dl class='med-info-hdr hdr'><dd class='med-name'></dd><dd class='med-date'>",medsI18n.LAST_GIVEN,"</dd></dl></div><div class='content-body'",">",jsPRNUnschedAvail.join(""),"</div></div>");
}else{jsHTML.push("<div class='sub-sec-content'><div class='content-body'",">",jsPRNUnschedAvail.join(""),"</div></div>");
}}jsHTML.push("</div>");
}if(component.isAdministered()){jsHTML.push("<div class='sub-sec closed'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl' title='",medsI18n.SHOW_SECTION,"'>-</span><span class='sub-sec-title'>",medsI18n.ADMINISTERED," (",AdministeredCount,")");
if(component.getAdministeredLookBkHrs()>0){jsHTML.push(" ",medsI18n.LAST_N_HOURS.replace("{0}",component.getAdministeredLookBkHrs()));
}jsHTML.push("</span></h3>");
if(AdministeredCount>0){jsHTML.push("<div class='sub-sec-content'><div class='content-body'>",jsAdministered.join(""),"</div></div>");
}jsHTML.push("</div>");
}if(component.isSuspended()){jsHTML.push("<div class='sub-sec'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl' title='",medsI18n.HIDE_SECTION,"'>-</span><span class='sub-sec-title'>",medsI18n.SUSPENDED," (",SuspendedCount,")</span></h3>");
if(SuspendedCount>0){jsHTML.push("<div class='sub-sec-content'><div class='content-body'>",jsSuspended.join(""),"</div></div>");
}jsHTML.push("</div>");
}if(component.isDiscontinued()){jsHTML.push("<div class='sub-sec closed'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl ' title='",medsI18n.SHOW_SECTION,"'>-</span><span class='sub-sec-title'>",medsI18n.DISCONTINUED," (",DiscontinuedCount,")");
if(component.getDiscontinuedLookBkHr()>0){jsHTML.push(" ",medsI18n.LAST_N_HOURS.replace("{0}",component.getDiscontinuedLookBkHr()));
}jsHTML.push("</span></h3>");
if(DiscontinuedCount>0){jsHTML.push("<div class='sub-sec-content'><div class='content-body'>",jsDiscontinued.join(""),"</div></div>");
}jsHTML.push("</div>");
}var content=[];
var totalLength=DiscontinuedCount+SuspendedCount+AdministeredCount+prnCount+continousCount+scheduledCount+prnUnschedAvailCount;
content.push("<div class='",MP_Util.GetContentClass(component,totalLength),"'>",jsHTML.join(""),"</div>");
sHTML=content.join("");
countText=MP_Util.CreateTitleText(component,totalLength);
MP_Util.Doc.FinalizeComponent(sHTML,component,countText);
}catch(err){var errMsg=[];
errMsg.push("<b>",medsI18n.JS_ERROR,"</b><br><ul><li>",medsI18n.MESSAGE,": ",err.message,"</li><li>",medsI18n.NAME,": ",err.name,"</li><li>",medsI18n.NUMBER,": ",(err.number&65535),"</li><li>",medsI18n.DESCRIPTION,": ",err.description,"</li></ul>");
MP_Util.Doc.FinalizeComponent(MP_Util.HandleErrorResponse(component.getStyles().getNameSpace(),errMsg.join("")),component,countText);
if(timerRenderComponent){timerRenderComponent.Abort();
timerRenderComponent=null;
}throw (err);
}finally{if(timerRenderComponent){timerRenderComponent.Stop();
}}}};
function CreateMedicationItem(orders,codeAr,prsnlAr,faceUpDateFlag,severityFlag){var item=[];
var medOrigDate="",medHvrOrigDate="",startDate="",origOrderDate="",stopDate="",stopReason="",nextDoseDate="",lastDoesDate="",respProv="";
var currentDate=new Date();
var orderStatus=MP_Util.GetValueFromArray(orders.CORE.STATUS_CD,codeAr);
var medsI18n=i18n.discernabu.medications_o1;
var df=new mp_formatter.DateTimeFormatter(MPAGE_LOCALE);
var fullDateTime4Year=mp_formatter.DateTimeFormatter.FULL_DATE_TIME_4YEAR;
var medName=GetMedicationDisplayName(orders);
var dateTime=new Date();
var sDate=GetHeadsUpMedicationDate(orders);
if(sDate!=""){dateTime.setISO8601(sDate);
medOrigDate=df.formatISO8601(sDate,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_2YEAR);
medHvrOrigDate=df.formatISO8601(sDate,fullDateTime4Year);
}if(orders.SCHEDULE.CURRENT_START_DT_TM!=""){startDate=df.formatISO8601(orders.SCHEDULE.CURRENT_START_DT_TM,fullDateTime4Year);
}if(orders.SCHEDULE.ORIG_ORDER_DT_TM!=""){origOrderDate=df.formatISO8601(orders.SCHEDULE.ORIG_ORDER_DT_TM,fullDateTime4Year);
}if(orders.SCHEDULE.PROJECTED_STOP_DT_TM!=""){stopDate=df.formatISO8601(orders.SCHEDULE.PROJECTED_STOP_DT_TM,fullDateTime4Year);
var reason=MP_Util.GetValueFromArray(orders.SCHEDULE.STOP_TYPE_CD,codeAr);
if(reason!=null){stopReason=reason.display;
}}if(orders.DETAILS.NEXT_DOSE_DT_TM!=""){nextDoseDate=df.formatISO8601(orders.DETAILS.NEXT_DOSE_DT_TM,fullDateTime4Year);
}else{nextDoseDate=medsI18n.NOT_DEFINED;
}if(orders.DETAILS.LAST_DOSE_DT_TM!=""){lastDoesDate=df.formatISO8601(orders.DETAILS.LAST_DOSE_DT_TM,fullDateTime4Year);
}var jsSeverity="";
if(orders.SCHEDULE.PRN_IND==0&&orders.SCHEDULE.CONSTANT_IND==0&&orders.SCHEDULE.SUSPENDED_DT_TM==""){if(orders.DETAILS.NEXT_DOSE_DT_TM!=""){dateTime=df.formatISO8601(orders.DETAILS.NEXT_DOSE_DT_TM,fullDateTime4Year);
if(!(dateTime<currentDate)){jsSeverity="res-normal";
}else{if(severityFlag){jsSeverity="res-severe";
}}}}if(orders.CORE.RESPONSIBLE_PROVIDER_ID!=0){var prov=MP_Util.GetValueFromArray(orders.CORE.RESPONSIBLE_PROVIDER_ID,prsnlAr);
respProv=prov.fullName;
}item.push("<h3 class='info-hd'><span>",medName,"</span></h3>");
if(faceUpDateFlag){item.push("<dl class='med-info'><dd class= 'med-name'><span class='",jsSeverity,"'>",medName,"</span><span class='med-sig detail-line'>",orders.DISPLAYS.SIMPLIFIED_DISPLAY_LINE,"</span></dd><dd class= 'med-date'><span class='",jsSeverity,"'>",medOrigDate,"</span></dd></dl>");
}else{item.push("<dl class='med-info'><dd><span class='",jsSeverity,"'>",medName,"</span><span class='med-sig detail-line'>",orders.DISPLAYS.SIMPLIFIED_DISPLAY_LINE,"</span></dd></dl>");
}item.push("<h4 class='det-hd'><span>",medsI18n.MED_DETAIL,"</span></h4>","<div class='hvr'><dl class='med-det'>","<dt><span>",medsI18n.MED_NAME,":</span></dt><dd class='med-det-name'><span>",GetMedicationDisplayNameForHover(orders),"</span></dd>");
item.push("<dt><span>",medsI18n.ORDER_DETAILS,":</span></dt><dd class='med-det-dt'><span>",orders.DISPLAYS.CLINICAL_DISPLAY_LINE,"</span></dd>");
if(medName!=""){item.push("<dt><span>",medsI18n.REQUESTED_START,":</span></dt><dd class='med-det-dt'><span>",startDate,"</span></dd>");
}else{item.push("<dt><span>",medsI18n.REQUESTED_START,":</span></dt><dd class='med-det-dt'><span>&nbsp;</span></dd>");
}item.push("<dt><span>",medsI18n.ORIG_DT_TM,":</span></dt><dd class='med-det-dt'><span>",origOrderDate,"</span></dd>");
item.push("<dt><span>",medsI18n.LAST_DOSE_DT_TM,":</span></dt><dd class='med-det-dt'><span>",lastDoesDate,"</span></dd>");
if(!(orders.SCHEDULE.PRN_IND==1||orders.SCHEDULE.FREQUENCY.UNSCHEDULED_IND==1||orders.SCHEDULE.CONSTANT_IND==1||orderStatus.meaning=="DISCONTINUED"||orderStatus.meaning=="CANCELED"||orderStatus.meaning=="SUSPENDED")){item.push("<dt><span>",medsI18n.NEXT_DOSE_DT_TM,":</span></dt><dd class='med-det-dt'><span>",nextDoseDate,"</span></dd>");
}item.push("<dt><span>",medsI18n.STOP_DT_TM,":</span></dt><dd class='med-det-dt'><span>",stopDate,"</span></dd>","<dt><span>",medsI18n.STOP_REASON,":</span></dt><dd class='med-det-dt'><span>",stopReason,"</span></dd>");
item.push("<dt><span>",medsI18n.RESPONSIBLE_PROVIDER,":</span></dt><dd class='med-det-dt'><span>",respProv,"</span></dd>");
item.push("<dt><span>",medsI18n.STATUS,":</span></dt><dd class='med-det-dt'><span>",orderStatus.display,"</span></dd>","<dt><span>",medsI18n.DETAILS,":</span></dt><dd class='med-det-dt'><span>",orders.DISPLAYS.SIMPLIFIED_DISPLAY_LINE,"</span></dd>","</dl></div>");
return(item.join(""));
}function CreateMedicationItemFromArray(ordersArray,codeArray,personnelArray,faceUpDateFlag,severityFlag){var jsMedItem=[];
for(var z=0,zl=ordersArray.length;
z<zl;
z++){jsMedItem.push(CreateMedicationItem(ordersArray[z],codeArray,personnelArray,faceUpDateFlag,severityFlag));
}return jsMedItem;
}function GetHeadsUpMedicationDate(a){if(a.SCHEDULE.PRN_IND==1||a.SCHEDULE.FREQUENCY.UNSCHEDULED_IND==1){return a.DETAILS.LAST_DOSE_DT_TM;
}else{if(a.SCHEDULE.CONSTANT_IND==1){return"";
}else{if(a.SCHEDULE.SUSPENDED_DT_TM==""){return a.DETAILS.NEXT_DOSE_DT_TM;
}else{return"";
}}}}function SortByMedicationName(a,b){var aName=GetMedicationDisplayName(a);
var bName=GetMedicationDisplayName(b);
var aUpper=(aName!=null)?aName.toUpperCase():"";
var bUpper=(bName!=null)?bName.toUpperCase():"";
if(aUpper>bUpper){return 1;
}else{if(aUpper<bUpper){return -1;
}}return 0;
}function SortByLastDose(a,b){if(a.DETAILS.LAST_DOSE_DT_TM>b.DETAILS.LAST_DOSE_DT_TM){return -1;
}else{if(a.DETAILS.LAST_DOSE_DT_TM<b.DETAILS.LAST_DOSE_DT_TM){return 1;
}else{return 0;
}}}function SortByNextDose(a,b){if(a.DETAILS.NEXT_DOSE_DT_TM>b.DETAILS.NEXT_DOSE_DT_TM){return 1;
}else{if(a.DETAILS.NEXT_DOSE_DT_TM<b.DETAILS.NEXT_DOSE_DT_TM){return -1;
}else{return 0;
}}}function GetMedicationDisplayName(order){var medName="";
if(order.DISPLAYS!=null){medName=order.DISPLAYS.CLINICAL_NAME;
if(medName==""){medName=order.DISPLAYS.REFERENCE_NAME;
}if(medName==""){medName=order.DISPLAYS.DEPARTMENT_NAME;
}}return(medName);
}function GetMedicationDisplayNameForHover(order){var medName="";
if(order.DISPLAYS!=null){medName=order.DISPLAYS.REFERENCE_NAME;
if(medName==""){medName=order.DISPLAYS.CLINICAL_NAME;
}else{if(order.DISPLAYS.CLINICAL_NAME!=""&&order.DISPLAYS.CLINICAL_NAME!=medName){medName=medName.concat(" (",order.DISPLAYS.CLINICAL_NAME,")");
}}if(medName==""){medName=order.DISPLAYS.DEPARTMENT_NAME;
}}return(medName);
}function SortMedications(orders,sortType){switch(sortType){case CERN_MEDS_O1.LastDoseDateTime:orders.sort(SortByLastDose);
break;
case CERN_MEDS_O1.NextDoseDateTime:orders.sort(SortByNextDose);
break;
default:orders.sort(SortByMedicationName);
}}}();
CERN_MEDS_O1.LastDoseDateTime=1;
CERN_MEDS_O1.NextDoseDateTime=2;

function MedicationReconciliationComponentStyle(){this.initByNamespace("medrec");
}MedicationReconciliationComponentStyle.inherits(ComponentStyle);
function MedicationReconciliationComponent(criterion){this.setCriterion(criterion);
this.setStyles(new MedicationReconciliationComponentStyle());
this.setComponentLoadTimerName("USR:MPG.MEDS-REC.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.MEDS-REC.O1 - render component");
this.setIncludeLineNumber(true);
this.setScope(2);
MedicationReconciliationComponent.method("InsertData",function(){CERN_MEDS_REC_O1.GetMedsRecTable(this);
});
MedicationReconciliationComponent.method("HandleSuccess",function(recordData){CERN_MEDS_REC_O1.RenderComponent(this,recordData);
});
MedicationReconciliationComponent.method("openTab",function(){var criterion=this.getCriterion();
var mrObject={};
mrObject=window.external.DiscernObjectFactory("ORDERS");
mrObject.PersonId=criterion.person_id;
mrObject.EncntrId=criterion.encntr_id;
mrObject.reconciliationMode=3;
mrObject.LaunchOrdersMode(2,0,0);
this.InsertData();
});
}MedicationReconciliationComponent.inherits(MPageComponent);
var CERN_MEDS_REC_O1=function(){return{GetMedsRecTable:function(component){var criterion=component.getCriterion();
var sendAr=[];
sendAr.push("^MINE^",criterion.person_id+".0",criterion.encntr_id+".0",criterion.provider_id+".0");
MP_Core.XMLCclRequestWrapper(component,"mp_get_meds_rec",sendAr,true);
},RenderComponent:function(component,recordData){var timerRenderComponent=MP_Util.CreateTimer(component.getComponentRenderTimerName());
try{var sHTML="",countText="",jsHTML=[];
var len=0;
var codeArray=MP_Util.LoadCodeListJSON(recordData.CODES);
var dateTime=new Date();
jsHTML.push("<div class='",MP_Util.GetContentClass(component,recordData.NEW.length+recordData.CONTINUE.length+recordData.CONTINUE_WITH_CHANGES.length+recordData.DISCONTINUED.length+recordData.CONTACT_PHYSICIAN.length),"'>");
jsHTML.push("<div class='sub-sec'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl' title='",i18n.HIDE_SECTION,"'>-</span><span class='sub-sec-title'>",i18n.NEW," (",recordData.NEW.length,")</span></h3><div class='sub-sec-content'>");
var contMeds="";
if(recordData.NEW.length>0){len+=recordData.NEW.length;
contMeds=getMedsRow(recordData.NEW);
jsHTML.push(contMeds,"</div></div>");
}else{jsHTML.push("<span class='res-none'>",i18n.NO_RESULTS_FOUND,"</span></div></div>");
}jsHTML.push("<div class='sub-sec'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl' title='",i18n.HIDE_SECTION,"'>-</span><span class='sub-sec-title'>",i18n.CONTINUE," (",recordData.CONTINUE.length,")</span></h3><div class='sub-sec-content'>");
if(recordData.CONTINUE.length>0){len+=recordData.CONTINUE.length;
contMeds=getMedsRow(recordData.CONTINUE);
jsHTML.push(contMeds);
jsHTML.push("</div></div>");
}else{jsHTML.push("<span class='res-none'>",i18n.NO_RESULTS_FOUND,"</span></div></div>");
}jsHTML.push("<div class='sub-sec'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl' title='",i18n.HIDE_SECTION,"'>-</span><span class='sub-sec-title'>",i18n.CONTINUE_WITH_CHANGES," (",recordData.CONTINUE_WITH_CHANGES.length,")</span></h3><div class='sub-sec-content'>");
if(recordData.CONTINUE_WITH_CHANGES.length>0){for(var n=0,l=recordData.CONTINUE_WITH_CHANGES.length;
n<l;
n++){var cwithchng=recordData.CONTINUE_WITH_CHANGES[n];
if(cwithchng.CURRENT.length>0){for(var j=0,t=cwithchng.CURRENT.length;
j<t;
j++){var contWithChangesMed=cwithchng.CURRENT[j];
jsHTML.push("<dl class='medrec-info'><dt><span>",i18n.MED_DETAIL,":</span></dt><dd class='medrec-name'><span>",contWithChangesMed.ORDER_NAME,"</span></dd><dt><span>",i18n.SIGNATURE_LINE,":</span></dt><dd class='medrec-sig'><span class='detail-line'>",contWithChangesMed.ORDER_DETAIL_LINE,"</span></dd></dl>");
jsHTML.push("<h4 class='det-hd'><span></span></h4><div class='hvr'><dl class='medrec-det'><dt><span>",i18n.NAME," :</span></dt><dd class='medrec-det-dt'><span>",contWithChangesMed.ORDER_NAME,"</span></dd><dt><span>",i18n.ORDERING_PHYSICIAN,":</span></dt><dd class='medrec-det-dt'><span>",contWithChangesMed.ORDERING_PHYSICIAN,"</span></dd><dt><span>",i18n.COMMENTS," :</span></dt><dd class='medrec-det-dt'><span>",contWithChangesMed.ORDER_COMMENTS,"</span></dd>");
jsHTML.push("<dt><span>",i18n.START,":</span></dt><dd class='medrec-det-dt'><span>",contWithChangesMed.ORDER_NAME," ",contWithChangesMed.ORDER_DETAIL_LINE,"</span></dd>");
}}if(cwithchng.ORIGINAL.length>0){for(var m=0,u=cwithchng.ORIGINAL.length;
m<u;
m++){var origMed=cwithchng.ORIGINAL[m];
jsHTML.push("<dt><span>",i18n.STOP," :</span></dt><dd class='medrec-det-dt'><span>",origMed.ORDER_NAME," ",origMed.ORDER_DETAIL_LINE,"</span></dd></dl></div>");
}}}jsHTML.push("</div></div>");
len+=recordData.CONTINUE_WITH_CHANGES.length;
}else{jsHTML.push("<span class='res-none'>",i18n.NO_RESULTS_FOUND,"</span></div></div>");
}jsHTML.push("<div class='sub-sec'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl' title='",i18n.HIDE_SECTION,"'>-</span><span class='sub-sec-title'>",i18n.NO_LONGER_TAKING," (",recordData.DISCONTINUED.length,")</span></h3><div class='sub-sec-content'>");
if(recordData.DISCONTINUED.length>0){len+=recordData.DISCONTINUED.length;
var discontMeds=getMedsRow(recordData.DISCONTINUED);
jsHTML.push(discontMeds,"</div></div>");
}else{jsHTML.push("<span class='res-none'>",i18n.NO_RESULTS_FOUND,"</span></div></div>");
}jsHTML.push("<div class='sub-sec'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl' title='",i18n.HIDE_SECTION,"'>-</span><span class='sub-sec-title'>",i18n.CONTACT_PHYSICIAN," (",recordData.CONTACT_PHYSICIAN.length,")</span></h3><div class='sub-sec-content'>");
if(recordData.CONTACT_PHYSICIAN.length>0){len+=recordData.CONTACT_PHYSICIAN.length;
var contactPhysMeds=getMedsRow(recordData.CONTACT_PHYSICIAN);
jsHTML.push(contactPhysMeds,"</div></div>");
}else{jsHTML.push("<span class='res-none'>",i18n.NO_RESULTS_FOUND,"</span></div></div>");
}jsHTML.push("</div>");
countText=MP_Util.CreateTitleText(component,len);
sHTML=jsHTML.join("");
MP_Util.Doc.FinalizeComponent(sHTML,component,countText);
}catch(err){if(timerRenderComponent){timerRenderComponent.Abort();
timerRenderComponent=null;
}throw (err);
}finally{if(timerRenderComponent){timerRenderComponent.Stop();
}}}};
function getMedsRow(medData){var jsHTML=[];
var strHTML="";
for(var j=0,l=medData.length;
j<l;
j++){var medDetail=medData[j];
jsHTML.push("<dl class='medrec-info'><dt><span>",i18n.MED_DETAIL,":</span></dt><dd class='medrec-name'><span>",medDetail.ORDER_NAME,"</span></dd><dt><span>",i18n.SIGNATURE_LINE,":</span></dt><dd class='medrec-sig'><span class='detail-line'>",medDetail.ORDER_DETAIL_LINE,"</span></dd></dl>");
jsHTML.push("<h4 class='det-hd'><span></span></h4><div class='hvr'><dl class='medrec-det'><dt><span>",i18n.NAME," :</span></dt><dd class='medrec-det-dt'><span>",medDetail.ORDER_NAME,"</span></dd><dt><span>",i18n.ORDERING_PHYSICIAN,":</span></dt><dd class='medrec-det-dt'><span>",medDetail.ORDERING_PHYSICIAN,"</span></dd><dt><span>",i18n.COMMENTS," :</span></dt><dd class='medrec-det-dt'><span>",medDetail.ORDER_COMMENTS,"</span></dd></dl></div>");
}strHTML=jsHTML.join("");
return strHTML;
}}();

function MicrobiologyComponentStyle(){this.initByNamespace("mic");
}MicrobiologyComponentStyle.inherits(ComponentStyle);
function MicrobiologyComponent(criterion){this.setCriterion(criterion);
this.setStyles(new MicrobiologyComponentStyle());
this.setComponentLoadTimerName("USR:MPG.MICRO.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.MICRO.O1 - render component");
this.setIncludeLineNumber(true);
MicrobiologyComponent.method("InsertData",function(){CERN_MICROBIOLOGY_O1.GetMicrobiologyTable(this);
});
MicrobiologyComponent.method("HandleSuccess",function(recordData){CERN_MICROBIOLOGY_O1.RenderComponent(this,recordData);
});
}MicrobiologyComponent.inherits(MPageComponent);
var CERN_MICROBIOLOGY_O1=function(){var encntrOption=0;
var lookBackUnits=0;
var lookBackType=0;
return{GetMicrobiologyTable:function(component){var groups=component.getGroups();
var events=(groups!==null&&groups.length>0)?groups[0].getEventSets():null;
var sEvents=(events!==null)?"value("+events.join(",")+")":"0.0";
var criterion=component.getCriterion();
encntrOption=(component.getScope()==1)?"0.0":(criterion.encntr_id+".0");
lookBackUnits=(component.getLookbackUnits()!==null)?component.getLookbackUnits():"0";
lookBackType=(component.getLookbackUnitTypeFlag()!==null)?component.getLookbackUnitTypeFlag():"0";
var sendAr=[];
sendAr.push("^MINE^",criterion.person_id+".0",encntrOption,criterion.provider_id+".0",lookBackUnits,sEvents,criterion.position_cd+".0",criterion.ppr_cd+".0",lookBackType);
MP_Core.XMLCclRequestWrapper(component,"mp_get_micro_by_eventset",sendAr,true);
},RenderComponent:function(component,recordData){var timerRenderComponent=MP_Util.CreateTimer(component.getComponentRenderTimerName());
try{var jsHTML=[];
var codeArray=MP_Util.LoadCodeListJSON(recordData.CODES);
var jsMicHTML=[];
var micObj=recordData.MICRO_CULTURE;
micObj.sort(SortByDate);
var micNum=micObj.length;
var dtFormat=component.getDateFormat();
var collectedLabel=i18n.COLLECTED;
jsMicHTML.push("<dl class='mic-info-hdr hdr'><dd class='mic-catalog-hd'><span>&nbsp;</span></dd><dd class='mic-src-hd'><span>",i18n.SOURCE,"</span></dd><dd class='mic-norm-hd'><span>",i18n.GROWTH_IND,"</span></dd><dd class='mic-no-sc'><span>",i18n.SUSC_HEAD,"</span></dd><dd class='mic-within-hd'><span>",i18n.COLLECTED);
if(component.getDateFormat()==3){jsMicHTML.push("<br/>",i18n.WITHIN,"</span></dd></dl>");
}else{jsMicHTML.push("</span></dd></dl>");
}jsMicHTML.push("<div class='",MP_Util.GetContentClass(component,micNum),"'>");
for(var i=0;
i<micNum;
i++){var sTaskStatus="",sSusceptibility="",sCatalog="",sOrdDisp="";
var collectedDtTm=new Date();
var updtDtTm=new Date();
var growth_ind=micObj[i].GROWTH_IND;
var source=MP_Util.GetValueFromArray(micObj[i].SPECIMEN_COLLECTION.SOURCE_CD,codeArray).display;
updtDtTm.setISO8601(micObj[i].UPDT_DATE);
collectedDtTm.setISO8601(micObj[i].SPECIMEN_COLLECTION.COLLECTED_DATE);
var collectedDtTmDisp=MP_Util.DisplayDateByOption(component,collectedDtTm);
sCatalog=(micObj[i].ORDERS[0].CATALOG_CD>0)?MP_Util.GetValueFromArray(micObj[i].ORDERS[0].CATALOG_CD,codeArray).display:"";
if(micObj[i].ORDERS[0].ORDERED_AS_MNEMONIC!==""){sOrdDisp=micObj[i].ORDERS[0].ORDERED_AS_MNEMONIC;
}else{if(micObj[i].ORDERS[0].ORDER_MNEMONIC!==""){sOrdDisp=micObj[i].ORDERS[0].ORDER_MNEMONIC;
}else{sOrdDisp=sCatalog;
}}var site=(micObj[i].SPECIMEN_COLLECTION.BODY_SITE_CD>0)?MP_Util.GetValueFromArray(micObj[i].SPECIMEN_COLLECTION.BODY_SITE_CD,codeArray).display:"";
var isGrowth=i18n.NEG,growthIndClass="";
if(micObj[i].TASK_CD>0){sTaskStatus=MP_Util.GetValueFromArray(micObj[i].TASK_CD,codeArray).display;
}else{sTaskStatus="--";
}if(micObj[i].SPECIMEN_COLLECTION.MICROBIOLOGY_INTERPRETATION_CD>0){var micInterp=MP_Util.GetValueFromArray(micObj[i].SPECIMEN_COLLECTION.MICROBIOLOGY_INTERPRETATION_CD,codeArray);
isGrowth=micInterp.display;
if(micInterp.meaning=="POSITIVE"){growthIndClass="<span class='res-severe'>";
}else{growthIndClass="<span>";
}}if(micObj[i].SUSCEPTIBILITY_IND==1){sSusceptibilityClass="mic-sc";
sSusceptibility=i18n.DONE;
}else{sSusceptibilityClass="mic-no-sc";
sSusceptibility=i18n.NOT_DONE;
}var sourceSite="";
if((site!==null&&site!=="")&&(source!==null&&source!=="")){sourceSite=source+" / "+site;
}else{if(site!==null&&site!==""){sourceSite=site;
}else{if(source!==null&&source!==""){sourceSite=source;
}}}jsMicHTML.push("<h3 class='info-hd'><span>i18n.MICRO</span></h3>","<dl class='mic-info'>","<dt><span>",i18n.MICRO,":</span></dt>","<dd class='mic-catalog'><span>",sOrdDisp,"</span></dd>","<dd class='mic-src'><span>",source,"</span></dd>","<dd class='mic-norm'>",growthIndClass,isGrowth,"</span></dd>","<dd class='",sSusceptibilityClass,"'><span>&nbsp;</span></dd>","<dd class='mic-within'><span class='date-time'>",collectedDtTmDisp,"</span></dd>","</dl>","<h4 class='det-hd'><span>",i18n.MICRO_DETAILS,"</span></h4>","<div class='hvr'>","<dl class = 'mic-det'>","<dt><span>",i18n.SOURCE_SITE,":</span></dt>","<dd><span>",sourceSite,"</span></dd>","<dt><span>",i18n.COLLECTED_DATE_TIME,":</span></dt>","<dd><span>",collectedDtTm.format("longDateTime3"),"</span></dd>","<dt><span>",i18n.SUSCEPTIBILITY,":</span></dt>","<dd><span>",sSusceptibility,"</span></dd>","<dt><span>",i18n.STATUS,":</span></dt>","<dd><span>",sTaskStatus,"</span></dd>","</dl></div>");
}jsMicHTML.push("</div>");
sHTML=jsMicHTML.join("");
countText=MP_Util.CreateTitleText(component,micNum);
MP_Util.Doc.FinalizeComponent(sHTML,component,countText);
}catch(err){if(timerRenderComponent){timerRenderComponent.Abort();
timerRenderComponent=null;
}throw (err);
}finally{if(timerRenderComponent){timerRenderComponent.Stop();
}}}};
function SortByDate(a,b){if(a.SPECIMEN_COLLECTION.COLLECTED_DATE>b.SPECIMEN_COLLECTION.COLLECTED_DATE){return -1;
}else{if(a.SPECIMEN_COLLECTION.COLLECTED_DATE<b.SPECIMEN_COLLECTION.COLLECTED_DATE){return 1;
}}return 0;
}}();

function NotesRemindersComponentStyle(){this.initByNamespace("nr");
}NotesRemindersComponentStyle.inherits(ComponentStyle);
function NotesRemindersComponent(criterion){this.setCriterion(criterion);
this.setStyles(new NotesRemindersComponentStyle());
this.setComponentLoadTimerName("USR:MPG.NOTES_REMINDERS.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.NOTES_REMINDERS.O1 - render component");
this.setIncludeLineNumber(true);
this.setScope(1);
this.m_stickyNoteTypeCodes=null;
NotesRemindersComponent.method("InsertData",function(){CERN_NOTES_REMINDERS_O1.GetNotesRemindersTable(this);
});
NotesRemindersComponent.method("HandleSuccess",function(recordData){CERN_NOTES_REMINDERS_O1.RenderComponent(this,recordData);
});
NotesRemindersComponent.method("setStickyNoteTypeCodes",function(value){this.m_stickyNoteTypeCodes=value;
});
NotesRemindersComponent.method("addStickyNoteTypeCode",function(value){if(this.m_stickyNoteTypeCodes==null){this.m_stickyNoteTypeCodes=[];
}this.m_stickyNoteTypeCodes.push(value);
});
NotesRemindersComponent.method("getStickyNoteTypeCodes",function(){return this.m_stickyNoteTypeCodes;
});
}NotesRemindersComponent.inherits(MPageComponent);
var CERN_NOTES_REMINDERS_O1=function(){return{GetNotesRemindersTable:function(component){var mgr=new MP_Core.XMLCCLRequestThreadManager(CERN_NOTES_REMINDERS_O1.RenderReply,component,true);
var criterion=component.getCriterion();
var sendAr=null;
var request=null;
var thread=null;
sendAr=[];
var sTasks=MP_Util.CreateParamArray(getTaskStatusCodes(),1);
var sTypes=MP_Util.CreateParamArray(getReminderTaskTypeCodes(),1);
sendAr.push("^MINE^",criterion.person_id+".0","0.0",sTasks,0,sTypes,1);
request=new MP_Core.ScriptRequest(component,"ENG:MPG.CERN_NOTES_REMINDERS.O1 - get reminders");
request.setProgramName("MP_GET_TASKS");
request.setParameters(sendAr);
request.setAsync(true);
thread=new MP_Core.XMLCCLRequestThread("GetReminders",component,request);
mgr.addThread(thread);
sendAr=[];
var sSticky=MP_Util.CreateParamArray(component.getStickyNoteTypeCodes(),1);
sendAr.push("^MINE^",criterion.person_id+".0",sSticky);
request=new MP_Core.ScriptRequest(component,"ENG:MPG.CERN_NOTES_REMINDERS.O1 - get sticky notes");
request.setProgramName("MP_GET_STICKY_NOTES");
request.setParameters(sendAr);
request.setAsync(true);
thread=new MP_Core.XMLCCLRequestThread("GetStickyNotes",component,request);
mgr.addThread(thread);
mgr.begin();
},RenderReply:function(replyAr,component){var timerRenderComponent=MP_Util.CreateTimer(component.getComponentRenderTimerName());
try{var notesI18n=i18n.discernabu.notesreminders_o1;
var df=new mp_formatter.DateTimeFormatter(MPAGE_LOCALE);
var noteCnt=0;
var reminderCnt=0;
var jsNotesSec=[];
var jsRemindersSec=[];
for(var x=replyAr.length;
x--;
){var reply=replyAr[x];
if(reply.getStatus()=="S"){switch(reply.getName()){case"GetReminders":var recordData=reply.getResponse();
var codeArray=MP_Util.LoadCodeListJSON(recordData.CODES);
var curDate=new Date();
recordData.TASKS.sort(SortReminders);
jsRemindersSec.push("<dl class='nr-info-hdr hdr'><dd class='nr-prior-hd'><span>",notesI18n.PRIORITY,"</span></dd><dd class='nr-subj-hd'><span>",notesI18n.SUBJECT,"</span></dd><dd class='nr-due-hd'><span>",notesI18n.DUE,"</span></dd></dl>");
for(var i=0,l=recordData.TASKS.length;
i<l;
i++){var task=recordData.TASKS[i];
var remindDate=new Date();
remindDate.setISO8601(task.REMIND_DT_TM);
if(remindDate&&(remindDate<=curDate)&&isAssignedToReminder(task,component)){reminderCnt=reminderCnt+1;
var dueDate=(task.SCHEDULED_DT_TM!=="")?df.formatISO8601(task.SCHEDULED_DT_TM,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_2YEAR):"";
var priority=(task.STAT_IND===1)?notesI18n.HIGH:notesI18n.LOW;
var subj=(task.MSG_SUBJECT!=="")?task.MSG_SUBJECT:"("+notesI18n.NO_SUBJECT+")";
var link=MP_Util.CreateClinNoteLink(task.PERSON_ID,task.ENCNTR_ID,task.TASK_ID,subj,"NR",0);
jsRemindersSec.push("<dl class='nr-info'><dd class='nr-prior'><span>",priority,"</span></dd><dd class='nr-subj'><span>",link,"</span></dd><dd class='nr-due-dt'><span class='date-time'>",dueDate,"</span></dd></dl>");
}}break;
case"GetStickyNotes":var recordData=reply.getResponse();
var codeArray=MP_Util.LoadCodeListJSON(recordData.CODES);
var personnelArray=MP_Util.LoadPersonelListJSON(recordData.PRSNL);
noteCnt=recordData.NOTES.length;
jsNotesSec.push("<dl class='nr-info-hdr hdr'><dd class='nr-auth-hd'><span>",notesI18n.AUTHOR,"</span></dd><dd class='nr-dt-hd'><span>",notesI18n.DATE,"</span></dd><dd class='nr-txt-hd'><span>",notesI18n.TEXT,"</span></dd></dl>");
for(var i=0;
i<noteCnt;
i++){var notes=recordData.NOTES[i];
var prov=MP_Util.GetValueFromArray(notes.AUTHOR_ID,personnelArray);
var authorName=(prov)?prov.fullName:"";
var notesDate=(notes.NOTE_DATE!=="")?df.formatISO8601(notes.NOTE_DATE,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_2YEAR):"";
jsNotesSec.push("<dl class='nr-info'><dd class='nr-auth'><span>",authorName,"</span></dd><dd class='nr-dt'><span class='date-time'>",notesDate,"</span></dd><dd class='nr-txt'><span>",notes.TEXT,"</span></dd></dl>");
}break;
}}}var jsNrHTML=["<div class ='",MP_Util.GetContentClass(component,noteCnt+reminderCnt),"'><div class='sub-sec'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl' title='",notesI18n.HIDE_SECTION,"'>-</span><span class='sub-sec-title'>",notesI18n.STICKY_NOTES," (",noteCnt,")</span></h3><div class='sub-sec-content'>",jsNotesSec.join(""),"</div></div><div class='sub-sec'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl' title='",notesI18n.HIDE_SECTION,"'>-</span><span class='sub-sec-title'>",notesI18n.REMINDERS," (",reminderCnt,")</span></h3><div class='sub-sec-content'>",jsRemindersSec.join(""),"</div></div></div>"];
var sHTML=jsNrHTML.join("");
var countText=MP_Util.CreateTitleText(component,noteCnt+reminderCnt);
MP_Util.Doc.FinalizeComponent(sHTML,component,countText);
}catch(err){if(timerRenderComponent){timerRenderComponent.Abort();
timerRenderComponent=null;
}throw (err);
}finally{if(timerRenderComponent){timerRenderComponent.Stop();
}}}};
function SortReminders(a,b){if(a.SCHEDULED_DT_TM>b.SCHEDULED_DT_TM){return -1;
}else{if(a.SCHEDULED_DT_TM<b.SCHEDULED_DT_TM){return 1;
}else{return 0;
}}}function isAssignedToReminder(task,component){if(task.ASSIGN_PRSNL_LIST.length===0){return true;
}var pId=component.getCriterion().provider_id;
for(var l=task.ASSIGN_PRSNL_LIST.length;
l--;
){if(task.ASSIGN_PRSNL_LIST[l].ASSIGN_PRSNL_ID===pId){return true;
}}return false;
}function getTaskStatusCodes(){var ar=[];
var taskStatusCodeSet=MP_Util.GetCodeSet(79,false);
if(taskStatusCodeSet&&taskStatusCodeSet.length>0){for(var x=taskStatusCodeSet.length;
x--;
){var code=taskStatusCodeSet[x].value;
if(code.meaning!=="DELETED"&&code.meaning!=="COMPLETE"){ar.push(code.codeValue);
}}}return ar;
}function getReminderTaskTypeCodes(){var ar=[];
var taskTypeCodeSet=MP_Util.GetCodeSet(6026,false);
if(taskTypeCodeSet&&taskTypeCodeSet.length>0){var code=MP_Util.GetCodeByMeaning(taskTypeCodeSet,"REMINDER");
if(code){ar.push(code.codeValue);
}}return ar;
}}();

function OrdersComponentStyle(){this.initByNamespace("ord");
}OrdersComponentStyle.inherits(ComponentStyle);
function OrdersComponent(criterion){this.setCriterion(criterion);
this.setStyles(new OrdersComponentStyle());
this.setComponentLoadTimerName("USR:MPG.ORDERS.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.ORDERS.O1 - render component");
this.setIncludeLineNumber(true);
OrdersComponent.method("InsertData",function(){CERN_ORDERS_O1.GetOrdersTable(this);
});
OrdersComponent.method("HandleSuccess",function(recordData){CERN_ORDERS_O1.RenderComponent(this,recordData);
});
OrdersComponent.method("setCatalogCodes",function(value){this.m_catalogCodes=value;
});
OrdersComponent.method("addCatalogCode",function(value){if(this.m_catalogCodes==null){this.m_catalogCodes=[];
}this.m_catalogCodes.push(value);
});
OrdersComponent.method("getCatalogCodes",function(){return this.m_catalogCodes;
});
OrdersComponent.method("setOrderStatuses",function(value){this.m_orderStatuses=value;
});
OrdersComponent.method("addOrderStatus",function(value){if(this.m_orderStatuses==null){this.m_orderStatuses=[];
}this.m_orderStatuses.push(value);
});
OrdersComponent.method("getOrderStatuses",function(){return this.m_orderStatuses;
});
CERN_EventListener.addListener(this,EventListener.EVENT_ORDER_ACTION,this.InsertData,this);
}OrdersComponent.inherits(MPageComponent);
var CERN_ORDERS_O1=function(){return{GetOrdersTable:function(component){var sendAr=[];
var criterion=component.getCriterion();
var encntrOption=(component.getScope()==2)?(criterion.encntr_id+".0"):"0.0";
sendAr.push("^MINE^",criterion.person_id+".0",encntrOption,criterion.provider_id+".0",component.getLookbackUnits(),129,63,2,0,1,0,0);
var codes=component.getCatalogCodes();
var catType=(codes!=null&&codes.length>0)?"value("+codes.join(",")+")":"0.0";
sendAr.push(catType);
sendAr.push(component.getLookbackUnitTypeFlag());
var statuses=component.getOrderStatuses();
var ordStatuses=(statuses!=null&&statuses.length>0)?"value("+statuses.join(",")+")":"0.0";
sendAr.push(ordStatuses);
sendAr.push("0",criterion.ppr_cd+".0");
MP_Core.XMLCclRequestWrapper(component,"MP_GET_ORDERS",sendAr,true);
},RenderComponent:function(component,recordData){var timerRenderComponent=MP_Util.CreateTimer(component.getComponentRenderTimerName());
try{var ordHTML="",countText="",blank="";
var ordArray=[];
var codeArray=MP_Util.LoadCodeListJSON(recordData.CODES);
var personnelArray=[];
personnelArray=MP_Util.LoadPersonelListJSON(recordData.PRSNL);
var compNS=component.getStyles().getNameSpace();
ordArray.push("<div class='content-hdr'><dl class='",compNS,"-info-hdr hdr'>");
ordArray.push("<dt class='",compNS,"-nm-hd'><span>",blank,"</span></dt><dt class='",compNS,"-st-hd'><span>",i18n.STATUS,"</span></dt><dt class='",compNS,"-dt-hd'><span>",i18n.ORDERED,"</span></dt></dl></div>");
recordData.ORDERS.sort(OrderDateSort);
var orderLen=recordData.ORDERS.length;
ordArray.push("<div class ='",MP_Util.GetContentClass(component,orderLen),"'>");
for(var j=0;
j<orderLen;
j++){var orders=recordData.ORDERS[j];
var ordName="";
var ordDateTime="";
var strtDateTime="";
var statusTypeDisp="";
var orderDetails="";
var ordLongDateTime="";
var strtLongDateTime="";
var responProvider="";
var dateTime=new Date();
if(orders.SCHEDULE!=""){dateTime.setISO8601(orders.SCHEDULE.ORIG_ORDER_DT_TM);
ordDateTime=dateTime.format("longDateTime2");
ordLongDateTime=dateTime.format("longDateTime3");
}if(orders.SCHEDULE!=""){dateTime.setISO8601(orders.SCHEDULE.CURRENT_START_DT_TM);
strtDateTime=dateTime.format("longDateTime2");
strtLongDateTime=dateTime.format("longDateTime3");
}if(orders.CORE!=""){if(orders.CORE.STATUS_CD>0){var statusTypeObj=MP_Util.GetValueFromArray(orders.CORE.STATUS_CD,codeArray);
statusTypeDisp=statusTypeObj.display;
}else{statusTypeDisp="";
}if(orders.CORE.RESPONSIBLE_PROVIDER_ID>0){var prsnlObj=MP_Util.GetValueFromArray(orders.CORE.RESPONSIBLE_PROVIDER_ID,personnelArray);
responProvider=prsnlObj.fullName;
}else{responProvider="";
}}if(orders.DISPLAYS!=""){ordName=orders.DISPLAYS.CLINICAL_NAME;
if(ordName==""){ordName=orders.DISPLAYS.REFERENCE_NAME;
}if(ordName==""){ordName=orders.DISPLAYS.DEPARTMENT_NAME;
}}var odetails=orders.DISPLAYS.CLINICAL_DISPLAY_LINE;
ordArray.push("<dl class='ord-info'><dd class= 'ord-name'><span>",ordName,"</span></dd><dd class= 'ord-status'><span>",statusTypeDisp,"</span></dd><dd class= 'ord-date'><span class='date-time'>",ordDateTime,"</span></dd></dl><h4 class='det-hd'><span>","</span></h4><div class='hvr'><dl class='ord-det'><dt><span>",i18n.ORDER_NAME,":</span></dt><dd><span>",ordName,"</span></dd><dt><span>",i18n.ORDER_DETAILS,":</span></dt><dd><span>",odetails,"</span></dd><dt><span>",i18n.ORDER_DATE,":</span></dt><dd><span>",ordLongDateTime,"</span></dd><dt><span>",i18n.START_DT_TM,":</span></dt><dd><span>",strtLongDateTime,"</span></dd>   <dt><span>",i18n.ORDER_STATUS,":</span></dt><dd><span>",statusTypeDisp,"</span></dd><dt><span>",i18n.ORDER_PHYS,":</span></dt><dd><span>",responProvider,"</span></dd></dl></div>");
}ordHTML=ordArray.join("");
countText=MP_Util.CreateTitleText(component,orderLen);
MP_Util.Doc.FinalizeComponent(ordHTML,component,countText);
}catch(err){if(timerRenderComponent){timerRenderComponent.Abort();
timerRenderComponent=null;
}throw (err);
}finally{if(timerRenderComponent){timerRenderComponent.Stop();
}}}};
function OrderDateSort(a,b){if(a.SCHEDULE.ORIG_ORDER_DT_TM>b.SCHEDULE.ORIG_ORDER_DT_TM){return -1;
}else{if(a.SCHEDULE.ORIG_ORDER_DT_TM<b.SCHEDULE.ORIG_ORDER_DT_TM){return 1;
}else{return 0;
}}}}();

function PastMedicalHistoryComponentStyle(){this.initByNamespace("pmh");
}PastMedicalHistoryComponentStyle.inherits(ComponentStyle);
function PastMedicalHistoryComponent(criterion){this.setCriterion(criterion);
this.setStyles(new PastMedicalHistoryComponentStyle());
this.setComponentLoadTimerName("USR:MPG.PASTMEDICALHISTORY.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.PASTMEDICALHISTORY.O1 - render component");
this.setScope(1);
this.setIncludeLineNumber(true);
PastMedicalHistoryComponent.method("HandleSuccess",function(recordData){CERN_PMH_O1.RenderComponent(this,recordData);
});
PastMedicalHistoryComponent.method("InsertData",function(){CERN_PMH_O1.GetPastMedicalHistory(this);
});
}PastMedicalHistoryComponent.inherits(MPageComponent);
var CERN_PMH_O1=function(){return{GetPastMedicalHistory:function(component){var sendAr=[];
var program="mp_get_past_med_data";
var criterion=component.getCriterion();
sendAr.push("^MINE^",criterion.person_id+".0",criterion.provider_id+".0",criterion.ppr_cd+".0");
MP_Core.XMLCclRequestWrapper(component,program,sendAr,true);
return;
},RenderComponent:function(component,recordData){var timerRenderComponent=MP_Util.CreateTimer(component.getComponentRenderTimerName());
try{var countText="";
var jsonEval=recordData;
var pmhhtml="";
var onsetDate;
var resDate;
var pmhArray=[];
var pmhProb=[];
var commentDt=null;
var commentStr="";
var author="";
var pmhLen=jsonEval.PASTMED_CNT;
var df=new mp_formatter.DateTimeFormatter(MPAGE_LOCALE);
var dateTime=new Date();
for(var j=0;
j<pmhLen;
j++){pmhProb.push(jsonEval.PASTMED[j]);
}pmhProb.sort(SortByProblemName);
for(var i=0;
i<pmhLen;
i++){var problem=pmhProb[i];
onsetDate="";
if(problem.ONSET_DATE_UTC!=""){var onsetDt=problem.ONSET_DATE_UTC;
dateTime.setISO8601(onsetDt);
if(problem.ONSET_DATE_FLAG==0){onsetDate=df.format(dateTime,mp_formatter.DateTimeFormatter.FULL_DATE_4YEAR);
}else{if(problem.ONSET_DATE_FLAG==1){onsetDate=df.format(dateTime,mp_formatter.DateTimeFormatter.FULL_MONTH_4YEAR_NO_DATE);
}else{if(problem.ONSET_DATE_FLAG==2){onsetDate=df.format(dateTime,mp_formatter.DateTimeFormatter.FULL_4YEAR);
}}}}resDate="";
if(problem.RES_DATE_UTC!=""){var resDt=problem.RES_DATE_UTC;
dateTime.setISO8601(resDt);
if(problem.RES_DATE_FLAG==0){resDate=df.format(dateTime,mp_formatter.DateTimeFormatter.FULL_DATE_4YEAR);
}else{if(problem.RES_DATE_FLAG==1){resDate=df.format(dateTime,mp_formatter.DateTimeFormatter.FULL_MONTH_4YEAR_NO_DATE);
}else{if(problem.RES_DATE_FLAG==2){resDate=df.format(dateTime,mp_formatter.DateTimeFormatter.FULL_4YEAR);
}}}}var comObj=problem.COMMENT;
commentStr="";
author="";
for(var c=0;
c<comObj.length;
c++){commentDt="";
var comment=comObj[c];
if(comment.DATE!=""){var comDt=comment.DATE;
dateTime.setISO8601(comDt);
commentDt=df.format(dateTime,mp_formatter.DateTimeFormatter.FULL_DATE_4YEAR);
}author=comment.AUTHOR;
commentStr+=commentDt+" - "+author+"<br/>"+comment.COMMENT+"<br/>";
}if(problem.CODE==""||problem.CODE==null){pmhArray.push("<dl class='pmh-info'><dt class='det-hd'>",i18n.PAST_MEDICAL_HISTORY,"</dt><dd class='pmh-name'>",problem.NAME);
}else{pmhArray.push("<dl class='pmh-info'><dt class='det-hd'>",i18n.PAST_MEDICAL_HISTORY,"</dt><dd class='pmh-name'>",problem.NAME,"</dd><dt><span>Code:</span></dt><dd class='pmh-code'><span class='code'>(",problem.CODE,")</span>");
}pmhArray.push("</dd></dl><h4 class='det-hd'><span>",i18n.PAST_MEDICAL_DETAILS,"</span></h4><div class='hvr'><dl class='pmh-det'><dt><span>",i18n.PAST_PROBLEM,":</span></dt><dd><span>",problem.NAME,"</span></dd><dt><span>",i18n.ANNOTATED_DISPLAY,":</span></dt><dd><span>",problem.ANNOTATED_DISPLAY,"</span></dd><dt><span>",i18n.ONSET_DATE,":</span></dt><dd><span>",onsetDate,"</span></dd><dt><span>",i18n.PAST_RESOLVED_DATE,":</span></dt><dd><span>",resDate,"</span></dd><dt><span>",i18n.STATUS,":</span></dt><dd><span>",problem.STATUS,"</span></dd><dt><span>",i18n.COMMENTS,":</span></dt><dd><span>",commentStr,"</span></dd></dl></div>");
}var content=[];
if(pmhLen==null||pmhLen==""){pmhLen=0;
}content.push("<div class ='",MP_Util.GetContentClass(component,pmhLen),"'>",pmhArray.join(""),"</div>");
pmhhtml=content.join("");
countText=MP_Util.CreateTitleText(component,pmhLen);
MP_Util.Doc.FinalizeComponent(pmhhtml,component,countText);
}catch(err){alert("An error has occurred in PMH : "+err.name+" - "+err.message);
if(timerRenderComponent){timerRenderComponent.Abort();
timerRenderComponent=null;
}}finally{if(timerRenderComponent){timerRenderComponent.Stop();
}}}};
function SortByProblemName(a,b){var aName=a.NAME;
var bName=b.NAME;
var aUpper=(aName!=null)?aName.toUpperCase():"";
var bUpper=(bName!=null)?bName.toUpperCase():"";
if(aUpper>bUpper){return 1;
}else{if(aUpper<bUpper){return -1;
}}return 0;
}}();

function PathologyComponentStyle(){this.initByNamespace("path");
}PathologyComponentStyle.inherits(ComponentStyle);
function PathologyComponent(criterion){this.setCriterion(criterion);
this.setStyles(new PathologyComponentStyle());
this.setHoverEnabled(false);
this.setComponentLoadTimerName("USR:MPG.PATHOLOGY.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.PATHOLOGY.O1 - render component");
}PathologyComponent.inherits(DocumentBaseComponent);

function PatientInfoComponentStyle(){this.initByNamespace("pt");
}PatientInfoComponentStyle.inherits(ComponentStyle);
function PatientInfoComponent(criterion){this.rowCount=0;
this.setCriterion(criterion);
this.setStyles(new PatientInfoComponentStyle());
this.m_visitTypeMeanings=null;
this.m_visitTypeCodes=null;
this.m_chiefComplaintCodes=null;
this.m_estimatedDischargeDateCodes=null;
this.m_displayMedicalService=false;
this.m_displayRFV=false;
this.m_primaryPhysDisplay=false;
this.m_attedingPhysDisplay=false;
this.m_admittingPhysDisplay=false;
this.m_roombedDisplay=false;
this.m_admitDateDisplay=false;
this.m_modeofArrval=null;
this.m_advancedDirectives=null;
this.m_resusOrderCodes=null;
this.m_emergencyContactsDisplay=false;
this.m_documentTypeCodes=null;
this.setComponentLoadTimerName("USR:MPG.PATINFO.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.PATINFO.O1 - render component");
PatientInfoComponent.method("HandleSuccess",function(recordData){CERN_PATINFO_O1.GetPatientInfo(this,recordData);
});
PatientInfoComponent.method("InsertData",function(){CERN_PATINFO_O1.SendPatientData(this);
});
PatientInfoComponent.method("setVisitTypeCodes",function(value){this.m_visitTypeCodes=value;
});
PatientInfoComponent.method("addVisitTypeCode",function(value){if(this.m_visitTypeCodes==null){this.m_visitTypeCodes=[];
}this.m_visitTypeCodes.push(value);
});
PatientInfoComponent.method("getVisitTypeCodes",function(){if(this.m_visitTypeCodes!=null){return this.m_visitTypeCodes;
}});
PatientInfoComponent.method("setChiefComplaint",function(value){this.rowCount++;
this.m_chiefComplaintCodes=value;
});
PatientInfoComponent.method("addChiefComplaint",function(value){if(this.m_chiefComplaintCodes==null){this.m_chiefComplaintCodes=[];
}this.m_chiefComplaintCodes.push(value);
});
PatientInfoComponent.method("getChiefComplaint",function(){return this.m_chiefComplaintCodes;
});
PatientInfoComponent.method("setAdvancedDirectives",function(value){this.rowCount++;
this.m_advancedDirectives=value;
});
PatientInfoComponent.method("addAdvancedDirectives",function(value){if(this.m_advancedDirectives==null){this.m_advancedDirectives=[];
}this.m_advancedDirectives.push(value);
});
PatientInfoComponent.method("getAdvancedDirectives",function(){return this.m_advancedDirectives;
});
PatientInfoComponent.method("setResusOrders",function(value){this.rowCount++;
this.m_resusOrderCodes=value;
});
PatientInfoComponent.method("addResusOrders",function(value){if(this.m_resusOrderCodes==null){this.m_resusOrderCodes=[];
}this.m_resusOrderCodes.push(value);
});
PatientInfoComponent.method("getResusOrders",function(){return this.m_resusOrderCodes;
});
PatientInfoComponent.method("setEstimatedDischargeDate",function(value){this.rowCount++;
this.m_estimatedDischargeDateCodes=value;
});
PatientInfoComponent.method("addEstimatedDischargeDate",function(value){if(this.m_estimatedDischargeDateCodes==null){this.m_estimatedDischargeDateCodes=[];
}this.m_estimatedDischargeDateCodes.push(value);
});
PatientInfoComponent.method("getEstimatedDischargeDate",function(){return this.m_estimatedDischargeDateCodes;
});
PatientInfoComponent.method("setModeofArrival",function(value){this.rowCount++;
this.m_modeofArrival=value;
});
PatientInfoComponent.method("addModeofArrival",function(value){if(this.m_modeofArrival==null){this.m_modeofArrival=[];
}this.m_modeofArrival.push(value);
});
PatientInfoComponent.method("getModeofArrival",function(){return this.m_modeofArrival;
});
PatientInfoComponent.method("setDocumentTypes",function(value){this.m_documentTypeCodes=value;
});
PatientInfoComponent.method("addDocumentTypes",function(value){if(this.m_documentTypeCodes==null){this.m_documentTypeCodes=[];
}this.m_documentTypeCodes.push(value);
});
PatientInfoComponent.method("getDocumentTypes",function(){return this.m_documentTypeCodes;
});
PatientInfoComponent.method("isMedicalServiceDisplay",function(){return this.m_displayMedicalService;
});
PatientInfoComponent.method("setMedicalServiceDisplay",function(value){if(value==1){this.rowCount++;
}this.m_displayMedicalService=(value==1?true:false);
});
PatientInfoComponent.method("isRFVDisplay",function(){return this.m_displayRFV;
});
PatientInfoComponent.method("setRFVDisplay",function(value){if(value==1){this.rowCount++;
}this.m_displayRFV=(value==1?true:false);
});
PatientInfoComponent.method("isPrimaryPhysDisplay",function(){return this.m_primaryPhysDisplay;
});
PatientInfoComponent.method("setPrimaryPhysDisplay",function(value){if(value==1){this.rowCount++;
}this.m_primaryPhysDisplay=(value==1?true:false);
});
PatientInfoComponent.method("isAttendingPhysDisplay",function(){return this.m_attedingPhysDisplay;
});
PatientInfoComponent.method("setAttendingPhysDisplay",function(value){if(value==1){this.rowCount++;
}this.m_attedingPhysDisplay=(value==1?true:false);
});
PatientInfoComponent.method("isAdmittingPhysDisplay",function(){return this.m_admittingPhysDisplay;
});
PatientInfoComponent.method("setAdmittingPhysDisplay",function(value){if(value==1){this.rowCount++;
}this.m_admittingPhysDisplay=(value==1?true:false);
});
PatientInfoComponent.method("isRoomBedDisplay",function(){return this.m_roombedDisplay;
});
PatientInfoComponent.method("setRoomBedDisplay",function(value){if(value==1){this.rowCount++;
}this.m_roombedDisplay=(value==1?true:false);
});
PatientInfoComponent.method("isAdmitDateDisplay",function(){return this.m_admitDateDisplay;
});
PatientInfoComponent.method("setAdmitDateDisplay",function(value){if(value==1){this.rowCount++;
}this.m_admitDateDisplay=(value==1?true:false);
});
PatientInfoComponent.method("isEmergencyContactsDisplay",function(){return this.m_emergencyContactsDisplay;
});
PatientInfoComponent.method("setEmergencyContactsDisplay",function(value){this.m_emergencyContactsDisplay=(value==1?true:false);
});
PatientInfoComponent.method("getRowCount",function(){return this.rowCount;
});
PatientInfoComponent.method("getDietOrders",function(){return(this.m_diet);
});
PatientInfoComponent.method("setDietOrders",function(value){this.m_diet=value;
});
PatientInfoComponent.method("getPatientActivityOrders",function(){return(this.m_patAct);
});
PatientInfoComponent.method("setPatientActivityOrders",function(value){this.m_patAct=value;
});
}PatientInfoComponent.inherits(MPageComponent);
var CERN_PATINFO_O1=function(){var timerPatInfoLoad=null;
return{SendPatientData:function(component){var criterion=component.getCriterion();
var sendVal=[];
sendVal.push("^MINE^",criterion.person_id+".0",criterion.encntr_id+".0");
var codes=component.getVisitTypeCodes();
sendVal.push((codes!=null&&codes.length>0)?"value("+codes.join(",")+")":"0");
sendVal.push((component.getEstimatedDischargeDate()!=null)?"value("+component.getEstimatedDischargeDate().join(",")+")":"0.0");
sendVal.push((component.getChiefComplaint()!=null)?"value("+component.getChiefComplaint().join(",")+")":"0.0");
sendVal.push((component.getModeofArrival()!=null)?"value("+component.getModeofArrival().join(",")+")":"0.0");
sendVal.push((component.getAdvancedDirectives()!=null)?"value("+component.getAdvancedDirectives().join(",")+")":"0.0");
sendVal.push((component.getResusOrders()!=null)?"value("+component.getResusOrders().join(",")+")":"0.0");
sendVal.push((component.getDocumentTypes()!=null)?"value("+component.getDocumentTypes().join(",")+")":"0.0");
var prsnlInfo=criterion.getPersonnelInfo();
var encntrs=prsnlInfo.getViewableEncounters();
var encntrVal=(encntrs)?"value("+encntrs+")":"0.0";
sendVal.push(0,encntrVal,criterion.provider_id+".0",criterion.ppr_cd+".0");
sendVal.push((component.getDietOrders()!=null)?"value("+component.getDietOrders().join(",")+")":"0.0");
sendVal.push((component.getPatientActivityOrders()!=null)?"value("+component.getPatientActivityOrders().join(",")+")":"0.0");
MP_Core.XMLCclRequestWrapper(component,"mp_get_patinfo",sendVal,true);
return;
},GetPatientInfo:function(component,reportData){var criterion=component.getCriterion();
var patInfoI18n=i18n.discernabu.patinfo_o1;
var jsPtHTML=[];
var tempAr=[];
var ptHTML="";
var countText="";
var rfv=patInfoI18n.NO_RESULTS_FOUND;
var roomBed=patInfoI18n.NO_RESULTS_FOUND;
var admitDiag=patInfoI18n.NO_RESULTS_FOUND;
var admitDate=patInfoI18n.NO_RESULTS_FOUND;
var primPhys=patInfoI18n.NO_RESULTS_FOUND;
var attPhys=patInfoI18n.NO_RESULTS_FOUND;
var admPhys=patInfoI18n.NO_RESULTS_FOUND;
var medService=patInfoI18n.NO_RESULTS_FOUND;
var dischargeDate=patInfoI18n.NO_RESULTS_FOUND;
var recCount=0;
var dateTime=new Date();
var contact=5;
var patLstVstdisp;
var df=new mp_formatter.DateTimeFormatter(MPAGE_LOCALE);
var lastVisitDtTm=new Date();
var visitListCnt=reportData.VISIT_LIST.length;
var multVisitTypeInd=reportData.MULT_VISIT_TYPE_IND;
if(reportData.RFV!=""){rfv=reportData.RFV;
}if(reportData.ROOM_BED!=""){roomBed=reportData.ROOM_BED;
}if(reportData.ADMIT_DT_TM!=""){admitDate=reportData.ADMIT_DT_TM;
dateTime.setISO8601(admitDate);
admitDate=df.format(dateTime,mp_formatter.DateTimeFormatter.FULL_DATE_4YEAR);
}if(reportData.PRIMARY_PHYS!=""){primPhys=reportData.PRIMARY_PHYS;
}if(reportData.ATTENDING_PHYS!=""){attPhys=reportData.ATTENDING_PHYS;
}if(reportData.ADMITTING_PHYS!=""){admPhys=reportData.ADMITTING_PHYS;
}if(reportData.MED_SERVICE!=""){medService=reportData.MED_SERVICE;
}if(reportData.ESTIMATED_DEPART_DT_TM!=""){if(reportData.ESTIMATED_DEPART_DATE>0){dischargeDate=df.formatISO8601(reportData.ESTIMATED_DEPART_DT_TM,mp_formatter.DateTimeFormatter.FULL_DATE_4YEAR);
}else{dischargeDate=reportData.ESTIMATED_DEPART_DT_TM;
}}jsPtHTML.push("<div class='",MP_Util.GetContentClass(component,component.getRowCount()),"'>");
if(component.getChiefComplaint()!=null){var chiefComplaint="<dd class='pt-detail'><span>"+patInfoI18n.NO_RESULTS_FOUND+"</span></dd>";
if(reportData.CHIEFCOMPLAINTS.length>0){var complaint=reportData.CHIEFCOMPLAINTS[0].CHIEFCOMPLAINT;
if(complaint>""){tempAr=[];
var resModified=(reportData.CHIEFCOMPLAINTS[0].MODIFIED_FLAG>0)?"<span class='res-modified'>&nbsp;</span>":"";
var eventid=reportData.CHIEFCOMPLAINTS[0].EVENTID;
var viewerLink=ptEventViewerLink(criterion.person_id+".0",eventid,complaint);
tempAr.push("<dd class='pt-detail'><span>",viewerLink,"</span>",resModified,"</dd>");
chiefComplaint=tempAr.join("");
}}jsPtHTML.push("<dl class='pt-info'><dt class='pt-label'><span>",patInfoI18n.CHIEF_COMPLAINT,":</span></dt>",chiefComplaint,"</dl>");
}if(component.isRFVDisplay()){jsPtHTML.push("<dl class='pt-info'><dt class='pt-label'><span>",patInfoI18n.RFV,":</span></dt><dd class='pt-detail'><span>",rfv,"</span></dd></dl>");
}if(component.isPrimaryPhysDisplay()){jsPtHTML.push("<dl class='pt-info'><dt  class='pt-label'><span>",patInfoI18n.PRIM_PHYS,":</span></dt><dd class='pt-detail'><span>",primPhys,"</span></dd></dl>");
}if(component.isAttendingPhysDisplay()){jsPtHTML.push("<dl class='pt-info'><dt  class='pt-label'><span>",patInfoI18n.ATTEND_PHYS,":</span></dt><dd class='pt-detail'><span>",attPhys,"</span></dd></dl>");
}if(component.isAdmittingPhysDisplay()){jsPtHTML.push("<dl class='pt-info'><dt  class='pt-label'><span>",patInfoI18n.ADMIT_PHYS,":</span></dt><dd class='pt-detail'><span>",admPhys,"</span></dd></dl>");
}if(component.isMedicalServiceDisplay()){jsPtHTML.push("<dl class='pt-info'><dt  class='pt-label'><span>",patInfoI18n.SERVICE,":</span></dt><dd class='pt-detail'><span>",medService,"</span></dd></dl>");
}if(component.isRoomBedDisplay()){jsPtHTML.push("<dl class='pt-info'><dt class='pt-label'><span>",patInfoI18n.ROOM_BED,":</span></dt><dd class='pt-detail'><span>",roomBed,"</span></dd></dl>");
}if(component.isAdmitDateDisplay()){jsPtHTML.push("<dl class='pt-info'><dt class='pt-label'><span>",patInfoI18n.ADMIT_DATE,":</span></dt><dd class='pt-detail'><span>",admitDate,"</span></dd></dl>");
}if(component.getEstimatedDischargeDate()!=null){var resModified=(reportData.ESTIMATED_DEPART_MODIFIED_FLAG>0)?"<span class='res-modified'>&nbsp;</span>":"";
var eventid=reportData.ESTIMATED_DEPART_EVENTID;
if(eventid>0){var viewerLink=ptEventViewerLink(criterion.person_id+".0",eventid,dischargeDate);
}else{var viewerLink=dischargeDate;
}jsPtHTML.push("<dl class='pt-info'><dt class='pt-label'><span>",patInfoI18n.TARGETED_DISCHARGE_DATE,":</span></dt><dd class='pt-detail'><span>",viewerLink,"</span>",resModified,"</dd></dl>");
}if(component.getModeofArrival()!=null){var modeofArrival="<dd class='pt-detail'><span>"+patInfoI18n.NO_RESULTS_FOUND+"</span></dd>";
if(reportData.MODESOFARRIVAL.length>0){var arrival=reportData.MODESOFARRIVAL[0].MODEOFARRIVAL;
if(arrival>""){tempAr=[];
var resModified=(reportData.MODESOFARRIVAL[0].MODIFIED_FLAG>0)?"<span class='res-modified'>&nbsp;</span>":"";
var eventid=reportData.MODESOFARRIVAL[0].EVENTID;
var viewerLink=ptEventViewerLink(criterion.person_id+".0",eventid,arrival);
tempAr.push("<dd class='pt-detail'><span>",viewerLink,"</span>",resModified,"</dd>");
modeofArrival=tempAr.join("");
}}jsPtHTML.push("<dl class='pt-info'><dt class='pt-label'><span>",patInfoI18n.MODE_OF_ARRVAL,":</span></dt>",modeofArrival,"</dl>");
}if(component.getAdvancedDirectives()!=null){var advancedirective="<dd class='pt-detail'><span>"+patInfoI18n.NO_RESULTS_FOUND+"</span></dd>";
if(reportData.ADVANCEDDIRECTIVES.length>0){var directive=reportData.ADVANCEDDIRECTIVES[0].ADVANCEDIRECTIVE;
if(directive>""){tempAr=[];
var resModified=(reportData.ADVANCEDDIRECTIVES[0].MODIFIED_FLAG>0)?"<span class='res-modified'>&nbsp;</span>":"";
var eventid=reportData.ADVANCEDDIRECTIVES[0].EVENTID;
var viewerLink=ptEventViewerLink(criterion.person_id+".0",eventid,directive);
tempAr.push("<dd class='pt-detail'><span>",viewerLink,"</span>",resModified,"</dd>");
advancedirective=tempAr.join("");
}}jsPtHTML.push("<dl class='pt-info'><dt class='pt-label'><span>",patInfoI18n.ADVANCE_DIRECTIVE,":</span></dt>",advancedirective,"</dl>");
}if(visitListCnt>0){patLstVstdisp="";
var resModified=(reportData.LASTVISITDOCMODFLAG>0)?"<span class='res-modified'>&nbsp;</span>":"";
if(reportData.VISIT_LIST[0].UTCDATE!=""){var lastVisit=reportData.VISIT_LIST[0].UTCDATE;
lastVisitDtTm.setISO8601(lastVisit);
patLstVstdisp=df.format(lastVisitDtTm,mp_formatter.DateTimeFormatter.FULL_DATE_4YEAR);
}if(reportData.DOCVIEWERTYPE==="AP"){if((reportData.LASTVISITEVENTID>0)&&(reportData.LASTVISITPEVENTID>0)){jsPtHTML.push("<dl class='pt-info'><dt class='pt-label'><span>",patInfoI18n.LAST_VISIT,":</span></dt><dd class='pt-detail'><span>",MP_Util.CreateClinNoteLink(component.getCriterion().person_id,component.getCriterion().encntr_id,reportData.LASTVISITEVENTID,patLstVstdisp+"&nbsp("+reportData.VISIT_LIST[0].TYPE+")",reportData.DOCVIEWERTYPE,reportData.LASTVISITPEVENTID),"</span></dd></dl>");
}else{jsPtHTML.push("<dl class='pt-info'><dt class='pt-label'><span>",patInfoI18n.LAST_VISIT,":</span></dt><dd class='pt-detail'><span>",patLstVstdisp,"&nbsp","(",reportData.VISIT_LIST[0].TYPE,")","</span>",resModified,"</dd></dl>");
}}else{if((reportData.DOCVIEWERTYPE!=="STANDARD")&&(reportData.LASTVISITEVENTID>0)){jsPtHTML.push("<dl class='pt-info'><dt class='pt-label'><span>",patInfoI18n.LAST_VISIT,":</span></dt><dd class='pt-detail'><span>",MP_Util.CreateClinNoteLink(component.getCriterion().person_id,component.getCriterion().encntr_id,reportData.LASTVISITEVENTID,patLstVstdisp+"&nbsp("+reportData.VISIT_LIST[0].TYPE+")",reportData.DOCVIEWERTYPE,reportData.LASTVISITPEVENTID),"</span></dd></dl>");
}else{jsPtHTML.push("<dl class='pt-info'><dt class='pt-label'><span>",patInfoI18n.LAST_VISIT,":</span></dt><dd class='pt-detail'><span>",patLstVstdisp,"&nbsp","(",reportData.VISIT_LIST[0].TYPE,")","</span>",resModified,"</dd></dl>");
}}if(visitListCnt>1){jsPtHTML.push("<h4 class='det-hd'><span>",patInfoI18n.DETAILS,"</span></h4><div class='hvr'><dl class='pt-det'>");
if(multVisitTypeInd==0){for(var j=0,m=reportData.VISIT_LIST.length;
j<m;
j++){if(reportData.VISIT_LIST[j].UTCDATE!=""){var lastVis=reportData.VISIT_LIST[j].UTCDATE;
lastVisitDtTm.setISO8601(lastVis);
jsPtHTML.push("<dd><span>",df.format(lastVisitDtTm,mp_formatter.DateTimeFormatter.FULL_DATE_4YEAR),"</span></dd><br/>");
}}}else{if(multVisitTypeInd==1){for(var j=0,m=reportData.VISIT_LIST.length;
j<m;
j++){if(reportData.VISIT_LIST[0].UTCDATE!=""){var lastVisit1=reportData.VISIT_LIST[j].UTCDATE;
lastVisitDtTm.setISO8601(lastVisit1);
jsPtHTML.push("<dd><span>",df.format(lastVisitDtTm,mp_formatter.DateTimeFormatter.FULL_DATE_4YEAR),"&nbsp","(",reportData.VISIT_LIST[j].TYPE,")","</span></dd><br/>");
}}}}jsPtHTML.push("</dl></div>");
}}else{jsPtHTML.push("<dl class='pt-info'><dt class='pt-label'><span>",patInfoI18n.LAST_VISIT,":</span></dt><dd class='pt-detail'><span>",patInfoI18n.NO_RESULTS_FOUND,"</span></dd></dl>");
}if(component.getResusOrders()!=null){var codeStatus="";
var codeStatusDetails="";
for(i=0,k=reportData.RESUSCITATION.length;
i<k;
i++){if(i>0){codeStatus+=", ";
}codeStatus+=reportData.RESUSCITATION[i].CODE_STATUS;
codeStatusDetails=reportData.RESUSCITATION[i].CODE_STATUS_DETAILS;
}if(codeStatus==""){codeStatus=patInfoI18n.NO_RESULTS_FOUND;
codeStatusDetails="";
}jsPtHTML.push("<dl class='pt-info'><dt  class='pt-label'><span>",patInfoI18n.CODE_STATUS,":</span></dt><dd class='pt-detail'><span class='res-severe'>",codeStatus,"</span></dd></dl>");
if(codeStatusDetails!=""){jsPtHTML.push("<h4 class='det-hd'><span>",patInfoI18n.DETAILS,"</span></h4><div class='hvr'><dl class='pt-det'><dd><span>",codeStatusDetails,"</span></dd></dl></div>");
}}if(component.getDietOrders()||component.getPatientActivityOrders()){if(!reportData.DIET&&!reportData.ACTIVITY_ORDER){jsPtHTML.push("<div class='sub-sec closed'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl'>-</span><span class='sub-sec-title'>",patInfoI18n.DIET_ACTIVITY," (0) </span></h3><div class='sub-sec-content'><span class='res-none'>",patInfoI18n.NO_RESULTS_FOUND,"</span></div></div>");
}else{var counter=(reportData.DIET&&reportData.ACTIVITY_ORDER)?2:1;
jsPtHTML.push("<div class='sub-sec'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl'>-</span><span class='sub-sec-title'>",patInfoI18n.DIET_ACTIVITY," (",counter,")</span></h3><div class='sub-sec-content'>");
if(reportData.DIET){jsPtHTML.push("<dl class='pt-info'><dt class='pt-label'><span>",reportData.DIET,"</span></dt><dd class='pt-detail'><span>",reportData.DIET_ORDER_DISP,"</span></dd></dl>");
}if(reportData.ACTIVITY_ORDER){jsPtHTML.push("<dl class='pt-info'><dt class='pt-label'><span>",reportData.ACTIVITY_ORDER,"</span></dt><dd class='pt-detail'><span>",reportData.ACTIVITY_ORDER_DISP,"</span></dd></dl>");
}jsPtHTML.push("</div></div>");
}}if(component.isEmergencyContactsDisplay()){var contactList=reportData.CONTACT_LIST;
if(contactList.length>0){jsPtHTML.push("<div class='sub-sec'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl'>-</span><span class='sub-sec-title'>",patInfoI18n.EMER_CONTACT," (",contactList.length,")</span></h3><div class='sub-sec-content'>");
for(var j=0,m=contactList.length;
j<m;
j++){jsPtHTML.push("<dl class='pt-info'><dt class='pt-label'><span>",contactList[j].NAME,":</span></dt><dd class='pt-detail'><span>",contactList[j].NUMBER,"</span></dd></dl>");
if(contactList[j].CONTACT_PHONE.length>0){jsPtHTML.push("<h4 class='det-hd'><span>",patInfoI18n.DETAILS,"</span></h4><div class='hvr'><dl class='pt-det'>");
}for(var x=0,y=contactList[j].CONTACT_PHONE.length;
x<y;
x++){jsPtHTML.push("<dd><span>",contactList[j].CONTACT_PHONE[x].NUMBER,"</span></dd><br/>");
}jsPtHTML.push("</dl></div>");
}jsPtHTML.push("</div></div>");
}else{jsPtHTML.push("<div class='sub-sec closed'><h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl'>-</span><span class='sub-sec-title'>",patInfoI18n.EMER_CONTACT," (0)</span></h3><div class='sub-sec-content'><span class='res-none'>",patInfoI18n.NO_RESULTS_FOUND,"</span></div></div>");
}}jsPtHTML.push("</div>");
ptHTML=jsPtHTML.join("");
countText=MP_Util.CreateTitleText(component,component.getRowCount(),false,false,false);
MP_Util.Doc.FinalizeComponent(ptHTML,component,countText);
return;
}};
function ptEventViewerLink(personid,eventid,result){var ar=[];
var params=[personid,"0.0",eventid,'"EVENT"',"0.0"];
ar.push("<a onclick='MP_Util.LaunchClinNoteViewer(",params.join(","),"); return false;' href='#'>",result,"</a>");
return ar.join("");
}}();

function ProblemsComponentStyle(){this.initByNamespace("pl");
}ProblemsComponentStyle.inherits(ComponentStyle);
function ProblemsComponent(criterion){this.m_searchTypeFlag=null;
this.m_suggestionLimit=null;
this.curSearchCounter=0;
this.nextSearchCounter=0;
this.replySearchCounter=0;
this.setCriterion(criterion);
this.setStyles(new ProblemsComponentStyle());
this.setComponentLoadTimerName("USR:MPG.PROBLEMS.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.PROBLEMS.O1 - render component");
this.setIncludeLineNumber(true);
this.setScope(1);
ProblemsComponent.method("InsertData",function(){this.setEditMode(true);
CERN_PROBLEMS_O1.GetProblemsTable(this);
});
ProblemsComponent.method("HandleSuccess",function(recordData){CERN_PROBLEMS_O1.RenderComponent(this,recordData);
});
ProblemsComponent.method("getSearchTypeFlag",function(){return this.m_searchTypeFlag;
});
ProblemsComponent.method("setSearchTypeFlag",function(value){this.m_searchTypeFlag=value;
});
ProblemsComponent.method("getSuggestionLimit",function(){return this.m_suggestionLimit;
});
ProblemsComponent.method("setSuggestionLimit",function(value){this.m_suggestionLimit=value;
});
ProblemsComponent.method("getCurSearchCounter",function(){return this.curSearchCounter;
});
ProblemsComponent.method("setCurSearchCounter",function(value){this.curSearchCounter=value;
});
ProblemsComponent.method("incCurSearchCounter",function(){this.curSearchCounter++;
});
ProblemsComponent.method("getNextSearchCounter",function(){return this.nextSearchCounter;
});
ProblemsComponent.method("setNextSearchCounter",function(value){this.nextSearchCounter=value;
});
ProblemsComponent.method("incNextSearchCounter",function(){this.nextSearchCounter++;
});
ProblemsComponent.method("getReplySearchCounter",function(){return this.replySearchCounter;
});
ProblemsComponent.method("setReplySearchCounter",function(value){this.replySearchCounter=value;
});
ProblemsComponent.method("incReplySearchCounter",function(){this.replySearchCounter++;
});
}ProblemsComponent.inherits(MPageComponent);
var CERN_PROBLEMS_O1=function(){return{GetProblemsTable:function(component){var sendAr=[];
var criterion=component.getCriterion();
sendAr.push("^MINE^",criterion.person_id+".0","0",criterion.provider_id+".0",criterion.ppr_cd+".0",criterion.position_cd+".0");
var request=new MP_Core.ScriptRequest(component,component.getComponentLoadTimerName());
request.setProgramName("MP_GET_PROBLEMS");
request.setParameters(sendAr);
request.setAsync(true);
MP_Core.XMLCCLRequestCallBack(component,request,CERN_PROBLEMS_O1.RenderComponent);
},RenderComponent:function(reply){var countText="";
var component=reply.getComponent();
try{var recordData=reply.getResponse();
var jsPlHTML=[];
var plHTML="";
if(reply.getStatus()!=="F"){if(recordData.PL_CAN_ADD===1){jsPlHTML.push(MP_Util.CreateAutoSuggestBoxHtml(component));
component.setAutoSuggestAddScript("mp_add_problem");
component.setAutoSuggestAddTimerName("USR:MPG.PROBLEMS.01 - add problem from auto suggest");
component.setSuggestionLimit(10);
}if(reply.getStatus()==="S"){var df=new mp_formatter.DateTimeFormatter(MPAGE_LOCALE);
var personnelArray=MP_Util.LoadPersonelListJSON(recordData.PRSNL);
var probLen=(recordData.PROBLEM&&recordData.PROBLEM!==null)?recordData.PROBLEM.length:0;
jsPlHTML.push("<div class='",MP_Util.GetContentClass(component,probLen),"'>");
var problemArray=recordData.PROBLEM;
var codeArray=MP_Util.LoadCodeListJSON(recordData.CODES);
for(var i=0,l=problemArray.length;
i<l;
i++){var responsibleProvider="";
var type="";
var onsetDate="";
var onsetCd="";
var onsetDateFormatted=[];
if(problemArray[i].ONSET_DT_TM&&problemArray[i].ONSET_DT_TM!==""){var onsetFlag=problemArray[i].ONSET_DT_FLAG;
onsetDate=problemArray[i].ONSET_DT_TM;
if(problemArray[i].ONSET_DT_CD>0){onsetCd=MP_Util.GetValueFromArray(problemArray[i].ONSET_DT_CD,codeArray);
onsetDateFormatted=onsetCd.display+" ";
}if(onsetFlag==2){onsetDateFormatted+=df.formatISO8601(onsetDate,mp_formatter.DateTimeFormatter.FULL_4YEAR);
}else{if(onsetFlag==1){onsetDateFormatted+=df.formatISO8601(onsetDate,mp_formatter.DateTimeFormatter.FULL_MONTH_4YEAR_NO_DATE);
}else{onsetDateFormatted+=df.formatISO8601(onsetDate,mp_formatter.DateTimeFormatter.FULL_DATE_4YEAR);
}}}else{onsetCd="";
if(problemArray[i].ONSET_DT_CD>0){onsetCd=MP_Util.GetValueFromArray(problemArray[i].ONSET_DT_CD,codeArray);
onsetDateFormatted=onsetCd.display;
}}if(problemArray[i].PROVIDER_ID&&problemArray[i].PROVIDER_ID!==0){var provCodeObj=MP_Util.GetValueFromArray(problemArray[i].PROVIDER_ID,personnelArray);
responsibleProvider=provCodeObj.fullName;
}var plCode="";
var plName=problemArray[i].NAME;
var plAnnot=(problemArray[i].DISPLAY_AS&&problemArray[i].DISPLAY_AS!==null)?problemArray[i].DISPLAY_AS:null;
var plFaceUp=plAnnot;
if(plAnnot===null||plAnnot===""){plAnnot="&nbsp;";
plFaceUp=plName;
}if(problemArray[i].CODE&&problemArray[i].CODE!==""){plCode="("+problemArray[i].CODE+")";
}if(problemArray[i].PARENT_PROBLEM_ID===0){type="pl-name";
}else{type="pl-assoc-name";
}jsPlHTML.push("<h3 class='info-hd'><span>",plName,"</span></h3><dl class='pl-info'><dt><span>",i18n.PROBLEMS,":</span></dt><dd class=",type,"><span>",plFaceUp,"</span></dd><dt><span>",i18n.CODE,":</span></dt><dd class='pl-code'><span class='code'>",plCode,"</span></dd></dl><h4 class='det-hd'><span>",i18n.PROBLEMS_DETAILS,":</span></h4><div class='hvr'><dl class='pl-det'><dt><span>",i18n.PROBLEM,":</span></dt><dd class='pl-det-name'><span>",plName,"</span></dd><dt><span>",i18n.ANNOTATED_DISPLAY,":</span></dt><dd class='pl-det-annot'><span>",plAnnot,"</span></dd><dt><span>",i18n.ONSET_DATE,":</span></dt><dd class='pl-det-dt'><span>",onsetDateFormatted,"</span></dd><dt><span>",i18n.RESPONSIBLE_PROVIDER_NAME,":</span></dt><dd class='pl-det-dt'><span>",responsibleProvider,"</span></dd><dt><span>",i18n.COMMENTS,":</span></dt><dd class='pl-det-comment'><span>",MP_Util.Doc.GetComments(problemArray[i],personnelArray),"</span></dd></dl></div>");
}plHTML=jsPlHTML.join("");
countText=MP_Util.CreateTitleText(component,probLen);
jsPlHTML.push("</div>");
}else{if((reply.getStatus()==="Z")){plHTML=jsPlHTML.join("");
plHTML+=MP_Util.HandleNoDataResponse(component.getStyles().getNameSpace());
}}MP_Util.Doc.FinalizeComponent(plHTML,component,countText);
if(recordData.PL_CAN_ADD===1){MP_Util.AddAutoSuggestControl(component,CERN_PROBLEMS_O1.SearchNomenclature,CERN_PROBLEMS_O1.HandleSelection,CERN_PROBLEMS_O1.CreateSuggestionLine);
component.setSearchTypeFlag(recordData.PL_SEARCH_TYPE);
}}else{countText=MP_Util.CreateTitleText(component,0);
MP_Util.Doc.FinalizeComponent(MP_Util.HandleErrorResponse(component.getStyles().getNameSpace(),reply.getError()),component,countText);
}}catch(err){countText=MP_Util.CreateTitleText(component,0);
var errMsg=[];
errMsg.push("<b>",i18n.JS_ERROR,"</b><br><ul><li>",i18n.MESSAGE,": ",err.message,"</li><li>",i18n.NAME,": ",err.name,"</li><li>",i18n.NUMBER,": ",(err.number&65535),"</li><li>",i18n.DESCRIPTION,": ",err.description,"</li></ul>");
MP_Util.Doc.FinalizeComponent(MP_Util.HandleErrorResponse(component.getStyles().getNameSpace(),errMsg.join("")),component,countText);
throw (err);
}finally{component.setEditMode(false);
}},SearchNomenclature:function(callback,textBox,component){var xhr=new XMLCclRequest();
var returnData;
component.incCurSearchCounter();
xhr.onreadystatechange=function(){if(xhr.readyState==4&&xhr.status==200){var msg=xhr.responseText;
var jsonMsg="";
if(msg){jsonMsg=JSON.parse(msg);
}if(jsonMsg){var nextSearchCounter=component.getNextSearchCounter();
var replySearchCounter=jsonMsg.RECORD_DATA.SEARCHINDEX;
component.setReplySearchCounter(replySearchCounter);
if(replySearchCounter>nextSearchCounter&&textBox.value!==""){component.setNextSearchCounter(replySearchCounter);
returnData=jsonMsg.RECORD_DATA.NOMENCLATURE;
callback.autosuggest(returnData);
}}}};
xhr.open("GET","mp_search_nomenclatures");
xhr.send("^MINE^, ^"+textBox.value+"^,"+component.getSuggestionLimit()+","+component.getCurSearchCounter()+","+component.getSearchTypeFlag());
},HandleSelection:function(suggestionObj,textBox,component){var criterion=component.getCriterion();
var sendAr=[];
sendAr.push("^MINE^",criterion.person_id+".0",criterion.encntr_id+".0",criterion.provider_id+".0",criterion.position_cd+".0",criterion.ppr_cd+".0",suggestionObj.VALUE+".0","0.0","1");
var request=new MP_Core.ScriptRequest(component,component.getAutoSuggestAddTimerName());
request.setProgramName(component.getAutoSuggestAddScript());
request.setParameters(sendAr);
request.setAsync(true);
MP_Core.XMLCCLRequestCallBack(component,request,CERN_PROBLEMS_O1.AddProblemToList);
},AddProblemToList:function(reply){var alertMsg="";
var jsonReply=reply.getResponse();
var component=reply.getComponent();
var componentName="";
var textBox=MP_Util.RetrieveAutoSuggestSearchBox(component);
componentName=i18n.discernabu.PROBLEM;
if(jsonReply&&jsonReply.PRIVILEGE_IND===0){alertMsg=i18n.discernabu.NO_PRIVS;
alertMsg=alertMsg.replace("{name}",componentName);
alert(alertMsg);
textBox.value="";
}else{if(jsonReply&&jsonReply.DUPLICATE_IND==1){alertMsg=i18n.discernabu.DUPLICATE;
alertMsg=alertMsg.replace(/{name}/gi,componentName);
alert(alertMsg);
textBox.value="";
}else{MP_Util.Doc.HideHovers();
component.InsertData();
}}},CreateSuggestionLine:function(suggestionObj,searchVal){return CERN_PROBLEMS_O1.HighlightValue(suggestionObj.NAME,searchVal);
},HighlightValue:function(inString,term){return"<strong class='highlight'>"+inString.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+term.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1").split(" ").join("|")+")(?![^<>]*>)(?![^&;]+;)","gi"),"</strong>$1<strong class='highlight'>")+"</strong>";
}};
}();

function ProcedureComponentStyle(){this.initByNamespace("proc");
}ProcedureComponentStyle.inherits(ComponentStyle);
function ProcedureComponent(criterion){this.setCriterion(criterion);
this.setStyles(new ProcedureComponentStyle());
this.setIncludeLineNumber(true);
this.setScope(1);
this.setComponentLoadTimerName("USR:MPG.PROCEDURE.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.PROCEDURE.O1 - render component");
ProcedureComponent.method("InsertData",function(){CERN_PROCEDURE_O1.GetProcedureTable(this);
});
ProcedureComponent.method("HandleSuccess",function(recordData){CERN_PROCEDURE_O1.RenderComponent(this,recordData);
});
}ProcedureComponent.inherits(MPageComponent);
var CERN_PROCEDURE_O1=function(){return{GetProcedureTable:function(component){var sendAr=[];
var criterion=component.getCriterion();
var prsnlInfo=criterion.getPersonnelInfo();
var encntrs=prsnlInfo.getViewableEncounters();
var encntrVal=(encntrs)?"value("+encntrs+")":"0.0";
sendAr.push("^MINE^",criterion.person_id+".0",encntrVal,criterion.provider_id+".0",criterion.ppr_cd+".0");
MP_Core.XMLCclRequestWrapper(component,"mp_get_procedures",sendAr,true);
},RenderComponent:function(component,recordData){var timerRenderComponent=MP_Util.CreateTimer(component.getComponentRenderTimerName());
try{var jsHTML=[];
var df=new mp_formatter.DateTimeFormatter(MPAGE_LOCALE);
jsHTML.push("<div class='",MP_Util.GetContentClass(component,recordData.PROC_CNT),"'>");
for(var i=0;
i<recordData.PROC_CNT;
i++){var commentString="";
var onsetDate="";
var dateTime=null;
if(recordData.PROC[i].ONSET!=""){dateTime=new Date();
var onsetDt=recordData.PROC[i].ONSET_UTC;
dateTime.setISO8601(onsetDt);
if(recordData.PROC[i].DATE_FLAG==0||recordData.PROC[i].DATE_FLAG==1){onsetDate=df.format(dateTime,mp_formatter.DateTimeFormatter.FULL_DATE_4YEAR);
}else{if(recordData.PROC[i].DATE_FLAG==2){onsetDate=df.format(dateTime,mp_formatter.DateTimeFormatter.FULL_MONTH_4YEAR_NO_DATE);
}else{if(recordData.PROC[i].DATE_FLAG==3){onsetDate=df.format(dateTime,mp_formatter.DateTimeFormatter.FULL_4YEAR);
}}}}jsHTML.push("  <h3 class='info-hd'><SPAN>",recordData.PROC[i].DISPLAY_AS,"</SPAN></h3><dl class='proc-info'><dt class='proc-name'><span>",i18n.PROCEDURE,"</span></dt><dd class='proc-name'><span>",recordData.PROC[i].DISPLAY_AS,"</span></dd><dt class='proc-date'><span>",i18n.SIG_LINE,"</span></dt><dd class='proc-date'><span class='date-time'>",onsetDate,"</span></dd></dl><h4 class='det-hd'><span>",i18n.PROCEDURE_DETAILS,"</span></h4><div class='proc-det hvr'><dt class='proc-det-name'><span>",i18n.PROCEDURE,":</span></dt><dd class='proc-det-name'>",recordData.PROC[i].NAME,"</dd><dt class='proc-det-name'><span>",i18n.DISPLAY_AS,":</span></dt><dd class='proc-det-name'>",recordData.PROC[i].DISPLAY_AS,"</dd><dt class='proc-det-name'><span>",i18n.PROCEDURE_DATE,":</span></dt><dd class='proc-det-name'>",onsetDate,"</dd><dt class='proc-det-name'><span>",i18n.STATUS,":</span></dt><dd class='proc-det-name'>",recordData.PROC[i].STATUS,"</dd><dt class='proc-det-name'><span>",i18n.PROVIDER,":</span></dt><dd class='proc-det-name'>",recordData.PROC[i].PROVIDER,"</dd><dt class='proc-det-name'><span>",i18n.LOCATION,":</span></dt><dd class='proc-det-name'>",recordData.PROC[i].LOCATION,"</dd><dt class='proc-det-name'><span>",i18n.COMMENTS,":</span></dt>");
for(var k=0;
k<recordData.PROC[i].COMMENTS.length;
k++){var begin_dttm="";
if(recordData.PROC[i].COMMENTS[k].BEG_EFFECTIVE_DT_TM!=""){dateTime=new Date();
var beginDt=recordData.PROC[i].COMMENTS[k].BEG_EFFECTIVE_DT_TM;
dateTime.setISO8601(beginDt);
begin_dttm=df.format(dateTime,mp_formatter.DateTimeFormatter.FULL_DATE_4YEAR);
}commentString+=begin_dttm+" - "+recordData.PROC[i].COMMENTS[k].NAME_FULL_FORMATTED+"<br/>"+recordData.PROC[i].COMMENTS[k].LONG_TEXT+"<br/>";
}jsHTML.push("<dd class='proc-det-name'>",commentString,"</dd>");
jsHTML.push("</div>");
}jsHTML.push("</div>");
var countText=MP_Util.CreateTitleText(component,recordData.PROC_CNT);
MP_Util.Doc.FinalizeComponent(jsHTML.join(""),component,countText);
}catch(err){if(timerRenderComponent){timerRenderComponent.Abort();
timerRenderComponent=null;
}throw (err);
}finally{if(timerRenderComponent){timerRenderComponent.Stop();
}}return;
}};
function formatDateTimeUTC(dttm,format){var dateTime=new Date();
dateTime.setISO8601(dttm);
return dateTime.format(format);
}}();

function QualityMeasuresComponentStyle(){this.initByNamespace("qm");
}QualityMeasuresComponentStyle.inherits(ComponentStyle);
function QualityMeasuresComponent(criterion){this.setCriterion(criterion);
this.setStyles(new QualityMeasuresComponentStyle());
this.setComponentLoadTimerName("USR:MPG.QUALITYMEASURES.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.QUALITYMEASURES.O1 - render component");
this.setIncludeLineNumber(true);
this.setScope(2);
QualityMeasuresComponent.method("InsertData",function(){CERN_QUALITY_MEASURES_O1.GetQualityMeasuresTable(this,0);
});
QualityMeasuresComponent.method("HandleSuccess",function(recordData){CERN_QUALITY_MEASURES_O1.RenderComponent(this,recordData);
});
QualityMeasuresComponent.method("setPlanStatusCodes",function(value){this.m_planStatusCodes=value;
});
QualityMeasuresComponent.method("addPlanStatusCode",function(value){if(this.m_planStatusCodes==null){this.m_planStatusCodes=[];
}this.m_planStatusCodes.push(value);
});
QualityMeasuresComponent.method("getPlanStatusCodes",function(){return this.m_planStatusCodes;
});
QualityMeasuresComponent.method("openTab",function(){var criterion=this.getCriterion();
var params=[criterion.person_id,".0|",criterion.encntr_id,".0|"];
params.push("{ORDER|0|0|0|0|0}");
params.push("|0|{2|127}|8");
MPAGES_EVENT("ORDERS",params.join(""));
this.InsertData();
});
}QualityMeasuresComponent.inherits(MPageComponent);
var CERN_QUALITY_MEASURES_O1=function(){var qmComponent=null;
return{GetQualityMeasuresTable:function(component,selectedCondition){var criterion=component.getCriterion();
var sendAr=[];
var codes=component.getPlanStatusCodes();
var status_cds=(codes!=null&&codes.length>0)?"value("+codes.join(",")+")":"0.0";
sendAr.push("^MINE^",criterion.person_id+".0",criterion.encntr_id+".0",criterion.provider_id+".0",criterion.position_cd+".0",criterion.ppr_cd+".0");
sendAr.push(status_cds,component.getScope(),component.getLookbackUnits(),component.getLookbackUnitTypeFlag(),selectedCondition);
MP_Core.XMLCclRequestWrapper(component,"mp_get_quality_measures",sendAr,true);
},RenderComponent:function(component,recordData){var timerRenderComponent=MP_Util.CreateTimer(component.getComponentRenderTimerName());
try{qmComponent=component;
var sHTML="",countText="";
var ar=[];
var criterion=component.getCriterion();
var loc=component.getCriterion().static_content;
var totalOutcomes=recordData.OUTCOMES_COMPLETE.length+recordData.OUTCOMES_INCOMPLETE.length;
ar.push("<div class='",MP_Util.GetContentClass(component,totalOutcomes+1),"'>");
ar.push("<div class='qm-cbo'><form><span class='qm-cond-lbl'>"+i18n.QM_CONDITION+"</span><select id='qmTask' onchange='CERN_QUALITY_MEASURES_O1.LoadCondition(this.form.qmTask)'>");
for(var i=0;
i<recordData.CONDITIONS.length;
i++){if(recordData.CONDITIONS[i].CONDITION_ID==recordData.SELECTED_CONDITION_ID){ar.push("<option value="+recordData.CONDITIONS[i].CONDITION_ID+" selected='selected'>"+recordData.CONDITIONS[i].CONDITION_NAME+"</option>");
}else{ar.push("<option value="+recordData.CONDITIONS[i].CONDITION_ID+">"+recordData.CONDITIONS[i].CONDITION_NAME+"</option>");
}}ar.push("</select></form></div>");
ar.push("<div id='condID'>");
ar.push("<div class='sub-sec'>");
ar.push("<h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl' title=",i18n.HIDE_SECTION,">-</span><span class='sub-sec-title'>",i18n.QM_INCOMPLETE," (",recordData.OUTCOMES_INCOMPLETE.length,")</span></h3>");
ar.push("<div class='sub-sec-content'>");
if(recordData.OUTCOMES_INCOMPLETE.length>0){for(var j=0;
j<recordData.OUTCOMES_INCOMPLETE.length;
j++){ar.push("<dl class='qm-info' onmouseover='CERN_QUALITY_MEASURES_O1.ShowIcon(this)' onmouseout='CERN_QUALITY_MEASURES_O1.HideIcon(this)'>");
ar.push("<dt><span>measure</span></dt><dd class='qm-ic-name'><span>"+recordData.OUTCOMES_INCOMPLETE[j].OUTCOME_NAME+"</span></dd>");
ar.push("<dt><span>measure</span></dt><dd class='qm-doc'><span class='cmp-doc' onclick='CERN_QUALITY_MEASURES_O1.OpenQMDoc("+recordData.OUTCOMES_INCOMPLETE[j].FORM_REF_ID+","+recordData.OUTCOMES_INCOMPLETE[j].FORM_ACT_ID+")'>&nbsp;</span></dd>");
ar.push("</dl>");
}}else{if(recordData.OUTCOMES_INCOMPLETE.length==0){ar.push("<span class='res-none'>",i18n.NO_RESULTS_FOUND,"</span>");
}}ar.push("</div>");
ar.push("</div>");
ar.push("<div class='sub-sec'>");
ar.push("<h3 class='sub-sec-hd'><span class='sub-sec-hd-tgl' title="+i18n.HIDE_SECTION+">-</span><span class='sub-sec-title'>"+i18n.QM_COMPLETE+" (",recordData.OUTCOMES_COMPLETE.length,")</span></h3>");
ar.push("<div class='sub-sec-content'>");
ar.push("<dl class='qm-info'>");
if(recordData.OUTCOMES_COMPLETE.length>0){for(var k=0;
k<recordData.OUTCOMES_COMPLETE.length;
k++){var icon="";
if(recordData.OUTCOMES_COMPLETE[k].LAST_MET_IND==0){icn=loc+"\\images\\6376_16.png";
}else{if(recordData.OUTCOMES_COMPLETE[k].LAST_MET_IND==1){icn=loc+"\\images\\4022_16.png";
}}ar.push("<dl class='qm-info' onmouseover='CERN_QUALITY_MEASURES_O1.ShowIcon(this)' onmouseout='CERN_QUALITY_MEASURES_O1.HideIcon(this)'>");
ar.push("<dt>icon</dt><dd class='qm-cmp-icon'><img src='"+icn+"' /></dd>");
ar.push("<dt><span>measure</span></dt><dd class='qm-cmp-name'><span>"+recordData.OUTCOMES_COMPLETE[k].OUTCOME_NAME+"</span></dd>");
ar.push("<dt><span>measure</span></dt><dd class='qm-doc'><span class='cmp-doc' onclick='CERN_QUALITY_MEASURES_O1.OpenQMDoc("+recordData.OUTCOMES_COMPLETE[k].FORM_REF_ID+","+recordData.OUTCOMES_COMPLETE[k].FORM_ACT_ID+")'>&nbsp;</span></dd>");
ar.push("</dl>");
}}else{if(recordData.OUTCOMES_COMPLETE.length==0){ar.push("<span class='res-none'>",i18n.NO_RESULTS_FOUND,"</span>");
}}ar.push("</div></div></div></div>");
sHTML=ar.join("");
countText="("+totalOutcomes+")";
var compNS=component.getStyles().getNameSpace();
MP_Util.Doc.FinalizeComponent(sHTML,component,countText);
}catch(err){if(timerRenderComponent){timerRenderComponent.Abort();
timerRenderComponent=null;
}throw (err);
}finally{if(timerRenderComponent){timerRenderComponent.Stop();
}}},LoadCondition:function(id){var selected_condition=id.value;
var gid=document.getElementById("condID");
gid.className="qm-cond";
CERN_QUALITY_MEASURES_O1.GetQualityMeasuresTable(qmComponent,selected_condition);
},OpenQMDoc:function(formRefID,formActID){var criterion=qmComponent.getCriterion();
var paramString=criterion.person_id+"|"+criterion.encntr_id+"|"+formRefID+"|"+formActID+"|0";
MPAGES_EVENT("POWERFORM",paramString);
},ShowIcon:function(id){Util.Style.acss(id,"has-icon");
},HideIcon:function(id){Util.Style.rcss(id,"has-icon");
}};
}();

function DocumentListComponentStyle(){this.initByNamespace("document_list");
}DocumentListComponentStyle.inherits(ComponentStyle);
function DocumentListComponent(criterion){var enableResultLink=false;
var canAddInd=true;
this.setPlusAddEnabled(this.canAddInd);
this.setCriterion(criterion);
this.setStyles(new DocumentListComponentStyle());
this.setLabel(rcm_document_list_i18n.RCM_DOCUMENT_REVIEW);
this.setExpanded(true);
this.setIncludeLineNumber(true);
this.setScope(2);
DocumentListComponent.method("setResultLink",function(enableResultLink){this.enableResultLink=enableResultLink;
});
DocumentListComponent.method("HandleSuccess",function(recordData){var length=0;
var countText=0;
if(recordData){this.canAddInd=recordData.CANADDIND===1;
length=recordData.DOCUMENTREVIEWS.length;
}countText=MP_Util.CreateTitleText(this,length);
var scrollClass=MP_Util.GetContentClass(this,length);
var sHTML=DocumentList.renderList(this,recordData,this.enableResultLink,scrollClass);
MP_Util.Doc.FinalizeComponent(sHTML,this,countText);
if(!this.canAddInd){var addPlus=document.getElementById("document_listAdd");
if(addPlus){addPlus.style.display="none";
}}DocumentList.addListHover();
});
DocumentListComponent.method("InsertData",function(){var component=this;
var handler=function(RECORDDATA,successStatus,errorMessage){if("S"===successStatus){component.HandleSuccess(RECORDDATA);
}else{component.HandleSuccess(RECORDDATA);
if(component.criterion.encntr_id>0){DocumentList.openErrorDialog(errorMessage);
}}};
new GetDocumentReviewsByEncounterDelegate().get(this,this.criterion.encntr_id,handler);
});
DocumentListComponent.method("addNewReviewListener",function(newReviewListener){DocumentList.newReviewListeners.push(newReviewListener);
});
DocumentListComponent.method("addReviewSelectedListener",function(reviewSelectedListener){DocumentList.reviewSelectedListeners.push(reviewSelectedListener);
});
DocumentListComponent.method("openTab",function(recordData){DocumentList.newReview();
});
DocumentListComponent.method("isFirstTimeLoad",function(){return DocumentList.isFirstTimeLoad;
});
DocumentListComponent.method("setFirstTimeLoad",function(setFirstTimeLoad){DocumentList.setFirstTimeLoad(setFirstTimeLoad);
});
}DocumentListComponent.inherits(MPageComponent);

function GetDocumentReviewsByEncounterDelegate(){this.get=function(component,encntrId,callback,sendAr,async){var json={getDocumentReviewsReq:{encounterId:String(encntrId)}};
var sendAr=[];
sendAr.push("^MINE^","0.0","^GETRDOCUMENTEVIEWSBYENCOUNTER^","^"+JSON.stringify(json)+"^");
RCM_Clinical_Util.makeTimerCCLRequest(component,"rcm_document_review",sendAr,true,function(status,RECORDDATA,errorInfo){if("S"===status){callback(RECORDDATA,status);
}else{var alertMessage=[];
if(errorInfo&&errorInfo.length>0){alertMessage.push(errorInfo);
}if(RECORDDATA&&RECORDDATA.EXCEPTIONINFORMATION&&RECORDDATA.EXCEPTIONINFORMATION[0]){alertMessage.push(RECORDDATA.EXCEPTIONINFORMATION[0].DEBUGERRORMESSAGE);
}callback(RECORDDATA,status,alertMessage.join());
}});
};
}
var DocumentList=function(){return{renderList:function(component,recordData,enableResultLink,scrollClass){var jsHTML=[];
jsHTML.push("<div id='documentReviewListForm'>");
jsHTML.push("<div id='documentReviewErrorDialog' class='drvl-error-dialog'></div>");
var imagePath=component.getCriterion().static_content+"\\images\\";
var reviewCount=0;
if(component.criterion.encntr_id===0){jsHTML.push("<div>",rcm_document_list_i18n.RCM_INVALID_ENCOUNTER_MESSAGE,"</div>");
return jsHTML.join("");
}if(recordData){reviewCount=recordData.DOCUMENTREVIEWS.length;
}if(reviewCount===0){jsHTML.push("<div>",rcm_document_list_i18n.RCM_NO_DOCUMENT_MESSAGE,"</div>");
return jsHTML.join("");
}jsHTML.push("<div class='drvl-header'>");
jsHTML.push("<span class='drvl-header-col1'>",rcm_document_list_i18n.RCM_DATE,"</span>");
jsHTML.push("<span class='drvl-header-col2'>",rcm_document_list_i18n.RCM_TYPE,"</span>");
jsHTML.push("<span class='drvl-header-col3'>",rcm_document_list_i18n.RCM_STATUS_OUTCOME,"</span></div>");
jsHTML.push("<div id='documentReviewListTable' class='",scrollClass,"'>");
for(var review=0;
review<reviewCount;
review++){var docReview=recordData.DOCUMENTREVIEWS[review];
jsHTML.push("<div class='drvl-row'>");
jsHTML.push("<div class='drvl-row-col1'>");
if(enableResultLink){jsHTML.push("<a onclick='DocumentList.reviewSelected(",docReview.DOCUMENTREVIEWID,")'>");
}jsHTML.push(RCM_Clinical_Util.formatJsonDateString(docReview.REVIEWEDDATE),"</a></div>");
jsHTML.push("<span class='drvl-row-col2'>",docReview.DOCUMENTREVIEWTYPEDISPLAY,"</span>");
jsHTML.push("<span><div class='drvl-row-col3'>",docReview.DOCUMENTREVIEWSTATUSDISPLAY);
if(docReview.DOC_REVIEW_FOLLOWUP_ID&&docReview.DOC_REVIEW_FOLLOWUP_ID>0){jsHTML.push("<div id='toolTip",review,"' class='hvr'>");
jsHTML.push("<span class='drvl-hvr-info-lbl'>",rcm_document_list_i18n.RCM_COMMUNICATION_TYPE,":&nbsp;</span>");
jsHTML.push("<span class='drvl-hvr-info-val'>",docReview.COMMUNICATIONTYPEDISPLAY,"</span><br>");
jsHTML.push("<span class='drvl-hvr-info-lbl'>",rcm_document_list_i18n.RCM_REVIEWER,":&nbsp;</span>");
if(docReview.FOLLOWUP_MSG_CENTER.RECIPIENTS.length>0){jsHTML.push("<span class='drvl-hvr-info-val'>",docReview.FOLLOWUP_MSG_CENTER.RECIPIENTS[0].ENTITYNAME,"</span><br>");
}else{jsHTML.push("<span class='drvl-hvr-info-val'>",docReview.FOLLOWUPPRSNLNAME,"</span><br>");
}jsHTML.push("<span class='drvl-hvr-info-lbl'>",rcm_document_list_i18n.RCM_EXPECT_RESPONSE,":&nbsp;</span>");
jsHTML.push("<span class='drvl-hvr-info-val'>",RCM_Clinical_Util.formatJsonDateString(docReview.EXPECTEDRESPONSEDTTM),"</span><br>");
if(docReview.ACTUALRESPONSEDTTM&&docReview.ACTUALRESPONSEDTTM.length>0){jsHTML.push("<span class='drvl-hvr-info-lbl'>",rcm_document_list_i18n.RCM_ACTUAL_RESPONSE,":&nbsp;</span>");
jsHTML.push("<span class='drvl-hvr-info-val'>",RCM_Clinical_Util.formatJsonDateString(docReview.ACTUALRESPONSEDTTM),"</span>");
}jsHTML.push("</div>");
}jsHTML.push("</div></span>");
jsHTML.push("</div>");
}jsHTML.push("<div class='drvl-height-adj'></div></div>");
return sHTML=jsHTML.join("");
},addListHover:function(){var docReviewRows=$(".drvl-row-col3");
for(var row=0,rowCount=docReviewRows.length;
row<rowCount;
row++){var hvrParent=docReviewRows[row];
var hvrChild=document.getElementById("toolTip"+row);
if(hvrChild){hs(hvrParent,hvrChild);
}}},populateErrorDialog:function(errorMessage){var jsHTML=[];
jsHTML.push("<div class='drvl-error-title-bar'>");
jsHTML.push("<label>",rcm_document_list_i18n.RCM_RETRIEVE_DOCUMENT_REVIEWS_FAILED,"</label></div>");
jsHTML.push("<div class='drvl-error-message-area'>");
jsHTML.push("<label id='documentReviewErrorMessage'>",errorMessage,"</label>");
jsHTML.push("</div>");
jsHTML.push("<div class='drvl-error-dialog-buttons'>");
jsHTML.push("<input type='button' value='",rcm_document_list_i18n.RCM_OK,"' onclick='DocumentList.closeErrorDialog()'/>");
jsHTML.push("</div>");
return jsHTML.join("");
},openErrorDialog:function(errorMessage){$("#documentReviewErrorDialog").html(this.populateErrorDialog(errorMessage));
var position=$("#documentReviewListForm").offset();
var pos={x:0,y:0};
pos.x=position.left+"px";
pos.y=position.top+"px";
$("#documentReviewErrorDialog").css("left",pos.x);
$("#documentReviewErrorDialog").css("top",pos.y);
$("#documentReviewErrorDialog").show();
$(document.body).append($("#documentReviewErrorDialog"));
},closeErrorDialog:function(){$("#documentReviewErrorDialog").hide();
},reviewSelectedListeners:[],reviewSelected:function(reviewId){for(var listener=0,length=this.reviewSelectedListeners.length;
listener<length;
listener++){this.reviewSelectedListeners[listener](reviewId);
}},newReviewListeners:[],newReview:function(){for(var listener=0,length=this.newReviewListeners.length;
listener<length;
listener++){this.newReviewListeners[listener]();
}},isFirstTimeLoad:true,setFirstTimeLoad:function(setFirstTimeLoad){this.isFirstTimeLoad=setFirstTimeLoad;
}};
}();

var RcmUtilizationManagementController=function(){var RECORDDATA;
var component;
var viewer;
var drgSearchControl;
return{cancelListeners:[],modifyListeners:[],modifyDialog:null,modifyDialogLabelNameMap:{umStatusModify:"umStatus",clinicalReviewDateModify:"clinicalReviewDate",dischargePlanStatusModify:"dischargePlanStatus",dischargePlanDueDateModify:"dischargePlanDueDate",docReviewStatusModify:"docReviewStatus",docReviewDateModify:"docReviewDate",drgModify:"drg"},saveListeners:[],cancelDialog:function(cancelButton){cancelButton.disabled=true;
var displayLabelName=this.modifyDialogLabelNameMap[this.modifyDialog.id];
var displayLabel=document.getElementById(displayLabelName);
if(this.modifyDialog){this.closeDialog(displayLabel);
}},closeErrorDialog:function(){$("#umErrorDialog").hide();
RcmUtilizationManagementController.notifySaveListeners();
},cancelErrorDialog:function(){$("#umErrorDialog").hide();
},closeDialog:function(displayLabel){if(displayLabel){displayLabel.style.backgroundColor="transparent";
displayLabel.style.border="";
}if(this.modifyDialog){this.modifyDialog.innerHTML="";
this.modifyDialog.style.display="none";
this.modifyDialog=null;
}},dischargePlanStatusDropDownListener:function(){},docStatusDropDownListener:function(){},drgRadioListener:function(){if($("#careMgmtDrgRadioSearch").attr("checked")){$("#drgSearch").removeAttr("disabled");
}else{$("#drgSearch").attr("disabled","disabled");
}},finalizeRetrieveView:function(component,RECORDDATA,viewer){this.RECORDDATA=RECORDDATA;
this.component=component;
this.viewer=viewer;
var warningIcon=document.getElementById("multipleDrgWarningIcon");
if(warningIcon){var hoverText=document.getElementById("multipleDrgWarningHover");
RCM_Clinical_Util.hs(warningIcon,hoverText);
}var rePositionModifyDialog=function(){if(RcmUtilizationManagementController.modifyDialog){var labelName=RcmUtilizationManagementController.modifyDialogLabelNameMap[RcmUtilizationManagementController.modifyDialog.id];
var label=document.getElementById(labelName);
var position=RcmUtilizationManagementController.getPosition(label);
var modifyDialogHeight=RcmUtilizationManagementController.modifyDialog.offsetHeight;
var maximumHeight=document.documentElement.clientHeight-modifyDialogHeight;
if(position.y<0){position.y=0;
}else{if(position.y>maximumHeight){position.y=maximumHeight;
}}var modifyDialogWidth=RcmUtilizationManagementController.modifyDialog.offsetWidth;
var maximumWidth=document.documentElement.clientWidth-modifyDialogWidth;
if(position.x<0){position.x=0;
}else{if(position.x>maximumWidth){position.x=maximumWidth;
}}RcmUtilizationManagementController.modifyDialog.style.top=position.y+"px";
RcmUtilizationManagementController.modifyDialog.style.left=position.x+"px";
}};
var columnOne=$(".col1");
if(columnOne&&columnOne.length===1){columnOne.scroll(rePositionModifyDialog);
columnOne.resize(rePositionModifyDialog);
}var columnTwo=$(".col2");
if(columnTwo&&columnTwo.length===1){columnTwo.scroll(rePositionModifyDialog);
columnTwo.resize(rePositionModifyDialog);
}},formatDateString:function(dateString){var formattedString=[];
if(dateString&&dateString!==""){var date=new Date(dateString);
formattedString.push(date.format("dd-mmm-yyyy"));
formattedString.push(" 00:00:00");
}return formattedString.join("");
},getPosition:function(displayLabel){var position=$(displayLabel).offset();
var cursor={x:0,y:0};
cursor.x=position.left;
cursor.y=position.top+$(displayLabel).height()+3;
return cursor;
},getCareMgmtDRGModel:function(RECORDDATA){var careMgmtDRG={sourceIdent:"",description:"",id:"",finalIndicator:0,modifiableIndicator:0,transferDRG:0,elos:0,contributorSystem:""};
if(RECORDDATA&&RECORDDATA.DIAGNOSISRELATEDGROUPS){for(var i=0;
i<RECORDDATA.DIAGNOSISRELATEDGROUPS.length;
i++){if(RECORDDATA.DIAGNOSISRELATEDGROUPS[i].CMWORKINGDRGIND){careMgmtDRG.sourceIdent=RECORDDATA.DIAGNOSISRELATEDGROUPS[i].SOURCEIDENTIFIER;
careMgmtDRG.description=RECORDDATA.DIAGNOSISRELATEDGROUPS[i].DESCRIPTION;
careMgmtDRG.id=RECORDDATA.DIAGNOSISRELATEDGROUPS[i].ID;
careMgmtDRG.finalIndicator=RECORDDATA.DIAGNOSISRELATEDGROUPS[i].FINALINDICATOR;
careMgmtDRG.modifiableIndicator=RECORDDATA.DIAGNOSISRELATEDGROUPS[i].MODIFIABLEINDICATOR;
careMgmtDRG.transferDRG=RECORDDATA.DIAGNOSISRELATEDGROUPS[i].TRANSFERRULEINDICATOR;
careMgmtDRG.elos=RECORDDATA.DIAGNOSISRELATEDGROUPS[i].ESTIMATEDLENGTHOFSTAYINHOURS;
careMgmtDRG.contributorSystem=RECORDDATA.DIAGNOSISRELATEDGROUPS[i].CONTRIBUTORSYSTEM;
break;
}}}return careMgmtDRG;
},getModifyDialogNameByLabel:function(labelId){for(var modifyDialogId in this.modifyDialogLabelNameMap){if(this.modifyDialogLabelNameMap[modifyDialogId]===labelId){return modifyDialogId;
}}return null;
},getOtherDRGModel:function(RECORDDATA){var himDRG={sourceIdent:"",description:"",id:"",finalIndicator:0,modifiableIndicator:0,transferDRG:0,elos:0,contributorSystem:""};
if(RECORDDATA&&RECORDDATA.DIAGNOSISRELATEDGROUPS){for(var i=0;
i<RECORDDATA.DIAGNOSISRELATEDGROUPS.length;
i++){if(!RECORDDATA.DIAGNOSISRELATEDGROUPS[i].CMWORKINGDRGIND){himDRG.sourceIdent=RECORDDATA.DIAGNOSISRELATEDGROUPS[i].SOURCEIDENTIFIER;
himDRG.description=RECORDDATA.DIAGNOSISRELATEDGROUPS[i].DESCRIPTION;
himDRG.id=RECORDDATA.DIAGNOSISRELATEDGROUPS[i].ID;
himDRG.finalIndicator=RECORDDATA.DIAGNOSISRELATEDGROUPS[i].FINALINDICATOR;
himDRG.modifiableIndicator=RECORDDATA.DIAGNOSISRELATEDGROUPS[i].MODIFIABLEINDICATOR;
himDRG.transferDRG=RECORDDATA.DIAGNOSISRELATEDGROUPS[i].TRANSFERRULEINDICATOR;
himDRG.elos=RECORDDATA.DIAGNOSISRELATEDGROUPS[i].ESTIMATEDLENGTHOFSTAYINHOURS;
himDRG.contributorSystem=RECORDDATA.DIAGNOSISRELATEDGROUPS[i].CONTRIBUTORSYSTEM;
break;
}}}return himDRG;
},handleOver:function(displayLabel){if(this.isModifiable(displayLabel)){displayLabel.style.border="dashed 1px #3797FE";
displayLabel.style.cursor="hand";
}},handleOut:function(displayLabel){if(this.isModifiable(displayLabel)){displayLabel.style.border="";
}},isModifiable:function(displayLabel){var componentModifiableIndicator=this.component.enableModifyButton;
if(displayLabel&&displayLabel.id==="drg"){if(this.RECORDDATA&&this.RECORDDATA.DIAGNOSISRELATEDGROUPS){var careMgmtDrgId;
var careMgmtModifiableIndicator;
var himFinalIndicator;
for(var i=0;
i<this.RECORDDATA.DIAGNOSISRELATEDGROUPS.length;
i++){if(this.RECORDDATA.DIAGNOSISRELATEDGROUPS[i].CMWORKINGDRGIND){careMgmtDrgId=this.RECORDDATA.DIAGNOSISRELATEDGROUPS[i].ID;
careMgmtModifiableIndicator=this.RECORDDATA.DIAGNOSISRELATEDGROUPS[i].MODIFIABLEINDICATOR;
}else{himFinalIndicator=this.RECORDDATA.DIAGNOSISRELATEDGROUPS[i].FINALINDICATOR;
}}}return componentModifiableIndicator&&this.RECORDDATA.TASKSECURITYMODIFY&&(!himFinalIndicator&&(careMgmtModifiableIndicator||!careMgmtDrgId));
}else{if(displayLabel&&displayLabel.id==="docReviewStatus"||displayLabel.id==="docReviewDate"){return componentModifiableIndicator&&this.RECORDDATA.TASKSECURITYMODIFY&&this.RECORDDATA.DOCUMENTREVIEWTASKSECURITY;
}else{if(displayLabel&&(displayLabel.id==="dischargePlanDueDate"||displayLabel.id==="dischargePlanStatus")){if(this.RECORDDATA){return componentModifiableIndicator&&(this.RECORDDATA.DISCHARGETASKSECURITY===1);
}}}}return componentModifiableIndicator&&this.RECORDDATA.TASKSECURITYMODIFY;
},notifySaveListeners:function(){for(var listener=0,length=this.saveListeners.length;
listener<length;
listener++){this.saveListeners[listener]();
}},notifyCancelListeners:function(){for(var listener=0,length=this.cancelListeners.length;
listener<length;
listener++){this.cancelListeners[listener]();
}},openDialog:function(displayLabel,event){if(displayLabel&&this.isModifiable(displayLabel)){if(this.modifyDialog){var prevDisplayLabelName=this.modifyDialogLabelNameMap[this.modifyDialog.id];
var prevDisplayLabel=document.getElementById(prevDisplayLabelName);
this.closeDialog(prevDisplayLabel);
}displayLabel.style.backgroundColor="#F3F6FD";
displayLabel.style.border="solid 3px #3797FE";
var modifyDialogId=this.getModifyDialogNameByLabel(displayLabel.id);
this.modifyDialog=document.getElementById(modifyDialogId);
this.modifyDialog.innerHTML=this.viewer.populateModifyDialogHTML(modifyDialogId,this.RECORDDATA);
var pos=this.getPosition(displayLabel);
this.modifyDialog.style.top=pos.y+"px";
this.modifyDialog.style.left=pos.x+"px";
this.modifyDialog.style.display="block";
document.body.appendChild(this.modifyDialog);
if(modifyDialogId==="clinicalReviewDateModify"){RCM_Clinical_Util.addDatePicker(this.component,"clinicalReviewDatePicker");
RCM_Clinical_Util.setDateString("clinicalReviewDatePicker",this.RECORDDATA.CLINICALREVIEWDUEDATETIME);
}if(modifyDialogId==="dischargePlanDueDateModify"){RCM_Clinical_Util.addDatePicker(this.component,"dischargePlanDueDatePicker");
RCM_Clinical_Util.setDateString("dischargePlanDueDatePicker",this.RECORDDATA.DISCHARGEPLANDUEDATETIME);
}if(modifyDialogId==="drgModify"){$("input:radio[name='drgRadio']").first().attr("checked",true);
this.drgRadioListener();
drgSearchControl=new DrgSearchControl(document.getElementById("drgSearch"));
drgSearchControl.setSelectedDRG(true,document.getElementById("drgSearch").value);
}if(modifyDialogId==="docReviewDateModify"){RCM_Clinical_Util.addDatePicker(this.component,"documentReviewDatePicker");
RCM_Clinical_Util.setDateString("documentReviewDatePicker",this.RECORDDATA.DOCUMENTREVIEWDUEDATETIME);
}}},openErrorDialog:function(labelMessage,errorMessage){var leftPos=($("#um-form-container").width()-350)/2;
var topPos=($("#um-form-container").height()-150)/2;
$("#umErrorDialog").css("left",leftPos>0?leftPos:50);
$("#umErrorDialog").css("top",topPos>0?topPos:50);
$("#umErrorDialog").html(this.viewer.populateErrorDialog(labelMessage,errorMessage));
$("#umErrorDialog").show();
},retrieveData:function(component,loadCodeSetsIndicator){var encounterId=component.criterion.encntr_id;
new GetUtilizationMgmtServiceDelegate().retrieveCall(component,encounterId,loadCodeSetsIndicator,function(RECORDDATA,errorMessage){if(RECORDDATA&&"S"===RECORDDATA.STATUS_DATA.STATUS){component.HandleSuccess(RECORDDATA);
}else{component.HandleSuccess(RECORDDATA);
if(encounterId>0){RcmUtilizationManagementController.openErrorDialog(rcm_utilization_management_i18n.RCM_RETRIEVE_CARE_MANAGEMENT_FAILED,errorMessage);
}}});
},saveDialog:function(saveButton){saveButton.disabled=true;
if(this.modifyDialog){var displayLabelName=this.modifyDialogLabelNameMap[this.modifyDialog.id];
var displayLabel=document.getElementById(displayLabelName);
if(this.modifyDialog.id==="umStatusModify"){var selectControl=document.getElementById("umStatusDropDown");
var selectedDisplay=selectControl[selectControl.selectedIndex].text;
var selectedValue=selectControl[selectControl.selectedIndex].value;
displayLabel.innerHTML=selectedDisplay?selectedDisplay:rcm_utilization_management_i18n.RCM_NOT_AVAILABLE;
displayLabel.value=selectedValue;
var statusCdLabel=displayLabel;
}if(this.modifyDialog.id==="dischargePlanStatusModify"){var selectControl=document.getElementById("dischargePlanStatusDropDown");
var selectedDisplay=selectControl[selectControl.selectedIndex].text;
var selectedValue=selectControl[selectControl.selectedIndex].value;
displayLabel.innerHTML=selectedDisplay?selectedDisplay:rcm_utilization_management_i18n.RCM_NOT_AVAILABLE;
displayLabel.value=selectedValue;
var dpStatusCdLabel=displayLabel;
}if(this.modifyDialog.id==="clinicalReviewDateModify"){var selectControl=document.getElementById("clinicalReviewDatePicker");
var selectedValue=selectControl.value;
displayLabel.innerHTML=selectedValue?selectedValue:rcm_utilization_management_i18n.RCM_NOT_AVAILABLE;
displayLabel.value=selectedValue;
var clinicalReviewDateLabel=displayLabel;
}if(this.modifyDialog.id==="dischargePlanDueDateModify"){var selectControl=document.getElementById("dischargePlanDueDatePicker");
var selectedValue=selectControl.value;
displayLabel.innerHTML=selectedValue?selectedValue:rcm_utilization_management_i18n.RCM_NOT_AVAILABLE;
displayLabel.value=selectedValue;
var dischargePlanDueDateLabel=displayLabel;
}if(this.modifyDialog.id==="docReviewStatusModify"){var selectControl=document.getElementById("docStatusDropDown");
var selectedDisplay=selectControl[selectControl.selectedIndex].text;
var selectedValue=selectControl[selectControl.selectedIndex].value;
displayLabel.innerHTML=selectedDisplay?selectedDisplay:rcm_utilization_management_i18n.RCM_NOT_AVAILABLE;
displayLabel.value=selectedValue;
var docReviewStatusCdLabel=displayLabel;
}if(this.modifyDialog.id==="docReviewDateModify"){var selectControl=document.getElementById("documentReviewDatePicker");
var selectedValue=selectControl.value;
displayLabel.innerHTML=selectedValue?selectedValue:rcm_utilization_management_i18n.RCM_NOT_AVAILABLE;
displayLabel.value=selectedValue;
var docReviewDateLabel=displayLabel;
}if(this.modifyDialog.id==="drgModify"){var careMgmtDRG=this.getCareMgmtDRGModel(this.RECORDDATA);
var himDRG=this.getOtherDRGModel(this.RECORDDATA);
var radioButtons=$("input:radio[name='drgRadio']");
var selectedRadio;
$.each(radioButtons,function(index,radio){if($(radio).attr("checked")){selectedRadio=radio;
}});
var drgJson;
if(selectedRadio.id==="careMgmtDrgRadioSearch"){var drgSearchText=document.getElementById("drgSearch");
var selectedDRG=drgSearchControl.getSelectedDRG();
if(selectedDRG){drgJson=[{id:careMgmtDRG.id,nomenclatureId:selectedDRG.NOMENCLATUREID,sourceIdentifier:selectedDRG.SOURCEIDENTIFIER}];
displayLabel.innerHTML=drgSearchText.value;
}else{if(careMgmtDRG.id&&!drgSearchText.value){displayLabel.innerHTML=rcm_utilization_management_i18n.RCM_NOT_AVAILABLE;
drgJson=[{id:careMgmtDRG.id,nomenclatureId:"",sourceIdentifier:""}];
}}}else{if(selectedRadio.id==="himDrgSelect"){displayLabel.innerHTML=himDRG.description+" ("+himDRG.sourceIdent+")";
if(careMgmtDRG.id){drgJson=[{id:careMgmtDRG.id,nomenclatureId:"",sourceIdentifier:""}];
}else{drgJson=[{id:"",nomenclatureId:"",sourceIdentifier:""}];
}}}var drgLabel=displayLabel;
}var json={um_request:{encounterId:this.RECORDDATA.ENCOUNTERID,version:this.RECORDDATA.VERSION,patientId:this.RECORDDATA.PATIENTID,_utilizationMgmtStatusCd:statusCdLabel?1:0,utilizationMgmtStatusCd:statusCdLabel?String(statusCdLabel.value):"",_clinicalReviewDueDateTime:clinicalReviewDateLabel?1:0,clinicalReviewDueDateTime:clinicalReviewDateLabel?this.formatDateString(clinicalReviewDateLabel.value):"",_dischargePlanStatusCd:dpStatusCdLabel?1:0,dischargePlanStatusCd:dpStatusCdLabel?String(dpStatusCdLabel.value):"",_dischargePlanDueDateTime:dischargePlanDueDateLabel?1:0,dischargePlanDueDateTime:dischargePlanDueDateLabel?this.formatDateString(dischargePlanDueDateLabel.value):"",drg:drgJson?drgJson:[],_documentReviewStatusCd:docReviewStatusCdLabel?1:0,documentReviewStatusCd:docReviewStatusCdLabel?String(docReviewStatusCdLabel.value):"",_documentReviewDueDateTime:docReviewDateLabel?1:0,documentReviewDueDateTime:docReviewDateLabel?this.formatDateString(docReviewDateLabel.value):""}};
new ModifyUtilizationMgmtServiceDelegate().modifyCall(this.component,json,function(RECORDDATA,errorMessage){if(RECORDDATA&&"S"===RECORDDATA.STATUS_DATA.STATUS){RcmUtilizationManagementController.notifySaveListeners();
RcmUtilizationManagementController.closeDialog(displayLabel);
}else{if(RECORDDATA){RcmUtilizationManagementController.closeDialog(displayLabel);
RcmUtilizationManagementController.openErrorDialog(rcm_utilization_management_i18n.RCM_MODIFY_CARE_MANAGEMENT_FAILED,errorMessage);
}}});
}},umStatusDropDownListener:function(){}};
}();

function UtilizationManagementRetrieveComponentStyle(){this.initByNamespace("utilization_management_retrieve");
}UtilizationManagementRetrieveComponentStyle.inherits(ComponentStyle);
function UtilizationManagementRetrieveComponent(criterion){this.criterion=criterion;
this.setCriterion(criterion);
this.setStyles(new UtilizationManagementRetrieveComponentStyle());
this.setLabel(i18n.RCM_CARE_MANAGEMENT);
this.setExpanded(true);
this.setIncludeLineNumber(true);
this.setComponentLoadTimerName("USR:MPG.UtilizationMgmtRetrieve");
this.enableModifyButton=true;
this.setScope(2);
UtilizationManagementRetrieveComponent.method("enableModify",function(enableModifyButton){this.enableModifyButton=enableModifyButton;
});
UtilizationManagementRetrieveComponent.method("setDocumentReviewFields",function(showDocRevFields){this.showDocRevFields=showDocRevFields;
});
UtilizationManagementRetrieveComponent.method("InsertData",function(){RcmUtilizationManagementController.retrieveData(this,1);
});
UtilizationManagementRetrieveComponent.method("HandleSuccess",function(RECORDDATA){var viewer=new RcmUtilizationManagementView();
var componentHtml=viewer.renderRetrieve(this,RECORDDATA);
MP_Util.Doc.FinalizeComponent(componentHtml,this,"");
RcmUtilizationManagementController.finalizeRetrieveView(this,RECORDDATA,viewer);
});
UtilizationManagementRetrieveComponent.method("addModifyListener",function(modifyListener){RcmUtilizationManagementController.modifyListeners.push(modifyListener);
});
UtilizationManagementRetrieveComponent.method("addSaveListener",function(saveListener){RcmUtilizationManagementController.saveListeners.push(saveListener);
});
}UtilizationManagementRetrieveComponent.inherits(MPageComponent);

var RcmUtilizationManagementView=function(){var careMgmtDRG;
var himDRG;
return{renderRetrieve:function(component,RECORDDATA){var retrieveForm=document.getElementById("um-form-container");
if(retrieveForm){retrieveForm.parentNode.removeChild(retrieveForm);
}if(component.criterion.encntr_id===0){var jsHTML=[];
jsHTML.push("<div>",rcm_utilization_management_i18n.RCM_INVALID_ENCOUNTER_MESSAGE,"</div>");
return jsHTML.join("");
}var los_days=0;
var rounding_hours=0;
var elos_days=0;
if(RECORDDATA&&RECORDDATA.LENGTHOFSTAYINHOURS){los_days=RECORDDATA.LENGTHOFSTAYINHOURS/24;
if(los_days%1>0){rounding_hours=(los_days-Math.floor(los_days))*24;
}}var imagePath=component.getCriterion().static_content+"\\images\\";
var transferDrgIcon=imagePath+"6405_16.png";
var multipleDrgWarningIcon=imagePath+"6047_16.png";
careMgmtDRG=RcmUtilizationManagementController.getCareMgmtDRGModel(RECORDDATA);
himDRG=RcmUtilizationManagementController.getOtherDRGModel(RECORDDATA);
var drgDescription;
var sourceIdent;
var finalIndicator;
var transferDRG;
if(careMgmtDRG&&careMgmtDRG.sourceIdent.length>0&&!himDRG.finalIndicator){sourceIdent=careMgmtDRG.sourceIdent;
drgDescription=careMgmtDRG.description;
transferDRG=careMgmtDRG.transferDRG;
}else{if(himDRG&&himDRG.sourceIdent.length>0){sourceIdent=himDRG.sourceIdent;
drgDescription=himDRG.description;
finalIndicator=himDRG.finalIndicator;
transferDRG=himDRG.transferDRG;
}}var red="rgb(240, 131, 131)";
var grey="rgb(238,237,237)";
var blue="rgb(134,164,205)";
var percentage;
var showPercentageBar=false;
var elos_days=careMgmtDRG.elos>0?careMgmtDRG.elos/24:himDRG.elos/24;
var barBackgroundColor;
var percentBackgroundColor;
if(elos_days!==0&&los_days!==0){elos_days=elos_days%1>=0.5?Math.ceil(elos_days):Math.floor(elos_days);
showPercentageBar=true;
if(los_days<=elos_days){percentage=100*los_days/elos_days;
percentBackgroundColor=blue;
barBackgroundColor=grey;
}else{percentage=100*elos_days/los_days;
percentBackgroundColor=blue;
barBackgroundColor=red;
}}else{if(los_days===0&&elos_days!==0){showPercentageBar=true;
percentage=0;
percentBackgroundColor=blue;
barBackgroundColor=grey;
}else{showPercentageBar=false;
}}var jsHTML=[];
jsHTML.push("<div id='um-form-container'>");
jsHTML.push("<div id='umErrorDialog' class='um-error-dialog'>");
jsHTML.push("</div>");
jsHTML.push("<table class='um-table-container' id='careManagement'>");
jsHTML.push("<th>","</th>");
jsHTML.push("<th>","</th>");
jsHTML.push("<tr>");
jsHTML.push("<td class='um-table-lable'>",rcm_utilization_management_i18n.RCM_LOS_ELOS,":</td>");
jsHTML.push("<td class='um-table-value'>");
if(showPercentageBar){jsHTML.push("<div id='losElosPercentageBar' style='background-color:",barBackgroundColor,";width:60%;height:11px;border:1px;border-top-color:#999999'>");
jsHTML.push("<div id='losElosPercentage' style='background-color:",percentBackgroundColor,";width:",percentage,"%;height:100%;'>");
jsHTML.push("</div>");
jsHTML.push("</div>");
}jsHTML.push("</td>");
jsHTML.push("</tr>");
jsHTML.push("<tr>");
jsHTML.push("<td class='um-table-lable'>","","</td>");
jsHTML.push("<td class='um-table-value'>");
jsHTML.push(Math.floor(los_days),"&nbsp;<span class='um-progressBar-labels'>days</span>&nbsp;");
if(rounding_hours>0){if(rounding_hours%1>=0.5){jsHTML.push(Math.ceil(rounding_hours),"&nbsp;<span class='um-progressBar-labels'>hrs</span>");
}else{jsHTML.push(Math.floor(rounding_hours),"&nbsp;<span class='um-progressBar-labels'>hrs</span>");
}}jsHTML.push("&nbsp;/&nbsp;");
jsHTML.push(elos_days,"&nbsp;<span class='um-progressBar-labels'>days</span>");
jsHTML.push("</td></tr>");
jsHTML.push("<tr>");
jsHTML.push("<td class='um-table-lable'>",rcm_utilization_management_i18n.RCM_UM_STATUS,":</td>");
jsHTML.push("<td class='um-table-value'>","<span id='umStatus' value='",RECORDDATA.UTILIZATIONMGMTSTATUSDISP,"' onMouseOver='RcmUtilizationManagementController.handleOver(this)' onMouseout='RcmUtilizationManagementController.handleOut(this)'"," OnClick='RcmUtilizationManagementController.openDialog(this,event)'>",RECORDDATA.UTILIZATIONMGMTSTATUSDISP?RECORDDATA.UTILIZATIONMGMTSTATUSDISP:rcm_utilization_management_i18n.RCM_NOT_AVAILABLE,"</span></td>");
jsHTML.push("<div id='umStatusModify' class='um-modify-dialog'>");
jsHTML.push("</div>");
jsHTML.push("</tr>");
jsHTML.push("<tr>");
jsHTML.push("<td class='um-table-lable'>",rcm_utilization_management_i18n.RCM_NEXT_CLINICAL_REVIEW,":</td>");
var clinicalReviewDateValue=RCM_Clinical_Util.formatJsonDateString(RECORDDATA.CLINICALREVIEWDUEDATETIME);
jsHTML.push("<td class='um-table-value'>","<span id='clinicalReviewDate' value='",clinicalReviewDateValue,"' onMouseOver='RcmUtilizationManagementController.handleOver(this)' onMouseout='RcmUtilizationManagementController.handleOut(this)'","' onclick='RcmUtilizationManagementController.openDialog(this,event)'>",clinicalReviewDateValue?clinicalReviewDateValue:rcm_utilization_management_i18n.RCM_NOT_AVAILABLE,"</span></td>");
jsHTML.push("<div id='clinicalReviewDateModify' class='um-modify-dialog'>");
jsHTML.push("</div>");
jsHTML.push("</tr>");
jsHTML.push("<tr>");
jsHTML.push("<td class='um-table-lable'>",rcm_utilization_management_i18n.RCM_DISCHARGE_PLAN_STATUS,":</td>");
jsHTML.push("<td class='um-table-value'>","<span id='dischargePlanStatus' value='",RECORDDATA.DISCHARGEPLANSTATUSDISP,"' onMouseOver='RcmUtilizationManagementController.handleOver(this)' onMouseout='RcmUtilizationManagementController.handleOut(this)'","' onclick='RcmUtilizationManagementController.openDialog(this,event)'>",RECORDDATA.DISCHARGEPLANSTATUSDISP?RECORDDATA.DISCHARGEPLANSTATUSDISP:rcm_utilization_management_i18n.RCM_NOT_AVAILABLE,"</span></td>");
jsHTML.push("<div id='dischargePlanStatusModify' class='um-modify-dialog'>");
jsHTML.push("</div>");
jsHTML.push("</tr>");
jsHTML.push("<tr>");
jsHTML.push("<td class='um-table-lable'>",rcm_utilization_management_i18n.RCM_DISCHARGE_PLAN_DUE,":</td>");
var dischargePlanDueDateValue=RCM_Clinical_Util.formatJsonDateString(RECORDDATA.DISCHARGEPLANDUEDATETIME);
jsHTML.push("<td class='um-table-value'>","<span id='dischargePlanDueDate' value='",dischargePlanDueDateValue,"' onMouseOver='RcmUtilizationManagementController.handleOver(this)' onMouseout='RcmUtilizationManagementController.handleOut(this)'","' onclick='RcmUtilizationManagementController.openDialog(this,event)'>",dischargePlanDueDateValue?dischargePlanDueDateValue:rcm_utilization_management_i18n.RCM_NOT_AVAILABLE,"</span></td>");
jsHTML.push("<div id='dischargePlanDueDateModify' class='um-modify-dialog'>");
jsHTML.push("</div>");
jsHTML.push("</tr>");
if(component.showDocRevFields){jsHTML.push("<tr>");
jsHTML.push("<td class='um-table-lable'>",rcm_utilization_management_i18n.RCM_DOC_REVIEW_STATUS,":</td>");
jsHTML.push("<td class='um-table-value'>","<span id='docReviewStatus' value='",RECORDDATA.DOCUMENTREVIEWSTATUSDISP,"' onMouseOver='RcmUtilizationManagementController.handleOver(this)' onMouseout='RcmUtilizationManagementController.handleOut(this)'","' onclick='RcmUtilizationManagementController.openDialog(this,event)'>",RECORDDATA.DOCUMENTREVIEWSTATUSDISP?RECORDDATA.DOCUMENTREVIEWSTATUSDISP:rcm_utilization_management_i18n.RCM_NOT_AVAILABLE,"</span></td>");
jsHTML.push("<div id='docReviewStatusModify' class='um-modify-dialog'>");
jsHTML.push("</div>");
jsHTML.push("</tr>");
jsHTML.push("<tr>");
jsHTML.push("<td class='um-table-lable'>",rcm_utilization_management_i18n.RCM_NEXT_DOC_REVIEW,":</td>");
var docReviewDate=RCM_Clinical_Util.formatJsonDateString(RECORDDATA.DOCUMENTREVIEWDUEDATETIME);
jsHTML.push("<td class='um-table-value'>","<span id='docReviewDate' value='",docReviewDate,"' onMouseOver='RcmUtilizationManagementController.handleOver(this)' onMouseout='RcmUtilizationManagementController.handleOut(this)'","' onclick='RcmUtilizationManagementController.openDialog(this,event)'>",docReviewDate?docReviewDate:rcm_utilization_management_i18n.RCM_NOT_AVAILABLE,"</span></td>");
jsHTML.push("<div id='docReviewDateModify' class='um-modify-dialog'>");
jsHTML.push("</div>");
jsHTML.push("</tr>");
}jsHTML.push("<tr>");
jsHTML.push("<td class='um-table-lable'>");
jsHTML.push(finalIndicator?rcm_utilization_management_i18n.RCM_FINAL_DRG:rcm_utilization_management_i18n.RCM_WORKING_DRG);
jsHTML.push(":</td>");
jsHTML.push("<td class='um-table-value'>");
jsHTML.push("<span id='drg' onclick='RcmUtilizationManagementController.openDialog(this,event)'"," onMouseOver='RcmUtilizationManagementController.handleOver(this)' onMouseout='RcmUtilizationManagementController.handleOut(this)'>");
if(RECORDDATA.DIFFERINGWORKINGDRGIND===1&&(careMgmtDRG.sourceIdent&&himDRG.sourceIdent&&careMgmtDRG.sourceIdent!==himDRG.sourceIdent&&himDRG.finalIndicator!==1)){jsHTML.push("<img id='multipleDrgWarningIcon' src='",multipleDrgWarningIcon,"' alt=''/>");
jsHTML.push("<div id='multipleDrgWarningHover' class='hvr'>");
jsHTML.push("<dt>",rcm_utilization_management_i18n.RCM_MULT_WORKING_DRG_WARNING,"</dt>");
jsHTML.push("</div>");
}if(transferDRG){jsHTML.push("<img src='",transferDrgIcon,"' alt=''/>");
}var drgDisplayString=drgDescription?drgDescription:null+sourceIdent?" ("+sourceIdent+")":null;
jsHTML.push(drgDisplayString?drgDisplayString:rcm_utilization_management_i18n.RCM_NOT_AVAILABLE);
jsHTML.push("<span class='um-workingDrg-number'>&nbsp;");
jsHTML.push(sourceIdent?"("+sourceIdent+")":"");
jsHTML.push("</span>");
jsHTML.push("</span>");
jsHTML.push("</td>");
jsHTML.push("<div id='drgModify' class='um-modify-dialog'>");
jsHTML.push("</div>");
jsHTML.push("</tr>");
jsHTML.push("</table>");
jsHTML.push("<div class='um-float-break'></div>");
jsHTML.push("</div>");
return jsHTML.join("");
},populateErrorDialog:function(labelMessage,errorMessage){var jsHTML=[];
jsHTML.push("<div class='um-error-title-bar'>");
jsHTML.push("<label id='umErrorLabel'>",labelMessage,"</label></div>");
jsHTML.push("<div class='um-error-message-area'>");
jsHTML.push("<label id='umErrorMessage'>",errorMessage,"</label>");
jsHTML.push("</div>");
jsHTML.push("<div class='um-error-dialog-buttons'>");
jsHTML.push("<input type='button' value='",rcm_utilization_management_i18n.RCM_OK,"' onclick='RcmUtilizationManagementController.closeErrorDialog()'/>");
jsHTML.push("<input type='button' value='",rcm_utilization_management_i18n.RCM_CANCEL,"' onclick='RcmUtilizationManagementController.cancelErrorDialog()'/>");
jsHTML.push("</div>");
return jsHTML.join("");
},populateModifyDialogHTML:function(modifyDialogId,RECORDDATA){var jsHTML=[];
if(modifyDialogId==="umStatusModify"){jsHTML.push("<div>");
jsHTML.push(this.createCodeSetDropDownListControl("umStatusDropDown",RECORDDATA.UTILIZATIONMGMTSTATUSCDS,RECORDDATA.UTILIZATIONMGMTSTATUSCD));
jsHTML.push("<span class='um-retrieve-action-buttons'><input type='button' onclick='RcmUtilizationManagementController.saveDialog(this)' value='",rcm_utilization_management_i18n.RCM_SAVE,"'/>");
jsHTML.push("<input type='button' onclick='RcmUtilizationManagementController.cancelDialog(this)' value='",rcm_utilization_management_i18n.RCM_CANCEL,"'/>");
jsHTML.push("</span></div>");
}else{if(modifyDialogId==="clinicalReviewDateModify"){jsHTML.push("<div>");
jsHTML.push("<input type='text' name='clinicalReviewDatePicker' id='clinicalReviewDatePicker' value='",RCM_Clinical_Util.formatJsonDateString(RECORDDATA.CLINICALREVIEWDUEDATETIME),"'/>");
jsHTML.push("<span class='um-retrieve-action-buttons'><input type='button' onclick='RcmUtilizationManagementController.saveDialog(this)' value='",rcm_utilization_management_i18n.RCM_SAVE,"'/>");
jsHTML.push("<input type='button' onclick='RcmUtilizationManagementController.cancelDialog(this)' value='",rcm_utilization_management_i18n.RCM_CANCEL,"'/>");
jsHTML.push("</span></div>");
}else{if(modifyDialogId==="dischargePlanStatusModify"){jsHTML.push("<div>");
jsHTML.push(this.createCodeSetDropDownListControl("dischargePlanStatusDropDown",RECORDDATA.DISCHARGEPLANSTATUSCDS,RECORDDATA.DISCHARGEPLANSTATUSCD));
jsHTML.push("<span class='um-retrieve-action-buttons'><input type='button' onclick='RcmUtilizationManagementController.saveDialog(this)' value='",rcm_utilization_management_i18n.RCM_SAVE,"'/>");
jsHTML.push("<input type='button' onclick='RcmUtilizationManagementController.cancelDialog(this)' value='",rcm_utilization_management_i18n.RCM_CANCEL,"'/>");
jsHTML.push("</span></div>");
}else{if(modifyDialogId==="dischargePlanDueDateModify"){jsHTML.push("<div>");
jsHTML.push("<input type='text' name='dischargePlanDueDatePicker' id='dischargePlanDueDatePicker' value='",RCM_Clinical_Util.formatJsonDateString(RECORDDATA.DISCHARGEPLANDUEDATETIME),"'/>");
jsHTML.push("<span class='um-retrieve-action-buttons'><input type='button' onclick='RcmUtilizationManagementController.saveDialog(this)' value='",rcm_utilization_management_i18n.RCM_SAVE,"'/>");
jsHTML.push("<input type='button' onclick='RcmUtilizationManagementController.cancelDialog(this)' value='",rcm_utilization_management_i18n.RCM_CANCEL,"'/>");
jsHTML.push("</span></div>");
}else{if(modifyDialogId==="docReviewStatusModify"){jsHTML.push("<div>");
jsHTML.push(this.createCodeSetDropDownListControl("docStatusDropDown",RECORDDATA.DOCUMENTREVIEWSTATUSCDS,RECORDDATA.DOCUMENTREVIEWSTATUSCD));
jsHTML.push("<span class='um-retrieve-action-buttons'><input type='button' onclick='RcmUtilizationManagementController.saveDialog(this)' value='",rcm_utilization_management_i18n.RCM_SAVE,"'/>");
jsHTML.push("<input type='button' onclick='RcmUtilizationManagementController.cancelDialog(this)' value='",rcm_utilization_management_i18n.RCM_CANCEL,"'/>");
jsHTML.push("</span></div>");
}else{if(modifyDialogId==="docReviewDateModify"){jsHTML.push("<div>");
jsHTML.push("<input type='text' name='documentReviewDatePicker' id='documentReviewDatePicker' value='",RCM_Clinical_Util.formatJsonDateString(RECORDDATA.DOCUMENTREVIEWDUEDATETIME),"'/>");
jsHTML.push("<span class='um-retrieve-action-buttons'><input type='button' onclick='RcmUtilizationManagementController.saveDialog(this)' value='",rcm_utilization_management_i18n.RCM_SAVE,"'/>");
jsHTML.push("<input type='button' onclick='RcmUtilizationManagementController.cancelDialog(this)' value='",rcm_utilization_management_i18n.RCM_CANCEL,"'/>");
jsHTML.push("</span></div>");
}else{if(modifyDialogId==="drgModify"){jsHTML.push("<div>");
var careMgmtDRGDisplay="";
if(careMgmtDRG.sourceIdent.length>0&&careMgmtDRG.description.length>0){careMgmtDRGDisplay=careMgmtDRG.description+" ("+careMgmtDRG.sourceIdent+")";
}jsHTML.push("<input type='radio' name='drgRadio' id='careMgmtDrgRadioSearch'"," onclick='RcmUtilizationManagementController.drgRadioListener()'/>");
jsHTML.push("<input type='text' class='um-search-text' id='drgSearch' value='",careMgmtDRGDisplay,"'/><br>");
jsHTML.push("<span class='um-drg-label'>",careMgmtDRG.contributorSystem?careMgmtDRG.contributorSystem:"","</span><br>");
if(himDRG.sourceIdent.length>0&&himDRG.description.length>0){jsHTML.push("<input type='radio' name='drgRadio' id='himDrgSelect' onclick='RcmUtilizationManagementController.drgRadioListener()' value='",himDRG,")'",">",himDRG.description," (",himDRG.sourceIdent,")","</input><br>");
jsHTML.push("<span class='um-drg-label'>",himDRG.contributorSystem?himDRG.contributorSystem:"","</span><br>");
}jsHTML.push("<span class='um-retrieve-action-buttons'><input type='button' onclick='RcmUtilizationManagementController.saveDialog(this)' value='",rcm_utilization_management_i18n.RCM_SAVE,"'/>");
jsHTML.push("<input type='button' onclick='RcmUtilizationManagementController.cancelDialog(this)' value='",rcm_utilization_management_i18n.RCM_CANCEL,"'/>");
jsHTML.push("</span></div>");
}}}}}}}return jsHTML.join("");
},createCodeSetDropDownListControl:function(name,typeCodeSet,selectedCdValue){var dropDownHtml="";
var jsHTML=[];
jsHTML.push("<select class ='um-form-value' id='",name,"' name='",name,"' onchange='RcmUtilizationManagementController.",name,"Listener()'>");
if(selectedCdValue===0||selectedCdValue===undefined){jsHTML.push("<option value='",0,"' selected>","","</option>");
}else{jsHTML.push("<option value='",0,"'>","","</option>");
}if(typeCodeSet){for(var x=0;
x<typeCodeSet.length;
x++){var code=typeCodeSet[x];
if(selectedCdValue===code.VALUE){jsHTML.push("<option value='",code.VALUE,"' selected>",code.DISPLAY,"</option>");
}else{jsHTML.push("<option value='",code.VALUE,"'>",code.DISPLAY,"</option>");
}}}jsHTML.push("</select>");
dropDownHtml=jsHTML.join("");
return dropDownHtml;
}};
};

function GetUtilizationMgmtServiceDelegate(){this.retrieveCall=function(component,encntrId,loadCodeSetsIndicator,callback){var json={um_request:{encounterId:String(encntrId),loadCodeSetsIndicator:loadCodeSetsIndicator}};
var sendAr=[];
sendAr.push("^MINE^","0.0","^GET^");
sendAr.push("^",JSON.stringify(json),"^");
RCM_Clinical_Util.makeTimerCCLRequest(component,"rcm_get_utilization_mgmt",sendAr,true,function(status,RECORDDATA,errorInfo){if("S"===status){callback(RECORDDATA);
}else{var alertMessage=[];
alertMessage.push(rcm_utilization_management_i18n.RCM_RETRIEVE_CARE_MANAGEMENT_FAILED_MESSAGE);
if(errorInfo&&errorInfo.length>0){alertMessage.push(errorInfo);
}if(RECORDDATA&&RECORDDATA.EXCEPTIONINFORMATION&&RECORDDATA.EXCEPTIONINFORMATION[0]){alertMessage.push(RECORDDATA.EXCEPTIONINFORMATION[0].DEBUGERRORMESSAGE);
}callback(RECORDDATA,alertMessage.join(" "));
}});
};
}function ModifyUtilizationMgmtServiceDelegate(){this.modifyCall=function(component,json,callback){var sendAr=[];
sendAr.push("^MINE^","0.0","^MODIFY^");
sendAr.push("^",JSON.stringify(json),"^");
RCM_Clinical_Util.makeTimerCCLRequest(component,"rcm_modify_utilization_mgmt",sendAr,true,function(status,RECORDDATA,errorInfo){if("S"===status){callback(RECORDDATA);
}else{var alertMessage=[];
if(errorInfo&&errorInfo.length>0){alertMessage.push(errorInfo);
}if(RECORDDATA&&RECORDDATA.EXCEPTIONINFORMATION&&RECORDDATA.EXCEPTIONINFORMATION[0]){if(RECORDDATA.EXCEPTIONINFORMATION[0].EXCEPTIONTYPE="STALE_DATA"){alertMessage.push(rcm_utilization_management_i18n.RCM_MODIFY_CARE_MANAGEMENT_FAILED_MESSAGE);
}else{alertMessage.push(RECORDDATA.EXCEPTIONINFORMATION[0].DEBUGERRORMESSAGE);
}}callback(RECORDDATA,alertMessage.join(" "));
}});
};
}
function RCMAvoidableDaysFormComponentStyle(){this.initByNamespace("rcm_avoidable_days_form");
this.setHeaderClass("adf-form-header");
}RCMAvoidableDaysFormComponentStyle.inherits(ComponentStyle);
function RCMAvoidableDaysFormComponent(criterion){this.setCriterion(criterion);
this.setStyles(new RCMAvoidableDaysFormComponentStyle());
this.setLabel(rcm_avoidable_days_i18n.AVOIDABLE_DAYS_DOCUMENTATION);
this.setAlwaysExpanded(true);
var saveListeners=[];
var deleteListeners=[];
var that=this;
RCMAvoidableDaysFormComponent.method("InsertData",function(avoidableDayId){avoidableDayId=avoidableDayId||"0";
var serviceDelegate=new AvoidableDaysDelegate();
var component=this;
serviceDelegate.getAvoidableDayForForm(avoidableDayId,String(this.criterion.encntr_id),function(recordData,errorMessage){if(recordData&&recordData.STATUS_DATA.STATUS==="S"){component.HandleSuccess(recordData);
}else{component.HandleSuccess(null);
}});
});
RCMAvoidableDaysFormComponent.method("HandleSuccess",function(recordData){var avoidableDaysInfo=null;
if(recordData){avoidableDaysInfo=[];
avoidableDaysInfo.org_id=recordData.ENCNTR_ORGANIZATION_ID;
avoidableDaysInfo.facilityName=recordData.ENCNTR_FACILITY_NAME;
avoidableDaysInfo.nurse_unit_cd=recordData.ENCNTR_NURSE_UNIT_CD;
avoidableDaysInfo.user_name=recordData.USER_NAME_FULL;
avoidableDaysInfo.canAddModify=recordData.CAN_ADD_MODIFY_IND===1;
avoidableDaysInfo.canDelete=recordData.CAN_DELETE_IND===1;
if(recordData.REG_DT_TM){avoidableDaysInfo.registration_date=new Date();
avoidableDaysInfo.registration_date.setISO8601(recordData.REG_DT_TM);
}if(recordData.INPAT_ADMIT_DT_TM){avoidableDaysInfo.inpatient_admit_date=new Date();
avoidableDaysInfo.inpatient_admit_date.setISO8601(recordData.INPAT_ADMIT_DT_TM);
}if(recordData.DISCH_DT_TM){avoidableDaysInfo.disch_date=new Date();
avoidableDaysInfo.disch_date.setISO8601(recordData.DISCH_DT_TM);
}avoidableDaysInfo.reasonTypes=[];
for(var i=0;
i<recordData.REASON_TYPES.length;
i++){var reason_type=recordData.REASON_TYPES[i];
var reasons=[];
for(var j=0;
j<reason_type.REASONS.length;
j++){var reason=reason_type.REASONS[j];
reasons.push({ID:reason.REASON_CD,DISPLAY:reason.REASON_DISPLAY});
}avoidableDaysInfo.reasonTypes.push({ID:reason_type.REASON_TYPE_CD,DISPLAY:reason_type.REASON_TYPE_DISPLAY,REASONS:reasons});
}avoidableDaysInfo.services=[];
for(var i=0;
i<recordData.RESPONS_PARTY_SERVICES.length;
i++){var respons_party_service=recordData.RESPONS_PARTY_SERVICES[i];
avoidableDaysInfo.services.push({ID:respons_party_service.SERVICE_CD,DISPLAY:respons_party_service.SERVICE_DISPLAY});
}avoidableDaysInfo.nurseUnits=[];
for(var i=0;
i<recordData.NURSE_UNITS.length;
i++){var nurse_unit=recordData.NURSE_UNITS[i];
avoidableDaysInfo.nurseUnits.push({ID:nurse_unit.NURSE_UNIT_CD,DISPLAY:nurse_unit.NURSE_UNIT_NAME});
}avoidableDaysInfo.others=[];
for(var i=0;
i<recordData.RESPONS_PARTY_OTHERS.length;
i++){var respons_party_others=recordData.RESPONS_PARTY_OTHERS[i];
avoidableDaysInfo.others.push({ID:respons_party_others.OTHER_CD,DISPLAY:respons_party_others.OTHER_DISPLAY});
}avoidableDaysInfo.businessTypes=[];
for(var i=0;
i<recordData.BUSINESS_TYPES.length;
i++){var business_type=recordData.BUSINESS_TYPES[i];
avoidableDaysInfo.businessTypes.push({ID:business_type.ORG_TYPE_CD,DISPLAY:business_type.ORG_TYPE_DISPLAY});
}avoidableDaysInfo.payers=[];
for(var i=0;
i<recordData.PAYERS.length;
i++){var payer=recordData.PAYERS[i];
avoidableDaysInfo.payers.push({ID:payer.PAYER_ID,DISPLAY:payer.PAYER_NAME});
}var avoidableDaysStruct=recordData.AVOIDABLE_DAYS;
var encntrAvoidableDaysId=avoidableDaysStruct.ENCNTR_AVOIDABLE_DAYS_ID;
if(encntrAvoidableDaysId>0){var avoidableDay={};
avoidableDay.id=encntrAvoidableDaysId;
avoidableDay.updateCount=avoidableDaysStruct.UPDT_CNT;
if(avoidableDaysStruct.END_DT_TM){avoidableDay.endDate=new Date();
avoidableDay.endDate.setISO8601(avoidableDaysStruct.END_DT_TM);
}if(avoidableDaysStruct.BEG_DT_TM){avoidableDay.startDate=new Date();
avoidableDay.startDate.setISO8601(avoidableDaysStruct.BEG_DT_TM);
}avoidableDay.reasonTypeCd=avoidableDaysStruct.REASON_TYPE_CD;
avoidableDay.reasonCd=avoidableDaysStruct.REASON_CD;
avoidableDay.comment=RCM_Clinical_Util.decodeString(avoidableDaysStruct.COMMENT_TEXT);
avoidableDay.updateUserName=avoidableDaysStruct.UPDT_PRSNL_NAME;
switch(avoidableDaysStruct.RESP_PARTY_TYPE_FLAG){case 1:avoidableDay.responsibleParty="PATIENT";
break;
case 2:avoidableDay.responsibleParty="PAYER";
avoidableDay.payerId=avoidableDaysStruct.RESP_PARTY_ENTITY_ID;
break;
case 3:avoidableDay.responsibleParty="PROVIDER";
avoidableDay.providerId=avoidableDaysStruct.RESP_PARTY_ENTITY_ID;
avoidableDay.providerName=avoidableDaysStruct.RESP_PARTY_ENTITY_NAME;
break;
case 4:avoidableDay.responsibleParty="SERVICE";
avoidableDay.serviceCd=avoidableDaysStruct.RESP_PARTY_ENTITY_ID;
break;
case 5:avoidableDay.responsibleParty="EXTERNAL_BUSINESS";
avoidableDay.organizationId=avoidableDaysStruct.RESP_PARTY_ENTITY_ID;
avoidableDay.organizationName=avoidableDaysStruct.RESP_PARTY_ENTITY_NAME;
break;
case 6:avoidableDay.responsibleParty="OTHER";
avoidableDay.otherCd=avoidableDaysStruct.RESP_PARTY_ENTITY_ID;
break;
case 7:avoidableDay.responsibleParty="NURSE_UNIT";
avoidableDay.nurseUnitCd=avoidableDaysStruct.RESP_PARTY_ENTITY_ID;
avoidableDay.nurseUnitDisplay=avoidableDaysStruct.RESP_PARTY_ENTITY_NAME;
}}}var avoidableDaysForm=new RCM_Avoidable_Days_Form(String(this.criterion.encntr_id),avoidableDaysInfo,avoidableDay);
avoidableDaysForm.addSaveCompleteListener(function(){that.InsertData();
for(var i=0;
i<saveListeners.length;
i++){saveListeners[i]();
}});
avoidableDaysForm.addDeleteListener(function(){that.InsertData();
for(var i=0;
i<deleteListeners.length;
i++){deleteListeners[i]();
}});
MP_Util.Doc.FinalizeComponent(avoidableDaysForm.getHTML(),this,"");
avoidableDaysForm.initialize(this);
});
RCMAvoidableDaysFormComponent.method("addSaveListener",function(listener){saveListeners.push(listener);
});
RCMAvoidableDaysFormComponent.method("addDeleteListener",function(listener){deleteListeners.push(listener);
});
}RCMAvoidableDaysFormComponent.inherits(MPageComponent);
function RCM_Avoidable_Days_Form(encounterId,avoidableDaysInfo,modifyAvoidableDay){var serviceDelegate=new AvoidableDaysDelegate();
var businessSearchControl;
var providerSearchControl;
var saveCompleteListeners=[];
var deleteListeners=[];
var formObject={};
var focusField;
var selectedResponsibleParty="PATIENT";
var flexButtonIds=["adfBtnSave"];
var dropDownMenuId="adfDropDownMenu";
this.addSaveCompleteListener=function(listener){saveCompleteListeners.push(listener);
};
this.addDeleteListener=function(listener){deleteListeners.push(listener);
};
this.getHTML=function(){var htmlArray=[];
if(encounterId==="0"){htmlArray.push("<div><label>",rcm_avoidable_days_i18n.INVALID_ENCOUNTER_MESSAGE,"</label></div>");
return htmlArray.join("");
}else{if(!avoidableDaysInfo){htmlArray.push("<div><label>",rcm_avoidable_days_i18n.ERROR_RETRIEVE_DATA,"</label></div>");
return htmlArray.join("");
}}htmlArray.push("<div id='adfPageContent'>");
htmlArray.push("<div>");
htmlArray.push("<span class='adf-avoidable-range-title' id='adfAvoidableDateRange'></span>");
htmlArray.push("<div class='adf-documentation-labels'>");
htmlArray.push("<span>",rcm_avoidable_days_i18n.DOCUMENTED_BY,"</span>");
htmlArray.push("<span id='adfUserName'></span>");
htmlArray.push("</div>");
htmlArray.push("</div>");
htmlArray.push("<div class='adf-form-separator'></div>");
htmlArray.push("<form name='avoidableDaysForm'>");
htmlArray.push("<div id='adfFormContent'>");
htmlArray.push("<div id='adfAvoidableDaysGroup' class='adf-content-group'>");
htmlArray.push("<div id='adfAvoidableDatesSubGroup' class='adf-content-sub-group'>");
htmlArray.push(getAvoidableDateRangeHTML());
htmlArray.push("</div>");
htmlArray.push("<div id='adfReasonInfoSubGroup' class='adf-content-sub-group'>");
htmlArray.push(createDropDownHTML("adfReasonType",rcm_avoidable_days_i18n.REASON_TYPE,avoidableDaysInfo.reasonTypes));
htmlArray.push(createDropDownHTML("adfReason",rcm_avoidable_days_i18n.REASON,[]));
htmlArray.push("</div>");
htmlArray.push("</div>");
htmlArray.push(getSectionHeaderHTML("<span>"+rcm_avoidable_days_i18n.RESP_PARTY+"</span>"));
htmlArray.push("<div id='adfResponsiblePartyGroup' class='adf-content-group'>");
htmlArray.push("<div class='adf-content-sub-group'>");
htmlArray.push(getResponsiblePartyOptionsHTML());
htmlArray.push("</div>");
htmlArray.push("<div id='adfResponsiblePartyDetailsSubGroup' class='adf-content-sub-group'>");
htmlArray.push(getResponsiblePayerDetailsHTML());
htmlArray.push(getResponsibleProviderDetailsHTML());
htmlArray.push(getResponsibleServiceDetailsHTML());
htmlArray.push(getResponsibleBusinessDetailsHTML());
htmlArray.push(getResponsibleNurseUnitDetailsHTML());
htmlArray.push(getResponsibleOtherDetailsHTML());
htmlArray.push("</div>");
htmlArray.push("</div>");
htmlArray.push(getSectionHeaderHTML("<label for='adfComment'>"+rcm_avoidable_days_i18n.COMMENTS+"</label>"));
htmlArray.push("<div id='adfCommentGroup' class='adf-content-group'>");
htmlArray.push(getCommentsHTML());
htmlArray.push("</div>");
htmlArray.push("</div>");
htmlArray.push("<div id='adfButtonsContent'>");
htmlArray.push(getButtonsHTML());
htmlArray.push("</div>");
htmlArray.push("<div class='adf-stop-float'></div>");
htmlArray.push("</form>");
htmlArray.push(getYesNoDialogHTML());
htmlArray.push(getOkDialogHTML());
htmlArray.push("</div>");
return htmlArray.join("");
};
this.initialize=function(component){if(encounterId==="0"||!avoidableDaysInfo){return;
}$(".adf-responsible-party-option").click(function(){selectResponsibleParty($(this).val());
});
var fromDatePicker=RCM_Clinical_Util.addDatePicker(component,"adfAvoidableDateRangeFrom");
var toDatePicker=RCM_Clinical_Util.addDatePicker(component,"adfAvoidableDateRangeTo");
var visitStartDate=avoidableDaysInfo.inpatient_admit_date||avoidableDaysInfo.registration_date;
if(visitStartDate){fromDatePicker.setMinDate(visitStartDate);
toDatePicker.setMinDate(visitStartDate);
}if(avoidableDaysInfo.disch_date){fromDatePicker.setMaxDate(avoidableDaysInfo.disch_date);
toDatePicker.setMaxDate(avoidableDaysInfo.disch_date);
}businessSearchControl=new BusinessSearchControl(document.getElementById("adfBusinessSearch"));
businessSearchControl.setParentOrgId(parseInt(avoidableDaysInfo.org_id));
businessSearchControl.setChildOrgAddressTypeMeaning("BUSINESS");
providerSearchControl=new ProviderSearchControl(document.getElementById("adfProviderSearch"));
$("#adfBusinessType").change(function(){var val=parseInt($(this).val());
businessSearchControl.setOrgTypeCds([val]);
businessSearchControl.setSelectedOrganization(0,"");
$("#adfBusinessSearch").attr("disabled",val===0?"disabled":"");
});
$("#adfReasonType").change(function(){populateReasons();
});
$("#adfBtnSave").click(function(){saveForm();
});
$("#adfBtnNo").click(function(){setFormEnabledForDialog(true);
document.getElementById("adfYesNoDialog").style.display="none";
});
$("#adfBtnOk").click(function(){setFormEnabledForDialog(true);
document.getElementById("adfOkDialog").style.display="none";
if(focusField){focusField.focus();
}});
$("#adfBtnCancel").click(function(){openCancelDialog();
});
if(avoidableDaysInfo.canAddModify){RCM_Clinical_Util.addRequiredField(formObject,"adfAvoidableDateRangeFrom","date",flexButtonIds);
RCM_Clinical_Util.addRequiredField(formObject,"adfAvoidableDateRangeTo","date",flexButtonIds);
RCM_Clinical_Util.addRequiredField(formObject,"adfReasonType","select",flexButtonIds);
RCM_Clinical_Util.addRequiredField(formObject,"adfReason","select",flexButtonIds);
}if(modifyAvoidableDay){$("#adfUserName").html(modifyAvoidableDay.updateUserName);
$("#adfAvoidableDateRange").html(getAvoidableDayFormattedDateString(modifyAvoidableDay.startDate,modifyAvoidableDay.endDate));
}else{$("#adfUserName").html(avoidableDaysInfo.user_name);
}setupForm();
if(modifyAvoidableDay&&avoidableDaysInfo.canDelete){var menuItems=[];
menuItems.push(RCM_DropDownMenu.createMenuItem(rcm_avoidable_days_i18n.DELETE,function(){if(RCM_DropDownMenu.isMenuItemEnabled(dropDownMenuId,"adfItemDelete")){openDeleteDialog();
}},"adfItemDelete"));
RCM_DropDownMenu.addDropDownMenu(component,dropDownMenuId,menuItems);
}else{RCM_DropDownMenu.removeDropDownMenu(dropDownMenuId);
}if(!avoidableDaysInfo.canAddModify){setFormEnabled(false);
}};
var setupForm=function(){$("div.adf-responsible-party-details").hide();
$("#adfBusinessSearch").attr("disabled","disabled");
if(avoidableDaysInfo.payers.length===1){$("#adfPayer").val(avoidableDaysInfo.payers[0].ID);
}if(avoidableDaysInfo.nurseUnits.length===1){$("#adfNurseUnit").val(avoidableDaysInfo.nurseUnits[0].ID);
}else{$("#adfNurseUnit").val(avoidableDaysInfo.nurse_unit_cd);
}if(modifyAvoidableDay){setAvoidableDayToForm(modifyAvoidableDay);
}else{selectResponsibleParty("PATIENT");
var visit_start_dt=avoidableDaysInfo.inpatient_admit_date||avoidableDaysInfo.registration_date;
var disch_dt=avoidableDaysInfo.disch_date;
var now=new Date();
var defaultDate=new Date();
if(visit_start_dt&&disch_dt){if(now<visit_start_dt||now>disch_dt){defaultDate=disch_dt;
}}else{if(visit_start_dt){if(now<visit_start_dt){defaultDate=visit_start_dt;
}}else{if(disch_dt){if(now>disch_dt){defaultDate=disch_dt;
}}}}RCM_Clinical_Util.setDate("adfAvoidableDateRangeFrom",defaultDate);
RCM_Clinical_Util.setDate("adfAvoidableDateRangeTo",defaultDate);
}RCM_Clinical_Util.performRequiredFieldChecks(formObject);
};
var setFormEnabled=function(enabled){$("#adfAvoidableDateRangeFrom").datepicker(enabled?"enable":"disable");
$("#adfAvoidableDateRangeTo").datepicker(enabled?"enable":"disable");
$(".adf-drop-down").attr("disabled",!enabled);
$(".searchText").attr("disabled",!enabled);
$("#adfComment").attr("disabled",!enabled);
$(".adf-responsible-party-option").attr("disabled",!enabled);
};
var setAvoidableDayToForm=function(avoidableDay){RCM_Clinical_Util.setDate("adfAvoidableDateRangeFrom",avoidableDay.startDate);
RCM_Clinical_Util.setDate("adfAvoidableDateRangeTo",avoidableDay.endDate);
$("#adfReasonType").val(avoidableDay.reasonTypeCd);
populateReasons();
$("#adfReason").val(avoidableDay.reasonCd);
switch(avoidableDay.responsibleParty){case"PATIENT":$("#adfRdoPatientFamily").attr("checked",true);
break;
case"PAYER":$("#adfRdoPayer").attr("checked",true);
$("#adfPayer").val(avoidableDay.payerId);
break;
case"PROVIDER":$("#adfRdoProvider").attr("checked",true);
providerSearchControl.setSelectedProvider(parseInt(avoidableDay.providerId),avoidableDay.providerName);
break;
case"SERVICE":$("#adfRdoService").attr("checked",true);
$("#adfService").val(avoidableDay.serviceCd);
break;
case"EXTERNAL_BUSINESS":$("#adfRdoBusiness").attr("checked",true);
businessSearchControl.setSelectedOrganization(parseInt(avoidableDay.organizationId),avoidableDay.organizationName);
break;
case"OTHER":$("#adfRdoOther").attr("checked",true);
$("#adfOther").val(avoidableDay.otherCd);
break;
case"NURSE_UNIT":$("#adfRdoNurseUnit").attr("checked",true);
$("#adfNurseUnit").val(avoidableDay.nurseUnitCd);
break;
}selectResponsibleParty(avoidableDay.responsibleParty);
$("#adfComment").val(avoidableDay.comment);
};
var selectResponsibleParty=function(responsibleParty){$("div.adf-responsible-party-details").hide();
switch(selectedResponsibleParty){case"PAYER":RCM_Clinical_Util.removeRequiredField(formObject,"adfPayer","select",flexButtonIds);
break;
case"PROVIDER":RCM_Clinical_Util.setSearchControlRequired(false,formObject,"adfProviderSearch",providerSearchControl,flexButtonIds);
break;
case"SERVICE":RCM_Clinical_Util.removeRequiredField(formObject,"adfService","select",flexButtonIds);
break;
case"EXTERNAL_BUSINESS":RCM_Clinical_Util.setSearchControlRequired(false,formObject,"adfBusinessSearch",businessSearchControl,flexButtonIds);
break;
case"OTHER":RCM_Clinical_Util.removeRequiredField(formObject,"adfOther","select",flexButtonIds);
RCM_Clinical_Util.removeRequiredField(formObject,"adfComment","textarea",flexButtonIds);
break;
case"NURSE_UNIT":RCM_Clinical_Util.removeRequiredField(formObject,"adfNurseUnit","select",flexButtonIds);
break;
}selectedResponsibleParty=responsibleParty;
switch(selectedResponsibleParty){case"PAYER":if(avoidableDaysInfo.canAddModify){RCM_Clinical_Util.addRequiredField(formObject,"adfPayer","select",flexButtonIds);
}$("#adfPayerDetails").show();
break;
case"PROVIDER":if(avoidableDaysInfo.canAddModify){RCM_Clinical_Util.setSearchControlRequired(true,formObject,"adfProviderSearch",providerSearchControl,flexButtonIds);
}$("#adfProviderDetails").show();
break;
case"SERVICE":if(avoidableDaysInfo.canAddModify){RCM_Clinical_Util.addRequiredField(formObject,"adfService","select",flexButtonIds);
}$("#adfServiceDetails").show();
break;
case"EXTERNAL_BUSINESS":if(avoidableDaysInfo.canAddModify){RCM_Clinical_Util.setSearchControlRequired(true,formObject,"adfBusinessSearch",businessSearchControl,flexButtonIds);
}$("#adfBusinessDetails").show();
break;
case"OTHER":if(avoidableDaysInfo.canAddModify){RCM_Clinical_Util.addRequiredField(formObject,"adfOther","select",flexButtonIds);
RCM_Clinical_Util.addRequiredField(formObject,"adfComment","textarea",flexButtonIds);
}$("#adfOtherDetails").show();
break;
case"NURSE_UNIT":if(avoidableDaysInfo.canAddModify){RCM_Clinical_Util.addRequiredField(formObject,"adfNurseUnit","select",flexButtonIds);
}$("#adfNurseUnitDetails").show();
break;
}};
var populateReasons=function(){var $adfReason=$("#adfReason");
$adfReason.children().remove();
var reasonTypeCd=$("#adfReasonType").val();
if(reasonTypeCd!=="0"){for(var i=0,length=avoidableDaysInfo.reasonTypes.length;
i<length;
i++){var reasonType=avoidableDaysInfo.reasonTypes[i];
if(reasonTypeCd===reasonType.ID){$adfReason.html(createOptionsHTML(reasonType.REASONS));
break;
}}}RCM_Clinical_Util.performRequiredFieldChecks(formObject);
};
var saveForm=function(){var formData=[];
formData.reasonTypeCd=$("#adfReasonType").val();
formData.reasonCd=$("#adfReason").val();
formData.responsibleParty=$("#adfResponsiblePartyOptions input:radio:checked").val();
formData.payerId=$("#adfPayer").val();
formData.providerId=String(providerSearchControl.getSelectedProviderId());
formData.serviceCd=$("#adfService").val();
formData.businessOrgId=String(businessSearchControl.getSelectedOrganizationId());
formData.otherCd=$("#adfOther").val();
formData.nurseUnitCd=$("#adfNurseUnit").val();
formData.comment=$("#adfComment").val();
formData.fromDate=$("#adfAvoidableDateRangeFrom").datepicker("getDate");
formData.toDate=$("#adfAvoidableDateRangeTo").datepicker("getDate");
formData.toDate.setHours(23,59,59);
if(formData.fromDate<formData.toDate){var status;
if(modifyAvoidableDay){status=serviceDelegate.modifyAvoidableDays(formData,encounterId,modifyAvoidableDay.id,modifyAvoidableDay.updateCount);
}else{status=serviceDelegate.addAvoidableDays(formData,encounterId);
}if(status===0){for(var i=0,length=saveCompleteListeners.length;
i<length;
i++){saveCompleteListeners[i]();
}}else{switch(status){case 1:openStaleDataDialog();
break;
case 2:openInvalidDateRangeDialog();
focusField=document.getElementById("adfAvoidableDateRangeFrom");
break;
default:openSaveFailedDialog();
break;
}}}else{openEndDatePrecedesBeginDateDialog();
focusField=document.getElementById("adfAvoidableDateRangeFrom");
}};
var getAvoidableDateRangeHTML=function(){var htmlArray=[];
htmlArray.push("<div id='adfFromDateContainer'>");
htmlArray.push("<div class='adf-control-container'>");
htmlArray.push("<label class='adf-control-label' for='adfAvoidableDateRangeFrom'>",rcm_avoidable_days_i18n.START_DATE,"</label>");
htmlArray.push("<input id='adfAvoidableDateRangeFrom' type='text' name='adfAvoidableDateRangeFrom' maxlength='10' />");
htmlArray.push("</div>");
htmlArray.push("</div>");
htmlArray.push("<div id='adfToDateContainer'>");
htmlArray.push("<div class='adf-control-container'>");
htmlArray.push("<label class='adf-control-label' for='adfAvoidableDateRangeTo'>",rcm_avoidable_days_i18n.END_DATE,"</label>");
htmlArray.push("<input id='adfAvoidableDateRangeTo' type='text' name='adfAvoidableDateRangeTo' maxlength='10' />");
htmlArray.push("</div>");
htmlArray.push("</div>");
return htmlArray.join("");
};
var getResponsiblePartyOptionsHTML=function(){var htmlArray=[];
htmlArray.push("<div id='adfResponsiblePartyOptions'>");
htmlArray.push("<input type='radio' id='adfRdoPatientFamily' class='adf-responsible-party-option' name='adfResponsiblePartyOptions' value='PATIENT' checked='checked'>"+rcm_avoidable_days_i18n.PATIENT_FAMILY+"</input><br />");
htmlArray.push("<input type='radio' id='adfRdoPayer' class='adf-responsible-party-option' name='adfResponsiblePartyOptions' value='PAYER'>"+rcm_avoidable_days_i18n.PAYER+"</input><br />");
htmlArray.push("<input type='radio' id='adfRdoProvider' class='adf-responsible-party-option' name='adfResponsiblePartyOptions' value='PROVIDER'>"+rcm_avoidable_days_i18n.PROVIDER+"</input><br />");
htmlArray.push("<input type='radio' id='adfRdoService' class='adf-responsible-party-option' name='adfResponsiblePartyOptions' value='SERVICE'>"+rcm_avoidable_days_i18n.SERVICE+"</input><br />");
htmlArray.push("<input type='radio' id='adfRdoBusiness' class='adf-responsible-party-option' name='adfResponsiblePartyOptions' value='EXTERNAL_BUSINESS'>"+rcm_avoidable_days_i18n.EXTERNAL_BUSINESS+"</input><br />");
htmlArray.push("<input type='radio' id='adfRdoNurseUnit' class='adf-responsible-party-option' name='adfResponsiblePartyOptions' value='NURSE_UNIT'>"+rcm_avoidable_days_i18n.NURSE_UNIT+"</input><br />");
htmlArray.push("<input type='radio' id='adfRdoOther' class='adf-responsible-party-option' name='adfResponsiblePartyOptions' value='OTHER'>"+rcm_avoidable_days_i18n.OTHER+"</input><br />");
htmlArray.push("</div>");
return htmlArray.join("");
};
var getResponsiblePayerDetailsHTML=function(){var htmlArray=[];
htmlArray.push("<div id='adfPayerDetails' class='adf-responsible-party-details'>");
htmlArray.push("<fieldset class='adf-responsible-party-details-grouper'><legend>"+rcm_avoidable_days_i18n.PAYER_DETAILS+"</legend>");
htmlArray.push(createDropDownHTML("adfPayer",rcm_avoidable_days_i18n.PAYER,avoidableDaysInfo.payers));
htmlArray.push("</fieldset>");
htmlArray.push("</div>");
return htmlArray.join("");
};
var getResponsibleProviderDetailsHTML=function(){var htmlArray=[];
htmlArray.push("<div id='adfProviderDetails' class='adf-responsible-party-details'>");
htmlArray.push("<fieldset class='adf-responsible-party-details-grouper'><legend>"+rcm_avoidable_days_i18n.PROVIDER_DETAILS+"</legend>");
htmlArray.push("<div class='adf-control-container'>");
htmlArray.push("<label class='adf-control-label' for='adfProviderSearch'>",rcm_avoidable_days_i18n.PROVIDER,"</label>");
htmlArray.push("<input type='text' class='searchText' id='adfProviderSearch' name='adfProviderSearch' />");
htmlArray.push("</div>");
htmlArray.push("</fieldset>");
htmlArray.push("</div>");
return htmlArray.join("");
};
var getResponsibleServiceDetailsHTML=function(){var htmlArray=[];
htmlArray.push("<div id='adfServiceDetails' class='adf-responsible-party-details'>");
htmlArray.push("<fieldset class='adf-responsible-party-details-grouper'><legend>"+rcm_avoidable_days_i18n.SERVICE_DETAILS+"</legend>");
htmlArray.push(createDropDownHTML("adfService",rcm_avoidable_days_i18n.SERVICE,avoidableDaysInfo.services));
htmlArray.push("</fieldset>");
htmlArray.push("</div>");
return htmlArray.join("");
};
var getResponsibleBusinessDetailsHTML=function(){var htmlArray=[];
htmlArray.push("<div id='adfBusinessDetails' class='adf-responsible-party-details'>");
htmlArray.push("<fieldset class='adf-responsible-party-details-grouper'><legend>"+rcm_avoidable_days_i18n.BUSINESS_DETAILS+"</legend>");
htmlArray.push(createDropDownHTML("adfBusinessType",rcm_avoidable_days_i18n.BUSINESS_TYPE,avoidableDaysInfo.businessTypes));
htmlArray.push("<div class='adf-control-container'>");
htmlArray.push("<label class='adf-control-label' for='adfBusinessSearch'>",rcm_avoidable_days_i18n.BUSINESS_NAME,"</label>");
htmlArray.push("<input type='text' class='searchText' id='adfBusinessSearch' name='adfBusinessSearch' />");
htmlArray.push("</div>");
htmlArray.push("</fieldset>");
htmlArray.push("</div>");
return htmlArray.join("");
};
var getResponsibleNurseUnitDetailsHTML=function(){var htmlArray=[];
htmlArray.push("<div id='adfNurseUnitDetails' class='adf-responsible-party-details'>");
htmlArray.push("<fieldset class='adf-responsible-party-details-grouper'><legend>"+rcm_avoidable_days_i18n.NURSE_UNIT_DETAILS+"</legend>");
htmlArray.push("<div class='adf-control-container'>");
htmlArray.push("<span id='adfFacility'>",rcm_avoidable_days_i18n.FACILITY,avoidableDaysInfo.facilityName,"</span>");
htmlArray.push("</div>");
htmlArray.push(createDropDownHTML("adfNurseUnit",rcm_avoidable_days_i18n.NURSE_UNIT,avoidableDaysInfo.nurseUnits));
htmlArray.push("</fieldset>");
htmlArray.push("</div>");
return htmlArray.join("");
};
var getResponsibleOtherDetailsHTML=function(){var htmlArray=[];
htmlArray.push("<div id='adfOtherDetails' class='adf-responsible-party-details'>");
htmlArray.push("<fieldset class='adf-responsible-party-details-grouper'><legend>"+rcm_avoidable_days_i18n.OTHER_DETAILS+"</legend>");
htmlArray.push(createDropDownHTML("adfOther",rcm_avoidable_days_i18n.OTHER,avoidableDaysInfo.others));
htmlArray.push("</fieldset>");
htmlArray.push("</div>");
return htmlArray.join("");
};
var getCommentsHTML=function(){var htmlArray=[];
htmlArray.push("<textarea id='adfComment'></textarea>");
return htmlArray.join("");
};
var getButtonsHTML=function(){var htmlArray=[];
if(avoidableDaysInfo.canAddModify){htmlArray.push("<input type='button' id='adfBtnCancel' class='adf-action-button' value='"+rcm_avoidable_days_i18n.CANCEL+"' />");
htmlArray.push("<input type='button' id='adfBtnSave' class='adf-action-button' value='"+rcm_avoidable_days_i18n.SAVE+"' />");
}return htmlArray.join("");
};
var getSectionHeaderHTML=function(contents){var htmlArray=[];
htmlArray.push("<div class='adf-section-header'>");
htmlArray.push("<div class='adf-form-separator-left'>",contents,"</div>");
htmlArray.push("<div class='adf-form-separator-right'></div>");
htmlArray.push("</div>");
return htmlArray.join("");
};
var createDropDownHTML=function(name,label,items){var htmlArray=[];
var id=name;
htmlArray.push("<div class='adf-control-container'>");
htmlArray.push("<label class='adf-control-label' for='",id,"'>",label,"</label>");
htmlArray.push("<select id='",id,"' class='adf-drop-down' name='",name,"'>");
htmlArray.push(createOptionsHTML(items));
htmlArray.push("</select>");
htmlArray.push("</div>");
return htmlArray.join("");
};
var createOptionsHTML=function(items){var htmlArray=[];
htmlArray.push("<option value='0'></option>");
for(var i=0,length=items.length;
i<length;
i++){var item=items[i];
htmlArray.push("<option value='",item.ID,"'>",item.DISPLAY,"</option>");
}return htmlArray.join("");
};
var getYesNoDialogHTML=function(){var htmlArray=[];
htmlArray.push("<div id='adfYesNoDialog' class='adf-dialog'>");
htmlArray.push("<div class='adf-dialog-title-bar'>");
htmlArray.push("<label id='adfYesNoDialogTitle'></label>","</div>");
htmlArray.push("<div class='adf-dialog-message-area'>");
htmlArray.push("<label id='adfYesNoDialogMessage'></label>");
htmlArray.push("</div>");
htmlArray.push("<div class='adf-dialog-buttons'>");
htmlArray.push("<input id='adfBtnNo' type='button' value='",rcm_avoidable_days_i18n.NO,"' />");
htmlArray.push("<input id='adfBtnYes' type='button' value='",rcm_avoidable_days_i18n.YES,"' />");
htmlArray.push("</div></div>");
return htmlArray.join("");
};
var getOkDialogHTML=function(){var htmlArray=[];
htmlArray.push("<div id='adfOkDialog' class='adf-dialog'>");
htmlArray.push("<div class='adf-dialog-title-bar'>");
htmlArray.push("<label id='adfOkDialogTitle'></label>","</div>");
htmlArray.push("<div class='adf-dialog-message-area'>");
htmlArray.push("<label id='adfOkDialogMessage'></label>");
htmlArray.push("</div>");
htmlArray.push("<div class='adf-dialog-buttons'>");
htmlArray.push("<input id='adfBtnOk' type='button' value='",rcm_avoidable_days_i18n.OK,"' />");
htmlArray.push("</div></div>");
return htmlArray.join("");
};
var openInvalidDateRangeDialog=function(){focusField=null;
$("#adfOkDialogTitle").html(rcm_avoidable_days_i18n.INVALID_DATE_RANGE_TITLE);
$("#adfOkDialogMessage").html(rcm_avoidable_days_i18n.INVALID_DATE_RANGE_MESSAGE);
setFormEnabledForDialog(false);
document.getElementById("adfOkDialog").style.display="block";
};
var openStaleDataDialog=function(){focusField=null;
$("#adfOkDialogTitle").html(rcm_avoidable_days_i18n.STALE_DATA_TITLE);
$("#adfOkDialogMessage").html(rcm_avoidable_days_i18n.STALE_DATA_MESSAGE);
setFormEnabledForDialog(false);
document.getElementById("adfOkDialog").style.display="block";
};
var openEndDatePrecedesBeginDateDialog=function(){focusField=null;
$("#adfOkDialogTitle").html(rcm_avoidable_days_i18n.INVALID_DATE_RANGE_TITLE);
$("#adfOkDialogMessage").html(rcm_avoidable_days_i18n.END_DATE_PRECEDES_BEGIN_DATE_MESSAGE);
setFormEnabledForDialog(false);
document.getElementById("adfOkDialog").style.display="block";
};
var openGetFailedDialog=function(msg){focusField=null;
$("#adfOkDialogTitle").html(rcm_avoidable_days_i18n.GET_FAILED_TITLE);
$("#adfOkDialogMessage").html(msg);
setFormEnabledForDialog(false);
document.getElementById("adfOkDialog").style.display="block";
};
var openSaveFailedDialog=function(){focusField=null;
$("#adfOkDialogTitle").html(rcm_avoidable_days_i18n.SAVE_FAILED_TITLE);
$("#adfOkDialogMessage").html(rcm_avoidable_days_i18n.SAVE_FAILED_MESSAGE);
setFormEnabledForDialog(false);
document.getElementById("adfOkDialog").style.display="block";
};
var openDeleteFailedDialog=function(){focusField=null;
$("#adfOkDialogTitle").html(rcm_avoidable_days_i18n.DELETE_FAILED_TITLE);
$("#adfOkDialogMessage").html(rcm_avoidable_days_i18n.DELETE_FAILED_MESSAGE);
setFormEnabledForDialog(false);
document.getElementById("adfOkDialog").style.display="block";
};
var openDeleteDialog=function(){$("#adfYesNoDialogTitle").html(rcm_avoidable_days_i18n.DELETE_TITLE);
$("#adfYesNoDialogMessage").html(rcm_avoidable_days_i18n.DELETE_MESSAGE);
setFormEnabledForDialog(false);
document.getElementById("adfYesNoDialog").style.display="block";
$("#adfBtnYes").unbind("click").click(function(){var status=serviceDelegate.deleteAvoidableDays(modifyAvoidableDay.id,modifyAvoidableDay.updateCount);
setFormEnabledForDialog(true);
document.getElementById("adfYesNoDialog").style.display="none";
if(status===0){for(var i=0,length=deleteListeners.length;
i<length;
i++){deleteListeners[i]();
}}else{switch(status){case 1:openStaleDataDialog();
break;
default:openDeleteFailedDialog();
break;
}}});
};
var openCancelDialog=function(){$("#adfYesNoDialogTitle").html(rcm_avoidable_days_i18n.CANCEL);
$("#adfYesNoDialogMessage").html(rcm_avoidable_days_i18n.CANCEL_MESSAGE);
setFormEnabledForDialog(false);
document.getElementById("adfYesNoDialog").style.display="block";
$("#adfBtnYes").unbind("click").click(function(){document.avoidableDaysForm.reset();
populateReasons();
setFormEnabledForDialog(true);
setupForm();
document.getElementById("adfYesNoDialog").style.display="none";
});
};
var setFormEnabledForDialog=function(enabled){var saveButton=document.getElementById("adfBtnSave");
if(saveButton){saveButton.disabled=!enabled||RCM_Clinical_Util.isAnyFieldRequired(formObject);
}var cancelButton=document.getElementById("adfBtnCancel");
if(cancelButton){cancelButton.disabled=!enabled;
}RCM_DropDownMenu.setMenuItemEnabled(dropDownMenuId,"adfItemDelete",enabled);
setFormEnabled(enabled&&avoidableDaysInfo&&avoidableDaysInfo.canAddModify);
};
var getAvoidableDayFormattedDateString=function(startDate,endDate){if(startDate&&endDate){if((startDate.getMonth()===endDate.getMonth())&&(startDate.getDate()===endDate.getDate())&&(startDate.getFullYear()===endDate.getFullYear())){return RCM_Clinical_Util.formatDate(startDate);
}return RCM_Clinical_Util.formatDate(startDate)+" - "+RCM_Clinical_Util.formatDate(endDate);
}return"";
};
}
function RCMAvoidableDaysListComponentStyle(){this.initByNamespace("rcm_adl");
}RCMAvoidableDaysListComponentStyle.inherits(ComponentStyle);
function RCMAvoidableDaysListComponent(criterion){var that=this;
var encounterId=criterion.encntr_id;
var isAddTaskAuthorized=false;
var resultLinksVisible=false;
var newAvoidableDayListeners=[];
var avoidableDaySelectedListeners=[];
var renderSuccessListeners=[];
var avoidDaysIds=[];
this.setCriterion(criterion);
this.setStyles(new RCMAvoidableDaysListComponentStyle());
this.setLabel(rcm_avoidable_days_i18n.AVOIDABLE_DAYS_LIST_LABEL);
this.setExpanded(true);
this.setIncludeLineNumber(true);
this.setPlusAddEnabled(true);
this.setScope(2);
RCMAvoidableDaysListComponent.method("isResultLinksVisible",function(){return resultLinksVisible;
});
RCMAvoidableDaysListComponent.method("setResultLinksVisible",function(isResultLinksVisible){resultLinksVisible=isResultLinksVisible;
});
RCMAvoidableDaysListComponent.method("InsertData",function(){$("#rcm_adlAdd").css("visibility","hidden");
var serviceDelegate=new AvoidableDaysDelegate();
var component=this;
serviceDelegate.getAvoidableDays(encounterId.toFixed(1),function(recordData,errorMessage){if(recordData&&"S"===recordData.STATUS_DATA.STATUS){component.HandleSuccess(recordData);
}else{component.HandleSuccess(recordData);
}});
});
RCMAvoidableDaysListComponent.method("HandleSuccess",function(recordData){isAddTaskAuthorized=recordData.CAN_ADD_IND===1;
$("#rcm_adlAdd").css("visibility",(this.isPlusAddEnabled()&&isAddTaskAuthorized)?"":"hidden");
var avoidableDays=[];
var avoidableDaysResultsLength=recordData.RESULTS.length;
for(var i=0;
i<avoidableDaysResultsLength;
i++){avoidableDays.push(recordData.RESULTS[i]);
avoidDaysIds.push(recordData.RESULTS[i].ENCNTR_AVOIDABLE_DAYS_ID);
}var countText=MP_Util.CreateTitleText(this,recordData.TOTAL_AVOIDABLE_DAYS);
var avoidableDaysList=new RCMAvoidableDaysList(encounterId,avoidableDays,MP_Util.GetContentClass(this,avoidableDaysResultsLength),resultLinksVisible);
MP_Util.Doc.FinalizeComponent(avoidableDaysList.getHTML(),this,countText);
avoidableDaysList.addAvoidableDaySelectedListener(function(avoidableDayId){for(var i=0,length=avoidableDaySelectedListeners.length;
i<length;
i++){avoidableDaySelectedListeners[i](avoidableDayId);
}});
avoidableDaysList.initialize();
for(var i=0;
i<renderSuccessListeners.length;
i++){renderSuccessListeners[i]();
}});
RCMAvoidableDaysListComponent.method("openTab",function(recordData){newAvoidableDay();
});
var superSetPlusAddEnabled=RCMAvoidableDaysListComponent.prototype.setPlusAddEnabled;
RCMAvoidableDaysListComponent.method("setPlusAddEnabled",function(isAddEnabled){superSetPlusAddEnabled.call(that,isAddEnabled);
$("#rcm_adlAdd").css("visibility",(this.isPlusAddEnabled()&&isAddTaskAuthorized)?"":"hidden");
});
RCMAvoidableDaysListComponent.method("addAvoidableDaySelectedListener",function(listener){avoidableDaySelectedListeners.push(listener);
});
RCMAvoidableDaysListComponent.method("addNewAvoidableDayListener",function(listener){newAvoidableDayListeners.push(listener);
});
RCMAvoidableDaysListComponent.method("addRenderSuccessListener",function(listener){renderSuccessListeners.push(listener);
});
RCMAvoidableDaysListComponent.method("getAvoidDaysIds",function(){return avoidDaysIds;
});
RCMAvoidableDaysListComponent.method("isAddAuthorized",function(){return isAddTaskAuthorized;
});
RCMAvoidableDaysListComponent.method("removeRenderSuccessListener",function(listener){for(var i=0;
i<renderSuccessListeners.length;
i++){if(renderSuccessListeners[i]===listener){renderSuccessListeners.splice(i,1);
return;
}}});
function newAvoidableDay(){for(var i=0,length=newAvoidableDayListeners.length;
i<length;
i++){newAvoidableDayListeners[i]();
}}}RCMAvoidableDaysListComponent.inherits(MPageComponent);
function RCMAvoidableDaysList(encounterId,avoidableDays,contentBodyClassName,isResultLinksVisible){var avoidableDaySelectedListeners=[];
this.getHTML=function(){var adLength=avoidableDays.length;
var htmlArray=[];
if(encounterId===0){htmlArray.push("<div>"+rcm_avoidable_days_i18n.INVALID_ENCOUNTER_MESSAGE,"</div>");
return htmlArray.join("");
}if(adLength===0){htmlArray.push("<div>"+rcm_avoidable_days_i18n.NO_AVOIDABLE_DAY_RESULTS,"</div>");
return htmlArray.join("");
}htmlArray.push("<div class='",contentBodyClassName,"'>");
htmlArray.push("<table id='avoidableDaysTable'>");
htmlArray.push("<tr>");
htmlArray.push("<th>",rcm_avoidable_days_i18n.DATE,"</th>");
htmlArray.push("<th>",rcm_avoidable_days_i18n.RESP_PARTY,"</th>");
htmlArray.push("<th>",rcm_avoidable_days_i18n.REASON_TYPE,"</th>");
htmlArray.push("</tr>");
for(var i=0;
i<adLength;
i++){var avoidableDayResult=avoidableDays[i];
htmlArray.push("<tr>");
htmlArray.push("<td class='adl-date-col'><div>");
var avoidableDayFormattedDateString=getAvoidableDayFormattedDateString(avoidableDayResult);
htmlArray.push("<span>");
if(isResultLinksVisible){htmlArray.push("<a class='adl-avoidable-day-link' id='"+avoidableDayResult.ENCNTR_AVOIDABLE_DAYS_ID+"'>");
htmlArray.push(avoidableDayFormattedDateString);
htmlArray.push("</a>");
}else{htmlArray.push(avoidableDayFormattedDateString);
}htmlArray.push("</span>");
htmlArray.push("</div></td>");
htmlArray.push("<td class='adl-resp-party-col'><div>");
if(avoidableDayResult.RESP_PARTY_TYPE_FLAG!==1){htmlArray.push("<span>",avoidableDayResult.RESP_PARTY_ENTITY_NAME,"</span>");
}else{htmlArray.push("<span>",rcm_avoidable_days_i18n.PATIENT_FAMILY,"</span>");
}htmlArray.push("</div></td>");
htmlArray.push("<td class='adl-reason-type-col adl-hvr-td'><div class='adl-hvr-parent'>");
htmlArray.push("<div class='adl-result-text'>",avoidableDayResult.REASON_TYPE_DISP,"</div>");
htmlArray.push("<div class='adl-hvr-text'>");
htmlArray.push("<div>");
htmlArray.push("<span class='adl-hvr-info-lbl'>",rcm_avoidable_days_i18n.REASON_HVR_LBL,"</span>");
htmlArray.push("<span class='adl-hvr-info-val'>",avoidableDayResult.REASON_DISP,"</span>");
htmlArray.push("</div>");
htmlArray.push("</div>");
htmlArray.push("</div></td>");
htmlArray.push("</tr>");
}htmlArray.push("</table>");
htmlArray.push("</div>");
return htmlArray.join("");
};
this.initialize=function(){$(".adl-avoidable-day-link").click(function(){avoidableDaySelected($(this).attr("id"));
});
var hvrParentElts=$(".adl-hvr-parent");
hvrParentElts.each(function(){$(this).height($(this).closest("td").height());
var hvrParent=$(this).get(0);
var hvrChild=$(this).children(".adl-hvr-text").get(0);
hs(hvrParent,hvrChild);
});
};
this.addAvoidableDaySelectedListener=function(listener){avoidableDaySelectedListeners.push(listener);
};
function avoidableDaySelected(avoidableDayId){for(var i=0,length=avoidableDaySelectedListeners.length;
i<length;
i++){avoidableDaySelectedListeners[i](avoidableDayId);
}}function getAvoidableDayFormattedDateString(avoidableDayResult){var beginDate=new Date();
beginDate.setISO8601(avoidableDayResult.BEG_DT_TM);
var endDate=new Date();
endDate.setISO8601(avoidableDayResult.END_DT_TM);
if((beginDate.getMonth()===endDate.getMonth())&&(beginDate.getDate()===endDate.getDate())&&(beginDate.getFullYear()===endDate.getFullYear())){return RCM_Clinical_Util.formatJsonDateString(avoidableDayResult.BEG_DT_TM);
}return RCM_Clinical_Util.formatJsonDateString(avoidableDayResult.BEG_DT_TM)+" - "+RCM_Clinical_Util.formatJsonDateString(avoidableDayResult.END_DT_TM);
}}
function AvoidableDaysDelegate(){this.getAvoidableDayForForm=function(avoidableDayId,encounterId,statusHandler){var sendAr=[];
var json={AVOIDABLE_DAYS_REQUEST:{ENCNTR_ID:String(encounterId),ENCNTR_AVOIDABLE_DAYS_ID:avoidableDayId}};
sendAr.push("^MINE^","0.0","2","^",JSON.stringify(json),"^");
var status=0;
var info=new XMLCclRequest();
info.open("GET","rcm_avoidable_days",0);
info.send(sendAr.join(","));
var recordData=[];
if(info.status===200){var jsonEval=JSON.parse(info.responseText);
recordData=jsonEval.RECORD_DATA;
statusHandler(recordData);
}else{status=-1;
statusHandler(recordData);
}return status;
};
this.getAvoidableDays=function(encounterId,statusHandler){var reqJson={AVOIDABLE_DAYS_REQUEST:{ENCNTR_ID:encounterId}};
var reqArgs=[];
reqArgs.push("^MINE^","0.0","1","^"+JSON.stringify(reqJson)+"^");
var info=new XMLCclRequest();
info.onreadystatechange=function(){if(info.readyState===4&&info.status===200){try{var jsonEval=JSON.parse(info.responseText);
var recordData=jsonEval.RECORD_DATA;
var status=recordData.STATUS_DATA.STATUS;
var debugMessage;
if(recordData.TRANSACTIONSTATUS){debugMessage=recordData.TRANSACTIONSTATUS.DEBUGERRORMESSAGE;
}statusHandler(recordData,debugMessage);
}catch(err){alert(JSON.stringify(err));
}finally{}}else{if(info.readyState===4&&info.status!==200){statusHandler(recordData,info.status);
}}};
info.open("GET","rcm_avoidable_days",true);
info.send(reqArgs.join(","));
};
this.addAvoidableDays=function(formData,encounterId){var resp_party_type_flag=0;
var resp_party_entity_id="0";
switch(formData.responsibleParty){case"PATIENT":resp_party_type_flag=1;
break;
case"PAYER":resp_party_type_flag=2;
resp_party_entity_id=formData.payerId;
break;
case"PROVIDER":resp_party_type_flag=3;
resp_party_entity_id=formData.providerId;
break;
case"SERVICE":resp_party_type_flag=4;
resp_party_entity_id=formData.serviceCd;
break;
case"EXTERNAL_BUSINESS":resp_party_type_flag=5;
resp_party_entity_id=formData.businessOrgId;
break;
case"OTHER":resp_party_type_flag=6;
resp_party_entity_id=formData.otherCd;
break;
case"NURSE_UNIT":resp_party_type_flag=7;
resp_party_entity_id=formData.nurseUnitCd;
break;
}var jsonRequest={ADD_AVOIDABLE_DAYS_REQUEST:{ENCNTR_ID:encounterId,BEG_DT_TM:formData.fromDate.format("dd-mmm-yyyy HH:MM:ss"),END_DT_TM:formData.toDate.format("dd-mmm-yyyy HH:MM:ss"),REASON_TYPE_CD:formData.reasonTypeCd,REASON_CD:formData.reasonCd,COMMENT_TEXT:RCM_Clinical_Util.encodeString(formData.comment),RESP_PARTY_TYPE_FLAG:resp_party_type_flag,RESP_PARTY_ENTITY_ID:resp_party_entity_id}};
var sendAr=[];
sendAr.push("^MINE^","0.0","3","^"+JSON.stringify(jsonRequest)+"^");
var status=0;
var info=new XMLCclRequest();
info.onreadystatechange=function(){if(info.readyState===4&&info.status===200){var jsonEval=JSON.parse(info.responseText);
var recordData=jsonEval.RECORD_DATA;
if(recordData.STATUS_DATA.STATUS==="F"){var failureReasonFlag=recordData.FAILURE_REASON_FLAG;
status=failureReasonFlag>0?failureReasonFlag:-1;
}}else{if(info.readyState===4&&info.status!==200){status=-1;
}}};
info.open("GET","rcm_avoidable_days",0);
info.send(sendAr.join(","));
return status;
};
this.modifyAvoidableDays=function(formData,encounterId,avoidableDayId,updateCount){var resp_party_type_flag=0;
var resp_party_entity_id="0";
switch(formData.responsibleParty){case"PATIENT":resp_party_type_flag=1;
break;
case"PAYER":resp_party_type_flag=2;
resp_party_entity_id=formData.payerId;
break;
case"PROVIDER":resp_party_type_flag=3;
resp_party_entity_id=formData.providerId;
break;
case"SERVICE":resp_party_type_flag=4;
resp_party_entity_id=formData.serviceCd;
break;
case"EXTERNAL_BUSINESS":resp_party_type_flag=5;
resp_party_entity_id=formData.businessOrgId;
break;
case"OTHER":resp_party_type_flag=6;
resp_party_entity_id=formData.otherCd;
break;
case"NURSE_UNIT":resp_party_type_flag=7;
resp_party_entity_id=formData.nurseUnitCd;
break;
}var jsonRequest={MODIFY_AVOIDABLE_DAYS_REQUEST:{ENCNTR_AVOIDABLE_DAYS_ID:avoidableDayId,ENCNTR_ID:encounterId,BEG_DT_TM:formData.fromDate.format("dd-mmm-yyyy HH:MM:ss"),END_DT_TM:formData.toDate.format("dd-mmm-yyyy HH:MM:ss"),REASON_TYPE_CD:formData.reasonTypeCd,REASON_CD:formData.reasonCd,COMMENT_TEXT:RCM_Clinical_Util.encodeString(formData.comment),RESP_PARTY_TYPE_FLAG:resp_party_type_flag,RESP_PARTY_ENTITY_ID:resp_party_entity_id,UPDT_CNT:updateCount}};
var sendAr=[];
sendAr.push("^MINE^","0.0","4","^"+JSON.stringify(jsonRequest)+"^");
var status=0;
var info=new XMLCclRequest();
info.onreadystatechange=function(){if(info.readyState===4&&info.status===200){var jsonEval=JSON.parse(info.responseText);
var recordData=jsonEval.RECORD_DATA;
if(recordData.STATUS_DATA.STATUS==="F"){var failureReasonFlag=recordData.FAILURE_REASON_FLAG;
status=failureReasonFlag>0?failureReasonFlag:-1;
}}else{if(info.readyState===4&&info.status!==200){status=-1;
}}};
info.open("GET","rcm_avoidable_days",0);
info.send(sendAr.join(","));
return status;
};
this.deleteAvoidableDays=function(avoidableDayId,updateCount){var jsonRequest={DELETE_AVOIDABLE_DAYS_REQUEST:{ENCNTR_AVOIDABLE_DAYS_ID:avoidableDayId,UPDT_CNT:updateCount}};
var sendAr=[];
sendAr.push("^MINE^","0.0","5","^"+JSON.stringify(jsonRequest)+"^");
var status=0;
var info=new XMLCclRequest();
info.onreadystatechange=function(){if(info.readyState===4&&info.status===200){var jsonEval=JSON.parse(info.responseText);
var recordData=jsonEval.RECORD_DATA;
if(recordData.STATUS_DATA.STATUS==="F"){var failureReasonFlag=recordData.FAILURE_REASON_FLAG;
status=failureReasonFlag>0?failureReasonFlag:-1;
}}else{if(info.readyState===4&&info.status!==200){status=-1;
}}};
info.open("GET","rcm_avoidable_days",0);
info.send(sendAr.join(","));
return status;
};
}
function ClinicalListComponentStyle(){this.initByNamespace("clinical_list");
}ClinicalListComponentStyle.inherits(ComponentStyle);
function ClinicalListComponent(criterion){var enableResultLink=false;
var enableFaxLink=false;
var canAddInd=false;
this.setCriterion(criterion);
this.setStyles(new ClinicalListComponentStyle());
this.setLabel(rcm_clinical_list_i18n.RCM_CLINICAL_REVIEW);
this.setExpanded(true);
this.setIncludeLineNumber(true);
var canPrint;
this.setScope(2);
ClinicalListComponent.method("setFaxLink",function(enableFaxLink){this.enableFaxLink=enableFaxLink;
});
ClinicalListComponent.method("setResultLink",function(enableResultLink){this.enableResultLink=enableResultLink;
});
ClinicalListComponent.method("InsertData",function(){var json={getClinicalReviewsReq:{encounterId:String(this.criterion.encntr_id)}};
var sendAr=[];
sendAr.push("^MINE^","0.0","^GETREVIEWSBYENCOUNTER^","^"+JSON.stringify(json)+"^");
var component=this;
RCM_Clinical_Util.makeTimerCCLRequest(this,"rcm_clinical_review",sendAr,true,function(status,RECORDDATA,errorInfo){if("S"===status){component.HandleSuccess(RECORDDATA);
}else{component.HandleSuccess(null);
}});
});
ClinicalListComponent.method("HandleSuccess",function(recordData){this.canAddInd=recordData.CANADDIND===1;
this.canPrint=recordData.CANPREVIEWIND;
RCM_ClinicalList.renderList(this,recordData);
});
ClinicalListComponent.method("addNewReviewListener",function(newReviewListener){RCM_ClinicalList.newReviewListeners.push(newReviewListener);
});
ClinicalListComponent.method("addReviewSelectedListener",function(reviewSelectedListener){RCM_ClinicalList.reviewSelectedListeners.push(reviewSelectedListener);
});
ClinicalListComponent.method("addFaxListener",function(faxListener){RCM_ClinicalList.faxListeners.push(faxListener);
});
ClinicalListComponent.method("addPrintListener",function(printListener){RCM_ClinicalList.printListeners.push(printListener);
});
ClinicalListComponent.method("openTab",function(recordData){RCM_ClinicalList.newReview();
});
ClinicalListComponent.method("isMostCurrentReviewSelected",function(){return RCM_ClinicalList.isMostCurrentReviewSelected;
});
ClinicalListComponent.method("setMostCurrentReviewSelected",function(setReviewSelected){RCM_ClinicalList.setMostCurrentReviewSelected(setReviewSelected);
});
}ClinicalListComponent.inherits(MPageComponent);
var RCM_ClinicalList=function(){function createHoverSection(commInfo,jsHTML){jsHTML.push("<div class='hvr'>");
jsHTML.push("<dl><dt><span>",rcm_clinical_list_i18n.RCM_DATE_AND_TIME,":</span></dt><dd><span>",RCM_Clinical_Util.formatJsonDateAndTimeString(commInfo.COMMUNICATIONDATE),"</span></dd>");
if(commInfo.COMMUNICATIONTYPEMEANING==="FAX"||commInfo.COMMUNICATIONTYPEMEANING==="MANFAX"){jsHTML.push("<dl><dt><span>",rcm_clinical_list_i18n.RCM_SENT_BY,":</span></dt><dd><span>",commInfo.COMMUNICATIONUSERNAME,"</span></dd>");
}else{jsHTML.push("<dl><dt><span>",rcm_clinical_list_i18n.RCM_SAVED_BY,":</span></dt><dd><span>",commInfo.COMMUNICATIONUSERNAME,"</span></dd>");
}jsHTML.push("<dt><span>",rcm_clinical_list_i18n.RCM_CORRESPONDENCE_TYPE,":</span></dt><dd><span>",commInfo.CORRESPONDENCE_TYPE_DISPLAY,"</span></dd>");
jsHTML.push("<dt><span>",rcm_clinical_list_i18n.RCM_PAYER,":</span></dt><dd><span>",commInfo.PAYERORGNAME,"</span></dd>");
jsHTML.push("<dt><span>",rcm_clinical_list_i18n.RCM_AUTHORIZATION,":</span></dt><dd><span>",commInfo.AUTHORIZATIONNUMBER,"</span></dd>");
if(commInfo.COMMUNICATIONTYPEMEANING==="FAX"||commInfo.COMMUNICATIONTYPEMEANING==="MANFAX"){jsHTML.push("<dt><span>",rcm_clinical_list_i18n.RCM_NUMBER_OF_PAGES_SENT,":</span></dt><dd><span>",commInfo.FAXNUMBEROFPAGES,"</span></dd>");
jsHTML.push("<dt><span>",rcm_clinical_list_i18n.RCM_FAX_NUMBER,":</span></dt><dd><span>",commInfo.FORMATTEDFAXNUMBER,"</span></dd>");
}jsHTML.push("<dt><span>",rcm_clinical_list_i18n.RCM_COMMENT,":</span></dt><dd><span>",RCM_Clinical_Util.decodeString(commInfo.COMMENTTEXT),"</span></dd>");
jsHTML.push("</dl></div>");
}function getOkDialogHTML(){var htmlArray=[];
htmlArray.push("<div id='crvlOkDialog' class='crvl-ok-dialog'>");
htmlArray.push("<div class='crvl-ok-dialog-title-bar'>");
htmlArray.push("<label id='crvlOkDialogTitle'></label></div>");
htmlArray.push("<div class='crvl-ok-dialog-message-area'>");
htmlArray.push("<label id='crvlOkDialogMessage'></label>");
htmlArray.push("</div>");
htmlArray.push("<div class='crvl-ok-dialog-buttons'>");
htmlArray.push("<input id='crvlBtnOk' type='button' value='",rcm_clinical_list_i18n.RCM_OK,"' />");
htmlArray.push("</div></div>");
return htmlArray.join("");
}function createFaxLogDialogHTML(recordData,imagePath){var htmlArray=[];
htmlArray.push("<div class='crvl-message-dialog'>");
htmlArray.push("<div class='crvl-dialog-title-bar'>");
htmlArray.push("<label>",rcm_clinical_list_i18n.RCM_SESSION_LOG,"</label>");
htmlArray.push("</div>");
if(recordData.SESSIONLIST.length>0){htmlArray.push("<div class='crvl-log-header'>");
htmlArray.push("<span class='crvl-log-header-col1'>",rcm_clinical_list_i18n.RCM_DATE_TIME,"</span>");
htmlArray.push("<span class='crvl-log-header-col2'>",rcm_clinical_list_i18n.RCM_MESSAGE_TYPE,"</span>");
htmlArray.push("<span class='crvl-log-header-col3'>",rcm_clinical_list_i18n.RCM_MESSAGE_TEXT,"</span>");
htmlArray.push("</div>");
htmlArray.push("<div class='crvl-message-dialog-grid'>");
for(var i=0;
i<recordData.SESSIONLIST.length;
i++){var sessionMessageList=recordData.SESSIONLIST[i];
var sessNumber=sessionMessageList.SESSIONNUMBER;
htmlArray.push("<div class='sessionSeperator'>");
htmlArray.push("<div class='crvl-session-row'>");
htmlArray.push("<span class='crvl-collapse'> <img src=",imagePath+"5323_collapsed_16.png","></span>");
htmlArray.push("<span class='crvl-sessionID'>",rcm_clinical_list_i18n.RCM_SESSION_NUMBER,sessNumber,"</span>");
htmlArray.push("</div>");
htmlArray.push("<div class='crvl-collapsible'>");
for(var j=0;
j<sessionMessageList.RRDFAXMESSAGELIST.length;
j++){var message=sessionMessageList.RRDFAXMESSAGELIST[j];
htmlArray.push("<div class='crvl-log-row'>");
htmlArray.push("<div class='crvl-log-row-col1'>",RCM_Clinical_Util.formatJsonDateAndTimeString(message.SESSDATETIME),"</div>");
htmlArray.push("<div class='crvl-log-row-col2'>",message.MESSAGETYPEDISP,"</div>");
htmlArray.push("<div class='crvl-log-row-col3'>",RCM_Clinical_Util.decodeString(message.MESSAGETEXT),"</div>");
htmlArray.push("</div>");
}htmlArray.push("</div>");
htmlArray.push("</div>");
}}else{htmlArray.push("<div>");
htmlArray.push("<div>",rcm_clinical_list_i18n.RCM_NO_SESSION_LOG_MESSAGE,"</div>");
htmlArray.push("<div class='crvl-message-dialog-grid'>");
htmlArray.push("</div>");
}htmlArray.push("</div>");
htmlArray.push("<div class='crvl-dialog-buttons-div'>");
htmlArray.push("<input class='crvl-dialog-buttons' type='button' id='crvl-cancel' value=' ",rcm_clinical_list_i18n.RCM_CLOSE," '/>");
htmlArray.push("</div>");
htmlArray.push("</div>");
return htmlArray.join("");
}function openNoHandleIdDialog(msg){$("#crvlOkDialogTitle").html(rcm_clinical_list_i18n.RCM_NO_HANDLE_ID);
$("#crvlOkDialogMessage").html(msg);
$("#crvlOkDialog").show();
var dialogHeight=$("#crvlOkDialog").height();
var dialogWidth=$("#crvlOkDialog").width();
var topPos=($(window).height()-dialogHeight)/2;
var leftPos=($(window).width()-dialogWidth)/2;
$("#crvlOkDialog").css("left",leftPos>0?leftPos:0);
$("#crvlOkDialog").css("top",topPos>0?topPos:0);
}function openFailedFaxLog(msg){$("#crvlOkDialogTitle").html(rcm_clinical_list_i18n.RCM_FAX_LOG_SERVICE_ERROR);
$("#crvlOkDialogMessage").html(msg);
$("#crvlOkDialog").show();
var dialogHeight=$("#crvlOkDialog").height();
var dialogWidth=$("#crvlOkDialog").width();
var topPos=($(window).height()-dialogHeight)/2;
var leftPos=($(window).width()-dialogWidth)/2;
$("#crvlOkDialog").css("left",leftPos>0?leftPos:0);
$("#crvlOkDialog").css("top",topPos>0?topPos:0);
}function openFaxLogDialog(recordData,imagePath){if($(".crvl-message-dialog").length>0){closeFaxLogDialog();
}$(document.body).append("<div class='crvl-message-transparent-dialog'></div>");
$(document.body).append(createFaxLogDialogHTML(recordData,imagePath));
$(".crvl-collapse").click(function(){varParent=$(this).parent().parent();
if($(varParent).find(".crvl-collapsible").is(":visible")){$(varParent).find(".crvl-collapsible").hide();
$(this).html("<img src="+imagePath+"5323_collapsed_16.png>");
}else{$(varParent).find(".crvl-collapsible").show();
$(this).html("<img src="+imagePath+"5323_expanded_16.png>");
}});
$(".crvl-collapsible").hide();
$(".crvl-collapsible").first().show();
$(".crvl-collapse").first().html("<img src="+imagePath+"5323_expanded_16.png>");
var dialogHeight=$(".crvl-message-dialog").height();
var dialogWidth=$(".crvl-message-dialog").width();
var topPos=($(window).height()-dialogHeight)/2;
var leftPos=($(window).width()-dialogWidth)/2;
$(".crvl-message-dialog").css("left",leftPos>0?leftPos:0);
$(".crvl-message-dialog").css("top",topPos>0?topPos:0);
$("#crvl-cancel").click(function(){closeFaxLogDialog();
});
$(window).scroll(repositionFaxLogDialog);
$(window).resize(repositionFaxLogDialog);
}function closeFaxLogDialog(){$(".crvl-message-transparent-dialog").remove();
$(".crvl-message-dialog").remove();
$(window).unbind("scroll");
$(window).unbind("resize");
}function repositionFaxLogDialog(){var dialogHeight=$(".crvl-message-dialog").height();
var dialogWidth=$(".crvl-message-dialog").width();
var scrollTop=document.documentElement.scrollTop;
var topPos=($(window).height()-dialogHeight)/2+scrollTop;
var leftPos=($(window).width()-dialogWidth)/2;
$(".crvl-message-dialog").css("left",leftPos>0?leftPos:0);
$(".crvl-message-dialog").css("top",topPos>0?topPos:0);
}function getPosition(div){var position=$(div).offset();
var cursor={x:0,y:0};
cursor.x=position.left;
cursor.y=position.top+$(div).height();
return cursor;
}return{renderList:function(component,recordData){var reviewCount=0;
var jsHTML=[];
if(component.criterion.encntr_id===0){jsHTML.push("<div>",rcm_clinical_list_i18n.RCM_INVALID_ENCOUNTER_MESSAGE,"</div>");
}else{reviewCount=recordData.CLINICALREVIEWS.length;
if(reviewCount===0){jsHTML.push("<div>",rcm_clinical_list_i18n.RCM_NO_CLINICAL_REVIEW_MESSAGE,"</div>");
}else{var imagePath=component.getCriterion().static_content+"\\images\\";
var secondaryReviewImage=imagePath+"5358.gif";
var addendumImage=imagePath+"4972.gif";
jsHTML.push("<div class='crvl-header'>");
jsHTML.push("<span class='crvl-header-col1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",rcm_clinical_list_i18n.RCM_DATE,"</span>");
jsHTML.push("<span class='crvl-header-col2'>",rcm_clinical_list_i18n.RCM_TYPE,"</span>");
jsHTML.push("<span class='crvl-header-col3'>",rcm_clinical_list_i18n.RCM_STATUS,"</span></div>");
jsHTML.push("<div class='",MP_Util.GetContentClass(component,reviewCount),"'>");
for(var review=0;
review<reviewCount;
review++){var clinicalReview=recordData.CLINICALREVIEWS[review];
jsHTML.push("<div class='crvl-row'>");
jsHTML.push("<div class='crvl-row-col1'>");
var secondaryElementEnd=clinicalReview.SECONDARYREVIEWIND===1?"/>":" class='crvl-invisible'/>";
jsHTML.push("<img src='",secondaryReviewImage,"' alt=''",secondaryElementEnd);
var addendumElementEnd=clinicalReview.ADDENDUMIND===1?"class='crvl-status-image'/>":" class='crvl-status-image crvl-invisible'/>";
jsHTML.push("<img src='",addendumImage,"' alt=''",addendumElementEnd);
if(component.enableResultLink){jsHTML.push("<a onclick='RCM_ClinicalList.reviewSelected(",clinicalReview.CLINICALREVIEWID,")'>");
}jsHTML.push(RCM_Clinical_Util.formatJsonDateString(clinicalReview.REVIEWEDDATE),"</a></div>");
jsHTML.push("<div class='crvl-row-col2'>",clinicalReview.CLINICALREVIEWTYPEDISPLAY,"</div>");
if(clinicalReview.COMMUNICATIONINFO.length>0){for(var j=0;
j<clinicalReview.COMMUNICATIONINFO.length;
j++){var commInfo=clinicalReview.COMMUNICATIONINFO[j];
if(j>0){jsHTML.push("</div>");
jsHTML.push("<div class='crvl-row-no-border'>");
jsHTML.push("<div class='crvl-row-col1'></div>");
jsHTML.push("<div class='crvl-row-col2'></div>");
}jsHTML.push("<div class='crvl-row-col3'>");
if(clinicalReview.CLINICALREVIEWSTATUSMEANING==="ERROR"){jsHTML.push("<span class='crvl-status-error'>",clinicalReview.CLINICALREVIEWSTATUSDISPLAY,"</span>");
}else{if(commInfo.COMMUNICATIONTYPEMEANING==="FAX"){if(commInfo.SHOW_FAILURE_WARNING_IND){jsHTML.push("<span class='crvl-fax-Status crvl-float-left' handleId='",commInfo.HANDLEID,"' >",commInfo.TRANSMISSIONSTATUSDISPLAY?commInfo.TRANSMISSIONSTATUSDISPLAY:commInfo.COMMUNICATIONSTATUSDISPLAY,"</span>");
jsHTML.push("<img class = 'crvl-fax-fail-img' src=",imagePath+"6047_16.png",">");
}else{jsHTML.push("<span class='crvl-fax-Status' handleId='",commInfo.HANDLEID,"' >",commInfo.TRANSMISSIONSTATUSDISPLAY?commInfo.TRANSMISSIONSTATUSDISPLAY:commInfo.COMMUNICATIONSTATUSDISPLAY,"</span>");
}}else{jsHTML.push(commInfo.COMMUNICATIONTYPEDISPLAY);
}}createHoverSection(commInfo,jsHTML);
jsHTML.push("</div>");
}jsHTML.push("</div>");
}else{if(clinicalReview.CLINICALREVIEWSTATUSDISPLAY==="In Error"){jsHTML.push("<div class='crvl-row-col3 crvl-status-error'>",clinicalReview.CLINICALREVIEWSTATUSDISPLAY,"</div>");
}else{jsHTML.push("<div class='crvl-row-col3'>",clinicalReview.CLINICALREVIEWSTATUSDISPLAY,"</div>");
}jsHTML.push("</div>");
}}jsHTML.push("<div class='crvl-height-adj'></div></div>");
}}var sHTML=jsHTML.join("");
var countText=MP_Util.CreateTitleText(component,reviewCount);
MP_Util.Doc.FinalizeComponent(sHTML,component,countText);
$(document.body).append(getOkDialogHTML());
$("#crvlOkDialog").hide();
$(".crvl-fax-Status").click(function(){var handleId=$(this).attr("handleId");
if(handleId){var handler=function(successStatus,recordData){if("S"===successStatus){openFaxLogDialog(recordData,imagePath);
}else{openFailedFaxLog(rcm_clinical_list_i18n.RCM_FAX_LOG_SERVICE_ERROR_MSG);
$("#crvlBtnOk").click(function(){$("#crvlOkDialog").hide();
});
}};
new ClinicalListDelegate().getRRDFaxLog(component,handleId,handler);
}else{openNoHandleIdDialog(rcm_clinical_list_i18n.RCM_NO_HANDLE_ID_TEXT);
$("#crvlBtnOk").click(function(){$("#crvlOkDialog").hide();
});
}});
if(component.enableFaxLink&&component.criterion.encntr_id>0){var menuItems=[];
var menuItem=RCM_DropDownMenu.createMenuItem(rcm_clinical_list_i18n.RCM_COMMUNICATION,function(){RCM_ClinicalList.faxReviews.call(RCM_ClinicalList);
});
var menuItem2=RCM_DropDownMenu.createMenuItem(rcm_clinical_list_i18n.RCM_PRINT,function(){RCM_ClinicalList.printReviews.call(RCM_ClinicalList);
});
if(component.canAddInd){menuItems.push(menuItem);
}else{var addPlus=document.getElementById("clinical_listAdd");
if(addPlus){addPlus.style.display="none";
}}if(component.canPrint===1){menuItems.push(menuItem2);
}if(component.canAddInd||component.canPrint===1){RCM_DropDownMenu.addDropDownMenu(component,"crvlDropDownMenu",menuItems);
}}if(reviewCount>0){var clinicalReviewRows=Util.Style.g("crvl-row-col3",document,"div");
for(var row=0,rowCount=clinicalReviewRows.length;
row<rowCount;
row++){var clinicalReviewRow=clinicalReviewRows[row];
var hoverSections=Util.Style.g("hvr",clinicalReviewRow,"div");
if(hoverSections.length>0){hs(clinicalReviewRow,hoverSections[0]);
}}if(this.isMostCurrentReviewSelected){if(recordData.CLINICALREVIEWS[0].CLINICALREVIEWID){this.reviewSelected(recordData.CLINICALREVIEWS[0].CLINICALREVIEWID);
}}}else{if(this.isMostCurrentReviewSelected){this.newReview();
}}},setMostCurrentReviewSelected:function(setReviewSelected){this.isMostCurrentReviewSelected=setReviewSelected;
},reviewSelectedListeners:[],reviewSelected:function(reviewId){for(var listener=0,length=this.reviewSelectedListeners.length;
listener<length;
listener++){this.reviewSelectedListeners[listener](reviewId);
}},newReviewListeners:[],newReview:function(){for(var listener=0,length=this.newReviewListeners.length;
listener<length;
listener++){this.newReviewListeners[listener]();
}},faxListeners:[],faxReviews:function(){for(var listener=0,length=this.faxListeners.length;
listener<length;
listener++){this.faxListeners[listener]();
}},printListeners:[],printReviews:function(){for(var listener=0,length=this.printListeners.length;
listener<length;
listener++){this.printListeners[listener]();
}}};
}();

function ClinicalListDelegate(){this.getRRDFaxLog=function(component,handleId,callback){var json={getRRDFaxLogRequest:{outputHandleId:String(handleId)}};
var sendAr=[];
sendAr.push("^MINE^","0.0","^GETRRDFAXLOG^","^"+JSON.stringify(json)+"^");
RCM_Clinical_Util.makeCCLRequest("rcm_clinical_review",sendAr,true,callback);
};
}
function RCMDenialAppealFormComponentStyle(){this.initByNamespace("rcm_denial_appeal_form");
this.setHeaderClass("daf-form-header");
}RCMDenialAppealFormComponentStyle.inherits(ComponentStyle);
function RCMDenialAppealFormComponent(criterion){this.setCriterion(criterion);
this.setStyles(new RCMDenialAppealFormComponentStyle());
this.setLabel(rcm_denied_days_i18n.APPEAL_DOCUMENTATION);
this.setAlwaysExpanded(true);
var defaultPayerOrgId;
var defaultDeniedDaysId;
var saveListeners=[];
var deleteListeners=[];
var that=this;
RCMDenialAppealFormComponent.method("InsertData",function(async,payerOrgId,deniedDaysId,denialAppealId){defaultPayerOrgId=payerOrgId||"0";
defaultDeniedDaysId=deniedDaysId||"0";
denialAppealId=denialAppealId||"0";
var sendAr=[];
var json={APPEAL_REQUEST:{ENCNTR_ID:String(this.criterion.encntr_id),ENCNTR_APPEAL_ID:denialAppealId}};
sendAr.push("^MINE^","0.0","6","^",JSON.stringify(json),"^");
MP_Core.XMLCclRequestWrapper(this,"rcm_denied_days",sendAr,async);
});
RCMDenialAppealFormComponent.method("HandleSuccess",function(recordData){var denialAppealInfo={};
denialAppealInfo.canAddModify=recordData.ADD_MODIFY_APPEALS_AUTH_IND===1;
denialAppealInfo.canDelete=recordData.DELETE_APPEALS_AUTH_IND===1;
denialAppealInfo.defaultPayerOrgId=defaultPayerOrgId;
denialAppealInfo.defaultDeniedDaysId=defaultDeniedDaysId;
denialAppealInfo.userName=recordData.USER_NAME_FULL;
denialAppealInfo.isLOC=recordData.LOC_IND;
denialAppealInfo.payers=[];
for(var i=0;
i<recordData.PAYERS.length;
i++){var payer=recordData.PAYERS[i];
var curDenialPeriods=[];
for(var j=0;
j<payer.DENIALS.length;
j++){var denial=payer.DENIALS[j];
var curDenialPeriod={};
curDenialPeriod.deniedDaysId=denial.ENCNTR_DENIED_DAYS_ID;
if(denial.BEG_DT_TM){curDenialPeriod.startDate=new Date();
curDenialPeriod.startDate.setISO8601(denial.BEG_DT_TM);
}if(denial.END_DT_TM){curDenialPeriod.endDate=new Date();
curDenialPeriod.endDate.setISO8601(denial.END_DT_TM);
}curDenialPeriods.push(curDenialPeriod);
}denialAppealInfo.payers.push({id:payer.PAYER_ID,display:payer.PAYER_NAME,denialPeriods:curDenialPeriods});
}denialAppealInfo.levels=[];
for(var i=0;
i<recordData.APPEAL_LEVELS.length;
i++){var appeal_level=recordData.APPEAL_LEVELS[i];
denialAppealInfo.levels.push({id:appeal_level.APPEAL_LEVEL_CD,display:appeal_level.APPEAL_LEVEL_DISPLAY});
}denialAppealInfo.statuses=[];
for(var i=0;
i<recordData.APPEAL_STATUSES.length;
i++){var appeal_status=recordData.APPEAL_STATUSES[i];
denialAppealInfo.statuses.push({id:appeal_status.APPEAL_STATUS_CD,display:appeal_status.APPEAL_STATUS_DISPLAY});
}denialAppealInfo.externalAppealAgencies=[];
for(var i=0;
i<recordData.EXTERNAL_AGENCIES.length;
i++){var external_agency=recordData.EXTERNAL_AGENCIES[i];
denialAppealInfo.externalAppealAgencies.push({id:external_agency.EXT_APPEAL_AGENCY_CD,display:external_agency.EXT_APPEAL_AGENCY_DISPLAY});
}denialAppealInfo.levelsOfCare=[];
for(var i=0;
i<recordData.APPEAL_LEVEL_OF_CARES.length;
i++){var level_of_care=recordData.APPEAL_LEVEL_OF_CARES[i];
denialAppealInfo.levelsOfCare.push({id:level_of_care.APPEAL_LEVEL_OF_CARE_CD,display:level_of_care.APPEAL_LEVEL_OF_CARE_DISPLAY});
}denialAppealInfo.outcomes=[];
for(var i=0;
i<recordData.APPEAL_OUTCOMES.length;
i++){var appeal_outcome=recordData.APPEAL_OUTCOMES[i];
denialAppealInfo.outcomes.push({id:appeal_outcome.APPEAL_OUTCOME_CD,display:appeal_outcome.APPEAL_OUTCOME_DISPLAY});
}denialAppealInfo.communicationTypes=[];
for(var i=0;
i<recordData.APPEAL_COMM_TYPES.length;
i++){var appeal_comm_type=recordData.APPEAL_COMM_TYPES[i];
denialAppealInfo.communicationTypes.push({id:appeal_comm_type.APPEAL_COMM_TYPE_CD,display:appeal_comm_type.APPEAL_COMM_TYPE_DISPLAY});
}var results=recordData.RESULTS;
if(results.length===1){var result=results[0];
var modifyDenialAppeal={};
modifyDenialAppeal.id=result.ENCNTR_APPEAL_ID;
modifyDenialAppeal.updateCount=result.UPDT_CNT;
modifyDenialAppeal.updateUserName=result.UPDT_PRSNL_NAME;
modifyDenialAppeal.payerId=result.PAYER_ORG_ID;
modifyDenialAppeal.externalAppealAgencyCd=result.EXT_APPEAL_AGENCY_CD;
modifyDenialAppeal.appealManagerId=result.APPEAL_PRSNL_ID;
modifyDenialAppeal.appealManagerName=result.APPEAL_PRSNL_NAME;
modifyDenialAppeal.advisorPhysicianId=result.ADVISOR_PRSNL_ID;
modifyDenialAppeal.advisorPhysicianName=result.ADVISOR_PRSNL_NAME;
modifyDenialAppeal.levelCd=result.APPEAL_LEVEL_CD;
modifyDenialAppeal.statusCd=result.APPEAL_STATUS_CD;
if(result.APPEAL_SENT_DT_TM){modifyDenialAppeal.sentDate=new Date();
modifyDenialAppeal.sentDate.setISO8601(result.APPEAL_SENT_DT_TM);
}if(result.APPEAL_VERIFIED_DT_TM){modifyDenialAppeal.verifiedDate=new Date();
modifyDenialAppeal.verifiedDate.setISO8601(result.APPEAL_VERIFIED_DT_TM);
}if(result.APPEAL_EXPECT_RESP_DT_TM){modifyDenialAppeal.expectedResponseDate=new Date();
modifyDenialAppeal.expectedResponseDate.setISO8601(result.APPEAL_EXPECT_RESP_DT_TM);
}if(result.APPEAL_OUTCOME_DT_TM){modifyDenialAppeal.outcomeDate=new Date();
modifyDenialAppeal.outcomeDate.setISO8601(result.APPEAL_OUTCOME_DT_TM);
}modifyDenialAppeal.communicationTypeCd=result.APPEAL_COMM_TYPE_CD;
modifyDenialAppeal.trackingNumber=RCM_Clinical_Util.decodeString(result.TRACKING_NBR_TEXT);
modifyDenialAppeal.providedLOCCd=result.PROVIDED_LEVEL_OF_CARE_CD;
modifyDenialAppeal.preAppealLOCCd=result.PRE_LEVEL_OF_CARE_CD;
modifyDenialAppeal.postAppealLOCCd=result.POST_LEVEL_OF_CARE_CD;
modifyDenialAppeal.outcomeCd=result.APPEAL_OUTCOME_CD;
modifyDenialAppeal.comment=RCM_Clinical_Util.decodeString(result.COMMENT_TEXT);
modifyDenialAppeal.deniedDaysIds=[];
for(var i=0;
i<result.DENIALS.length;
i++){var denial=result.DENIALS[i];
modifyDenialAppeal.deniedDaysIds.push(denial.ENCNTR_DENIED_DAYS_ID);
}}var staticContent=this.getCriterion().static_content;
var imagesPath=staticContent+"\\images\\";
var denialAppealForm=new RCMDenialAppealForm(String(this.criterion.encntr_id),denialAppealInfo,modifyDenialAppeal,imagesPath);
denialAppealForm.addSaveCompleteListener(function(){that.InsertData();
for(var i=0;
i<saveListeners.length;
i++){saveListeners[i]();
}});
denialAppealForm.addDeleteListener(function(){that.InsertData();
for(var i=0;
i<deleteListeners.length;
i++){deleteListeners[i]();
}});
MP_Util.Doc.FinalizeComponent(denialAppealForm.getHTML(),this,"");
denialAppealForm.initialize(this);
});
RCMDenialAppealFormComponent.method("addSaveListener",function(listener){saveListeners.push(listener);
});
RCMDenialAppealFormComponent.method("addDeleteListener",function(listener){deleteListeners.push(listener);
});
}RCMDenialAppealFormComponent.inherits(MPageComponent);
function RCMDenialAppealForm(encounterId,denialAppealInfo,modifyDenialAppeal,imagesPath){var closeDenialsIndicator=0;
var serviceDelegate=new DeniedDaysDelegate();
var appealManagerControl;
var saveCompleteListeners=[];
var deleteListeners=[];
var formObject={};
var flexButtonIds=["dafBtnSave"];
var expandImagePath=imagesPath+"5323_expanded_16.png";
var collapsedImagePath=imagesPath+"5323_collapsed_16.png";
this.addSaveCompleteListener=function(listener){saveCompleteListeners.push(listener);
};
this.addDeleteListener=function(listener){deleteListeners.push(listener);
};
this.getHTML=function(){var htmlArray=[];
htmlArray.push("<div id='dafPageContent'>");
htmlArray.push("<div>");
htmlArray.push("<span class='daf-sent-title' id='dafSentDateTitle'></span>");
htmlArray.push("<div class='daf-documentation-labels'>");
htmlArray.push("<span>",rcm_denied_days_i18n.DOCUMENTED_BY,"</span>");
htmlArray.push("<span id='dafUserName'></span>");
htmlArray.push("</div>");
htmlArray.push("</div>");
htmlArray.push("<div class='daf-form-separator'></div>");
htmlArray.push("<form name='denialAppealForm'>");
htmlArray.push("<div id='dafScrollableContentContainer'>");
htmlArray.push("<div id='dafScrollableContent'>");
htmlArray.push("<div class='daf-control-group'>");
htmlArray.push("<div class='daf-control-group-section'>");
htmlArray.push(createDropDownHTML("dafPayer",rcm_denied_days_i18n.PAYER,denialAppealInfo.payers));
htmlArray.push(createDropDownHTML("dafExternalAppealAgency",rcm_denied_days_i18n.EXTERNAL_APPEAL_AGENCY,denialAppealInfo.externalAppealAgencies));
htmlArray.push("<div class='daf-control-container'>");
htmlArray.push("<label class='daf-control-label' for='dafAppealManager'>",rcm_denied_days_i18n.APPEAL_MANAGER,"</label>");
htmlArray.push("<input type='text' class='searchText daf-provider-search-field' id='dafAppealManager' name='dafAppealManager' />");
htmlArray.push("<label class='daf-control-label daf-control-padding' for='dafPhysicianAdvisor'>",rcm_denied_days_i18n.PHYSICIAN_ADVISOR,"</label>");
htmlArray.push("<input type='text' class='searchText daf-provider-search-field' id='dafPhysicianAdvisor' name='dafPhysicianAdvisor' />");
htmlArray.push("</div>");
htmlArray.push("</div>");
htmlArray.push("<div class='daf-control-group-section'>");
htmlArray.push("<div id='dafDenialPeriodsContainer' class='daf-control-container'>");
htmlArray.push("<label class='daf-control-label' for='dafDenialPeriods'>",rcm_denied_days_i18n.DENIALS_BEING_APPEALED,"</label>");
htmlArray.push("<select multiple='multiple' id='dafDenialPeriods' class='daf-multi-select-field' name='dafDenialPeriods'></select>");
htmlArray.push("</div>");
htmlArray.push("</div>");
htmlArray.push("</div>");
htmlArray.push("<div class='daf-control-group'>");
htmlArray.push(createDropDownHTML("dafLevel",rcm_denied_days_i18n.LEVEL,denialAppealInfo.levels));
htmlArray.push(createDropDownHTML("dafStatus",rcm_denied_days_i18n.STATUS,denialAppealInfo.statuses));
htmlArray.push("</div>");
htmlArray.push("<div>");
htmlArray.push("<div class='daf-section-header'>",rcm_denied_days_i18n.PAYER_COMMUNICATION,"</div>");
htmlArray.push("<div class='daf-section-separator'></div>");
htmlArray.push("<div class='daf-control-group'>");
htmlArray.push(createDateFieldHTML("dafSentDate",rcm_denied_days_i18n.SENT_DATE));
htmlArray.push(createDateFieldHTML("dafVerifiedDate",rcm_denied_days_i18n.VERIFIED_DATE));
htmlArray.push(createDateFieldHTML("dafExpectedResponseDate",rcm_denied_days_i18n.EXPECTED_RESPONSE_DATE));
htmlArray.push("</div>");
htmlArray.push("<div class='daf-control-group'>");
htmlArray.push(createDropDownHTML("dafCommunicationType",rcm_denied_days_i18n.COMMUNICATION_TYPE,denialAppealInfo.communicationTypes));
htmlArray.push(createTextFieldHTML("dafTrackingNumber",rcm_denied_days_i18n.TRACKING_NUMBER));
htmlArray.push("</div>");
htmlArray.push("</div>");
htmlArray.push("<div>");
htmlArray.push("<div class='daf-section-header'>",rcm_denied_days_i18n.OUTCOME,"</div>");
htmlArray.push("<div class='daf-section-separator'></div>");
htmlArray.push("<div class='daf-control-group'>");
htmlArray.push(createDateFieldHTML("dafOutcomeDate",rcm_denied_days_i18n.DATE));
htmlArray.push(createDropDownHTML("dafOutcome",rcm_denied_days_i18n.OUTCOME,denialAppealInfo.outcomes));
htmlArray.push("</div>");
htmlArray.push("<div class='daf-control-group'>");
if(denialAppealInfo.isLOC===1){htmlArray.push(createDropDownHTML("dafProvidedLOC",rcm_denied_days_i18n.PROVIDED_LOC,denialAppealInfo.levelsOfCare));
htmlArray.push(createDropDownHTML("dafPreAppealLOC",rcm_denied_days_i18n.PRE_APPEAL_LOC,denialAppealInfo.levelsOfCare));
htmlArray.push(createDropDownHTML("dafPostAppealLOC",rcm_denied_days_i18n.POST_APPEAL_LOC,denialAppealInfo.levelsOfCare));
}htmlArray.push("</div>");
htmlArray.push("</div>");
htmlArray.push("<div>");
htmlArray.push("<div class='daf-section-header'>",rcm_denied_days_i18n.COMMENT,"</div>");
htmlArray.push("<div class='daf-section-separator'></div>");
htmlArray.push("<div class='daf-control-group'>");
htmlArray.push("<textarea id='dafComment'></textarea>");
htmlArray.push("</div>");
htmlArray.push("</div>");
htmlArray.push("</div>");
htmlArray.push("<div id='dafButtonsContent'>");
htmlArray.push(getButtonsHTML());
htmlArray.push("</div>");
htmlArray.push("<div class='daf-stop-float'></div>");
htmlArray.push("</form>");
htmlArray.push(getYesNoDialogHTML());
htmlArray.push(getOkDialogHTML());
htmlArray.push(getCloseDenialMessage());
htmlArray.push("</div>");
return htmlArray.join("");
};
this.initialize=function(component){RCM_Clinical_Util.addDatePicker(component,"dafSentDate");
RCM_Clinical_Util.addDatePicker(component,"dafVerifiedDate");
RCM_Clinical_Util.addDatePicker(component,"dafExpectedResponseDate");
RCM_Clinical_Util.addDatePicker(component,"dafOutcomeDate");
appealManagerControl=new ProviderSearchControl(document.getElementById("dafAppealManager"));
physicianAdvisorControl=new ProviderSearchControl(document.getElementById("dafPhysicianAdvisor"));
physicianAdvisorControl.enableProviderSearchOrgSecurity(false);
physicianAdvisorControl.enablePhysicianOnlySearch(true);
$("#dafPayer").change(function(){populateDenialPeriods();
});
$("#dafBtnSave").click(function(){saveForm();
});
$("#dafBtnCloseDenial").click(function(){setFormEnabledForDialog(true);
$("#dafCloseDenialDialog").hide();
closeDenialsIndicator=1;
if(modifyDenialAppeal){modifyDenialAppealFormSave();
}else{addDenialAppealFormSave();
}});
$("#dafBtnLeaveOpenDenial").click(function(){setFormEnabledForDialog(true);
$("#dafCloseDenialDialog").hide();
closeDenialsIndicator=0;
if(modifyDenialAppeal){modifyDenialAppealFormSave();
}else{addDenialAppealFormSave();
}});
$("#dafBtnNo").click(function(){setFormEnabledForDialog(true);
document.getElementById("dafYesNoDialog").style.display="none";
});
$("#dafBtnOk").click(function(){setFormEnabledForDialog(true);
document.getElementById("dafOkDialog").style.display="none";
});
$("#dafBtnCancel").click(function(){openCancelDialog();
});
if(denialAppealInfo.canAddModify){RCM_Clinical_Util.addRequiredField(formObject,"dafPayer","select",flexButtonIds);
RCM_Clinical_Util.addRequiredField(formObject,"dafLevel","select",flexButtonIds);
RCM_Clinical_Util.addRequiredField(formObject,"dafStatus","select",flexButtonIds);
RCM_Clinical_Util.addRequiredField(formObject,"dafDenialPeriods","select",flexButtonIds);
RCM_Clinical_Util.addRequiredField(formObject,"dafSentDate","date",flexButtonIds);
RCM_Clinical_Util.setSearchControlRequired(true,formObject,"dafAppealManager",appealManagerControl,flexButtonIds);
}if(modifyDenialAppeal){$("#dafUserName").html(modifyDenialAppeal.updateUserName);
var sentDate=modifyDenialAppeal.sentDate;
$("#dafSentDateTitle").html(sentDate?RCM_Clinical_Util.formatDate(sentDate):"");
}else{$("#dafUserName").html(denialAppealInfo.userName);
}setupForm();
if(modifyDenialAppeal&&denialAppealInfo.canDelete){var menuItems=[];
menuItems.push(RCM_DropDownMenu.createMenuItem(rcm_denied_days_i18n.DELETE_APPEAL,function(){if(RCM_DropDownMenu.isMenuItemEnabled("dafDropDownMenu","dafItemDelete")){openDeleteDialog();
}},"dafItemDelete"));
RCM_DropDownMenu.addDropDownMenu(component,"dafDropDownMenu",menuItems);
}else{RCM_DropDownMenu.removeDropDownMenu("dafDropDownMenu");
}if(!denialAppealInfo.canAddModify){setFormEnabled(false);
}};
var setupForm=function(){if(modifyDenialAppeal){setDenialAppealToForm(modifyDenialAppeal);
}else{if(denialAppealInfo.defaultPayerOrgId&&denialAppealInfo.defaultPayerOrgId!=="0"){$("#dafPayer").val(denialAppealInfo.defaultPayerOrgId);
populateDenialPeriods();
if(denialAppealInfo.defaultDeniedDaysId){$("#dafDenialPeriods").val(denialAppealInfo.defaultDeniedDaysId);
}}else{if(denialAppealInfo.payers.length>0){$("#dafPayer").val(denialAppealInfo.payers[0].id);
populateDenialPeriods();
}}RCM_Clinical_Util.setDate("dafSentDate",null);
RCM_Clinical_Util.setDate("dafVerifiedDate",null);
RCM_Clinical_Util.setDate("dafExpectedResponseDate",null);
RCM_Clinical_Util.setDate("dafOutcomeDate",null);
}RCM_Clinical_Util.performRequiredFieldChecks(formObject);
};
var populateDenialPeriods=function(){var $dafDenialPeriods=$("#dafDenialPeriods");
$dafDenialPeriods.children().remove();
var payerId=$("#dafPayer").val();
if(payerId!=="0"){for(var i=0,length=denialAppealInfo.payers.length;
i<length;
i++){var payer=denialAppealInfo.payers[i];
if(payerId===payer.id){var denialsHTML=[];
for(var j=0;
j<payer.denialPeriods.length;
j++){var denialPeriod=payer.denialPeriods[j];
denialsHTML.push("<option value='",denialPeriod.deniedDaysId,"'>",getDeniedDaysFormattedDateString(denialPeriod.startDate,denialPeriod.endDate),"</option>");
}$dafDenialPeriods.html(denialsHTML.join(""));
$dafDenialPeriods.hide().show();
break;
}}}};
var setFormEnabled=function(enabled){$(".daf-drop-down").attr("disabled",!enabled);
$(".daf-text-field").attr("disabled",!enabled);
$(".daf-multi-select-field").attr("disabled",!enabled);
$(".daf-provider-search-field").attr("disabled",!enabled);
$(".daf-date-field").datepicker(enabled?"enable":"disable");
$("#dafComment").attr("disabled",!enabled);
};
var setDenialAppealToForm=function(denialAppeal){$("#dafPayer").val(denialAppeal.payerId);
populateDenialPeriods();
$("#dafDenialPeriods").val(denialAppeal.deniedDaysIds);
$("#dafExternalAppealAgency").val(denialAppeal.externalAppealAgencyCd);
appealManagerControl.setSelectedProvider(parseInt(denialAppeal.appealManagerId),denialAppeal.appealManagerName);
physicianAdvisorControl.setSelectedProvider(parseInt(denialAppeal.advisorPhysicianId),denialAppeal.advisorPhysicianName);
$("#dafLevel").val(denialAppeal.levelCd);
$("#dafStatus").val(denialAppeal.statusCd);
RCM_Clinical_Util.setDate("dafSentDate",denialAppeal.sentDate);
RCM_Clinical_Util.setDate("dafVerifiedDate",denialAppeal.verifiedDate);
RCM_Clinical_Util.setDate("dafExpectedResponseDate",denialAppeal.expectedResponseDate);
$("#dafCommunicationType").val(denialAppeal.communicationTypeCd);
$("#dafTrackingNumber").val(denialAppeal.trackingNumber);
RCM_Clinical_Util.setDate("dafOutcomeDate",denialAppeal.outcomeDate);
$("#dafProvidedLOC").val(denialAppeal.providedLOCCd);
$("#dafPreAppealLOC").val(denialAppeal.preAppealLOCCd);
$("#dafPostAppealLOC").val(denialAppeal.postAppealLOCCd);
$("#dafOutcome").val(denialAppeal.outcomeCd);
$("#dafComment").val(denialAppeal.comment);
};
var saveForm=function(){if(modifyDenialAppeal){if($("#dafOutcomeDate").datepicker("getDate")){openCloseDenialMessage();
}else{modifyDenialAppealFormSave();
}}else{if($("#dafOutcomeDate").datepicker("getDate")){openCloseDenialMessage();
}else{addDenialAppealFormSave();
}}};
var addDenialAppealFormSave=function(){var denialAppeal={};
denialAppeal.payerId=$("#dafPayer").val();
denialAppeal.deniedDaysIds=$("#dafDenialPeriods").val()||[];
denialAppeal.externalAppealAgencyCd=$("#dafExternalAppealAgency").val();
denialAppeal.appealManagerId=String(appealManagerControl.getSelectedProviderId());
denialAppeal.advisorPhysicianId=String(physicianAdvisorControl.getSelectedProviderId());
denialAppeal.levelCd=$("#dafLevel").val();
denialAppeal.statusCd=$("#dafStatus").val();
denialAppeal.sentDate=$("#dafSentDate").datepicker("getDate");
denialAppeal.verifiedDate=$("#dafVerifiedDate").datepicker("getDate");
denialAppeal.expectedResponseDate=$("#dafExpectedResponseDate").datepicker("getDate");
denialAppeal.communicationTypeCd=$("#dafCommunicationType").val();
denialAppeal.trackingNumber=$("#dafTrackingNumber").val();
denialAppeal.outcomeDate=$("#dafOutcomeDate").datepicker("getDate");
denialAppeal.providedLOCCd=$("#dafProvidedLOC").val();
denialAppeal.preAppealLOCCd=$("#dafPreAppealLOC").val();
denialAppeal.postAppealLOCCd=$("#dafPostAppealLOC").val();
denialAppeal.outcomeCd=$("#dafOutcome").val();
denialAppeal.comment=$("#dafComment").val();
var status=serviceDelegate.addDenialAppeal(denialAppeal,encounterId,closeDenialsIndicator);
if(status===0){for(var i=0,length=saveCompleteListeners.length;
i<length;
i++){saveCompleteListeners[i]();
}}else{switch(status){case 1:openStaleDataDialog();
break;
default:openSaveFailedDialog();
break;
}}};
var modifyDenialAppealFormSave=function(){var denialAppeal={};
denialAppeal.payerId=$("#dafPayer").val();
denialAppeal.deniedDaysIds=$("#dafDenialPeriods").val()||[];
denialAppeal.externalAppealAgencyCd=$("#dafExternalAppealAgency").val();
denialAppeal.appealManagerId=String(appealManagerControl.getSelectedProviderId());
denialAppeal.advisorPhysicianId=String(physicianAdvisorControl.getSelectedProviderId());
denialAppeal.levelCd=$("#dafLevel").val();
denialAppeal.statusCd=$("#dafStatus").val();
denialAppeal.sentDate=$("#dafSentDate").datepicker("getDate");
denialAppeal.verifiedDate=$("#dafVerifiedDate").datepicker("getDate");
denialAppeal.expectedResponseDate=$("#dafExpectedResponseDate").datepicker("getDate");
denialAppeal.communicationTypeCd=$("#dafCommunicationType").val();
denialAppeal.trackingNumber=$("#dafTrackingNumber").val();
denialAppeal.outcomeDate=$("#dafOutcomeDate").datepicker("getDate");
denialAppeal.providedLOCCd=$("#dafProvidedLOC").val();
denialAppeal.preAppealLOCCd=$("#dafPreAppealLOC").val();
denialAppeal.postAppealLOCCd=$("#dafPostAppealLOC").val();
denialAppeal.outcomeCd=$("#dafOutcome").val();
denialAppeal.comment=$("#dafComment").val();
var status=serviceDelegate.modifyDenialAppeal(denialAppeal,encounterId,modifyDenialAppeal.id,modifyDenialAppeal.updateCount,closeDenialsIndicator);
if(status===0){for(var i=0,length=saveCompleteListeners.length;
i<length;
i++){saveCompleteListeners[i]();
}}else{switch(status){case 1:openStaleDataDialog();
break;
default:openSaveFailedDialog();
break;
}}};
var getButtonsHTML=function(){var htmlArray=[];
if(denialAppealInfo.canAddModify){htmlArray.push("<div id='dafSaveCancelContainer'>");
htmlArray.push("<input type='button' id='dafBtnSave' class='daf-action-button' value='"+rcm_denied_days_i18n.SAVE+"' />");
htmlArray.push("<input type='button' id='dafBtnCancel' class='daf-action-button' value='"+rcm_denied_days_i18n.CANCEL+"' />");
htmlArray.push("</div>");
}return htmlArray.join("");
};
var createDropDownHTML=function(name,label,items){var htmlArray=[];
var id=name;
htmlArray.push("<div id='",name,"Container' class='daf-control-container'>");
htmlArray.push("<label class='daf-control-label' for='",id,"'>",label,"</label>");
htmlArray.push("<select id='",id,"' class='daf-drop-down' name='",name,"'>");
htmlArray.push("<option value='0'></option>");
for(var i=0,length=items.length;
i<length;
i++){var item=items[i];
htmlArray.push("<option value='",item.id,"'>",item.display,"</option>");
}htmlArray.push("</select>");
htmlArray.push("</div>");
return htmlArray.join("");
};
var createDateFieldHTML=function(name,label){var htmlArray=[];
var id=name;
htmlArray.push("<div class='daf-control-container'>");
htmlArray.push("<label class='daf-control-label' for='",id,"'>",label,"</label>");
htmlArray.push("<input id='",id,"' class='daf-date-field' type='text' name='",name,"' maxlength='10' />");
htmlArray.push("</div>");
return htmlArray.join("");
};
var createTextFieldHTML=function(name,label){var htmlArray=[];
var id=name;
htmlArray.push("<div class='daf-control-container'>");
htmlArray.push("<label class='daf-control-label' for='",id,"'>",label,"</label>");
htmlArray.push("<input id='",id,"' class='daf-text-field' type='text' name='",name,"' />");
htmlArray.push("</div>");
return htmlArray.join("");
};
var getYesNoDialogHTML=function(){var htmlArray=[];
htmlArray.push("<div id='dafYesNoDialog' class='daf-dialog'>");
htmlArray.push("<div class='daf-dialog-title-bar'>");
htmlArray.push("<label id='dafYesNoDialogTitle'></label>","</div>");
htmlArray.push("<div class='daf-dialog-message-area'>");
htmlArray.push("<label id='dafYesNoDialogMessage'></label>");
htmlArray.push("</div>");
htmlArray.push("<div class='daf-dialog-buttons'>");
htmlArray.push("<input id='dafBtnNo' type='button' value='",rcm_denied_days_i18n.NO,"' />");
htmlArray.push("<input id='dafBtnYes' type='button' value='",rcm_denied_days_i18n.YES,"' />");
htmlArray.push("</div></div>");
return htmlArray.join("");
};
var getOkDialogHTML=function(){var htmlArray=[];
htmlArray.push("<div id='dafOkDialog' class='daf-dialog'>");
htmlArray.push("<div class='daf-dialog-title-bar'>");
htmlArray.push("<label id='dafOkDialogTitle'></label>","</div>");
htmlArray.push("<div class='daf-dialog-message-area'>");
htmlArray.push("<label id='dafOkDialogMessage'></label>");
htmlArray.push("</div>");
htmlArray.push("<div class='daf-dialog-buttons'>");
htmlArray.push("<input id='dafBtnOk' type='button' value='",rcm_denied_days_i18n.OK,"' />");
htmlArray.push("</div></div>");
return htmlArray.join("");
};
var getCloseDenialMessage=function(){var htmlArray=[];
htmlArray.push("<div id='dafCloseDenialDialog' class='daf-dialog'>");
htmlArray.push("<div class='daf-dialog-title-bar'>");
htmlArray.push("<label id='dafCloseDenialDialogTitle'></label>","</div>");
htmlArray.push("<div class='daf-dialog-message-area'>");
htmlArray.push("<label id='dafCloseDenialDialogMessage'></label>");
htmlArray.push("</div>");
htmlArray.push("<div class='daf-dialog-buttons'>");
htmlArray.push("<input id='dafBtnCloseDenial' type='button' value='",rcm_denied_days_i18n.CLOSE_DENIAL,"' />");
htmlArray.push("<input id='dafBtnLeaveOpenDenial' type='button' value='",rcm_denied_days_i18n.LEAVE_OPEN,"' />");
htmlArray.push("</div></div>");
return htmlArray.join("");
};
var openCloseDenialMessage=function(){var closeDenialMessageArray=[];
var selectedCount=$("#dafDenialPeriods>option:selected").length;
if(selectedCount>1){$("#dafCloseDenialDialogTitle").html(rcm_denied_days_i18n.CLOSE_DENIALS);
$("#dafBtnCloseDenial").val(rcm_denied_days_i18n.CLOSE_DENIALS);
closeDenialMessageArray.push(rcm_denied_days_i18n.CLOSE_DENIALS_MESSAGE);
}else{$("#dafCloseDenialDialogTitle").html(rcm_denied_days_i18n.CLOSE_DENIAL);
closeDenialMessageArray.push(rcm_denied_days_i18n.CLOSE_DENIAL_MESSAGE);
}closeDenialMessageArray.push("<br>");
if(selectedCount>1){$("#dafDenialPeriods option:selected").each(function(index){closeDenialMessageArray.push($(this).text());
closeDenialMessageArray.push("<br>");
});
}$("#dafCloseDenialDialogMessage").html(closeDenialMessageArray.join(""));
setFormEnabledForDialog(false);
$("#dafCloseDenialDialog").show();
};
var openStaleDataDialog=function(){$("#dafOkDialogTitle").html(rcm_denied_days_i18n.STALE_DATA_TITLE);
$("#dafOkDialogMessage").html(rcm_denied_days_i18n.STALE_APPEAL_DATA_MESSAGE);
setFormEnabledForDialog(false);
document.getElementById("dafOkDialog").style.display="block";
};
var openSaveFailedDialog=function(){$("#dafOkDialogTitle").html(rcm_denied_days_i18n.SAVE_FAILED_TITLE);
$("#dafOkDialogMessage").html(rcm_denied_days_i18n.SAVE_FAILED_MESSAGE);
setFormEnabledForDialog(false);
document.getElementById("dafOkDialog").style.display="block";
};
var openDeleteFailedDialog=function(){$("#dafOkDialogTitle").html(rcm_denied_days_i18n.DELETE_FAILED_TITLE);
$("#dafOkDialogMessage").html(rcm_denied_days_i18n.DELETE_FAILED_MESSAGE);
setFormEnabledForDialog(false);
document.getElementById("dafOkDialog").style.display="block";
};
var openDeleteDialog=function(){$("#dafYesNoDialogTitle").html(rcm_denied_days_i18n.DELETE_APPEAL_TITLE);
$("#dafYesNoDialogMessage").html(rcm_denied_days_i18n.DELETE_APPEAL_MESSAGE);
setFormEnabledForDialog(false);
document.getElementById("dafYesNoDialog").style.display="block";
$("#dafBtnYes").unbind("click").click(function(){var status=serviceDelegate.deleteDenialAppeal(modifyDenialAppeal.id,modifyDenialAppeal.updateCount);
setFormEnabledForDialog(true);
document.getElementById("dafYesNoDialog").style.display="none";
if(status===0){for(var i=0,length=deleteListeners.length;
i<length;
i++){deleteListeners[i]();
}}else{switch(status){case 1:openStaleDataDialog();
break;
default:openDeleteFailedDialog();
break;
}}});
};
var openCancelDialog=function(){$("#dafYesNoDialogTitle").html(rcm_denied_days_i18n.CANCEL);
$("#dafYesNoDialogMessage").html(rcm_denied_days_i18n.CANCEL_MESSAGE);
setFormEnabledForDialog(false);
document.getElementById("dafYesNoDialog").style.display="block";
$("#dafBtnYes").unbind("click").click(function(){document.denialAppealForm.reset();
populateDenialPeriods();
setFormEnabledForDialog(true);
setupForm();
document.getElementById("dafYesNoDialog").style.display="none";
});
};
var setFormEnabledForDialog=function(enabled){var saveButton=document.getElementById("dafBtnSave");
if(saveButton){saveButton.disabled=!enabled||RCM_Clinical_Util.isAnyFieldRequired(formObject);
}var cancelButton=document.getElementById("dafBtnCancel");
if(cancelButton){cancelButton.disabled=!enabled;
}RCM_DropDownMenu.setMenuItemEnabled("dafDropDownMenu","dafItemDelete",enabled);
setFormEnabled(enabled&&denialAppealInfo.canAddModify);
};
var getDeniedDaysFormattedDateString=function(startDate,endDate){if(startDate&&endDate){if((startDate.getMonth()===endDate.getMonth())&&(startDate.getDate()===endDate.getDate())&&(startDate.getFullYear()===endDate.getFullYear())){return RCM_Clinical_Util.formatDate(startDate);
}return RCM_Clinical_Util.formatDate(startDate)+" - "+RCM_Clinical_Util.formatDate(endDate);
}return"";
};
}
function RCMDeniedDaysFormComponentStyle(){this.initByNamespace("rcm_denied_days_form");
this.setHeaderClass("ddf-form-header");
}RCMDeniedDaysFormComponentStyle.inherits(ComponentStyle);
function RCMDeniedDaysFormComponent(criterion){this.setCriterion(criterion);
this.setStyles(new RCMDeniedDaysFormComponentStyle());
this.setLabel(rcm_denied_days_i18n.DENIED_DAYS_DOCUMENTATION);
this.setAlwaysExpanded(true);
var saveListeners=[];
var addAppealListeners=[];
var deleteListeners=[];
var that=this;
RCMDeniedDaysFormComponent.method("InsertData",function(async,deniedDaysId){deniedDaysId=deniedDaysId||"0";
var serviceDelegate=new DeniedDaysDelegate();
var component=this;
serviceDelegate.getDeniedDaysForForm(deniedDaysId,String(this.criterion.encntr_id),function(recordData,errorMessage){if(recordData&&recordData.STATUS_DATA.STATUS==="S"){component.HandleSuccess(recordData);
}else{component.HandleSuccess(null);
}});
});
RCMDeniedDaysFormComponent.method("HandleSuccess",function(recordData){var deniedDaysInfo=null;
if(recordData){deniedDaysInfo={};
deniedDaysInfo.canAddModify=recordData.ADD_MODIFY_DENIALS_AUTH_IND===1;
deniedDaysInfo.canDelete=recordData.DELETE_DENIALS_AUTH_IND===1;
deniedDaysInfo.userName=recordData.USER_NAME_FULL;
if(recordData.REG_DT_TM){deniedDaysInfo.registrationDate=new Date();
deniedDaysInfo.registrationDate.setISO8601(recordData.REG_DT_TM);
}if(recordData.INPAT_ADMIT_DT_TM){deniedDaysInfo.inpatientAdmitDate=new Date();
deniedDaysInfo.inpatientAdmitDate.setISO8601(recordData.INPAT_ADMIT_DT_TM);
}if(recordData.DISCH_DT_TM){deniedDaysInfo.dischargeDate=new Date();
deniedDaysInfo.dischargeDate.setISO8601(recordData.DISCH_DT_TM);
}deniedDaysInfo.facilityName=recordData.ENCNTR_FACILITY_NAME;
deniedDaysInfo.nurseUnitCd=recordData.ENCNTR_NURSE_UNIT_CD;
deniedDaysInfo.denialCategories=[];
for(var i=0;
i<recordData.DENIAL_CATEGORIES.length;
i++){var denial_category=recordData.DENIAL_CATEGORIES[i];
deniedDaysInfo.denialCategories.push({id:denial_category.DENIAL_CATEGORY_CD,display:denial_category.DENIAL_CATEGORY_DISPLAY});
}deniedDaysInfo.denialTypes=[];
for(var i=0;
i<recordData.DENIAL_TYPES.length;
i++){var denial_type=recordData.DENIAL_TYPES[i];
deniedDaysInfo.denialTypes.push({id:denial_type.DENIAL_TYPE_CD,display:denial_type.DENIAL_TYPE_DISPLAY});
}deniedDaysInfo.denialReasons=[];
for(var i=0;
i<recordData.DENIAL_REASONS.length;
i++){var denial_reason=recordData.DENIAL_REASONS[i];
deniedDaysInfo.denialReasons.push({id:denial_reason.DENIAL_REASON_CD,display:denial_reason.DENIAL_REASON_DISPLAY});
}deniedDaysInfo.payers=[];
for(var i=0;
i<recordData.PAYERS.length;
i++){var payer=recordData.PAYERS[i];
deniedDaysInfo.payers.push({id:payer.PAYER_ID,display:payer.PAYER_NAME});
}deniedDaysInfo.services=[];
for(var i=0;
i<recordData.RESPONS_PARTY_SERVICES.length;
i++){var respons_party_service=recordData.RESPONS_PARTY_SERVICES[i];
deniedDaysInfo.services.push({id:respons_party_service.SERVICE_CD,display:respons_party_service.SERVICE_DISPLAY});
}deniedDaysInfo.others=[];
for(var i=0;
i<recordData.RESPONS_PARTY_OTHERS.length;
i++){var respons_party_others=recordData.RESPONS_PARTY_OTHERS[i];
deniedDaysInfo.others.push({id:respons_party_others.OTHER_CD,display:respons_party_others.OTHER_DISPLAY});
}deniedDaysInfo.nurseUnits=[];
for(var i=0;
i<recordData.NURSE_UNITS.length;
i++){var nurse_unit=recordData.NURSE_UNITS[i];
deniedDaysInfo.nurseUnits.push({id:nurse_unit.NURSE_UNIT_CD,display:nurse_unit.NURSE_UNIT_NAME});
}var results=recordData.RESULTS;
if(results.length===1){var result=results[0];
var modifyDeniedDays={};
modifyDeniedDays.id=result.ENCNTR_DENIED_DAYS_ID;
modifyDeniedDays.updateCount=result.UPDT_CNT;
modifyDeniedDays.updateUserName=result.UPDT_PRSNL_NAME;
if(result.BEG_DT_TM){modifyDeniedDays.startDate=new Date();
modifyDeniedDays.startDate.setISO8601(result.BEG_DT_TM);
}if(result.END_DT_TM){modifyDeniedDays.endDate=new Date();
modifyDeniedDays.endDate.setISO8601(result.END_DT_TM);
}modifyDeniedDays.denialCategoryCd=result.DENIAL_CATEGORY_CD;
modifyDeniedDays.denialTypeCd=result.DENIAL_TYPE_CD;
modifyDeniedDays.denialReasonCd=result.DENIAL_REASON_CD;
modifyDeniedDays.payerId=result.PAYER_ORG_ID;
modifyDeniedDays.denialManagerId=result.DENIAL_PRSNL_ID;
modifyDeniedDays.denialManagerName=result.DENIAL_PRSNL_NAME;
if(result.LETTER_DT_TM){modifyDeniedDays.letterDate=new Date();
modifyDeniedDays.letterDate.setISO8601(result.LETTER_DT_TM);
}if(result.NOTICE_RECEIVED_DT_TM){modifyDeniedDays.noticeReceivedDate=new Date();
modifyDeniedDays.noticeReceivedDate.setISO8601(result.NOTICE_RECEIVED_DT_TM);
}if(result.CLOSED_DT_TM){modifyDeniedDays.closedDate=new Date();
modifyDeniedDays.closedDate.setISO8601(result.CLOSED_DT_TM);
}if(result.APPEAL_BY_DT_TM){modifyDeniedDays.appealDeadlineDate=new Date();
modifyDeniedDays.appealDeadlineDate.setISO8601(result.APPEAL_BY_DT_TM);
}modifyDeniedDays.denialRiskAmount=result.DENIAL_RISK_AMOUNT;
modifyDeniedDays.comment=RCM_Clinical_Util.decodeString(result.COMMENT_TEXT);
switch(result.RESP_PARTY_TYPE_FLAG){case 1:modifyDeniedDays.responsibleParty="PATIENT";
break;
case 2:modifyDeniedDays.responsibleParty="PROVIDER";
modifyDeniedDays.responsibleProviderId=result.RESP_PARTY_ENTITY_ID;
modifyDeniedDays.responsibleProviderName=result.RESP_PARTY_ENTITY_NAME;
break;
case 3:modifyDeniedDays.responsibleParty="SERVICE";
modifyDeniedDays.serviceCd=result.RESP_PARTY_ENTITY_ID;
break;
case 4:modifyDeniedDays.responsibleParty="OTHER";
modifyDeniedDays.otherCd=result.RESP_PARTY_ENTITY_ID;
break;
case 5:modifyDeniedDays.responsibleParty="NURSE_UNIT";
modifyDeniedDays.nurseUnitCd=result.RESP_PARTY_ENTITY_ID;
}}}var deniedDaysForm=new RCMDeniedDaysForm(String(this.criterion.encntr_id),deniedDaysInfo,modifyDeniedDays);
deniedDaysForm.addSaveCompleteListener(function(){that.InsertData();
for(var i=0;
i<saveListeners.length;
i++){saveListeners[i]();
}});
deniedDaysForm.addAddAppealListener(function(payerOrgId,deniedDaysId){for(var i=0;
i<addAppealListeners.length;
i++){addAppealListeners[i](payerOrgId,deniedDaysId);
}});
deniedDaysForm.addDeleteListener(function(){that.InsertData();
for(var i=0;
i<deleteListeners.length;
i++){deleteListeners[i]();
}});
MP_Util.Doc.FinalizeComponent(deniedDaysForm.getHTML(),this,"");
if(this.criterion.encntr_id>0){deniedDaysForm.initialize(this);
}});
RCMDeniedDaysFormComponent.method("addSaveListener",function(listener){saveListeners.push(listener);
});
RCMDeniedDaysFormComponent.method("addAddAppealListener",function(listener){addAppealListeners.push(listener);
});
RCMDeniedDaysFormComponent.method("addDeleteListener",function(listener){deleteListeners.push(listener);
});
}RCMDeniedDaysFormComponent.inherits(MPageComponent);
function RCMDeniedDaysForm(encounterId,deniedDaysInfo,modifyDeniedDays){var serviceDelegate=new DeniedDaysDelegate();
var responsibleProviderControl;
var denialManagerControl;
var saveCompleteListeners=[];
var addAppealListeners=[];
var deleteListeners=[];
var formObject={};
var focusField;
var selectedResponsibleParty="PATIENT";
var flexButtonIds=["ddfBtnSave","ddfBtnAddAppeal"];
this.addAddAppealListener=function(listener){addAppealListeners.push(listener);
};
this.addSaveCompleteListener=function(listener){saveCompleteListeners.push(listener);
};
this.addDeleteListener=function(listener){deleteListeners.push(listener);
};
this.getHTML=function(){var htmlArray=[];
if(Number(encounterId)===0){htmlArray.push("<div>",rcm_denied_days_i18n.INVALID_ENCOUNTER_MESSAGE,"</div>");
return htmlArray.join("");
}if(!deniedDaysInfo){htmlArray.push("<div><label>",rcm_denied_days_i18n.ERROR_RETRIEVE_DATA,"</label></div>");
return htmlArray.join("");
}htmlArray.push("<div id='ddfPageContent'>");
htmlArray.push("<div>");
htmlArray.push("<span class='ddf-denied-range-title' id='ddfDeniedDateRange'></span>");
htmlArray.push("<div class='ddf-documentation-labels'>");
htmlArray.push("<span>",rcm_denied_days_i18n.DOCUMENTED_BY,"</span>");
htmlArray.push("<span id='ddfUserName'></span>");
htmlArray.push("</div>");
htmlArray.push("</div>");
htmlArray.push("<div class='ddf-form-separator'></div>");
htmlArray.push("<form name='deniedDaysForm'>");
htmlArray.push("<div id='ddfScrollableContentContainer'>");
htmlArray.push("<div id='ddfScrollableContent'>");
htmlArray.push("<div class='ddf-control-group'>");
htmlArray.push(createDropDownHTML("ddfPayer",rcm_denied_days_i18n.PAYER,deniedDaysInfo.payers));
htmlArray.push(createDateFieldHTML("ddfStartDate",rcm_denied_days_i18n.START_DATE));
htmlArray.push(createDateFieldHTML("ddfEndDate",rcm_denied_days_i18n.END_DATE));
htmlArray.push("</div>");
htmlArray.push("<div class='ddf-control-group'>");
htmlArray.push(createDropDownHTML("ddfDenialCategory",rcm_denied_days_i18n.DENIAL_CATEGORY,deniedDaysInfo.denialCategories));
htmlArray.push(createDropDownHTML("ddfDenialType",rcm_denied_days_i18n.DENIAL_TYPE,deniedDaysInfo.denialTypes));
htmlArray.push("</div>");
htmlArray.push("<div class='ddf-control-group'>");
htmlArray.push(createDropDownHTML("ddfDenialReason",rcm_denied_days_i18n.DENIAL_REASON,deniedDaysInfo.denialReasons));
htmlArray.push("<div class='ddf-control-container'>");
htmlArray.push("<label class='ddf-control-label' for='ddfDenialManager'>",rcm_denied_days_i18n.DENIAL_MANAGER,"</label>");
htmlArray.push("<input type='text' class='searchText ddf-provider-search-field' id='ddfDenialManager' name='ddfDenialManager' />");
htmlArray.push("</div>");
htmlArray.push("</div>");
htmlArray.push("<div class='ddf-control-group'>");
htmlArray.push(createDateFieldHTML("ddfNoticeReceivedDate",rcm_denied_days_i18n.NOTICE_RECEIVED_DATE));
htmlArray.push(createDateFieldHTML("ddfLetterDate",rcm_denied_days_i18n.LETTER_DATE));
htmlArray.push(createDateFieldHTML("ddfAppealDeadlineDate",rcm_denied_days_i18n.APPEAL_DEADLINE));
htmlArray.push(createCurrencyFieldHTML("ddfDenialRiskAmount",rcm_denied_days_i18n.DENIAL_RISK_AMOUNT));
htmlArray.push("</div>");
htmlArray.push("<div class='ddf-control-group'>");
htmlArray.push("<div class='ddf-control-container'>");
htmlArray.push("<div class='daf-section-header' for='ddfComment'>",rcm_denied_days_i18n.COMMENT,"</div>");
htmlArray.push("<div class='daf-section-separator'></div>");
htmlArray.push("<textarea id='ddfComment'></textarea>");
htmlArray.push("</div>");
htmlArray.push("</div>");
htmlArray.push("<div id='ddfResponsiblePartyGroup' class='ddf-control-group'>");
htmlArray.push("<div class='daf-section-header'>",rcm_denied_days_i18n.RESPONSIBLE_PARTY,"</div>");
htmlArray.push("<div class='daf-section-separator'></div>");
htmlArray.push("<div class='ddf-control-container'>");
htmlArray.push("<div class='ddf-control-sub-group'>");
htmlArray.push(getResponsiblePartyOptionsHTML());
htmlArray.push("</div>");
htmlArray.push("<div id='ddfResponsiblePartyDetailsSubGroup' class='ddf-control-sub-group'>");
htmlArray.push(getResponsibleServiceDetailsHTML());
htmlArray.push(getResponsibleProviderDetailsHTML());
htmlArray.push(getResponsibleNurseUnitDetailsHTML());
htmlArray.push(getResponsibleOtherDetailsHTML());
htmlArray.push("</div>");
htmlArray.push("</div>");
htmlArray.push("<div class='ddf-control-group'>");
htmlArray.push(createDateFieldHTML("ddfClosedDate",rcm_denied_days_i18n.CLOSED_DATE));
htmlArray.push("</div>");
htmlArray.push("</div>");
htmlArray.push("<div class='ddf-stop-float'></div>");
htmlArray.push("<div id='ddfButtonsContent'>");
htmlArray.push(getButtonsHTML());
htmlArray.push("</div>");
htmlArray.push("<div class='ddf-stop-float'></div>");
htmlArray.push("</form>");
htmlArray.push(getYesNoDialogHTML());
htmlArray.push(getOkDialogHTML());
htmlArray.push("</div>");
return htmlArray.join("");
};
this.initialize=function(component){$(".ddf-responsible-party-option").click(function(){selectResponsibleParty($(this).val());
});
var startDatePicker=RCM_Clinical_Util.addDatePicker(component,"ddfStartDate");
var endDatePicker=RCM_Clinical_Util.addDatePicker(component,"ddfEndDate");
RCM_Clinical_Util.addDatePicker(component,"ddfNoticeReceivedDate");
RCM_Clinical_Util.addDatePicker(component,"ddfLetterDate");
RCM_Clinical_Util.addDatePicker(component,"ddfClosedDate");
RCM_Clinical_Util.addDatePicker(component,"ddfAppealDeadlineDate");
$("#ddfDenialRiskAmount").autoNumeric(getAutoNumericOptions());
var visitStartDate=deniedDaysInfo.inpatientAdmitDate||deniedDaysInfo.registrationDate;
if(visitStartDate){startDatePicker.setMinDate(visitStartDate);
endDatePicker.setMinDate(visitStartDate);
}if(deniedDaysInfo.dischargeDate){startDatePicker.setMaxDate(deniedDaysInfo.dischargeDate);
endDatePicker.setMaxDate(deniedDaysInfo.dischargeDate);
}responsibleProviderControl=new ProviderSearchControl(document.getElementById("ddfResponsibleProvider"));
denialManagerControl=new ProviderSearchControl(document.getElementById("ddfDenialManager"));
$("#ddfBtnAddAppeal").click(function(){var success;
var deniedDaysId;
if(modifyDeniedDays){deniedDaysId=modifyDeniedDays.id;
success=saveModifyForm();
}else{deniedDaysId=saveAddForm();
success=deniedDaysId!=="0";
}if(success){var payerOrgId=$("#ddfPayer").val();
for(var i=0;
i<addAppealListeners.length;
i++){addAppealListeners[i](payerOrgId,deniedDaysId);
}}});
$("#ddfBtnSave").click(function(){var success;
if(modifyDeniedDays){success=saveModifyForm();
}else{var deniedDaysId=saveAddForm();
success=deniedDaysId!=="0";
}if(success){for(var i=0,length=saveCompleteListeners.length;
i<length;
i++){saveCompleteListeners[i]();
}}});
$("#ddfBtnNo").click(function(){setFormEnabledForDialog(true);
document.getElementById("ddfYesNoDialog").style.display="none";
});
$("#ddfBtnOk").click(function(){setFormEnabledForDialog(true);
document.getElementById("ddfOkDialog").style.display="none";
if(focusField){focusField.focus();
}});
$("#ddfBtnCancel").click(function(){openCancelDialog();
});
if(deniedDaysInfo.canAddModify){RCM_Clinical_Util.addRequiredField(formObject,"ddfPayer","select",flexButtonIds);
RCM_Clinical_Util.addRequiredField(formObject,"ddfStartDate","date",flexButtonIds);
RCM_Clinical_Util.addRequiredField(formObject,"ddfEndDate","date",flexButtonIds);
RCM_Clinical_Util.addRequiredField(formObject,"ddfDenialCategory","select",flexButtonIds);
RCM_Clinical_Util.addRequiredField(formObject,"ddfDenialType","select",flexButtonIds);
RCM_Clinical_Util.addRequiredField(formObject,"ddfDenialReason","select",flexButtonIds);
RCM_Clinical_Util.setSearchControlRequired(true,formObject,"ddfDenialManager",denialManagerControl,flexButtonIds);
}if(modifyDeniedDays){$("#ddfUserName").html(modifyDeniedDays.updateUserName);
$("#ddfDeniedDateRange").html(getDeniedDaysFormattedDateString(modifyDeniedDays.startDate,modifyDeniedDays.endDate));
}else{$("#ddfUserName").html(deniedDaysInfo.userName);
}setupForm();
if(modifyDeniedDays&&deniedDaysInfo.canDelete){var menuItems=[];
menuItems.push(RCM_DropDownMenu.createMenuItem(rcm_denied_days_i18n.DELETE_DENIED_DAYS,function(){if(RCM_DropDownMenu.isMenuItemEnabled("ddfDropDownMenu","ddfItemDelete")){openDeleteDialog();
}},"ddfItemDelete"));
RCM_DropDownMenu.addDropDownMenu(component,"ddfDropDownMenu",menuItems);
}else{RCM_DropDownMenu.removeDropDownMenu("ddfDropDownMenu");
}if(!deniedDaysInfo.canAddModify){setFormEnabled(false);
}};
var setupForm=function(){$("div.ddf-responsible-party-details").hide();
if(deniedDaysInfo.nurseUnits.length===1){$("#ddfNurseUnit").val(deniedDaysInfo.nurseUnits[0].id);
}else{$("#ddfNurseUnit").val(deniedDaysInfo.nurseUnitCd);
}if(modifyDeniedDays){setDeniedDaysToForm(modifyDeniedDays);
}else{if(deniedDaysInfo.payers.length>0){$("#ddfPayer").val(deniedDaysInfo.payers[0].id);
}selectResponsibleParty("PATIENT");
RCM_Clinical_Util.setDate("ddfStartDate",null);
RCM_Clinical_Util.setDate("ddfEndDate",null);
RCM_Clinical_Util.setDate("ddfNoticeReceivedDate",null);
RCM_Clinical_Util.setDate("ddfLetterDate",null);
RCM_Clinical_Util.setDate("ddfClosedDate",null);
RCM_Clinical_Util.setDate("ddfAppealDeadlineDate",null);
}RCM_Clinical_Util.performRequiredFieldChecks(formObject);
};
var setFormEnabled=function(enabled){$(".ddf-drop-down").attr("disabled",!enabled);
$(".ddf-currency-field").attr("disabled",!enabled);
$(".ddf-date-field").datepicker(enabled?"enable":"disable");
$(".ddf-provider-search-field").attr("disabled",!enabled);
$(".ddf-responsible-party-option").attr("disabled",!enabled);
$("#ddfComment").attr("disabled",!enabled);
};
var setDeniedDaysToForm=function(deniedDays){$("#ddfPayer").val(deniedDays.payerId);
RCM_Clinical_Util.setDate("ddfStartDate",deniedDays.startDate);
RCM_Clinical_Util.setDate("ddfEndDate",deniedDays.endDate);
$("#ddfDenialCategory").val(deniedDays.denialCategoryCd);
$("#ddfDenialType").val(deniedDays.denialTypeCd);
$("#ddfDenialReason").val(deniedDays.denialReasonCd);
RCM_Clinical_Util.setDate("ddfNoticeReceivedDate",deniedDays.noticeReceivedDate);
RCM_Clinical_Util.setDate("ddfLetterDate",deniedDays.letterDate);
RCM_Clinical_Util.setDate("ddfAppealDeadlineDate",deniedDays.appealDeadlineDate);
$("#ddfDenialRiskAmount").val($.fn.autoNumeric.Format(null,deniedDays.denialRiskAmount,getAutoNumericOptions()));
denialManagerControl.setSelectedProvider(parseInt(deniedDays.denialManagerId),deniedDays.denialManagerName);
$("#ddfComment").val(deniedDays.comment);
RCM_Clinical_Util.setDate("ddfClosedDate",deniedDays.closedDate);
switch(deniedDays.responsibleParty){case"PATIENT":$("#ddfRdoPatientFamily").attr("checked",true);
break;
case"PROVIDER":$("#ddfRdoProvider").attr("checked",true);
responsibleProviderControl.setSelectedProvider(parseInt(deniedDays.responsibleProviderId),deniedDays.responsibleProviderName);
break;
case"SERVICE":$("#ddfRdoService").attr("checked",true);
$("#ddfService").val(deniedDays.serviceCd);
break;
case"OTHER":$("#ddfRdoOther").attr("checked",true);
$("#ddfOther").val(deniedDays.otherCd);
break;
case"NURSE_UNIT":$("#ddfRdoNurseUnit").attr("checked",true);
$("#ddfNurseUnit").val(deniedDays.nurseUnitCd);
break;
}selectResponsibleParty(deniedDays.responsibleParty);
};
var selectResponsibleParty=function(responsibleParty){$("div.ddf-responsible-party-details").hide();
switch(selectedResponsibleParty){case"PROVIDER":RCM_Clinical_Util.setSearchControlRequired(false,formObject,"ddfResponsibleProvider",responsibleProviderControl,flexButtonIds);
break;
case"SERVICE":RCM_Clinical_Util.removeRequiredField(formObject,"ddfService","select",flexButtonIds);
break;
case"OTHER":RCM_Clinical_Util.removeRequiredField(formObject,"ddfOther","select",flexButtonIds);
RCM_Clinical_Util.removeRequiredField(formObject,"ddfComment","textarea",flexButtonIds);
break;
case"NURSE_UNIT":RCM_Clinical_Util.removeRequiredField(formObject,"ddfNurseUnit","select",flexButtonIds);
break;
}selectedResponsibleParty=responsibleParty;
switch(selectedResponsibleParty){case"PROVIDER":if(deniedDaysInfo.canAddModify){RCM_Clinical_Util.setSearchControlRequired(true,formObject,"ddfResponsibleProvider",responsibleProviderControl,flexButtonIds);
}$("#ddfProviderDetails").show();
break;
case"SERVICE":if(deniedDaysInfo.canAddModify){RCM_Clinical_Util.addRequiredField(formObject,"ddfService","select",flexButtonIds);
}$("#ddfServiceDetails").show();
break;
case"OTHER":if(deniedDaysInfo.canAddModify){RCM_Clinical_Util.addRequiredField(formObject,"ddfOther","select",flexButtonIds);
RCM_Clinical_Util.addRequiredField(formObject,"ddfComment","textarea",flexButtonIds);
}$("#ddfOtherDetails").show();
break;
case"NURSE_UNIT":if(deniedDaysInfo.canAddModify){RCM_Clinical_Util.addRequiredField(formObject,"ddfNurseUnit","select",flexButtonIds);
}$("#ddfNurseUnitDetails").show();
break;
}};
var getDeniedDaysFromForm=function(){var deniedDays={};
deniedDays.payerId=$("#ddfPayer").val();
deniedDays.startDate=$("#ddfStartDate").datepicker("getDate");
deniedDays.endDate=$("#ddfEndDate").datepicker("getDate");
deniedDays.endDate.setHours(23,59,59);
deniedDays.denialCategoryCd=$("#ddfDenialCategory").val();
deniedDays.denialTypeCd=$("#ddfDenialType").val();
deniedDays.denialReasonCd=$("#ddfDenialReason").val();
deniedDays.noticeReceivedDate=$("#ddfNoticeReceivedDate").datepicker("getDate");
deniedDays.letterDate=$("#ddfLetterDate").datepicker("getDate");
deniedDays.appealDeadlineDate=$("#ddfAppealDeadlineDate").datepicker("getDate");
deniedDays.denialRiskAmount=$.fn.autoNumeric.Strip("ddfDenialRiskAmount",getAutoNumericOptions());
deniedDays.denialManagerId=String(denialManagerControl.getSelectedProviderId());
deniedDays.comment=$("#ddfComment").val();
deniedDays.responsibleParty=$("#ddfResponsiblePartyOptions input:radio:checked").val();
deniedDays.serviceCd=$("#ddfService").val();
deniedDays.responsibleProviderId=String(responsibleProviderControl.getSelectedProviderId());
deniedDays.nurseUnitCd=$("#ddfNurseUnit").val();
deniedDays.otherCd=$("#ddfOther").val();
deniedDays.closedDate=$("#ddfClosedDate").datepicker("getDate");
return deniedDays;
};
var saveAddForm=function(){var deniedDaysId="0";
var deniedDays=getDeniedDaysFromForm();
if(deniedDays.startDate<deniedDays.endDate){var addStatusInfo=serviceDelegate.addDeniedDays(deniedDays,encounterId);
var status=addStatusInfo.status;
if(status!==0){switch(status){case 2:openInvalidDateRangeDialog();
focusField=document.getElementById("ddfStartDate");
break;
default:openSaveFailedDialog();
break;
}}deniedDaysId=addStatusInfo.deniedDaysId;
}else{openEndDatePrecedesBeginDateDialog();
focusField=document.getElementById("ddfStartDate");
}return deniedDaysId;
};
var saveModifyForm=function(){var deniedDays=getDeniedDaysFromForm();
if(deniedDays.startDate<deniedDays.endDate){var status=serviceDelegate.modifyDeniedDays(deniedDays,encounterId,modifyDeniedDays.id,modifyDeniedDays.updateCount);
if(status!==0){switch(status){case 1:openStaleDataDialog();
break;
case 2:openInvalidDateRangeDialog();
focusField=document.getElementById("ddfStartDate");
break;
default:openSaveFailedDialog();
break;
}return false;
}}else{openEndDatePrecedesBeginDateDialog();
focusField=document.getElementById("ddfStartDate");
return false;
}return true;
};
var getResponsiblePartyOptionsHTML=function(){var htmlArray=[];
htmlArray.push("<div id='ddfResponsiblePartyOptions'>");
htmlArray.push("<input type='radio' id='ddfRdoPatientFamily' class='ddf-responsible-party-option' name='ddfResponsiblePartyOptions' value='PATIENT' checked='checked'>"+rcm_denied_days_i18n.PATIENT_FAMILY+"</input><br />");
htmlArray.push("<input type='radio' id='ddfRdoService' class='ddf-responsible-party-option' name='ddfResponsiblePartyOptions' value='SERVICE'>"+rcm_denied_days_i18n.SERVICE+"</input><br />");
htmlArray.push("<input type='radio' id='ddfRdoProvider' class='ddf-responsible-party-option' name='ddfResponsiblePartyOptions' value='PROVIDER'>"+rcm_denied_days_i18n.PROVIDER+"</input><br />");
htmlArray.push("<input type='radio' id='ddfRdoNurseUnit' class='ddf-responsible-party-option' name='ddfResponsiblePartyOptions' value='NURSE_UNIT'>"+rcm_denied_days_i18n.NURSE_UNIT+"</input><br />");
htmlArray.push("<input type='radio' id='ddfRdoOther' class='ddf-responsible-party-option' name='ddfResponsiblePartyOptions' value='OTHER'>"+rcm_denied_days_i18n.OTHER+"</input><br />");
htmlArray.push("</div>");
return htmlArray.join("");
};
var getResponsibleServiceDetailsHTML=function(){var htmlArray=[];
htmlArray.push("<div id='ddfServiceDetails' class='ddf-responsible-party-details'>");
htmlArray.push(createDropDownHTML("ddfService",rcm_denied_days_i18n.SERVICE,deniedDaysInfo.services));
htmlArray.push("</div>");
return htmlArray.join("");
};
var getResponsibleProviderDetailsHTML=function(){var htmlArray=[];
htmlArray.push("<div id='ddfProviderDetails' class='ddf-responsible-party-details'>");
htmlArray.push("<div class='ddf-control-container'>");
htmlArray.push("<label class='ddf-control-label' for='ddfResponsibleProvider'>",rcm_denied_days_i18n.PROVIDER,"</label>");
htmlArray.push("<input type='text' class='searchText ddf-provider-search-field' id='ddfResponsibleProvider' name='ddfResponsibleProvider' />");
htmlArray.push("</div>");
htmlArray.push("</div>");
return htmlArray.join("");
};
var getResponsibleNurseUnitDetailsHTML=function(){var htmlArray=[];
htmlArray.push("<div id='ddfNurseUnitDetails' class='ddf-responsible-party-details'>");
htmlArray.push("<div id='ddfFacilityContainer'>");
htmlArray.push("<span id='ddfFacility'>",rcm_denied_days_i18n.FACILITY,deniedDaysInfo.facilityName,"</span>");
htmlArray.push("</div>");
htmlArray.push(createDropDownHTML("ddfNurseUnit",rcm_denied_days_i18n.NURSE_UNIT,deniedDaysInfo.nurseUnits));
htmlArray.push("</div>");
return htmlArray.join("");
};
var getResponsibleOtherDetailsHTML=function(){var htmlArray=[];
htmlArray.push("<div id='ddfOtherDetails' class='ddf-responsible-party-details'>");
htmlArray.push(createDropDownHTML("ddfOther",rcm_denied_days_i18n.OTHER,deniedDaysInfo.others));
htmlArray.push("</div>");
return htmlArray.join("");
};
var getButtonsHTML=function(){var htmlArray=[];
if(deniedDaysInfo.canAddModify){htmlArray.push("<div id='ddfSaveCancelContainer'>");
htmlArray.push("<input type='button' id='ddfBtnAddAppeal' class='ddf-action-button' value='"+rcm_denied_days_i18n.SAVE_AND_ADD_APPEAL+"' />");
htmlArray.push("<input type='button' id='ddfBtnSave' class='ddf-action-button' value='"+rcm_denied_days_i18n.SAVE+"' />");
htmlArray.push("<input type='button' id='ddfBtnCancel' class='ddf-action-button' value='"+rcm_denied_days_i18n.CANCEL+"' />");
htmlArray.push("</div>");
}return htmlArray.join("");
};
var createDropDownHTML=function(name,label,items){var htmlArray=[];
var id=name;
htmlArray.push("<div class='ddf-control-container'>");
htmlArray.push("<label class='ddf-control-label' for='",id,"'>",label,"</label>");
htmlArray.push("<select id='",id,"' class='ddf-drop-down' name='",name,"'>");
htmlArray.push(createOptionsHTML(items));
htmlArray.push("</select>");
htmlArray.push("</div>");
return htmlArray.join("");
};
var createDateFieldHTML=function(name,label){var htmlArray=[];
var id=name;
htmlArray.push("<div class='ddf-control-container'>");
htmlArray.push("<label class='ddf-control-label' for='",id,"'>",label,"</label>");
htmlArray.push("<input id='",id,"' class='ddf-date-field' type='text' name='",name,"' maxlength='10' />");
htmlArray.push("</div>");
return htmlArray.join("");
};
var createCurrencyFieldHTML=function(name,label){var htmlArray=[];
var id=name;
htmlArray.push("<div class='ddf-control-container'>");
htmlArray.push("<label class='ddf-control-label' for='",id,"'>",label,"</label>");
htmlArray.push("<input id='",id,"' class='ddf-currency-field' type='text' name='",name,"' />");
htmlArray.push("</div>");
return htmlArray.join("");
};
var createOptionsHTML=function(items){var htmlArray=[];
htmlArray.push("<option value='0'></option>");
for(var i=0,length=items.length;
i<length;
i++){var item=items[i];
htmlArray.push("<option value='",item.id,"'>",item.display,"</option>");
}return htmlArray.join("");
};
var getYesNoDialogHTML=function(){var htmlArray=[];
htmlArray.push("<div id='ddfYesNoDialog' class='ddf-dialog'>");
htmlArray.push("<div class='ddf-dialog-title-bar'>");
htmlArray.push("<label id='ddfYesNoDialogTitle'></label>","</div>");
htmlArray.push("<div class='ddf-dialog-message-area'>");
htmlArray.push("<label id='ddfYesNoDialogMessage'></label>");
htmlArray.push("</div>");
htmlArray.push("<div class='ddf-dialog-buttons'>");
htmlArray.push("<input id='ddfBtnNo' type='button' value='",rcm_denied_days_i18n.NO,"' />");
htmlArray.push("<input id='ddfBtnYes' type='button' value='",rcm_denied_days_i18n.YES,"' />");
htmlArray.push("</div></div>");
return htmlArray.join("");
};
var getOkDialogHTML=function(){var htmlArray=[];
htmlArray.push("<div id='ddfOkDialog' class='ddf-dialog'>");
htmlArray.push("<div class='ddf-dialog-title-bar'>");
htmlArray.push("<label id='ddfOkDialogTitle'></label>","</div>");
htmlArray.push("<div class='ddf-dialog-message-area'>");
htmlArray.push("<label id='ddfOkDialogMessage'></label>");
htmlArray.push("</div>");
htmlArray.push("<div class='ddf-dialog-buttons'>");
htmlArray.push("<input id='ddfBtnOk' type='button' value='",rcm_denied_days_i18n.OK,"' />");
htmlArray.push("</div></div>");
return htmlArray.join("");
};
var openInvalidDateRangeDialog=function(){focusField=null;
$("#ddfOkDialogTitle").html(rcm_denied_days_i18n.INVALID_DATE_RANGE_TITLE);
$("#ddfOkDialogMessage").html(rcm_denied_days_i18n.INVALID_DATE_RANGE_MESSAGE);
setFormEnabledForDialog(false);
document.getElementById("ddfOkDialog").style.display="block";
};
var openGetFailedDialog=function(msg){focusField=null;
$("#ddfOkDialogTitle").html(rcm_denied_days_i18n.GET_FAILED_TITLE);
$("#ddfOkDialogMessage").html(msg);
setFormEnabledForDialog(false);
document.getElementById("ddfOkDialog").style.display="block";
};
var openStaleDataDialog=function(){focusField=null;
$("#ddfOkDialogTitle").html(rcm_denied_days_i18n.STALE_DATA_TITLE);
$("#ddfOkDialogMessage").html(rcm_denied_days_i18n.STALE_DENIED_DAYS_DATA_MESSAGE);
setFormEnabledForDialog(false);
document.getElementById("ddfOkDialog").style.display="block";
};
var openEndDatePrecedesBeginDateDialog=function(){focusField=null;
$("#ddfOkDialogTitle").html(rcm_denied_days_i18n.INVALID_DATE_RANGE_TITLE);
$("#ddfOkDialogMessage").html(rcm_denied_days_i18n.END_DATE_PRECEDES_BEGIN_DATE_MESSAGE);
setFormEnabledForDialog(false);
document.getElementById("ddfOkDialog").style.display="block";
};
var openSaveFailedDialog=function(){focusField=null;
$("#ddfOkDialogTitle").html(rcm_denied_days_i18n.SAVE_FAILED_TITLE);
$("#ddfOkDialogMessage").html(rcm_denied_days_i18n.SAVE_FAILED_MESSAGE);
setFormEnabledForDialog(false);
document.getElementById("ddfOkDialog").style.display="block";
};
var openDeleteFailedDialog=function(){focusField=null;
$("#ddfOkDialogTitle").html(rcm_denied_days_i18n.DELETE_FAILED_TITLE);
$("#ddfOkDialogMessage").html(rcm_denied_days_i18n.DELETE_FAILED_MESSAGE);
setFormEnabledForDialog(false);
document.getElementById("ddfOkDialog").style.display="block";
};
var openDeleteDialog=function(){$("#ddfYesNoDialogTitle").html(rcm_denied_days_i18n.DELETE_DENIED_DAY_TITLE);
$("#ddfYesNoDialogMessage").html(rcm_denied_days_i18n.DELETE_DENIED_DAY_MESSAGE);
setFormEnabledForDialog(false);
document.getElementById("ddfYesNoDialog").style.display="block";
$("#ddfBtnYes").unbind("click").click(function(){var status=serviceDelegate.deleteDeniedDays(modifyDeniedDays.id,modifyDeniedDays.updateCount);
setFormEnabledForDialog(true);
document.getElementById("ddfYesNoDialog").style.display="none";
if(status===0){for(var i=0,length=deleteListeners.length;
i<length;
i++){deleteListeners[i]();
}}else{switch(status){case 1:openStaleDataDialog();
break;
default:openDeleteFailedDialog();
break;
}}});
};
var openCancelDialog=function(){$("#ddfYesNoDialogTitle").html(rcm_denied_days_i18n.CANCEL);
$("#ddfYesNoDialogMessage").html(rcm_denied_days_i18n.CANCEL_MESSAGE);
setFormEnabledForDialog(false);
document.getElementById("ddfYesNoDialog").style.display="block";
$("#ddfBtnYes").unbind("click").click(function(){document.deniedDaysForm.reset();
setFormEnabledForDialog(true);
setupForm();
document.getElementById("ddfYesNoDialog").style.display="none";
});
};
var setFormEnabledForDialog=function(enabled){var isAnyFieldRequired=RCM_Clinical_Util.isAnyFieldRequired(formObject);
var saveButton=document.getElementById("ddfBtnSave");
if(saveButton){saveButton.disabled=!enabled||isAnyFieldRequired;
}var addAppealButton=document.getElementById("ddfBtnAddAppeal");
if(addAppealButton){addAppealButton.disabled=!enabled||isAnyFieldRequired;
}var cancelButton=document.getElementById("ddfBtnCancel");
if(cancelButton){cancelButton.disabled=!enabled;
}RCM_DropDownMenu.setMenuItemEnabled("ddfDropDownMenu","ddfItemDelete",enabled);
setFormEnabled(enabled&&deniedDaysInfo.canAddModify);
};
var getAutoNumericOptions=function(){return{aSep:rcm_denied_days_i18n.CURRENCY_THOUSAND_SEPARATOR,aDec:rcm_denied_days_i18n.CURRENCY_DECIMAL_SEPARATOR,aSign:rcm_denied_days_i18n.CURRENCY_SYMBOL,pSign:rcm_denied_days_i18n.CURRENCY_SYMBOL_PLACEMENT,mDec:rcm_denied_days_i18n.CURRENCY_MAX_DECIMAL,dGroup:rcm_denied_days_i18n.CURRENCY_THOUSAND_GROUPING,mNum:rcm_denied_days_i18n.CURRENCY_MAX_WHOLE_NUMBER};
};
var getDeniedDaysFormattedDateString=function(startDate,endDate){if(startDate&&endDate){if((startDate.getMonth()===endDate.getMonth())&&(startDate.getDate()===endDate.getDate())&&(startDate.getFullYear()===endDate.getFullYear())){return RCM_Clinical_Util.formatDate(startDate);
}return RCM_Clinical_Util.formatDate(startDate)+" - "+RCM_Clinical_Util.formatDate(endDate);
}return"";
};
}
function RCMDeniedDaysListComponentStyle(){this.initByNamespace("rcm-ddl");
}RCMDeniedDaysListComponentStyle.inherits(ComponentStyle);
function RCMDeniedDaysListComponent(criterion){var encounterId=criterion.encntr_id;
var newDeniedDayListeners=[];
var newAppealListeners=[];
var deniedDaySelectedListeners=[];
var appealSelectedListeners=[];
var renderSuccessListeners=[];
var deniedDaysIds=[];
var isAddModifyDenialsAuthorized=false;
var modifyLinksVisible=false;
var addAppealLinkVisible=false;
this.setCriterion(criterion);
this.setStyles(new RCMDeniedDaysListComponentStyle());
this.setLabel(rcm_denied_days_i18n.DENIALS);
this.setExpanded(true);
this.setIncludeLineNumber(true);
this.setScope(2);
this.setPlusAddEnabled(true);
RCMDeniedDaysListComponent.method("isDateLinksVisible",function(){return modifyLinksVisible;
});
RCMDeniedDaysListComponent.method("setDateLinksVisible",function(isDateLinksVisible){modifyLinksVisible=isDateLinksVisible;
});
RCMDeniedDaysListComponent.method("isAddAppealLinkVisible",function(){return addAppealLinkVisible;
});
RCMDeniedDaysListComponent.method("setAddAppealLinkVisible",function(isAddAppealLinkVisible){addAppealLinkVisible=isAddAppealLinkVisible;
});
RCMDeniedDaysListComponent.method("InsertData",function(){var serviceDelegate=new DeniedDaysDelegate();
var component=this;
serviceDelegate.getDeniedDays(encounterId.toFixed(1),function(recordData,errorMessage){if(recordData&&"S"===recordData.STATUS_DATA.STATUS){component.HandleSuccess(recordData);
}else{component.HandleSuccess(recordData);
}});
});
RCMDeniedDaysListComponent.method("HandleSuccess",function(recordData){var deniedDays=[];
for(var i=0;
i<recordData.DENIAL_RESULTS.length;
i++){var denialResult=recordData.DENIAL_RESULTS[i];
deniedDays.push({encntrDDId:denialResult.ENCNTR_DENIED_DAYS_ID,beginDateTime:denialResult.BEG_DT_TM,endDateTime:denialResult.END_DT_TM,type:denialResult.DENIAL_TYPE_DISPLAY,category:denialResult.DENIAL_CATEGORY_DISPLAY,reason:denialResult.DENIAL_REASON_DISPLAY,payer:denialResult.PAYER_ORG_NAME,closedDate:denialResult.CLOSED_DT_TM});
deniedDaysIds.push(denialResult.ENCNTR_DENIED_DAYS_ID);
}var appeals=[];
for(var i=0;
i<recordData.APPEAL_RESULTS.length;
i++){var appealResult=recordData.APPEAL_RESULTS[i];
appeals.push({encntrAppealId:appealResult.ENCNTR_APPEAL_ID,appealDate:appealResult.APPEAL_SENT_DT_TM,level:appealResult.APPEAL_LEVEL_DISPLAY,status:appealResult.APPEAL_STATUS_DISPLAY,outcome:appealResult.APPEAL_OUTCOME_DISPLAY,expectedResponse:appealResult.APPEAL_EXPECT_RESP_DT_TM});
}var totalDeniedDays=recordData.TOTAL_DENIED_DAYS;
var denials={deniedDaysCount:totalDeniedDays,deniedDaysInfo:deniedDays,appealInfo:appeals};
isAddModifyDenialsAuthorized=recordData.ADD_MODIFY_DENIALS_AUTH_IND;
$("#rcm-ddlAdd").css("visibility",(this.isPlusAddEnabled()&&isAddModifyDenialsAuthorized)?"":"hidden");
$("#rcm-ddlAdd").attr("title",(this.isPlusAddEnabled()&&isAddModifyDenialsAuthorized)?rcm_denied_days_i18n.ADD_DENIED_DAY:"");
var denialsCount=totalDeniedDays+denials.appealInfo.length;
var countText=MP_Util.CreateTitleText(this,denialsCount);
var deniedDaysList=new RCMDeniedDaysList(encounterId,denials,MP_Util.GetContentClass(this,deniedDays.length),MP_Util.GetContentClass(this,appeals.length),modifyLinksVisible,recordData.ADD_MODIFY_APPEALS_AUTH_IND===1&&addAppealLinkVisible);
deniedDaysList.addAppealSelectedListener(function(appealId){for(var i=0;
i<appealSelectedListeners.length;
i++){appealSelectedListeners[i](appealId);
}});
deniedDaysList.addDeniedDaySelectedListener(function(deniedDayId){for(var i=0;
i<deniedDaySelectedListeners.length;
i++){deniedDaySelectedListeners[i](deniedDayId);
}});
deniedDaysList.addNewAppealListener(function(){for(var i=0;
i<newAppealListeners.length;
i++){newAppealListeners[i]();
}});
deniedDaysList.addNewDeniedDayListener(function(){for(var i=0;
i<newDeniedDayListeners.length;
i++){newDeniedDayListeners[i]();
}});
MP_Util.Doc.FinalizeComponent(deniedDaysList.getHTML(),this,countText);
deniedDaysList.initialize(this,recordData.ADD_MODIFY_DENIALS_AUTH_IND);
for(var i=0;
i<renderSuccessListeners.length;
i++){renderSuccessListeners[i]();
}});
RCMDeniedDaysListComponent.method("openTab",function(recordData){newDeniedDay();
});
RCMDeniedDaysListComponent.method("addNewDeniedDayListener",function(listener){newDeniedDayListeners.push(listener);
});
RCMDeniedDaysListComponent.method("addNewAppealListener",function(listener){newAppealListeners.push(listener);
});
RCMDeniedDaysListComponent.method("addDeniedDaySelectedListener",function(listener){deniedDaySelectedListeners.push(listener);
});
RCMDeniedDaysListComponent.method("addAppealSelectedListener",function(listener){appealSelectedListeners.push(listener);
});
RCMDeniedDaysListComponent.method("addRenderSuccessListener",function(listener){renderSuccessListeners.push(listener);
});
RCMDeniedDaysListComponent.method("getDeniedDaysIds",function(listener){return deniedDaysIds;
});
RCMDeniedDaysListComponent.method("isAddAuthorized",function(){return isAddModifyDenialsAuthorized;
});
RCMDeniedDaysListComponent.method("removeRenderSuccessListener",function(listener){for(var i=0;
i<renderSuccessListeners.length;
i++){if(renderSuccessListeners[i]===listener){renderSuccessListeners.splice(i,1);
return;
}}});
function newDeniedDay(){for(var i=0;
i<newDeniedDayListeners.length;
i++){newDeniedDayListeners[i]();
}}}RCMDeniedDaysListComponent.inherits(MPageComponent);
function RCMDeniedDaysList(encounterId,denials,denialsContentBodyClassName,appealsContentBodyClassName,isDateLinksVisible,isAddAppealLinkVisible){var deniedDaySelectedListeners=[];
var newDeniedDayListeners=[];
var appealSelectedListeners=[];
var newAppealListeners=[];
this.getHTML=function(){var htmlArray=[];
if(encounterId===0){htmlArray.push("<div>",rcm_denied_days_i18n.INVALID_ENCOUNTER_MESSAGE,"</div>");
return htmlArray.join("");
}htmlArray.push(getDeniedDaysHTML());
htmlArray.push(getAppealsHTML());
return htmlArray.join("");
};
function getDeniedDaysHTML(){var htmlArray=[];
var deniedDaysLength=denials.deniedDaysCount;
htmlArray.push("<div id='deniedDaysList' class='sub-sec'>");
htmlArray.push("<h3 class='sub-sec-hd'>");
htmlArray.push("<span class='sub-sec-hd-tgl' title='",i18n.HIDE_SECTION,"'>-</span>");
htmlArray.push("<span class='sub-sec-title'>",rcm_denied_days_i18n.DENIED_DAYS_LIST_TITLE," (",deniedDaysLength,")","</span>");
htmlArray.push("</h3>");
htmlArray.push("<div class='sub-sec-content'>");
if(deniedDaysLength===0){htmlArray.push("<div>",rcm_denied_days_i18n.NO_DOCUMENTED_DENIALS,"</div></div></div>");
return htmlArray.join("");
}htmlArray.push("<div class='",denialsContentBodyClassName,"'>");
htmlArray.push("<table id='ddl-denialsTable'>");
htmlArray.push("<tr>");
htmlArray.push("<th>",rcm_denied_days_i18n.DATE,"</th>");
htmlArray.push("<th>",rcm_denied_days_i18n.TYPE,"<br/>(",rcm_denied_days_i18n.CATEGORY,")</th>");
htmlArray.push("<th>",rcm_denied_days_i18n.PAYER,"</th>");
htmlArray.push("</tr>");
for(var i=0,length=denials.deniedDaysInfo.length;
i<length;
i++){var deniedDayResult=denials.deniedDaysInfo[i];
var isDenialClosed=deniedDayResult.closedDate;
if(isDenialClosed){htmlArray.push("<tr class='rcm-ddl-closed-text'>");
}else{htmlArray.push("<tr>");
}htmlArray.push("<td>");
if(isDateLinksVisible){htmlArray.push("<a class='rcm-denied-day-result-link' id='",deniedDayResult.encntrDDId,"'>",getDeniedDayFormattedDateString(deniedDayResult),"</a>");
}else{htmlArray.push(getDeniedDayFormattedDateString(deniedDayResult));
}if(isDenialClosed){htmlArray.push("<span>&nbsp;(",rcm_denied_days_i18n.CLOSED,")</span>");
}htmlArray.push("</td>");
htmlArray.push("<td><div class='ddl-hover-parent'>");
htmlArray.push("<div>",deniedDayResult.type,"</div>");
htmlArray.push("<div><span class='rcm-ddlIndent'>",deniedDayResult.category,"</span></div>");
htmlArray.push("<div class='rcm-ddlHoverText'>");
htmlArray.push("<div>");
htmlArray.push("<span class='rcm-ddlHoverInfoLabel'>",rcm_denied_days_i18n.DENIAL_REASON,":&nbsp;</span>");
htmlArray.push("<span class='rcm-ddlHoverInfoValue'>",deniedDayResult.reason,"</span>");
htmlArray.push("</div>");
htmlArray.push("</div>");
htmlArray.push("</div></td>");
htmlArray.push("<td>",deniedDayResult.payer,"</td>");
htmlArray.push("</tr>");
}htmlArray.push("</table>");
htmlArray.push("</div>");
htmlArray.push("</div>");
htmlArray.push("</div>");
return htmlArray.join("");
}function getAppealsHTML(){var htmlArray=[];
var appealsLength=denials.appealInfo.length;
htmlArray.push("<div id='appealsList' class='sub-sec'>");
htmlArray.push("<h3 class='sub-sec-hd'>");
htmlArray.push("<span class='sub-sec-hd-tgl' title='",i18n.HIDE_SECTION,"'>-</span>");
htmlArray.push("<span class='sub-sec-title'>",rcm_denied_days_i18n.APPEAL_LIST_TITLE," (",appealsLength,")","</span>");
htmlArray.push("</h3>");
htmlArray.push("<div class='sub-sec-content'>");
if(appealsLength===0){htmlArray.push("<div>",rcm_denied_days_i18n.NO_DOCUMENTED_APPEALS,"</div></div></div>");
return htmlArray.join("");
}htmlArray.push("<div class='",appealsContentBodyClassName,"'>");
htmlArray.push("<table id='ddl-denialsTable'>");
htmlArray.push("<tr>");
htmlArray.push("<th>",rcm_denied_days_i18n.APPEAL_DATE,"<br/>(",rcm_denied_days_i18n.LEVEL,")</th>");
htmlArray.push("<th>",rcm_denied_days_i18n.STATUS,"</th>");
htmlArray.push("<th>",rcm_denied_days_i18n.OUTCOME,"</th>");
htmlArray.push("<th>",rcm_denied_days_i18n.EXPECTED_RESPONSE,"</th>");
htmlArray.push("</tr>");
for(var i=0,length=denials.appealInfo.length;
i<length;
i++){var appealResult=denials.appealInfo[i];
htmlArray.push("<tr>");
htmlArray.push("<td>");
if(isDateLinksVisible){htmlArray.push("<a class='rcm-appeal-date-result-link' id='",appealResult.encntrAppealId,"'>",RCM_Clinical_Util.formatJsonDateString(appealResult.appealDate),"</a>");
}else{htmlArray.push(RCM_Clinical_Util.formatJsonDateString(appealResult.appealDate));
}htmlArray.push("<br/><span class='rcm-ddlIndent'>",appealResult.level,"</span></td>");
htmlArray.push("<td>",appealResult.status,"</td>");
htmlArray.push("<td>",appealResult.outcome,"</td>");
htmlArray.push("<td>",RCM_Clinical_Util.formatJsonDateString(appealResult.expectedResponse),"</td>");
htmlArray.push("</tr>");
}htmlArray.push("</table>");
htmlArray.push("</div>");
htmlArray.push("</div>");
htmlArray.push("</div>");
return htmlArray.join("");
}this.initialize=function(component,ind){var menuItems=[];
if(component.isPlusAddEnabled()&&component.criterion.encntr_id>0&&ind===1){menuItems.push(RCM_DropDownMenu.createMenuItem(rcm_denied_days_i18n.ADD_DENIED_DAY,function(){newDeniedDay();
}));
}if(isAddAppealLinkVisible&&denials.deniedDaysInfo.length>0&&component.criterion.encntr_id>0){menuItems.push(RCM_DropDownMenu.createMenuItem(rcm_denied_days_i18n.ADD_APPEAL,function(){newAppeal();
}));
}if(menuItems.length>0){var menuOptions=RCM_DropDownMenu.createMenuOptions();
menuOptions.setLeftAlignedMenu(true);
RCM_DropDownMenu.addDropDownMenu(component,"rcm-ddlDropDownMenu",menuItems,menuOptions);
}else{RCM_DropDownMenu.removeDropDownMenu("rcm-ddlDropDownMenu");
}$(".rcm-denied-day-result-link").click(function(){deniedDaySelected($(this).attr("id"));
});
$(".rcm-appeal-date-result-link").click(function(){appealSelected($(this).attr("id"));
});
var hoverParentElements=$(".ddl-hover-parent");
hoverParentElements.each(function(){var hoverParent=$(this).get(0);
var hoverChild=$(this).children(".rcm-ddlHoverText").get(0);
hs(hoverParent,hoverChild);
});
};
this.addDeniedDaySelectedListener=function(listener){deniedDaySelectedListeners.push(listener);
};
this.addNewDeniedDayListener=function(listener){newDeniedDayListeners.push(listener);
};
this.addAppealSelectedListener=function(listener){appealSelectedListeners.push(listener);
};
this.addNewAppealListener=function(listener){newAppealListeners.push(listener);
};
function newDeniedDay(){for(var i=0,length=newDeniedDayListeners.length;
i<length;
i++){newDeniedDayListeners[i]();
}}function newAppeal(){for(var i=0;
i<newAppealListeners.length;
i++){newAppealListeners[i]();
}}function deniedDaySelected(deniedDayId){for(var i=0,length=deniedDaySelectedListeners.length;
i<length;
i++){deniedDaySelectedListeners[i](deniedDayId);
}}function appealSelected(appealId){for(var i=0,length=appealSelectedListeners.length;
i<length;
i++){appealSelectedListeners[i](appealId);
}}function getDeniedDayFormattedDateString(deniedDayResult){var beginDate=new Date();
beginDate.setISO8601(deniedDayResult.beginDateTime);
var endDate=new Date();
endDate.setISO8601(deniedDayResult.endDateTime);
if((beginDate.getMonth()===endDate.getMonth())&&(beginDate.getDate()===endDate.getDate())&&(beginDate.getFullYear()===endDate.getFullYear())){return RCM_Clinical_Util.formatJsonDateString(deniedDayResult.beginDateTime);
}return RCM_Clinical_Util.formatJsonDateString(deniedDayResult.beginDateTime)+" - "+RCM_Clinical_Util.formatJsonDateString(deniedDayResult.endDateTime);
}}
function DeniedDaysDelegate(){this.getDeniedDaysForForm=function(deniedDaysId,encounterId,statusHandler){var sendAr=[];
var json={DENIED_DAYS_REQUEST:{ENCNTR_ID:encounterId,ENCNTR_DENIED_DAYS_ID:deniedDaysId}};
sendAr.push("^MINE^","0.0","2","^",JSON.stringify(json),"^");
var status=0;
var info=new XMLCclRequest();
info.open("GET","rcm_denied_days",0);
info.send(sendAr.join(","));
var recordData=[];
if(info.status===200){var jsonEval=JSON.parse(info.responseText);
recordData=jsonEval.RECORD_DATA;
statusHandler(recordData);
}else{status=-1;
statusHandler(recordData);
}return status;
};
this.getDeniedDays=function(encounterId,statusHandler){var sendAr=[];
var json='^{"denied_days_request" :{"encntr_id" : "'+encounterId+'"}}^';
sendAr.push("^MINE^","0.0","1",json);
var info=new XMLCclRequest();
info.onreadystatechange=function(){if(info.readyState===4&&info.status===200){try{var jsonEval=JSON.parse(info.responseText);
var recordData=jsonEval.RECORD_DATA;
var status=recordData.STATUS_DATA.STATUS;
var debugMessage;
if(recordData.TRANSACTIONSTATUS){debugMessage=recordData.TRANSACTIONSTATUS.DEBUGERRORMESSAGE;
}statusHandler(recordData,debugMessage);
}catch(err){}finally{}}else{if(info.readyState===4&&info.status!==200){statusHandler(recordData,info.status);
}}};
info.open("GET","rcm_denied_days",true);
info.send(sendAr.join(","));
};
this.addDeniedDays=function(deniedDays,encounterId){var resp_party_type_flag=0;
var resp_party_entity_id="0";
switch(deniedDays.responsibleParty){case"PATIENT":resp_party_type_flag=1;
break;
case"PROVIDER":resp_party_type_flag=2;
resp_party_entity_id=deniedDays.responsibleProviderId;
break;
case"SERVICE":resp_party_type_flag=3;
resp_party_entity_id=deniedDays.serviceCd;
break;
case"OTHER":resp_party_type_flag=4;
resp_party_entity_id=deniedDays.otherCd;
break;
case"NURSE_UNIT":resp_party_type_flag=5;
resp_party_entity_id=deniedDays.nurseUnitCd;
break;
}var jsonRequest={ADD_DENIED_DAYS_REQUEST:{ENCNTR_ID:encounterId,BEG_DT_TM:deniedDays.startDate?deniedDays.startDate.format("dd-mmm-yyyy HH:MM:ss"):"",END_DT_TM:deniedDays.endDate?deniedDays.endDate.format("dd-mmm-yyyy HH:MM:ss"):"",DENIAL_CATEGORY_CD:deniedDays.denialCategoryCd,DENIAL_TYPE_CD:deniedDays.denialTypeCd,DENIAL_REASON_CD:deniedDays.denialReasonCd,PAYER_ORG_ID:deniedDays.payerId,DENIAL_PRSNL_ID:deniedDays.denialManagerId,LETTER_DT_TM:deniedDays.letterDate?deniedDays.letterDate.format("dd-mmm-yyyy HH:MM:ss"):"",NOTICE_RECEIVED_DT_TM:deniedDays.noticeReceivedDate?deniedDays.noticeReceivedDate.format("dd-mmm-yyyy HH:MM:ss"):"",CLOSED_DT_TM:deniedDays.closedDate?deniedDays.closedDate.format("dd-mmm-yyyy HH:MM:ss"):"",RESP_PARTY_TYPE_FLAG:resp_party_type_flag,RESP_PARTY_ENTITY_ID:resp_party_entity_id,COMMENT_TEXT:RCM_Clinical_Util.encodeString(deniedDays.comment),APPEAL_BY_DT_TM:deniedDays.appealDeadlineDate?deniedDays.appealDeadlineDate.format("dd-mmm-yyyy HH:MM:ss"):"",DENIAL_RISK_AMOUNT:deniedDays.denialRiskAmount}};
var sendAr=[];
sendAr.push("^MINE^","0.0","3","^"+JSON.stringify(jsonRequest)+"^");
var returnStatus=0;
var returnDeniedDaysId="0";
var info=new XMLCclRequest();
info.onreadystatechange=function(){if(info.readyState===4&&info.status===200){var jsonEval=JSON.parse(info.responseText);
var recordData=jsonEval.RECORD_DATA;
if(recordData.STATUS_DATA.STATUS==="F"){var failureReasonFlag=recordData.FAILURE_REASON_FLAG;
returnStatus=failureReasonFlag>0?failureReasonFlag:-1;
}else{returnDeniedDaysId=recordData.ENCNTR_DENIED_DAYS_ID;
}}else{if(info.readyState===4&&info.status!==200){returnStatus=-1;
}}};
info.open("GET","rcm_denied_days",0);
info.send(sendAr.join(","));
return{status:returnStatus,deniedDaysId:returnDeniedDaysId};
};
this.modifyDeniedDays=function(deniedDays,encounterId,deniedDayId,updateCount){var resp_party_type_flag=0;
var resp_party_entity_id="0";
switch(deniedDays.responsibleParty){case"PATIENT":resp_party_type_flag=1;
break;
case"PROVIDER":resp_party_type_flag=2;
resp_party_entity_id=deniedDays.responsibleProviderId;
break;
case"SERVICE":resp_party_type_flag=3;
resp_party_entity_id=deniedDays.serviceCd;
break;
case"OTHER":resp_party_type_flag=4;
resp_party_entity_id=deniedDays.otherCd;
break;
case"NURSE_UNIT":resp_party_type_flag=5;
resp_party_entity_id=deniedDays.nurseUnitCd;
break;
}var jsonRequest={MODIFY_DENIED_DAYS_REQUEST:{ENCNTR_ID:encounterId,ENCNTR_DENIED_DAYS_ID:deniedDayId,UPDT_CNT:updateCount,BEG_DT_TM:deniedDays.startDate?deniedDays.startDate.format("dd-mmm-yyyy HH:MM:ss"):"",END_DT_TM:deniedDays.endDate?deniedDays.endDate.format("dd-mmm-yyyy HH:MM:ss"):"",DENIAL_CATEGORY_CD:deniedDays.denialCategoryCd,DENIAL_TYPE_CD:deniedDays.denialTypeCd,DENIAL_REASON_CD:deniedDays.denialReasonCd,PAYER_ORG_ID:deniedDays.payerId,DENIAL_PRSNL_ID:deniedDays.denialManagerId,LETTER_DT_TM:deniedDays.letterDate?deniedDays.letterDate.format("dd-mmm-yyyy HH:MM:ss"):"",NOTICE_RECEIVED_DT_TM:deniedDays.noticeReceivedDate?deniedDays.noticeReceivedDate.format("dd-mmm-yyyy HH:MM:ss"):"",CLOSED_DT_TM:deniedDays.closedDate?deniedDays.closedDate.format("dd-mmm-yyyy HH:MM:ss"):"",RESP_PARTY_TYPE_FLAG:resp_party_type_flag,RESP_PARTY_ENTITY_ID:resp_party_entity_id,COMMENT_TEXT:RCM_Clinical_Util.encodeString(deniedDays.comment),APPEAL_BY_DT_TM:deniedDays.appealDeadlineDate?deniedDays.appealDeadlineDate.format("dd-mmm-yyyy HH:MM:ss"):"",DENIAL_RISK_AMOUNT:deniedDays.denialRiskAmount}};
var sendAr=[];
sendAr.push("^MINE^","0.0","4","^"+JSON.stringify(jsonRequest)+"^");
var status=0;
var info=new XMLCclRequest();
info.onreadystatechange=function(){if(info.readyState===4&&info.status===200){var jsonEval=JSON.parse(info.responseText);
var recordData=jsonEval.RECORD_DATA;
if(recordData.STATUS_DATA.STATUS==="F"){var failureReasonFlag=recordData.FAILURE_REASON_FLAG;
status=failureReasonFlag>0?failureReasonFlag:-1;
}}else{if(info.readyState===4&&info.status!==200){status=-1;
}}};
info.open("GET","rcm_denied_days",0);
info.send(sendAr.join(","));
return status;
};
this.deleteDeniedDays=function(deniedDayId,updateCount){var jsonRequest={DELETE_DENIED_DAYS_REQUEST:{ENCNTR_DENIED_DAYS_ID:deniedDayId,UPDT_CNT:updateCount}};
var sendAr=[];
sendAr.push("^MINE^","0.0","5","^"+JSON.stringify(jsonRequest)+"^");
var status=0;
var info=new XMLCclRequest();
info.onreadystatechange=function(){if(info.readyState===4&&info.status===200){var jsonEval=JSON.parse(info.responseText);
var recordData=jsonEval.RECORD_DATA;
if(recordData.STATUS_DATA.STATUS==="F"){var failureReasonFlag=recordData.FAILURE_REASON_FLAG;
status=failureReasonFlag>0?failureReasonFlag:-1;
}}else{if(info.readyState===4&&info.status!==200){status=-1;
}}};
info.open("GET","rcm_denied_days",0);
info.send(sendAr.join(","));
return status;
};
this.addDenialAppeal=function(denialAppeal,encounterId,closeDenialsIndicator){var denials=[];
for(var i=0;
i<denialAppeal.deniedDaysIds.length;
i++){denials.push({ENCNTR_DENIED_DAYS_ID:denialAppeal.deniedDaysIds[i]});
}var jsonRequest={ADD_APPEAL_REQUEST:{ENCNTR_ID:encounterId,PAYER_ORG_ID:denialAppeal.payerId,APPEAL_PRSNL_ID:denialAppeal.appealManagerId,APPEAL_LEVEL_CD:denialAppeal.levelCd,APPEAL_STATUS_CD:denialAppeal.statusCd,EXT_APPEAL_AGENCY_CD:denialAppeal.externalAppealAgencyCd,PROVIDED_LEVEL_OF_CARE_CD:denialAppeal.providedLOCCd?denialAppeal.providedLOCCd:"",PRE_LEVEL_OF_CARE_CD:denialAppeal.preAppealLOCCd?denialAppeal.preAppealLOCCd:"",POST_LEVEL_OF_CARE_CD:denialAppeal.postAppealLOCCd?denialAppeal.postAppealLOCCd:"",APPEAL_OUTCOME_CD:denialAppeal.outcomeCd,APPEAL_COMM_TYPE_CD:denialAppeal.communicationTypeCd,TRACKING_NBR_TEXT:RCM_Clinical_Util.encodeString(denialAppeal.trackingNumber),APPEAL_SENT_DT_TM:denialAppeal.sentDate?denialAppeal.sentDate.format("dd-mmm-yyyy HH:MM:ss"):"",APPEAL_VERIFIED_DT_TM:denialAppeal.verifiedDate?denialAppeal.verifiedDate.format("dd-mmm-yyyy HH:MM:ss"):"",APPEAL_EXPECT_RESP_DT_TM:denialAppeal.expectedResponseDate?denialAppeal.expectedResponseDate.format("dd-mmm-yyyy HH:MM:ss"):"",APPEAL_OUTCOME_DT_TM:denialAppeal.outcomeDate?denialAppeal.outcomeDate.format("dd-mmm-yyyy HH:MM:ss"):"",COMMENT_TEXT:RCM_Clinical_Util.encodeString(denialAppeal.comment),ADVISOR_PRSNL_ID:denialAppeal.advisorPhysicianId,DENIALS:denials,CLOSE_DENIALS_IND:closeDenialsIndicator}};
var sendAr=[];
sendAr.push("^MINE^","0.0","7","^"+JSON.stringify(jsonRequest)+"^");
var status=0;
var info=new XMLCclRequest();
info.onreadystatechange=function(){if(info.readyState===4&&info.status===200){var jsonEval=JSON.parse(info.responseText);
var recordData=jsonEval.RECORD_DATA;
if(recordData.STATUS_DATA.STATUS==="F"){var failureReasonFlag=recordData.FAILURE_REASON_FLAG;
status=failureReasonFlag>0?failureReasonFlag:-1;
}}else{if(info.readyState===4&&info.status!==200){status=-1;
}}};
info.open("GET","rcm_denied_days",0);
info.send(sendAr.join(","));
return status;
};
this.modifyDenialAppeal=function(denialAppeal,encounterId,appealId,updateCount,closeDenialsIndicator){var denials=[];
for(var i=0;
i<denialAppeal.deniedDaysIds.length;
i++){denials.push({ENCNTR_DENIED_DAYS_ID:denialAppeal.deniedDaysIds[i]});
}var jsonRequest={MODIFY_APPEAL_REQUEST:{ENCNTR_APPEAL_ID:appealId,ENCNTR_ID:encounterId,PAYER_ORG_ID:denialAppeal.payerId,APPEAL_PRSNL_ID:denialAppeal.appealManagerId,APPEAL_LEVEL_CD:denialAppeal.levelCd,APPEAL_STATUS_CD:denialAppeal.statusCd,EXT_APPEAL_AGENCY_CD:denialAppeal.externalAppealAgencyCd,PROVIDED_LEVEL_OF_CARE_CD:denialAppeal.providedLOCCd?denialAppeal.providedLOCCd:"",PRE_LEVEL_OF_CARE_CD:denialAppeal.preAppealLOCCd?denialAppeal.preAppealLOCCd:"",POST_LEVEL_OF_CARE_CD:denialAppeal.postAppealLOCCd?denialAppeal.preAppealLOCCd:"",APPEAL_OUTCOME_CD:denialAppeal.outcomeCd,APPEAL_COMM_TYPE_CD:denialAppeal.communicationTypeCd,TRACKING_NBR_TEXT:RCM_Clinical_Util.encodeString(denialAppeal.trackingNumber),APPEAL_SENT_DT_TM:denialAppeal.sentDate?denialAppeal.sentDate.format("dd-mmm-yyyy HH:MM:ss"):"",APPEAL_VERIFIED_DT_TM:denialAppeal.verifiedDate?denialAppeal.verifiedDate.format("dd-mmm-yyyy HH:MM:ss"):"",APPEAL_EXPECT_RESP_DT_TM:denialAppeal.expectedResponseDate?denialAppeal.expectedResponseDate.format("dd-mmm-yyyy HH:MM:ss"):"",APPEAL_OUTCOME_DT_TM:denialAppeal.outcomeDate?denialAppeal.outcomeDate.format("dd-mmm-yyyy HH:MM:ss"):"",COMMENT_TEXT:RCM_Clinical_Util.encodeString(denialAppeal.comment),UPDT_CNT:updateCount,ADVISOR_PRSNL_ID:denialAppeal.advisorPhysicianId,DENIALS:denials,CLOSE_DENIALS_IND:closeDenialsIndicator}};
var sendAr=[];
sendAr.push("^MINE^","0.0","8","^"+JSON.stringify(jsonRequest)+"^");
var status=0;
var info=new XMLCclRequest();
info.onreadystatechange=function(){if(info.readyState===4&&info.status===200){var jsonEval=JSON.parse(info.responseText);
var recordData=jsonEval.RECORD_DATA;
if(recordData.STATUS_DATA.STATUS==="F"){var failureReasonFlag=recordData.FAILURE_REASON_FLAG;
status=failureReasonFlag>0?failureReasonFlag:-1;
}}else{if(info.readyState===4&&info.status!==200){status=-1;
}}};
info.open("GET","rcm_denied_days",0);
info.send(sendAr.join(","));
return status;
};
this.deleteDenialAppeal=function(appealId,updateCount){var jsonRequest={DELETE_APPEAL_REQUEST:{ENCNTR_APPEAL_ID:appealId,UPDT_CNT:updateCount}};
var sendAr=[];
sendAr.push("^MINE^","0.0","9","^"+JSON.stringify(jsonRequest)+"^");
var status=0;
var info=new XMLCclRequest();
info.onreadystatechange=function(){if(info.readyState===4&&info.status===200){var jsonEval=JSON.parse(info.responseText);
var recordData=jsonEval.RECORD_DATA;
if(recordData.STATUS_DATA.STATUS==="F"){var failureReasonFlag=recordData.FAILURE_REASON_FLAG;
status=failureReasonFlag>0?failureReasonFlag:-1;
}}else{if(info.readyState===4&&info.status!==200){status=-1;
}}};
info.open("GET","rcm_denied_days",0);
info.send(sendAr.join(","));
return status;
};
}
function DischargePlanningComponentStyle(){this.initByNamespace("rrcm-dcp-dcp");
}DischargePlanningComponentStyle.inherits(ComponentStyle);
function DischargePlanningComponent(criterion){this.setCriterion(criterion);
this.setStyles(new DischargePlanningComponentStyle());
this.setComponentLoadTimerName("USR:MPG.NW-rcm-dcp-DISCHARGE-PLANNING.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.NW-rcm-dcp-DISCHARGE-PLANNING.O1 - render component");
this.setIncludeLineNumber(true);
this.setScope(2);
DischargePlanningComponent.method("openTab",function(){var paramString=criterion.person_id+"|"+criterion.encntr_id+"|"+0+"|0|0";
MPAGES_EVENT("POWERFORM",paramString);
var contentNode=this.getSectionContentNode();
contentNode.innerHTML="";
this.InsertData();
});
DischargePlanningComponent.method("openDropDown",function(formID){var criterion=this.getCriterion();
var paramString=criterion.person_id+"|"+criterion.encntr_id+"|"+formID+"|0|0";
MPAGES_EVENT("POWERFORM",paramString);
var contentNode=this.getSectionContentNode();
contentNode.innerHTML="";
this.InsertData();
});
DischargePlanningComponent.method("InsertData",function(){CERN_DischargePlanningInfo.getDischargePlanningData(this);
});
DischargePlanningComponent.method("HandleSuccess",function(recordData){CERN_DischargePlanningInfo.RenderComponent(this,recordData);
});
DocumentComponent.method("openTab",function(){var criterion=this.getCriterion();
var sParms="/PERSONID="+criterion.person_id+" /ENCNTRID="+criterion.encntr_id+" /FIRSTTAB=^"+this.getLink()+"+^";
APPLINK(0,criterion.executable,sParms);
this.InsertData();
});
DischargePlanningComponent.method("setCategoryMeaning",function(value){this.m_CategoryMeaning=value;
});
DischargePlanningComponent.method("getCategoryMeaning",function(){return this.m_CategoryMeaning;
});
DischargePlanningComponent.method("setReportMeaning",function(value){this.m_ReportMeaning=value;
});
DischargePlanningComponent.method("getReportMeaning",function(){return this.m_ReportMeaning;
});
DischargePlanningComponent.method("setDischargePlan",function(value){this.m_DischargePlan=value;
});
DischargePlanningComponent.method("getDischargePlan",function(){return this.m_DischargePlan;
});
DischargePlanningComponent.method("setEventSets",function(value){this.m_EventSets=value;
});
DischargePlanningComponent.method("getEventSets",function(){return this.m_EventSets;
});
DischargePlanningComponent.method("setVisitRelationshipTypes",function(value){this.m_VisitRelationshipTypes=value;
});
DischargePlanningComponent.method("getVisitRelationshipTypes",function(){return this.m_VisitRelationshipTypes;
});
DischargePlanningComponent.method("setEncntrTypes",function(value){this.m_EncntrTypes=value;
});
DischargePlanningComponent.method("getEncntrTypes",function(){return this.m_EncntrTypes;
});
DischargePlanningComponent.method("setMedicareFinacialTypes",function(value){this.m_MedicareFinacialTypes=value;
});
DischargePlanningComponent.method("getMedicareFinacialTypes",function(){return this.m_MedicareFinacialTypes;
});
DischargePlanningComponent.method("setEventSetsSort",function(value){this.m_EventSetsSort=value;
});
DischargePlanningComponent.method("getEventSetsSort",function(){return this.m_EventSetsSort;
});
DischargePlanningComponent.method("setAdmitMIM",function(value){this.m_AdmitMIM=value;
});
DischargePlanningComponent.method("getAdmitMIM",function(){return this.m_AdmitMIM;
});
DischargePlanningComponent.method("setDischargeMIM",function(value){this.m_DischargeMIM=value;
});
DischargePlanningComponent.method("getDischargeMIM",function(){return this.m_DischargeMIM;
});
DischargePlanningComponent.method("setReadmissionLink",function(value){this.m_ReadmissionLink=value;
});
DischargePlanningComponent.method("getReadmissionLink",function(){return this.m_ReadmissionLink;
});
}DischargePlanningComponent.inherits(MPageComponent);
var CERN_DischargePlanningInfo=function(){return{getDischargePlanningData:function(component){var sendAr=[];
var criterion=component.getCriterion();
var groups=component.getGroups();
var events=[];
events.push('^{"getDischargePlanningRequest": {"encntr_id": "',criterion.encntr_id,'.0",');
events.push('"category_meaning":"',component.getCategoryMeaning(),'",');
events.push('"report_meaning": "',component.getReportMeaning(),'",');
events.push('"discharge_plan": "',component.getDischargePlan(),'",');
events.push('"encntr_types": "',component.getEncntrTypes(),'",');
events.push('"relationships": "',component.getVisitRelationshipTypes(),'",');
events.push('"medicare_finacial_types": "',component.getMedicareFinacialTypes(),'",');
events.push('"event_sets": "',component.getEventSets(),'",');
events.push('"event_sets_sort": "',component.getEventSetsSort(),'",');
events.push('"admit_mim": "',component.getAdmitMIM(),'",');
events.push('"discharge_mim": "',component.getDischargeMIM(),'",');
events.push('"readmission_link": "',component.getReadmissionLink(),'"}}^');
var dc_dc_plan="",dc_dc_disp="",dc_transp_arrange="",dc_prof_skill_ant="",dc_dme_ant="",dc_dme_coord="";
var dc_plan_dc_dt_tm="",dc_adm_mim="",dc_disch_mim="";
sendAr.push("^MINE^","GETDISCHARGEPLANNING",events.join(""));
RCM_Clinical_Util.makeTimerCCLRequest(component,"rcm_discharge_planning",sendAr,true,function(status,RECORDDATA,errorInfo){if("S"===status){component.HandleSuccess(RECORDDATA);
}else{component.HandleSuccess(null);
}});
},RenderComponent:function(component,recordData){var timerRenderComponent=MP_Util.CreateTimer(component.getComponentRenderTimerName());
try{var jsHTML=[];
if(component.getCriterion().encntr_id===0){jsHTML.push("<div>",rcm_discharge_planning_i18n.RCM_INVALID_ENCOUNTER_MESSAGE,"</div>");
}else{var dateTime=new Date();
var rcmdisRowCount=2+recordData.EVENT_SETS.length+recordData.RELATED_PRSNL.length;
if(recordData.MEDICARE_IND===1){rcmdisRowCount+=2;
}var mode=0;
var appName=rcm_discharge_planning_i18n.RCM_POWERCHART;
var tab=recordData.READMISSION_LINK;
var params="/PERSONID="+component.criterion.person_id+" /ENCNTRID="+component.criterion.encntr_id+" /FIRSTTAB=^"+tab+"+^";
jsHTML.push("<div class='",MP_Util.GetContentClass(component,rcmdisRowCount),"'>");
jsHTML.push("<dl class='rcm-dcp-info'><dt><span>",rcm_discharge_planning_i18n.CURRENTDOCUMENTEDPLAN,":</span></dt><dd class='rcm-dcp-detail'><span>",recordData.DISCHARGE_EVENT_SET.VALUE,"</span></dd></dl>");
if(recordData.MEDICARE_IND===1){jsHTML.push("<dl class='rcm-dcp-info'><dt><span>",rcm_discharge_planning_i18n.ADMITIM);
jsHTML.push(":</span></dt><dd class='rcm-dcp-detail'><span>",recordData.ADMIT_MIM_EVENT_SET.VALUE,"</span></dd></dl>");
jsHTML.push("<dl class='rcm-dcp-info'><dt><span>",rcm_discharge_planning_i18n.DISCHARGEIM);
jsHTML.push(":</span></dt><dd class='rcm-dcp-detail'><span>",recordData.DISCHARGE_MIM_EVENT_SET.VALUE,"</span></dd></dl>");
}for(var i=0,eventLength=recordData.EVENT_SETS.length;
i<eventLength;
i++){jsHTML.push("<dl class='rcm-dcp-info'><dt><span>",recordData.EVENT_SETS[i].LABEL,":</span></dt>");
jsHTML.push("<dd class='rcm-dcp-detail'><span>",recordData.EVENT_SETS[i].VALUE,"</span></dd></dl>");
}for(var i=0,relLength=recordData.RELATED_PRSNL.length;
i<relLength;
i++){jsHTML.push("<dl class='rcm-dcp-info'><dt><span>",recordData.RELATED_PRSNL[i].RELATIONSHIPTYPENAME,":</span></dt>");
jsHTML.push("<dd class='rcm-dcp-detail'><span>",recordData.RELATED_PRSNL[i].NAME,"</span></dd></dl>");
}if(recordData.READMITTANCE_IND===1){jsHTML.push("<dl class='rcm-dcp-info'><dt><span>",rcm_discharge_planning_i18n.READMISSION,":</span></dt>");
jsHTML.push("<dd class='rcm-dcp-detail'><span>");
if(recordData.READMISSION_DOC_IND===1){jsHTML.push("<a style='color:black; text-decoration:none; font-weight:normal;'");
}else{jsHTML.push("<a style='color:red; text-decoration:none; font-weight:bold;'");
}jsHTML.push("href='javascript:APPLINK("+mode+', "'+appName+'", "'+params+"\");'>",rcm_discharge_planning_i18n.YES,"</a>&nbsp;</span></dd></dl>");
}jsHTML.push("<dl class='rcm-dcp-info'><dt><span></span></dt><dd class='rcm-dcp-detail'><span></span></dd></dl>");
jsHTML.push("</div>");
}sHTML=jsHTML.join("");
countText="&nbsp;";
MP_Util.Doc.FinalizeComponent(sHTML,component,countText);
if(component.getCriterion().encntr_id===0){var addPlus=document.getElementById("rrcm-dcp-dcpAdd");
if(addPlus){addPlus.style.display="none";
}var addDrop=document.getElementById("rrcm-dcp-dcpDrop");
if(addDrop){addDrop.style.display="none";
}}return;
}catch(err){if(timerRenderComponent){timerRenderComponent.Abort();
timerRenderComponent=null;
}throw (err);
}finally{if(timerRenderComponent){timerRenderComponent.Stop();
}}}};
}();

function RCMDocReviewMessageCenterPopup(component){var sendRequest={patientId:"",encounterId:"",receivers:[],checkOutOfOffice:0};
RCMAutoSuggestControl.prototype.init=function(){var that=this;
this.textbox.onkeyup=function(oEvent){if(!oEvent){oEvent=window.event;
}that.handleKeyUp(oEvent);
};
this.textbox.onkeydown=function(oEvent){if(!oEvent){oEvent=window.event;
}that.handleKeyDown(oEvent);
};
this.textbox.onblur=function(){that.hideSuggestions();
};
this.createDropDown();
};
var isNonMessageCenterRequest=false;
var serviceDelegate=new DocReviewMessageCenterDelegate();
var secondaryReviewItems=serviceDelegate.getReasonsAndCommunicationTypes();
var formData;
this.getHTML=function(recordData){formData=recordData;
var criterion=component.getCriterion();
var imageLoc=criterion.static_content+"\\images\\5941_16.ico";
sendRequest.patientId=criterion.person_id;
sendRequest.encounterId=criterion.encntr_id;
var htmlArray=[];
htmlArray.push("<div class='drmcd-dialog'>");
htmlArray.push("<div class='drmcd-dialog-title-bar'>");
htmlArray.push("<label>",rcm_doc_review_message_center_dialog_i18n.SEND_QUERY,"</label>");
htmlArray.push("</div>");
htmlArray.push("<div class='drmcd-content-separator'></div>");
htmlArray.push("<div>");
htmlArray.push("<div class='drmcd-clear-previous-divs'>");
htmlArray.push("<div class='drmcd-indent drmcd-padding drmcd-float-left'>");
htmlArray.push("<input type='checkbox' id='drmcdSendRequestCheck' name='drmcdSendRequestCheck'/>");
htmlArray.push("<label for='drmcdSendRequestCheck'>",rcm_doc_review_message_center_dialog_i18n.SEND_REQUEST_VIA_MESSAGE_CENTER,"</label>");
htmlArray.push("</div>");
htmlArray.push("</div>");
htmlArray.push("<div class='drmcd-clear-previous-divs drmcd-padding'>");
htmlArray.push("<div class='drmcd-indent drmcd-float-left'>");
htmlArray.push("<label id='drmcd-RecipientSearchLabel' for='drmcdRecipientSearch'>",rcm_doc_review_message_center_dialog_i18n.RECIPIENT,"</label><br/>");
htmlArray.push("<input type='text' class='searchText drmcd-searchAndReason' id='drmcdRecipientSearch'/>");
htmlArray.push("<button id='drmcdRecipientPersonalAddressBook' type='button' class='drmcd-button-image'><img id='drmcdContactImage' src='",imageLoc,"' alt='' title='",rcm_doc_review_message_center_dialog_i18n.PERSONAL_ADDRESS_LIST,"' class='drmcd-address-book-button-image'/></button>");
htmlArray.push("</div>");
htmlArray.push("<div id='drmcd-NonMessageCenterDueDateDiv' class='drmcd-indent drmcd-float-left'>");
htmlArray.push("<label for='drmcdNonMCDueDatePicker'>",rcm_doc_review_message_center_dialog_i18n.DUE_DATE,"</label><br/>");
htmlArray.push("<input type='text' maxLength='10' id='drmcdNonMCDueDatePicker'/>");
htmlArray.push("</div>");
htmlArray.push("</div>");
htmlArray.push("</div>");
htmlArray.push("<div class='drmcd-validateMessagesDiv' id='drmcd-validateMessages'></div>");
htmlArray.push("<div id='drmcdtoggleDiv' class='drmcd-clear-previous-divs drmcd-padding-top'>");
htmlArray.push("</div>");
htmlArray.push("<div class='drmcd-dialog-buttons-div'>");
htmlArray.push("<input class='drmcd-dialog-buttons' type='button' id='drmcdCancelButton' value='",rcm_doc_review_message_center_dialog_i18n.CANCEL,"'/>");
htmlArray.push("<input class='drmcd-dialog-buttons' type='button' id='drmcdSendRequestButton' value='",rcm_doc_review_message_center_dialog_i18n.SEND_REQUEST,"'/>");
htmlArray.push("<label class='drmcd-dialog-send-checkbox-label' for='drmcdSendACopyToMyselfCheckbox'>",rcm_doc_review_message_center_dialog_i18n.SEND_A_COPY_TO_MYSELF,"</label>");
htmlArray.push("<input class='drmcd-dialog-send-checkbox' type='checkbox' id='drmcdSendACopyToMyselfCheckbox'/>");
htmlArray.push("</div>");
htmlArray.push("<div id='drmcd-favoritesListDisplay' class='srmd-hiddenDiv'></div>");
htmlArray.push("<div id='drmcdPopupTransparentDiv' class='drmcd-error-popup-transparent-div'></div>");
htmlArray.push(createOkDialogHTML());
htmlArray.push("</div>");
document.getElementById("drmcd-MessageCenterDialog").innerHTML=htmlArray.join("");
addEvents();
};
function addEvents(){$("#drmcdSendRequestCheck").attr("checked",true);
if($("#drmcdSendRequestCheck").attr("checked")){addMessageCenterEvents();
}else{addNonMessageCenterEvents();
$("#drmcd-validateMessages").html("");
$("#drmcd-validateMessages").hide();
}var nonMCDueDatePicker=RCM_Clinical_Util.addDatePicker(component,"drmcdNonMCDueDatePicker");
nonMCDueDatePicker.setMinDate(new Date());
RCM_Clinical_Util.setDateString("drmcdNonMCDueDatePicker",null);
$("#drmcdSendRequestCheck").click(function(){if($("#drmcdSendRequestCheck").attr("checked")){addMessageCenterEvents();
$("#drmcd-validateMessages").html("");
$("#drmcd-validateMessages").hide();
}else{addNonMessageCenterEvents();
$("#drmcd-validateMessages").html("");
$("#drmcd-validateMessages").hide();
}});
$("#drmcdCancelButton").click(function(){$("#drmcd-transparentDiv").hide();
$("#drmcd-MessageCenterDialog").hide();
});
$("#drmcdRecipientSearch").keyup(function(event){var key;
if(window.event){key=event.keyCode;
}else{if(event.which){key=event.which;
}}if(key===8||key===46){if($("#drmcd-validateMessages").html()!==""){$("#drmcd-validateMessages").html("");
$("#drmcd-validateMessages").hide();
}if($("#drmcdRecipientSearch").val()===""){RCM_Clinical_Util.maskRequiredField("drmcdRecipientSearch");
if(!isNonMessageCenterRequest){$("#drmcdSendRequestButton").attr("disabled","disabled");
}else{$("#drmcdDocumentRequestButton").attr("disabled","disabled");
}}}if($("#drmcdRecipientSearch").val().length===1){RCM_Clinical_Util.maskRequiredField("drmcdRecipientSearch");
if(!isNonMessageCenterRequest){$("#drmcdSendRequestButton").attr("disabled","disabled");
}else{$("#drmcdDocumentRequestButton").attr("disabled","disabled");
}sendRequest.receivers=[];
if($("#drmcd-validateMessages").html()!==""){$("#drmcd-validateMessages").html("");
$("#drmcd-validateMessages").hide();
var text=$("#drmcdRecipientSearch").val();
$("#drmcdRecipientSearch").val("");
$("#drmcdRecipientSearch").click();
$("#drmcdRecipientSearch").val(text);
}}if((sendRequest.receivers.length>0)&&(!((key===37)||(key===39)||(key===13)))){sendRequest.receivers=[];
$("#drmcdRecipientSearch").val("");
RCM_Clinical_Util.maskRequiredField("drmcdRecipientSearch");
$("#drmcdDocumentRequestButton").attr("disabled","disabled");
}});
$("#drmcdRecipientSearch").click(function(){$("#drmcdRecipientSearch").select();
});
$("#drmcdRecipientPersonalAddressBook").click(function(){if($("#drmcd-favoritesListDisplay").css("display")==="none"){var favoritesList=serviceDelegate.getFavoritesList();
$("#drmcd-favoritesListDisplay").html(createFavoritesListTableDiv(favoritesList));
var pos=getMousePosition(this,event);
$("#drmcd-favoritesListDisplay").css("top",pos.y+"px");
$("#drmcd-favoritesListDisplay").css("left",pos.x+"px");
$("#drmcd-favoritesListDisplay").css("display","block");
$("#drmcd-favoritesListDisplay").focus();
addTableEvents();
}else{$("#drmcd-favoritesListDisplay").css("display","none");
}});
$("#drmcd-favoritesListDisplay").blur(function(){if(!($(document.activeElement).parent().hasClass("srmd-favoritesListRow"))&&$(document.activeElement).parent().attr("id")!=="drmcd-favoritesListDisplay"&&$(document.activeElement).attr("id")!=="drmcdRecipientPersonalAddressBook"){$("#drmcd-favoritesListDisplay").css("display","none");
}else{$("#drmcd-favoritesListDisplay").focus();
}});
$("#drmcdRecipientSearch").blur(function(){if($("#drmcdRecipientSearch").val()===""){sendRequest.receivers=[];
RCM_Clinical_Util.maskRequiredField("drmcdRecipientSearch");
$("#drmcdDocumentRequestButton").attr("disabled","disabled");
}else{if($("#drmcdRecipientSearch").css("background-color").toLowerCase()==="#fffce1"&&sendRequest.receivers.length===0){$("#drmcdRecipientSearch").val("");
$("#drmcdRecipientSearch").focus();
}}});
var providerSearchControl=new ProviderSearchControl(document.getElementById("drmcdRecipientSearch"));
providerSearchControl.enableProviderSearchOrgSecurity(true);
providerSearchControlListener=function(){var personnelSelected=providerSearchControl.getSelectedProviderId();
sendRequest.receivers=[];
var selectedEntityType=rcm_doc_review_message_center_dialog_i18n.PERSONNEL;
var selectedEntityId=personnelSelected;
sendRequest.receivers.push({entityType:selectedEntityType,entityId:selectedEntityId});
sendRequest.checkOutOfOffice=1;
var validateStatus;
if($("#drmcdSendRequestCheck").attr("checked")){validateStatus=validateRecipients();
}else{validateStatus=0;
}if(validateStatus>=0){RCM_Clinical_Util.umMaskRequiredField("drmcdRecipientSearch");
if(!isNonMessageCenterRequest){if(checkDueDateAndTimeForButton()){$("#drmcdSendRequestButton").removeAttr("disabled");
}}else{if($("#drmcd-CommunicationTypeOptions input:radio:checked").val()!==undefined){$("#drmcdDocumentRequestButton").removeAttr("disabled");
}}}};
providerSearchControl.addVerifyStateChangeListener(providerSearchControlListener);
RCM_Clinical_Util.maskRequiredField("drmcdRecipientSearch");
$("#drmcdDialogOkButton").click(function(){$("#drmcdOkDialog").hide();
$("#drmcdPopupTransparentDiv").hide();
$("#drmcdCancelButton").click();
});
}function addMessageCenterEvents(){isNonMessageCenterRequest=false;
$("#drmcd-NonMessageCenterDueDateDiv").hide();
$("#drmcdtoggleDiv").html(createMessageCenterDiv());
if($("#drmcdDocumentRequestButton").length>0){$("#drmcdDocumentRequestButton").val(rcm_doc_review_message_center_dialog_i18n.SEND_REQUEST);
$("#drmcdDocumentRequestButton").attr("id","drmcdSendRequestButton");
$("#drmcd-RecipientSearchLabel").text(rcm_doc_review_message_center_dialog_i18n.RECIPIENT);
RCM_Clinical_Util.addRequiredDecorator(document.getElementById("drmcdRecipientSearch"));
$("#drmcdRecipientPersonalAddressBook").removeAttr("disabled");
}$("#drmcdMarkedCompleteCheckbox").attr("checked",true);
$("#drmcdContactImage").css("opacity","");
$("#drmcdContactImage").css("filters","");
$(".drmcd-dialog-send-checkbox-label").show();
$("#drmcdSendACopyToMyselfCheckbox").show();
var dueDatePicker=RCM_Clinical_Util.addDatePicker(component,"drmcdDueDatePicker");
dueDatePicker.setMinDate(new Date());
RCM_Clinical_Util.setDateString("drmcdDueDatePicker",null);
var dueTimePicker=RCM_Clinical_Util.addTimePicker("drmcdDueTimePicker");
$("#drmcdBecomesOverdueCheckbox").attr("checked","checked");
checkDueDate();
checkDueTime();
$("#drmcdDueTimePicker").dblclick(function(){$("#drmcdDueTimePicker").val("");
if($("#drmcdDueDatePicker").val().length>0){RCM_Clinical_Util.maskRequiredField("drmcdDueTimePicker");
$("#drmcdSendRequestButton").attr("disabled","disabled");
}});
$("#drmcdDueTimePicker").change(function(){checkDueTime();
});
$("#drmcdDueDatePicker").blur(function(){checkDueDate();
checkDueTime();
});
$("#drmcdDueDatePicker").keyup(function(){checkDueDate();
checkDueTime();
});
$("#drmcdDueDatePicker").bind("select",function(){checkDueDate();
checkDueTime();
});
$("#drmcdBecomesOverdueCheckbox").click(function(){checkDueDate();
checkDueTime();
});
$("#drmcdMessageArea").keyup(function(){var len=this.value.length;
if(len>10000){this.value=this.value.substring(0,10000);
}});
$("#drmcdSendRequestButton").unbind("click");
$("#drmcdSendRequestButton").click(function(){$("#drmcdSendRequestButton").attr("disabled","disabled");
var date=RCM_Clinical_Util.getDate("drmcdDueDatePicker");
var time=RCM_Clinical_Util.getTime("drmcdDueTimePicker");
var dateReviewed="";
if(date){date.setHours(time.getHours(),time.getMinutes(),0,0);
dateReviewed=date.format("dd-mmm-yyyy HH:MM:ss");
}var queryRequestRecipients=[];
queryRequestRecipients.push({entitytype:sendRequest.receivers[0].entityType,entityname:$("#drmcdRecipientSearch").val(),entityid:String(sendRequest.receivers[0].entityId)});
var jsonRequest={add_followup_msgcenter_request:{rcmDocReviewId:formData.rcmReviewId?formData.rcmReviewId:"",documentReviewId:formData.reviewId?formData.reviewId:"",documentUpdateCount:formData.updateCount?formData.updateCount:0,rcmDocReviewFollowupId:formData.followupId?formData.followupId:"",docReviewFollowupId:formData.docReviewFollowupId?formData.docReviewFollowupId:"",docReviewFollowupUpdateCnt:formData.followUpUpdtCount?formData.followUpUpdtCount:0,outcomeCommentText:RCM_Clinical_Util.encodeString($("#drmcdMessageArea").val()),recipients:queryRequestRecipients,priorityLevelFlag:0,notifyOpenedInd:$("#drmcdNotifyOpenedCheckbox").attr("checked")?1:0,notifyCompleteInd:$("#drmcdMarkedCompleteCheckbox").attr("checked")?1:0,notifyOverdueInd:$("#drmcdBecomesOverdueCheckbox").attr("checked")?1:0,notifyPriorityLevelFlag:$("#drmcdFlagAsHighPriorityCheckbox").attr("checked")?1:0,notifyrecipient:{entitytype:"",entityname:"",entityid:""},ccToMyselfInd:$("#drmcdSendACopyToMyselfCheckbox").attr("checked")?1:0,overDueDtTm:dateReviewed}};
var replyStatus=serviceDelegate.addQueryMsgCenterRequest(jsonRequest);
if(replyStatus===0){$("#drmcd-transparentDiv").hide();
$("#drmcd-MessageCenterDialog").hide();
component.InsertData(formData.reviewId,function(){RCM_DocumentationForm.showQueryAddedBanner(true);
$("#drfFollowUp").hide();
RCM_DocumentationForm.saveListner();
});
}else{if(replyStatus===1){openStaleDataErrorDialog();
}else{openSendFailedDialog();
}}});
$("#drmcdRecipientSearch").val("");
RCM_Clinical_Util.maskRequiredField("drmcdRecipientSearch");
$("#drmcdSendRequestButton").attr("disabled","disabled");
$("#drmcdSendRequestButton").attr("disabled","disabled");
$("#drmcdSendRequestCheck").attr("checked",true);
$("#drmcdRecipientSearch").focus();
}function checkDueDate(){if($("#drmcdBecomesOverdueCheckbox").attr("checked")){if($("#drmcdDueDatePicker").datepicker("getDate")){RCM_Clinical_Util.addRequiredDecorator(document.getElementById("drmcdDueDatePicker"));
}else{RCM_Clinical_Util.maskRequiredField("drmcdDueDatePicker");
$("#drmcdSendRequestButton").attr("disabled","disabled");
}}else{RCM_Clinical_Util.umMaskRequiredField("drmcdDueDatePicker");
RCM_Clinical_Util.removeRequiredDecorator(document.getElementById("drmcdDueDatePicker"));
if(checkRecipientAndReasonForButton()){$("#drmcdSendRequestButton").removeAttr("disabled");
}else{$("#drmcdSendRequestButton").attr("disabled","disabled");
}}}function checkDueTime(){if($("#drmcdBecomesOverdueCheckbox").attr("checked")){if($("#drmcdDueTimePicker").val().length>0){RCM_Clinical_Util.addRequiredDecorator(document.getElementById("drmcdDueTimePicker"));
RCM_Clinical_Util.umMaskRequiredField("drmcdDueTimePicker");
if(checkRecipientAndReasonForButton()){if($("#drmcdDueDatePicker").datepicker("getDate")){$("#drmcdSendRequestButton").removeAttr("disabled");
}}else{$("#drmcdSendRequestButton").attr("disabled","disabled");
}}else{RCM_Clinical_Util.maskRequiredField("drmcdDueTimePicker");
$("#drmcdSendRequestButton").attr("disabled","disabled");
}}else{if($("#drmcdDueDatePicker").datepicker("getDate")){if($("#drmcdDueTimePicker").val().length>0){RCM_Clinical_Util.addRequiredDecorator(document.getElementById("drmcdDueTimePicker"));
RCM_Clinical_Util.umMaskRequiredField("drmcdDueTimePicker");
if(checkRecipientAndReasonForButton()){$("#drmcdSendRequestButton").removeAttr("disabled");
}else{$("#drmcdSendRequestButton").attr("disabled","disabled");
}}else{RCM_Clinical_Util.maskRequiredField("drmcdDueTimePicker");
$("#drmcdSendRequestButton").attr("disabled","disabled");
}}else{RCM_Clinical_Util.umMaskRequiredField("drmcdDueTimePicker");
RCM_Clinical_Util.removeRequiredDecorator(document.getElementById("drmcdDueTimePicker"));
if(checkRecipientAndReasonForButton()){$("#drmcdSendRequestButton").removeAttr("disabled");
}else{$("#drmcdSendRequestButton").attr("disabled","disabled");
}}}}function checkDueDateAndTimeForButton(){if($("#drmcdBecomesOverdueCheckbox").attr("checked")){if($("#drmcdDueDatePicker").datepicker("getDate")&&$("#drmcdDueTimePicker").val().length>0){return true;
}}else{if($("#drmcdDueDatePicker").datepicker("getDate")){if($("#drmcdDueTimePicker").val().length>0){return true;
}}else{return true;
}}return false;
}function checkRecipientAndReasonForButton(){if($("#drmcdRecipientSearch").val()!==""&&$("#drmcdRecipientSearch").css("background-color").toLowerCase()!=="#fffce1"){return true;
}return false;
}function addNonMessageCenterEvents(){isNonMessageCenterRequest=true;
$("#drmcdtoggleDiv").html(createNonMessageCenterDiv());
$("#drmcd-NonMessageCenterDueDateDiv").show();
$("#drmcdRecipientPersonalAddressBook").attr("disabled","disabled");
$(".drmcd-dialog-send-checkbox-label").hide();
$("#drmcdSendACopyToMyselfCheckbox").hide();
$("#drmcdContactImage").css("opacity",0.4);
$("#drmcdContactImage").css("filters","alpha(opacity=40)");
$("#drmcd-RecipientSearchLabel").text(rcm_doc_review_message_center_dialog_i18n.REVIEWER);
$("#drmcdSendRequestButton").val(rcm_doc_review_message_center_dialog_i18n.DOCUMENT_REQUEST);
$("#drmcdSendRequestButton").attr("id","drmcdDocumentRequestButton");
RCM_Clinical_Util.addRequiredDecorator(document.getElementById("drmcd-CommunicationTypeOptions"));
RCM_Clinical_Util.addRequiredDecorator(document.getElementById("drmcdRecipientSearch"));
$("#drmcdRecipientSearch").val("");
RCM_Clinical_Util.maskRequiredField("drmcdRecipientSearch");
$("#drmcdDocumentRequestButton").attr("disabled","disabled");
$("#drmcdDocumentRequestButton").attr("disabled","disabled");
$(".drmcd-communication-type-option").click(function(){if($("#drmcdRecipientSearch").val()!==""){$("#drmcdDocumentRequestButton").removeAttr("disabled");
}});
$("#drmcdDocumentRequestButton").unbind("click");
$("#drmcdDocumentRequestButton").click(function(){$("#drmcdDocumentRequestButton").attr("disabled","disabled");
$("#drmcd-transparentDiv").hide();
$("#drmcd-MessageCenterDialog").hide();
var date=RCM_Clinical_Util.getDate("drmcdNonMCDueDatePicker")?RCM_Clinical_Util.getDate("drmcdNonMCDueDatePicker"):"";
if(date!==""){var today=new Date();
date.setHours(today.getHours(),today.getMinutes(),0,0);
date=date.format("dd-mmm-yyyy HH:MM:ss");
}var queryDocumentInfo={communicationTypeCd:$("input[name=drmcdCommunRadio]:checked").val(),prsnlName:$("#drmcdRecipientSearch").val(),prsnlId:sendRequest.receivers.length>0?String(sendRequest.receivers[0].entityId):"0.0",expectedResponseDate:date};
RCM_DocumentationForm.saveForm(queryDocumentInfo);
});
$("#drmcdRecipientSearch").focus();
}function addTableEvents(){var favoritesRows=$(".srmd-favoritesListRow");
favoritesRows.each(function(){$(this).mouseover(function(){if(!($(this).hasClass("drmcd-favoriteRowSelected"))){$(this).addClass("drmcd-favoriteRowHighlight");
}});
$(this).mouseout(function(){$(this).removeClass("drmcd-favoriteRowHighlight");
});
$(this).click(function(){sendRequest.receivers=[];
$(this).removeClass("drmcd-favoriteRowHighlight");
$(this).addClass("drmcd-favoriteRowSelected");
var selectedEntityType=$(this).find("td.drmcd-favoriteListColumnOne").attr("id");
var selectedEntityId=$(this).attr("id");
sendRequest.receivers.push({entityType:selectedEntityType,entityId:selectedEntityId});
if(selectedEntityType===rcm_doc_review_message_center_dialog_i18n.POOL){sendRequest.checkOutOfOffice=0;
}else{sendRequest.checkOutOfOffice=1;
}var selectedName=$(this).find("span.drmcd-entityName").html();
$("#drmcdRecipientSearch").val(selectedName);
$("#drmcd-favoritesListDisplay").css("display","none");
var validateStatus;
if($("#drmcdSendRequestCheck").attr("checked")){validateStatus=validateRecipients();
}else{validateStatus=0;
}if(validateStatus>=0){RCM_Clinical_Util.umMaskRequiredField("drmcdRecipientSearch");
if(checkDueDateAndTimeForButton()){$("#drmcdSendRequestButton").removeAttr("disabled");
}if($("#drmcd-validateMessages").html()!==""){$("#drmcd-validateMessages").html("");
$("#drmcd-validateMessages").hide();
}}});
});
}function validateRecipients(){var status=-1;
var validateSelectedRecipients=serviceDelegate.validateRecipients(sendRequest);
for(var i=0;
i<validateSelectedRecipients.length;
i++){var vsr=validateSelectedRecipients[i];
if(vsr.validFlag>=0){status=vsr.validFlag;
}if(vsr.validFlag===-4){$("#drmcd-validateMessages").html(rcm_doc_review_message_center_dialog_i18n.POOL_WITH_NO_MEMBERS);
$("#drmcd-validateMessages").show();
$("#drmcdRecipientSearch").select();
status=-4;
}if(vsr.validFlag===-3){$("#drmcd-validateMessages").html(rcm_doc_review_message_center_dialog_i18n.POOL_INACTIVE);
$("#drmcd-validateMessages").show();
$("#drmcdRecipientSearch").select();
status=-3;
}if(vsr.validFlag===-1){$("#drmcd-validateMessages").html(rcm_doc_review_message_center_dialog_i18n.POOL_RECEIVERS_NOT_CONFIGURED);
$("#drmcd-validateMessages").show();
$("#drmcdRecipientSearch").select();
status=-1;
}if(vsr.outOfOfficeInd===1){var date;
if(vsr.returnDateTime!==""){date=RCM_Clinical_Util.formatJsonDateString(validateSelectedRecipients[i].returnDateTime);
}else{date=rcm_doc_review_message_center_dialog_i18n.NOT_AVAILABLE;
}var outOfOfficeString=rcm_doc_review_message_center_dialog_i18n.OUT_OF_OFFICE+date;
$("#drmcd-validateMessages").html(outOfOfficeString);
$("#drmcd-validateMessages").show();
$("#drmcdRecipientSearch").select();
status=-5;
}}return status;
}function createMessageCenterDiv(){var htmlMCArray=[];
htmlMCArray.push("<div class='drmcd-float-left'>");
htmlMCArray.push("<div class='drmcd-indent-no-bottom'>");
htmlMCArray.push("<label for='drmcdDueDatePicker'>",rcm_doc_review_message_center_dialog_i18n.DUE_DATE,"</label><br/>");
htmlMCArray.push("<input type='text'  maxLength='10' id='drmcdDueDatePicker'/>");
htmlMCArray.push("</div>");
htmlMCArray.push("<div class='drmcd-indent'>");
htmlMCArray.push("<label for='drmcdDueTimePicker'>",rcm_doc_review_message_center_dialog_i18n.DUE_TIME,"</label><br/>");
htmlMCArray.push("<input type='text' id='drmcdDueTimePicker' maxlength='10'/>");
htmlMCArray.push("</div>");
htmlMCArray.push("</div>");
htmlMCArray.push("<div class='drmcd-ind drmcd-float-left drmcd-notOpPadding'>");
htmlMCArray.push("<label for='drmcdNotifyCheckboxes'>",rcm_doc_review_message_center_dialog_i18n.NOTIFY_WHEN,":</label>");
htmlMCArray.push("<div class='drmcd-optionBorder'>");
htmlMCArray.push("<div>");
htmlMCArray.push("<div>");
htmlMCArray.push("<input type='checkbox' id='drmcdNotifyOpenedCheckbox'/>");
htmlMCArray.push("<label class='drmcd-padding-between-label-and-checkbox' for='drmcdNotifyOpenedCheckbox'>",rcm_doc_review_message_center_dialog_i18n.OPENED,"</label>");
htmlMCArray.push("<span class='drmcd-farRightOption'>");
htmlMCArray.push("<input type='checkbox' id='drmcdFlagAsHighPriorityCheckbox'/>");
htmlMCArray.push("<label for='drmcdFlagAsHighPriorityCheckbox'>",rcm_doc_review_message_center_dialog_i18n.FLAG_AS_HIGH_PRIORITY,"</label>");
htmlMCArray.push("</span>");
htmlMCArray.push("</div>");
htmlMCArray.push("<div>");
htmlMCArray.push("<input type='checkbox' id='drmcdMarkedCompleteCheckbox'/>");
htmlMCArray.push("<label class='drmcd-padding-between-label-and-checkbox' for='drmcdMarkedCompleteCheckbox'>",rcm_doc_review_message_center_dialog_i18n.MARKED_COMPLETE,"</label>");
htmlMCArray.push("</div>");
htmlMCArray.push("<div>");
htmlMCArray.push("<input type='checkbox' id='drmcdBecomesOverdueCheckbox'/>");
htmlMCArray.push("<label class='drmcd-padding-between-label-and-checkbox' for='drmcdBecomesOverdueCheckbox'>",rcm_doc_review_message_center_dialog_i18n.BECOMES_OVERDUE,"</label>");
htmlMCArray.push("</div>");
htmlMCArray.push("</div>");
htmlMCArray.push("</div>");
htmlMCArray.push("</div>");
htmlMCArray.push("<div class='drmcd-indent drmcd-indent-bottom drmcd-padding-message-area'>");
htmlMCArray.push("<label for='drmcdMessageArea'>",rcm_doc_review_message_center_dialog_i18n.MESSAGE,"</label>");
htmlMCArray.push("<div class='drmcd-comment-group'>");
htmlMCArray.push("<textarea class='drmcd-comment' id='drmcdMessageArea'></textArea>");
htmlMCArray.push("</div>");
htmlMCArray.push("</div>");
return htmlMCArray.join("");
}function createNonMessageCenterDiv(){var htmlNMCArray=[];
htmlNMCArray.push("<div class='drmcd-communication-type-div drmcd-indent'>");
htmlNMCArray.push("<label for='drmcd-CommunicationTypeOptions' class='drmcd-padding-between-label-and-input'>",rcm_doc_review_message_center_dialog_i18n.COMMUNICATION_TYPE,"</label>");
htmlNMCArray.push("<div id='drmcd-CommunicationTypeOptions'>");
for(var i=0;
i<secondaryReviewItems.secondaryReviewCommunicationTypes.length;
i++){if(secondaryReviewItems.secondaryReviewCommunicationTypes[i].meaning!==rcm_doc_review_message_center_dialog_i18n.MSG_CENTER){htmlNMCArray.push("<input class='drmcd-communication-type-option drmcd-padding-between-label-and-input' name='drmcdCommunRadio' type='radio' value='",secondaryReviewItems.secondaryReviewCommunicationTypes[i].value,"'/>");
htmlNMCArray.push("<label class='drmcd-padding-between-label-and-input' for='drmcdCommunRadio'>",secondaryReviewItems.secondaryReviewCommunicationTypes[i].display,"</label><br/>");
}}htmlNMCArray.push("</div>");
htmlNMCArray.push("</div>");
return htmlNMCArray.join("");
}function createFavoritesListTableDiv(list){var groupImageLoc=component.getCriterion().static_content+"\\images\\6460.ico";
var html=[];
html.push("<div class='drmcd-address-book-div-container'>");
html.push("<table id='srmd-favoritesListTable'>");
if(list.length>0){for(var i=0;
i<list.length;
i++){html.push("<tr id='",list[i].entityId,"' class='srmd-favoritesListRow'>");
html.push("<td id='",list[i].entityType,"' class='drmcd-favoriteListColumnOne'>");
if(list[i].entityType===rcm_doc_review_message_center_dialog_i18n.POOL){html.push("<image class='drmcd-favorites-list-pool-image' src='",groupImageLoc,"' alt=''/>");
}html.push("</td>");
html.push("<td class='drmcd-favoriteListColumnTwo'>");
html.push("<span class='drmcd-entityName'>",list[i].entityName,"</span>");
html.push("</td>");
html.push("</tr>");
}}html.push("</table>");
html.push("</div>");
return html.join("");
}function createOkDialogHTML(){var htmlArray=[];
htmlArray.push("<div id='drmcdOkDialog' class='drmcd-error-popup'>");
htmlArray.push("<div class='drmcd-error-popup-title-bar'>");
htmlArray.push("<label id='drmcdOkDialogTitle'></label>");
htmlArray.push("</div>");
htmlArray.push("<div class='drmcd-error-popup-message-area'>");
htmlArray.push("<label id='drmcdOkDialogMessage'></label>");
htmlArray.push("</div>");
htmlArray.push("<div class='drmcd-error-popup-buttons'>");
htmlArray.push("<input id='drmcdDialogOkButton' type='button' value='",rcm_doc_review_message_center_dialog_i18n.OK,"'/>");
htmlArray.push("</div>");
htmlArray.push("</div>");
return htmlArray.join("");
}function openStaleDataErrorDialog(){disableMessageCenterDialog();
$("#drmcdOkDialogTitle").html(rcm_doc_review_message_center_dialog_i18n.STALE_DATA_TITLE);
$("#drmcdOkDialogMessage").html(rcm_doc_review_message_center_dialog_i18n.STALE_DATA_MESSAGE);
$("#drmcdOkDialog").show();
}function openSendFailedDialog(){disableMessageCenterDialog();
$("#drmcdOkDialogTitle").html(rcm_doc_review_message_center_dialog_i18n.SEND_REQUEST_FAILED);
$("#drmcdOkDialogMessage").html(rcm_doc_review_message_center_dialog_i18n.SEND_REQUEST_FAILED_MESSAGE);
$("#drmcdOkDialog").show();
}function disableMessageCenterDialog(){var otherHeight=$("#drmcdPopupTransparentDiv").parent().height()+10;
$("#drmcdPopupTransparentDiv").css("width",650);
$("#drmcdPopupTransparentDiv").css("height",otherHeight);
$("#drmcdPopupTransparentDiv").show();
}function getMousePosition(name,e){var position=$(name).position();
var cursor={x:0,y:0};
cursor.x=position.left;
cursor.y=position.top+$(name).height()+3;
return cursor;
}}
function DocReviewMessageCenterDelegate(){this.getFavoritesList=function(){var sendAr=[];
sendAr.push("^MINE^","0.0","^GET_FAVORITES^","^^");
var favoritesList=[];
var info=new XMLCclRequest();
info.onreadystatechange=function(){if(info.readyState===4&&info.status===200){var jsonEval=JSON.parse(info.responseText);
var recordData=jsonEval.RECORD_DATA;
if(recordData.STATUS_DATA.STATUS==="S"){var i;
for(i=0;
i<recordData.FAVORITELIST.length;
i++){var favoriteList=recordData.FAVORITELIST[i];
favoritesList.push({id:favoriteList.ID,entityType:favoriteList.ENTITYTYPE,entityId:favoriteList.ENTITYID,entityName:favoriteList.ENTITYNAME});
}}else{if(recordData.STATUS_DATA.STATUS==="Z"){favoritesList=[];
}else{var errAr=[];
var statusData=recordData.STATUS_DATA;
var x;
for(x=0,xl=statusData.SUBEVENTSTATUS.length;
x<xl;
x++){var ss=statusData.SUBEVENTSTATUS[x];
errAr.push(ss.OPERATIONNAME,ss.OPERATIONSTATUS,ss.TARGETOBJECTNAME,ss.TARGETOBJECTVALUE);
}}}}};
info.open("GET","RCM_MESSAGE_CENTER",0);
info.send(sendAr.join(","));
return favoritesList;
};
this.getReasonsAndCommunicationTypes=function(){var displayItems={};
var sendAr=[];
sendAr.push("^MINE^","0.0","^GETCLINICALREVIEWREFERENCEDATA^","^{}^");
var info=new XMLCclRequest();
info.onreadystatechange=function(){if(info.readyState===4&&info.status===200){var jsonEval=JSON.parse(info.responseText);
var recordData=jsonEval.RECORD_DATA;
if(recordData.STATUS_DATA.STATUS==="S"){var reasons=[];
for(var i=0;
i<recordData.SECONDARYREVIEWREASONS.length;
i++){reasons.push({display:recordData.SECONDARYREVIEWREASONS[i].DISPLAY,value:recordData.SECONDARYREVIEWREASONS[i].VALUE});
}var communicationTypes=[];
for(var i=0;
i<recordData.SEC_REVIEW_COMM_TYPE_CDS.length;
i++){communicationTypes.push({display:recordData.SEC_REVIEW_COMM_TYPE_CDS[i].DISPLAY,value:recordData.SEC_REVIEW_COMM_TYPE_CDS[i].VALUE,meaning:recordData.SEC_REVIEW_COMM_TYPE_CDS[i].MEANING});
}displayItems={secondaryReviewReasons:reasons,secondaryReviewCommunicationTypes:communicationTypes};
}}};
info.open("GET","RCM_CLINICAL_REVIEW",0);
info.send(sendAr.join(","));
return displayItems;
};
this.validateRecipients=function(request){var receiversArray=[];
for(var i=0;
i<request.receivers.length;
i++){receiversArray.push({entityType:request.receivers[i].entityType,entityId:request.receivers[i].entityId});
}var jsonRequest={validate_receivers_request:{patientId:request.patientId,encounterId:request.encounterId,receivers:receiversArray,check_out_of_office_ind:request.checkOutOfOffice}};
var sendAr=[];
sendAr.push("^MINE^","0.0","^VALIDATE_RECEIVERS^","^",JSON.stringify(jsonRequest),"^");
var checkedRecipients=[];
var info=new XMLCclRequest();
info.onreadystatechange=function(){if(info.readyState===4&&info.status===200){var jsonEval=JSON.parse(info.responseText);
var recordData=jsonEval.RECORD_DATA;
if(recordData.STATUS_DATA.STATUS==="S"){for(var i=0;
i<recordData.RECEIVERS.length;
i++){var receiver=recordData.RECEIVERS[i];
checkedRecipients.push({entityType:receiver.ENTITYTYPE,entityId:receiver.ENTITYID,validFlag:receiver.VALIDFLAG,outOfOfficeInd:receiver.OUTOFOFFICEIND,returnDateTime:receiver.RETURNDATETIME});
}}}};
info.open("GET","RCM_MESSAGE_CENTER",0);
info.send(sendAr.join(","));
return checkedRecipients;
};
this.addQueryMsgCenterRequest=function(jsonString){var sendAr=[];
sendAr.push("^MINE^","0.0","^ADD_DOCREVIEW_FOLLOWUP_MSGCENTER^","^",JSON.stringify(jsonString),"^");
var status=0;
var info=new XMLCclRequest();
info.onreadystatechange=function(){if(info.readyState===4&&info.status===200){var jsonEval=JSON.parse(info.responseText);
var recordData=jsonEval.RECORD_DATA;
if(recordData.STATUS_DATA.STATUS==="F"){var exceptions=recordData.EXCEPTIONINFORMATION;
if(exceptions.length>0){var exception=exceptions[0];
switch(exception.EXCEPTIONTYPE){case"STALE_DATA":status=1;
break;
case"ILLEGAL_ARGUMENT":status=-1;
break;
default:status=-1;
}}}else{if(info.readyState===-4&&info.status!==200){status=-1;
}}}};
info.open("GET","rcm_message_center",0);
info.send(sendAr.join(","));
return status;
};
}
function DocumentationFormComponentStyle(){this.initByNamespace("rcm_documentation_form");
this.setHeaderClass("drf-form-header");
}DocumentationFormComponentStyle.inherits(ComponentStyle);
function DocumentationFormComponent(criterion){this.setCriterion(criterion);
this.setStyles(new DocumentationFormComponentStyle());
this.setAlwaysExpanded(true);
var component=this;
DocumentationFormComponent.method("InsertData",function(reviewId,callbackFunction){var loadExisting=true;
if(reviewId===undefined){loadExisting=false;
}var callback=function(returnData){component.HandleSuccess(returnData);
RCM_DocumentationForm.retrieveListener();
if(callbackFunction){callbackFunction();
}};
var data=RCM_DocumentationFormManager.getData(reviewId,this.criterion.encntr_id,loadExisting,callback);
});
DocumentationFormComponent.method("HandleSuccess",function(returnData){if(returnData&&this.criterion.encntr_id>0){RCM_DocumentationForm.renderForm(this,returnData);
}else{if(this.criterion.encntr_id===0){var html="<span>"+rcm_documentation_form_i18n.INVALID_ENCOUNTER_MESSAGE+"</span>";
MP_Util.Doc.FinalizeComponent(html,component,"");
}else{var html="<span>"+rcm_documentation_form_i18n.UNABLE_TO_LOAD+"</span>";
MP_Util.Doc.FinalizeComponent(html,component,"");
}}});
DocumentationFormComponent.method("addRetrieveListener",function(listener){RCM_DocumentationForm.addRetrieveListener(listener);
});
DocumentationFormComponent.method("addSaveListener",function(listener){RCM_DocumentationForm.addSaveListener(listener);
});
DocumentationFormComponent.method("addDeleteListener",function(listener){RCM_DocumentationForm.addDeleteListener(listener);
});
}DocumentationFormComponent.inherits(MPageComponent);
var RCM_DocumentationForm=function(){var currentFormJSON;
var documentationComponent;
var flexButtonIds;
var referenceData;
var followUpEnabled;
var outcomeEnabled;
var retrieveListeners=[];
var saveListeners=[];
var deleteListeners=[];
var drmcp;
var hasQueryDocumented=false;
return{addRetrieveListener:function(listener){retrieveListeners.push(listener);
},retrieveListener:function(){for(var i=0,length=retrieveListeners.length;
i<length;
i++){retrieveListeners[i]();
}},addSaveListener:function(listener){saveListeners.push(listener);
},saveListner:function(){for(var i=0,length=saveListeners.length;
i<length;
i++){saveListeners[i]();
}},addDeleteListener:function(listener){deleteListeners.push(listener);
},deleteListner:function(){for(var i=0,length=deleteListeners.length;
i<length;
i++){deleteListeners[i]();
}},renderForm:function(component,data){drmcp=new RCMDocReviewMessageCenterPopup(component);
RCM_DocumentationForm.documentationComponent=component;
RCM_DocumentationForm.flexButtonIds=["drfSave"];
RCM_DocumentationForm.referenceData=data.referenceData;
var recordData=data.recordData;
var bannerImagePath=component.getCriterion().static_content+"\\images\\5104_16.png";
var htmlArray=[];
RCM_DocumentationForm.isAdd=false;
if(recordData===null||recordData.reviewId===""){RCM_DocumentationForm.isAdd=true;
}htmlArray.push("<div class='drf-documentation-labels'>");
htmlArray.push("<span>",rcm_documentation_form_i18n.REVIEWED_BY,"</span>");
htmlArray.push("<span class='drf-padding-left' id='drfUserName'></span>");
htmlArray.push("</div>");
htmlArray.push("<form name='documentationForm' class='drf-form'>");
htmlArray.push("<div id='drfQueryRequestSectionAddedBanner' class='drf-no-show drf-request-sent-section-banner'><img src='",bannerImagePath,"' alt='' class='drf-request-sent-section-banner-image'/><span id='crvfSecondarySectionAddedBannerContent'></span></div>");
htmlArray.push("<div id='drfReviewTypeDateDiv' class='drf-clear-divs drf-padding-topRight'>");
htmlArray.push("<div class='drf-float-left'>");
htmlArray.push(RCM_DocumentationForm.createDropDownHTML("drfReviewType",rcm_documentation_form_i18n.REVIEW_TYPE,(RCM_DocumentationForm.referenceData)?RCM_DocumentationForm.referenceData.reviewTypes:null));
htmlArray.push("</div>");
htmlArray.push("<div class='drf-float-left' style='padding-left: 1em;'>");
htmlArray.push("<label for='drfReviewDate'>",rcm_documentation_form_i18n.REVIEW_DATE,"</label>");
htmlArray.push("<div class='drf-clear-divs'>");
htmlArray.push("<input id='drfReviewDate' class='drf-date-input' type='text' name='drfReviewDate' maxlength='10' />");
htmlArray.push("</div>");
htmlArray.push("</div>");
htmlArray.push("</div>");
htmlArray.push("<div class='drf-clear-divs drf-padding-topRight'>");
htmlArray.push("<label for='drfReviewFindings'>",rcm_documentation_form_i18n.REVIEW_FINDINGS,"</label>");
htmlArray.push("<div class='drf-clear-divs'>");
htmlArray.push("<textarea id='drfReviewFindings' class='drf-comments-text'></textarea>");
htmlArray.push("</div>");
htmlArray.push("</div>");
if(RCM_DocumentationForm.referenceData.canAdd===true){htmlArray.push("<div class='drf-clear-divs drf-padding-topRight'>");
htmlArray.push("<input class='drf-float-left' type='button' id='drfSendQuery' name='drfSendQuery' value='",rcm_documentation_form_i18n.SEND_QUERY,"' />");
htmlArray.push("</div>");
}htmlArray.push("<div id='drfFollowUpHiddenDiv' class='drf-clear-divs drf-padding-topRight drf-no-show'>");
htmlArray.push("<dl class='drf-summary-labels'>");
htmlArray.push("<div>");
htmlArray.push("<dt>",rcm_documentation_form_i18n.COMMUNICATION_TYPE,":</dt>");
htmlArray.push("<dd id='drfCommunicationType'></dd>");
htmlArray.push("</div>");
htmlArray.push("<div>");
htmlArray.push("<dt>",rcm_documentation_form_i18n.REVIEWER,":</dt>");
htmlArray.push("<dd id='drfPhysician'></dd>");
htmlArray.push("</div>");
htmlArray.push("<div>");
htmlArray.push("<dt>",rcm_documentation_form_i18n.EXPECTED_RESPONSE,":</dt>");
htmlArray.push("<dd id='drfExpectedResponse'></dd>");
htmlArray.push("</div>");
htmlArray.push("<div id='drfOutcomeLabelDiv'>");
htmlArray.push("<dt>",rcm_documentation_form_i18n.OUTCOME,":</dt>");
htmlArray.push("<dd id='drfOutcomeLabel'></dd>");
htmlArray.push("</div>");
htmlArray.push("<div id='drfActualResponseLabelDiv'>");
htmlArray.push("<dt>",rcm_documentation_form_i18n.ACTUAL_RESPONSE,":</dt>");
htmlArray.push("<dd id='drfActualResponseLabel'></dd>");
htmlArray.push("</div>");
htmlArray.push("</dl>");
htmlArray.push("<div id='drfOutcomeComboDiv' class='drf-clear-divs'>");
htmlArray.push("<div class='drf-float-left drf-outcome-dropdown-padding'>");
htmlArray.push(RCM_DocumentationForm.createDropDownHTML("drfOutcome",rcm_documentation_form_i18n.OUTCOME,(RCM_DocumentationForm.referenceData)?RCM_DocumentationForm.referenceData.outcomes:null));
htmlArray.push("</div>");
htmlArray.push("</div>");
htmlArray.push("<div id='drfActualResponseDateDiv' class='drf-float-left drf-actual-response-date-padding'>");
htmlArray.push("<label for='drfActualResponse'>",rcm_documentation_form_i18n.ACTUAL_RESPONSE,"</label>");
htmlArray.push("<div class='drf-clear-divs'>");
htmlArray.push("<input id='drfActualResponse' type='text' name='drfActualResponse' maxlength='10' />");
htmlArray.push("</div>");
htmlArray.push("</div>");
htmlArray.push("<div class='drf-clear-divs drf-padding-topRight'>");
htmlArray.push("<label for='drfOutcomeComments'>",rcm_documentation_form_i18n.OUTCOME_COMMENTS,"</label>");
htmlArray.push("<div class='drf-clear-divs'>");
htmlArray.push("<textarea id='drfOutcomeComments' class='drf-comments-text'></textarea>");
htmlArray.push("</div>");
htmlArray.push("</div>");
htmlArray.push("</div>");
if(RCM_DocumentationForm.referenceData.canAdd===true){htmlArray.push("<div id='drfButtonsContent'>");
htmlArray.push("<input type='button' id='drfCancel' class='drf-action-button' value='"+rcm_documentation_form_i18n.CANCEL+"' />");
htmlArray.push("<input type='button' id='drfSave' class='drf-action-button' value='"+rcm_documentation_form_i18n.SAVE+"' />");
htmlArray.push("<input type='button' id='drfModify' class='drf-action-button' value='"+rcm_documentation_form_i18n.MODIFY+"' />");
htmlArray.push("</div>");
htmlArray.push("<div class='drf-clear-divs'></div>");
}htmlArray.push("</form>");
htmlArray.push(RCM_DocumentationForm.getYesNoDialogHTML());
htmlArray.push(RCM_DocumentationForm.getOkDialogHTML());
var sHTML=htmlArray.join("");
MP_Util.Doc.FinalizeComponent(sHTML,RCM_DocumentationForm.documentationComponent,"");
RCM_DocumentationForm.addTransparentWindowSizedDiv();
RCM_DocumentationForm.reviewDatePicker=RCM_Clinical_Util.addDatePicker(component,"drfReviewDate");
if(RCM_DocumentationForm.referenceData.regDate&&RCM_DocumentationForm.referenceData.regDate!=""){var tempDate=new Date();
tempDate.setISO8601(RCM_DocumentationForm.referenceData.regDate);
RCM_DocumentationForm.reviewDatePicker.setMinDate(tempDate);
}$("#drfSendQuery").hide();
$("#drfModify").hide();
RCM_DocumentationForm.actualResponseDatePicker=RCM_Clinical_Util.addDatePicker(component,"drfActualResponse");
var menuItems=[];
if(RCM_DocumentationForm.referenceData.canDelete&&!RCM_DocumentationForm.isAdd){menuItems.push(RCM_DropDownMenu.createMenuItem(rcm_documentation_form_i18n.DELETE_REVIEW,function(){if(RCM_DropDownMenu.isMenuItemEnabled("drfDropDownMenu","deleteReview")){RCM_DocumentationForm.openDeleteDialog();
}},"deleteReview"));
var menuOptions=RCM_DropDownMenu.createMenuOptions();
RCM_DropDownMenu.addDropDownMenu(component,"drfDropDownMenu",menuItems,menuOptions);
}else{RCM_DropDownMenu.removeDropDownMenu("drfDropDownMenu");
}RCM_DocumentationForm.resetForm();
RCM_DocumentationForm.enableReviewFields(true);
if(data.status==="STALE_DATA"){RCM_DocumentationForm.openDeletedReviewDialog();
}else{if(recordData&&data.status==="SUCCESS"){RCM_DocumentationForm.currentFormJSON=recordData;
RCM_DocumentationForm.populateForm();
}else{if(data.status==="FAIL"){}}}if(RCM_DocumentationForm.referenceData.canAdd===true){$("#drfSendQuery").click(function(){RCM_DocumentationForm.openSendRequestDialog(recordData);
});
}$("#drfOutcome").change(function(){var value=$("#drfOutcome").val();
var meaning=RCM_DocumentationForm.getOutcomeMeaning(value);
if(value!==null&&value!==""&&value!==0&&value!=="0"&&meaning!=="NO_RESPONSE"){RCM_DocumentationForm.enableOutcomeFields(true);
RCM_DocumentationForm.outcomeEnabled=true;
}else{RCM_DocumentationForm.enableOutcomeFields(false);
RCM_DocumentationForm.outcomeEnabled=false;
}});
$("#drfSave").click(function(){RCM_DocumentationForm.saveForm();
});
$("#drfModify").click(function(){RCM_DocumentationForm.putFormInModifyMode();
});
$("#drfCancel").click(function(){RCM_DocumentationForm.openCancelDialog();
});
$("#drfBtnNo").click(function(){document.getElementById("drfYesNoDialog").style.display="none";
RCM_DocumentationForm.enableReviewFields(true);
RCM_DocumentationForm.enableFollowUpFields(RCM_DocumentationForm.followUpEnabled);
RCM_DocumentationForm.enableOutcomeFields(RCM_DocumentationForm.outcomeEnabled);
});
$("#drfBtnOk").click(function(){document.getElementById("drfOkDialog").style.display="none";
RCM_DocumentationForm.enableReviewFields(true);
RCM_DocumentationForm.enableFollowUpFields(RCM_DocumentationForm.followUpEnabled);
RCM_DocumentationForm.enableOutcomeFields(RCM_DocumentationForm.outcomeEnabled);
});
$("#drfReviewFindings").keyup(function(){var len=this.value.length;
if(len>10000){this.value=this.value.substring(0,10000);
}});
$("#drfOutcomeComments").keyup(function(){var len=this.value.length;
if(len>10000){this.value=this.value.substring(0,10000);
}});
RCM_Clinical_Util.performRequiredFieldChecks(documentationForm);
},getOutcomeMeaning:function(itemValue){if(RCM_DocumentationForm.referenceData.outcomes){var outcomes=RCM_DocumentationForm.referenceData.outcomes;
for(var item=0,length=outcomes.length;
item<length;
item++){if(outcomes[item].VALUE===itemValue){return outcomes[item].MEANING;
}}}},getOutcomeDisplay:function(itemValue){if(RCM_DocumentationForm.referenceData.outcomes){var outcomes=RCM_DocumentationForm.referenceData.outcomes;
for(var item=0,length=outcomes.length;
item<length;
item++){if(outcomes[item].VALUE===itemValue){return outcomes[item].DISPLAY;
}}}},getCommunicationTypeDisplay:function(itemValue){if(RCM_DocumentationForm.referenceData.communicationTypes){var communicationTypes=RCM_DocumentationForm.referenceData.communicationTypes;
for(var item=0,length=communicationTypes.length;
item<length;
item++){if(communicationTypes[item].VALUE===itemValue){return communicationTypes[item].DISPLAY;
}}}},putFormInModifyMode:function(){RCM_DocumentationForm.enableReviewFields(true);
RCM_DocumentationForm.enableFollowUpFields(true);
RCM_DocumentationForm.enableOutcomeFields(true);
if($("#drfFollowUpHiddenDiv").is(":visible")){$("#drfOutcomeLabelDiv").hide();
$("#drfActualResponseLabelDiv").hide();
$("#drfOutcomeComboDiv").show();
$("#drfActualResponseDateDiv").show();
}else{$("#drfSendQuery").hide();
}$("#drfSave").show();
$("#drfModify").hide();
},putFormInReadonlyMode:function(){RCM_DocumentationForm.enableReviewFields(false);
RCM_DocumentationForm.enableFollowUpFields(false);
RCM_DocumentationForm.enableOutcomeFields(false);
if($("#drfFollowUpHiddenDiv").is(":visible")){$("#drfOutcomeLabelDiv").show();
$("#drfActualResponseLabelDiv").show();
$("#drfOutcomeComboDiv").hide();
$("#drfActualResponseDateDiv").hide();
}$("#drfSave").hide();
$("#drfModify").show();
},saveForm:function(queryInfo){var formData={};
hasQueryDocumented=false;
document.getElementById("drfSave").disabled=true;
var documentationComponent=this.documentationComponent;
if(documentationComponent){formData.encounterId=String(RCM_DocumentationForm.documentationComponent.criterion.encntr_id);
}if(queryInfo){formData.communicationTypeCd=queryInfo.communicationTypeCd;
formData.prsnlId=queryInfo.prsnlId;
formData.prsnlName=queryInfo.prsnlName;
formData.expectedResponseDate=queryInfo.expectedResponseDate;
hasQueryDocumented=true;
}else{var physicianId;
var physicianName;
var expectDate;
if($("#drfFollowUpHiddenDiv").is(":visible")){if(RCM_DocumentationForm.currentFormJSON.msgCenterRecipients&&RCM_DocumentationForm.currentFormJSON.msgCenterRecipients.length>0){physicianId="0.0";
physicianName="";
}else{physicianId=RCM_DocumentationForm.currentFormJSON.prsnlId;
physicianName=RCM_DocumentationForm.currentFormJSON.prsnlName;
}if(RCM_DocumentationForm.currentFormJSON.expectedResponseDate){var formattedDate=RCM_Clinical_Util.formatJsonDateAndTimeString(RCM_DocumentationForm.currentFormJSON.expectedResponseDate);
expectDate=new Date(formattedDate);
expectDate=expectDate.format("dd-mmm-yyyy HH:MM:ss");
}else{expectDate="";
}}formData.communicationTypeCd=$("#drfFollowUpHiddenDiv").is(":visible")?RCM_DocumentationForm.currentFormJSON.communicationTypeCd:"";
formData.prsnlId=$("#drfFollowUpHiddenDiv").is(":visible")?physicianId:"";
formData.prsnlName=$("#drfFollowUpHiddenDiv").is(":visible")?physicianName:"";
formData.expectedResponseDate=$("#drfFollowUpHiddenDiv").is(":visible")?expectDate:"";
hasQueryDocumented=false;
}formData.reviewTypeCd=$("#drfReviewType").val();
formData.reviewDate=$("#drfReviewDate").datepicker("getDate");
formData.reviewComment=$("#drfReviewFindings").val();
formData.actualResponseDate=$("#drfActualResponse").datepicker("getDate");
formData.outcomeCd=$("#drfOutcome").val();
formData.outcomeComment=$("#drfOutcomeComments").val();
var callback=function(status,reviewId){switch(status){case"SUCCESS":if(hasQueryDocumented){documentationComponent.InsertData(reviewId,function(){RCM_DocumentationForm.showQueryAddedBanner(false);
});
}else{documentationComponent.InsertData(reviewId);
}RCM_DocumentationForm.saveListner();
$("#drfReviewType").focus();
break;
case"STALE_DATA":RCM_DocumentationForm.openStaleDataDialog();
break;
case"FAIL":RCM_DocumentationForm.openSaveFailedDialog();
break;
case"INVALID_DOCREVIEW_DATE":RCM_DocumentationForm.openInvalidDocReviewDateDialog();
break;
}};
if(RCM_DocumentationForm.currentFormJSON&&RCM_DocumentationForm.currentFormJSON.reviewId>0){formData.reviewId=RCM_DocumentationForm.currentFormJSON.reviewId;
formData.rcmReviewId=RCM_DocumentationForm.currentFormJSON.rcmReviewId;
formData.updateCount=RCM_DocumentationForm.currentFormJSON.updateCount;
formData.followUpId=RCM_DocumentationForm.currentFormJSON.followUpId;
formData.followUpUpdtCount=RCM_DocumentationForm.currentFormJSON.followUpUpdtCount;
formData.docReviewFollowupId=RCM_DocumentationForm.currentFormJSON.docReviewFollowupId;
RCM_DocumentationFormManager.modifyDocumentReview(formData,callback);
}else{RCM_DocumentationFormManager.addDocumentReview(formData,callback);
}},cancelForm:function(){if(RCM_DocumentationForm.isAdd){RCM_DocumentationForm.resetForm();
}else{document.documentationForm.reset();
RCM_DocumentationForm.populateForm();
}},deleteForm:function(){var formData={};
formData.reviewId=RCM_DocumentationForm.currentFormJSON.reviewId;
formData.rcmReviewId=RCM_DocumentationForm.currentFormJSON.rcmReviewId;
formData.updateCnt=RCM_DocumentationForm.currentFormJSON.updateCount;
var callback=function(status){switch(status){case"SUCCESS":RCM_DocumentationForm.deleteListner();
RCM_DocumentationForm.resetForm();
RCM_DocumentationForm.currentFormJSON=null;
RCM_DocumentationForm.documentationComponent.InsertData(0);
break;
case"STALE_DATA":RCM_DocumentationForm.openStaleDataDialog();
break;
case"FAIL":RCM_DocumentationForm.openDeleteFailedDialog();
break;
}};
RCM_DocumentationFormManager.deleteDocumentReview(formData,callback);
},resetForm:function(){document.documentationForm.reset();
RCM_DocumentationForm.currentFormJSON=null;
RCM_DocumentationForm.enableReviewFields(true);
RCM_DocumentationForm.enableFollowUpFields(false);
RCM_DocumentationForm.followUpEnabled=false;
RCM_DocumentationForm.enableOutcomeFields(false);
RCM_DocumentationForm.outcomeEnabled=false;
$("#drfUserName").text(RCM_DocumentationForm.referenceData.userName);
$("#drfReviewType").focus();
RCM_Clinical_Util.setDate("drfReviewDate",new Date());
RCM_Clinical_Util.performRequiredFieldChecks(documentationForm);
},populateForm:function(){var documentationForm=document.documentationForm;
RCM_DocumentationForm.enableReviewFields(true);
if(RCM_DocumentationForm.isAdd===true){$("#drfUserName").text(RCM_DocumentationForm.referenceData.userName);
}else{var dateString=RCM_Clinical_Util.formatJsonDateAndTimeString(RCM_DocumentationForm.currentFormJSON.saveDate);
var nameString=RCM_DocumentationForm.currentFormJSON.saveUser+" "+dateString;
$("#drfUserName").text(nameString);
}if(RCM_DocumentationForm.currentFormJSON.reviewTypeCd){documentationForm.drfReviewType.value=RCM_DocumentationForm.currentFormJSON.reviewTypeCd;
}if(RCM_DocumentationForm.currentFormJSON.reviewDate){RCM_Clinical_Util.setDateString("drfReviewDate",RCM_DocumentationForm.currentFormJSON.reviewDate);
}if(RCM_DocumentationForm.currentFormJSON.reviewComment){$("#drfReviewFindings").val(RCM_DocumentationForm.currentFormJSON.reviewComment);
}if(RCM_DocumentationForm.currentFormJSON.followUpId&&RCM_DocumentationForm.currentFormJSON.followUpId>0){$("#drfFollowUpHiddenDiv").show();
$("#drfSendQuery").hide();
if(RCM_DocumentationForm.currentFormJSON.communicationTypeCd){$("#drfCommunicationType").html(RCM_DocumentationForm.getCommunicationTypeDisplay(RCM_DocumentationForm.currentFormJSON.communicationTypeCd));
}if(RCM_DocumentationForm.currentFormJSON.prsnlId){$("#drfPhysician").html(RCM_DocumentationForm.currentFormJSON.prsnlName);
}if(RCM_DocumentationForm.currentFormJSON.msgCenterRecipients.length>0){$("#drfPhysician").html(RCM_DocumentationForm.currentFormJSON.msgCenterRecipients[0].entityName);
}if(RCM_DocumentationForm.currentFormJSON.expectedResponseDate){$("#drfExpectedResponse").html(RCM_Clinical_Util.formatJsonDateString(RCM_DocumentationForm.currentFormJSON.expectedResponseDate));
}if(RCM_DocumentationForm.currentFormJSON.outcomeCd){RCM_DocumentationForm.followUpEnabled=true;
RCM_DocumentationForm.enableFollowUpFields(true);
var outcomeCd=RCM_DocumentationForm.currentFormJSON.outcomeCd;
if(Number(RCM_DocumentationForm.currentFormJSON.outcomeCd)===0){documentationForm.drfOutcome.value=String(Math.abs(outcomeCd));
}else{documentationForm.drfOutcome.value=outcomeCd;
}var meaning=RCM_DocumentationForm.getOutcomeMeaning(outcomeCd);
if(meaning&&meaning!=="NO_RESPONSE"){RCM_DocumentationForm.outcomeEnabled=true;
RCM_DocumentationForm.enableOutcomeFields(true);
$("#drfOutcomeLabel").html(RCM_DocumentationForm.getOutcomeDisplay(outcomeCd));
}else{RCM_DocumentationForm.outcomeEnabled=false;
}}if(RCM_DocumentationForm.currentFormJSON.actualResponseDate){RCM_Clinical_Util.setDateString("drfActualResponse",RCM_DocumentationForm.currentFormJSON.actualResponseDate);
$("#drfActualResponseLabel").html(RCM_Clinical_Util.formatJsonDateString(RCM_DocumentationForm.currentFormJSON.actualResponseDate));
}if(RCM_DocumentationForm.currentFormJSON.outcomeComment){$("#drfOutcomeComments").val(RCM_DocumentationForm.currentFormJSON.outcomeComment);
}}else{$("#drfFollowUpHiddenDiv").hide();
$("#drfSendQuery").show();
}if(RCM_DocumentationForm.isAdd){RCM_DocumentationForm.putFormInModifyMode();
RCM_Clinical_Util.performRequiredFieldChecks(documentationForm);
}else{RCM_DocumentationForm.putFormInReadonlyMode();
}},enableReviewFields:function(enable){RCM_Clinical_Util.removeRequiredField(document.documentationForm,"drfReviewType","select",RCM_DocumentationForm.flexButtonIds);
RCM_Clinical_Util.removeRequiredField(document.documentationForm,"drfReviewDate","date",RCM_DocumentationForm.flexButtonIds);
if(enable){RCM_Clinical_Util.addRequiredField(document.documentationForm,"drfReviewType","select",RCM_DocumentationForm.flexButtonIds);
RCM_Clinical_Util.addRequiredField(document.documentationForm,"drfReviewDate","date",RCM_DocumentationForm.flexButtonIds);
}var enableMenu=false;
if(RCM_DocumentationForm.currentFormJSON){enableMenu=true;
}$("#drfReviewType").attr("disabled",!enable);
$("#drfReviewDate").datepicker(enable?"enable":"disable");
if(!enable){$("#drfReviewFindings").attr("readonly","readonly");
}else{$("#drfReviewFindings").removeAttr("readonly");
}},enableFollowUpFields:function(enable){if(enable){RCM_DocumentationForm.enableOutcomeFields(true);
}else{RCM_DocumentationForm.enableOutcomeFields(false);
}$("#drfOutcome").attr("disabled",!enable);
if(!enable){$("#drfOutcomeComments").attr("readonly","readonly");
}else{$("#drfOutcomeComments").removeAttr("readonly");
}},enableOutcomeFields:function(enable){if(enable){if(Number(RCM_DocumentationForm.currentFormJSON.outcomeCd)!==0||documentationForm.drfOutcome.value!=="0"){RCM_Clinical_Util.addRequiredField(document.documentationForm,"drfActualResponse","date",RCM_DocumentationForm.flexButtonIds);
}}else{RCM_Clinical_Util.removeRequiredField(document.documentationForm,"drfActualResponse","date",RCM_DocumentationForm.flexButtonIds);
}$("#drfActualResponse").datepicker(enable?"enable":"disable");
},createDropDownHTML:function(name,label,items){var htmlArray=[];
var id=name;
htmlArray.push("<div class='drf-control-container'>");
htmlArray.push("<label class='drf-control-label' for='",id,"'>",label,"</label>");
htmlArray.push("<select class='drf-drop-down' id='",id,"' name='",name,"'>");
htmlArray.push(this.createOptionsHTML(items));
htmlArray.push("</select>");
htmlArray.push("</div>");
return htmlArray.join("");
},createOptionsHTML:function(items){var htmlArray=[];
htmlArray.push("<option value='0'></option>");
if(items){var i;
var length=items.length;
for(i=0;
i<length;
i++){var item=items[i];
htmlArray.push("<option value='",item.VALUE,"'>",item.DISPLAY,"</option>");
}}return htmlArray.join("");
},getYesNoDialogHTML:function(){var htmlArray=[];
htmlArray.push("<div id='drfYesNoDialog' class='drf-dialog'>");
htmlArray.push("<div class='drf-dialog-title-bar'>");
htmlArray.push("<label id='drfYesNoDialogTitle'></label>","</div>");
htmlArray.push("<div class='drf-dialog-message-area'>");
htmlArray.push("<label id='drfYesNoDialogMessage'></label>");
htmlArray.push("</div>");
htmlArray.push("<div class='drf-dialog-buttons'>");
htmlArray.push("<input id='drfBtnNo' type='button' value='",rcm_documentation_form_i18n.NO,"' />");
htmlArray.push("<input id='drfBtnYes' type='button' value='",rcm_documentation_form_i18n.YES,"' />");
htmlArray.push("</div></div>");
return htmlArray.join("");
},getOkDialogHTML:function(){var htmlArray=[];
htmlArray.push("<div id='drfOkDialog' class='adf-dialog'>");
htmlArray.push("<div class='drf-dialog-title-bar'>");
htmlArray.push("<label id='drfOkDialogTitle'></label>","</div>");
htmlArray.push("<div class='drf-dialog-message-area'>");
htmlArray.push("<label id='drfOkDialogMessage'></label>");
htmlArray.push("</div>");
htmlArray.push("<div class='drf-dialog-buttons'>");
htmlArray.push("<input id='drfBtnOk' type='button' value='",rcm_documentation_form_i18n.OK,"' />");
htmlArray.push("</div></div>");
return htmlArray.join("");
},openCancelDialog:function(){$("#drfYesNoDialogTitle").html(rcm_documentation_form_i18n.CANCEL);
$("#drfYesNoDialogMessage").html(rcm_documentation_form_i18n.CANCEL_MESSAGE);
document.getElementById("drfYesNoDialog").style.display="block";
RCM_DocumentationForm.enableReviewFields(false);
RCM_DocumentationForm.enableFollowUpFields(false);
RCM_DocumentationForm.enableOutcomeFields(false);
$("#drfBtnYes").unbind("click").click(function(){RCM_DocumentationForm.cancelForm();
document.getElementById("drfYesNoDialog").style.display="none";
});
},openStaleDataDialog:function(){focusField=null;
$("#drfOkDialogTitle").html(rcm_documentation_form_i18n.STALE_DATA_TITLE);
$("#drfOkDialogMessage").html(rcm_documentation_form_i18n.STALE_DATA_MESSAGE);
RCM_DocumentationForm.enableReviewFields(false);
RCM_DocumentationForm.enableFollowUpFields(false);
RCM_DocumentationForm.enableOutcomeFields(false);
document.getElementById("drfOkDialog").style.display="block";
},openDeletedReviewDialog:function(){focusField=null;
$("#drfOkDialogTitle").html(rcm_documentation_form_i18n.REVIEW_DELETED_TITLE);
$("#drfOkDialogMessage").html(rcm_documentation_form_i18n.REVIEW_DELETED_MESSAGE);
RCM_DocumentationForm.enableReviewFields(false);
RCM_DocumentationForm.enableFollowUpFields(false);
RCM_DocumentationForm.enableOutcomeFields(false);
document.getElementById("drfOkDialog").style.display="block";
},openSaveFailedDialog:function(errorStatus){focusField=null;
$("#drfOkDialogTitle").html(rcm_documentation_form_i18n.SAVE_FAILED_TITLE);
$("#drfOkDialogMessage").html(rcm_documentation_form_i18n.SAVE_FAILED_MESSAGE);
RCM_DocumentationForm.enableReviewFields(false);
RCM_DocumentationForm.enableFollowUpFields(false);
RCM_DocumentationForm.enableOutcomeFields(false);
document.getElementById("drfOkDialog").style.display="block";
},openInvalidDocReviewDateDialog:function(errorStatus){focusField=null;
$("#drfOkDialogTitle").html(rcm_documentation_form_i18n.INVALID_DOC_REVIEW_DATE_TITLE);
$("#drfOkDialogMessage").html(rcm_documentation_form_i18n.INVALID_DOCREVIEW_DATE_FAILED_MESSAGE);
RCM_DocumentationForm.enableReviewFields(false);
RCM_DocumentationForm.enableFollowUpFields(false);
RCM_DocumentationForm.enableOutcomeFields(false);
document.getElementById("drfOkDialog").style.display="block";
},openDeleteDialog:function(){$("#drfYesNoDialogTitle").html(rcm_documentation_form_i18n.DELETE_TITLE);
$("#drfYesNoDialogMessage").html(rcm_documentation_form_i18n.DELETE_MESSAGE);
document.getElementById("drfYesNoDialog").style.display="block";
RCM_DocumentationForm.enableReviewFields(false);
RCM_DocumentationForm.enableFollowUpFields(false);
RCM_DocumentationForm.enableOutcomeFields(false);
$("#drfBtnYes").unbind("click").click(function(){RCM_DocumentationForm.deleteForm();
document.getElementById("drfYesNoDialog").style.display="none";
});
$("#drfBtnNo").unbind("click").click(function(){document.getElementById("drfYesNoDialog").style.display="none";
RCM_DocumentationForm.putFormInReadonlyMode();
});
},showQueryAddedBanner:function(isMessageCenter){if(isMessageCenter){$("#crvfSecondarySectionAddedBannerContent").html(rcm_documentation_form_i18n.BANNER_MESSAGE_CENTER);
}else{$("#crvfSecondarySectionAddedBannerContent").html(rcm_documentation_form_i18n.BANNER_NON_MESSAGE_CENTER);
}$("#drfQueryRequestSectionAddedBanner").show();
},openSendRequestDialog:function(recordData){drmcp.getHTML(recordData);
document.getElementById("drmcd-transparentDiv").style.display="block";
document.getElementById("drmcd-MessageCenterDialog").style.display="block";
$("#drmcdRecipientSearch").click();
$("#drmcdRecipientSearch").focus();
},addTransparentWindowSizedDiv:function(){var otherWidth=$(".col-outer2").width();
var otherHeight=$(".col-outer2").height()+80;
$(".col-outer2").append("<div id='drmcd-MessageCenterDialog' class='drmcd-message-center-dialog'></div>");
$(".col-outer2").append("<div id='drmcd-transparentDiv' class='drmcd-message-center-transparent-dialog'></div>");
$(".col-outer2").removeClass("drmcd-overflow");
$("#drmcd-transparentDiv").css("width",otherWidth);
$("#drmcd-transparentDiv").css("height",otherHeight);
$(window).resize(function(){$(".col-outer2").removeClass("drmcd-overflow-x");
$(".col-outer2").removeClass("drmcd-overflow-y");
var otherWidth;
var otherHeight;
if($("#drmcd-MessageCenterDialog").is(":visible")){if($(window).width()<700){if($(window).height()<765){if(!($(".col-outer2").hasClass("drmcd-overflow"))){$(".col-outer2").removeClass("drmcd-overflow-x");
$(".col-outer2").addClass("drmcd-overflow");
}}else{if(!($(".col-outer2").hasClass("drmcd-overflow-x"))){$(".col-outer2").removeClass("drmcd-overflow");
$(".col-outer2").addClass("drmcd-overflow-x");
}}otherHeight=$(".col-outer2").height()+51;
}else{$(".col-outer2").removeClass("drmcd-overflow-x");
otherHeight=$(".col-outer2").height()+80;
}if($(window).height()<765){if($(window).width()<700){if(!($(".col-outer2").hasClass("drmcd-overflow"))){$(".col-outer2").removeClass("drmcd-overflow-y");
$(".col-outer2").addClass("drmcd-overflow");
}}else{if(!($(".col-outer2").hasClass("drmcd-overflow-y"))){$(".col-outer2").removeClass("drmcd-overflow");
$(".col-outer2").addClass("drmcd-overflow-y");
}}otherWidth=$(".col-outer2").width()-18;
}else{$(".col-outer2").removeClass("drmcd-overflow-y");
otherWidth=$(".col-outer2").width();
}}else{otherWidth=$(".col-outer2").width();
otherHeight=$(".col-outer2").height()+80;
}$("#drmcd-transparentDiv").css("width",otherWidth);
$("#drmcd-transparentDiv").css("height",otherHeight);
});
}};
}();

var RCM_DocumentationFormManager=function(){return{getData:function(reviewId,encntrId,loadExisting,caller){var getRefCallBack=function(status,recordData){if("S"===status){var data={};
data.referenceData=null;
data.recordData=null;
data.status=null;
var returnReferenceData={reviewTypes:recordData.REVIEWTYPE,communicationTypes:recordData.COMMUNICATIONTYPE,outcomes:recordData.REVIEWOUTCOME,canDelete:recordData.CANDELETEIND===1,canAdd:recordData.CANADDIND===1,userName:recordData.USERNAME,regDate:recordData.REGDATE};
data.referenceData=returnReferenceData;
if(loadExisting){var modifyCallBack=function(status,returnRecord){if(status==="S"){var subEvent=returnRecord.STATUS_DATA.SUBEVENTSTATUS;
if(subEvent[0].OPERATIONSTATUS==="Z"&&reviewId>0){data.status="STALE_DATA";
}else{data.status="SUCCESS";
}}else{data.status="FAIL";
}if(data.status==="SUCCESS"){var followUps=returnRecord.DOCUMENTREVIEWFOLLOWUPS;
if(followUps&&followUps.length===1){var followUp=followUps[0];
}var msgCenterRecipients=[];
if(followUp&&followUp.FOLLOWUP_MSG_CENTER){var recipientLength=followUp.FOLLOWUP_MSG_CENTER.RECIPIENTS.length;
if(recipientLength>0){for(var i=0;
i<recipientLength;
i++){var recipient=followUp.FOLLOWUP_MSG_CENTER.RECIPIENTS[i];
msgCenterRecipients.push({entityType:recipient.ENTITYTYPE,entityName:recipient.ENTITYNAME,entityId:recipient.ENTITYID});
}}}var returnData={reviewId:returnRecord.DOCREVIEWID,rcmReviewId:returnRecord.RCMROCREVIEWID,encounterId:returnRecord.ENCNTRID,reviewTypeCd:returnRecord.DOCREVIEWTYPECD,reviewDate:returnRecord.DOCREVIEWDATE,reviewComment:RCM_Clinical_Util.decodeString(returnRecord.DOCREVIEWCOMMENT),updateCount:returnRecord.UPDTCNT,saveDate:returnRecord.SAVEDATE,saveUser:returnRecord.SAVEUSER,followUpId:followUp?followUp.FOLLOWUPID:"",followUpUpdtCount:followUp?followUp.UPDTCNT:0,communicationTypeCd:followUp?followUp.COMMUNICATIONTYPECD:"",prsnlId:followUp?followUp.FOLLOWUPPRSNLID:"",prsnlName:followUp?followUp.FOLLOWUPPRSNLNAME:null,expectedResponseDate:followUp?followUp.EXPECTEDRESPONSEDATE:null,actualResponseDate:followUp?followUp.ACTUALRESPONSEDATE:null,outcomeCd:followUp?followUp.DOCREVIEWOUTCOMECD:0,outcomeComment:RCM_Clinical_Util.decodeString(followUp?followUp.OUTCOMECOMMENT:null),updtCnt:followUp?followUp.UPDTCNT:0,docReviewFollowupId:followUp?followUp.DOC_REVIEW_FOLLOWUP_ID:"",msgCenterSentDateTime:followUp?followUp.FOLLOWUP_MSG_CENTER.SENTDATETIME:"",msgCenterRecipients:msgCenterRecipients};
data.recordData=returnData;
}caller(data);
};
RCM_DocumentationFormManager.getDocumentReviewForModify(reviewId,encntrId,data,modifyCallBack);
}else{caller(data);
}}else{caller(data);
}};
var jsonRequest={getDocumentReviewReferenceDataReq:{encounterId:encntrId?String(encntrId):"0.0"}};
var sendAr=[];
sendAr.push("^MINE^","0.0","^GETDOCUMENTREVIEWREFERENCEDATA^","^"+JSON.stringify(jsonRequest)+"^");
RCM_Clinical_Util.makeCCLRequest("rcm_document_review",sendAr,true,getRefCallBack);
},getDocumentReviewForModify:function(documentReviewId,encntrId,data,callBack){var jsonRequest={getDocumentReviewForModifyReq:{documentReviewId:documentReviewId?String(documentReviewId):"0.0",encntrId:encntrId?String(encntrId):"0.0"}};
var sendAr=[];
sendAr.push("^MINE^","0.0","^GETDOCUMENTREVIEWFORMODIFY^","^"+JSON.stringify(jsonRequest)+"^");
RCM_Clinical_Util.makeCCLRequest("rcm_document_review",sendAr,true,callBack);
},addDocumentReview:function(review,caller){var callback=function(status,recordData){var reviewId=recordData.DOCUMENT_REVIEW_ID;
caller(recordData.STATUS,reviewId);
};
var followUpArray=[];
if(review.communicationTypeCd>0||review.prsnlId>0||review.expectedResponseDate||review.actualResponseDate||review.outcomeCd>0||review.outcomeComment){followUpArray.push({communicationTypeCd:"0.0",followupPrsnlId:"0.0",expectedResponseDate:"",actualResponseDate:"",docReviewOutcomeCd:"0.0",outcomeComment:""});
}var jsonRequest={documentReviewReq:{encntrId:review.encounterId,docReviewTypeCd:review.reviewTypeCd>0?review.reviewTypeCd:"0.0",docReviewDate:review.reviewDate?review.reviewDate.format("dd-mmm-yyyy HH:MM:ss"):"",docReviewStatusCd:"0.0",docReviewComment:review.reviewComment?RCM_Clinical_Util.encodeString(review.reviewComment):"",documentReviewFollowups:followUpArray}};
var sendAr=[];
sendAr.push("^MINE^","0.0","^ADDDOCUMENTREVIEW^","^"+JSON.stringify(jsonRequest)+"^");
RCM_Clinical_Util.makeCCLRequest("rcm_document_review",sendAr,true,callback);
},modifyDocumentReview:function(review,caller){var callback=function(status,recordData){if(status==="F"){var errStatus="";
if(recordData){errStatus=recordData.STATUS;
}RCM_DocumentationForm.openSaveFailedDialog(errStatus);
}else{if(recordData){caller(recordData.STATUS,review.reviewId);
}}};
var followUpArray=[];
if(Number(review.communicationTypeCd)>0||review.expectedResponseDate||review.actualResponseDate||Number(review.outcomeCd)>0||review.outcomeComment){followUpArray.push({rcm_doc_review_followup_id:Number(review.followUpId)>0?review.followUpId:"0.0",communicationTypeCd:Number(review.communicationTypeCd)>0?review.communicationTypeCd:"0.0",followupPrsnlId:Number(review.prsnlId)>0?review.prsnlId:"0.0",followupPrsnlName:"",expectedResponseDate:review.expectedResponseDate?review.expectedResponseDate:"",actualResponseDate:review.actualResponseDate?review.actualResponseDate.format("dd-mmm-yyyy HH:MM:ss"):"",docReviewOutcomeCd:Number(review.outcomeCd)>0?review.outcomeCd:"0.0",outcomeComment:review.outcomeComment?RCM_Clinical_Util.encodeString(review.outcomeComment):"",updtCnt:review.updateCount?review.updateCount:0,doc_review_followup_id:review.docReviewFollowupId?review.docReviewFollowupId:""});
}var jsonRequest={modifyDocumentReviewRequest:{docReviewId:review.reviewId,rcmRocReviewId:review.rcmReviewId,encntrId:review.encounterId,docReviewTypeCd:review.reviewTypeCd,docReviewDate:review.reviewDate?review.reviewDate.format("dd-mmm-yyyy HH:MM:ss"):"",docReviewComment:review.reviewComment?RCM_Clinical_Util.encodeString(review.reviewComment):"",updtCnt:review.updateCount,documentReviewFollowups:followUpArray}};
var sendAr=[];
sendAr.push("^MINE^","0.0","^MODIFYDOCUMENTREVIEW^","^"+JSON.stringify(jsonRequest)+"^");
RCM_Clinical_Util.makeCCLRequest("rcm_document_review",sendAr,true,callback);
},deleteDocumentReview:function(review,caller){var callback=function(status,recordData){if(status==="F"){RCM_DocumentationForm.openSaveFailedDialog();
}else{if(recordData){caller(recordData.STATUS);
}}};
var jsonRequest={deleteDocumentReviewReq:{documentReviewId:review.reviewId,rcmDocReviewId:review.rcmReviewId,updtCnt:review.updateCnt}};
var sendAr=[];
sendAr.push("^MINE^","0.0","^DELETEDOCUMENTREVIEW^","^"+JSON.stringify(jsonRequest)+"^");
RCM_Clinical_Util.makeCCLRequest("rcm_document_review",sendAr,true,callback);
}};
}();

var CERN_InsuranceInfo=function(){var loc;
var faxImageFile;
return{getToggleArray:function(par,tog){return Util.Style.g(tog,par,"span");
},modifyDialog:null,modifyDialogLabelNameMap:{insDateModify:"authdates0"},GetInsuranceTable:function(component){this.component=component;
var sendAr=[];
var criterion=component.getCriterion();
sendAr.push("^MINE^",criterion.person_id+".0",+criterion.encntr_id+".0");
var ins_delegate=new InsuranceDelegate();
ins_delegate.getData(sendAr,this.component);
},initInsuranceLocHovers:function(node){var tr=Util.Style.g("sub-sec-hd",node,"H3");
for(var i=0,l=tr.length;
i<l;
i++){var m=tr[i];
if(m){var nm=Util.gns(Util.gns(m));
if(nm){if(Util.Style.ccss(nm,"ins-hvr")){hs(m,nm);
}}}}},handleOver:function(insLabel){if(CERN_InsuranceInfo.allowedToModify()){insLabel.style.border="dashed 1px #3797FE";
insLabel.style.cursor="hand";
}},handleOut:function(insLabel){if(CERN_InsuranceInfo.allowedToModify()){insLabel.style.border="";
}},getPosition:function(displayLabel){var position=$(displayLabel).offset();
var cursor={x:0,y:0};
cursor.x=position.left;
cursor.y=position.top+$(displayLabel).height()+3;
return cursor;
},allowedToModify:function(){if(this.RECORDDATA.CANMODIFYIND===1){return true;
}},closeDialog:function(){if(this.modifyDialog){this.modifyDialog.innerHTML="";
this.modifyDialog.style.display="none";
}},cancelDialog:function(){if(this.modifyDialog){this.modifyDialog.innerHTML="";
this.modifyDialog.style.display="none";
}},cancelErrorDialog:function(){document.getElementById("errorDialog").style.display="none";
},changeNumDays:function(){startDayString=document.getElementById("AuthStartDatePicker").value;
endDayString=document.getElementById("AuthEndDatePicker").value;
var startDay=new Date(startDayString);
var endDay=new Date(endDayString);
var oneDay=1000*60*60*24;
var diffInDaysInMillis=endDay.getTime()-startDay.getTime();
var diffInDays=0;
diffInDays=Math.ceil(diffInDaysInMillis/oneDay)+1;
if(document.getElementById("lblNumDays")){if(diffInDays<=0){document.getElementById("lblNumDays").innerHTML=rcm_insurance_info_i18n.RCM_NUMBER_OF_DAYS+" : 0 ";
}else{if(diffInDays===1){document.getElementById("lblNumDays").innerHTML=rcm_insurance_info_i18n.RCM_NUMBER_OF_DAYS+" :  1 ";
}else{if(diffInDays>1){document.getElementById("lblNumDays").innerHTML=rcm_insurance_info_i18n.RCM_NUMBER_OF_DAYS+" : "+diffInDays;
}}}}},openDialog:function(container,fieldName){CERN_InsuranceInfo.closeDialog();
if(this.modifyDialog===null){this.modifyDialog=document.getElementById("ins-modify-dialog");
}var content;
var flexButtonIds=["saveButton"];
var authorization=CERN_InsuranceInfo.getAuthorization(container.id);
if(fieldName==="authDates"){content="<div onMouseOver ='CERN_InsuranceInfo.changeNumDays()' onMouseOut='CERN_InsuranceInfo.changeNumDays()'><div><label>"+rcm_insurance_info_i18n.RCM_START_DATE+"</label></div><div><input type='text' name='AuthStartDatePicker' id='AuthStartDatePicker' value='' /></div><div><label>"+rcm_insurance_info_i18n.RCM_END_DATE+"</label></div><div><input type='text' name='AuthEndDatePicker' id='AuthEndDatePicker' value=''  /></div><div class='ins-modify-dialog-buttons'><span class=''>";
if((authorization.NUMBERAUTHQUALIFIERMEANING==="DAYS")||(CERN_InsuranceInfo.isDays(container.id))){content+="<label id='lblNumDays'>"+rcm_insurance_info_i18n.RCM_NUMBER_OF_DAYS+": 0 </label>";
}content+="<input type='button' onclick='CERN_InsuranceInfo.cancelDialog()' value='"+rcm_insurance_info_i18n.RCM_CANCEL+"'/><input type='button' onclick='CERN_InsuranceInfo.saveDialog(\""+container.id+'", "'+fieldName+"\")' id = 'saveButton' value='"+rcm_insurance_info_i18n.RCM_SAVE+"'/></span></div></div>";
this.modifyDialog.style.height=150+"px";
this.modifyDialog.innerHTML=content;
var formObject={};
RCM_Clinical_Util.addDatePicker(this.component,"AuthStartDatePicker");
RCM_Clinical_Util.addDatePicker(this.component,"AuthEndDatePicker");
RCM_Clinical_Util.addRequiredField(formObject,"AuthStartDatePicker","date",flexButtonIds);
RCM_Clinical_Util.addRequiredField(formObject,"AuthEndDatePicker","date",flexButtonIds);
RCM_Clinical_Util.setDateString("AuthStartDatePicker",authorization.SERVICEBEGINDATETIME);
RCM_Clinical_Util.setDateString("AuthEndDatePicker",authorization.SERVICEENDDATETIME);
$("#AuthStartDatePicker").keydown(function(){CERN_InsuranceInfo.changeNumDays();
});
$("#AuthEndDatePicker").keydown(function(){CERN_InsuranceInfo.changeNumDays();
});
}else{if(fieldName==="authFax"){this.loc=this.component.criterion.static_content;
this.faxImageFile=this.loc+"\\images\\5104_16.png";
if(authorization.CONTACTFAXNUMBER){content="<div><input type='text'  id='faxFieldNum'  value = '"+authorization.CONTACTFAXNUMBER+"'/>";
}else{content="<div><input type='text'  id='faxFieldNum' />";
}content+="<img id='infoImage' class= 'image-info' src='"+this.faxImageFile+"'/></div><div class= 'ins-hvr' id = 'hvrInfo'>"+rcm_insurance_info_i18n.RCM_FAX_INFORMATION+"</div> <div class='ins-modify-dialog-buttons'><span class='ins-modify-dialog-buttons'><input type='button' onclick='CERN_InsuranceInfo.cancelDialog()' value='"+rcm_insurance_info_i18n.RCM_CANCEL+"'/><input type='button' onclick='CERN_InsuranceInfo.saveDialog(\""+container.id+'", "'+fieldName+"\")' id = 'saveButton' value='"+rcm_insurance_info_i18n.RCM_SAVE+"'/></span></div>";
this.modifyDialog.style.height=60+"px";
this.modifyDialog.innerHTML=content;
var formObject={};
RCM_Clinical_Util.hs(infoImage,hvrInfo);
RCM_Clinical_Util.addMaskToTextBox("faxFieldNum","?99999999999999999999");
RCM_Clinical_Util.addRequiredField(formObject,"faxFieldNum","maskedtext",flexButtonIds);
}else{if(fieldName==="authNum"){content="<div><input type='text' name='authNumber' id='authNumber' value=''/></div><div class='ins-modify-dialog-buttons'><span class='ins-modify-dialog-buttons'><input type='button' onclick='CERN_InsuranceInfo.cancelDialog()' value='"+rcm_insurance_info_i18n.RCM_CANCEL+"'/><input type='button' onclick='CERN_InsuranceInfo.saveDialog(\""+container.id+'", "'+fieldName+"\")' id = 'saveButton' value='"+rcm_insurance_info_i18n.RCM_SAVE+"'/></span></div>";
this.modifyDialog.style.height=70+"px";
this.modifyDialog.innerHTML=content;
}else{if(fieldName==="authStatus"){content="<div><select id=authStatusDropDown><option value = '' selected = 'selected'></option>";
for(i=0;
i<this.RECORDDATA.AUTHORIZATIONSTATUSCDS.length;
i++){var savedStatus=authorization.AUTHORIZATIONSTATUSDISP;
var current=this.RECORDDATA.AUTHORIZATIONSTATUSCDS[i];
if(savedStatus===current.DISPLAY){content+="<option value = '"+current.VALUE+"' selected= 'selected'>"+current.DISPLAY+"</option>";
}else{content+="<option value = '"+current.VALUE+"'>"+current.DISPLAY+"</option>";
}}content+="</select></div> <div class='ins-modify-dialog-buttons'><span class='ins-modify-dialog-buttons'><input type='button' onclick='CERN_InsuranceInfo.cancelDialog()' value='"+rcm_insurance_info_i18n.RCM_CANCEL+"'/><input type='button' onclick='CERN_InsuranceInfo.saveDialog(\""+container.id+'", "'+fieldName+"\")' id = 'saveButton' value='"+rcm_insurance_info_i18n.RCM_SAVE+"'/></span></div></div>";
this.modifyDialog.style.height=50+"px";
this.modifyDialog.innerHTML=content;
}}}}var pos=CERN_InsuranceInfo.getPosition(container);
var currentWidth=parseInt(this.modifyDialog.currentStyle.width);
var currentHeight=parseInt(this.modifyDialog.currentStyle.height);
var currentXLoc=parseInt(pos.x);
var currentYLoc=parseInt(pos.y);
var currentBrowserWidth=document.body.offsetWidth;
var currentBrowserHeight=document.documentElement.clientHeight;
var maxHeight=$(document).scrollTop()+document.documentElement.clientHeight-currentHeight;
var screenDifference=(currentWidth+currentXLoc)-currentBrowserWidth;
var heightDifference=(currentHeight+currentYLoc)-currentBrowserHeight;
if(screenDifference>0){pos.x=currentXLoc-screenDifference-20;
}if(pos.y>maxHeight){pos.y=maxHeight-20;
}this.modifyDialog.style.top=pos.y+"px";
this.modifyDialog.style.left=pos.x+"px";
this.modifyDialog.style.display="block";
document.body.appendChild(this.modifyDialog);
var rePositionModifyDialog=function(){this.modifyDialog=document.getElementById("ins-modify-dialog");
if(this.modifyDialog){var position=CERN_InsuranceInfo.getPosition(container);
var modifyDialogHeight=this.modifyDialog.offsetHeight;
var maximumHeight=$(document).scrollTop()+document.documentElement.clientHeight-modifyDialogHeight;
if(position.y<$(document).scrollTop()){position.y=$(document).scrollTop();
}else{if(position.y>maximumHeight){position.y=maximumHeight;
}}var modifyDialogWidth=this.modifyDialog.offsetWidth;
var maximumWidth=document.documentElement.clientWidth-modifyDialogWidth;
if(position.x<0){position.x=0;
}else{if(position.x>maximumWidth){position.x=maximumWidth;
}}this.modifyDialog.style.top=position.y+"px";
this.modifyDialog.style.left=position.x+"px";
}};
var columnOne=$(".col1");
if(columnOne&&columnOne.length===1){columnOne.scroll(rePositionModifyDialog);
columnOne.resize(rePositionModifyDialog);
}var columnTwo=$(".col2");
if(columnTwo&&columnTwo.length===1){columnTwo.scroll(rePositionModifyDialog);
columnTwo.resize(rePositionModifyDialog);
}var columnThree=$(".col3");
if(columnThree&&columnThree.length===1){columnThree.scroll(rePositionModifyDialog);
columnThree.resize(rePositionModifyDialog);
}var screen=$(window);
if(screen&&screen.length===1){screen.scroll(rePositionModifyDialog);
screen.resize(rePositionModifyDialog);
}},getAuthorization:function(id){for(var i=0;
i<this.RECORDDATA.HEALTHPLANRELATIONSHIPS.length;
i++){var healthplan=this.RECORDDATA.HEALTHPLANRELATIONSHIPS[i];
for(var j=0;
j<healthplan.AUTHORIZATIONS.length;
j++){var authorization=healthplan.AUTHORIZATIONS[j];
if(authorization.ID===id){return authorization;
}}}return null;
},getHealthPlanRelationshipId:function(id){for(var i=0;
i<this.RECORDDATA.HEALTHPLANRELATIONSHIPS.length;
i++){var healthplan=this.RECORDDATA.HEALTHPLANRELATIONSHIPS[i];
for(var j=0;
j<healthplan.AUTHORIZATIONS.length;
j++){var authorization=healthplan.AUTHORIZATIONS[j];
if(authorization.ID===id){return healthplan.ID;
}}}return null;
},popDateErrorDialog:function(){document.getElementById("error-title").innerHTML=rcm_insurance_info_i18n.RCM_DATE_RANGE_ERROR;
document.getElementById("errorMessage").innerHTML=rcm_insurance_info_i18n.RCM_BAD_DATE;
document.getElementById("errorDialog").style.display="block";
document.body.appendChild(document.getElementById("errorDialog"));
},popSaveErrorMessage:function(){document.getElementById("error-title").innerHTML=rcm_insurance_info_i18n.RCM_SAVE_ERROR;
document.getElementById("errorMessage").innerHTML=rcm_insurance_info_i18n.RCM_MODIFY_FAIL_MESSAGE;
document.getElementById("errorDialog").style.display="block";
document.body.appendChild(document.getElementById("errorDialog"));
},popStaleDataErrorDialog:function(){CERN_InsuranceInfo.cancelDialog();
document.getElementById("error-title").innerHTML=rcm_insurance_info_i18n.RCM_STALE_DATA_ERROR;
document.getElementById("errorMessage").innerHTML=rcm_insurance_info_i18n.RCM_STALE_DATA_ERROR_MESSAGE;
document.getElementById("errorDialog").style.display="block";
document.body.appendChild(document.getElementById("errorDialog"));
},popFaxNumberErrorDialog:function(){document.getElementById("error-title").innerHTML=rcm_insurance_info_i18n.RCM_FAX_NUMBER_ERROR;
document.getElementById("errorMessage").innerHTML=rcm_insurance_info_i18n.RCM_FAX_NUMBER_ERROR_MESSAGE;
document.getElementById("errorDialog").style.display="block";
document.body.appendChild(document.getElementById("errorDialog"));
},popMissingDateErrorDialog:function(){document.getElementById("error-title").innerHTML=rcm_insurance_info_i18n.RCM_DATE_ERROR;
document.getElementById("errorMessage").innerHTML=rcm_insurance_info_i18n.RCM_MISSING_DATE_ERROR_MESSAGE;
document.getElementById("errorDialog").style.display="block";
document.body.appendChild(document.getElementById("errorDialog"));
},isDays:function(id){var auth=CERN_InsuranceInfo.getAuthorization(id);
var remaining=auth.REMAININGNUMBERAUTHORIZED;
var numAuth=auth.NUMBERAUTHORIZED;
var qualifier=auth.NUMBERAUTHORIZEDQUALIFIERDISP;
if(remaining===0&&numAuth===0&&qualifier.length===0){return true;
}},saveDialog:function(containerId,fieldName){$("#saveButton").attr("disabled","disabled");
document.getElementById("errorDialog").style.display="none";
var authorization=CERN_InsuranceInfo.getAuthorization(containerId);
var _serviceBeginDateTime=false;
var serviceBeginDateTime="";
var _serviceEndDateTime=false;
var serviceEndDateTime="";
var _numberAuthorized=false;
var numberAuthorized=0;
var _remainingNumberAuthorized=false;
var remainingNumberAuthorized=0;
var _faxNumber=false;
var faxNumber="";
var _authorizationNumber=false;
var authorizationNumber="";
var _authorizationStatusCd=false;
var authorizationStatusCd="";
var _authorizationQualifierMeaning=false;
var authorizationQualifierMeaning="";
var authorization=CERN_InsuranceInfo.getAuthorization(containerId);
if(fieldName==="authDates"){if(!((document.getElementById("AuthStartDatePicker").value)&&(document.getElementById("AuthEndDatePicker").value))){CERN_InsuranceInfo.popMissingDateErrorDialog();
document.getElementById("error-buttons").focus();
return 0;
}var startDateString=document.getElementById("AuthStartDatePicker").value;
var endDateString=document.getElementById("AuthEndDatePicker").value;
var startDate=new Date(startDateString);
var endDate=new Date(endDateString);
if(startDate>endDate){CERN_InsuranceInfo.popDateErrorDialog();
document.getElementById("error-buttons").focus();
return 0;
}var originalStartDate=new Date(RCM_Clinical_Util.formatJsonDateString(authorization.SERVICEBEGINDATETIME));
var originalEndDate=new Date(RCM_Clinical_Util.formatJsonDateString(authorization.SERVICEENDDATETIME));
if(startDate!==originalStartDate){_serviceBeginDateTime=true;
}if(endDate!==originalEndDate){_serviceEndDateTime=true;
}if(_serviceBeginDateTime||_serviceEndDateTime){serviceBeginDateTime=CERN_InsuranceInfo.formatDateString(startDate);
serviceEndDateTime=CERN_InsuranceInfo.formatDateString(endDate);
if(CERN_InsuranceInfo.isDays(containerId)){_authorizationQualifierMeaning=true;
authorizationQualifierMeaning="DAYS";
}if((authorization.NUMBERAUTHQUALIFIERMEANING==="DAYS")||(CERN_InsuranceInfo.isDays(containerId))){var orginalNumberAuthorized=parseInt(authorization.NUMBERAUTHORIZED);
var originalRemainingNumberAuthorized=parseInt(authorization.REMAININGNUMBERAUTHORIZED);
var oneDay=1000*60*60*24;
var diffInDaysInMillis=endDate.getTime()-startDate.getTime();
numberAuthorized=Math.ceil(diffInDaysInMillis/oneDay)+1;
if(numberAuthorized!==orginalNumberAuthorized){_numberAuthorized=true;
}var dateToday=new Date();
dateToday.setMilliseconds(0);
dateToday.setSeconds(0);
dateToday.setMinutes(0);
dateToday.setHours(0);
diffInDaysInMillis=endDate.getTime()-dateToday.getTime();
if(diffInDaysInMillis>0){remainingNumberAuthorized=diffInDaysInMillis/oneDay;
}if(remainingNumberAuthorized!==originalRemainingNumberAuthorized){_remainingNumberAuthorized=true;
}}}}if(fieldName==="authFax"){var newFaxNumber=document.getElementById("faxFieldNum").value;
var originalFaxNumber=parseInt(authorization.CONTACTFAXNUMBER);
if(newFaxNumber!==originalFaxNumber){_faxNumber=true;
faxNumber=newFaxNumber;
}var faxNumTextLength=document.getElementById("faxFieldNum").value.length;
if(faxNumTextLength<7){CERN_InsuranceInfo.popFaxNumberErrorDialog();
document.getElementById("error-buttons").focus();
return 0;
}}if(fieldName==="authStatus"){var newIndex=document.getElementById("authStatusDropDown").selectedIndex;
var Options=document.getElementById("authStatusDropDown").options;
var newStatusCd=Options[newIndex].value;
var originalStatus=authorization.AUTHORIZATIONSTATUSDISP;
if(originalStatus!==newStatusCd){_authorizationStatusCd=true;
authorizationStatusCd=newStatusCd;
}}if(fieldName==="authNum"){var newAuthNum=document.getElementById("authNumber").value;
if(newAuthNum.length>0){_authorizationNumber=true;
authorizationNumber=newAuthNum;
}}var hpAuthJson={id:authorization.ID,_serviceBeginDateTime:_serviceBeginDateTime==true?1:0,serviceBeginDateTime:serviceBeginDateTime,_serviceEndDateTime:_serviceEndDateTime==true?1:0,serviceEndDateTime:serviceEndDateTime,_numberAuthorized:_numberAuthorized==true?1:0,numberAuthorized:numberAuthorized,_remainingNumberAuthorized:_remainingNumberAuthorized==true?1:0,remainingNumberAuthorized:remainingNumberAuthorized,_faxNumber:_faxNumber==true?1:0,faxNumber:faxNumber,_comments:0,comments:"",_authorizationNumber:_authorizationNumber==true?1:0,authorizationNumber:authorizationNumber,_authorizationStatusCd:_authorizationStatusCd==true?1:0,authorizationStatusCd:authorizationStatusCd,_authorizationQualifierMeaning:_authorizationQualifierMeaning==true?1:0,authorizationQualifierMeaning:authorizationQualifierMeaning};
var healthPlanId=CERN_InsuranceInfo.getHealthPlanRelationshipId(authorization.ID);
var hprltnsJson=[{modifyHealthPlanRelationships:[{id:healthPlanId,healthPlanAuthorizations:[{modifyAuthorizations:[hpAuthJson]}]}]}];
var json={um_request:{encounterId:new String(this.component.criterion.encntr_id),version:this.RECORDDATA.VERSION,patientId:this.RECORDDATA.PATIENTID,healthPlanRelationships:hprltnsJson?hprltnsJson:[]}};
var sendAr=[];
sendAr.push("^MINE^","0.0","^MODIFY^");
sendAr.push("^",JSON.stringify(json),"^");
var insuranceSendDelegate=new InsuranceDelegate();
insuranceSendDelegate.setData(sendAr,this.component);
},formatDateString:function(date){var formattedString=[];
formattedString.push(date.format("dd-mmm-yyyy"));
formattedString.push(" 00:00:00");
return formattedString.join("");
},checkForNumValue:function(clickedField,id,fieldName){if(clickedField&&fieldName!=="authNum"){return'<td class="ins-value" ><span id ="'+id+'" onMouseOver= CERN_InsuranceInfo.handleOver(this) onMouseout= CERN_InsuranceInfo.handleOut(this) onclick= CERN_InsuranceInfo.openDialog(this,"'+fieldName+'")>'+clickedField+"</span>";
}else{if(clickedField&&fieldName==="authNum"){return'<td class="ins-value">'+clickedField;
}else{return'<td class="ins-value" id ="'+id+'"onMouseOver= CERN_InsuranceInfo.handleOver(this) onMouseout= CERN_InsuranceInfo.handleOut(this) onclick= CERN_InsuranceInfo.openDialog(this,"'+fieldName+'")>';
}}},GetInsuranceInfoTable:function(component,recordData){var insuranceContainer=document.getElementById("rcm-info-container");
if(insuranceContainer){insuranceContainer.parentNode.removeChild(insuranceContainer);
}this.RECORDDATA=recordData;
var jsHTML=[];
var sHTML="";
if(component.criterion.encntr_id===0){jsHTML.push("<div>",rcm_insurance_info_i18n.RCM_INVALID_ENCOUNTER_MESSAGE,"</div>");
sHTML=jsHTML.join("");
MP_Util.Doc.FinalizeComponent(sHTML,component,"");
return;
}jsHTML.push("<div id='rcm-info-container'>");
var dateTime=new Date();
var insuranceCnt=0;
if(recordData){insuranceCnt=recordData.HEALTHPLANRELATIONSHIPS.length;
}var insurancerowcnt=0;
var numberOfAuthFields=10;
if(insuranceCnt===0){jsHTML.push("<div>",rcm_insurance_info_i18n.RCM_NO_RESULT_FOUND,"</div>");
}for(var i=0;
i<insuranceCnt;
i++){insurancerowcnt=1+insurancerowcnt+(numberOfAuthFields*recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS.length);
}jsHTML.push("<div class='",MP_Util.GetContentClass(component,insurancerowcnt),"'>");
jsHTML.push('<div class="sub-sec-content">');
var hasPrimaryInsurance=false;
for(var i=0;
i<insuranceCnt;
i++){var priority=recordData.HEALTHPLANRELATIONSHIPS[i].PRIORITY;
if(priority<=3){var healthPlanBegEffDate=RCM_Clinical_Util.formatJsonDateString(recordData.HEALTHPLANRELATIONSHIPS[i].BEGINEFFECTIVEDATETIME);
var healthPlanEndEffDate=RCM_Clinical_Util.formatJsonDateString(recordData.HEALTHPLANRELATIONSHIPS[i].ENDEFFECTIVEDATETIME);
var sWithinHover='<h4><span class="ins-det-hd">'+rcm_insurance_info_i18n.RCM_INSURANCE_DETAILS+'</span></h4><div class="ins-hvr"><dl class="ins-det"><dt><span>'+rcm_insurance_info_i18n.RCM_SUBSCRIBER_ID+' : </span></dt><dd class="result"><span>'+recordData.HEALTHPLANRELATIONSHIPS[i].SUBSCRIBERID+"</span></dd><dt><span>"+rcm_insurance_info_i18n.RCM_MEMBER_ID+' : </span></dt><dd class="result"><span>'+recordData.HEALTHPLANRELATIONSHIPS[i].MEMBERID+"</span></dd><dt><span>"+rcm_insurance_info_i18n.RCM_GROUP_ID+' : </span></dt><dd class="result"><span>'+recordData.HEALTHPLANRELATIONSHIPS[i].GROUPID+"</span></dd><dt><span>"+rcm_insurance_info_i18n.RCM_ADDRESS+': </span></dt><dd class="result"><span>'+recordData.HEALTHPLANRELATIONSHIPS[i].FORMATTEDADDRESS+"</span></dd><dt><span>"+rcm_insurance_info_i18n.RCM_PHONE+': </span></dt><dd class="result"><span>'+recordData.HEALTHPLANRELATIONSHIPS[i].FORMATTEDPHONE+"</span></dd><dt><span>"+rcm_insurance_info_i18n.RCM_EFFECTIVE_DATE+': </span></dt><dd class="result"><span>'+(healthPlanBegEffDate?healthPlanBegEffDate:rcm_insurance_info_i18n.RCM_NA)+" - "+(healthPlanEndEffDate?healthPlanEndEffDate:rcm_insurance_info_i18n.RCM_NA)+" </span></dd></dl></div>";
}else{continue;
}if(priority===1){hasPrimaryInsurance=true;
jsHTML.push('<div class="sub-sec">');
jsHTML.push('<h3 class="sub-sec-hd">');
jsHTML.push('<span class="sub-sec-hd-tgl" id = "priheadtgl" title="',rcm_insurance_info_i18n.RCM_HIDE_SECTION,'">-</span>');
jsHTML.push('<span class="sub-sec-title">',rcm_insurance_info_i18n.RCM_PRIMARY,": ");
jsHTML.push(recordData.HEALTHPLANRELATIONSHIPS[i].HEALTHPLANNAME,"</span></h3>",sWithinHover);
}else{if(hasPrimaryInsurance===false){hasPrimaryInsurance=true;
jsHTML.push('<div class="sub-sec">');
jsHTML.push('<h3 class="sub-sec-hd">');
jsHTML.push('<span class="sub-sec-hd-tgl" id = "priheadtgl" title="',rcm_insurance_info_i18n.RCM_HIDE_SECTION,'">-</span>');
jsHTML.push('<span class="sub-sec-title">',rcm_insurance_info_i18n.RCM_PRIMARY,": ");
jsHTML.push(rcm_insurance_info_i18n.RCM_NO_PRIMARY_INSURANCE,"</span></h3>");
}}if(priority===2){jsHTML.push('<div class="sub-sec">');
jsHTML.push('<h3 class="sub-sec-hd">');
jsHTML.push('<span class="sub-sec-hd-tgl" id ="secheadtgl" title="',rcm_insurance_info_i18n.RCM_HIDE_SECTION,'">-</span>');
jsHTML.push('<span class="sub-sec-title">',rcm_insurance_info_i18n.RCM_SECONDARY,": ");
jsHTML.push(recordData.HEALTHPLANRELATIONSHIPS[i].HEALTHPLANNAME,"</span></h3>",sWithinHover);
}if(priority===3){jsHTML.push('<div class="sub-sec">');
jsHTML.push('<h3 class="sub-sec-hd">');
jsHTML.push('<span class="sub-sec-hd-tgl" id ="terheadtgl" title="',rcm_insurance_info_i18n.RCM_HIDE_SECTION,'">-</span>');
jsHTML.push('<span class="sub-sec-title">',rcm_insurance_info_i18n.RCM_TERTIARY,": ");
jsHTML.push(recordData.HEALTHPLANRELATIONSHIPS[i].HEALTHPLANNAME,"</span></h3>",sWithinHover);
}sWithinHover="";
var jsAuthHTML=[];
var allowToEdit=false;
if(recordData.CANMODIFYIND===1){allowToEdit=true;
}var statusEdit;
var AuthNumEdit;
var AuthDatesEdit;
var AuthFaxEdit;
var AuthCommentsEdit;
for(var j=0;
j<recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS.length;
j++){var dateString=[];
var begAuthDateTime=RCM_Clinical_Util.formatJsonDateString(recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS[j].SERVICEBEGINDATETIME);
var endAuthDateTime=RCM_Clinical_Util.formatJsonDateString(recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS[j].SERVICEENDDATETIME);
if(begAuthDateTime||endAuthDateTime){dateString.push(begAuthDateTime?begAuthDateTime:rcm_insurance_info_i18n.RCM_NA," - ",endAuthDateTime?endAuthDateTime:rcm_insurance_info_i18n.RCM_NA);
}if(allowToEdit===true){statusEdit=CERN_InsuranceInfo.checkForNumValue(recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS[j].AUTHORIZATIONSTATUSDISP,recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS[j].ID,"authStatus");
authNumEdit=CERN_InsuranceInfo.checkForNumValue(recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS[j].AUTHORIZATIONNUMBER,recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS[j].ID,"authNum");
authDatesEdit=CERN_InsuranceInfo.checkForNumValue(dateString.join(""),recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS[j].ID,"authDates");
authFaxEdit=CERN_InsuranceInfo.checkForNumValue(recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS[j].CONTACTFAXNUMBER,recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS[j].ID,"authFax");
}else{statusEdit='<td class="ins-value">'+recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS[j].AUTHORIZATIONSTATUSDISP;
authNumEdit='<td class="ins-value">'+recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS[j].AUTHORIZATIONNUMBER;
authDatesEdit='<td class="ins-value">'+dateString.join("");
authFaxEdit='<td class="ins-value">'+recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS[j].CONTACTFAXNUMBER;
authCommentsEdit='<td class="ins-value">'+RCM_Clinical_Util.decodeString(recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS[j].COMMENTTEXT);
}jsAuthHTML.push('<div class="sub-sec">');
jsAuthHTML.push('<h3 class="sub-sec-hd" id="authorizations"><span class="sub-sec-hd-tgl" title="',rcm_insurance_info_i18n.RCM_HIDE_SECTION,'">-');
jsAuthHTML.push('</span><span class="sub-sec-title">',rcm_insurance_info_i18n.RCM_AUTHORIZATION,"</span></h3>");
jsAuthHTML.push('<div class="sub-sec-content">');
jsAuthHTML.push('<table class="ins-table">');
jsAuthHTML.push('<tr><th class="ins-label">',rcm_insurance_info_i18n.RCM_STATUS,":</th>"+statusEdit+"</td></tr>");
jsAuthHTML.push('<tr><th class="ins-label">',rcm_insurance_info_i18n.RCM_DELAY_REASON,':</th><td class="ins-value">',recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS[j].DELAYREASONDISP,"</td></tr>");
if(recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS[j].DELAYREASONCOMMENTTEXT){jsAuthHTML.push('<tr><th class="ins-label">',rcm_insurance_info_i18n.RCM_DELAY_REASON_COMMENT,':</th><td class="ins-value">',recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS[j].DELAYREASONCOMMENTTEXT,"</td></tr>");
}jsAuthHTML.push('<tr><th class="ins-label">',rcm_insurance_info_i18n.RCM_AUTH_NUMBER,":</th>"+authNumEdit+"</td></tr>");
if(recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS[j].REFERENCENUMBER){jsAuthHTML.push('<tr><th class="ins-label">',rcm_insurance_info_i18n.RCM_REF_NUMBER,':</th><td class="ins-value" >',recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS[j].REFERENCENUMBER,"</td></tr>");
}jsAuthHTML.push('<tr><th class="ins-label">',rcm_insurance_info_i18n.RCM_AUTH_DATES,":</th>"+authDatesEdit+"</td></tr>");
jsAuthHTML.push('<tr><th class="ins-label" >',rcm_insurance_info_i18n.RCM_NUMBER_OF_DAYS,':</th><td class="ins-value" id = "',recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS[j].ID,'">',recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS[j].NUMBERAUTHORIZED," ",recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS[j].NUMBERAUTHORIZEDQUALIFIERDISP,"</td></tr>");
jsAuthHTML.push('<tr><th class="ins-label">',rcm_insurance_info_i18n.RCM_AUTH_FAX,":</th>"+authFaxEdit+"</td></tr>");
jsAuthHTML.push('<tr><th class="ins-label">',rcm_insurance_info_i18n.RCM_AUTH_PHONE,':</th><td class="ins-value">',recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS[j].CONTACTPHONENUMBER,"</td></tr>");
jsAuthHTML.push('<tr><th class="ins-label">',rcm_insurance_info_i18n.RCM_AUTH_COMMENTS,':</th><td class="ins-value">'+RCM_Clinical_Util.decodeString(recordData.HEALTHPLANRELATIONSHIPS[i].AUTHORIZATIONS[j].COMMENTTEXT)+"</td></tr>");
jsAuthHTML.push("</table>");
jsAuthHTML.push("</div>");
jsAuthHTML.push("</div>");
}jsHTML.push('<div class="sub-sec-content">',jsAuthHTML.join(""),"</div></div>");
}jsHTML.push("</div>");
jsHTML.push("</div>");
jsHTML.push("<div id='ins-modify-dialog' class='ins-modify-dialog'>");
jsHTML.push("</div>");
jsHTML.push("<div id='errorDialog' class='ins-error-dialog'>");
jsHTML.push("<div class='error-title-bar'>");
jsHTML.push("<label id= 'error-title'></label>","</div>");
jsHTML.push("<div class='error-dialog-message-area'>");
jsHTML.push("<label id='errorMessage'></label></div>");
jsHTML.push("<input id='error-buttons' class='error-buttons' type='button' onclick = 'CERN_InsuranceInfo.cancelErrorDialog()' value='",rcm_insurance_info_i18n.RCM_OK,"' />");
jsHTML.push("</div></div>");
jsHTML.push("</div>");
sHTML=jsHTML.join("");
MP_Util.Doc.FinalizeComponent(sHTML,component,"");
var node=component.getSectionContentNode();
this.initInsuranceLocHovers(node);
var toggleArray=this.getToggleArray(node,"sub-sec-hd-tgl");
for(var k=0;
k<toggleArray.length;
k++){if(toggleArray[k].id==="terheadtgl"||toggleArray[k].id==="secheadtgl"){toggleArray[k].click(MP_Util.Doc.ExpandCollapse);
var checkClosed=Util.gp(Util.gp(toggleArray[k]));
if(!Util.Style.ccss(checkClosed,"closed")){toggleArray[k].innerHTML="+";
toggleArray[k].title=rcm_insurance_info_i18n.RCM_SHOW_SECTION;
}}}return;
}};
}();
function InsuranceInfoComponentStyle(){this.initByNamespace("ins");
}InsuranceInfoComponentStyle.inherits(ComponentStyle);
function InsuranceComponent(criterion){this.setCriterion(criterion);
this.setStyles(new InsuranceInfoComponentStyle());
this.setScope(2);
InsuranceComponent.method("InsertData",function(){CERN_InsuranceInfo.GetInsuranceTable(this);
});
InsuranceComponent.method("HandleSuccess",function(recordData){CERN_InsuranceInfo.GetInsuranceInfoTable(this,recordData);
});
}InsuranceComponent.inherits(MPageComponent);

function InsuranceDelegate(){this.getData=function(sendAr,component){var handler=function(RECORDDATA,successStatus,errorMessage){if("S"===successStatus){component.HandleSuccess(RECORDDATA);
}else{component.HandleSuccess(RECORDDATA);
}};
RCM_Clinical_Util.makeTimerCCLRequest(component,"RCM_MPC_INSURANCE_INFO",sendAr,true,function(status,RECORDDATA,errorInfo){if("S"===status){handler(RECORDDATA,status);
}else{if("F"===status){var alertMessage=[];
if(errorInfo&&errorInfo.length>0){alertMessage.push(errorInfo);
}if(RECORDDATA&&RECORDDATA.EXCEPTIONINFORMATION){alertMessage.push(RECORDDATA.EXCEPTIONINFORMATION[0].EXCEPTIONTYPE);
}if(RECORDDATA&&RECORDDATA.STATUS_DATA&&RECORDDATA.STATUS_DATA.SUBEVENTSTATUS){alertMessage.push(RECORDDATA.STATUS_DATA.SUBEVENTSTATUS[0].TARGETOBJECTVALUE);
}handler(RECORDDATA,status,alertMessage.join());
}}});
};
this.setData=function(sendAr,component){var handler=function(RECORDDATA,successStatus,errorMessage){CERN_InsuranceInfo.closeDialog();
if("S"===successStatus){CERN_InsuranceInfo.GetInsuranceTable(CERN_InsuranceInfo.component);
}else{CERN_InsuranceInfo.popSaveErrorMessage();
document.getElementById("error-buttons").focus();
}};
RCM_Clinical_Util.makeTimerCCLRequest(component,"rcm_modify_utilization_mgmt",sendAr,true,function(status,RECORDDATA,errorInfo){if("S"===status){handler(RECORDDATA,status);
}else{if("F"===status){var alertMessage=[];
if(errorInfo&&errorInfo.length>0){alertMessage.push(errorInfo);
}if(RECORDDATA&&JSON.stringify(RECORDDATA.EXCEPTIONINFORMATION.EXCEPTIONTYPE==="STALE_DATA")){CERN_InsuranceInfo.popStaleDataErrorDialog();
document.getElementById("error-buttons").focus();
}else{if(RECORDDATA&&RECORDDATA.STATUS_DATA&&RECORDDATA.STATUS_DATA.SUBEVENTSTATUS){alertMessage.push(RECORDDATA.STATUS_DATA.SUBEVENTSTATUS[0].TARGETOBJECTVALUE);
}else{handler(RECORDDATA,status,alertMessage.join());
}}}}});
};
}
function CareNotesListComponentStyle(){this.initByNamespace("care_notes_list");
}CareNotesListComponentStyle.inherits(ComponentStyle);
function CareNotesListComponent(criterion){var component=this;
this.setStyles(new CareNotesListComponentStyle());
this.setCriterion(criterion);
this.setLabel(rcm_notes_list_i18n.CARE_MANAGEMENT_NOTES);
this.setPlusAddEnabled(true);
this.setExpanded(true);
this.setIncludeLineNumber(true);
var rData;
var nTypes=[];
CareNotesListComponent.method("InsertData",function(){new CareNotesDelegate().getCareNotes(String(criterion.person_id),String(criterion.encntr_id),nTypes,function(status,recordData){if(status==="S"){rData=recordData;
component.HandleSuccess(recordData);
}else{alert("Get Care Notes for Modify Service Failure");
}},[],true);
});
CareNotesListComponent.method("HandleSuccess",function(recordData){this.canAddInd=recordData.CAN_MODIFY_IND===1;
var length=recordData.NOTES.length;
var scrollClass=MP_Util.GetContentClass(this,length);
RCM_CareNotesList.renderList(this,recordData,scrollClass);
if(!this.canAddInd||nTypes.length===0){var addPlus=document.getElementById("care_notes_listAdd");
if(addPlus){addPlus.style.display="none";
}}var timeOut=null;
var currwidth=document.documentElement.clientWidth;
var render=function(){if(currwidth!==document.documentElement.clientWidth){RCM_CareNotesList.renderList(component,recordData,scrollClass);
currwidth=document.documentElement.clientWidth;
}};
window.onresize=function(){if(timeOut!==null){clearTimeout(timeOut);
}timeOut=setTimeout(render,100);
};
});
CareNotesListComponent.method("openTab",function(){RCM_CareNotesList.createDialog(component,rData,rcm_notes_list_i18n.COMPOSE_NEW,"cn-Dialog");
document.getElementById("cn-transparentDiv").style.display="block";
document.getElementById("cn-Dialog").style.display="block";
RCM_CareNotesList.openDialog(".cn-dialog");
});
CareNotesListComponent.method("setNoteTypes",function(noteTypes){for(var i=0;
i<noteTypes.length;
i++){nTypes.push(noteTypes[i]);
}});
}CareNotesListComponent.inherits(MPageComponent);
var RCM_CareNotesList=function(){var cnExpandObjArray=[];
var sortByTypeSelected=false;
return{openDialog:function(dialogId){var topForm=$(".cn-note-list").closest("body");
var dialog=$(dialogId);
var scrollTop=topForm.closest("html").scrollTop();
var clientHeight=Math.min(topForm.height(),gvs()[0]);
var topPos=(clientHeight-dialog.height())/2+scrollTop;
var top=topPos>=0?topPos:50;
dialog.css("top",top+"px");
},renderList:function(component,recordData,scrollClass){var jsHTML=[];
var menuItems=[];
var notesAvailable=0;
var noteCount=0;
var menuItem=RCM_DropDownMenu.createMenuItem(rcm_notes_list_i18n.EXPAND_ALL,function(){$(".cn-note-text").each(function(index){expandCareNote(index);
});
RCM_DropDownMenu.setMenuItemVisible("careNotesDropDownMenu","collapseAll",true);
RCM_DropDownMenu.setMenuItemVisible("careNotesDropDownMenu","expandAll",false);
},"expandAll");
menuItems.push(menuItem);
var menuItemCollapse=RCM_DropDownMenu.createMenuItem(rcm_notes_list_i18n.COLLAPSE_ALL,function(){$(".cn-note-text").each(function(index){$(".cn-show-less").eq(index).click();
});
RCM_DropDownMenu.setMenuItemVisible("careNotesDropDownMenu","expandAll",true);
RCM_DropDownMenu.setMenuItemVisible("careNotesDropDownMenu","collapseAll",false);
},"collapseAll");
menuItems.push(menuItemCollapse);
var menuItemSortTime=RCM_DropDownMenu.createMenuItem(rcm_notes_list_i18n.SORT_BY_TIME,function(){sortByTypeSelected=false;
RCM_CareNotesList.renderList(component,recordData,scrollClass);
},"SortTime");
menuItems.push(menuItemSortTime);
var menuItemSortType=RCM_DropDownMenu.createMenuItem(rcm_notes_list_i18n.SORT_BY_TYPE,function(){sortByTypeSelected=true;
RCM_CareNotesList.renderList(component,recordData,scrollClass);
},"SortType");
menuItems.push(menuItemSortType);
RCM_DropDownMenu.addDropDownMenu(component,"careNotesDropDownMenu",menuItems);
if(recordData){if(recordData.CAN_MODIFY_IND===1){noteCount=recordData.NOTES.length;
}}RCM_DropDownMenu.setMenuItemVisible("careNotesDropDownMenu","collapseAll",false);
if(noteCount===0){RCM_DropDownMenu.removeDropDownMenu("careNotesDropDownMenu");
jsHTML.push("<div class = 'cn-note-list'>");
jsHTML.push(rcm_notes_list_i18n.NO_RESULTS_FOUND);
jsHTML.push("</div>");
var sHTML=jsHTML.join("");
var countText=MP_Util.CreateTitleText(component,notesAvailable);
MP_Util.Doc.FinalizeComponent(sHTML,component,countText);
$(".cn-note-list").closest("body").append("<div id='cn-Dialog' class='cn-message-dialog'></div>");
$(".cn-note-list").closest("body").append("<div id='cn-transparentDiv' class='cn-message-transparent-dialog'></div>");
$(".cn-note-list").closest("body").append("<div id='cn-removeDialog' class='cn-message-dialog'></div>");
$(".cn-note-list").closest("body").append("<div id='cn-OkDialog' class='cn-message-dialog'></div>");
}else{var imageLocFlag=component.criterion.static_content+"\\images\\4948.ico";
var imageLocDeleteUp=component.criterion.static_content+"\\images\\6457_up_16.png";
var imageLocDeleteOver=component.criterion.static_content+"\\images\\6457_over_16.png";
var imageLocEditOver=component.criterion.static_content+"\\images\\6250_16.png";
var imageLocEditUp=component.criterion.static_content+"\\images\\6250_grayscale_16.png";
var imageLocSort=component.criterion.static_content+"\\images\\6432_11.png";
var row=0;
recordData.NOTES.sort(function(a,b){var dateA=new Date();
var dateB=new Date();
dateA.setISO8601(a.UPDATE_DT_TM);
dateB.setISO8601(b.UPDATE_DT_TM);
if(dateA<dateB){return 1;
}else{if(dateA===dateB){return 0;
}else{return -1;
}}});
jsHTML.push("<div class = 'cn-note-list'>");
jsHTML.push("<div class = 'cn-note-list-border'>");
jsHTML.push("<div id='CareNotesListTable' class=' cn-rel-position ",scrollClass,"'>");
if(sortByTypeSelected){var typeArray=recordData.NOTE_TYPES;
for(var type=0;
type<typeArray.length;
type++){var currentType="";
for(var note=0;
note<noteCount;
note++){var careNote=recordData.NOTES[note];
if(careNote.NOTE_TYPE_DISPLAY===typeArray[type].DISPLAY){if(currentType!==typeArray[type].DISPLAY){jsHTML.push("<div class='cn-type-header'>");
jsHTML.push(typeArray[type].DISPLAY);
jsHTML.push("</div>");
currentType=typeArray[type].DISPLAY;
}cnSetExpand(noteCount,careNote,row);
jsHTML=getNoteHtml(careNote,jsHTML,imageLocFlag,imageLocDeleteUp,imageLocEditUp);
row++;
}}}}else{for(var note=0;
note<noteCount;
note++){var careNote=recordData.NOTES[note];
cnSetExpand(noteCount,careNote,note);
jsHTML=getNoteHtml(careNote,jsHTML,imageLocFlag,imageLocDeleteUp,imageLocEditUp);
}}jsHTML.push("</div>");
jsHTML.push("</div>");
jsHTML.push("</div>");
notesAvailable=recordData.NOTES.length;
sHTML=jsHTML.join("");
countText=MP_Util.CreateTitleText(component,notesAvailable);
MP_Util.Doc.FinalizeComponent(sHTML,component,countText);
var lineHeightArray=[];
$(".cn-note-text").each(function(index){lineHeightArray.push($(this).height());
});
var indexArray=[];
var cloneHeight=[];
$(".cn-note-text-clone").each(function(index){cloneHeight.push($(this).height());
if(lineHeightArray[index]>$(this).height()){indexArray.push(index);
}$(this).parent(".cn-note-white").remove();
});
$(".cn-note-text").each(function(index){var careNote;
for(var i=0;
i<recordData.NOTES.length;
i++){if(cnExpandObjArray[index].id===recordData.NOTES[i].NOTE_ID){careNote=recordData.NOTES[i];
break;
}}$(".cn-note-white").eq(index).mouseover(function(){$(".cn-hover-menu").eq(index).css("visibility","visible");
});
$(".cn-note-white").eq(index).mouseout(function(){$(".cn-hover-menu").eq(index).css("visibility","hidden");
});
$(".cn-delete-image").eq(index).mouseover(function(){$(".cn-delete-image").eq(index).attr("src",imageLocDeleteOver);
});
$(".cn-delete-image").eq(index).mouseout(function(){$(".cn-delete-image").eq(index).attr("src",imageLocDeleteUp);
});
$(".cn-delete-image").eq(index).click(function(){RemoveNoteDialog();
$("#cnDialogYesButton").focus();
$("#cnDialogNoButton").click(function(){$("#cn-removeDialog").hide();
$("#cn-transparentDiv").hide();
});
$("#cnDialogYesButton").click(function(){var removeItem;
for(obj=0;
obj<cnExpandObjArray.length;
obj++){if(cnExpandObjArray[obj].id===careNote.NOTE_ID){removeItem=obj;
break;
}}cnExpandObjArray.splice(removeItem,1);
var jsonRequest={delete_note_request:{note_id:careNote.NOTE_ID,update_cnt:careNote.UPDATE_CNT}};
new CareNotesDelegate().deleteCareNote(jsonRequest,function(status,recordData){if(status==="S"){$("#cn-transparentDiv").hide();
component.InsertData();
}else{var exception=recordData.EXCEPTIONINFORMATION[0];
if(exception.EXCEPTIONTYPE==="STALE_DATA"){careNoteOkDialog("cn-OkDialog");
$("#cnOkDialogTitle").html(rcm_notes_list_i18n.REMOVE_FAILED);
$("#cnOkDialogMessage").html(rcm_notes_list_i18n.STALE_DATA_REMOVE);
document.getElementById("cn-OkDialog").style.display="block";
RCM_CareNotesList.openDialog("#cnOkDialog");
$("#cnDialogOkButton").click(function(){$("#cn-OkDialog").hide();
$("#cn-transparentDiv").hide();
});
}else{careNoteOkDialog("cn-OkDialog");
$("#cnOkDialogTitle").html(rcm_notes_list_i18n.REMOVE_FAILED);
$("#cnOkDialogMessage").html(rcm_notes_list_i18n.REMOVE_FAILED);
document.getElementById("cn-OkDialog").style.display="block";
RCM_CareNotesList.openDialog("#cnOkDialog");
$("#cnDialogOkButton").click(function(){$("#cn-OkDialog").hide();
$("#cn-transparentDiv").hide();
});
}}},true);
$("#cn-removeDialog").hide();
});
});
$(".cn-edit-image").eq(index).mouseover(function(){$(".cn-edit-image").eq(index).attr("src",imageLocEditOver);
});
$(".cn-edit-image").eq(index).mouseout(function(){$(".cn-edit-image").eq(index).attr("src",imageLocEditUp);
});
$(".cn-edit-image").eq(index).click(function(){RCM_CareNotesList.createDialog(component,recordData,rcm_notes_list_i18n.MODIFY,"cn-Dialog",careNote);
document.getElementById("cn-transparentDiv").style.display="block";
document.getElementById("cn-Dialog").style.display="block";
RCM_CareNotesList.openDialog(".cn-dialog");
$("#cnNoteType").val(careNote.NOTE_TYPE_CD);
$(".cn-note").append(RCM_Clinical_Util.decodeString(careNote.NOTE_TEXT));
if(careNote.NOTE_PRIORITY_MEANING==="HIGH"){$("#cnImportantCheck").attr("checked","true");
}if(careNote.PARENT_ENTITY_NAME==="PERSON"){$("#cnPersistCheck").attr("checked","true");
}if($("#cnNoteType").val()===""&&$("#careNotesNote").val().length===0){$("#cnSaveButton").attr("disabled","disabled");
}else{$("#cnSaveButton").removeAttr("disabled");
}});
for(var item=0;
item<indexArray.length;
item++){if(index===indexArray[item]){$(this).css("height",cloneHeight[index]);
$(".cn-dots").eq(index).css("visibility","visible");
$(".cn-dots").eq(index).css("display","block");
$(".cn-note-white").eq(index).mouseover(function(){$(".cn-show-all").eq(index).css("visibility","visible");
});
$(".cn-note-white").eq(index).mouseout(function(){$(".cn-show-all").eq(index).css("visibility","hidden");
});
$(".cn-show-all").eq(index).click(function(){expandCareNote(index);
});
if(cnExpandObjArray[index].expand){$(".cn-show-all").eq(index).trigger("click");
}else{$(".cn-show-less").eq(index).trigger("click");
}}}});
getStripes();
var otherWidth=$(".cn-note-list").closest("body").width();
var otherHeight=$(".cn-note-list").closest("body").height()+280;
$(".cn-note-list").closest("body").append("<div id='cn-Dialog' class='cn-message-dialog'></div>");
$(".cn-note-list").closest("body").append("<div id='cn-transparentDiv' class='cn-message-transparent-dialog'></div>");
$(".cn-note-list").closest("body").append("<div id='cn-removeDialog' class='cn-message-dialog'></div>");
$(".cn-note-list").closest("body").append("<div id='cn-OkDialog' class='cn-message-dialog'></div>");
$("#cn-transparentDiv").css("width",otherWidth);
$("#cn-transparentDiv").css("height",otherHeight);
$("#careNotesDropDownMenuSortTime").prepend($("<img id = cnSortTime />").attr({src:imageLocSort,alt:""}));
$("#careNotesDropDownMenuSortType").prepend($("<img id = cnSortType />").attr({src:imageLocSort,alt:""}));
if(sortByTypeSelected){$("#cnSortTime").css("visibility","hidden");
$("#cnSortType").css("visibility","visible");
}else{$("#cnSortTime").css("visibility","visible");
$("#cnSortType").css("visibility","hidden");
}$("#careNotesDropDownMenuexpandAll").prepend("<span class = cn-menuItem> </span>");
$("#careNotesDropDownMenucollapseAll").prepend("<span class = cn-menuItem> </span>");
}},textAreaOnpasteCounter:function(){var newText=$("#careNotesNote").val();
newText+=window.clipboardData.getData("Text");
newText=newText.substring(0,500);
$("#careNotesNote").attr("value",newText);
event.returnValue=false;
if($("#cnNoteType").val()!==""&&$("#careNotesNote").val().length>0){$("#cnSaveButton").removeAttr("disabled");
}else{$("#cnSaveButton").attr("disabled","disabled");
}},createDialog:function(component,recordData,title,dialogName,careNote){dialogNameId=dialogName;
var htmlArray=[];
htmlArray.push("<div class='cn-dialog'>");
htmlArray.push("<div class='cn-dialog-title-bar'>");
htmlArray.push("<label>"+title+"</label>");
htmlArray.push("</div>");
htmlArray.push("<div class='cn-content-separator'></div>");
htmlArray.push("<div>");
htmlArray.push("<div class='cn-clear-previous-divs cn-padding'>");
htmlArray.push("<div class='cn-indent cn-float-left'>");
htmlArray.push("<label for='cnNoteType'>",rcm_notes_list_i18n.TYPE,"</label><br/>");
htmlArray.push("<select class='cn-padding-between-label-and-input cn-type-select' id='cnNoteType'>");
htmlArray.push("<option value=''></option>");
for(var i=0;
i<recordData.NOTE_TYPES.length;
i++){htmlArray.push("<option value='",recordData.NOTE_TYPES[i].VALUE,"'>",recordData.NOTE_TYPES[i].DISPLAY,"</option>");
}htmlArray.push("</select>");
htmlArray.push("</div>");
htmlArray.push("</div>");
htmlArray.push("<div class='cn-clear-previous-divs cn-padding'>");
htmlArray.push("<div class='cn-indent cn-float-left'>");
htmlArray.push("<label for='careNotesNote'>",rcm_notes_list_i18n.NOTE,"</label><br/>");
htmlArray.push("<textarea  class = 'cn-padding-between-label-and-input cn-note'  onpaste = 'RCM_CareNotesList.textAreaOnpasteCounter()' id = careNotesNote></textarea>");
htmlArray.push("</div>");
htmlArray.push("</div>");
htmlArray.push("<div class='cn-indent cn-padding cn-float-left'>");
htmlArray.push("<input type='checkbox' id='cnImportantCheck' name='cnImportantCheck'/>");
htmlArray.push("<label  for='cnImportantCheckCheck'> ",rcm_notes_list_i18n.IMPORTANT,"</label>");
htmlArray.push("<div class='hvr cn-hvr' id = 'cn-hvr'><d1>");
htmlArray.push(rcm_notes_list_i18n.HOVER_TEXT);
htmlArray.push("</dl></div>");
htmlArray.push("</div>");
htmlArray.push("<div class='cn-indentFurther cn-padding cn-float-left'>");
htmlArray.push("<input  class = 'cn-padding-between-label-and-checkbox' type='checkbox' id='cnPersistCheck'/>");
htmlArray.push("<label id = 'cnPersistCheckLabel' for='cnPersistCheck'> ",rcm_notes_list_i18n.PERSIST,"</label>");
htmlArray.push("</div>");
htmlArray.push("</div>");
htmlArray.push("<div id='cntoggleDiv' class='cn-clear-previous-divs cn-padding-top'>");
htmlArray.push("</div>");
htmlArray.push("<div class='cn-dialog-buttons-div'>");
htmlArray.push("<input class='cn-dialog-buttons' type='button' id='cnCancelButton' value=' ",rcm_notes_list_i18n.CANCEL," '/>");
htmlArray.push("<input class='cn-dialog-buttons' type='button' id='cnSaveButton' value=' ",rcm_notes_list_i18n.SAVE,"'/>");
htmlArray.push("</div>");
htmlArray.push("</div>");
document.getElementById(dialogName).innerHTML=htmlArray.join("");
addEvents();
function addEvents(){var hvrParent=$("#cnPersistCheckLabel").get(0);
var hvrChild=$("#cn-hvr").get(0);
hs(hvrParent,hvrChild);
RCM_Clinical_Util.maskRequiredField("cnNoteType");
RCM_Clinical_Util.addRequiredDecorator(document.getElementById("careNotesNote"));
$("#cnSaveButton").attr("disabled","disabled");
$("#cnNoteType").change(function(){if($("#cnNoteType").val()!==""&&$("#careNotesNote").val().length>0){$("#cnSaveButton").removeAttr("disabled");
}else{$("#cnSaveButton").attr("disabled","disabled");
}});
$("#careNotesNote").keyup(function(){var len=this.value.length;
if(len>500){this.value=this.value.substring(0,500);
}if($("#cnNoteType").val()!==""&&$("#careNotesNote").val().length>0){$("#cnSaveButton").removeAttr("disabled");
}else{$("#cnSaveButton").attr("disabled","disabled");
}});
$("#cnCancelButton").click(function(){$("#cn-transparentDiv").hide();
$("#"+dialogNameId).hide();
});
$("#cnSaveButton").click(function(){var prntEntityName;
var prntEntityid;
var noteTypeCode;
var NoteText;
var NotePriorityMeaning;
var inContext=true;
if($("#cnPersistCheck").attr("checked")){prntEntityName="PERSON";
prntEntityid=String(component.criterion.person_id);
}else{prntEntityName="ENCOUNTER";
prntEntityid=String(component.criterion.encntr_id);
if(prntEntityid==="0"){inContext=false;
}}noteTypeCode=$("#cnNoteType").val();
NoteText=RCM_Clinical_Util.encodeString($("#careNotesNote").val());
if($("#cnImportantCheck").attr("checked")){NotePriorityMeaning="HIGH";
}else{NotePriorityMeaning="NORMAL";
}if(inContext){if(title===rcm_notes_list_i18n.COMPOSE_NEW){var jsonRequest={add_note_request:{parent_entity_name:prntEntityName,parent_entity_id:prntEntityid,note_type_cd:noteTypeCode,note_text:NoteText,note_priority_meaning:NotePriorityMeaning}};
new CareNotesDelegate().addCareNote(jsonRequest,function(status){if(status==="S"){component.InsertData();
$("#cn-transparentDiv").hide();
}else{careNoteOkDialog("cn-OkDialog");
$("#cnOkDialogTitle").html(rcm_notes_list_i18n.SAVE_FAILED);
$("#cnOkDialogMessage").html(rcm_notes_list_i18n.SAVE_FAILED);
document.getElementById("cn-OkDialog").style.display="block";
RCM_CareNotesList.openDialog("#cnOkDialog");
$("#cnDialogOkButton").click(function(){$("#cn-OkDialog").hide();
$("#cn-transparentDiv").hide();
});
}},true);
}else{var jsonRequest={modify_note_request:{note_id:careNote.NOTE_ID,parent_entity_name:prntEntityName,parent_entity_id:prntEntityid,note_type_cd:noteTypeCode,note_text:NoteText,note_priority_meaning:NotePriorityMeaning,update_cnt:careNote.UPDATE_CNT}};
new CareNotesDelegate().modifyCareNote(jsonRequest,function(status,recordData){if(status==="S"){component.InsertData();
$("#cn-transparentDiv").hide();
}else{var exception=recordData.EXCEPTIONINFORMATION[0];
if(exception.EXCEPTIONTYPE==="STALE_DATA"){careNoteOkDialog("cn-OkDialog");
$("#cnOkDialogTitle").html(rcm_notes_list_i18n.SAVE_FAILED);
$("#cnOkDialogMessage").html(rcm_notes_list_i18n.STALE_DATA_SAVE);
document.getElementById("cn-OkDialog").style.display="block";
RCM_CareNotesList.openDialog("#cnOkDialog");
$("#cnDialogOkButton").click(function(){$("#cn-OkDialog").hide();
$("#cn-transparentDiv").hide();
});
}else{careNoteOkDialog("cn-OkDialog");
$("#cnOkDialogTitle").html(rcm_notes_list_i18n.SAVE_FAILED);
$("#cnOkDialogMessage").html(rcm_notes_list_i18n.SAVE_FAILED);
document.getElementById("cn-OkDialog").style.display="block";
RCM_CareNotesList.openDialog("#cnOkDialog");
$("#cnDialogOkButton").click(function(){$("#cn-OkDialog").hide();
$("#cn-transparentDiv").hide();
});
}}},true);
}$("#"+dialogNameId).hide();
}else{careNoteOkDialog("cn-OkDialog");
$("#cnOkDialogTitle").html(rcm_notes_list_i18n.SAVE_FAILED);
$("#cnOkDialogMessage").html(rcm_notes_list_i18n.PATIENT_OUT_OF_CONTEXT);
document.getElementById("cn-OkDialog").style.display="block";
RCM_CareNotesList.openDialog("#cnOkDialog");
$("#cnDialogOkButton").click(function(){$("#cn-OkDialog").hide();
});
}});
}}};
function careNoteOkDialog(dialogName){var htmlArray=[];
htmlArray.push("<div id='cnOkDialog' class='cn-error-popup'>");
htmlArray.push("<div class='cn-error-popup-title-bar'>");
htmlArray.push("<label id='cnOkDialogTitle'></label>");
htmlArray.push("</div>");
htmlArray.push("<div class='cn-error-popup-message-area'>");
htmlArray.push("<label id='cnOkDialogMessage'></label>");
htmlArray.push("</div>");
htmlArray.push("<div class='cn-error-popup-buttons'>");
htmlArray.push("<input id='cnDialogOkButton' type='button' value=",rcm_notes_list_i18n.OK,">");
htmlArray.push("</div>");
htmlArray.push("</div>");
document.getElementById(dialogName).innerHTML=htmlArray.join("");
}function collapseCareNote(noteIndex,lineHeight){cnExpandObjArray[noteIndex].expand=false;
$(".cn-note-text").eq(noteIndex).css("height",lineHeight);
$(".cn-dots").eq(noteIndex).css("visibility","visible");
$(".cn-dots").eq(noteIndex).css("display","block");
$(".cn-show-all").eq(noteIndex).css("display","block");
$(".cn-note-white").eq(noteIndex).unbind("mouseover");
$(".cn-note-white").eq(noteIndex).mouseover(function(){$(".cn-show-all").eq(noteIndex).css("visibility","visible");
$(".cn-hover-menu").eq(noteIndex).css("visibility","visible");
});
$(".cn-note-white").eq(noteIndex).mouseout(function(){$(".cn-show-all").eq(noteIndex).css("visibility","hidden");
$(".cn-hover-menu").eq(noteIndex).css("visibility","hidden");
});
}function cnSetExpand(noteCount,careNote,row){if(cnExpandObjArray.length<noteCount){var cnExpandObj={id:careNote.NOTE_ID,expand:false};
cnExpandObjArray.push(cnExpandObj);
}else{for(obj=0;
obj<cnExpandObjArray.length;
obj++){if(cnExpandObjArray[obj].id===careNote.NOTE_ID){var swap=cnExpandObjArray[row];
cnExpandObjArray[row]=cnExpandObjArray[obj];
cnExpandObjArray[obj]=swap;
break;
}}}}function expandCareNote(noteIndex){var lineHeight=$(".cn-note-text").eq(noteIndex).height();
$(".cn-note-text").eq(noteIndex).css("height","auto");
if($(".cn-note-text").eq(noteIndex).height()>lineHeight){cnExpandObjArray[noteIndex].expand=true;
$(".cn-dots").eq(noteIndex).css("visibility","hidden");
$(".cn-dots").eq(noteIndex).css("display","none");
$(".cn-show-all").eq(noteIndex).css("visibility","hidden");
$(".cn-show-all").eq(noteIndex).css("display","none");
$(".cn-note-white").eq(noteIndex).unbind("mouseover");
$(".cn-note-white").eq(noteIndex).mouseover(function(){$(".cn-show-less").eq(noteIndex).css("visibility","visible");
$(".cn-hover-menu").eq(noteIndex).css("visibility","visible");
});
$(".cn-note-white").eq(noteIndex).mouseout(function(){$(".cn-show-less").eq(noteIndex).css("visibility","hidden");
$(".cn-hover-menu").eq(noteIndex).css("visibility","hidden");
});
$(".cn-show-less").eq(noteIndex).unbind("click");
$(".cn-show-less").eq(noteIndex).click(function(){collapseCareNote(noteIndex,lineHeight);
});
}}function getDateString(careNote){var today=new Date();
var d1=new Date();
d1.setISO8601(careNote.UPDATE_DT_TM);
var yesterdayDate=new Date();
var twoDaysAgo=new Date();
var tempDate=new Date();
var dateString;
var hours=d1.getHours();
var minutes=d1.getMinutes();
if(minutes<10){minutes="0"+minutes;
}today=new Date(today.getFullYear(),today.getMonth(),today.getDate(),0,0,0,0);
dateString=hours+":"+minutes;
yesterdayDate.setDate(yesterdayDate.getDate()-1);
yesterdayDate=new Date(yesterdayDate.getFullYear(),yesterdayDate.getMonth(),yesterdayDate.getDate(),0,0,0,0);
twoDaysAgo.setDate(twoDaysAgo.getDate()-2);
twoDaysAgo=new Date(twoDaysAgo.getFullYear(),twoDaysAgo.getMonth(),twoDaysAgo.getDate(),0,0,0,0);
tempDate=new Date(d1.getFullYear(),d1.getMonth(),d1.getDate(),0,0,0,0);
if(tempDate.getTime()===today.getTime()){return dateString+" "+rcm_notes_list_i18n.TODAY;
}if(tempDate.getTime()===yesterdayDate.getTime()){return dateString+" "+rcm_notes_list_i18n.YESTERDAY;
}if(tempDate.getTime()===twoDaysAgo.getTime()){return dateString+" 2 "+rcm_notes_list_i18n.DAYS_AGO;
}else{var currentMonth=d1.getMonth()+1;
return dateString+" "+currentMonth+"/"+d1.getDate()+"/"+d1.getFullYear();
}}function getNoteHtml(careNote,jsHTML,imageLocFlag,imageLocDeleteUp,imageLocEditUp){jsHTML.push("<div class = 'cn-note-white' >");
jsHTML.push("<div class = 'cn-hover-menu'>");
jsHTML.push("<a> <img  src='",imageLocDeleteUp,"' alt='' class='cn-delete-image' /></a><br/>");
jsHTML.push("<a> <img  src='",imageLocEditUp,"' alt='' class ='cn-edit-image' /></a>");
jsHTML.push("</div>");
jsHTML.push("<a class= 'cn-show-all'>",rcm_notes_list_i18n.SHOW_ALL,"</a>");
jsHTML.push("<div class = 'cn-dots'>");
jsHTML.push("...");
jsHTML.push("</div>");
if(careNote.NOTE_PRIORITY_MEANING==="HIGH"){jsHTML.push("<img class = 'cn-flag' src='",imageLocFlag,"' alt = '' />");
}else{jsHTML.push("<img class = 'cn-flag cn-imgHidden' src='",imageLocFlag,"' alt = '' />");
}jsHTML.push("<div class='cn-note-text'>");
jsHTML.push(RCM_Clinical_Util.decodeString(careNote.NOTE_TEXT));
jsHTML.push("<a class = 'cn-show-less'>",rcm_notes_list_i18n.SHOW_LESS,"</a>");
jsHTML.push("</div>");
jsHTML.push("<div class = 'cn-note-type'>");
jsHTML.push(careNote.NOTE_TYPE_DISPLAY);
jsHTML.push("</div>");
jsHTML.push("<div class = 'cn-note-prsnl'>");
jsHTML.push(careNote.PERSONNEL_NAME);
jsHTML.push("</div>");
jsHTML.push("<div class = 'cn-save-date'>");
var dateString=getDateString(careNote);
jsHTML.push(dateString);
jsHTML.push("</div>");
jsHTML.push("</div>");
var textArray=[];
textArray=careNote.NOTE_TEXT.split(" ");
var firstword=textArray[0];
var firstletter=firstword.charAt(0);
jsHTML.push("<div class = 'cn-note-white' >");
jsHTML.push("<div class = 'cn-hover-menu'>");
jsHTML.push("<a> <img  src='",imageLocDeleteUp,"' alt='' class='cn-delete-image' /></a><br/>");
jsHTML.push("<a> <img  src='",imageLocEditUp,"' alt='' class ='cn-edit-image' /></a>");
jsHTML.push("</div>");
jsHTML.push("<a class= 'cn-show-all'>",rcm_notes_list_i18n.SHOW_ALL,"</a>");
jsHTML.push("<div class = 'cn-dots'>");
jsHTML.push("...");
jsHTML.push("</div>");
jsHTML.push("<img class = 'cn-flag' src='",imageLocFlag,"' alt = '' />");
jsHTML.push("<div class='cn-note-text-clone'>");
jsHTML.push(firstletter);
jsHTML.push("</div>");
jsHTML.push("</div>");
return jsHTML;
}function getStripes(){if(sortByTypeSelected){var prevType="";
var isWhite=false;
$(".cn-note-text").each(function(index){if(prevType===$(".cn-note-type").eq(index).text()){if(isWhite){$(".cn-note-white").eq(index).css("background-color","white");
$(".cn-dots").eq(index).css("background-color","white");
isWhite=false;
}else{$(".cn-note-white").eq(index).css("background-color","#f5f6fa");
$(".cn-dots").eq(index).css("background-color","#f5f6fa");
isWhite=true;
}}else{prevType=$(".cn-note-type").eq(index).text();
$(".cn-note-white").eq(index).css("background-color","white");
$(".cn-dots").eq(index).css("background-color","white");
isWhite=false;
}});
}else{$(".cn-note-text").each(function(index){if(index%2===0){$(".cn-note-white").eq(index).css("background-color","white");
$(".cn-dots").eq(index).css("background-color","white");
}else{$(".cn-note-white").eq(index).css("background-color","#f5f6fa");
$(".cn-dots").eq(index).css("background-color","#f5f6fa");
}});
}}function createremoveDialogHTML(dialogName){var htmlArray=[];
htmlArray.push("<div id='cnremoveDialog' class='cn-error-popup'>");
htmlArray.push("<div class='cn-error-popup-title-bar'>");
htmlArray.push("<label id='cnremoveDialogTitle'></label>");
htmlArray.push("</div>");
htmlArray.push("<div class='cn-error-popup-message-area'>");
htmlArray.push("<label id='cnremoveDialogMessage'></label>");
htmlArray.push("</div>");
htmlArray.push("<div class='cn-error-popup-buttons'>");
htmlArray.push("<input id='cnDialogNoButton' type='button' value=",rcm_notes_list_i18n.NO,">");
htmlArray.push("<input id='cnDialogYesButton' type='button' value=",rcm_notes_list_i18n.YES,">");
htmlArray.push("</div>");
htmlArray.push("</div>");
document.getElementById(dialogName).innerHTML=htmlArray.join("");
$("#cnremoveDialogTitle").html(rcm_notes_list_i18n.REMOVE);
$("#cnremoveDialogMessage").html(rcm_notes_list_i18n.REMOVE_DIALOG);
}function RemoveNoteDialog(){createremoveDialogHTML("cn-removeDialog");
document.getElementById("cn-transparentDiv").style.display="block";
document.getElementById("cn-removeDialog").style.display="block";
RCM_CareNotesList.openDialog("#cnremoveDialog");
}}();

function CareNotesDelegate(){this.getCareNotes=function(personId,encntrId,noteTypes,callback,sendAr,async){var noteTypeCodes=[];
var parentEntityIDs=[{parent_entity_name:"PERSON",parent_entity_id:personId}];
if(encntrId!="0"){parentEntityIDs.push({parent_entity_name:"ENCOUNTER",parent_entity_id:encntrId});
}for(i=0;
i<noteTypes.length;
i++){noteTypeCodes.push({note_type_cd:String(noteTypes[i])});
}var json={get_notes_request:{parent_entity_ids:parentEntityIDs,note_type_cds:noteTypeCodes}};
var sendAr=[];
sendAr.push("^MINE^","0.0","^GETCAREMANAGEMENTNOTESFORMODIFY^","^"+JSON.stringify(json)+"^");
RCM_Clinical_Util.makeCCLRequest("rcm_notes",sendAr,async,callback);
};
this.addCareNote=function(jsonRequest,callback,async){var sendAr=[];
sendAr.push("^MINE^","0.0","^ADDCAREMANAGEMENTNOTE^","^"+JSON.stringify(jsonRequest)+"^");
RCM_Clinical_Util.makeCCLRequest("rcm_notes",sendAr,async,callback);
};
this.deleteCareNote=function(jsonRequest,callback,async){var sendAr=[];
sendAr.push("^MINE^","0.0","^DELETECAREMANAGEMENTNOTE^","^"+JSON.stringify(jsonRequest)+"^");
RCM_Clinical_Util.makeCCLRequest("rcm_notes",sendAr,async,callback);
};
this.modifyCareNote=function(jsonRequest,callback,async){var sendAr=[];
sendAr.push("^MINE^","0.0","^MODIFYCAREMANAGEMENTNOTE^","^"+JSON.stringify(jsonRequest)+"^");
RCM_Clinical_Util.makeCCLRequest("rcm_notes",sendAr,async,callback);
};
}
var CERN_VisitInfo=function(){return{GetVisitTable:function(component){var sendAr=[];
var criterion=component.getCriterion();
sendAr.push("^MINE^",criterion.person_id+".0",+criterion.encntr_id+".0",0);
RCM_Clinical_Util.makeTimerCCLRequest(component,"RCM_MPC_VISIT_INFO_SUM",sendAr,true,function(status,RECORDDATA,errorInfo){if("S"===status){component.HandleSuccess(RECORDDATA);
}else{component.HandleSuccess(null);
}});
},getVisToggleArray:function(par,tog){return Util.Style.g(tog,par,"span");
},initVisitLocHovers:function(node){var tr=Util.Style.g("vis-pe-row",node,"DIV");
for(var i=0,l=tr.length;
i<l;
i++){var m=tr[i];
if(m){var nm=Util.gns(m);
if(nm){if(Util.Style.ccss(nm,"hvr")){hs(m,nm);
}}}}},RenderComponent:function(component,recordData){var jsHTML=[];
var sHTML="";
if(component.criterion.encntr_id===0){jsHTML.push("<div>",rcm_visit_info_i18n.RCM_INVALID_ENCOUNTER_MESSAGE,"</div>");
sHTML=jsHTML.join("");
MP_Util.Doc.FinalizeComponent(sHTML,component,"");
return;
}var dateTime=new Date();
var visitRecData=recordData.VISIT_INFO;
var regDateTime=visitRecData.REGDTTM;
if(regDateTime&&regDateTime!==""){dateTime.setISO8601(regDateTime);
regDateTime=dateTime.format("longDateTime3");
}else{regDateTime="";
}var admitToBedDateTime=visitRecData.ADMITTOBEDDTTM;
if(admitToBedDateTime&&admitToBedDateTime!==""){dateTime.setISO8601(admitToBedDateTime);
admitToBedDateTime=dateTime.format("longDateTime3");
}else{admitToBedDateTime="";
}var dischargeDtTm=visitRecData.DISCHARGEDTTM;
if(dischargeDtTm&&dischargeDtTm!==""){dateTime.setISO8601(dischargeDtTm);
dischargeDtTm=dateTime.format("shortDate2");
}else{dischargeDtTm="";
}var oDisClass="";
if(visitRecData.DISCHARGEDTTM.length===0&&visitRecData.DISCHARGEDISP.length===0&&visitRecData.DISCHARGELOC.length===0){oDisClass="onLoadCollapse";
}rowCount=18+visitRecData.ENCNTRS_PAST_MONTH_CNT+visitRecData.KEY_PERSON_RELATIONSHIPS_CNT;
jsHTML.push('<div class="sub-sec">');
jsHTML.push("<div class='",MP_Util.GetContentClass(component,rowCount),"'>");
jsHTML.push('<div class="sub-sec-content">');
jsHTML.push("<div class='",MP_Util.GetContentClass(component,3),"'>");
jsHTML.push('<table class="vis-table">');
jsHTML.push('<tr><th class="vis-label">',rcm_visit_info_i18n.FIN_NUM,':</th><td class="vis-value">');
jsHTML.push(visitRecData.FIN+"</td></tr>");
jsHTML.push('<tr><th class="vis-label">',rcm_visit_info_i18n.ENCNTR_TYPE,':</th><td class="vis-value">'+visitRecData.ENCNTRTYPE+"</td></tr>");
jsHTML.push('<tr><th class="vis-label">',rcm_visit_info_i18n.FIN_CLASS,':</th><td class="vis-value">'+visitRecData.FINANCIALCLASS+"</td></tr>");
jsHTML.push("</table>");
jsHTML.push("</div>");
jsHTML.push('<div class="sub-sec">');
jsHTML.push('<h3 class=sub-sec-hd id="admitHead"><span>',rcm_visit_info_i18n.ADMIT_INFO,"</span></h3>");
jsHTML.push('<div class="sub-sec-content">');
jsHTML.push('<table class="vis-table">');
jsHTML.push('<tr><th class="vis-label">',rcm_visit_info_i18n.REG_DT_TM,':</th><td class="vis-value">',regDateTime,"</td></tr>");
jsHTML.push('<tr><th class="vis-label">',rcm_visit_info_i18n.INPATIENT_ADMIT,':</th><td class="vis-value">',admitToBedDateTime,"</td></tr>");
var attendDocName="";
if(visitRecData.PHYSLAST||visitRecData.PHYSFIRST){attendDocName=visitRecData.PHYSLAST+", "+visitRecData.PHYSFIRST;
}jsHTML.push('<tr><th class="vis-label">',rcm_visit_info_i18n.ATTENDING_PHD,':</th><td class="vis-value">',attendDocName,"</td></tr>");
jsHTML.push('<tr><th class="vis-label">',rcm_visit_info_i18n.REASON_FOR_VISIT,':</th><td class="vis-value">',visitRecData.VISITREAS,"</td></tr>");
jsHTML.push('<tr><th class="vis-label">',rcm_visit_info_i18n.ADMIT_DX,':</th><td class="vis-value">',visitRecData.ADMITDX,"</td></tr>");
jsHTML.push('<tr><th class="vis-label">',rcm_visit_info_i18n.ADMIT_SOURCE,':</th><td class="vis-value">',visitRecData.ADMITSOURCE,"</td></tr>");
jsHTML.push('<tr><th class="vis-label">',rcm_visit_info_i18n.ADMIT_TYPE,':</th><td class="vis-value">',visitRecData.ADMITTYPE,"</td></tr>");
jsHTML.push('<tr><th class="vis-label">',rcm_visit_info_i18n.LOCATION,':</th><td class="vis-value">',visitRecData.NURSEUNIT,"; ",visitRecData.ROOM,"; ",visitRecData.BED,"</td></tr>");
jsHTML.push('<tr><th class="vis-label">',rcm_visit_info_i18n.LOS,':</th><td class="vis-value">',visitRecData.LOS,"</td></tr>");
jsHTML.push("</table>");
jsHTML.push("</div>");
jsHTML.push("</div>");
jsHTML.push('<div class="sub-sec">');
jsHTML.push('<h3 class="sub-sec-hd" id="dischargeHead"><span class="sub-sec-hd-tgl" id = "dischargeheadtgl" title="',rcm_visit_info_i18n.SHOW_SECTION,'">-');
jsHTML.push('</span><span class="sub-sec-title">',rcm_visit_info_i18n.DISCHARGE_INFORMATION,"</span></h3>");
jsHTML.push('<div class="sub-sec-content">');
jsHTML.push('<table class="vis-table">');
var dischargeHide=false;
if((!dischargeDtTm||dischargeDtTm==="")&&(!visitRecData.DISCHARGEDISP||visitRecData.DISCHARGEDISP==="")&&(!visitRecData.DISCHARGELOC||visitRecData.DISCHARGELOC==="")){dischargeHide=true;
}jsHTML.push('<tr><th class="vis-label">',rcm_visit_info_i18n.DISCHARGE_DATE,':</th><td class="vis-value">',dischargeDtTm,"</td></tr>");
jsHTML.push('<tr><th class="vis-label">',rcm_visit_info_i18n.DISCHARGE_DISPOSITION,':</th><td class="vis-value">',visitRecData.DISCHARGEDISP,"</td></tr>");
if(visitRecData.FINAL_POST_ACUTE_ORG_NAME&&visitRecData.FINAL_POST_ACUTE_ORG_NAME!==""){jsHTML.push('<tr><th class="vis-label">',rcm_visit_info_i18n.POST_ACUTE_FACILITY,':</th><td class="vis-value">',visitRecData.FINAL_POST_ACUTE_ORG_NAME,"</td></tr>");
}else{if(visitRecData.DISCHARGELOC&&visitRecData.DISCHARGELOC!==""){jsHTML.push('<tr><th class="vis-label">',rcm_visit_info_i18n.DESTINATION_FACILITY,':</th><td class="vis-value">',visitRecData.DISCHARGELOC,"</td></tr>");
}else{jsHTML.push('<tr><th class="vis-label">',rcm_visit_info_i18n.POST_ACUTE_FACILITY,':</th><td class="vis-value">',"","</td></tr>");
}}jsHTML.push("</table>");
jsHTML.push("</div>");
jsHTML.push("</div>");
if(visitRecData.ENCNTRS_PAST_MONTH_CNT>0){jsHTML.push('<div class="sub-sec">');
jsHTML.push('<h3 class="sub-sec-hd" id="recentEncntrsHead"><span class="sub-sec-hd-tgl" id="dischargeheadtgl" title="',rcm_visit_info_i18n.SHOW_SECTION,'">-');
jsHTML.push('</span><span class="sub-sec-title">Encounters (',visitRecData.ENCNTRS_PAST_MONTH_CNT,")</span></h3>");
jsHTML.push('<div class="sub-sec-content">');
jsHTML.push("<div>");
jsHTML.push('<div class="vis-pe-header-parent"><div class="vis-pe-header">',rcm_visit_info_i18n.DISCHARGE_DATE,'</div><div class="vis-pe-header">',rcm_visit_info_i18n.ENCNTR_TYPE,'</div><div class="vis-pe-header">Final DRG</div></div>');
for(var i=0;
i<visitRecData.ENCNTRS_PAST_MONTH_CNT;
i++){var prevDischargDtTm=visitRecData.ENCNTRS_PAST_MONTH[i].DISCHARGE_DT;
if(prevDischargDtTm&&prevDischargDtTm!==""){dateTime.setISO8601(prevDischargDtTm);
prevDischargDtTm=dateTime.format("shortDate2");
}else{prevDischargDtTm="";
}var prevAdmitDtTm=visitRecData.ENCNTRS_PAST_MONTH[i].ADMIT_DT;
if(prevAdmitDtTm&&prevAdmitDtTm!==""){dateTime.setISO8601(prevAdmitDtTm);
prevAdmitDtTm=dateTime.format("shortDate2");
}else{prevAdmitDtTm="";
}jsHTML.push('<div class="vis-pe-row">');
jsHTML.push('<div class="vis-pe-result">',prevDischargDtTm,"</div>");
jsHTML.push('<div class="vis-pe-result">',visitRecData.ENCNTRS_PAST_MONTH[i].SECURED_INDICATOR?"<span class='vis-secured'>"+rcm_visit_info_i18n.RCM_SECURED+"</span>":visitRecData.ENCNTRS_PAST_MONTH[i].ENCNTR_TYPE,"</div>");
jsHTML.push('<div class="vis-pe-result">',visitRecData.ENCNTRS_PAST_MONTH[i].SECURED_INDICATOR?"<span class='vis-secured'>"+rcm_visit_info_i18n.RCM_SECURED+"</span>":visitRecData.ENCNTRS_PAST_MONTH[i].FINAL_DRG,"</div>");
jsHTML.push("</div>");
jsHTML.push('<div class="hvr">');
jsHTML.push('<dl class="vis-det">');
jsHTML.push("<dt><span>",rcm_visit_info_i18n.ADMIT_DATE,' :</span></dt><dd class="result"><span>',prevAdmitDtTm,"</span></dd>");
jsHTML.push("<dt><span>",rcm_visit_info_i18n.ATTENDING_PHD,': </span></dt><dd class="result"><span>',visitRecData.ENCNTRS_PAST_MONTH[i].SECURED_INDICATOR?"<span class='vis-secured'>"+rcm_visit_info_i18n.RCM_SECURED+"</span>":visitRecData.ENCNTRS_PAST_MONTH[i].ATTENDING,"</span></dd>");
jsHTML.push("<dt><span>",rcm_visit_info_i18n.DISCHARGE_DISPOSITION,': </span></dt><dd class="result"><span>',visitRecData.ENCNTRS_PAST_MONTH[i].SECURED_INDICATOR?"<span class='vis-secured'>"+rcm_visit_info_i18n.RCM_SECURED+"</span>":visitRecData.ENCNTRS_PAST_MONTH[i].DICHARGE_DISP,"</span></dd>");
if(visitRecData.ENCNTRS_PAST_MONTH[i].FINAL_POST_ACUTE_ORG_NAME&&visitRecData.ENCNTRS_PAST_MONTH[i].FINAL_POST_ACUTE_ORG_NAME!==""){jsHTML.push("<dt><span>",rcm_visit_info_i18n.POST_ACUTE_FACILITY,':</span></dt><dd class="result"><span>',visitRecData.ENCNTRS_PAST_MONTH[i].SECURED_INDICATOR?"<span class='vis-secured'>"+rcm_visit_info_i18n.RCM_SECURED+"</span>":visitRecData.ENCNTRS_PAST_MONTH[i].FINAL_POST_ACUTE_ORG_NAME,"</span></dd>");
}else{if(visitRecData.ENCNTRS_PAST_MONTH[i].DISCHARGELOC&&visitRecData.ENCNTRS_PAST_MONTH[i].DISCHARGELOC!==""){jsHTML.push("<dt><span>",rcm_visit_info_i18n.DESTINATION_FACILITY,': </span></dt><dd class="result"><span>',visitRecData.ENCNTRS_PAST_MONTH[i].SECURED_INDICATOR?"<span class='vis-secured'>"+rcm_visit_info_i18n.RCM_SECURED+"</span>":visitRecData.ENCNTRS_PAST_MONTH[i].DISCHARGELOC,"</span></dd>");
}else{jsHTML.push("<dt><span>",rcm_visit_info_i18n.POST_ACUTE_FACILITY,':</span></dt><dd class="result"><span>',visitRecData.ENCNTRS_PAST_MONTH[i].SECURED_INDICATOR?"<span class='vis-secured'>"+rcm_visit_info_i18n.RCM_SECURED+"</span>":"","</span></dd>");
}}jsHTML.push("<dt><span>",rcm_visit_info_i18n.FINAL_DIAGNOSIS,': </span></dt><dd class="result"><span>',visitRecData.ENCNTRS_PAST_MONTH[i].SECURED_INDICATOR?"<span class='vis-secured'>"+rcm_visit_info_i18n.RCM_SECURED+"</span>":visitRecData.ENCNTRS_PAST_MONTH[i].FINAL_DX,"</span></dd>");
jsHTML.push("</dl>");
jsHTML.push("</div>");
}jsHTML.push("</div>");
jsHTML.push("</div>");
jsHTML.push("</div>");
}jsHTML.push('<div class="sub-sec">');
jsHTML.push('<h3 class="sub-sec-hd" id="keypersonshead"><span class="sub-sec-hd-tgl" id = "keypersonstgl" title="',rcm_visit_info_i18n.SHOW_SECTION,'">-');
jsHTML.push('</span><span class="sub-sec-title">',rcm_visit_info_i18n.KEY_PERSON_RELATIONSHIPS,"</span></h3>");
jsHTML.push('<div class="sub-sec-content">');
jsHTML.push('<table class="vis-table">');
if(visitRecData.KEY_PERSON_RELATIONSHIPS_CNT===0){jsHTML.push('<tr><th class="vis-message">',rcm_visit_info_i18n.NO_KEY_PERSONS,"</th></tr>");
}else{for(var j=0;
j<visitRecData.KEY_PERSON_RELATIONSHIPS_CNT;
j++){jsHTML.push('<tr><th class="vis-label">',visitRecData.KEY_PERSON_RELATIONSHIPS[j].RELATIONSHIP_TYPE,':</th><td class="vis-value">',visitRecData.KEY_PERSON_RELATIONSHIPS[j].RELATED_PERSON_NAME_FULL,"</td></tr>");
}jsHTML.push("</table>");
jsHTML.push("</div>");
jsHTML.push("</div>");
jsHTML.push("</div>");
}jsHTML.push("</div>");
jsHTML.push("</div>");
sHTML=jsHTML.join("");
MP_Util.Doc.FinalizeComponent(sHTML,component,"");
var node=component.getSectionContentNode();
MP_Util.Doc.InitScrolling(Util.Style.g("scrollable",node,"div"),component.getScrollNumber(),"1.6");
this.initVisitLocHovers(node);
var toggleArray=this.getVisToggleArray(node,"sub-sec-hd-tgl");
for(var k=0;
k<toggleArray.length;
k++){if(((toggleArray[k].id=="dischargeheadtgl"&&dischargeHide)||toggleArray[k].id=="dischargeheadtgl")||((toggleArray[k].id=="keypersonstgl"&&dischargeHide)||toggleArray[k].id=="keypersonstgl")){toggleArray[k].click(MP_Util.Doc.ExpandCollapse);
var checkClosed=Util.gp(Util.gp(toggleArray[k]));
if(!Util.Style.ccss(checkClosed,"closed")){toggleArray[k].innerHTML="+";
toggleArray[k].title=rcm_visit_info_i18n.SHOW_SECTION;
}}}return;
}};
}();
function VisitInfoComponentStyle(){this.initByNamespace("vis");
}VisitInfoComponentStyle.inherits(ComponentStyle);
function VisitInfoComponent(criterion){this.setCriterion(criterion);
this.setStyles(new VisitInfoComponentStyle());
this.setScope(2);
VisitInfoComponent.method("InsertData",function(){CERN_VisitInfo.GetVisitTable(this);
});
VisitInfoComponent.method("HandleSuccess",function(recordData){CERN_VisitInfo.RenderComponent(this,recordData);
});
}VisitInfoComponent.inherits(MPageComponent);

function SocialHistoryComponentStyle(){this.initByNamespace("sh");
}SocialHistoryComponentStyle.inherits(ComponentStyle);
function SocialHistoryComponent(criterion){this.setCriterion(criterion);
this.setStyles(new SocialHistoryComponentStyle());
this.setComponentLoadTimerName("USR:MPG.SOCIAL_HISTORY.O1 - load component");
this.setComponentRenderTimerName("ENG:MPG.SOCIAL_HISTORY.O1 - render component");
this.setIncludeLineNumber(true);
this.setScope(1);
SocialHistoryComponent.method("InsertData",function(){CERN_SOCIAL_HISTORY_O1.GetSocialHistoryTable(this);
});
SocialHistoryComponent.method("HandleSuccess",function(recordData){CERN_SOCIAL_HISTORY_O1.RenderComponent(this,recordData);
});
}SocialHistoryComponent.inherits(MPageComponent);
var CERN_SOCIAL_HISTORY_O1=function(){return{GetSocialHistoryTable:function(component){var sendAr=[];
var criterion=component.getCriterion();
sendAr.push("^MINE^",criterion.person_id+".0",criterion.provider_id+".0",criterion.ppr_cd+".0");
MP_Core.XMLCclRequestWrapper(component,"MP_GET_SOCIAL_HISTORY",sendAr,true);
},RenderComponent:function(component,recordData){var timerRenderComponent=MP_Util.CreateTimer(component.getComponentRenderTimerName());
try{var i=0;
var j=0;
var k=0;
var shhtml="";
var socialCnt=0;
var social="";
var socDetlCnt=0;
var socDetl="";
var comntCnt=0;
var comment="";
var shArray=[];
var category="";
var riskAssessment="";
var updatedPrsn="";
var personnelArray=MP_Util.LoadPersonelListJSON(recordData.PRSNL);
var codeArray=MP_Util.LoadCodeListJSON(recordData.CODES);
var updateDT=new Date();
socialCnt=recordData.SOCIAL_CNT;
shArray.push("<div class ='",MP_Util.GetContentClass(component,socialCnt),"'>");
for(i=0;
i<socialCnt;
i++){social=recordData.SOCIAL[i];
category=social.CATEGORY;
if(social.RISK_ASSESSMENT_CD>0){var eventObj=MP_Util.GetValueFromArray(social.RISK_ASSESSMENT_CD,codeArray);
riskAssessment=eventObj.display;
}else{riskAssessment="";
}var detailTxt="";
var detailTag="";
if(social.SHX_DETAIL_CNT>0){for(j=0,socDetlCnt=social.SHX_DETAIL_CNT;
j<socDetlCnt;
j++){socDetl=social.SHX_DETAIL[j];
detailTxt+=socDetl.DETAIL_TEXT+"<br />";
}detailTag=i18n.DETAILS;
}var updatedTime="";
if(social.UPDT_DT_TM!=""){updateDT.setISO8601(social.UPDT_DT_TM);
updatedTime=updateDT.format("shortDate3");
}if(social.UPDT_PRSNL_ID>0){var prsnlObj=MP_Util.GetValueFromArray(social.UPDT_PRSNL_ID,personnelArray);
updatedPrsn=prsnlObj.fullName;
}else{updatedPrsn="";
}var commentTxt="";
if(social.COMMENT_CNT>0){for(k=0,comntCnt=social.COMMENT_CNT;
k<comntCnt;
k++){comment=social.COMMENTS[k];
commentTxt+=comment.COMMENT_TXT+"<br />";
}}shArray.push("<dl class='sh-info'><dt>",i18n.SOCIAL_HISTORY_INFORMATION,"</dt><dd class = 'sh-risk'><span class='sh-cat'>",category,":</span><span class='sh-assess detail-line'>",riskAssessment,"</span></dd><dd class='sh-flag'><span>",detailTag,"</span></dd></dl> <h4 class='det-hd'>",i18n.SOCIAL_HISTORY_DETAILS,":</h4> <div class= 'hvr'><dl class='sh-det'><dt><span>",i18n.CATEGORY,":</span></dt><dd><span>",category,"</span></dd><dt><span>",i18n.DETAILS,":</span></dt><dd><span>",detailTxt,"</span></dd><dt><span>",i18n.LAST_UPDATED,":</span></dt><dd><span>",updatedTime,"</span></dd><dt><span>",i18n.LAST_UPDATED_BY,":</span></dt><dd><span>",updatedPrsn,"</span></dd><dt><span>",i18n.COMMENTS,":</span></dt><dd><span>",commentTxt,"</span></dd></dl></div>");
}shArray.push("</div>");
shhtml=shArray.join("");
countText=MP_Util.CreateTitleText(component,socialCnt);
MP_Util.Doc.FinalizeComponent(shhtml,component,countText);
}catch(err){if(timerRenderComponent){timerRenderComponent.Abort();
timerRenderComponent=null;
}throw (err);
}finally{if(timerRenderComponent){timerRenderComponent.Stop();
}}}};
}();

function VitalSignComponentStyle(){this.initByNamespace("vs");
}VitalSignComponentStyle.inherits(ComponentStyle);
function VitalSignComponent(criterion){this.setCriterion(criterion);
this.setStyles(new VitalSignComponentStyle());
this.setIncludeLineNumber(false);
this.m_graphLink=1;
VitalSignComponent.method("InsertData",function(){var nameSpace=new CERN_VITALSIGN_O1();
nameSpace.GetVitalSignsTable(this);
});
VitalSignComponent.method("setGraphFlag",function(value){this.m_graphLink=value;
});
VitalSignComponent.method("getGraphFlag",function(){return(this.m_graphLink);
});
VitalSignComponent.method("openTab",function(){var paramString=criterion.person_id+"|"+criterion.encntr_id+"|"+0+"|0|0";
MPAGES_EVENT("POWERFORM",paramString);
CERN_EventListener.fireEvent(null,this,EventListener.EVENT_CLINICAL_EVENT,"VitalSigns");
});
VitalSignComponent.method("openDropDown",function(formID){var criterion=this.getCriterion();
var paramString=criterion.person_id+"|"+criterion.encntr_id+"|"+formID+"|0|0";
MPAGES_EVENT("POWERFORM",paramString);
CERN_EventListener.fireEvent(null,this,EventListener.EVENT_CLINICAL_EVENT,"VitalSigns");
});
VitalSignComponent.method("refresh",function(event,arguments){var contentNode=this.getSectionContentNode();
contentNode.innerHTML="";
this.InsertData();
CERN_VITALSIGNS_O1_UTIL.ClearMaxTemp();
});
CERN_EventListener.addListener(this,EventListener.EVENT_CLINICAL_EVENT,this.refresh,this);
}VitalSignComponent.inherits(MPageComponent);
var CERN_VITALSIGN_O1=function(){var isErrorLoadingData=false;
var isDataFound=false;
var totalResultCount=0;
var m_comp=null;
var m_contentNode=null;
var m_rootComponentNode=null;
var m_threadCount=0;
var m_seqArry=[];
var m_contentHTML=[];
var m_isSequenced=false;
var m_isBPAssociated=true;
return{GetVitalSignsTable:function(component){var timerRenderComponent=MP_Util.CreateTimer("ENG:MPG.VITALSIGNS.O1 - render component");
try{m_comp=component;
var styles=component.getStyles();
m_rootComponentNode=component.getRootComponentNode();
m_contentNode=component.getSectionContentNode();
var groups=component.getGroups();
var xl=(groups!=null)?groups.length:0;
m_threadCount=xl;
CreateInfoHeader(m_contentNode);
for(var x=0;
x<xl;
x++){var group=groups[x];
if(group instanceof MPageSequenceGroup){m_seqArry=group.getItems().toString().split(",");
m_isSequenced=true;
}}for(var x=0;
x<groups.length;
x++){var group=groups[x];
if((group.getGroupName()!="")){GetResultsByGroup(group,1);
}else{if(group.getGroupName()==""){GetResultsByGroup(group,0);
}}}if(m_threadCount==0){FinalizeComponent();
}}catch(err){if(timerRenderComponent){timerRenderComponent.Abort();
timerRenderComponent=null;
}throw (err);
}finally{if(timerRenderComponent){timerRenderComponent.Stop();
}}}};
function CreateInfoHeader(secContentNode){var contentHdr=Util.cep("div",{className:"content-hdr"});
Util.ac(contentHdr,secContentNode);
var vitalsI18n=i18n.discernabu.vitals_o1;
var withinText=(m_comp.getDateFormat()==3)?("<span>"+vitalsI18n.WITHIN+"</span>"):"";
var ar=[];
ar.push("<table class='vs-table'><tr class='hdr'><th class='vs-lbl'><span>&nbsp;</span></th><th class='vs-icn1'><span>&nbsp;</span></th><th class='vs-res1'><span>",vitalsI18n.LATEST,"</span><br /><span>",withinText,"</span></th><th class='vs-icn2'><span>&nbsp;</span></th><th class='vs-res2'><span>",vitalsI18n.PREVIOUS,"</span><br /><span>",withinText,"</span></th><th class='vs-icn3'><span>&nbsp;</span></th><th class='vs-res3'><span>",vitalsI18n.PREVIOUS,"</span><br /><span>",withinText,"</span></th></tr></table>");
contentHdr.innerHTML=ar.join("");
}function FinalizeComponent(){var styles=m_comp.getStyles();
var totalCount=Util.Style.g("sec-total",m_rootComponentNode,"span");
var sResultText="";
if(isErrorLoadingData){m_contentNode.innerHTML=MP_Util.HandleErrorResponse(styles.getNameSpace());
}else{if(totalResultCount==0){sResultText=MP_Util.CreateTitleText(m_comp,totalResultCount);
m_contentNode.innerHTML=MP_Util.HandleNoDataResponse(styles.getNameSpace());
}else{if((totalResultCount>m_comp.getScrollNumber())&&m_comp.isScrollingEnabled()){var secContentBody=Util.cep("div",{className:"content-body scrollable vs-scrl-tbl"});
var contentHdr=Util.Style.g("content-hdr",m_rootComponentNode,"div");
Util.Style.acss(contentHdr[0],"vs-scrl-tbl-hd");
}else{var secContentBody=Util.cep("div",{className:"content-body"});
}secContentBody.innerHTML=m_contentHTML.join("");
m_contentNode.appendChild(secContentBody);
sResultText=MP_Util.CreateTitleText(m_comp,totalResultCount);
InitZebraStriping(secContentBody);
MP_Util.Doc.InitHovers(styles.getInfo(),m_contentNode);
if(m_comp.isScrollingEnabled()){MP_Util.Doc.InitScrolling(Util.Style.g("scrollable",m_rootComponentNode,"div"),m_comp.getScrollNumber(),"1.6");
}}}totalCount[0].innerHTML=sResultText;
}function GetResultsByGroup(group,setFlag){var sEC="0.0",sES="0.0";
if(group instanceof MPageEventCodeGroup){var ec=group.getEventCodes();
if(ec!=null&&ec.length>0){sEC="value("+ec.join(",")+")";
}m_isBPAssociated=false;
}if(group instanceof MPageEventSetGroup){var es=group.getEventSets();
if(es!=null&&es.length>0){sES="value("+es.join(",")+")";
}}else{if(group instanceof MPageSequenceGroup){var esMap=group.getMapItems();
var es=[];
if(esMap!=null){for(var x=0,xl=esMap.length;
x<xl;
x++){if(esMap[x].name=="CODE_VALUE"){es=esMap[x].value;
}}}if(es!=null&&es.length>0){sES="value("+es.join(",")+")";
}if(group.getGroupName()==i18n.discernabu.vitals_o1.TEMPERATURE){}}else{if(group instanceof MPageGrouper){var bpGroups=group.getGroups();
var ec=[];
for(var y=0;
y<bpGroups.length;
y++){if(bpGroups[y] instanceof MPageEventCodeGroup){ec.push(bpGroups[y].getEventCodes());
}}sEC="value("+ec.join(",")+")";
setFlag=1;
}}}var timerLoadComponent=MP_Util.CreateTimer("USR:MPG.VITALSIGNS.O1 - load component");
var info=new XMLCclRequest();
info.onreadystatechange=function(){if(this.readyState==4&&this.status==200){try{m_threadCount--;
var sHTML="",countText="";
var jsonEval=JSON.parse(this.responseText);
var recordData=jsonEval.RECORD_DATA;
if(recordData.STATUS_DATA.STATUS=="S"){var ar=[];
var codeArray=MP_Util.LoadCodeListJSON(jsonEval.RECORD_DATA.CODES);
var personnelArray=MP_Util.LoadPersonelListJSON(jsonEval.RECORD_DATA.PRSNL);
if(setFlag==1){var mapObjects=CERN_VITALSIGNS_O1_UTIL.LoadSetMeasurementData(jsonEval,personnelArray,codeArray);
}else{var mapObjects=CERN_VITALSIGNS_O1_UTIL.LoadMeasurementData(jsonEval,personnelArray,codeArray);
}var sGroupName="";
var measAr=[];
if(mapObjects.length!=0){for(var x=0,xl=mapObjects.length;
x<xl;
x++){if(sGroupName!=mapObjects[x].name){if(setFlag==1){sGroupName=group.getGroupName();
}else{sGroupName="";
}}measAr.push(mapObjects[x]);
if((x==(xl-1))){AssociateResultsToGroup(sGroupName,measAr,group);
}}}}else{if(recordData.STATUS_DATA.STATUS=="Z"){}else{isErrorLoadingData=true;
}}}catch(err){if(timerLoadComponent){timerLoadComponent.Abort();
timerLoadComponent=null;
}}finally{if(timerLoadComponent){timerLoadComponent.Stop();
}}}if(timerLoadComponent){timerLoadComponent.Abort();
}if(m_threadCount==0){FinalizeComponent();
}if(this.readyState==4){MP_Util.ReleaseRequestReference(this);
}};
var criterion=m_comp.getCriterion();
info.open("GET","MP_GET_N_RESULTS",true);
var sEncntr=(m_comp.getScope()==2)?criterion.encntr_id+".0":"0.0";
var sendAr=[];
var includeEventSetInfo=(setFlag==0)?1:0;
sendAr.push("^MINE^",criterion.person_id+".0",sEncntr,criterion.provider_id+".0",3,sES,sEC,"^measurement^",m_comp.getLookbackUnits(),criterion.position_cd+".0",criterion.ppr_cd+".0",m_comp.getLookbackUnitTypeFlag(),includeEventSetInfo);
info.send(sendAr.join(","));
}function AssociateResultsToGroup(subGroupName,measurements,group){var criterion=m_comp.getCriterion();
var encntrOption;
if(m_comp.getScope()==1){var prsnlInfo=criterion.getPersonnelInfo();
var encntrs=prsnlInfo.getViewableEncounters();
encntrOption=(encntrs)?'"value('+encntrs+')"':"0";
}else{encntrOption=criterion.encntr_id;
}var lookBackUnits=(m_comp.getLookbackUnits()!=null)?m_comp.getLookbackUnits():"365";
var lookBackType=(m_comp.getLookbackUnitTypeFlag()!=null)?m_comp.getLookbackUnitTypeFlag():"0";
var staticContent='"'+escape(criterion.static_content)+'"';
var isEventCodeDriven=subGroupName?false:true;
var ar=[];
for(var x=0,xl=measurements.length;
x<xl;
x++){ar=[];
ar.push("<table class='vs-table'>");
var eventSetGrouper=measurements[x].name;
var sequenceId=(eventSetGrouper>0)?eventSetGrouper:group.getGroupId();
var sequenceVal=GetOverallSequence(sequenceId);
var meas=measurements[x].value;
var m1=meas[0];
var eventCodes=(isEventCodeDriven)?m1.getEventCode().codeValue:0;
var resultDisplay=(subGroupName)?subGroupName:m1.getEventCode().display;
ar.push("<tr>");
if(m_comp.getGraphFlag()==1){ar.push("<td class='vs-lbl'><span class='row-label'><a class='lr-link' onClick='MP_Util.GraphResults(",m1.getPersonId(),",",encntrOption,",",eventCodes,",",staticContent,",",sequenceId,",",criterion.provider_id,",",criterion.position_cd,",",criterion.ppr_cd,",",lookBackUnits,",",lookBackType,");'>",resultDisplay,"</a></span></td>");
}else{ar.push("<td class='vs-lbl'><span class='row-label'>",resultDisplay,"</span></td>");
}if((subGroupName!=i18n.discernabu.vitals_o1.BLOOD_PRESSURE)||(m_isBPAssociated==false)){if(subGroupName==i18n.discernabu.vitals_o1.TEMPERATURE){ar.push(CERN_VITALSIGNS_O1_UTIL.CreateResultCell(meas[0],0,m_comp,group));
ar.push(CERN_VITALSIGNS_O1_UTIL.CreateResultCell(meas[1],1,m_comp,group));
ar.push(CERN_VITALSIGNS_O1_UTIL.CreateResultCell(meas[2],2,m_comp,group));
}else{ar.push(CERN_VITALSIGNS_O1_UTIL.CreateResultCell(meas[0],0,m_comp));
ar.push(CERN_VITALSIGNS_O1_UTIL.CreateResultCell(meas[1],1,m_comp));
ar.push(CERN_VITALSIGNS_O1_UTIL.CreateResultCell(meas[2],2,m_comp));
}}else{var measObjArry=[];
var bpMeas1=[];
var bpMeas2=[];
var bpMeas3=[];
var measCnt=0;
var label1="";
var label2="";
var label3="";
var currMeas=0;
var bpEventCds=[];
for(var j=0;
((j<meas.length)&&(measCnt<3));
j++){var currMeas=meas[j];
var k=j;
var matchFound=false;
var label=[];
var meas1,meas2;
if(currMeas!=-1){if(k+1<(meas.length)){while(((new Date(currMeas.getDateTime())).getTime()==(new Date(meas[k+1].getDateTime())).getTime())){if(new Date(currMeas.getUpdateDateTime()).getTime()==new Date(meas[k+1].getUpdateDateTime()).getTime()){label=CheckBPPair(currMeas.getEventCode().codeValue,meas[k+1].getEventCode().codeValue,group);
if(label[0]){matchFound=true;
measCnt++;
if(label[1]){meas1=currMeas;
meas2=meas[k+1];
}else{meas2=currMeas;
meas1=meas[k+1];
}if(measCnt==1){bpMeas1.push(meas1);
bpMeas1.push(meas2);
label1=label[0];
}if(measCnt==2){bpMeas2.push(meas1);
bpMeas2.push(meas2);
label2=label[0];
}if(measCnt==3){bpMeas3.push(meas1);
bpMeas3.push(meas2);
label3=label[0];
}meas[k+1]=-1;
}k++;
if(k>=(meas.length-1)){break;
}}else{k++;
if(k>=(meas.length-1)){break;
}}}}if(!matchFound){measCnt++;
var labelOrder=getBPLabel(currMeas.getEventCode().codeValue,group);
if(labelOrder[1]==0){meas1=currMeas;
meas2=0;
}else{meas2=currMeas;
meas1=0;
}if(measCnt==1){bpMeas1.push(meas1);
bpMeas1.push(meas2);
label1=labelOrder[0];
}if(measCnt==2){bpMeas2.push(meas1);
bpMeas2.push(meas2);
label2=labelOrder[0];
}if(measCnt==3){bpMeas3.push(meas1);
bpMeas3.push(meas2);
label3=labelOrder[0];
}}}}ar.push(CERN_VITALSIGNS_O1_UTIL.CreateBPResultCell(bpMeas1,0,label1,m_comp));
ar.push(CERN_VITALSIGNS_O1_UTIL.CreateBPResultCell(bpMeas2,1,label2,m_comp));
ar.push(CERN_VITALSIGNS_O1_UTIL.CreateBPResultCell(bpMeas3,2,label3,m_comp));
}ar.push("</tr>");
totalResultCount++;
ar.push("</table>");
if(m_isSequenced){m_contentHTML[sequenceVal]=ar.join("");
}else{m_contentHTML.push(ar.join(""));
}}}function GetOverallSequence(sequenceIdentifier){for(var i=0;
i<m_seqArry.length;
i++){if(m_seqArry[i]==sequenceIdentifier){return i;
}}}function CheckBPPair(eventCd1,eventCd2,group){var cd1Fnd=false,cd2Fnd=false;
var ec="";
var correctOrder=true;
var ecArry=[];
if(group instanceof MPageGrouper){var bpGroups=group.getGroups();
for(var y=0;
y<bpGroups.length;
y++){if(bpGroups[y] instanceof MPageEventCodeGroup){ecArry=[];
ecArry=(bpGroups[y].getEventCodes()).toString().split(",");
for(var i=0;
i<ecArry.length;
i++){if(ecArry[i]==eventCd1){cd1Fnd=true;
if(i==0){correctOrder=true;
}else{correctOrder=false;
}}if(ecArry[i]==eventCd2){cd2Fnd=true;
}}if(cd1Fnd&&cd2Fnd){return([bpGroups[y].getGroupName(),correctOrder]);
}}cd1Fnd=false;
cd2Fnd=false;
}}return([false,false]);
}function getBPLabel(codeValue,group){if(group instanceof MPageGrouper){var bpGroups=group.getGroups();
for(var y=0;
y<bpGroups.length;
y++){if(bpGroups[y] instanceof MPageEventCodeGroup){var groupName=bpGroups[y].getGroupName();
ecArry=[];
ecArry=(bpGroups[y].getEventCodes()).toString().split(",");
for(var i=0;
i<ecArry.length;
i++){if(ecArry[i]==codeValue){if(i==0){return[groupName,0];
}else{return[groupName,1];
}}}}}}}function InitZebraStriping(contentNode){var resultRows=_gbt("tr",contentNode);
for(var i=0;
i<resultRows.length;
i++){var zebraClass=((i%2)==0)?"odd":"even";
Util.Style.acss(resultRows[i],zebraClass);
}}};
var CERN_VITALSIGNS_O1_UTIL=function(){var m_maxTemp="";
var m_df=null;
return{CreateTempHvr:function(cell,personId,encntrId,providerId,positionCd,pprCd,hvrData){var df=GetDateFormatter();
var hoverInfo=hvrData.split("&");
var sES="value("+hoverInfo[8].split("-").join(",")+")";
var vitalsI18N=i18n.discernabu.vitals_o1;
var hoverHtml=[];
hoverHtml.push("<h4 class='det-hd'><span>",vitalsI18N.LABORATORY_DETAILS,"</span></h4><div class='hvr1'><dl class='vs-det'><dt class= 'vs-det-type'><span>",hoverInfo[0],":</span></dt><dd class='result'><span class='",hoverInfo[1],"'>",hoverInfo[2],"</span></dd><dt class= 'vs-det-type'><span>",vitalsI18N.DATE_TIME,":</span></dt><dd class='result'><span>",hoverInfo[3],"</span></dd><dt class= 'vs-det-type'><span>",vitalsI18N.NORMAL_LOW,":</span></dt><dd class='result'><span>",hoverInfo[4],"</span></dd><dt class= 'vs-det-type'><span>",vitalsI18N.NORMAL_HIGH,":</span></dt><dd class='result'><span>",hoverInfo[5],"</span></dd><dt class= 'vs-det-type'><span>",vitalsI18N.CRITICAL_LOW,":</span></dt><dd class='result'><span>",hoverInfo[6],"</span></dd><dt class= 'vs-det-type'><span>",vitalsI18N.CRITICAL_HIGH,":</span></dt><dd class='result'><span>",hoverInfo[7],"</span></dd><dt class= 'vs-det-type'><span>",vitalsI18N.TWO_DAY_MAX,":</span></dt><dd class='result'><span class='vs-temp-max'> Loading... </span></dd></dl></div></td>");
if(!Util.Style.ccss(cell,"vs-cached")){var hvr=Util.cep("div",{className:"hvr"});
Util.ac(hvr,cell);
hs(cell,hvr);
Util.Style.acss(cell,"vs-cached");
hvr.innerHTML=hoverHtml.join("");
var params="^MINE^, "+personId+".0,"+encntrId+".0,"+providerId+","+positionCd+".0"+pprCd;
var tempSpanNd=Util.Style.g("vs-temp-max",hvr,"span");
var maxTempMeas=null;
var maxTempVal=0;
var maxTempUom="";
if(m_maxTemp==""){var timerGetMaxTemp=MP_Util.CreateTimer("ENG:MPG.VITALSIGNS.O1 - get 48 hour max temp");
var info=new XMLCclRequest();
info.onreadystatechange=function(){if(this.readyState==4&&this.status==200){try{var sHTML="",countText="";
var jsonEval=JSON.parse(this.responseText);
var recordData=jsonEval.RECORD_DATA;
if(recordData.STATUS_DATA.STATUS=="S"){var codeArray=MP_Util.LoadCodeListJSON(jsonEval.RECORD_DATA.CODES);
var personnelArray=MP_Util.LoadPersonelListJSON(jsonEval.RECORD_DATA.PRSNL);
var mapObjects=CERN_VITALSIGNS_O1_UTIL.LoadSetMeasurementData(jsonEval,personnelArray,codeArray);
var measAr=[];
if(mapObjects.length!=0){for(var x=0,xl=mapObjects.length;
x<xl;
x++){measAr.push(mapObjects[x]);
}for(var x=0,xl=measAr.length;
x<xl;
x++){var meas=measAr[x].value;
var resVal=null;
var UOM="";
var currMax=0;
for(var y=0,yl=meas.length;
y<yl;
y++){var resVal=meas[y].getResult();
var UOM=resVal.getUOM()?resVal.getUOM().meaning:"";
var uomDisplay=resVal.getUOM()?resVal.getUOM().display:"";
if(UOM=="DEGC"){currMax=(parseInt(GetStringResult(resVal,false))*1.8)+32;
}else{if(UOM=="DEGF"){currMax=parseInt(GetStringResult(resVal,false));
}else{if(UOM==""){var intResult=parseInt(GetStringResult(resVal,false));
if(intResult>=55){currMax=intResult;
uomDisplay=vitalsI18N.DEGF;
}else{currMax=(parseInt(GetStringResult(resVal,false))*1.8)+32;
uomDisplay=vitalsI18N.DEGC;
}}}}if(y==0){maxTempMeas=meas[y];
maxTempVal=currMax;
maxTempUom=uomDisplay;
}else{if(currMax>maxTempVal){maxTempVal=currMax;
maxTempMeas=meas[y];
maxTempUom=uomDisplay;
}}}}}else{m_maxTemp="&nbsp;";
}var resNormalcy=CalculateNormalcy(maxTempMeas);
m_maxTemp="<span class='"+resNormalcy+"' >"+GetStringResult(maxTempMeas.getResult(),false)+"&nbsp;"+maxTempUom+"</span>&nbsp;<span>"+df.format(maxTempMeas.getDateTime(),mp_formatter.DateTimeFormatter.FULL_DATE_TIME_4YEAR)+"</span>";
tempSpanNd[0].innerHTML=m_maxTemp;
}else{if(recordData.STATUS_DATA.STATUS=="Z"){m_maxTemp="&nbsp;";
tempSpanNd[0].innerHTML=m_maxTemp;
}else{m_maxTemp=vitalsI18N.ERROR_RETREIVING_DATA;
tempSpanNd[0].innerHTML=m_maxTemp;
}}}catch(err){if(timerGetMaxTemp){timerGetMaxTemp.Abort();
timerGetMaxTemp=null;
}}finally{if(timerGetMaxTemp){timerGetMaxTemp.Stop();
}}}if(this.readyState==4){MP_Util.ReleaseRequestReference(this);
}};
if(timerGetMaxTemp){timerGetMaxTemp.Abort();
}info.open("GET","MP_GET_N_RESULTS",true);
var sendAr=[];
sendAr.push("^MINE^",personId+".0",encntrId,providerId+".0",200,sES,"0","^measurement^",2,positionCd+".0",pprCd+".0",2);
info.send(sendAr.join(","));
}else{tempSpanNd[0].innerHTML=m_maxTemp;
}}},LoadMeasurementData:function(jsonEval,personnelArray,codeArray){var mapObjects=[];
var results=jsonEval.RECORD_DATA.RESULTS;
for(var i=0,il=results.length;
i<il;
i++){if(results[i].CLINICAL_EVENTS.length>0){var measureArray=[];
var mapObject=null;
if(results[i].EVENT_CD>0){mapObject=new MP_Core.MapObject(results[i].EVENT_CD,measureArray);
}else{mapObject=new MP_Core.MapObject(results[i].EVENT_SET_GROUPER_CD,measureArray);
}results[i].CLINICAL_EVENTS.sort(SortByEffectiveUpdateDate);
for(var j=0,jl=results[i].CLINICAL_EVENTS.length;
j<jl;
j++){var meas=results[i].CLINICAL_EVENTS[j];
var eventCode=MP_Util.GetValueFromArray(meas.EVENT_CD,codeArray);
var dateTime=dateTime=new Date();
dateTime.setISO8601(meas.EFFECTIVE_DATE);
var updateTime=new Date();
updateTime.setISO8601(meas.UPDATE_DATE);
for(var k=0,kl=meas.MEASUREMENTS.length;
k<kl;
k++){var measurement=new MP_Core.Measurement();
var obj=MP_Util.Measurement.GetObject(meas.MEASUREMENTS[k],codeArray);
measurement.init(meas.EVENT_ID,meas.PERSON_ID,meas.ENCNTR_ID,eventCode,dateTime,MP_Util.Measurement.GetObject(meas.MEASUREMENTS[k],codeArray),updateTime);
measurement.setNormalcy(MP_Util.GetValueFromArray(meas.MEASUREMENTS[k].NORMALCY_CD,codeArray));
measureArray.push(measurement);
}}if(measureArray.length>0){mapObjects.push(mapObject);
}}}return mapObjects;
},LoadSetMeasurementData:function(jsonEval,personnelArray,codeArray){var mapObjects=[];
var results=jsonEval.RECORD_DATA.RESULTS;
var allClinicalEvents=[];
for(var i=0,il=results.length;
i<il;
i++){if(results[i].CLINICAL_EVENTS.length>0){for(var j=0,jl=results[i].CLINICAL_EVENTS.length;
j<jl;
j++){allClinicalEvents.push(results[i].CLINICAL_EVENTS[j]);
}}}if(allClinicalEvents.length>0){var measureArray=[];
var mapObject=null;
mapObject=new MP_Core.MapObject(results[0].EVENT_SET_CD,measureArray);
allClinicalEvents.sort(SortByEffectiveUpdateDate);
for(var j=0,jl=allClinicalEvents.length;
j<jl;
j++){var meas=allClinicalEvents[j];
var eventCode=MP_Util.GetValueFromArray(meas.EVENT_CD,codeArray);
var dateTime=dateTime=new Date();
dateTime.setISO8601(meas.EFFECTIVE_DATE);
var updateTime=new Date();
updateTime.setISO8601(meas.UPDATE_DATE);
for(var k=0,kl=meas.MEASUREMENTS.length;
k<kl;
k++){var measurement=new MP_Core.Measurement();
var obj=MP_Util.Measurement.GetObject(meas.MEASUREMENTS[k],codeArray);
measurement.init(meas.EVENT_ID,meas.PERSON_ID,meas.ENCNTR_ID,eventCode,dateTime,MP_Util.Measurement.GetObject(meas.MEASUREMENTS[k],codeArray),updateTime);
measurement.setNormalcy(MP_Util.GetValueFromArray(meas.MEASUREMENTS[k].NORMALCY_CD,codeArray));
measureArray.push(measurement);
}}if(measureArray.length>0){mapObjects.push(mapObject);
}}return mapObjects;
},CreateResultCell:function(result,idx,component,group){var ar=[];
var vitalsI18n=i18n.discernabu.vitals_o1;
var df=GetDateFormatter();
if(result==null){ar.push("<td class='vs-icn",idx,"'>&nbsp;</td><td class='vs-res",idx,"'><dl class='vs-info'><dt><span>",i18n.discernabu.vitals_o1.VALUE,"</span></dt><dd class='vs-res'><span>--</span></dd></dl></td>");
}else{var obj=result.getResult();
var resStr=GetStringResult(obj,false);
var resHvrStr=GetStringResult(obj,true);
var display=result.getEventCode().display;
var dateTime=result.getDateTime();
var faceUpDtTm=MP_Util.DisplayDateByOption(component,dateTime);
var labNormalcy=CalculateNormalcy(result);
var maxResultStr="";
var sCritHigh="",sCritLow="",sNormHigh="",sNormLow="";
if(obj instanceof MP_Core.QuantityValue){var refRange=obj.getRefRange();
if(refRange!=null){if(refRange.getCriticalHigh()!=0||refRange.getCriticalLow()!=0){sCritHigh=refRange.getCriticalHigh();
sCritLow=refRange.getCriticalLow();
}if(refRange.getNormalHigh()!=0||refRange.getNormalLow()!=0){sNormHigh=refRange.getNormalHigh();
sNormLow=refRange.getNormalLow();
}}}if(group!=null){var es=group.getEventSets();
var criterion=component.getCriterion();
var sEncntr=(component.getScope()==2)?criterion.encntr_id+".0":"0.0";
var hoverData="";
hoverData=display+"&"+labNormalcy+"&"+resHvrStr+"&"+df.format(dateTime,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_4YEAR)+"&"+sNormLow+"&"+sNormHigh+"&"+sCritLow+"&"+sCritHigh+"&"+es.join("-");
ar.push("<td class='vs-icn",idx,"'>",GetIcon(result),"</td><td onmouseover='javascript:CERN_VITALSIGNS_O1_UTIL.CreateTempHvr(this, ",criterion.person_id+".0",", ",sEncntr,", ",criterion.provider_id+".0",", ",criterion.position_cd+".0",", ",criterion.ppr_cd+".0",',"',hoverData,"\" )' class='vs-res",idx,"'><dl class= 'vs-info'><dt><span>",vitalsI18n.VALUE,"</span></dt><dd class='vs-res'><span class='",labNormalcy,"'>",resStr,"</span><br/><span class='within'>",faceUpDtTm,"</span></dd></dl></td>");
}else{ar.push("<td class='vs-icn",idx,"'>",GetIcon(result),"</td><td class='vs-res",idx,"'><dl class='vs-info'><dt><span>",vitalsI18n.VALUE,"</span></dt><dd class='vs-res'><span class='",labNormalcy,"'>",resStr,"</span><br /><span class='within'>",faceUpDtTm,"</span></dd></dl><h4 class='det-hd'><span>",vitalsI18n.LABORATORY_DETAILS,"</span></h4><div class='hvr'><dl class='vs-det'><dt class='vs-det-type'><span>",display,":</span></dt><dd class='result'><span class='",labNormalcy,"'>",resHvrStr,"</span></dd><dt class='vs-det-type'><span>",vitalsI18n.DATE_TIME,":</span></dt><dd class='result'><span>",df.format(dateTime,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_4YEAR),"</span></dd><dt class='vs-det-type'><span>",vitalsI18n.NORMAL_LOW,":</span></dt><dd class='result'><span>",sNormLow,"</span></dd><dt class='vs-det-type'><span>",vitalsI18n.NORMAL_HIGH,":</span></dt><dd class='result'><span>",sNormHigh,"</span></dd><dt class='vs-det-type'><span>",vitalsI18n.CRITICAL_LOW,":</span></dt><dd class='result'><span>",sCritLow,"</span></dd><dt class='vs-det-type'><span>",vitalsI18n.CRITICAL_HIGH,":</span></dt><dd class='result'><span>",sCritHigh,"</span></dd>",maxResultStr,"</dl></div></td>");
}}return ar.join("");
},CreateBPResultCell:function(result,idx,label,component){var ar=[];
var df=GetDateFormatter();
var vitalsI18n=i18n.discernabu.vitals_o1;
if(result[0]==null||result[1]==null){ar.push("<td class='vs-icn",idx,"'>&nbsp;</td><td class='vs-res",idx,"'><dl class='vs-info'><dt><span>",i18n.discernabu.vitals_o1.VALUE,"</span></dt><dd class='vs-res'><span>--</span></dd></dl></td>");
}else{var dateTime="";
if(result[0]!=0){var obj1=result[0].getResult();
var resStr1=GetStringResult(obj1,false);
var resHvrStr1=GetStringResult(obj1,true);
var display1=result[0].getEventCode().display;
dateTime=result[0].getDateTime();
var labNormalcy1=CalculateNormalcy(result[0]);
}else{var obj1="--";
var resStr1="--";
var resHvrStr1="--";
var display1="--";
var labNormalcy1="--";
}if(result[1]!=0){var obj2=result[1].getResult();
var resStr2=GetStringResult(obj2,false);
var resHvrStr2=GetStringResult(obj2,true);
var display2=result[1].getEventCode().display;
dateTime=result[1].getDateTime();
var labNormalcy2=CalculateNormalcy(result[1]);
}else{var obj2="--";
var resStr2="--";
var resHvrStr2="--";
var display2="--";
var labNormalcy2="--";
}var faceUpDtTm=MP_Util.DisplayDateByOption(component,dateTime);
var sCritHigh1="--",sCritLow1="--",sNormHigh1="--",sNormLow1="--",sCritHigh2="--",sCritLow2="--",sNormHigh2="--",sNormLow2="--",sNormLow="",sNormHigh="",sCritHigh="",sCritLow="";
if(obj1 instanceof MP_Core.QuantityValue){var refRange1=obj1.getRefRange();
if(refRange1!=null){if(refRange1.getCriticalHigh()!=0||refRange1.getCriticalLow()!=0){sCritHigh1=refRange1.getCriticalHigh();
sCritLow1=refRange1.getCriticalLow();
}if(refRange1.getNormalHigh()!=0||refRange1.getNormalLow()!=0){sNormHigh1=refRange1.getNormalHigh();
sNormLow1=refRange1.getNormalLow();
}}}if(obj2 instanceof MP_Core.QuantityValue){var refRange2=obj2.getRefRange();
if(refRange2!=null){if(refRange2.getCriticalHigh()!=0||refRange2.getCriticalLow()!=0){sCritHigh2=refRange2.getCriticalHigh();
sCritLow2=refRange2.getCriticalLow();
}if(refRange2.getNormalHigh()!=0||refRange2.getNormalLow()!=0){sNormHigh2=refRange2.getNormalHigh();
sNormLow2=refRange2.getNormalLow();
}}}if(!((sNormLow1=="--")&&(sNormLow2=="--"))){sNormLow=sNormLow1+" / "+sNormLow2;
}if(!((sNormHigh1=="--")&&(sNormHigh2=="--"))){sNormHigh=sNormHigh1+" / "+sNormHigh2;
}if(!((sCritLow1=="--")&&(sCritLow2=="--"))){sCritLow=sCritLow1+" / "+sCritLow2;
}if(!((sCritHigh1=="--")&&(sCritHigh2=="--"))){sCritHigh=sCritHigh1+"/ "+sCritHigh2;
}ar.push("<td class='vs-icn'",idx,"><span>&nbsp;</span></td>");
ar.push("<td class='vs-res",idx,"'><dl class='vs-info'><dt><span>",vitalsI18n.VALUE,"</span></dt><dd class='vs-res'><span class='",labNormalcy1,"'><span class='res-ind'>&nbsp;</span>",resStr1,"</span>/<span class='",labNormalcy2,"'><span class='res-ind'>&nbsp;</span>",resStr2,"</span><br/><span class='within'>",faceUpDtTm,"</span></dd></dl><h4 class='det-hd'><span>",vitalsI18n.LABORATORY_DETAILS,"</span></h4><div class='hvr'><dl class='vs-det'><dt class='vs-det-type'><span>",label,":</span></dt><dd class='result'><span class='",labNormalcy1,"'>",resHvrStr1,"</span>/<span class='",labNormalcy2,"'>",resHvrStr2,"</span></dd><dt class='vs-det-type'><span>",vitalsI18n.DATE_TIME,":</span></dt><dd class='result'><span>",df.format(dateTime,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_4YEAR),"</span></dd><dt class='vs-det-type'><span>",vitalsI18n.NORMAL_LOW,":</span></dt><dd class='result'><span>",sNormLow,"</span></dd><dt class='vs-det-type'><span>",vitalsI18n.NORMAL_HIGH,":</span></dt><dd class='result'><span>",sNormHigh,"</span></dd><dt class='vs-det-type'><span>",vitalsI18n.CRITICAL_LOW,":</span></dt><dd class='result'><span>",sCritLow,"</span></dd><dt class='vs-det-type'><span>",vitalsI18n.CRITICAL_HIGH,":</span></dt><dd class='result'><span>",sCritHigh,"</span></dd>","</dl></div></td>");
}return ar.join("");
},ClearMaxTemp:function(){m_maxTemp="";
}};
function SortByEffectiveUpdateDate(a,b){if(a.EFFECTIVE_DATE>b.EFFECTIVE_DATE){return -1;
}else{if(a.EFFECTIVE_DATE<b.EFFECTIVE_DATE){return 1;
}else{if(a.UPDATE_DATE>b.UPDATE_DATE){return -1;
}else{if(a.UPDATE_DATE<b.UPDATE_DATE){return 1;
}else{return 0;
}}}}}function CreateHoverForMeasurement(measurement){var ar=[];
var obj=measurement.getResult();
var resStr=GetStringResult(obj,false);
var resHvrStr=GetStringResult(obj,true);
var display=measurement.getEventCode().display;
var dateTime=measurement.getDateTime();
var labNormalcy=CalculateNormalcy(measurement);
var vitalsI18n=i18n.discernabu.vitals_o1;
var df=GetDateFormatter();
var sCritHigh="",sCritLow="",sNormHigh="",sNormLow="";
if(obj instanceof MP_Core.QuantityValue){var refRange=obj.getRefRange();
if(refRange!=null){if(refRange.getCriticalHigh()!=0||refRange.getCriticalLow()!=0){sCritHigh=refRange.getCriticalHigh();
sCritLow=refRange.getCriticalLow();
}if(refRange.getNormalHigh()!=0||refRange.getNormalLow()!=0){sNormHigh=refRange.getNormalHigh();
sNormLow=refRange.getNormalLow();
}}}ar.push("<dt class=vs-res><span>",display,":</span></dt><dd class=vs-det-type><span class=",labNormalcy,">",resHvrStr,"</span></dd><dt class=vs-res><span>",vitalsI18n.DATE_TIME,":</span></dt><dd class=vs-det-type><span>",df.format(dateTime,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_4YEAR),"</span></dd><dt class=vs-res><span>",vitalsI18n.NORMAL_LOW,":</span></dt><dd class=vs-det-type><span>",sNormLow,"</span></dd><dt class=vs-res><span>",vitalsI18n.NORMAL_HIGH,":</span></dt><dd class=vs-det-type><span>",sNormHigh,"</span></dd><dt class=vs-res><span>",vitalsI18n.CRITICAL_LOW,":</span></dt><dd class=vs-det-type><span>",sCritLow,"</span></dd><dt class=vs-res><span>",vitalsI18n.CRITICAL_HIGH,":</span></dt><dd class=vs-det-type><span>",sCritHigh,"</span></dd>");
return(ar.join(""));
}function GetStringResult(result,includeUOM){var value="";
var df=GetDateFormatter();
if(result instanceof MP_Core.QuantityValue){if(includeUOM){value=result.toString();
}else{value=result.getValue();
}}else{if(result instanceof Date){value=df.format(result,mp_formatter.DateTimeFormatter.FULL_DATE_TIME_4YEAR);
}else{value=result;
}}return value;
}function GetIcon(measObject){var normalcyIcon="<span class='res-normal'><span class='res-ind'>&nbsp;</span></span>";
var normalcy=measObject.getNormalcy();
if(normalcy!=null){var normalcyMeaning=normalcy.meaning;
if(normalcyMeaning==="LOW"){normalcyIcon="<span class='res-low'><span class='res-ind'>&nbsp;</span></span>";
}else{if(normalcyMeaning==="HIGH"){normalcyIcon="<span class='res-high'><span class='res-ind'>&nbsp;</span></span>";
}else{if(normalcyMeaning==="CRITICAL"||normalcyMeaning==="EXTREMEHIGH"||normalcyMeaning==="PANICHIGH"||normalcyMeaning==="EXTREMELOW"||normalcyMeaning==="PANICLOW"||normalcyMeaning==="VABNORMAL"){normalcyIcon="<span class='res-severe'><span class='res-ind'>&nbsp;</span></span>";
}else{if(normalcyMeaning==="ABNORMAL"||normalcyMeaning==="POSITIVE"){normalcyIcon="<span class='res-abnormal'><span class='res-ind'>&nbsp;</span></span>";
}}}}}return normalcyIcon;
}function CalculateCriticalRange(result){var rv="";
if(result instanceof MP_Core.QuantityValue){var rr=result.getRefRange();
if(rr!=null){rv=rr.toCriticalInlineString();
}}return rv;
}function CalculateNormalRange(result){var rv="";
if(result instanceof MP_Core.QuantityValue){var rr=result.getRefRange();
if(rr!=null){rv=rr.toNormalInlineString();
}}return rv;
}function CalculateNormalcy(result){var normalcy="res-normal";
var nc=result.getNormalcy();
if(nc!=null){var normalcyMeaning=nc.meaning;
if(normalcyMeaning!=null){if(normalcyMeaning==="LOW"){normalcy="res-low";
}else{if(normalcyMeaning==="HIGH"){normalcy="res-high";
}else{if(normalcyMeaning==="CRITICAL"||normalcyMeaning==="EXTREMEHIGH"||normalcyMeaning==="PANICHIGH"||normalcyMeaning==="EXTREMELOW"||normalcyMeaning==="PANICLOW"||normalcyMeaning==="VABNORMAL"){normalcy="res-severe";
}else{if(normalcyMeaning==="ABNORMAL"||normalcyMeaning==="POSITIVE"){normalcy="res-abnormal";
}}}}}}return normalcy;
}function GetDateFormatter(){if(m_df==null){m_df=new mp_formatter.DateTimeFormatter(MPAGE_LOCALE);
}return m_df;
return new mp_formatter.DateTimeFormatter(MPAGE_LOCALE);
}}();

