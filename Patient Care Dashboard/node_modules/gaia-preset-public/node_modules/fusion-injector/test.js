const injector = require("./injector");
const express = require("express");

const html = [
    "<html>",
    "<head>",
    "<script></script>",
    "</head>",
    "<body>Hello</body>",
    "</html>"
].join("\n");

const staticServerPort = 3000;
const proxyServerPort = 3001;

const createStaticServer = () => {
    const app = express();
    const sendHtml = (req, res) => {
        res.header("Content-Type", "text/html");
        res.send(html);
    };

    app.get("/page1", sendHtml);
    app.get("/page2", sendHtml);
    app.listen(staticServerPort, () => console.log("App started"));
};

const createProxy = () => {
    injector.createProxyServer(
        {
            ".*page1.*": {
                top: ["topJs.js", "topCss.css"],
                bottom : ["url2"]
            }
        },
        proxyServerPort,
        "prefix/",
        `http://localhost:${staticServerPort}`
    );
    console.log("Proxy started");
};

createStaticServer();
createProxy();
