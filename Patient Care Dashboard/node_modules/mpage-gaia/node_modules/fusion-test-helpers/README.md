# fusion-test-helpers
A dedicated repository for MPageFusion unit testing helpers.

## Table of Contents
* [Install](#install)
* [Top Level API](#top-level-api)
* [TVDom API](#tvdom-api)
* [TVDomArray API](#tvdomarray-api)

## Install

### package.json
```javascript
{
    optionalDependencies: {
        "fusion-test-helpers": "git+http://github.cerner.com/DiscernABU/fusion-test-helpers.git"
    }
}
```

## Imports
```javascript
// See API for available imports
import { /* functions */ } from "fusion-test-helpers";
```

## Top Level API

#### `TVDom: control(UIComponent: uiComponent)`

**Parameters**

1. `uiComponent` - The UIComponent to render and transform to testable virtual dom.

```javascript
import { control } from "fusion-test-helpers";
/* ... */
const uiComponent = new ExampleUIComponent();
const view = control(uiComponent);
```

## TVDom API
When you call the `control` function described above, a `TVDom` (test virtual dom) object is returned. This section describes the functions available on the `TVDom` object.

For each of the examples below, assume we have the following...
```javascript
const view = control(uiComponent);
```

#### `Object: attrs()`
Returns the attribute object of the virtual dom.
```javascript
const attrs = view.attrs();
```

#### `<*>: getAttr(string: name)`
**Parameters**

1. `name` - The key (name) of the attribute to retrieve.
```javascript
const classNames = view.getAttr("class");
```

#### `TVDomArray: children()`
Returns a `TVDomArray` (test virtual dom array) of the child virtual dom elements of the calling `TVDom` object.
```javascript
const children = view.children();
```
\* See the `TVDomArray` API for available methods.

#### `TVDom: parent()`
Returns the `TVDom` of the parent to the calling `TVDom` object.
```javascript
const parent = view.parent();
```

#### `TVDomArray: find(string: selector)`
Based on the selector query, returns a `TVDomArray` of matching virtual dom elements.

**Parameters**

1. `selector` - The selector query. This will find elements within the calling `TVDom` object that match.  Selectors are run using the [cssaurian][https://github.com/chrisdickinson/cssauron] engine.  Refer to that documentation for more details on the types of selector available.

```javascript
const childButtons = view.find(".mpageui-Button");
```

#### `TVDomArray: findByAttribute(string: attribute, <*>: value)`
Searches the calling `TVDom` object for virtual elements whose `attribute` matches the `value`.

**Parameters**

1. `attribute` - The name of the attribute to search for.
2. `value` - The value of the attribute that should match.

```javascript
// Finds virtual elements whose "example-attribute" is equal to "exampleValue".
const found = view.findByAttribute("example-attribute", "exampleValue");
```

#### `boolean: hasAttributeInChildren(string: attribute, <*> value)`
Returns `true` if the calling `TVDom` object's children have the `attribute` that matches the `value`.

**Parameters**

1. `attribute` - The name of the attribute to search for.
2. `value` - The value of the attribute that should match.

```javascript
const hasAttrInChildren = view.hasAttributeInChildren("example-attribute", "exampleValue");
assert.isTrue(hasAttrInChildren);
```

#### `boolean: hasClass(string: className)`
Checks if the calling `TVDom` object has a CSS class name that matches the provided `className`.

**Parameters**

1. `className` - The CSS class name(s) to check for.

```javascript
const hasClass = view.hasClass("mpageui-Button");
```

#### `TVDom: at(string: selector)`
Finds the provided selector in the virtual dom. This will return the first occurrence of the selector, if it exists.

**Parameters**

1. `selector` - The selector to search for.  Selectors are run using the [cssaurian][https://github.com/chrisdickinson/cssauron] engine.  Refer to that documentation for more details on the types of selector available.

```javascript
const button = view.at(".mpageui-Button");
```

#### `boolean: contains(string: str)`
Checks that the calling `TVDom` contains the text, `str`.

**Parameters**

1. `str` - The text to check for.

```javascript
const hasText = view.contains("Example Text");
```

#### `boolean: doesNotContain(string: str)`
Checks that the calling `TVDom` does not contain the text, `str`.

**Parameters**

1. `str` - The text to check for.

```javascript
const doesNotContain = view.doesNotContain("Example Text");
```

#### `boolean: has(string: selector)`
Checks that the calling `TVDom` object has virtual dom that matches the provided `selector`.

**Parameters**

1. `selector` - The selector query to check.  Selectors are run using the [cssaurian][https://github.com/chrisdickinson/cssauron] engine.  Refer to that documentation for more details on the types of selector available.

```javascript
const hasButton = view.has(".mpageui-Button");
```

#### `boolean: doesNotHave(string: selector)`
Checks that the calling `TVDom` does not have virtual dom that matches the provided `selector`.

**Parameters**

1. `selector` - The selector query to check.  Selectors are run using the [cssaurian][https://github.com/chrisdickinson/cssauron] engine.  Refer to that documentation for more details on the types of selector available.

```javascript
const doesNotHave = view.doesNotHave(".mpageui-Button");
```

#### `undefined: trigger(string: eventName [, Object: event | string: selector] [, Object: event])`
Triggers a simulated DOM event on the calling `TVDom` object. This function has configurable parameters.

**Parameters**

1. `eventName` - The first parameter must always be the name of the event.
2. `[event | selector]` - The 2nd parameter can either be a selector or the test event.  Selectors are run using the [cssaurian][https://github.com/chrisdickinson/cssauron] engine.  Refer to that documentation for more details on the types of selector available.
3. `[event]` - The 3rd argument must always be an event object (fake event).

```javascript
const eventSpy = createEventSpy();

// 1 argument - just triggers the "click" event.
view.trigger("click");

// 2 arguments
// -> Triggers the click on the virtual element that matches the selector
view.trigger("click", ".mpageui-Button");

// -> Triggers the click on the view with the provided event object.
view.trigger("click", eventSpy);

// 3 arguments
view.trigger("click", ".mpageui-Button", eventSpy);
```

#### `undefined: triggerOnCreate(HTMLElement: htmlElement, boolean: isInitialized)`
Triggers a fake initialization event on the virtual dom of the calling `TVDom`.

**Parameters**

1. `htmlElement` - An html element (usually mocked) that is passed to the _dangerous usage_ of the virtual dom config.
2. `isInitialized` - The initialization value of the virtual dom.

```javascript
const testHtml = createTestHtml();
const isInitialized = false;
view.triggerOnCreate(testHtml, isInitialized);
```

#### `undefined: verifyContains(string: str, string: message)`
Verifies that the calling `TVDom` contains the provided `str`.

**Parameters**

1. `str` - The text to check for.
2. `message` - The test log message (output upon failure).

```javascript
view.verifyContains("Example Text", "The view contains the expected text");
```

#### `undefined: verifyDoesNotContain(string: str, string: message)`
Verifies that the calling `TVDom` does not contain the text, `str`.

**Parameters**

1. `str` - The text to check for (and should not be found).
2. `message` - The test log message (output upon failure).

```javascript
view.verifyDoesNotContain("Example Text", "The view does not contain the text");
```

#### `undefined: verifyHas(string: selector, string: message)`
Verifies that the calling `TVDom` object has virtual dom that matches the provided `selector`.

**Parameters**

1. `selector` - The selector query to check.
2. `message` - The message to log upon failure.

```javascript
view.verifyHas(".mpageui-Button", "The view has the expected element");
```

#### `undefined: verifyDoesNotHave(string: selector, string: message)`
Verifies that the calling `TVDom` object does not have virtual dom that matches the provided `selector`.

**Parameters**

1. `selector` - The selector query to check.
2. `message` - The message to log upon failure.

```javascript
view.verifyDoesNotHave(".mpageui-Button", "The view does not have a button");
```

#### `undefined: verifyHasAttributeInChildren(string: attribute, <*> value, string: message)`
Performs unit test verification that the calling `TVDom` object has at least one child whose `attribute` matches the provided `value`.

**Parameters**

1. `attribute` - The name of the attribute to search for.
2. `value` - The value of the attribute that should match.
3. `message` - The message to output upon failure.

```javascript
view.verifyHasAttributeInChildren("example-attribute", "exampleValue", "The view has the expected attribute.");
```

#### `undefined: verifyDoesNotHaveAttributeInChildren(string: attribute, <*> value, string: message)`
Performs unit test verification that the calling `TVDom` object does not have a child whose `attribute` matches the provided `value`.

**Parameters**

1. `attribute` - The name of the attribute to search for.
2. `value` - The value of the attribute that should match.
3. `message` - The message to output upon failure.

```javascript
view.verifyDoesNotHaveAttributeInChildren("example-attribute", "exampleValue", "The view does not have the attribute.");
```

## TVDomArray API
When a call above returns a `TVDomArray`, refer to the following API for the available methods.

#### `number: count()`
Returns the number of items in the `TVDomArray`.

```javascript
view.find(".mpageui-Button").count();
```

#### `TVDom: first()`
Returns the first item in the `TVDomArray`.

```javascript
view.find(".mpageui-Button").first();
```

#### `TVDom: last()`
Returns the last item in the `TVDomArray`.

```javascript
view.find(".mpageui-Button").last();
```

#### `TVDom: get(number: index)`
Returns the item at the specified index (automatically clamped).

```javascript
view.find(".mpageui-Button").get(2);
```

#### `Array<TVDom>: all()`
Returns the `TVDomArray` items as an actual array of all `TVDom`.

```javascript
view.find(".mpageui-Button").all().forEach((button) => {
    // Logic here.
});
```
