"use strict";

import UIComponent from "../../../base";
import classNames from "classnames";
import ContentPanel from "../content-panel/ContentPanel";
import DataSectionContent from "./DataSectionContent";
import { NAMESPACE, LABEL_POSITION } from "./const";

/**
 * The DataSection class.
 * @class DataSection
 */
class DataSection extends UIComponent {
    /**
     * @inheritDoc
     */
    initialProps() {
        return {
            classNames: "",
            sections: []
        };
    }

    /**
     * @inheritDoc
     */
    propChangeHandlers() {
        return {
            sections: (sections) => {
                this.replaceAllChildren(sections.map((section) => new ContentPanel(Object.assign(
                    {
                        headerBgStyle: ContentPanel.HEADER_BG_STYLE.CANVAS,
                        bodyBgStyle: ContentPanel.BODY_BG_STYLE.CANVAS,
                        showHeaderBottomBorder: false,
                        classNames: classNames({
                            [ `${NAMESPACE}-contentPanel` ]: true,
                            [ section.classNames ]: !!section.classNames
                        }),
                        isCollapsible: !!section.isCollapsible,
                        isCollapsed: (!!section.isCollapsed && !!section.isCollapsible),
                        content: [
                            new DataSectionContent({
                                rows: section.rows,
                                content: section.content
                            })
                        ]
                    },
                    (section.id || section.key) ?
                        ({
                            key: (section.id || section.key)
                        }) : null,
                    (section.titleContent && section.titleContent.length) ?
                        ({
                            headerContent: section.titleContent
                        }) :
                        ({
                            headerDisplay: section.title
                        })
                )
                )));
            }
        };
    }

    /**
     * @inheritDoc
     */
    view(el, props) {
        return el(
            "div",
            {
                class: classNames({
                    [ NAMESPACE ]: true,
                    [ props.classNames ]: (props.classNames !== "")
                })
            },
            this.renderChildren()
        );
    }
}

DataSection.LABEL_POSITION = LABEL_POSITION;

export default DataSection;
