 ;;Solution_Test/script/PathNet -- Gen Lab/glb_upd_worklist_download/glb_upd_worklist_download.prg Turn on black mode

/*~BB~************************************************************************
      *                                                                      *
      *  Copyright Notice:  (c) 1983 Laboratory Information Systems &        *
      *                              Technology, Inc.                        *
      *       Revision      (c) 1984-2006 Cerner Corporation                 *
      *                                                                      *
      *  Cerner (R) Proprietary Rights Notice:  All rights reserved.         *
      *  This material contains the valuable properties and trade secrets of *
      *  Cerner Corporation of Kansas City, Missouri, United States of       *
      *  America (Cerner), embodying substantial creative efforts and        *
      *  confidential information, ideas and expressions, no part of which   *
      *  may be reproduced or transmitted in any form or by any means, or    *
      *  retained in any storage or retrieval system without the express     *
      *  written permission of Cerner.                                       *
      *                                                                      *
      *  Cerner is a registered mark of Cerner Corporation.                  *
      *                                                                      *
  ~BE~***********************************************************************/

/*****************************************************************************

        Source file name:       glb_upd_worklist_download.prg
        Object name:            glb_upd_worklist_download
        Request #:              250130

        Product:                Worklist Request
        Product Team:           Pathnet         

        Program purpose:        Record download action to be later displayed in Worklist
                                History.  Also update worklist to indicate that it has
                                been downloaded.

        Tables read:            dual

        Tables updated:         worklist_event, worklist

        Executing from:         CPM Script Server

********************************************************************************************
           *              GENERATED MODIFICATION CONTROL LOG              *
********************************************************************************************

Mod   Date        Engineer                Modification Performed
---   --------    --------------------    --------------------------------------------------
001   04/28/06    Joe Troy                Initial Code
********************************************************************************************/

drop program glb_upd_worklist_download:dba go
create program glb_upd_worklist_download:dba

/*
record request
(
  1 worklist_id = f8
)*/

record reply
(
%i cclsource:status_block.inc
)

declare bFail             = i2 with protect, noconstant(0)

/*******************************************************************/
/* insert row into worklist_event table                            */
/*******************************************************************/

insert into worklist_event we
set
  we.worklist_event_id  = seq(pathnet_seq, nextval),
  we.worklist_id        = request->worklist_id,
  we.event_dt_tm        = cnvtdatetime(curdate, curtime3),
  we.event_prsnl_id     = reqinfo->updt_id,
  we.event_type_flag    = 1
with
  nocounter

if(curqual = 0)
  set reply->status_data.subeventstatus[1].operationname      = "insert"
  set reply->status_data.subeventstatus[1].targetObjectValue  = "worklist_event table"
  set bFail = 1
  go to exit_script
endif

/*******************************************************************/
/* update row into worklist table, specifying download successful  */
/*******************************************************************/

update into worklist w
set
  w.downloaded_ind = 1
where
  w.worklist_id = request->worklist_id
with
  nocounter

if(curqual = 0)
  set reply->status_data.subeventstatus[1].operationname      = "update"
  set reply->status_data.subeventstatus[1].targetObjectValue  = "worklist table"
  set bFail = 1
endif

#exit_script

if(bFail = 1)
  set reply->status_data.status = "F"
  set reply->status_data.subeventstatus[1].operationstatus    = "F"
  set reply->status_data.subeventstatus[1].targetobjectname   = "glb_upd_worklist_download"
  set reqinfo->commit_ind = 0
else
  set reply->status_data.status = "S"
  set reqinfo->commit_ind = 1
endif

end go

;Generated by GNU enscript 1.6.4.
