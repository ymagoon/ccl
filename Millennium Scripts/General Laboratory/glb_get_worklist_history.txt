 ;;Solution_Test/script/PathNet -- Gen Lab/glb_get_worklist_history/glb_get_worklist_history.prg Turn on black mode

/*~BB~************************************************************************
      *                                                                      *
      *  Copyright Notice:  (c) 1983 Laboratory Information Systems &        *
      *                              Technology, Inc.                        *
      *       Revision      (c) 1984-2006 Cerner Corporation                 *
      *                                                                      *
      *  Cerner (R) Proprietary Rights Notice:  All rights reserved.         *
      *  This material contains the valuable properties and trade secrets of *
      *  Cerner Corporation of Kansas City, Missouri, United States of       *
      *  America (Cerner), embodying substantial creative efforts and        *
      *  confidential information, ideas and expressions, no part of which   *
      *  may be reproduced or transmitted in any form or by any means, or    *
      *  retained in any storage or retrieval system without the express     *
      *  written permission of Cerner.                                       *
      *                                                                      *
      *  Cerner is a registered mark of Cerner Corporation.                  *
      *                                                                      *
  ~BE~***********************************************************************/

/*****************************************************************************

        Source file name:       glb_get_worklist_history.prg
        Object name:            glb_get_worklist_history
        Request #:              250161

        Product:                Worklist Request
        Product Team:           Pathnet         

        Program purpose:        Retrieve worklist history for downloads and saves.

        Tables read:            worklist_event, prsnl

        Tables updated:         none

        Executing from:         CPM Script Server

********************************************************************************************
           *              GENERATED MODIFICATION CONTROL LOG              *
********************************************************************************************

Mod   Date        Engineer                Modification Performed
---   --------    --------------------    --------------------------------------------------
001   04/28/06    Joe Troy                Initial Code
002   08/19/10    Oliver Barbara          Return username of "SYSTEM" for some events.
********************************************************************************************/

drop program glb_get_worklist_history:dba go
create program glb_get_worklist_history:dba

/*
record request
(
  1 worklist_id = f8
)*/

record reply
(
  1 qual[*]
    2 event_dt_tm       = dq8
    2 event_prsnl_name  = vc
    2 event_type_flag   = i2
%i cclsource:status_block.inc
)

%i cclsource:i18n_uar.inc

set i18nHandle = 0
set h = uar_i18nlocalizationinit(i18nHandle, curprog, "", curcclrev)

declare nEventCnt = i4 with protect, noconstant(0)

select into "nl:"
from
  worklist_event we,
  prsnl p
plan we where
  we.worklist_id = request->worklist_id
join p where
  p.person_id = we.event_prsnl_id
order by we.event_dt_tm desc
detail
  nEventCnt = nEventCnt + 1
  if(mod(nEventCnt, 10) = 1)
    stat = alterlist(reply->qual, nEventCnt + 9)
  endif
  reply->qual[nEventCnt].event_dt_tm = cnvtdatetime(we.event_dt_tm)
  
  if(p.person_id > 0)
     reply->qual[nEventCnt].event_prsnl_name = p.name_full_formatted
  else
     reply->qual[nEventCnt].event_prsnl_name = uar_i18ngetmessage(i18nHandle, "SYSTEM", "SYSTEM")
  endif
  
  reply->qual[nEventCnt].event_type_flag = we.event_type_flag
with nocounter

set stat = alterlist(reply->qual, nEventCnt)
set reply->status_data.status = evaluate(nEventCnt, 0, "Z", "S")
end go

;Generated by GNU enscript 1.6.4.
