 ;;Solution_Test/script/Database Architecture -- Tools/DM_README/dm_add_upt_setup_proc_log.prg Turn on black mode

drop program dm_add_upt_setup_proc_log:dba go
create program dm_add_upt_setup_proc_log:dba

;MODs
;001 01/09/98 Robin Sippel  Change code to work with packets.

    /*
    request (
    	1 setup_proc[1]
        	2 env_id = f8 ;environment_id of the environment where the step is running
            2 process_id = f8  ;assigned to your readme step when you fill out the spreadsheet
        	2 success_ind = i4   ;0 for failure, 1 for success
        	2 error_msg = vc200   ;tells what kind of error occurred
    	)
    */

    
    /******** insert/update into dm_setup_proc_log ********/
 
;001    update into dm_setup_proc_log spl set
/*001*/ update into dm_pkt_setup_proc_log spl set
        spl.success_ind = request->setup_proc[1]->success_ind,
        spl.error_msg = request->setup_proc[1]->error_msg,
        spl.updt_dt_tm = cnvtdatetime(curdate,curtime3)
    where spl.process_id = request->setup_proc[1]->process_id
      and spl.environment_id = request->setup_proc[1]->env_id
    with nocounter
    
    if (curqual = 0)
    
        /* the row did not already exist, so insert it */
        
;001        insert into dm_setup_proc_log spl set
/*001*/ insert into dm_pkt_setup_proc_log spl set
            spl.process_id = request->setup_proc[1]->process_id,
            spl.environment_id = request->setup_proc[1]->env_id,
            spl.success_ind = request->setup_proc[1]->success_ind,
            spl.error_msg = request->setup_proc[1]->error_msg,
            spl.create_dt_tm = cnvtdatetime(curdate,curtime3),
            spl.updt_dt_tm = cnvtdatetime(curdate,curtime3)
        with nocounter
    
        
    endif
    
    /******** insert/update into dm_pkt_setup_proc_hist ********/
 
/*001*/ update into dm_pkt_setup_proc_hist sph set
/*001*/     sph.success_ind = request->setup_proc[1]->success_ind,
/*001*/     sph.updt_dt_tm = cnvtdatetime(curdate,curtime3),
/*001*/     sph.updt_cnt = sph.updt_cnt + 1
/*001*/ where sph.process_id = request->setup_proc[1]->process_id
/*001*/   and sph.environment_id = request->setup_proc[1]->env_id
/*001*/ with nocounter
    
/*001*/ if (curqual = 0)
    
            /* the row did not already exist, so insert it */
        
/*001*/     insert into dm_pkt_setup_proc_hist sph set
/*001*/         sph.process_id = request->setup_proc[1]->process_id,
/*001*/         sph.environment_id = request->setup_proc[1]->env_id,
/*001*/         sph.success_ind = request->setup_proc[1]->success_ind,
/*001*/         sph.create_dt_tm = cnvtdatetime(curdate,curtime3),
/*001*/         sph.updt_dt_tm = cnvtdatetime(curdate,curtime3),
/*001*/         sph.updt_cnt = 0
/*001*/     with nocounter
    
        
/*001*/ endif

commit

end
go                
        
        
    
    

;Generated by GNU enscript 1.6.4.
