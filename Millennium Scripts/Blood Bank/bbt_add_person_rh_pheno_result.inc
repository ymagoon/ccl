 ;;Solution_Test/script/PathNet -- BB Transfusion/RESULTENTRYFORBLOODBANK/BBT_ADD_PERSON_RH_PHENO_RESULT.INC Turn on black mode

/*
 *  PURPOSE:  add row to person_rh_pheno_result
 *
 *  PRELIMINARIES:
 *   1)  Include the following code in calling program:
 *           %i cclsource:bbt_add_person_rh_pheno_result.inc
 *           END        ; end subroutine ADD_PERSON_RH_PHENO_RESULT
 *
 *           %i cclsource:bbt_get_pathnet_seq_sub.inc
 *
 *   2)  Declare the followoing variables in the calling program, prior to calling the subroutine:
 *             set gsub_rh_phenotype_status     = "  "      ; (gsub = global subroutine variable)
 *             set new_rh_phenotype_id          = 0.0       
 *             set bb_rh_phenotype_id           = 0.0       ; rh_phenotype_id from bb_rh_phenotype table for nomenclature_id
 *
 *   3)  Call subroutine using CALL FORMAT below
 *
 *   4)  After control returns from subroutine, evaluate gsub_rh_phenotype_status as follows:
 *         "FS" = get new person_rh_pheno_result_id (seq) failed
 *         "FA" = add person_rh_pheno_result failed                                
 *         "OK" = add successful                                           
 *
 *  CALL FORMAT (this may be copied into calling program): */
 ;       call ADD_PERSON_RH_PHENO_RESULT
 ;          (                             ** These <variables> set in calling program **
 ;           /* person_id              */ <person_id>
 ;           /* encntr_id              */ , <encntr_id>
 ;           /* nomenclature_id        */ , <nomenclature_id>
 ;           /* person_rh_phenotype_id */ , <person_rh_phenotype_id>
 ;           /* active_ind             */ , <active_ind>
 ;           /* active_status_cd       */ , <reqdata->active_status_cd>
 ;           /* active_status_dt_tm    */ , cnvtdatetime(<active_status_dt_tm>)
 ;           /* active_status_prsnl_id */ , <active_status_prsnl_id>
 ;          )

subroutine ADD_PERSON_RH_PHENO_RESULT
    (
     sub_person_id
     , sub_encntr_id
     , sub_nomenclature_id
     , sub_rh_phenotype_id
     , sub_result_id
     , sub_active_ind
     , sub_active_status_cd
     , sub_active_status_dt_tm
     , sub_active_status_prsnl_id
    )

/* Initialize gsub_rh_phenotype_status */
set gsub_rh_phenotype_status = "  "

set new_rh_phenotype_id = 0.0

set new_rh_phenotype_id = NEXT_PATHNET_SEQ(0)

if (curqual = 0) 
    set gsub_rh_phenotype_status = "FS"
else
    insert into person_rh_pheno_result prpr set
        prpr.person_rh_pheno_rs_id           = new_rh_phenotype_id
        , prpr.person_id                     = sub_person_id
        , prpr.encntr_id                     = sub_encntr_id
        , prpr.nomenclature_id               = sub_nomenclature_id
        , prpr.person_rh_phenotype_id        = sub_rh_phenotype_id
        , prpr.result_id                     = sub_result_id
        , prpr.updt_cnt                      = 0
        , prpr.updt_dt_tm                    = cnvtdatetime(curdate,curtime3)
        , prpr.updt_id                       = reqinfo->updt_id
        , prpr.updt_cnt                      = 0
        , prpr.updt_task                     = reqinfo->updt_task
        , prpr.updt_applctx                  = reqinfo->updt_applctx      
        , prpr.active_ind                    = sub_active_ind
        , prpr.active_status_cd              = sub_active_status_cd
        , prpr.active_status_dt_tm           = cnvtdatetime(sub_active_status_dt_tm)
        , prpr.active_status_prsnl_id        = sub_active_status_prsnl_id  
    with nocounter

    if (curqual = 0)
        set gsub_rh_phenotype_status = "FA"
    else
        set gsub_rh_phenotype_status = "OK"
    endif
endif

/* END for subroutine is to be included in calling program */   

;Generated by GNU enscript 1.6.4.
