 ;;Solution_Test/script/PathNet -- BB Transfusion/RETURNPRODUCTS/bbt_prod_ret_unlock.inc Turn on black mode


/*~BB~************************************************************************
      *                                                                      *
      *  Copyright Notice:  (c) 1983 Laboratory Information Systems &        *
      *                              Technology, Inc.                        *
      *       Revision      (c) 1984-1994 Cerner Corporation                 *
      *                                                                      *
      *  Cerner (R) Proprietary Rights Notice:  All rights reserved.         *
      *  This material contains the valuable properties and trade secrets of *
      *  Cerner Corporation of Kansas City, Missouri, United States of       *
      *  America (Cerner), embodying substantial creative efforts and        *
      *  confidential information, ideas and expressions, no part of which   *
      *  may be reproduced or transmitted in any form or by any means, or    *
      *  retained in any storage or retrieval system without the express     *
      *  written permission of Cerner.                                       *
      *                                                                      *
      *  Cerner is a registered mark of Cerner Corporation.                  *
      *                                                                      *
  ~BE~************************************************************************
      *                   PathNet Blood Bank Transfusion                     *
      *                           V500 Script                                *
      *                     bbt_prod_ret_unlock.inc                          *
      *                                                                      *
      * PURPOSE:          update tables with product return information      *
      * LAST UPDATED BY:  CERMAO                                             *
      * DATE CREATED:     6-21-96                                            *
      * LAST MODIFIED:    6-21-96                                            *
      * TABLES USED:      product                                            *
      * PASSED IN:        record structure "request"                         *
      * PASSED OUT:       record structure "reply"                           *
      * ACTION#:          225002                                             *
      * REQUEST#:         225002                                             *
      * APPLICATION#:     225001                                             *
      * SPECIAL NOTES:                                                       *
      ************************************************************************/
               select into "nl:"
                  p.product_id
               from product p 
               plan p  where (p.product_id = request->productlist[prod]->product_id)
                             and (p.updt_cnt = request->productlist[prod]->p_updt_cnt)
                             and (p.locked_ind = 1)
               with nocounter, forupdate(p)               
                      
               if (curqual = 0)     
                  set error_process = "update product"
                  set error_message = "product not locked"
                  set failure_occured = "T"
               else 
                  update into product p 
                      set p.locked_ind        = 0,
/*0604lsj                          p.cur_inv_locn_cd   = location_cd,
         */               p.cur_inv_locn_cd   = 0,
         				  p.interfaced_device_flag = 0,
                          p.cur_dispense_device_id = if(request->fromInterfaceFlag > 0)
                          								p.cur_dispense_device_id
                          							 else
                          							    0
                          							 endif,
                          p.updt_cnt          = p.updt_cnt + 1,
                          p.updt_dt_tm        = cnvtdatetime(curdate, curtime3),
                          p.updt_id           = ReqInfo->updt_id,
                          p.updt_task         = ReqInfo->updt_task,
                          p.updt_applctx      = ReqInfo->updt_applctx
                  plan p where (p.product_id = request->productlist[prod]->product_id) and
                              (p.updt_cnt = request->productlist[prod]->p_updt_cnt) and
                              (p.locked_ind = 1)
                  with counter
                  if (curqual = 0)   
                     set error_process = "update product"
                     set error_message = "product not updated"
                     set failure_occured = "T"
                  endif
               endif

;Generated by GNU enscript 1.6.4.
