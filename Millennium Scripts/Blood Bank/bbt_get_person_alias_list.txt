 ;;Solution_Test/script/PathNet -- BB Transfusion/Bbt_Getperson/bbt_get_person_alias_list.prg Turn on black mode

/****************************************************************************
 *                                                                      *
 *  Copyright Notice:  (c) 1983 Laboratory Information Systems &        *
 *                              Technology, Inc.                        *
 *       Revision      (c) 1984-1995 Cerner Corporation                 *
 *                                                                      *
 *  Cerner (R) Proprietary Rights Notice:  All rights reserved.         *
 *  This material contains the valuable properties and trade secrets of *
 *  Cerner Corporation of Kansas City, Missouri, United States of       *
 *  America (Cerner), embodying substantial creative efforts and        *
 *  confidential information, ideas and expressions, no part of which   *
 *  may be reproduced or transmitted in any form or by any means, or    *
 *  retained in any storage or retrieval system without the express     *
 *  written permission of Cerner.                                       *
 *                                                                      *
 *  Cerner is a registered mark of Cerner Corporation.                  *
 *                                                                      *
 ************************************************************************
 
          Date Written:       02/05/98
          Source file name:   bbt_get_person_alias_list
          Object name:        bbt_get_person_alias_list
          Request #:          225500
 
          Product:            PathNet BB Transfusion 
          Product Team:       PathNet BB
          HNA Version:        V500
          CCL Version:
 
          Program purpose:    Returns person demographics
 
          Tables read:        code_value, person_alias, person
          Tables updated:     None
          Executing from:
 
          Special Notes:
 
 ***********************************************************************
 *                  GENERATED MODIFICATION CONTROL LOG                 *
 ***********************************************************************
 *                                                                     *
 *Mod Date     Engineer             Comment                            *
 *--- -------- -------------------- -----------------------------------*
  000 02/05/98 Victoria Savariyar   initial release
 ***********************************************************************
 
 ******************  END OF ALL MODCONTROL BLOCKS  ********************/

drop program bbt_get_person_alias_list:dba go
create program bbt_get_person_alias_list:dba

/*
record request
( 1  person_id                    = f8
  1  called_from_script_ind       = i2
)
*/

if (request->called_from_script_ind != 1)
    record reply
    (  
      1 aliaslist[*]
        2 alias_type_cd                  = f8
        2 alias_type_disp                = vc
        2 alias_type_mean                = c12
        2 alias                          = vc
        2 alias_formatted                = vc
%i cclsource:status_block.inc
    )
endif

  set reply->status_data->status = "F"
  set count1 = 0
  set select_ok_ind = 0

  set alias_cnt = 0
  set stat = alterlist(reply->aliaslist, 5)

  select into "nl:"
       p.seq,
       New_alias =trim(cnvtalias(p.alias,p.alias_pool_cd))
  from person_alias p
  plan p where (p.person_id = request->person_id
           and p.active_ind = 1 
           and p.beg_effective_dt_tm <= cnvtdatetime(curdate,curtime3) 
           and p.end_effective_dt_tm >= cnvtdatetime(curdate,curtime3)) 

  detail
    alias_cnt = alias_cnt + 1
    if (mod(alias_cnt,5) = 1 and alias_cnt != 1)
        stat = alterlist(reply->aliaslist, alias_cnt + 4)
    endif

    reply->aliaslist[alias_cnt]->alias_type_cd = p.person_alias_type_cd
    reply->aliaslist[alias_cnt]->alias     = p.alias
    reply->aliaslist[alias_cnt]->alias_formatted = new_alias     

  foot report
      stat = alterlist(reply->aliaslist, alias_cnt)
      select_ok_ind = 1

  with nocounter, nullreport


#Exit_PROGRAM
  if (select_ok_ind = 1)
      if (alias_cnt > 0)
          set reply->status_data->status = "S"
      else
          set reply->status_data->status = "Z"
     endif
  else
      set reply->status_data->status = "F"
  endif

;call echo(build("status = ", reply->status_data->status))
;for (x = 1 to alias_cnt)
;    call echo(build(x, "--",
;       reply->aliaslist[x]->alias_type_cd       , "/",
;       reply->aliaslist[x]->alias               , "/",
;       reply->aliaslist[x]->alias_formatted     ))
;endfor

end go 

;Generated by GNU enscript 1.6.4.
