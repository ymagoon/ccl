<!DOCTYPE html>
<html>
    <head>
        <title>Sample: Basic Application Plugin System</title>
    </head>
    <body>
        <script src="requirejs/require.js"></script>
        <script>

            require.config({
                paths: {
                    "Bender/EventDispatcher": "../libraries/scripts/Bender/EventDispatcher"
                }
            });

            define("Bender/EventDispatcher/Sample/ApplicationKernel", [
                "Bender/EventDispatcher/EventDispatcher/Repository/EventAggregator"
            ], function (EventAggregator) {

                var ApplicationKernel;

                /**
                 * @auguments Bender/EventDispatcher/EventDispatcher/Repository/EventAggregator
                 * @constructor
                 */
                ApplicationKernel = function () {
                    EventAggregator.call(this);
                };
                ApplicationKernel.prototype = Object.create(EventAggregator.prototype);

                return ApplicationKernel;

            });

            define("Bender/EventDispatcher/Sample/ApplicationComponent", [
                "Bender/EventDispatcher/EventDispatcher"
            ], function (EventDispatcher) {

                var ApplicationComponent;

                /**
                 * @auguments Bender/EventDispatcher/EventDispatcher
                 * @constructor
                 */
                ApplicationComponent = function () {
                    EventDispatcher.call(this);
                };
                ApplicationComponent.prototype = Object.create(EventDispatcher.prototype);

                /**
                 * @constant {string}
                 */
                ApplicationComponent.EVENT_CUSTOM_ACTION = "event.custom_action";

                /**
                 * @constant {string}
                 */
                ApplicationComponent.EVENT_CUSTOM_ACTION_RESPONSE = "event.custom_action.response";

                /**
                 * @return {array}
                 */
                ApplicationComponent.prototype.getSupportedEvents = function () {
                    return [
                        ApplicationComponent.EVENT_CUSTOM_ACTION
                    ];
                };

                /**
                 * @return {array}
                 */
                ApplicationComponent.prototype.getSubscribedEvents = function () {
                    var ret = {};

                    ret[ApplicationComponent.EVENT_CUSTOM_ACTION_RESPONSE] = this.onCustomActionResponse.bind(this);

                    return ret;
                };

                /**
                 * @param {Bender/EventDispatcher/Event} evt
                 * @return {array}
                 */
                ApplicationComponent.prototype.onCustomActionResponse = function (evt) {
                    console.log("HELLO FROM APPLICATION COMPONENT!");
                };

                return ApplicationComponent;

            });

            define("Bender/EventDispatcher/Sample/Plugin", [
                "Bender/EventDispatcher/EventDispatcher",
                "Bender/EventDispatcher/Sample/ApplicationComponent"
            ], function (EventDispatcher, ApplicationComponent) {

                var Plugin;

                /**
                 * @auguments Bender/EventDispatcher/EventDispatcher
                 * @constructor
                 */
                Plugin = function () {
                    EventDispatcher.call(this);
                };
                Plugin.prototype = Object.create(EventDispatcher.prototype);

                /**
                 * @return {object}
                 */
                Plugin.prototype.getSubscribedEvents = function () {
                    var ret = {};

                    ret[ApplicationComponent.EVENT_CUSTOM_ACTION] = this.onCustomAction.bind(this);

                    return ret;
                };

                /**
                 * @return {object}
                 */
                Plugin.prototype.getSupportedEvents = function () {
                    return [
                        ApplicationComponent.EVENT_CUSTOM_ACTION_RESPONSE
                    ];
                };

                /**
                 * @fires Bender/EventDispatcher/Sample/ApplicationComponent#EVENT_CUSTOM_ACTION_RESPONSE
                 * @param {Bender/EventDispatcher/Event} evt
                 * @return {void}
                 */
                Plugin.prototype.onCustomAction = function(evt) {
                    this.dispatch(ApplicationComponent.EVENT_CUSTOM_ACTION_RESPONSE, {
                        hello: "world"
                    });
                };

                return Plugin;

            });

            require([
                "Bender/EventDispatcher/Sample/ApplicationComponent",
                "Bender/EventDispatcher/Sample/ApplicationKernel",
                "Bender/EventDispatcher/Sample/Plugin"
            ], function (ApplicationComponent, ApplicationKernel, Plugin) {
                var applicationComponent = new ApplicationComponent(),
                    applicationKernel = new ApplicationKernel(),
                    plugin = new Plugin();

                // half duplex ...
                applicationKernel.add(plugin);
                applicationKernel.add(applicationComponent);

                // ... full duplex
                applicationKernel.addSubscriber(plugin);
                applicationKernel.addSubscriber(applicationComponent);

                applicationKernel.addListener(ApplicationComponent.EVENT_CUSTOM_ACTION_RESPONSE, function () {
                    console.log("HELLO FROM MAIN MODULE!");
                });

                applicationComponent.dispatch(ApplicationComponent.EVENT_CUSTOM_ACTION, {
                    thisIsSomeEventData: "foo"
                });
            });

        </script>
    </body>
</html>
