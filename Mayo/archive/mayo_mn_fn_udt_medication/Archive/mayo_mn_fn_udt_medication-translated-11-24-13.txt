1)translate mayo_mn_fn_udt_medication go
;*** Generated by translate command; verify before re-including in CCL ***
DROP PROGRAM   MAYO_MN_FN_UDT_MEDICATION : DBA  GO
CREATE PROGRAM  MAYO_MN_FN_UDT_MEDICATION : DBA

RECORD  REPLY  (
1  TEXT  =  VC
1  FORMAT  =  I4 )

DECLARE  CSBEGIN  =  VC  WITH  CONSTANT ("<html><body>" )

DECLARE  CSBOLD  =  VC  WITH  CONSTANT ("<B>" )

DECLARE  CSBOLDEND  =  VC  WITH  CONSTANT ("</B>" )

DECLARE  CSSPAN  =  VC  WITH  CONSTANT (
"<span style='font-size:8.0pt;font-family:Tahoma,sans-serif'>" )

DECLARE  CSSPANEND  =  VC  WITH  CONSTANT ("</span>" )

DECLARE  CSPARAGRAPH  =  VC  WITH  CONSTANT (
"<P class=MsoNormal style='TEXT-ALIGN: center' align=center>" )

DECLARE  CSPARAGRAPHEND  =  VC  WITH  CONSTANT ("</P>" )

DECLARE  CSEND  =  VC  WITH  CONSTANT ("</body></html>" )

DECLARE  CSTABLE  =  VC  WITH  CONSTANT ("<TABLE border ='1'" )

DECLARE  CSTABLEEND  =  VC  WITH  CONSTANT ("</TABLE>" )

DECLARE  CSTABLEDEF1  =  VC  WITH  CONSTANT (
"<TD><span style='font-size:8.0pt;font-family:Tahoma,sans-serif'>" )

DECLARE  CSTABLEDEF  =  VC  WITH  CONSTANT (
"<span style='font-size:8.0pt;font-family:Tahoma,sans-serif'>" )

DECLARE  CSTABLEDEFEND  =  VC  WITH  CONSTANT ("</TD>" )

DECLARE  DORDEREDCD  =  F8  WITH  NOCONSTANT (0.0 )

DECLARE  STEXT  =  VC

DECLARE  SORDERNAME  =  VC

DECLARE  SROUTE  =  VC

DECLARE  SFREQ  =  VC

DECLARE  SSTRENGTHDOSE  =  VC

DECLARE  SSTRENGTHDOSEUNIT  =  VC

DECLARE  SVOLUMEDOSE  =  VC

DECLARE  SVOLUMEDOSEUNIT  =  VC

DECLARE  SFREETEXTDOSE  =  VC

DECLARE  SDURATION  =  VC

DECLARE  SDURATIONUNIT  =  VC

DECLARE  SPRNINSTRUCTIONS  =  VC

DECLARE  SPRNREASON  =  VC

DECLARE  FREQPRN  =  VC

DECLARE  SSPECIALINSTRUCTIONS  =  VC

DECLARE  SREFILLS  =  VC

DECLARE  SPRNSPEC  =  VC

DECLARE  ORDCMT  =  VC

DECLARE  SINDICATIONS  =  VC

DECLARE  RECON_NOTE  =  VC

DECLARE  LDOSE  =  VC

DECLARE  UDOSE  =  VC

DECLARE  L_UDOSE  =  VC

DECLARE  LUNIT  =  VC

DECLARE  NRECORDED  =  I4  WITH  CONSTANT (2 )

DECLARE  NOWNMEDS  =  I4  WITH  CONSTANT (3 )

DECLARE  NNORMAL0  =  I4  WITH  CONSTANT (0 )

DECLARE  NNORMAL1  =  I4  WITH  CONSTANT (1 )

DECLARE  ORD_COMMENT_CD  =  F8  WITH  PUBLIC , NOCONSTANT (0.0 )

DECLARE  HARD_STOP_CD  =  F8  WITH  PUBLIC , CONSTANT ( UAR_GET_CODE_BY ("MEANING" , 4009 ,
"DRSTOP" ))

DECLARE  PHYSICIAN_STOP_CD  =  F8  WITH  PUBLIC , CONSTANT ( UAR_GET_CODE_BY ("MEANING" , 4009 ,
"HARD" ))

DECLARE  NOT_TAKING_CD  =  F8  WITH  PUBLIC , CONSTANT ( UAR_GET_CODE_BY ("MEANING" , 30254 ,
"NOTTAKING" ))

DECLARE  NOT_AS_PRESCRIBED_CD  =  F8  WITH  PUBLIC , CONSTANT ( UAR_GET_CODE_BY ("MEANING" , 30254
, "TAKINGNOTRX" ))

DECLARE  NROUTE  =  I4  WITH  CONSTANT (2050 )

DECLARE  NFREQ  =  I4  WITH  CONSTANT (2011 )

DECLARE  NSTRENGTHDOSE  =  I4  WITH  CONSTANT (2056 )

DECLARE  NSTRENGTHDOSEUNIT  =  I4  WITH  CONSTANT (2057 )

DECLARE  NVOLUMEDOSE  =  I4  WITH  CONSTANT (2058 )

DECLARE  NVOLUMEDOSEUNIT  =  I4  WITH  CONSTANT (2059 )

DECLARE  NFREETEXTDOSE  =  I4  WITH  CONSTANT (2063 )

DECLARE  NDURATION  =  I4  WITH  CONSTANT (2061 )

DECLARE  NDURATIONUNIT  =  I4  WITH  CONSTANT (2062 )

DECLARE  NPRN  =  I4  WITH  CONSTANT (2101 )

DECLARE  NPRNREASON  =  I4  WITH  CONSTANT (142 )

DECLARE  NSPECIALINSTRUCTS  =  I4  WITH  CONSTANT (1103 )

DECLARE  NREFILLS  =  I4  WITH  CONSTANT (67 )

DECLARE  NACTSEQ  =  I4  WITH  NOCONSTANT (0 )

DECLARE  BODFLAG  =  I1  WITH  NOCONSTANT (0 )

DECLARE  NMEDCOUNT  =  I4  WITH  NOCONSTANT (0 )

DECLARE  POPULATE  =  I2  WITH  NOCONSTANT (0 )

DECLARE  NOT_TAKING_FLAG  =  C1

SET  NOT_TAKING_FLAG  = "N"

SET  DORDEREDCD  =  UAR_GET_CODE_BY ("MEANING" , 6004 , "ORDERED" )

SET  ORD_COMMENT_CD  =  UAR_GET_CODE_BY ("MEANING" , 14 , "ORD COMMENT" )

DECLARE  SSTYLECENTER  =  VC  WITH  CONSTANT (
" style='text-align: center;font-size:8.0pt;font-family:Tahoma,sans-serif;font-weight:bold;'>" )

SET  STEXT  =  BUILD ( CSBEGIN , "<TABLE border ='1' cellpadding=2" )

SET  STEXT  =  BUILD ( STEXT , "<TR>" , "<td width=150" ,  SSTYLECENTER ,
"<b>Medication/Strength</b>" ,  CSSPANEND ,  CSTABLEDEFEND )

SET  STEXT  =  BUILD ( STEXT , "<td width=90" ,  SSTYLECENTER , "<b>Dose</b>" ,  CSSPANEND ,
 CSTABLEDEFEND )

SET  STEXT  =  BUILD ( STEXT , "<td width=90" ,  SSTYLECENTER , "<b>Route</b>" ,  CSSPANEND ,
 CSTABLEDEFEND )

SET  STEXT  =  BUILD ( STEXT , "<td width=90" ,  SSTYLECENTER , "<b>Frequency</b>" ,  CSSPANEND ,
 CSTABLEDEFEND )

SET  STEXT  =  BUILD ( STEXT , "<td width=290" ,  SSTYLECENTER ,
"<b>Indications/Special Instructions/Comments/Notes</b>" ,  CSSPANEND ,  CSTABLEDEFEND )

SELECT  INTO "nl:"
O.ORDER_ID,
OD.OE_FIELD_ID,
OC.ACTION_SEQUENCE
FROM (
 ORDERS  O
),
(
 ORDER_COMPLIANCE_DETAIL  OCD
),
(
 DUMMYT  D
),
(
 ORDER_DETAIL  OD
),
(
 ORDER_COMMENT  OC
),
(
 LONG_TEXT  LT
),
(
 ORDER_RECON_DETAIL  ORD
),
(
 DUMMYT  D1
),
(
 DUMMYT  D2
)
 PLAN ( O
WHERE (O.PERSON_ID= REQUEST -> PERSON_ID ) AND ((O.ORDER_STATUS_CD+0 )= DORDEREDCD ) AND (
O.CATALOG_TYPE_CD=2516 ) AND (O.ACTIVE_IND=1 ) AND (O.ORIG_ORD_AS_FLAG IN ( NRECORDED ,
 NOWNMEDS ,
 NNORMAL1 )))
 AND ( OC
WHERE (OC.ORDER_ID= OUTERJOIN (O.ORDER_ID)) AND (OC.COMMENT_TYPE_CD= OUTERJOIN ( ORD_COMMENT_CD )))
 AND ( LT
WHERE (LT.LONG_TEXT_ID= OUTERJOIN (OC.LONG_TEXT_ID)) AND (LT.ACTIVE_IND= OUTERJOIN (1 )))
 AND ( D2 )
 AND ( OCD
WHERE (OCD.ORDER_NBR=O.ORDER_ID) AND (OCD.COMPLIANCE_CAPTURE_DT_TM=
(SELECT
 MAX (OCD2.COMPLIANCE_CAPTURE_DT_TM)
FROM (
 ORDER_COMPLIANCE_DETAIL  OCD2
)

WHERE (OCD2.ORDER_NBR=OCD.ORDER_NBR))))
 AND ( D1 )
 AND ( ORD
WHERE (ORD.ORDER_NBR=O.ORDER_ID) AND  EXISTS (
(SELECT
ORE.ORDER_RECON_ID
FROM (
 ORDER_RECON  ORE
)

WHERE (ORE.ORDER_RECON_ID=ORD.ORDER_RECON_ID) AND (ORE.ENCNTR_ID= REQUEST -> ENCNTR_ID ))) )
 AND ( D )
 AND ( OD
WHERE (OD.ORDER_ID=O.ORDER_ID) AND (OD.OE_FIELD_MEANING_ID IN (2050 ,
2011 ,
2062 ,
2061 ,
2055 ,
2101 ,
142 ,
1103 ,
67 ,
15 ,
2056 ,
2058 ,
2063 ,
2057 ,
2059 )))

ORDER BY O.ORDER_ID DESC ,
OD.OE_FIELD_ID,
OD.ACTION_SEQUENCE DESC ,
OCD.COMPLIANCE_CAPTURE_DT_TM DESC ,
ORD.UPDT_DT_TM DESC

HEAD OD.ORDER_ID
 POPULATE =1 , NMEDCOUNT =( NMEDCOUNT +1 ), SROUTE ="" , SFREQ ="" , SSTRENGTHDOSE ="" ,
 SSTRENGTHDOSEUNIT ="" , SVOLUMEDOSE ="" , SVOLUMEDOSEUNIT ="" , SFREETEXTDOSE ="" , SDURATION ="" ,
 SDURATIONUNIT ="" , SPRNINSTRUCTIONS ="" , SPRNREASON ="" , FREQPRN ="" , SSPECIALINSTRUCTIONS =""
, SREFILLS ="" , SPRNSPEC ="" , ORDCMT ="" , SINDICATIONS ="" , LDOSE ="" , LUNIT ="" , UDOSE ="" ,
 L_UDOSE ="" ,
IF ( (OCD.COMPLIANCE_STATUS_CD IN ( NOT_AS_PRESCRIBED_CD ,
 NOT_TAKING_CD )) )  O_MNEM = CONCAT ("<B>*</b>" ,  TRIM (O.ORDER_MNEMONIC)),  NOT_TAKING_FLAG ="Y"
ELSE   O_MNEM = TRIM (O.ORDER_MNEMONIC)
ENDIF
, O_AS_MNEM = TRIM (O.ORDERED_AS_MNEMONIC), HARD_STOP_FLAG =0 , STEXT = BUILD ( STEXT , "<TR>" ,
"<td width=150>" ,  CSTABLEDEF ,  O_MNEM , "&nbsp;" , "(" ,  O_AS_MNEM , ")" ,  CSSPANEND ,
 CSTABLEDEFEND ),
 CALL ECHO ( BUILD ("MNEMONIC:" ,  O_MNEM )), RECON_NOTE =ORD.RECON_NOTE_TXT
HEAD OD.OE_FIELD_ID
 NACTSEQ =OD.ACTION_SEQUENCE, BODFLAG = TRUE
HEAD OD.ACTION_SEQUENCE

IF ( ( NACTSEQ !=OD.ACTION_SEQUENCE) )  BODFLAG = FALSE
ENDIF

DETAIL

IF ( ( BODFLAG = TRUE ) )
IF ( (OD.OE_FIELD_MEANING_ID= NROUTE ) )  SROUTE = UAR_GET_CODE_DESCRIPTION (OD.OE_FIELD_VALUE)
ELSEIF ( (OD.OE_FIELD_MEANING_ID= NFREQ ) )  SFREQ = UAR_GET_CODE_DESCRIPTION (OD.OE_FIELD_VALUE)
ELSEIF ( (OD.OE_FIELD_MEANING="DURATIONUNIT" ) )  SDURATIONUNIT = UAR_GET_CODE_DESCRIPTION (
OD.OE_FIELD_VALUE)
ELSEIF ( (OD.OE_FIELD_MEANING="DURATION" ) )  SDURATION =OD.OE_FIELD_DISPLAY_VALUE
ELSEIF ( (OD.OE_FIELD_MEANING="STOPTYPE" ) )
IF ( (OD.OE_FIELD_VALUE IN ( HARD_STOP_CD ,
 PHYSICIAN_STOP_CD )) )  HARD_STOP_FLAG =1
ENDIF

ELSEIF ( (OD.OE_FIELD_MEANING_ID= NPRN ) )  SPRNREASON = TRIM (OD.OE_FIELD_DISPLAY_VALUE)
ELSEIF ( (OD.OE_FIELD_MEANING_ID= NPRNREASON ) )  SPRNREASON = TRIM (OD.OE_FIELD_DISPLAY_VALUE)
ELSEIF ( (OD.OE_FIELD_MEANING_ID= NSPECIALINSTRUCTS ) )  SSPECIALINSTRUCTIONS = TRIM (
OD.OE_FIELD_DISPLAY_VALUE)
ELSEIF ( (OD.OE_FIELD_MEANING_ID= NREFILLS ) )  SREFILLS = TRIM (OD.OE_FIELD_DISPLAY_VALUE)
ELSEIF ( (OD.OE_FIELD_MEANING_ID=15 ) )  SINDICATIONS = TRIM (OD.OE_FIELD_DISPLAY_VALUE)
ENDIF
,
CASE ( OD.OE_FIELD_MEANING )
 OF "STRENGTHDOSE" :  SSTRENGTHDOSE =OD.OE_FIELD_DISPLAY_VALUE
 OF "VOLUMEDOSE" :  SVOLUMEDOSE =OD.OE_FIELD_DISPLAY_VALUE
 OF "FREETXTDOSE" :  SFREETEXTDOSE =OD.OE_FIELD_DISPLAY_VALUE
 OF "STRENGTHDOSEUNIT" :  SSTRENGTHDOSEUNIT =OD.OE_FIELD_DISPLAY_VALUE
 OF "VOLUMEDOSEUNIT" :  SVOLUMEDOSEUNIT =OD.OE_FIELD_DISPLAY_VALUE
 ENDCASE

ENDIF

FOOT  OD.ORDER_ID

IF ( ( SSTRENGTHDOSE >" " ) )  LDOSE = SSTRENGTHDOSE
ELSEIF ( ( SVOLUMEDOSE >" " ) )  LDOSE = SVOLUMEDOSE
ELSEIF ( ( SFREETEXTDOSE >" " ) )  LDOSE = SFREETEXTDOSE ,  LUNIT =" "
ENDIF
,
IF ( ( SSTRENGTHDOSEUNIT >" " ) )  LUNIT = SSTRENGTHDOSEUNIT
ELSEIF ( ( SVOLUMEDOSEUNIT >" " ) )  LUNIT = SVOLUMEDOSEUNIT
ENDIF
,
IF ( (O.ORDER_COMMENT_IND>0 ) )  ORDCMT = TRIM (LT.LONG_TEXT)
ELSE   ORDCMT =""
ENDIF
,
IF ( ( TRIM ( SINDICATIONS )>" " ) )
IF ( ( TRIM ( SSPECIALINSTRUCTIONS )>" " ) )
IF ( ( TRIM ( ORDCMT )>" " ) )  SPRNSPEC = CONCAT ( TRIM ( SINDICATIONS ), " / " ,  TRIM (
 SSPECIALINSTRUCTIONS ), " / " ,  TRIM ( ORDCMT ))
ELSE   SPRNSPEC = CONCAT ( TRIM ( SINDICATIONS ), " / " ,  TRIM ( SSPECIALINSTRUCTIONS ))
ENDIF

ELSE
IF ( ( TRIM ( ORDCMT )>" " ) )  SPRNSPEC = CONCAT ( TRIM ( SINDICATIONS ), " / " ,  TRIM ( ORDCMT ))
ELSE   SPRNSPEC = TRIM ( SINDICATIONS )
ENDIF

ENDIF

ELSE
IF ( ( TRIM ( SSPECIALINSTRUCTIONS )>" " ) )
IF ( ( TRIM ( ORDCMT )>" " ) )  SPRNSPEC = CONCAT ( TRIM ( SSPECIALINSTRUCTIONS ), " / " ,  TRIM (
 ORDCMT ))
ELSE   SPRNSPEC = TRIM ( SSPECIALINSTRUCTIONS )
ENDIF

ELSE
IF ( ( TRIM ( ORDCMT )>" " ) )  SPRNSPEC = TRIM ( ORDCMT )
ELSE   SPRNSPEC =""
ENDIF

ENDIF

ENDIF
,
IF ( ( SPRNSPEC >" " ) )
IF ( ( RECON_NOTE >" " ) )  SPRNSPEC = CONCAT ( TRIM ( SPRNSPEC ), " / " ,  TRIM ( RECON_NOTE ))
ENDIF

ELSE
IF ( ( RECON_NOTE >" " ) )  SPRNSPEC = RECON_NOTE
ENDIF

ENDIF
, SPRNSPEC = REPLACE ( SPRNSPEC , "<" , "&lt;" ), SPRNSPEC = REPLACE ( SPRNSPEC , ">" , "&gt;" ),
IF ( ( LDOSE >" " ) )  L_UDOSE = CONCAT ( LDOSE , " " ,  LUNIT ),  STEXT = BUILD ( STEXT ,
"<td width=90>" ,  CSTABLEDEF ,  L_UDOSE ,  CSSPANEND ,  CSTABLEDEFEND )
ELSE   STEXT = BUILD ( STEXT , "<td width=90>" ,  CSTABLEDEF ,  CSSPANEND ,  CSTABLEDEFEND )
ENDIF
,
IF ( ( TRIM ( SROUTE )>" " ) )  STEXT = BUILD ( STEXT , "<td width=90>" ,  CSTABLEDEF ,  SROUTE ,
 CSSPANEND ,  CSTABLEDEFEND )
ELSE   STEXT = BUILD ( STEXT , "<td width=90>" ,  CSTABLEDEF ,  CSSPANEND ,  CSTABLEDEFEND )
ENDIF
,
IF ( ( TRIM ( SFREQ )>" " ) )
IF ( ( TRIM ( SPRNREASON )>" " ) )  FREQPRN = BUILD2 ( SFREQ , " as needed for " ,  SPRNREASON ),
 STEXT = BUILD ( STEXT , "<td width=90>" ,  CSTABLEDEF ,  FREQPRN ,  CSSPANEND ,  CSTABLEDEFEND )
ELSE   FREQPRN = SFREQ ,
IF ( ( SDURATION >" " ) AND ( SDURATIONUNIT >" " ) AND ( HARD_STOP_FLAG =1 ) )  FREQPRN = CONCAT (
 SFREQ , " for " ,  SDURATION , " " ,  SDURATIONUNIT )
ENDIF
,  STEXT = BUILD ( STEXT , "<td width=90>" ,  CSTABLEDEF ,  FREQPRN ,  CSSPANEND ,  CSTABLEDEFEND )
ENDIF

ELSE
IF ( ( TRIM ( SPRNREASON )>" " ) )  FREQPRN = SPRNREASON ,  STEXT = BUILD ( STEXT , "<td width=90>"
,  CSTABLEDEF ,  FREQPRN ,  CSSPANEND ,  CSTABLEDEFEND )
ELSE   STEXT = BUILD ( STEXT , "<td width=90>" ,  CSTABLEDEF ,  CSSPANEND ,  CSTABLEDEFEND )
ENDIF

ENDIF
,
IF ( ( TRIM ( SPRNSPEC )>" " ) )  STEXT = BUILD ( STEXT , "<td width=290>" ,  CSTABLEDEF ,
 SPRNSPEC ,  CSSPANEND ,  CSTABLEDEFEND )
ELSE   STEXT = BUILD ( STEXT , "<td width=290>" ,  CSTABLEDEF ,  CSSPANEND ,  CSTABLEDEFEND )
ENDIF
, STEXT = BUILD ( STEXT , "</TR>" )
 WITH  NOCOUNTER , OUTERJOIN = D2 , DONTCARE = OCD , OUTERJOIN = D1 , DONTCARE = ORD , OUTERJOIN =
 D

IF ( ( NOT_TAKING_FLAG ="Y" ) )
SET  STEXT  =  BUILD ( STEXT , "<TR>" ,  CSTABLEDEF1 ,  CONCAT (
"<b>*</B>  You have let us know that you are not taking this medication as " ,
"listed.  Please talk with your primary care provider or the health care provider who prescribed the "
, "medication as soon as possible." ),  CSSPANEND ,  CSTABLEDEFEND , "</TR>" )
ENDIF


IF ( ( POPULATE =0 ) )
SET  STEXT  =  BUILD ( STEXT , "<TR>" ,  CSTABLEDEF1 , "No Medications found" ,  CSSPANEND ,
 CSTABLEDEFEND )
ENDIF


SET  STEXT  =  BUILD ( STEXT ,  CSTABLEEND ,  CSEND )

SET  REPLY -> TEXT  =  STEXT

SET  REPLY -> FORMAT  = 1

 CALL ECHO ( REPLY -> TEXT )

SET  MOD  = "003 Akcia 11/01/2011"
END GO
1)

131124:221052 M063904_DVD2               Cost 0.00 Cpu 0.00 Ela 0.00 Bio   0 Dio   0 O0M0R0 P1R0